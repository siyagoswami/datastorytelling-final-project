var IS=Object.defineProperty;var LS=(ze,Je,ot)=>Je in ze?IS(ze,Je,{enumerable:!0,configurable:!0,writable:!0,value:ot}):ze[Je]=ot;var wb=(ze,Je,ot)=>LS(ze,typeof Je!="symbol"?Je+"":Je,ot);function OS(ze,Je){for(var ot=0;ot<Je.length;ot++){const Ht=Je[ot];if(typeof Ht!="string"&&!Array.isArray(Ht)){for(const Qt in Ht)if(Qt!=="default"&&!(Qt in ze)){const ni=Object.getOwnPropertyDescriptor(Ht,Qt);ni&&Object.defineProperty(ze,Qt,ni.get?ni:{enumerable:!0,get:()=>Ht[Qt]})}}}return Object.freeze(Object.defineProperty(ze,Symbol.toStringTag,{value:"Module"}))}(function(){const Je=document.createElement("link").relList;if(Je&&Je.supports&&Je.supports("modulepreload"))return;for(const Qt of document.querySelectorAll('link[rel="modulepreload"]'))Ht(Qt);new MutationObserver(Qt=>{for(const ni of Qt)if(ni.type==="childList")for(const Vi of ni.addedNodes)Vi.tagName==="LINK"&&Vi.rel==="modulepreload"&&Ht(Vi)}).observe(document,{childList:!0,subtree:!0});function ot(Qt){const ni={};return Qt.integrity&&(ni.integrity=Qt.integrity),Qt.referrerPolicy&&(ni.referrerPolicy=Qt.referrerPolicy),Qt.crossOrigin==="use-credentials"?ni.credentials="include":Qt.crossOrigin==="anonymous"?ni.credentials="omit":ni.credentials="same-origin",ni}function Ht(Qt){if(Qt.ep)return;Qt.ep=!0;const ni=ot(Qt);fetch(Qt.href,ni)}})();const dw=!1;var Vv=Array.isArray,DS=Array.prototype.indexOf,Rb=Array.from,zS=Object.defineProperty,b0=Object.getOwnPropertyDescriptor,Rw=Object.getOwnPropertyDescriptors,RS=Object.prototype,BS=Array.prototype,Bb=Object.getPrototypeOf,uw=Object.isExtensible;function FS(ze){return typeof ze=="function"}const _0=()=>{};function NS(ze){return ze()}function Mb(ze){for(var Je=0;Je<ze.length;Je++)ze[Je]()}const ig=2,Fb=4,Uv=8,jv=16,px=32,M0=64,Nb=128,tg=256,Iv=512,sg=1024,dx=2048,s_=4096,cx=8192,Gv=16384,Vb=32768,iv=65536,pw=1<<17,VS=1<<18,Bw=1<<19,Ab=1<<20,Ub=1<<21,I_=Symbol("$state"),US=Symbol("legacy props"),jS=Symbol(""),Fw=new class extends Error{constructor(){super(...arguments);wb(this,"name","StaleReactionError");wb(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}};function Nw(ze){return ze===this.v}function GS(ze,Je){return ze!=ze?Je==Je:ze!==Je||ze!==null&&typeof ze=="object"||typeof ze=="function"}function Vw(ze){return!GS(ze,this.v)}function WS(ze){throw new Error("https://svelte.dev/e/effect_in_teardown")}function HS(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function XS(ze){throw new Error("https://svelte.dev/e/effect_orphan")}function YS(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function $S(ze){throw new Error("https://svelte.dev/e/props_invalid_value")}function qS(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function ZS(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function KS(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let A0=!1,JS=!1;function QS(){A0=!0}const jb=1,Gb=2,Uw=4,eM=8,tM=16,iM=1,sM=2,rM=4,oM=8,nM=16,aM=1,lM=2,hM=4,cM=1,dM=2,hf=Symbol(),uM="http://www.w3.org/1999/xhtml";function Wb(ze){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}let Pc=null;function fw(ze){Pc=ze}function fx(ze,Je=!1,ot){Pc={p:Pc,c:null,e:null,s:ze,x:null,l:null},A0&&!Je&&(Pc.l={s:null,u:null,r1:[],r2:w0(!1)})}function mx(ze){var Je=Pc,ot=Je.e;if(ot!==null){Je.e=null;for(var Ht of ot)Zw(Ht)}return Pc=Je.p,{}}function Wv(){return!A0||Pc!==null&&Pc.l===null}function v0(ze){if(typeof ze!="object"||ze===null||I_ in ze)return ze;const Je=Bb(ze);if(Je!==RS&&Je!==BS)return ze;var ot=new Map,Ht=Vv(ze),Qt=Jx(0),ni=D_,Vi=a=>{if(D_===ni)return a();var Ni=Gh,Ui=D_;i_(null),yw(ni);var is=a();return i_(Ni),yw(Ui),is};return Ht&&ot.set("length",Jx(ze.length)),new Proxy(ze,{defineProperty(a,Ni,Ui){(!("value"in Ui)||Ui.configurable===!1||Ui.enumerable===!1||Ui.writable===!1)&&qS();var is=ot.get(Ni);return is===void 0?is=Vi(()=>{var Xs=Jx(Ui.value);return ot.set(Ni,Xs),Xs}):Jn(is,Ui.value,!0),!0},deleteProperty(a,Ni){var Ui=ot.get(Ni);if(Ui===void 0){if(Ni in a){const Qi=Vi(()=>Jx(hf));ot.set(Ni,Qi),Tb(Qt)}}else{if(Ht&&typeof Ni=="string"){var is=ot.get("length"),Xs=Number(Ni);Number.isInteger(Xs)&&Xs<is.v&&Jn(is,Xs)}Jn(Ui,hf),Tb(Qt)}return!0},get(a,Ni,Ui){var xs;if(Ni===I_)return ze;var is=ot.get(Ni),Xs=Ni in a;if(is===void 0&&(!Xs||(xs=b0(a,Ni))!=null&&xs.writable)&&(is=Vi(()=>{var zs=v0(Xs?a[Ni]:hf),hs=Jx(zs);return hs}),ot.set(Ni,is)),is!==void 0){var Qi=Sr(is);return Qi===hf?void 0:Qi}return Reflect.get(a,Ni,Ui)},getOwnPropertyDescriptor(a,Ni){var Ui=Reflect.getOwnPropertyDescriptor(a,Ni);if(Ui&&"value"in Ui){var is=ot.get(Ni);is&&(Ui.value=Sr(is))}else if(Ui===void 0){var Xs=ot.get(Ni),Qi=Xs==null?void 0:Xs.v;if(Xs!==void 0&&Qi!==hf)return{enumerable:!0,configurable:!0,value:Qi,writable:!0}}return Ui},has(a,Ni){var Qi;if(Ni===I_)return!0;var Ui=ot.get(Ni),is=Ui!==void 0&&Ui.v!==hf||Reflect.has(a,Ni);if(Ui!==void 0||fh!==null&&(!is||(Qi=b0(a,Ni))!=null&&Qi.writable)){Ui===void 0&&(Ui=Vi(()=>{var xs=is?v0(a[Ni]):hf,zs=Jx(xs);return zs}),ot.set(Ni,Ui));var Xs=Sr(Ui);if(Xs===hf)return!1}return is},set(a,Ni,Ui,is){var Or;var Xs=ot.get(Ni),Qi=Ni in a;if(Ht&&Ni==="length")for(var xs=Ui;xs<Xs.v;xs+=1){var zs=ot.get(xs+"");zs!==void 0?Jn(zs,hf):xs in a&&(zs=Vi(()=>Jx(hf)),ot.set(xs+"",zs))}if(Xs===void 0)(!Qi||(Or=b0(a,Ni))!=null&&Or.writable)&&(Xs=Vi(()=>Jx(void 0)),Jn(Xs,v0(Ui)),ot.set(Ni,Xs));else{Qi=Xs.v!==hf;var hs=Vi(()=>v0(Ui));Jn(Xs,hs)}var _r=Reflect.getOwnPropertyDescriptor(a,Ni);if(_r!=null&&_r.set&&_r.set.call(is,Ui),!Qi){if(Ht&&typeof Ni=="string"){var ar=ot.get("length"),Nr=Number(Ni);Number.isInteger(Nr)&&Nr>=ar.v&&Jn(ar,Nr+1)}Tb(Qt)}return!0},ownKeys(a){Sr(Qt);var Ni=Reflect.ownKeys(a).filter(Xs=>{var Qi=ot.get(Xs);return Qi===void 0||Qi.v!==hf});for(var[Ui,is]of ot)is.v!==hf&&!(Ui in a)&&Ni.push(Ui);return Ni},setPrototypeOf(){ZS()}})}function Hv(ze){var Je=ig|dx,ot=Gh!==null&&(Gh.f&ig)!==0?Gh:null;return fh===null||ot!==null&&(ot.f&tg)!==0?Je|=tg:fh.f|=Bw,{ctx:Pc,deps:null,effects:null,equals:Nw,f:Je,fn:ze,reactions:null,rv:0,v:hf,wv:0,parent:ot??fh,ac:null}}function Xv(ze){const Je=Hv(ze);return Je.equals=Vw,Je}function jw(ze){var Je=ze.effects;if(Je!==null){ze.effects=null;for(var ot=0;ot<Je.length;ot+=1)ux(Je[ot])}}function pM(ze){for(var Je=ze.parent;Je!==null;){if((Je.f&ig)===0)return Je;Je=Je.parent}return null}function Hb(ze){var Je,ot=fh;S0(pM(ze));try{jw(ze),Je=lT(ze)}finally{S0(ot)}return Je}function Gw(ze){var Je=Hb(ze);if(ze.equals(Je)||(ze.v=Je,ze.wv=nT()),!t_){var ot=(e_||(ze.f&tg)!==0)&&ze.deps!==null?s_:sg;Fy(ze,ot)}}const L_=new Map;function w0(ze,Je){var ot={f:0,v:ze,reactions:null,equals:Nw,rv:0,wv:0};return ot}function Jx(ze,Je){const ot=w0(ze);return SM(ot),ot}function jh(ze,Je=!1,ot=!0){var Qt;const Ht=w0(ze);return Je||(Ht.equals=Vw),A0&&ot&&Pc!==null&&Pc.l!==null&&((Qt=Pc.l).s??(Qt.s=[])).push(Ht),Ht}function Lv(ze,Je){return Jn(ze,r_(()=>Sr(ze))),Je}function Jn(ze,Je,ot=!1){Gh!==null&&(!Ry||(Gh.f&pw)!==0)&&Wv()&&(Gh.f&(ig|jv|pw))!==0&&!(Wf!=null&&Wf.includes(ze))&&KS();let Ht=ot?v0(Je):Je;return kb(ze,Ht)}function kb(ze,Je){if(!ze.equals(Je)){var ot=ze.v;t_?L_.set(ze,Je):L_.set(ze,ot),ze.v=Je,(ze.f&ig)!==0&&((ze.f&dx)!==0&&Hb(ze),Fy(ze,(ze.f&tg)===0?sg:s_)),ze.wv=nT(),Ww(ze,dx),Wv()&&fh!==null&&(fh.f&sg)!==0&&(fh.f&(px|M0))===0&&(Eg===null?MM([ze]):Eg.push(ze))}return Je}function Tb(ze){Jn(ze,ze.v+1)}function Ww(ze,Je){var ot=ze.reactions;if(ot!==null)for(var Ht=Wv(),Qt=ot.length,ni=0;ni<Qt;ni++){var Vi=ot[ni],a=Vi.f;(a&dx)===0&&(!Ht&&Vi===fh||(Fy(Vi,Je),(a&(sg|tg))!==0&&((a&ig)!==0?Ww(Vi,s_):Kv(Vi))))}}let fM=!1;var mw,Hw,Xw,Yw;function mM(){if(mw===void 0){mw=window,Hw=/Firefox/.test(navigator.userAgent);var ze=Element.prototype,Je=Node.prototype,ot=Text.prototype;Xw=b0(Je,"firstChild").get,Yw=b0(Je,"nextSibling").get,uw(ze)&&(ze.__click=void 0,ze.__className=void 0,ze.__attributes=null,ze.__style=void 0,ze.__e=void 0),uw(ot)&&(ot.__t=void 0)}}function $w(ze=""){return document.createTextNode(ze)}function Ov(ze){return Xw.call(ze)}function Yv(ze){return Yw.call(ze)}function ah(ze,Je){return Ov(ze)}function $v(ze,Je){{var ot=Ov(ze);return ot instanceof Comment&&ot.data===""?Yv(ot):ot}}function yl(ze,Je=1,ot=!1){let Ht=ze;for(;Je--;)Ht=Yv(Ht);return Ht}function gM(ze){ze.textContent=""}function qw(ze){fh===null&&Gh===null&&XS(),Gh!==null&&(Gh.f&tg)!==0&&fh===null&&HS(),t_&&WS()}function yM(ze,Je){var ot=Je.last;ot===null?Je.last=Je.first=ze:(ot.next=ze,ze.prev=ot,Je.last=ze)}function z_(ze,Je,ot,Ht=!0){var Qt=fh,ni={ctx:Pc,deps:null,nodes_start:null,nodes_end:null,f:ze|dx,first:null,fn:Je,last:null,next:null,parent:Qt,b:Qt&&Qt.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(ot)try{Zv(ni),ni.f|=Vb}catch(Ni){throw ux(ni),Ni}else Je!==null&&Kv(ni);var Vi=ot&&ni.deps===null&&ni.first===null&&ni.nodes_start===null&&ni.teardown===null&&(ni.f&(Bw|Nb))===0;if(!Vi&&Ht&&(Qt!==null&&yM(ni,Qt),Gh!==null&&(Gh.f&ig)!==0)){var a=Gh;(a.effects??(a.effects=[])).push(ni)}return ni}function Eb(ze){if(qw(),!Gh&&fh&&(fh.f&px)!==0){var Je=Pc;(Je.e??(Je.e=[])).push(ze)}else return Zw(ze)}function Zw(ze){return z_(Fb|Ub,ze,!1)}function xM(ze){return qw(),z_(Uv|Ub,ze,!0)}function _M(ze){const Je=z_(M0,ze,!0);return(ot={})=>new Promise(Ht=>{ot.outro?Dv(Je,()=>{ux(Je),Ht(void 0)}):(ux(Je),Ht(void 0))})}function Kw(ze){return z_(Fb,ze,!1)}function Jw(ze,Je){var ot=Pc,Ht={effect:null,ran:!1};ot.l.r1.push(Ht),Ht.effect=Xb(()=>{ze(),!Ht.ran&&(Ht.ran=!0,Jn(ot.l.r2,!0),r_(Je))})}function Qw(){var ze=Pc;Xb(()=>{if(Sr(ze.l.r2)){for(var Je of ze.l.r1){var ot=Je.effect;(ot.f&sg)!==0&&Fy(ot,s_),sv(ot)&&Zv(ot),Je.ran=!1}ze.l.r2.v=!1}})}function Xb(ze){return z_(Uv,ze,!0)}function k0(ze,Je=[],ot=Hv){const Ht=Je.map(ot);return qv(()=>ze(...Ht.map(Sr)))}function qv(ze,Je=0){var ot=z_(Uv|jv|Je,ze,!0);return ot}function T0(ze,Je=!0){return z_(Uv|px,ze,!0,Je)}function eT(ze){var Je=ze.teardown;if(Je!==null){const ot=t_,Ht=Gh;gw(!0),i_(null);try{Je.call(null)}finally{gw(ot),i_(Ht)}}}function tT(ze,Je=!1){var Qt;var ot=ze.first;for(ze.first=ze.last=null;ot!==null;){(Qt=ot.ac)==null||Qt.abort(Fw);var Ht=ot.next;(ot.f&M0)!==0?ot.parent=null:ux(ot,Je),ot=Ht}}function vM(ze){for(var Je=ze.first;Je!==null;){var ot=Je.next;(Je.f&px)===0&&ux(Je),Je=ot}}function ux(ze,Je=!0){var ot=!1;(Je||(ze.f&VS)!==0)&&ze.nodes_start!==null&&ze.nodes_end!==null&&(bM(ze.nodes_start,ze.nodes_end),ot=!0),tT(ze,Je&&!ot),Nv(ze,0),Fy(ze,Gv);var Ht=ze.transitions;if(Ht!==null)for(const ni of Ht)ni.stop();eT(ze);var Qt=ze.parent;Qt!==null&&Qt.first!==null&&iT(ze),ze.next=ze.prev=ze.teardown=ze.ctx=ze.deps=ze.fn=ze.nodes_start=ze.nodes_end=ze.ac=null}function bM(ze,Je){for(;ze!==null;){var ot=ze===Je?null:Yv(ze);ze.remove(),ze=ot}}function iT(ze){var Je=ze.parent,ot=ze.prev,Ht=ze.next;ot!==null&&(ot.next=Ht),Ht!==null&&(Ht.prev=ot),Je!==null&&(Je.first===ze&&(Je.first=Ht),Je.last===ze&&(Je.last=ot))}function Dv(ze,Je){var ot=[];Yb(ze,ot,!0),sT(ot,()=>{ux(ze),Je&&Je()})}function sT(ze,Je){var ot=ze.length;if(ot>0){var Ht=()=>--ot||Je();for(var Qt of ze)Qt.out(Ht)}else Je()}function Yb(ze,Je,ot){if((ze.f&cx)===0){if(ze.f^=cx,ze.transitions!==null)for(const Vi of ze.transitions)(Vi.is_global||ot)&&Je.push(Vi);for(var Ht=ze.first;Ht!==null;){var Qt=Ht.next,ni=(Ht.f&iv)!==0||(Ht.f&px)!==0;Yb(Ht,Je,ni?ot:!1),Ht=Qt}}}function zv(ze){rT(ze,!0)}function rT(ze,Je){if((ze.f&cx)!==0){ze.f^=cx;for(var ot=ze.first;ot!==null;){var Ht=ot.next,Qt=(ot.f&iv)!==0||(ot.f&px)!==0;rT(ot,Qt?Je:!1),ot=Ht}if(ze.transitions!==null)for(const ni of ze.transitions)(ni.is_global||Je)&&ni.in()}}let Rv=[];function wM(){var ze=Rv;Rv=[],Mb(ze)}function $b(ze){Rv.length===0&&queueMicrotask(wM),Rv.push(ze)}function TM(ze){var Je=fh;if((Je.f&Vb)===0){if((Je.f&Nb)===0)throw ze;Je.fn(ze)}else oT(ze,Je)}function oT(ze,Je){for(;Je!==null;){if((Je.f&Nb)!==0)try{Je.b.error(ze);return}catch{}Je=Je.parent}throw ze}let Cb=!1,Bv=null,O_=!1,t_=!1;function gw(ze){t_=ze}let Mv=[];let Gh=null,Ry=!1;function i_(ze){Gh=ze}let fh=null;function S0(ze){fh=ze}let Wf=null;function SM(ze){Gh!==null&&Gh.f&Ab&&(Wf===null?Wf=[ze]:Wf.push(ze))}let jf=null,Qm=0,Eg=null;function MM(ze){Eg=ze}let Fv=1,ev=0,D_=ev;function yw(ze){D_=ze}let e_=!1;function nT(){return++Fv}function sv(ze){var Xs;var Je=ze.f;if((Je&dx)!==0)return!0;if((Je&s_)!==0){var ot=ze.deps,Ht=(Je&tg)!==0;if(ot!==null){var Qt,ni,Vi=(Je&Iv)!==0,a=Ht&&fh!==null&&!e_,Ni=ot.length;if(Vi||a){var Ui=ze,is=Ui.parent;for(Qt=0;Qt<Ni;Qt++)ni=ot[Qt],(Vi||!((Xs=ni==null?void 0:ni.reactions)!=null&&Xs.includes(Ui)))&&(ni.reactions??(ni.reactions=[])).push(Ui);Vi&&(Ui.f^=Iv),a&&is!==null&&(is.f&tg)===0&&(Ui.f^=tg)}for(Qt=0;Qt<Ni;Qt++)if(ni=ot[Qt],sv(ni)&&Gw(ni),ni.wv>ze.wv)return!0}(!Ht||fh!==null&&!e_)&&Fy(ze,sg)}return!1}function aT(ze,Je,ot=!0){var Ht=ze.reactions;if(Ht!==null&&!(Wf!=null&&Wf.includes(ze)))for(var Qt=0;Qt<Ht.length;Qt++){var ni=Ht[Qt];(ni.f&ig)!==0?aT(ni,Je,!1):Je===ni&&(ot?Fy(ni,dx):(ni.f&sg)!==0&&Fy(ni,s_),Kv(ni))}}function lT(ze){var zs;var Je=jf,ot=Qm,Ht=Eg,Qt=Gh,ni=e_,Vi=Wf,a=Pc,Ni=Ry,Ui=D_,is=ze.f;jf=null,Qm=0,Eg=null,e_=(is&tg)!==0&&(Ry||!O_||Gh===null),Gh=(is&(px|M0))===0?ze:null,Wf=null,fw(ze.ctx),Ry=!1,D_=++ev,ze.f|=Ab,ze.ac!==null&&(ze.ac.abort(Fw),ze.ac=null);try{var Xs=(0,ze.fn)(),Qi=ze.deps;if(jf!==null){var xs;if(Nv(ze,Qm),Qi!==null&&Qm>0)for(Qi.length=Qm+jf.length,xs=0;xs<jf.length;xs++)Qi[Qm+xs]=jf[xs];else ze.deps=Qi=jf;if(!e_||(is&ig)!==0&&ze.reactions!==null)for(xs=Qm;xs<Qi.length;xs++)((zs=Qi[xs]).reactions??(zs.reactions=[])).push(ze)}else Qi!==null&&Qm<Qi.length&&(Nv(ze,Qm),Qi.length=Qm);if(Wv()&&Eg!==null&&!Ry&&Qi!==null&&(ze.f&(ig|s_|dx))===0)for(xs=0;xs<Eg.length;xs++)aT(Eg[xs],ze);return Qt!==null&&Qt!==ze&&(ev++,Eg!==null&&(Ht===null?Ht=Eg:Ht.push(...Eg))),Xs}catch(hs){TM(hs)}finally{jf=Je,Qm=ot,Eg=Ht,Gh=Qt,e_=ni,Wf=Vi,fw(a),Ry=Ni,D_=Ui,ze.f^=Ab}}function AM(ze,Je){let ot=Je.reactions;if(ot!==null){var Ht=DS.call(ot,ze);if(Ht!==-1){var Qt=ot.length-1;Qt===0?ot=Je.reactions=null:(ot[Ht]=ot[Qt],ot.pop())}}ot===null&&(Je.f&ig)!==0&&(jf===null||!jf.includes(Je))&&(Fy(Je,s_),(Je.f&(tg|Iv))===0&&(Je.f^=Iv),jw(Je),Nv(Je,0))}function Nv(ze,Je){var ot=ze.deps;if(ot!==null)for(var Ht=Je;Ht<ot.length;Ht++)AM(ze,ot[Ht])}function Zv(ze){var Je=ze.f;if((Je&Gv)===0){Fy(ze,sg);var ot=fh,Ht=O_;fh=ze,O_=!0;try{(Je&jv)!==0?vM(ze):tT(ze),eT(ze);var Qt=lT(ze);ze.teardown=typeof Qt=="function"?Qt:null,ze.wv=Fv;var ni;dw&&JS&&(ze.f&dx)!==0&&ze.deps}finally{O_=Ht,fh=ot}}}function kM(){try{YS()}catch(ze){if(Bv!==null)oT(ze,Bv);else throw ze}}function EM(){var ze=O_;try{var Je=0;for(O_=!0;Mv.length>0;){Je++>1e3&&kM();var ot=Mv,Ht=ot.length;Mv=[];for(var Qt=0;Qt<Ht;Qt++){var ni=PM(ot[Qt]);CM(ni)}L_.clear()}}finally{Cb=!1,O_=ze,Bv=null}}function CM(ze){var Je=ze.length;if(Je!==0){for(var ot=0;ot<Je;ot++){var Ht=ze[ot];if((Ht.f&(Gv|cx))===0&&sv(Ht)){var Qt=Fv;if(Zv(Ht),Ht.deps===null&&Ht.first===null&&Ht.nodes_start===null&&(Ht.teardown===null?iT(Ht):Ht.fn=null),Fv>Qt&&(Ht.f&Ub)!==0)break}}for(;ot<Je;ot+=1)Kv(ze[ot])}}function Kv(ze){Cb||(Cb=!0,queueMicrotask(EM));for(var Je=Bv=ze;Je.parent!==null;){Je=Je.parent;var ot=Je.f;if((ot&(M0|px))!==0){if((ot&sg)===0)return;Je.f^=sg}}Mv.push(Je)}function PM(ze){for(var Je=[],ot=ze;ot!==null;){var Ht=ot.f,Qt=(Ht&(px|M0))!==0,ni=Qt&&(Ht&sg)!==0;if(!ni&&(Ht&cx)===0){(Ht&Fb)!==0?Je.push(ot):Qt?ot.f^=sg:sv(ot)&&Zv(ot);var Vi=ot.first;if(Vi!==null){ot=Vi;continue}}var a=ot.parent;for(ot=ot.next;ot===null&&a!==null;)ot=a.next,a=a.parent}return Je}function Sr(ze){var Je=ze.f,ot=(Je&ig)!==0;if(Gh!==null&&!Ry){if(!(Wf!=null&&Wf.includes(ze))){var Ht=Gh.deps;ze.rv<ev&&(ze.rv=ev,jf===null&&Ht!==null&&Ht[Qm]===ze?Qm++:jf===null?jf=[ze]:(!e_||!jf.includes(ze))&&jf.push(ze))}}else if(ot&&ze.deps===null&&ze.effects===null){var Qt=ze,ni=Qt.parent;ni!==null&&(ni.f&tg)===0&&(Qt.f^=tg)}if(ot&&!t_&&(Qt=ze,sv(Qt)&&Gw(Qt)),t_){if(L_.has(ze))return L_.get(ze);if(ot){Qt=ze;var Vi=Qt.v;return((Qt.f&sg)!==0||hT(Qt))&&(Vi=Hb(Qt)),L_.set(Qt,Vi),Vi}}return ze.v}function hT(ze){if(ze.v===hf)return!0;if(ze.deps===null)return!1;for(const Je of ze.deps)if(L_.has(Je)||(Je.f&ig)!==0&&hT(Je))return!0;return!1}function r_(ze){var Je=Ry;try{return Ry=!0,ze()}finally{Ry=Je}}const IM=-7169;function Fy(ze,Je){ze.f=ze.f&IM|Je}function Q0(ze){if(!(typeof ze!="object"||!ze||ze instanceof EventTarget)){if(I_ in ze)Pb(ze);else if(!Array.isArray(ze))for(let Je in ze){const ot=ze[Je];typeof ot=="object"&&ot&&I_ in ot&&Pb(ot)}}}function Pb(ze,Je=new Set){if(typeof ze=="object"&&ze!==null&&!(ze instanceof EventTarget)&&!Je.has(ze)){Je.add(ze),ze instanceof Date&&ze.getTime();for(let Ht in ze)try{Pb(ze[Ht],Je)}catch{}const ot=Bb(ze);if(ot!==Object.prototype&&ot!==Array.prototype&&ot!==Map.prototype&&ot!==Set.prototype&&ot!==Date.prototype){const Ht=Rw(ot);for(let Qt in Ht){const ni=Ht[Qt].get;if(ni)try{ni.call(ze)}catch{}}}}}const LM=["touchstart","touchmove"];function OM(ze){return LM.includes(ze)}function cT(ze){var Je=Gh,ot=fh;i_(null),S0(null);try{return ze()}finally{i_(Je),S0(ot)}}const DM=new Set,xw=new Set;function _v(ze){var Nr;var Je=this,ot=Je.ownerDocument,Ht=ze.type,Qt=((Nr=ze.composedPath)==null?void 0:Nr.call(ze))||[],ni=Qt[0]||ze.target,Vi=0,a=ze.__root;if(a){var Ni=Qt.indexOf(a);if(Ni!==-1&&(Je===document||Je===window)){ze.__root=Je;return}var Ui=Qt.indexOf(Je);if(Ui===-1)return;Ni<=Ui&&(Vi=Ni)}if(ni=Qt[Vi]||ze.target,ni!==Je){zS(ze,"currentTarget",{configurable:!0,get(){return ni||ot}});var is=Gh,Xs=fh;i_(null),S0(null);try{for(var Qi,xs=[];ni!==null;){var zs=ni.assignedSlot||ni.parentNode||ni.host||null;try{var hs=ni["__"+Ht];if(hs!=null&&(!ni.disabled||ze.target===ni))if(Vv(hs)){var[_r,...ar]=hs;_r.apply(ni,[ze,...ar])}else hs.call(ni,ze)}catch(Or){Qi?xs.push(Or):Qi=Or}if(ze.cancelBubble||zs===Je||zs===null)break;ni=zs}if(Qi){for(let Or of xs)queueMicrotask(()=>{throw Or});throw Qi}}finally{ze.__root=Je,delete ze.currentTarget,i_(is),S0(Xs)}}}function zM(ze){var Je=document.createElement("template");return Je.innerHTML=ze.replaceAll("<!>","<!---->"),Je.content}function _w(ze,Je){var ot=fh;ot.nodes_start===null&&(ot.nodes_start=ze,ot.nodes_end=Je)}function ua(ze,Je){var ot=(Je&cM)!==0,Ht=(Je&dM)!==0,Qt,ni=!ze.startsWith("<!>");return()=>{Qt===void 0&&(Qt=zM(ni?ze:"<!>"+ze),ot||(Qt=Ov(Qt)));var Vi=Ht||Hw?document.importNode(Qt,!0):Qt.cloneNode(!0);if(ot){var a=Ov(Vi),Ni=Vi.lastChild;_w(a,Ni)}else _w(Vi,Vi);return Vi}}function da(ze,Je){ze!==null&&ze.before(Je)}let Ib=!0;function Lb(ze,Je){var ot=Je==null?"":typeof Je=="object"?Je+"":Je;ot!==(ze.__t??(ze.__t=ze.nodeValue))&&(ze.__t=ot,ze.nodeValue=ot+"")}function RM(ze,Je){return BM(ze,Je)}const x0=new Map;function BM(ze,{target:Je,anchor:ot,props:Ht={},events:Qt,context:ni,intro:Vi=!0}){mM();var a=new Set,Ni=Xs=>{for(var Qi=0;Qi<Xs.length;Qi++){var xs=Xs[Qi];if(!a.has(xs)){a.add(xs);var zs=OM(xs);Je.addEventListener(xs,_v,{passive:zs});var hs=x0.get(xs);hs===void 0?(document.addEventListener(xs,_v,{passive:zs}),x0.set(xs,1)):x0.set(xs,hs+1)}}};Ni(Rb(DM)),xw.add(Ni);var Ui=void 0,is=_M(()=>{var Xs=ot??Je.appendChild($w());return T0(()=>{if(ni){fx({});var Qi=Pc;Qi.c=ni}Qt&&(Ht.$$events=Qt),Ib=Vi,Ui=ze(Xs,Ht)||{},Ib=!0,ni&&mx()}),()=>{var zs;for(var Qi of a){Je.removeEventListener(Qi,_v);var xs=x0.get(Qi);--xs===0?(document.removeEventListener(Qi,_v),x0.delete(Qi)):x0.set(Qi,xs)}xw.delete(Ni),Xs!==ot&&((zs=Xs.parentNode)==null||zs.removeChild(Xs))}});return FM.set(Ui,is),Ui}let FM=new WeakMap;function By(ze,Je,[ot,Ht]=[0,0]){var Qt=ze,ni=null,Vi=null,a=hf,Ni=ot>0?iv:0,Ui=!1;const is=(Qi,xs=!0)=>{Ui=!0,Xs(xs,Qi)},Xs=(Qi,xs)=>{a!==(a=Qi)&&(a?(ni?zv(ni):xs&&(ni=T0(()=>xs(Qt))),Vi&&Dv(Vi,()=>{Vi=null})):(Vi?zv(Vi):xs&&(Vi=T0(()=>xs(Qt,[ot+1,Ht]))),ni&&Dv(ni,()=>{ni=null})))};qv(()=>{Ui=!1,Je(is),Ui||Xs(null,null)},Ni)}function qb(ze,Je){return Je}function NM(ze,Je,ot,Ht){for(var Qt=[],ni=Je.length,Vi=0;Vi<ni;Vi++)Yb(Je[Vi].e,Qt,!0);var a=ni>0&&Qt.length===0&&ot!==null;if(a){var Ni=ot.parentNode;gM(Ni),Ni.append(ot),Ht.clear(),Qx(ze,Je[0].prev,Je[ni-1].next)}sT(Qt,()=>{for(var Ui=0;Ui<ni;Ui++){var is=Je[Ui];a||(Ht.delete(is.k),Qx(ze,is.prev,is.next)),ux(is.e,!a)}})}function Zb(ze,Je,ot,Ht,Qt,ni=null){var Vi=ze,a={flags:Je,items:new Map,first:null},Ni=(Je&Uw)!==0;if(Ni){var Ui=ze;Vi=Ui.appendChild($w())}var is=null,Xs=!1,Qi=Xv(()=>{var xs=ot();return Vv(xs)?xs:xs==null?[]:Rb(xs)});qv(()=>{var xs=Sr(Qi),zs=xs.length;Xs&&zs===0||(Xs=zs===0,VM(xs,a,Vi,Qt,Je,Ht,ot),ni!==null&&(zs===0?is?zv(is):is=T0(()=>ni(Vi)):is!==null&&Dv(is,()=>{is=null})),Sr(Qi))})}function VM(ze,Je,ot,Ht,Qt,ni,Vi){var pi,on,Io,Qn;var a=(Qt&eM)!==0,Ni=(Qt&(jb|Gb))!==0,Ui=ze.length,is=Je.items,Xs=Je.first,Qi=Xs,xs,zs=null,hs,_r=[],ar=[],Nr,Or,ir,fr;if(a)for(fr=0;fr<Ui;fr+=1)Nr=ze[fr],Or=ni(Nr,fr),ir=is.get(Or),ir!==void 0&&((pi=ir.a)==null||pi.measure(),(hs??(hs=new Set)).add(ir));for(fr=0;fr<Ui;fr+=1){if(Nr=ze[fr],Or=ni(Nr,fr),ir=is.get(Or),ir===void 0){var wo=Qi?Qi.e.nodes_start:ot;zs=jM(wo,Je,zs,zs===null?Je.first:zs.next,Nr,Or,fr,Ht,Qt,Vi),is.set(Or,zs),_r=[],ar=[],Qi=zs.next;continue}if(Ni&&UM(ir,Nr,fr,Qt),(ir.e.f&cx)!==0&&(zv(ir.e),a&&((on=ir.a)==null||on.unfix(),(hs??(hs=new Set)).delete(ir))),ir!==Qi){if(xs!==void 0&&xs.has(ir)){if(_r.length<ar.length){var rn=ar[0],Pi;zs=rn.prev;var fo=_r[0],pl=_r[_r.length-1];for(Pi=0;Pi<_r.length;Pi+=1)vw(_r[Pi],rn,ot);for(Pi=0;Pi<ar.length;Pi+=1)xs.delete(ar[Pi]);Qx(Je,fo.prev,pl.next),Qx(Je,zs,fo),Qx(Je,pl,rn),Qi=rn,zs=pl,fr-=1,_r=[],ar=[]}else xs.delete(ir),vw(ir,Qi,ot),Qx(Je,ir.prev,ir.next),Qx(Je,ir,zs===null?Je.first:zs.next),Qx(Je,zs,ir),zs=ir;continue}for(_r=[],ar=[];Qi!==null&&Qi.k!==Or;)(Qi.e.f&cx)===0&&(xs??(xs=new Set)).add(Qi),ar.push(Qi),Qi=Qi.next;if(Qi===null)continue;ir=Qi}_r.push(ir),zs=ir,Qi=ir.next}if(Qi!==null||xs!==void 0){for(var Cs=xs===void 0?[]:Rb(xs);Qi!==null;)(Qi.e.f&cx)===0&&Cs.push(Qi),Qi=Qi.next;var Da=Cs.length;if(Da>0){var No=(Qt&Uw)!==0&&Ui===0?ot:null;if(a){for(fr=0;fr<Da;fr+=1)(Io=Cs[fr].a)==null||Io.measure();for(fr=0;fr<Da;fr+=1)(Qn=Cs[fr].a)==null||Qn.fix()}NM(Je,Cs,No,is)}}a&&$b(()=>{var fi;if(hs!==void 0)for(ir of hs)(fi=ir.a)==null||fi.apply()}),fh.first=Je.first&&Je.first.e,fh.last=zs&&zs.e}function UM(ze,Je,ot,Ht){(Ht&jb)!==0&&kb(ze.v,Je),(Ht&Gb)!==0?kb(ze.i,ot):ze.i=ot}function jM(ze,Je,ot,Ht,Qt,ni,Vi,a,Ni,Ui){var is=(Ni&jb)!==0,Xs=(Ni&tM)===0,Qi=is?Xs?jh(Qt,!1,!1):w0(Qt):Qt,xs=(Ni&Gb)===0?Vi:w0(Vi),zs={i:xs,v:Qi,k:ni,a:null,e:null,prev:ot,next:Ht};try{return zs.e=T0(()=>a(ze,Qi,xs,Ui),fM),zs.e.prev=ot&&ot.e,zs.e.next=Ht&&Ht.e,ot===null?Je.first=zs:(ot.next=zs,ot.e.next=zs.e),Ht!==null&&(Ht.prev=zs,Ht.e.prev=zs.e),zs}finally{}}function vw(ze,Je,ot){for(var Ht=ze.next?ze.next.e.nodes_start:ot,Qt=Je?Je.e.nodes_start:ot,ni=ze.e.nodes_start;ni!==Ht;){var Vi=Yv(ni);Qt.before(ni),ni=Vi}}function Qx(ze,Je,ot){Je===null?ze.first=ot:(Je.next=ot,Je.e.next=ot&&ot.e),ot!==null&&(ot.prev=Je,ot.e.prev=Je&&Je.e)}function GM(ze,Je,ot,Ht,Qt){var a;var ni=(a=Je.$$slots)==null?void 0:a[ot],Vi=!1;ni===!0&&(ni=Je.children,Vi=!0),ni===void 0||ni(ze,Vi?()=>Ht:Ht)}function Ob(ze,Je,...ot){var Ht=ze,Qt=_0,ni;qv(()=>{Qt!==(Qt=Je())&&(ni&&(ux(ni),ni=null),ni=T0(()=>Qt(Ht,...ot)))},iv)}const bw=[...` 	
\r\f \v\uFEFF`];function WM(ze,Je,ot){var Ht=ze==null?"":""+ze;if(Je&&(Ht=Ht?Ht+" "+Je:Je),ot){for(var Qt in ot)if(ot[Qt])Ht=Ht?Ht+" "+Qt:Qt;else if(Ht.length)for(var ni=Qt.length,Vi=0;(Vi=Ht.indexOf(Qt,Vi))>=0;){var a=Vi+ni;(Vi===0||bw.includes(Ht[Vi-1]))&&(a===Ht.length||bw.includes(Ht[a]))?Ht=(Vi===0?"":Ht.substring(0,Vi))+Ht.substring(a+1):Vi=a}}return Ht===""?null:Ht}function HM(ze,Je){return ze==null?null:String(ze)}function tv(ze,Je,ot,Ht,Qt,ni){var Vi=ze.__className;if(Vi!==ot||Vi===void 0){var a=WM(ot,Ht,ni);a==null?ze.removeAttribute("class"):ze.className=a,ze.__className=ot}else if(ni&&Qt!==ni)for(var Ni in ni){var Ui=!!ni[Ni];(Qt==null||Ui!==!!Qt[Ni])&&ze.classList.toggle(Ni,Ui)}return ni}function Kb(ze,Je,ot,Ht){var Qt=ze.__style;if(Qt!==Je){var ni=HM(Je);ni==null?ze.removeAttribute("style"):ze.style.cssText=ni,ze.__style=Je}return Ht}const XM=Symbol("is custom element"),YM=Symbol("is html");function Db(ze,Je,ot,Ht){var Qt=$M(ze);Qt[Je]!==(Qt[Je]=ot)&&(Je==="loading"&&(ze[jS]=ot),ot==null?ze.removeAttribute(Je):typeof ot!="string"&&qM(ze).includes(Je)?ze[Je]=ot:ze.setAttribute(Je,ot))}function $M(ze){return ze.__attributes??(ze.__attributes={[XM]:ze.nodeName.includes("-"),[YM]:ze.namespaceURI===uM})}var ww=new Map;function qM(ze){var Je=ww.get(ze.nodeName);if(Je)return Je;ww.set(ze.nodeName,Je=[]);for(var ot,Ht=ze,Qt=Element.prototype;Qt!==Ht;){ot=Rw(Ht);for(var ni in ot)ot[ni].set&&Je.push(ni);Ht=Bb(Ht)}return Je}const ZM=()=>performance.now(),hx={tick:ze=>requestAnimationFrame(ze),now:()=>ZM(),tasks:new Set};function dT(){const ze=hx.now();hx.tasks.forEach(Je=>{Je.c(ze)||(hx.tasks.delete(Je),Je.f())}),hx.tasks.size!==0&&hx.tick(dT)}function KM(ze){let Je;return hx.tasks.size===0&&hx.tick(dT),{promise:new Promise(ot=>{hx.tasks.add(Je={c:ze,f:ot})}),abort(){hx.tasks.delete(Je)}}}function vv(ze,Je){cT(()=>{ze.dispatchEvent(new CustomEvent(Je))})}function JM(ze){if(ze==="float")return"cssFloat";if(ze==="offset")return"cssOffset";if(ze.startsWith("--"))return ze;const Je=ze.split("-");return Je.length===1?Je[0]:Je[0]+Je.slice(1).map(ot=>ot[0].toUpperCase()+ot.slice(1)).join("")}function Tw(ze){const Je={},ot=ze.split(";");for(const Ht of ot){const[Qt,ni]=Ht.split(":");if(!Qt||ni===void 0)break;const Vi=JM(Qt.trim());Je[Vi]=ni.trim()}return Je}const QM=ze=>ze;function Sw(ze,Je,ot,Ht){var Qt=(ze&aM)!==0,ni=(ze&lM)!==0,Vi=Qt&&ni,a=(ze&hM)!==0,Ni=Vi?"both":Qt?"in":"out",Ui,is=Je.inert,Xs=Je.style.overflow,Qi,xs;function zs(){return cT(()=>Ui??(Ui=ot()(Je,(Ht==null?void 0:Ht())??{},{direction:Ni})))}var hs={is_global:a,in(){var Or;if(Je.inert=is,!Qt){xs==null||xs.abort(),(Or=xs==null?void 0:xs.reset)==null||Or.call(xs);return}ni||Qi==null||Qi.abort(),vv(Je,"introstart"),Qi=zb(Je,zs(),xs,1,()=>{vv(Je,"introend"),Qi==null||Qi.abort(),Qi=Ui=void 0,Je.style.overflow=Xs})},out(Or){if(!ni){Or==null||Or(),Ui=void 0;return}Je.inert=!0,vv(Je,"outrostart"),xs=zb(Je,zs(),Qi,0,()=>{vv(Je,"outroend"),Or==null||Or()})},stop:()=>{Qi==null||Qi.abort(),xs==null||xs.abort()}},_r=fh;if((_r.transitions??(_r.transitions=[])).push(hs),Qt&&Ib){var ar=a;if(!ar){for(var Nr=_r.parent;Nr&&(Nr.f&iv)!==0;)for(;(Nr=Nr.parent)&&(Nr.f&jv)===0;);ar=!Nr||(Nr.f&Vb)!==0}ar&&Kw(()=>{r_(()=>hs.in())})}}function zb(ze,Je,ot,Ht,Qt){var ni=Ht===1;if(FS(Je)){var Vi,a=!1;return $b(()=>{if(!a){var _r=Je({direction:ni?"in":"out"});Vi=zb(ze,_r,ot,Ht,Qt)}}),{abort:()=>{a=!0,Vi==null||Vi.abort()},deactivate:()=>Vi.deactivate(),reset:()=>Vi.reset(),t:()=>Vi.t()}}if(ot==null||ot.deactivate(),!(Je!=null&&Je.duration))return Qt(),{abort:_0,deactivate:_0,reset:_0,t:()=>Ht};const{delay:Ni=0,css:Ui,tick:is,easing:Xs=QM}=Je;var Qi=[];if(ni&&ot===void 0&&(is&&is(0,1),Ui)){var xs=Tw(Ui(0,1));Qi.push(xs,xs)}var zs=()=>1-Ht,hs=ze.animate(Qi,{duration:Ni,fill:"forwards"});return hs.onfinish=()=>{hs.cancel();var _r=(ot==null?void 0:ot.t())??1-Ht;ot==null||ot.abort();var ar=Ht-_r,Nr=Je.duration*Math.abs(ar),Or=[];if(Nr>0){var ir=!1;if(Ui)for(var fr=Math.ceil(Nr/16.666666666666668),wo=0;wo<=fr;wo+=1){var rn=_r+ar*Xs(wo/fr),Pi=Tw(Ui(rn,1-rn));Or.push(Pi),ir||(ir=Pi.overflow==="hidden")}ir&&(ze.style.overflow="hidden"),zs=()=>{var fo=hs.currentTime;return _r+ar*Xs(fo/Nr)},is&&KM(()=>{if(hs.playState!=="running")return!1;var fo=zs();return is(fo,1-fo),!0})}hs=ze.animate(Or,{duration:Nr,fill:"forwards"}),hs.onfinish=()=>{zs=()=>Ht,is==null||is(Ht,1-Ht),Qt()}},{abort:()=>{hs&&(hs.cancel(),hs.effect=null,hs.onfinish=_0)},deactivate:()=>{Qt=_0},reset:()=>{Ht===0&&(is==null||is(1,0))},t:()=>zs()}}function Mw(ze,Je){return ze===Je||(ze==null?void 0:ze[I_])===Je}function Gf(ze={},Je,ot,Ht){return Kw(()=>{var Qt,ni;return Xb(()=>{Qt=ni,ni=(Ht==null?void 0:Ht())||[],r_(()=>{ze!==ot(...ni)&&(Je(ze,...ni),Qt&&Mw(ot(...Qt),ze)&&Je(null,...Qt))})}),()=>{$b(()=>{ni&&Mw(ot(...ni),ze)&&Je(null,...ni)})}}),ze}function o_(ze=!1){const Je=Pc,ot=Je.l.u;if(!ot)return;let Ht=()=>Q0(Je.s);if(ze){let Qt=0,ni={};const Vi=Hv(()=>{let a=!1;const Ni=Je.s;for(const Ui in Ni)Ni[Ui]!==ni[Ui]&&(ni[Ui]=Ni[Ui],a=!0);return a&&Qt++,Qt});Ht=()=>Sr(Vi)}ot.b.length&&xM(()=>{Aw(Je,Ht),Mb(ot.b)}),Eb(()=>{const Qt=r_(()=>ot.m.map(NS));return()=>{for(const ni of Qt)typeof ni=="function"&&ni()}}),ot.a.length&&Eb(()=>{Aw(Je,Ht),Mb(ot.a)})}function Aw(ze,Je){if(ze.l.s)for(const ot of ze.l.s)Sr(ot);Je()}function eA(ze){var Je=w0(0);return function(){return arguments.length===1?(Jn(Je,Sr(Je)+1),arguments[0]):(Sr(Je),ze())}}let bv=!1;function tA(ze){var Je=bv;try{return bv=!1,[ze(),bv]}finally{bv=Je}}function eg(ze,Je,ot,Ht){var Or;var Qt=!A0||(ot&sM)!==0,ni=(ot&oM)!==0,Vi=(ot&nM)!==0,a=Ht,Ni=!0,Ui=()=>(Ni&&(Ni=!1,a=Vi?r_(Ht):Ht),a),is;if(ni){var Xs=I_ in ze||US in ze;is=((Or=b0(ze,Je))==null?void 0:Or.set)??(Xs&&Je in ze?ir=>ze[Je]=ir:void 0)}var Qi,xs=!1;ni?[Qi,xs]=tA(()=>ze[Je]):Qi=ze[Je],Qi===void 0&&Ht!==void 0&&(Qi=Ui(),is&&(Qt&&$S(),is(Qi)));var zs;if(Qt?zs=()=>{var ir=ze[Je];return ir===void 0?Ui():(Ni=!0,ir)}:zs=()=>{var ir=ze[Je];return ir!==void 0&&(a=void 0),ir===void 0?a:ir},Qt&&(ot&rM)===0)return zs;if(is){var hs=ze.$$legacy;return function(ir,fr){return arguments.length>0?((!Qt||!fr||hs||xs)&&is(fr?zs():ir),ir):zs()}}var _r=!1,ar=((ot&iM)!==0?Hv:Xv)(()=>(_r=!1,zs()));ni&&Sr(ar);var Nr=fh;return function(ir,fr){if(arguments.length>0){const wo=fr?Sr(ar):Qt&&ni?v0(ir):ir;return Jn(ar,wo),_r=!0,a!==void 0&&(a=wo),ir}return t_&&_r||(Nr.f&Gv)!==0?ar.v:Sr(ar)}}function gx(ze){Pc===null&&Wb(),A0&&Pc.l!==null?oA(Pc).m.push(ze):Eb(()=>{const Je=r_(ze);if(typeof Je=="function")return Je})}function iA(ze){Pc===null&&Wb(),gx(()=>()=>r_(ze))}function sA(ze,Je,{bubbles:ot=!1,cancelable:Ht=!1}={}){return new CustomEvent(ze,{detail:Je,bubbles:ot,cancelable:Ht})}function rA(){const ze=Pc;return ze===null&&Wb(),(Je,ot,Ht)=>{var ni;const Qt=(ni=ze.s.$$events)==null?void 0:ni[Je];if(Qt){const Vi=Vv(Qt)?Qt.slice():[Qt],a=sA(Je,ot,Ht);for(const Ni of Vi)Ni.call(ze.x,a);return!a.defaultPrevented}return!0}}function oA(ze){var Je=ze.l;return Je.u??(Je.u={a:[],b:[],m:[]})}const nA="5";var zw;typeof window<"u"&&((zw=window.__svelte??(window.__svelte={})).v??(zw.v=new Set)).add(nA);QS();var wv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Jb(ze){return ze&&ze.__esModule&&Object.prototype.hasOwnProperty.call(ze,"default")?ze.default:ze}var Av={exports:{}},aA=Av.exports,kw;function lA(){return kw||(kw=1,function(ze,Je){(function(ot,Ht){ze.exports=Ht()})(aA,function(){var ot,Ht,Qt;function ni(a,Ni){if(!ot)ot=Ni;else if(!Ht)Ht=Ni;else{var Ui="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+ot+")(sharedChunk); ("+Ht+")(sharedChunk); self.onerror = null;",is={};ot(is),Qt=Ni(is),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(Qt.workerUrl=window.URL.createObjectURL(new Blob([Ui],{type:"text/javascript"})))}}ni(["exports"],function(a){var Ni=1e-6,Ui=typeof Float32Array<"u"?Float32Array:Array;function is(s,e){var i=e[0],o=e[1],h=e[2],f=e[3],g=i*f-h*o;return g?(s[0]=f*(g=1/g),s[1]=-o*g,s[2]=-h*g,s[3]=i*g,s):null}function Xs(){var s=new Ui(9);return Ui!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function Qi(s,e){var i=e[0],o=e[1],h=e[2],f=e[3],g=e[4],w=e[5],C=e[6],O=e[7],j=e[8];return s[0]=g*j-w*O,s[1]=h*O-o*j,s[2]=o*w-h*g,s[3]=w*C-f*j,s[4]=i*j-h*C,s[5]=h*f-i*w,s[6]=f*O-g*C,s[7]=o*C-i*O,s[8]=i*g-o*f,s}function xs(s,e,i){var o=e[0],h=e[1],f=e[2],g=e[3],w=e[4],C=e[5],O=e[6],j=e[7],W=e[8],K=i[0],oe=i[1],ue=i[2],be=i[3],ke=i[4],Fe=i[5],Qe=i[6],it=i[7],Se=i[8];return s[0]=K*o+oe*g+ue*O,s[1]=K*h+oe*w+ue*j,s[2]=K*f+oe*C+ue*W,s[3]=be*o+ke*g+Fe*O,s[4]=be*h+ke*w+Fe*j,s[5]=be*f+ke*C+Fe*W,s[6]=Qe*o+it*g+Se*O,s[7]=Qe*h+it*w+Se*j,s[8]=Qe*f+it*C+Se*W,s}function zs(){var s=new Ui(16);return Ui!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s}function hs(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function _r(s,e){var i=e[0],o=e[1],h=e[2],f=e[3],g=e[4],w=e[5],C=e[6],O=e[7],j=e[8],W=e[9],K=e[10],oe=e[11],ue=e[12],be=e[13],ke=e[14],Fe=e[15],Qe=i*w-o*g,it=i*C-h*g,Se=i*O-f*g,Xe=o*C-h*w,st=o*O-f*w,dt=h*O-f*C,Ot=j*be-W*ue,Pt=j*ke-K*ue,Dt=j*Fe-oe*ue,Jt=W*ke-K*be,yi=W*Fe-oe*be,$i=K*Fe-oe*ke,Ii=Qe*$i-it*yi+Se*Jt+Xe*Dt-st*Pt+dt*Ot;return Ii?(s[0]=(w*$i-C*yi+O*Jt)*(Ii=1/Ii),s[1]=(h*yi-o*$i-f*Jt)*Ii,s[2]=(be*dt-ke*st+Fe*Xe)*Ii,s[3]=(K*st-W*dt-oe*Xe)*Ii,s[4]=(C*Dt-g*$i-O*Pt)*Ii,s[5]=(i*$i-h*Dt+f*Pt)*Ii,s[6]=(ke*Se-ue*dt-Fe*it)*Ii,s[7]=(j*dt-K*Se+oe*it)*Ii,s[8]=(g*yi-w*Dt+O*Ot)*Ii,s[9]=(o*Dt-i*yi-f*Ot)*Ii,s[10]=(ue*st-be*Se+Fe*Qe)*Ii,s[11]=(W*Se-j*st-oe*Qe)*Ii,s[12]=(w*Pt-g*Jt-C*Ot)*Ii,s[13]=(i*Jt-o*Pt+h*Ot)*Ii,s[14]=(be*it-ue*Xe-ke*Qe)*Ii,s[15]=(j*Xe-W*it+K*Qe)*Ii,s):null}function ar(s,e,i){var o=e[0],h=e[1],f=e[2],g=e[3],w=e[4],C=e[5],O=e[6],j=e[7],W=e[8],K=e[9],oe=e[10],ue=e[11],be=e[12],ke=e[13],Fe=e[14],Qe=e[15],it=i[0],Se=i[1],Xe=i[2],st=i[3];return s[0]=it*o+Se*w+Xe*W+st*be,s[1]=it*h+Se*C+Xe*K+st*ke,s[2]=it*f+Se*O+Xe*oe+st*Fe,s[3]=it*g+Se*j+Xe*ue+st*Qe,s[4]=(it=i[4])*o+(Se=i[5])*w+(Xe=i[6])*W+(st=i[7])*be,s[5]=it*h+Se*C+Xe*K+st*ke,s[6]=it*f+Se*O+Xe*oe+st*Fe,s[7]=it*g+Se*j+Xe*ue+st*Qe,s[8]=(it=i[8])*o+(Se=i[9])*w+(Xe=i[10])*W+(st=i[11])*be,s[9]=it*h+Se*C+Xe*K+st*ke,s[10]=it*f+Se*O+Xe*oe+st*Fe,s[11]=it*g+Se*j+Xe*ue+st*Qe,s[12]=(it=i[12])*o+(Se=i[13])*w+(Xe=i[14])*W+(st=i[15])*be,s[13]=it*h+Se*C+Xe*K+st*ke,s[14]=it*f+Se*O+Xe*oe+st*Fe,s[15]=it*g+Se*j+Xe*ue+st*Qe,s}function Nr(s,e,i){var o,h,f,g,w,C,O,j,W,K,oe,ue,be=i[0],ke=i[1],Fe=i[2];return e===s?(s[12]=e[0]*be+e[4]*ke+e[8]*Fe+e[12],s[13]=e[1]*be+e[5]*ke+e[9]*Fe+e[13],s[14]=e[2]*be+e[6]*ke+e[10]*Fe+e[14],s[15]=e[3]*be+e[7]*ke+e[11]*Fe+e[15]):(h=e[1],f=e[2],g=e[3],w=e[4],C=e[5],O=e[6],j=e[7],W=e[8],K=e[9],oe=e[10],ue=e[11],s[0]=o=e[0],s[1]=h,s[2]=f,s[3]=g,s[4]=w,s[5]=C,s[6]=O,s[7]=j,s[8]=W,s[9]=K,s[10]=oe,s[11]=ue,s[12]=o*be+w*ke+W*Fe+e[12],s[13]=h*be+C*ke+K*Fe+e[13],s[14]=f*be+O*ke+oe*Fe+e[14],s[15]=g*be+j*ke+ue*Fe+e[15]),s}function Or(s,e,i){var o=i[0],h=i[1],f=i[2];return s[0]=e[0]*o,s[1]=e[1]*o,s[2]=e[2]*o,s[3]=e[3]*o,s[4]=e[4]*h,s[5]=e[5]*h,s[6]=e[6]*h,s[7]=e[7]*h,s[8]=e[8]*f,s[9]=e[9]*f,s[10]=e[10]*f,s[11]=e[11]*f,s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15],s}function ir(s,e,i){var o=Math.sin(i),h=Math.cos(i),f=e[4],g=e[5],w=e[6],C=e[7],O=e[8],j=e[9],W=e[10],K=e[11];return e!==s&&(s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[4]=f*h+O*o,s[5]=g*h+j*o,s[6]=w*h+W*o,s[7]=C*h+K*o,s[8]=O*h-f*o,s[9]=j*h-g*o,s[10]=W*h-w*o,s[11]=K*h-C*o,s}function fr(s,e,i){var o=Math.sin(i),h=Math.cos(i),f=e[0],g=e[1],w=e[2],C=e[3],O=e[8],j=e[9],W=e[10],K=e[11];return e!==s&&(s[4]=e[4],s[5]=e[5],s[6]=e[6],s[7]=e[7],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[0]=f*h-O*o,s[1]=g*h-j*o,s[2]=w*h-W*o,s[3]=C*h-K*o,s[8]=f*o+O*h,s[9]=g*o+j*h,s[10]=w*o+W*h,s[11]=C*o+K*h,s}function wo(s,e,i){var o=Math.sin(i),h=Math.cos(i),f=e[0],g=e[1],w=e[2],C=e[3],O=e[4],j=e[5],W=e[6],K=e[7];return e!==s&&(s[8]=e[8],s[9]=e[9],s[10]=e[10],s[11]=e[11],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[0]=f*h+O*o,s[1]=g*h+j*o,s[2]=w*h+W*o,s[3]=C*h+K*o,s[4]=O*h-f*o,s[5]=j*h-g*o,s[6]=W*h-w*o,s[7]=K*h-C*o,s}function rn(s,e){return s[0]=e[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=e[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=e[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Pi(s,e,i){var o,h,f,g=i[0],w=i[1],C=i[2],O=Math.hypot(g,w,C);return O<Ni?null:(g*=O=1/O,w*=O,C*=O,o=Math.sin(e),h=Math.cos(e),s[0]=g*g*(f=1-h)+h,s[1]=w*g*f+C*o,s[2]=C*g*f-w*o,s[3]=0,s[4]=g*w*f-C*o,s[5]=w*w*f+h,s[6]=C*w*f+g*o,s[7]=0,s[8]=g*C*f+w*o,s[9]=w*C*f-g*o,s[10]=C*C*f+h,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s)}function fo(s,e){var i=e[0],o=e[1],h=e[2],f=e[3],g=i+i,w=o+o,C=h+h,O=i*g,j=o*g,W=o*w,K=h*g,oe=h*w,ue=h*C,be=f*g,ke=f*w,Fe=f*C;return s[0]=1-W-ue,s[1]=j+Fe,s[2]=K-ke,s[3]=0,s[4]=j-Fe,s[5]=1-O-ue,s[6]=oe+be,s[7]=0,s[8]=K+ke,s[9]=oe-be,s[10]=1-O-W,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}Math.hypot||(Math.hypot=function(){for(var s=0,e=arguments.length;e--;)s+=arguments[e]*arguments[e];return Math.sqrt(s)});var pl=ar;function Cs(){var s=new Ui(3);return Ui!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function Da(s){var e=new Ui(3);return e[0]=s[0],e[1]=s[1],e[2]=s[2],e}function No(s){return Math.hypot(s[0],s[1],s[2])}function pi(s,e,i){var o=new Ui(3);return o[0]=s,o[1]=e,o[2]=i,o}function on(s,e,i){return s[0]=e[0]+i[0],s[1]=e[1]+i[1],s[2]=e[2]+i[2],s}function Io(s,e,i){return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],s}function Qn(s,e,i){return s[0]=e[0]*i[0],s[1]=e[1]*i[1],s[2]=e[2]*i[2],s}function fi(s,e,i){return s[0]=Math.min(e[0],i[0]),s[1]=Math.min(e[1],i[1]),s[2]=Math.min(e[2],i[2]),s}function xl(s,e,i){return s[0]=Math.max(e[0],i[0]),s[1]=Math.max(e[1],i[1]),s[2]=Math.max(e[2],i[2]),s}function gr(s,e,i){return s[0]=e[0]*i,s[1]=e[1]*i,s[2]=e[2]*i,s}function Kn(s,e,i,o){return s[0]=e[0]+i[0]*o,s[1]=e[1]+i[1]*o,s[2]=e[2]+i[2]*o,s}function za(s,e){var i=e[0]-s[0],o=e[1]-s[1],h=e[2]-s[2];return i*i+o*o+h*h}function Na(s){var e=s[0],i=s[1],o=s[2];return e*e+i*i+o*o}function Pl(s,e){return s[0]=-e[0],s[1]=-e[1],s[2]=-e[2],s}function Lo(s,e){var i=e[0],o=e[1],h=e[2],f=i*i+o*o+h*h;return f>0&&(f=1/Math.sqrt(f)),s[0]=e[0]*f,s[1]=e[1]*f,s[2]=e[2]*f,s}function Zo(s,e){return s[0]*e[0]+s[1]*e[1]+s[2]*e[2]}function pa(s,e,i){var o=e[0],h=e[1],f=e[2],g=i[0],w=i[1],C=i[2];return s[0]=h*C-f*w,s[1]=f*g-o*C,s[2]=o*w-h*g,s}function Ul(s,e,i,o){var h=e[0],f=e[1],g=e[2];return s[0]=h+o*(i[0]-h),s[1]=f+o*(i[1]-f),s[2]=g+o*(i[2]-g),s}function mo(s,e,i){var o=e[0],h=e[1],f=e[2],g=i[3]*o+i[7]*h+i[11]*f+i[15];return s[0]=(i[0]*o+i[4]*h+i[8]*f+i[12])/(g=g||1),s[1]=(i[1]*o+i[5]*h+i[9]*f+i[13])/g,s[2]=(i[2]*o+i[6]*h+i[10]*f+i[14])/g,s}function ql(s,e,i){var o=e[0],h=e[1],f=e[2];return s[0]=o*i[0]+h*i[3]+f*i[6],s[1]=o*i[1]+h*i[4]+f*i[7],s[2]=o*i[2]+h*i[5]+f*i[8],s}function Sh(s,e,i){var o=i[0],h=i[1],f=i[2],g=e[0],w=e[1],C=e[2],O=h*C-f*w,j=f*g-o*C,W=o*w-h*g,K=h*W-f*j,oe=f*O-o*W,ue=o*j-h*O,be=2*i[3];return j*=be,W*=be,oe*=2,ue*=2,s[0]=g+(O*=be)+(K*=2),s[1]=w+j+oe,s[2]=C+W+ue,s}function Wh(s,e){return s[0]===e[0]&&s[1]===e[1]&&s[2]===e[2]}var Qs=Io,Ic=Qn,_l=No;function qa(){var s=new Ui(4);return Ui!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0,s[3]=0),s}function Lc(s,e,i){return s[0]=e[0]*i,s[1]=e[1]*i,s[2]=e[2]*i,s[3]=e[3]*i,s}function wd(s,e){var i=e[0],o=e[1],h=e[2],f=e[3],g=i*i+o*o+h*h+f*f;return g>0&&(g=1/Math.sqrt(g)),s[0]=i*g,s[1]=o*g,s[2]=h*g,s[3]=f*g,s}function Ps(s,e,i){var o=e[0],h=e[1],f=e[2],g=e[3];return s[0]=i[0]*o+i[4]*h+i[8]*f+i[12]*g,s[1]=i[1]*o+i[5]*h+i[9]*f+i[13]*g,s[2]=i[2]*o+i[6]*h+i[10]*f+i[14]*g,s[3]=i[3]*o+i[7]*h+i[11]*f+i[15]*g,s}function nl(){var s=new Ui(4);return Ui!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function jl(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function Kc(s,e,i){i*=.5;var o=e[0],h=e[1],f=e[2],g=e[3],w=Math.sin(i),C=Math.cos(i);return s[0]=o*C+g*w,s[1]=h*C+f*w,s[2]=f*C-h*w,s[3]=g*C-o*w,s}function Gs(s,e,i){i*=.5;var o=e[0],h=e[1],f=e[2],g=e[3],w=Math.sin(i),C=Math.cos(i);return s[0]=o*C-f*w,s[1]=h*C+g*w,s[2]=f*C+o*w,s[3]=g*C-h*w,s}Cs(),qa();var zn,Gl,fc,al,Gd,Oc=wd,mh=(zn=Cs(),Gl=pi(1,0,0),fc=pi(0,1,0),function(s,e,i){var o=Zo(e,i);return o<-.999999?(pa(zn,Gl,e),_l(zn)<1e-6&&pa(zn,fc,e),Lo(zn,zn),function(h,f,g){g*=.5;var w=Math.sin(g);h[0]=w*f[0],h[1]=w*f[1],h[2]=w*f[2],h[3]=Math.cos(g)}(s,zn,Math.PI),s):o>.999999?(s[0]=0,s[1]=0,s[2]=0,s[3]=1,s):(pa(zn,e,i),s[0]=zn[0],s[1]=zn[1],s[2]=zn[2],s[3]=1+o,Oc(s,s))});function ll(){var s=new Ui(2);return Ui!=Float32Array&&(s[0]=0,s[1]=0),s}function Mh(s,e){var i=new Ui(2);return i[0]=s,i[1]=e,i}function Sa(s,e,i){return s[0]=e[0]+i[0],s[1]=e[1]+i[1],s}function Wl(s,e,i){return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s}function Tu(s,e,i){return s[0]=e[0]*i,s[1]=e[1]*i,s}function Jc(s){return Math.hypot(s[0],s[1])}function Td(s,e){var i=e[0],o=e[1],h=i*i+o*o;return h>0&&(h=1/Math.sqrt(h)),s[0]=e[0]*h,s[1]=e[1]*h,s}function To(s,e){return s[0]*e[0]+s[1]*e[1]}function Rn(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}nl(),nl(),Xs(),ll();var Za,Hl,mc=function(){if(Gd)return al;function s(e,i,o,h){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(h-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=h}return Gd=1,al=s,s.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,h=0;h<8;h++){var f=this.sampleCurveX(o)-e;if(Math.abs(f)<i)return o;var g=this.sampleCurveDerivativeX(o);if(Math.abs(g)<1e-6)break;o-=f/g}var w=0,C=1;for(o=e,h=0;h<20&&(f=this.sampleCurveX(o),!(Math.abs(f-e)<i));h++)e>f?w=o:C=o,o=.5*(C-w)+w;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},al}(),Va=Rn(mc);function Zl(){if(Hl)return Za;function s(e,i){this.x=e,this.y=i}return Hl=1,Za=s,s.prototype={clone:function(){return new s(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,i){return this.clone()._rotateAround(e,i)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var i=e.x-this.x,o=e.y-this.y;return i*i+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,i){return Math.atan2(this.x*i-this.y*e,this.x*e+this.y*i)},_matMult:function(e){var i=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=i,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var i=Math.cos(e),o=Math.sin(e),h=o*this.x+i*this.y;return this.x=i*this.x-o*this.y,this.y=h,this},_rotateAround:function(e,i){var o=Math.cos(e),h=Math.sin(e),f=i.y+h*(this.x-i.x)+o*(this.y-i.y);return this.x=i.x+o*(this.x-i.x)-h*(this.y-i.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},s.convert=function(e){return e instanceof s?e:Array.isArray(e)?new s(e[0],e[1]):e},Za}var Wi=Rn(Zl());function Ra(s,e){if(Array.isArray(s)){if(!Array.isArray(e)||s.length!==e.length)return!1;for(let i=0;i<s.length;i++)if(!Ra(s[i],e[i]))return!1;return!0}if(typeof s=="object"&&s!==null&&e!==null){if(typeof e!="object"||Object.keys(s).length!==Object.keys(e).length)return!1;for(const i in s)if(!Ra(s[i],e[i]))return!1;return!0}return s===e}const pp=Math.PI/180,vl=180/Math.PI;function lr(s){return s*pp}function ei(s){return s*vl}const Oe=[[0,0],[1,0],[1,1],[0,1]];function We(s){if(s<=0)return 0;if(s>=1)return 1;const e=s*s,i=e*s;return 4*(s<.5?i:3*(s-e)+i-.75)}function ct(s,e,i,o){const h=new Va(s,e,i,o);return function(f){return h.solve(f)}}const Et=ct(.25,.1,.25,1);function at(s,e,i){return Math.min(i,Math.max(e,s))}function zt(s,e,i){return(i=at((i-s)/(e-s),0,1))*i*(3-2*i)}function oi(s,e,i){const o=i-e,h=((s-e)%o+o)%o+e;return h===e?i:h}function jt(s,e,i){if(!s.length)return i(null,[]);let o=s.length;const h=new Array(s.length);let f=null;s.forEach((g,w)=>{e(g,(C,O)=>{C&&(f=C),h[w]=O,--o==0&&i(f,h)})})}function qt(s,...e){for(const i of e)for(const o in i)s[o]=i[o];return s}let gi=1;function li(){return gi++}function Zi(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function Ss(s,e){s.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function ds(s,e,i){const o={};for(const h in s)o[h]=e.call(this,s[h],h,s);return o}function Ws(s,e,i){const o={};for(const h in s)e.call(this,s[h],h,s)&&(o[h]=s[h]);return o}function mr(s){return Array.isArray(s)?s.map(mr):typeof s=="object"&&s?ds(s,mr):s}function vr(s,e){for(let i=0;i<s.length;i++)if(e.indexOf(s[i])>=0)return!0;return!1}const Rr={};function Ar(s){Rr[s]||(typeof console<"u"&&console.warn(s),Rr[s]=!0)}function Ko(s,e,i){return(i.y-s.y)*(e.x-s.x)>(e.y-s.y)*(i.x-s.x)}function to(s){let e=0;for(let i,o,h=0,f=s.length,g=f-1;h<f;g=h++)i=s[h],o=s[g],e+=(o.x-i.x)*(i.y+o.y);return e}function nn([s,e,i]){const o=lr(e+90),h=lr(i);return{x:s*Math.cos(o)*Math.sin(h),y:s*Math.sin(o)*Math.sin(h),z:s*Math.cos(h),azimuthal:e,polar:i}}function ao(s){return(typeof self<"u"||s!==void 0)&&typeof WorkerGlobalScope<"u"&&(s!==void 0?s:self)instanceof WorkerGlobalScope}function lo(s){const e={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,o,h,f)=>{const g=h||f;return e[o]=!g||g.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let Oo=null;function fn(s,e){return[s[4*e],s[4*e+1],s[4*e+2],s[4*e+3]]}function un(s,e,i,o){for(;e<i;){const h=e+i>>1;s[h]<o?e=h+1:i=h}return e}function Ka(s,e,i,o){for(;e<i;){const h=e+i>>1;s[h]<=o?e=h+1:i=h}return e}function an(s){return s>0?1/(1.001-s):1+s}function Il(s){return s>0?1-1/(1.001-s):-s}function Hh(s,e,i){return(s-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const Ua={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Ua.API_URL)return null;try{const s=new URL(Ua.API_URL);return s.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":s.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v0.3.0.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Xh(s){return Ua.API_URL_REGEX.test(s)}function fp(s){return Ua.API_SPRITE_REGEX.test(s)}let Gn,Yh,Sd,Wd,Wn,$u;function Ah(){return Gn==null&&(Gn=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Gn}const $h={now:()=>Wd!==void 0?Wd:performance.now(),setNow(s){Wd=s},restoreNow(){Wd=void 0},frame(s){const e=requestAnimationFrame(s);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(s,e=0){const{width:i,height:o}=s;Wn||(Wn=document.createElement("canvas"));const h=Wn.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(i>Wn.width||o>Wn.height)&&(Wn.width=i,Wn.height=o),h.clearRect(-e,-e,i+2*e,o+2*e),h.drawImage(s,0,0,i,o),h.getImageData(-e,-e,i+2*e,o+2*e)},resolveURL:s=>(Yh||(Yh=document.createElement("a")),Yh.href=s,Yh.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Sd==null&&(Sd=window.matchMedia("(prefers-reduced-motion: reduce)")),Sd.matches)},hasCanvasFingerprintNoise(){if($u!==void 0)return $u;if(!Ah())return $u=!1,!1;const s=new OffscreenCanvas(85,1),e=s.getContext("2d",{willReadFrequently:!0});let i=0;for(let h=0;h<s.width;++h)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(h,0,1,1);const o=e.getImageData(0,0,s.width,s.height);i=0;for(let h=0;h<o.data.length;++h)if(h%4!=3&&i++!==o.data[h])return $u=!0,!0;return $u=!1,!1}};function gh(s,e){const i=s.indexOf("?");if(i<0)return`${s}?${new URLSearchParams(e).toString()}`;const o=new URLSearchParams(s.slice(i));for(const h in e)o.set(h,e[h]);return`${s.slice(0,i)}?${o.toString()}`}function Kl(s,e={persistentParams:[]}){const i=s.indexOf("?");if(i<0)return s;const o=new URLSearchParams,h=new URLSearchParams(s.slice(i));for(const g of e.persistentParams){const w=h.get(g);w&&o.set(g,w)}const f=o.toString();return`${s.slice(0,i)}${f.length>0?`?${f}`:""}`}const Qc="mapbox-tiles";let Ma=500,yn=50;const Hd=["language","worldview","jobid"];let bl,qh;function Zh(){try{return caches}catch{}}function fa(){const s=Zh();s&&bl==null&&(bl=s.open(Qc))}let Xd=1/0;const qu={supported:!1,testSupport:function(s){!Bn&&ja&&(kh?mp(s):Ll=s)}};let Ll,ja,Bn=!1,kh=!1;const Xl=typeof self<"u"?self:{};function mp(s){const e=s.createTexture();s.bindTexture(s.TEXTURE_2D,e);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,ja),s.isContextLost())return;qu.supported=!0}catch{}s.deleteTexture(e),Bn=!0}Xl.document&&(ja=Xl.document.createElement("img"),ja.onload=function(){Ll&&mp(Ll),Ll=null,kh=!0},ja.onerror=function(){Bn=!0,Ll=null},ja.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Dc={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Dc);class Gr extends Error{constructor(e,i,o){i===401&&Xh(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Eh=ao()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Su=function(s,e){if(!(/^file:/.test(i=s.url)||/^file:/.test(Eh())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(o,h){const f=new AbortController,g=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:Eh(),referrerPolicy:o.referrerPolicy,signal:f.signal});let w=!1,C=!1;const O=(j=g.url).indexOf("sku=")>0&&Xh(j);var j;o.type==="json"&&g.headers.set("Accept","application/json");const W=(oe,ue,be)=>{if(C)return;if(oe&&oe.message!=="SecurityError"&&Ar(oe.toString()),ue&&be)return K(ue);const ke=Date.now();fetch(g).then(Fe=>{if(Fe.ok){const Qe=O?Fe.clone():null;return K(Fe,Qe,ke)}return h(new Gr(Fe.statusText,Fe.status,o.url))}).catch(Fe=>{Fe.name!=="AbortError"&&h(new Error(`${Fe.message} ${o.url}`))})},K=(oe,ue,be)=>{(o.type==="arrayBuffer"?oe.arrayBuffer():o.type==="json"?oe.json():oe.text()).then(ke=>{C||(ue&&be&&function(Fe,Qe,it){if(fa(),bl==null)return;const Se=lo(Qe.headers.get("Cache-Control")||"");if(Se["no-store"])return;const Xe={status:Qe.status,statusText:Qe.statusText,headers:new Headers};Qe.headers.forEach((Ot,Pt)=>Xe.headers.set(Pt,Ot)),Se["max-age"]&&Xe.headers.set("Expires",new Date(it+1e3*Se["max-age"]).toUTCString());const st=Xe.headers.get("Expires");if(!st||new Date(st).getTime()-it<42e4)return;let dt=Kl(Fe.url,{persistentParams:Hd});if(Qe.status===206){const Ot=Fe.headers.get("Range");if(!Ot)return;Xe.status=200,dt=gh(dt,{range:Ot})}(function(Ot,Pt){if(qh===void 0)try{new Response(new ReadableStream),qh=!0}catch{qh=!1}qh?Pt(Ot.body):Ot.blob().then(Pt).catch(Dt=>Ar(Dt.message))})(Qe,Ot=>{const Pt=new Response((Dt=Qe.status)!==200&&Dt!==404&&[101,103,204,205,304].includes(Dt)?null:Ot,Xe);var Dt;fa(),bl!=null&&bl.then(Jt=>Jt.put(dt,Pt)).catch(Jt=>Ar(Jt.message))})}(g,ue,be),w=!0,h(null,ke,oe.headers.get("Cache-Control"),oe.headers.get("Expires")))}).catch(ke=>{C||h(new Error(ke.message))})};return O?function(oe,ue){if(fa(),bl==null)return ue(null);bl.then(be=>{let ke=Kl(oe.url,{persistentParams:Hd});const Fe=oe.headers.get("Range");Fe&&(ke=gh(ke,{range:Fe})),be.match(ke).then(Qe=>{const it=function(Se){if(!Se)return!1;const Xe=new Date(Se.headers.get("Expires")||0),st=lo(Se.headers.get("Cache-Control")||"");return Number(Xe)>Date.now()&&!st["no-cache"]}(Qe);be.delete(ke).catch(ue),it&&be.put(ke,Qe.clone()).catch(ue),ue(null,Qe,it)}).catch(ue)}).catch(ue)}(g,W):W(null,null),{cancel:()=>{C=!0,w||f.abort()}}}(s,e);if(ao(self)&&self.worker.actor)return self.worker.actor.send("getResource",s,e,void 0,!0)}var i;return function(o,h){const f=new XMLHttpRequest;f.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(f.responseType="arraybuffer");for(const g in o.headers)f.setRequestHeader(g,o.headers[g]);return o.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=o.credentials==="include",f.onerror=()=>{h(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let g=f.response;if(o.type==="json")try{g=JSON.parse(f.response)}catch(w){return h(w)}h(null,g,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else h(new Gr(f.statusText,f.status,o.url))},f.send(o.body),{cancel:()=>f.abort()}}(s,e)},Ch=function(s,e){return Su(qt(s,{type:"arrayBuffer"}),e)};function cf(s){const e=document.createElement("a");return e.href=s,e.protocol===location.protocol&&e.host===location.host}const ma="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Mu,wl;Mu=[],wl=0;const ed=function(s,e){if(qu.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),wl>=Ua.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:s,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Mu.push(f),f}wl++;let i=!1;const o=()=>{if(!i)for(i=!0,wl--;Mu.length&&wl<Ua.MAX_PARALLEL_IMAGE_REQUESTS;){const f=Mu.shift(),{requestParameters:g,callback:w,cancelled:C}=f;C||(f.cancel=ed(g,w).cancel)}},h=Ch(s,(f,g,w,C)=>{o(),f?e(f):g&&(self.createImageBitmap?function(O,j){const W=new Blob([new Uint8Array(O)],{type:"image/png"});createImageBitmap(W).then(K=>{j(null,K)}).catch(K=>{j(new Error(`Could not load image because of ${K.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(O,j)=>e(O,j,w,C)):function(O,j){const W=new Image;W.onload=()=>{j(null,W),URL.revokeObjectURL(W.src),W.onload=null,requestAnimationFrame(()=>{W.src=ma})},W.onerror=()=>j(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const K=new Blob([new Uint8Array(O)],{type:"image/png"});W.src=O.byteLength?URL.createObjectURL(K):ma}(g,(O,j)=>e(O,j,w,C)))});return{cancel:()=>{h.cancel(),o()}}};var Yd,It,Fi,fs={exports:{}},Ir={exports:{}},Ga={exports:{}},xn=function(){if(Fi)return fs.exports;Fi=1;var s=(Yd||(Yd=1,Ir.exports=function(i,o){var h,f,g,w,C,O,j,W;for(f=i.length-(h=3&i.length),g=o,C=3432918353,O=461845907,W=0;W<f;)j=255&i.charCodeAt(W)|(255&i.charCodeAt(++W))<<8|(255&i.charCodeAt(++W))<<16|(255&i.charCodeAt(++W))<<24,++W,g=27492+(65535&(w=5*(65535&(g=(g^=j=(65535&(j=(j=(65535&j)*C+(((j>>>16)*C&65535)<<16)&4294967295)<<15|j>>>17))*O+(((j>>>16)*O&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(j=0,h){case 3:j^=(255&i.charCodeAt(W+2))<<16;case 2:j^=(255&i.charCodeAt(W+1))<<8;case 1:g^=j=(65535&(j=(j=(65535&(j^=255&i.charCodeAt(W)))*C+(((j>>>16)*C&65535)<<16)&4294967295)<<15|j>>>17))*O+(((j>>>16)*O&65535)<<16)&4294967295}return g^=i.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),Ir.exports),e=(It||(It=1,Ga.exports=function(i,o){for(var h,f=i.length,g=o^f,w=0;f>=4;)h=1540483477*(65535&(h=255&i.charCodeAt(w)|(255&i.charCodeAt(++w))<<8|(255&i.charCodeAt(++w))<<16|(255&i.charCodeAt(++w))<<24))+((1540483477*(h>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),f-=4,++w;switch(f){case 3:g^=(255&i.charCodeAt(w+2))<<16;case 2:g^=(255&i.charCodeAt(w+1))<<8;case 1:g=1540483477*(65535&(g^=255&i.charCodeAt(w)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),Ga.exports);return fs.exports=s,fs.exports.murmur3=s,fs.exports.murmur2=e,fs.exports}(),Ol=Rn(xn);class Ln{constructor(e,...i){qt(this,i[0]||{}),this.type=e}}class td extends Ln{constructor(e,i={}){super("error",qt({error:e},i))}}function id(s,e,i){i[s]&&i[s].indexOf(e)!==-1||(i[s]=i[s]||[],i[s].push(e))}function Au(s,e,i){if(i&&i[s]){const o=i[s].indexOf(e);o!==-1&&i[s].splice(o,1)}}class zc{on(e,i){return this._listeners=this._listeners||{},id(e,i,this._listeners),this}off(e,i){return Au(e,i,this._listeners),Au(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},id(e,i,this._oneTimeListeners),this):new Promise(o=>{this.once(e,o)})}fire(e,i){const o=typeof e=="string"?new Ln(e,i):e,h=o.type;if(this.listens(h)){o.target=this;const f=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const C of f)C.call(this,o);const g=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const C of g)Au(h,C,this._oneTimeListeners),C.call(this,o);const w=this._eventedParent;w&&(qt(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(o))}else o instanceof td&&console.error(o.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class fl{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new fl(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,o]=e.split("");return new fl({name:i,iconsetId:o})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return fl.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Hn,hl={},$d=function(){if(Hn)return hl;Hn=1;var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(f){return(f=Math.round(f))<0?0:f>255?255:f}function i(f){return e(f[f.length-1]==="%"?parseFloat(f)/100*255:parseInt(f))}function o(f){return(g=f[f.length-1]==="%"?parseFloat(f)/100:parseFloat(f))<0?0:g>1?1:g;var g}function h(f,g,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?f+(g-f)*w*6:2*w<1?g:3*w<2?f+(g-f)*(2/3-w)*6:f}try{hl.parseCSSColor=function(f){var g,w=f.replace(/ /g,"").toLowerCase();if(w in s)return s[w].slice();if(w[0]==="#")return w.length===4?(g=parseInt(w.substr(1),16))>=0&&g<=4095?[(3840&g)>>4|(3840&g)>>8,240&g|(240&g)>>4,15&g|(15&g)<<4,1]:null:w.length===7&&(g=parseInt(w.substr(1),16))>=0&&g<=16777215?[(16711680&g)>>16,(65280&g)>>8,255&g,1]:null;var C=w.indexOf("("),O=w.indexOf(")");if(C!==-1&&O+1===w.length){var j=w.substr(0,C),W=w.substr(C+1,O-(C+1)).split(","),K=1;switch(j){case"rgba":if(W.length!==4)return null;K=o(W.pop());case"rgb":return W.length!==3?null:[i(W[0]),i(W[1]),i(W[2]),K];case"hsla":if(W.length!==4)return null;K=o(W.pop());case"hsl":if(W.length!==3)return null;var oe=(parseFloat(W[0])%360+360)%360/360,ue=o(W[1]),be=o(W[2]),ke=be<=.5?be*(ue+1):be+ue-be*ue,Fe=2*be-ke;return[e(255*h(Fe,ke,oe+1/3)),e(255*h(Fe,ke,oe)),e(255*h(Fe,ke,oe-1/3)),K];default:return null}}return null}}catch{}return hl}();class So{constructor(e,i,o,h=1){this.r=e,this.g=i,this.b=o,this.a=h}static parse(e){if(!e)return;if(e instanceof So)return e;if(typeof e!="string")return;const i=$d.parseCSSColor(e);return i?new So(i[0]/255,i[1]/255,i[2]/255,i[3]):void 0}toString(){const[e,i,o,h]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*o)},${h})`}toNonPremultipliedRenderColor(e){const{r:i,g:o,b:h,a:f}=this;return new Md(e,i,o,h,f)}toPremultipliedRenderColor(e){const{r:i,g:o,b:h,a:f}=this;return new Ja(e,i*f,o*f,h*f,f)}clone(){return new So(this.r,this.g,this.b,this.a)}}class Dl{constructor(e,i,o,h,f,g=!1){if(this.premultiplied=!1,this.premultiplied=g,e){const w=e.image.height,C=w*w;this.premultiplied?(i=f===0?0:i/f*(w-1),o=f===0?0:o/f*(w-1),h=f===0?0:h/f*(w-1)):(i*=w-1,o*=w-1,h*=w-1);const O=Math.floor(i),j=Math.floor(o),W=Math.floor(h),K=Math.ceil(i),oe=Math.ceil(o),ue=Math.ceil(h),be=i-O,ke=o-j,Fe=h-W,Qe=e.image.data,it=4*(O+j*C+W*w),Se=4*(O+j*C+ue*w),Xe=4*(O+oe*C+W*w),st=4*(O+oe*C+ue*w),dt=4*(K+j*C+W*w),Ot=4*(K+j*C+ue*w),Pt=4*(K+oe*C+W*w),Dt=4*(K+oe*C+ue*w);if(it<0||Dt>=Qe.length)throw new Error("out of range");this.r=js(js(js(Qe[it],Qe[Se],Fe),js(Qe[Xe],Qe[st],Fe),ke),js(js(Qe[dt],Qe[Ot],Fe),js(Qe[Pt],Qe[Dt],Fe),ke),be)/255*(this.premultiplied?f:1),this.g=js(js(js(Qe[it+1],Qe[Se+1],Fe),js(Qe[Xe+1],Qe[st+1],Fe),ke),js(js(Qe[dt+1],Qe[Ot+1],Fe),js(Qe[Pt+1],Qe[Dt+1],Fe),ke),be)/255*(this.premultiplied?f:1),this.b=js(js(js(Qe[it+2],Qe[Se+2],Fe),js(Qe[Xe+2],Qe[st+2],Fe),ke),js(js(Qe[dt+2],Qe[Ot+2],Fe),js(Qe[Pt+2],Qe[Dt+2],Fe),ke),be)/255*(this.premultiplied?f:1),this.a=f}else this.r=i,this.g=o,this.b=h,this.a=f}toArray(){const{r:e,g:i,b:o,a:h}=this;return[255*e,255*i,255*o,h]}toHslaArray(){let{r:e,g:i,b:o,a:h}=this;if(this.premultiplied){if(h===0)return[0,0,0,0];e/=h,i/=h,o/=h}const f=Math.min(Math.max(e,0),1),g=Math.min(Math.max(i,0),1),w=Math.min(Math.max(o,0),1),C=Math.min(f,g,w),O=Math.max(f,g,w),j=(C+O)/2;if(C===O)return[0,0,100*j,h];const W=O-C,K=j>.5?W/(2-O-C):W/(O+C);let oe=0;return O===f?oe=(g-w)/W+(g<w?6:0):O===g?oe=(w-f)/W+2:O===w&&(oe=(f-g)/W+4),oe*=60,[Math.min(Math.max(oe,0),360),Math.min(Math.max(100*K,0),100),Math.min(Math.max(100*j,0),100),h]}toArray01(){const{r:e,g:i,b:o,a:h}=this;return[e,i,o,h]}toArray01Scaled(e){const{r:i,g:o,b:h}=this;return[i*e,o*e,h*e]}toArray01Linear(){const{r:e,g:i,b:o,a:h}=this;return[Math.pow(e,2.2),Math.pow(i,2.2),Math.pow(o,2.2),h]}}class Md extends Dl{constructor(e,i,o,h,f){super(e,i,o,h,f,!1)}}class Ja extends Dl{constructor(e,i,o,h,f){super(e,i,o,h,f,!0)}}function js(s,e,i){return s*(1-i)+e*i}function Np(s,e,i){return s.map((o,h)=>js(o,e[h],i))}So.black=new So(0,0,0,1),So.white=new So(1,1,1,1),So.transparent=new So(0,0,0,0),So.red=new So(1,0,0,1),So.blue=new So(0,0,1,1);var lh=Object.freeze({__proto__:null,array:Np,color:function(s,e,i){return new So(js(s.r,e.r,i),js(s.g,e.g,i),js(s.b,e.b,i),js(s.a,e.a,i))},number:js});function ga(s,...e){for(const i of e)for(const o in i)s[o]=i[o];return s}class La extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class yh{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[o,h]of i)this.bindings[o]=h}concat(e){return new yh(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const qd={kind:"null"},Ls={kind:"number"},Qr={kind:"string"},zo={kind:"boolean"},Jl={kind:"color"},Kh={kind:"object"},ro={kind:"value"},ku={kind:"collator"},Ph={kind:"formatted"},gc={kind:"resolvedImage"};function Ba(s,e){return{kind:"array",itemType:s,N:e}}function Xn(s){if(s.kind==="array"){const e=Xn(s.itemType);return typeof s.N=="number"?`array<${e}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${e}>`}return s.kind}const Hf=[qd,Ls,Qr,zo,Jl,Ph,Kh,Ba(ro),gc];function sd(s,e){if(e.kind==="error")return null;if(s.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!sd(s.itemType,e.itemType))&&(typeof s.N!="number"||s.N===e.N))return null}else{if(s.kind===e.kind)return null;if(s.kind==="value"){for(const i of Hf)if(!sd(i,e))return null}}return`Expected ${Xn(s)} but found ${Xn(e)} instead.`}function Zd(s,e){return e.some(i=>i.kind===s.kind)}function Vp(s,e){return e.some(i=>i==="null"?s===null:i==="array"?Array.isArray(s):i==="object"?s&&!Array.isArray(s)&&typeof s=="object":i===typeof s)}function Kd(s,e){return s.kind==="array"&&e.kind==="array"?s.N===e.N&&Kd(s.itemType,e.itemType):s.kind===e.kind}class Tl{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ad{constructor(e,i,o,h,f){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=o,this.fontStack=h,this.textColor=f}}class Wa{constructor(e){this.sections=e}static fromString(e){return new Wa([new Ad(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof Wa?e:Wa.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const h=i.image.getPrimary().id.toString();e.push(["image",h]);continue}e.push(i.text);const o={};i.fontStack&&(o["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(o["font-scale"]=i.scale),i.textColor&&(o["text-color"]=["rgba"].concat(i.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(o)}return e}}class Jd{constructor(e,i={}){if(this.id=fl.from(e),this.options=Object.assign({},i),i.transform){const{a:o,b:h,c:f,d:g,e:w,f:C}=i.transform;this.options.transform=new DOMMatrix([o,h,f,g,w,C])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:i,c:o,d:h,e:f,f:g}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:i,c:o,d:h,e:f,f:g}})}static parse(e){let i,o,h,f;try{({name:i,iconsetId:o,params:h,transform:f}=JSON.parse(e)||{})}catch{return null}if(!i)return null;const{a:g,b:w,c:C,d:O,e:j,f:W}=f||{};return new Jd({name:i,iconsetId:o},{params:h,transform:new DOMMatrix([g,w,C,O,j,W])})}scaleSelf(e,i){return this.options.transform.scaleSelf(e,i),this}}class cl{constructor(e,i,o,h,f=!1){this.primaryId=fl.from(e),this.primaryOptions=i,o&&(this.secondaryId=fl.from(o)),this.secondaryOptions=h,this.available=f}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Jd(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Jd(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?cl.build({name:e}):e}static build(e,i,o,h){return!e||typeof e=="object"&&!("name"in e)?null:new cl(e,o,i,h)}}function gp(s,e,i,o){return typeof s=="number"&&s>=0&&s<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[s,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[s,e,i,o]:[s,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Fr(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof So||s instanceof Tl||s instanceof Wa||s instanceof cl)return!0;if(Array.isArray(s)){for(const e of s)if(!Fr(e))return!1;return!0}if(typeof s=="object"){for(const e in s)if(!Fr(s[e]))return!1;return!0}return!1}function cs(s){if(s===null)return qd;if(typeof s=="string")return Qr;if(typeof s=="boolean")return zo;if(typeof s=="number")return Ls;if(s instanceof So)return Jl;if(s instanceof Tl)return ku;if(s instanceof Wa)return Ph;if(s instanceof cl)return gc;if(Array.isArray(s)){const e=s.length;let i;for(const o of s){const h=cs(o);if(i){if(i===h)continue;i=ro;break}i=h}return Ba(i||ro,e)}return Kh}function Jh(s){const e=typeof s;return s===null?"":e==="string"||e==="number"||e==="boolean"?String(s):s instanceof Wa||s instanceof cl||s instanceof So?s.toString():JSON.stringify(s)}class hr{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Fr(e[1]))return i.error("invalid value");const o=e[1];let h=cs(o);const f=i.expectedType;return h.kind!=="array"||h.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(h=f),new hr(h,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof So?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Wa?this.value.serialize():this.value}}class An{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Qh={string:Qr,number:Ls,boolean:zo,object:Kh};class Zs{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,h=1;const f=e[0];if(f==="array"){let w,C;if(e.length>2){const O=e[1];if(typeof O!="string"||!(O in Qh)||O==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);w=Qh[O],h++}else w=ro;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);C=e[2],h++}o=Ba(w,C)}else o=Qh[f];const g=[];for(;h<e.length;h++){const w=i.parse(e[h],h,ro);if(!w)return null;g.push(w)}return new Zs(o,g)}evaluate(e){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(e);if(!sd(this.type,cs(o)))return o;if(i===this.args.length-1)throw new An(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${Xn(cs(o))} but was expected to be of type ${Xn(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){i.push(o.kind);const h=e.N;(typeof h=="number"||this.args.length>1)&&i.push(h)}}return i.concat(this.args.map(o=>o.serialize()))}}class ec{constructor(e){this.type=Ph,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const h=[];let f=!1;for(let g=1;g<=e.length-1;++g){const w=e[g];if(f&&typeof w=="object"&&!Array.isArray(w)){f=!1;let C=null;if(w["font-scale"]&&(C=i.parseObjectValue(w["font-scale"],g,"font-scale",Ls),!C))return null;let O=null;if(w["text-font"]&&(O=i.parseObjectValue(w["text-font"],g,"text-font",Ba(Qr)),!O))return null;let j=null;if(w["text-color"]&&(j=i.parseObjectValue(w["text-color"],g,"text-color",Jl),!j))return null;const W=h[h.length-1];W.scale=C,W.font=O,W.textColor=j}else{const C=i.parse(e[g],g,ro);if(!C)return null;const O=C.type.kind;if(O!=="string"&&O!=="value"&&O!=="null"&&O!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,h.push({content:C,scale:null,font:null,textColor:null})}}return new ec(h)}evaluate(e){return new Wa(this.sections.map(i=>{const o=i.content.evaluate(e);return Kd(cs(o),gc)?new Ad("",o,null,null,null):new Ad(Jh(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const o={};i.scale&&(o["font-scale"]=i.scale.serialize()),i.font&&(o["text-font"]=i.font.serialize()),i.textColor&&(o["text-color"]=i.textColor.serialize()),e.push(o)}return e}}class Ql{constructor(e,i,o,h){this._imageWarnHistory={},this.type=gc,this.namePrimary=e,this.nameSecondary=i,o&&(this.paramsPrimary=o.params,this.iconsetIdPrimary=o.iconset?o.iconset.id:void 0),h&&(this.paramsSecondary=h.params,this.iconsetIdSecondary=h.iconset?h.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let o=1;const h=[];function f(){if(o<e.length){const w=i.parse(e[o],o++,Qr);return w?(h.push({image:w,options:{}}),!0):(i.error(h.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function g(){if(o<e.length){const C=e[o];if((w=C)===null||typeof w!="object"||Array.isArray(w))return!0;const O=C.params,j=C.iconset,W=i.concat(o);if(!O&&!j)return o++,!0;if(O){if(typeof O!="object"||O.constructor!==Object)return W.error('Image options "params" should be an object'),!1;const K={},oe=W.concat(void 0,"params");for(const ue in O){if(!ue)return oe.error("Image parameter name should be non-empty"),!1;const be=oe.concat(void 0,ue).parse(O[ue],void 0,Jl,void 0,{typeAnnotation:"coerce"});if(!be)return!1;K[ue]=be}h[h.length-1].options.params=K}if(j){if(typeof j!="object"||j.constructor!==Object)return W.error('Image options "iconset" should be an object'),!1;if(!j.id)return W.error('Image options "iconset" should have an "id" property'),!1;h[h.length-1].options.iconset=j}return o++,!0}var w;return!0}for(let w=0;w<2;w++)if(!f()||!g())return;return new Ql(h[0].image,h[1]?h[1].image:void 0,h[0].options,h[1]?h[1].options:void 0)}evaluateParams(e,i){const o={};if(i){for(const h in i)if(i[h])try{o[h]=i[h].evaluate(e)}catch{continue}if(Object.keys(o).length!==0)return{params:o}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},o=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,h=cl.build(i,o,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(h&&e.availableImages){const f=h.getPrimary().id;if(h.available=e.availableImages.some(g=>fl.isEqual(g,f)),h.available){const g=h.getSecondary()?h.getSecondary().id:null;g&&(h.available=e.availableImages.some(w=>fl.isEqual(w,g)))}}return h}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const o={};if(i&&(o.iconset={id:i}),e){o.params={};for(const h in e)e[h]&&(o.params[h]=e[h].serialize())}return Object.keys(o).length>0?o:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function rd(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}const Rc={"to-boolean":zo,"to-color":Jl,"to-number":Ls,"to-string":Qr};class tc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[0],h=[];let f=qd;if(o==="to-array"){if(!Array.isArray(e[1]))return null;const g=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);f=Ba(i.expectedType.itemType,g)}else{if(!(g>0&&Fr(e[1][0])))return null;f=Ba(cs(e[1][0]),g)}for(let w=0;w<g;w++){const C=e[1][w];let O;if(rd(C)==="array")O=i.parse(C,void 0,f.itemType);else{const j=rd(C);if(j!==f.itemType.kind)return i.error(`Expected ${f.itemType.kind} but found ${j}.`);O=i.registry.literal.parse(["literal",C===void 0?null:C],i)}if(!O)return null;h.push(O)}}else{if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");f=Rc[o];for(let g=1;g<e.length;g++){const w=i.parse(e[g],g,ro);if(!w)return null;h.push(w)}}return new tc(f,h)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,o;for(const h of this.args){if(i=h.evaluate(e),o=null,i instanceof So)return i;if(typeof i=="string"){const f=e.parseColor(i);if(f)return f}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:gp(i[0],i[1],i[2],i[3]),!o))return new So(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new An(o||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const o of this.args){if(i=o.evaluate(e),i===null)return 0;const h=Number(i);if(!isNaN(h))return h}throw new An(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Wa.fromString(Jh(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?cl.build(Jh(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):Jh(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new ec([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ql(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Qa=["Unknown","Point","LineString","Polygon"];class ic{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Qa[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:o,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*i-e[0])+this.featureDistanceData.bearing[1]*(h*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=So.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class Aa{constructor(e,i,o,h,f){this.name=e,this.type=i,this._evaluate=o,this.args=h,this._overloadIndex=f}evaluate(e){if(!this._evaluate){const i=Aa.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const o=e[0],h=Aa.definitions[o];if(!h)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(h)?h[0]:h.type,g=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,w=[];let C=null,O=-1;for(const[j,W]of g){if(Array.isArray(j)&&j.length!==e.length-1)continue;w.push(j),O++,C=new Ro(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const K=[];let oe=!1;for(let ue=1;ue<e.length;ue++){const be=e[ue],ke=Array.isArray(j)?j[ue-1]:j.type,Fe=C.parse(be,1+K.length,ke);if(!Fe){oe=!0;break}K.push(Fe)}if(!oe)if(Array.isArray(j)&&j.length!==K.length)C.error(`Expected ${j.length} arguments, but found ${K.length} instead.`);else{for(let ue=0;ue<K.length;ue++){const be=Array.isArray(j)?j[ue]:j.type,ke=K[ue];C.concat(ue+1).checkSubtype(be,ke.type)}if(C.errors.length===0)return new Aa(o,f,W,K,O)}}if(w.length===1)i.errors.push(...C.errors);else{const j=(w.length?w:g.map(([K])=>K)).map(df).join(" | "),W=[];for(let K=1;K<e.length;K++){const oe=i.parse(e[K],1+W.length);if(!oe)return null;W.push(Xn(oe.type))}i.error(`Expected arguments of type ${j}, but found (${W.join(", ")}) instead.`)}return null}static register(e,i){Aa.definitions=i;for(const o in i)e[o]=Aa}}function df(s){return Array.isArray(s)?`(${s.map(Xn).join(", ")})`:`(${Xn(s.type)}...)`}class eh{constructor(e,i,o){this.type=ku,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const h=o["case-sensitive"]===void 0?i.parse(!1,1,zo):i.parseObjectValue(o["case-sensitive"],1,"case-sensitive",zo);if(!h)return null;const f=o["diacritic-sensitive"]===void 0?i.parse(!1,1,zo):i.parseObjectValue(o["diacritic-sensitive"],1,"diacritic-sensitive",zo);if(!f)return null;let g=null;return o.locale&&(g=i.parseObjectValue(o.locale,1,"locale",Qr),!g)?null:new eh(h,f,g)}evaluate(e){return new Tl(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function zl(s,e,i=0,o=s.length-1,h=uf){for(;o>i;){if(o-i>600){const C=o-i+1,O=e-i+1,j=Math.log(C),W=.5*Math.exp(2*j/3),K=.5*Math.sqrt(j*W*(C-W)/C)*(O-C/2<0?-1:1);zl(s,e,Math.max(i,Math.floor(e-O*W/C+K)),Math.min(o,Math.floor(e+(C-O)*W/C+K)),h)}const f=s[e];let g=i,w=o;for(hh(s,i,e),h(s[o],f)>0&&hh(s,i,o);g<w;){for(hh(s,g,w),g++,w--;h(s[g],f)<0;)g++;for(;h(s[w],f)>0;)w--}h(s[i],f)===0?hh(s,i,w):(w++,hh(s,w,o)),w<=e&&(i=w+1),e<=w&&(o=w-1)}}function hh(s,e,i){const o=s[e];s[e]=s[i],s[i]=o}function uf(s,e){return s<e?-1:s>e?1:0}function Qd(s){let e=0;for(let i,o,h=0,f=s.length,g=f-1;h<f;g=h++)i=s[h],o=s[g],e+=(o.x-i.x)*(i.y+o.y);return e}function eu(s,e){s[0]=Math.min(s[0],e[0]),s[1]=Math.min(s[1],e[1]),s[2]=Math.max(s[2],e[0]),s[3]=Math.max(s[3],e[1])}function yc(s,e){return!(s[0]<=e[0]||s[2]>=e[2]||s[1]<=e[1]||s[3]>=e[3])}function kd(s,e,i){const o=s[0]-e[0],h=s[1]-e[1],f=s[0]-i[0],g=s[1]-i[1];return o*g-f*h==0&&o*f<=0&&h*g<=0}function xc(s,e,i=!1){let o=!1;for(let w=0,C=e.length;w<C;w++){const O=e[w];for(let j=0,W=O.length,K=W-1;j<W;K=j++){const oe=O[K],ue=O[j];if(kd(s,oe,ue))return i;(f=oe)[1]>(h=s)[1]!=(g=ue)[1]>h[1]&&h[0]<(g[0]-f[0])*(h[1]-f[1])/(g[1]-f[1])+f[0]&&(o=!o)}}var h,f,g;return o}function Xf(s,e,i,o){const h=o[0]-i[0],f=o[1]-i[1],g=(s[0]-i[0])*f-h*(s[1]-i[1]),w=(e[0]-i[0])*f-h*(e[1]-i[1]);return g>0&&w<0||g<0&&w>0}function Bc(s,e,i,o){return(h=[o[0]-i[0],o[1]-i[1]])[0]*(f=[e[0]-s[0],e[1]-s[1]])[1]-h[1]*f[0]!=0&&!(!Xf(s,e,i,o)||!Xf(i,o,s,e));var h,f}function Am(s){const e=new Wi(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new Wi(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const o of s[0])e.x>o.x&&(e.x=o.x),e.y>o.y&&(e.y=o.y),i.x<o.x&&(i.x=o.x),i.y<o.y&&(i.y=o.y);return{min:e,max:i}}const Fc=8192;function Eu(s,e){const i=(180+s[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(i*h*Fc),Math.round(o*h*Fc)]}function Nc(s,e){for(let i=0;i<e.length;i++)if(xc(s,e[i]))return!0;return!1}function rg(s,e,i){for(const o of i)for(let h=0,f=o.length,g=f-1;h<f;g=h++)if(Bc(s,e,o[g],o[h]))return!0;return!1}function Yf(s,e){for(let i=0;i<s.length;++i)if(!xc(s[i],e))return!1;for(let i=0;i<s.length-1;++i)if(rg(s[i],s[i+1],e))return!1;return!0}function yp(s,e){for(let i=0;i<e.length;i++)if(Yf(s,e[i]))return!0;return!1}function sc(s,e,i){const o=[];for(let h=0;h<s.length;h++){const f=[];for(let g=0;g<s[h].length;g++){const w=Eu(s[h][g],i);eu(e,w),f.push(w)}o.push(f)}return o}function Ed(s,e,i){const o=[];for(let h=0;h<s.length;h++){const f=sc(s[h],e,i);o.push(f)}return o}function Up(s,e,i,o){if(s[0]<i[0]||s[0]>i[2]){const h=.5*o;let f=s[0]-i[0]>h?-o:i[0]-s[0]>h?o:0;f===0&&(f=s[0]-i[2]>h?-o:i[2]-s[0]>h?o:0),s[0]+=f}eu(e,s)}function $f(s,e,i,o){const h=Math.pow(2,o.z)*Fc,f=[o.x*Fc,o.y*Fc],g=[];if(!s)return g;for(const w of s)for(const C of w){const O=[C.x+f[0],C.y+f[1]];Up(O,e,i,h),g.push(O)}return g}function qf(s,e,i,o){const h=Math.pow(2,o.z)*Fc,f=[o.x*Fc,o.y*Fc],g=[];if(!s)return g;for(const C of s){const O=[];for(const j of C){const W=[j.x+f[0],j.y+f[1]];eu(e,W),O.push(W)}g.push(O)}if(e[2]-e[0]<=h/2){(w=e)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const C of g)for(const O of C)Up(O,e,i,h)}var w;return g}class Yl{constructor(e,i){this.type=zo,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Fr(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let h=0;h<o.features.length;++h){const f=o.features[h].geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new Yl(o,o.features[h].geometry)}else if(o.type==="Feature"){const h=o.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Yl(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Yl(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,o){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if(o.type==="Polygon"){const w=sc(o.coordinates,f,g),C=$f(i.geometry(),h,f,g);if(!yc(h,f))return!1;for(const O of C)if(!xc(O,w))return!1}if(o.type==="MultiPolygon"){const w=Ed(o.coordinates,f,g),C=$f(i.geometry(),h,f,g);if(!yc(h,f))return!1;for(const O of C)if(!Nc(O,w))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,o){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if(o.type==="Polygon"){const w=sc(o.coordinates,f,g),C=qf(i.geometry(),h,f,g);if(!yc(h,f))return!1;for(const O of C)if(!Yf(O,w))return!1}if(o.type==="MultiPolygon"){const w=Ed(o.coordinates,f,g),C=qf(i.geometry(),h,f,g);if(!yc(h,f))return!1;for(const O of C)if(!yp(O,w))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const tu={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},od=1/298.257223563,jp=od*(2-od),Cu=Math.PI/180;class _c{static fromTile(e,i,o){const h=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),f=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/Cu;return new _c(f,o)}static get units(){return tu}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!tu[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(tu).join(", ")}`);const o=6378.137*Cu*(i?tu[i]:1),h=Math.cos(e*Cu),f=1/(1-jp*(1-h*h)),g=Math.sqrt(f);this.kx=o*g*h,this.ky=o*g*f*(1-jp)}distance(e,i){const o=ch(e[0]-i[0])*this.kx,h=(e[1]-i[1])*this.ky;return Math.sqrt(o*o+h*h)}bearing(e,i){const o=ch(i[0]-e[0])*this.kx;return Math.atan2(o,(i[1]-e[1])*this.ky)/Cu}destination(e,i,o){const h=o*Cu;return this.offset(e,Math.sin(h)*i,Math.cos(h)*i)}offset(e,i,o){return[e[0]+i/this.kx,e[1]+o/this.ky]}lineDistance(e){let i=0;for(let o=0;o<e.length-1;o++)i+=this.distance(e[o],e[o+1]);return i}area(e){let i=0;for(let o=0;o<e.length;o++){const h=e[o];for(let f=0,g=h.length,w=g-1;f<g;w=f++)i+=ch(h[f][0]-h[w][0])*(h[f][1]+h[w][1])*(o?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let o=0;if(i<=0)return e[0];for(let h=0;h<e.length-1;h++){const f=e[h],g=e[h+1],w=this.distance(f,g);if(o+=w,o>i)return pf(f,g,(i-(o-w))/w)}return e[e.length-1]}pointToSegmentDistance(e,i,o){let[h,f]=i,g=ch(o[0]-h)*this.kx,w=(o[1]-f)*this.ky;if(g!==0||w!==0){const C=(ch(e[0]-h)*this.kx*g+(e[1]-f)*this.ky*w)/(g*g+w*w);C>1?(h=o[0],f=o[1]):C>0&&(h+=g/this.kx*C,f+=w/this.ky*C)}return g=ch(e[0]-h)*this.kx,w=(e[1]-f)*this.ky,Math.sqrt(g*g+w*w)}pointOnLine(e,i){let o=1/0,h=e[0][0],f=e[0][1],g=0,w=0;for(let C=0;C<e.length-1;C++){let O=e[C][0],j=e[C][1],W=ch(e[C+1][0]-O)*this.kx,K=(e[C+1][1]-j)*this.ky,oe=0;W===0&&K===0||(oe=(ch(i[0]-O)*this.kx*W+(i[1]-j)*this.ky*K)/(W*W+K*K),oe>1?(O=e[C+1][0],j=e[C+1][1]):oe>0&&(O+=W/this.kx*oe,j+=K/this.ky*oe)),W=ch(i[0]-O)*this.kx,K=(i[1]-j)*this.ky;const ue=W*W+K*K;ue<o&&(o=ue,h=O,f=j,g=C,w=oe)}return{point:[h,f],index:g,t:Math.max(0,Math.min(1,w))}}lineSlice(e,i,o){let h=this.pointOnLine(o,e),f=this.pointOnLine(o,i);if(h.index>f.index||h.index===f.index&&h.t>f.t){const O=h;h=f,f=O}const g=[h.point],w=h.index+1,C=f.index;!nd(o[w],g[0])&&w<=C&&g.push(o[w]);for(let O=w+1;O<=C;O++)g.push(o[O]);return nd(o[C],f.point)||g.push(f.point),g}lineSliceAlong(e,i,o){let h=0;const f=[];for(let g=0;g<o.length-1;g++){const w=o[g],C=o[g+1],O=this.distance(w,C);if(h+=O,h>e&&f.length===0&&f.push(pf(w,C,(e-(h-O))/O)),h>=i)return f.push(pf(w,C,(i-(h-O))/O)),f;h>e&&f.push(C)}return f}bufferPoint(e,i){const o=i/this.ky,h=i/this.kx;return[e[0]-h,e[1]-o,e[0]+h,e[1]+o]}bufferBBox(e,i){const o=i/this.ky,h=i/this.kx;return[e[0]-h,e[1]-o,e[2]+h,e[3]+o]}insideBBox(e,i){return ch(e[0]-i[0])>=0&&ch(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function nd(s,e){return s[0]===e[0]&&s[1]===e[1]}function pf(s,e,i){const o=ch(e[0]-s[0]);return[s[0]+o*i,s[1]+(e[1]-s[1])*i]}function ch(s){for(;s<-180;)s+=360;for(;s>180;)s-=360;return s}class iu{constructor(e=[],i=(o,h)=>o<h?-1:o>h?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:o}=this,h=i[e];for(;e>0;){const f=e-1>>1,g=i[f];if(o(h,g)>=0)break;i[e]=g,e=f}i[e]=h}_down(e){const{data:i,compare:o}=this,h=this.length>>1,f=i[e];for(;e<h;){let g=1+(e<<1);const w=g+1;if(w<this.length&&o(i[w],i[g])<0&&(g=w),o(i[g],f)>=0)break;i[e]=i[g],e=g}i[e]=f}}var ns=8192;function Cd(s,e){return e.dist-s.dist}const Pd=100,Zu=50;function Ih(s){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==s.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==s[i])return!1;return!0}function Rl(s){return s[1]-s[0]+1}function vc(s,e){const i=s[1]>=s[0]&&s[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function bc(s,e){if(s[0]>s[1])return[null,null];const i=Rl(s);if(e){if(i===2)return[s,null];const o=Math.floor(i/2);return[[s[0],s[0]+o],[s[0]+o,s[1]]]}{if(i===1)return[s,null];const o=Math.floor(i/2)-1;return[[s[0],s[0]+o],[s[0]+o+1,s[1]]]}}function xh(s,e){const i=[1/0,1/0,-1/0,-1/0];if(!vc(e,s.length))return i;for(let o=e[0];o<=e[1];++o)eu(i,s[o]);return i}function jr(s){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<s.length;++i)for(let o=0;o<s[i].length;++o)eu(e,s[i][o]);return e}function rc(s,e,i){if(Ih(s)||Ih(e))return NaN;let o=0,h=0;return s[2]<e[0]&&(o=e[0]-s[2]),s[0]>e[2]&&(o=s[0]-e[2]),s[1]>e[3]&&(h=s[1]-e[3]),s[3]<e[1]&&(h=e[1]-s[3]),i.distance([0,0],[o,h])}function Pu(s){return 360*s-180}function ff(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function mf(s,e){const i=Math.pow(2,e.z),o=(s.y/ns+e.y)/i;return[Pu((s.x/ns+e.x)/i),ff(o)]}function ad(s,e){const i=[];for(let o=0;o<s.length;++o)i.push(mf(s[o],e));return i}function ho(s,e,i){const o=i.pointOnLine(e,s).point;return i.distance(s,o)}function ka(s,e,i,o,h){const f=i.slice(o[0],o[1]+1);let g=1/0;for(let w=e[0];w<=e[1];++w)if((g=Math.min(g,ho(s[w],f,h)))===0)return 0;return g}function Zf(s,e,i,o,h){const f=Math.min(h.pointToSegmentDistance(s,i,o),h.pointToSegmentDistance(e,i,o)),g=Math.min(h.pointToSegmentDistance(i,s,e),h.pointToSegmentDistance(o,s,e));return Math.min(f,g)}function km(s,e,i,o,h){if(!vc(e,s.length)||!vc(o,i.length))return NaN;let f=1/0;for(let g=e[0];g<e[1];++g)for(let w=o[0];w<o[1];++w){if(Bc(s[g],s[g+1],i[w],i[w+1]))return 0;f=Math.min(f,Zf(s[g],s[g+1],i[w],i[w+1],h))}return f}function su(s,e,i,o,h){if(!vc(e,s.length)||!vc(o,i.length))return NaN;let f=1/0;for(let g=e[0];g<=e[1];++g)for(let w=o[0];w<=o[1];++w)if((f=Math.min(f,h.distance(s[g],i[w])))===0)return f;return f}function Gp(s,e,i){if(xc(s,e,!0))return 0;let o=1/0;for(const h of e){const f=h.length;if(f<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[f-1]&&(o=Math.min(o,i.pointToSegmentDistance(s,h[f-1],h[0])))===0||(o=Math.min(o,ho(s,h,i)))===0)return o}return o}function vn(s,e,i,o){if(!vc(e,s.length))return NaN;for(let f=e[0];f<=e[1];++f)if(xc(s[f],i,!0))return 0;let h=1/0;for(let f=e[0];f<e[1];++f)for(const g of i)for(let w=0,C=g.length,O=C-1;w<C;O=w++){if(Bc(s[f],s[f+1],g[O],g[w]))return 0;h=Math.min(h,Zf(s[f],s[f+1],g[O],g[w],o))}return h}function ea(s,e){for(const i of s)for(let o=0;o<=i.length-1;++o)if(xc(i[o],e,!0))return!0;return!1}function Vc(s,e,i,o=1/0){const h=jr(s),f=jr(e);if(o!==1/0&&rc(h,f,i)>=o)return o;if(yc(h,f)){if(ea(s,e))return 0}else if(ea(e,s))return 0;let g=o;for(const w of s)for(let C=0,O=w.length,j=O-1;C<O;j=C++)for(const W of e)for(let K=0,oe=W.length,ue=oe-1;K<oe;ue=K++){if(Bc(w[j],w[C],W[ue],W[K]))return 0;g=Math.min(g,Zf(w[j],w[C],W[ue],W[K],i))}return g}function Uc(s,e,i,o,h,f,g){if(f===null||g===null)return;const w=rc(xh(o,f),xh(h,g),i);w<e&&s.push({dist:w,range1:f,range2:g})}function Dr(s,e,i,o,h=1/0){let f=Math.min(o.distance(s[0],i[0][0]),h);if(f===0)return f;const g=new iu([{dist:0,range1:[0,s.length-1],range2:[0,0]}],Cd),w=e?Zu:Pd,C=jr(i);for(;g.length;){const O=g.pop();if(O.dist>=f)continue;const j=O.range1;if(Rl(j)<=w){if(!vc(j,s.length))return NaN;if(e){const W=vn(s,j,i,o);if((f=Math.min(f,W))===0)return f}else for(let W=j[0];W<=j[1];++W){const K=Gp(s[W],i,o);if((f=Math.min(f,K))===0)return f}}else{const W=bc(j,e);if(W[0]!==null){const K=rc(xh(s,W[0]),C,o);K<f&&g.push({dist:K,range1:W[0],range2:[0,0]})}if(W[1]!==null){const K=rc(xh(s,W[1]),C,o);K<f&&g.push({dist:K,range1:W[1],range2:[0,0]})}}}return f}function Un(s,e,i,o,h,f=1/0){let g=Math.min(f,h.distance(s[0],i[0]));if(g===0)return g;const w=new iu([{dist:0,range1:[0,s.length-1],range2:[0,i.length-1]}],Cd),C=e?Zu:Pd,O=o?Zu:Pd;for(;w.length;){const j=w.pop();if(j.dist>=g)continue;const W=j.range1,K=j.range2;if(Rl(W)<=C&&Rl(K)<=O){if(!vc(W,s.length)||!vc(K,i.length))return NaN;if(e&&o?g=Math.min(g,km(s,W,i,K,h)):e||o?e&&!o?g=Math.min(g,ka(i,K,s,W,h)):!e&&o&&(g=Math.min(g,ka(s,W,i,K,h))):g=Math.min(g,su(s,W,i,K,h)),g===0)return g}else{const oe=bc(W,e),ue=bc(K,o);Uc(w,g,h,s,i,oe[0],ue[0]),Uc(w,g,h,s,i,oe[0],ue[1]),Uc(w,g,h,s,i,oe[1],ue[0]),Uc(w,g,h,s,i,oe[1],ue[1])}}return g}function ln(s,e,i,o,h=1/0){let f=h;const g=xh(s,[0,s.length-1]);for(const w of i)if(!(f!==1/0&&rc(g,xh(w,[0,w.length-1]),o)>=f)&&(f=Math.min(f,Un(s,e,w,!0,o,f)),f===0))return f;return f}function oc(s,e,i,o,h=1/0){let f=h;const g=xh(s,[0,s.length-1]);for(const w of i){if(f!==1/0&&rc(g,jr(w),o)>=f)continue;const C=Dr(s,e,w,o,f);if(isNaN(C))return C;if((f=Math.min(f,C))===0)return f}return f}function Iu(s){return s==="Point"||s==="MultiPoint"||s==="LineString"||s==="MultiLineString"||s==="Polygon"||s==="MultiPolygon"}class yo{constructor(e,i){this.type=Ls,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Fr(e[1])){const o=e[1];if(o.type==="FeatureCollection"){for(let h=0;h<o.features.length;++h)if(Iu(o.features[h].geometry.type))return new yo(o,o.features[h].geometry)}else if(o.type==="Feature"){if(Iu(o.geometry.type))return new yo(o,o.geometry)}else if(Iu(o.type))return new yo(o,o)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),o=e.canonicalID();if(i!=null&&o!=null){if(e.geometryType()==="Point")return function(h,f,g){const w=[];for(const O of h)for(const j of O)w.push(mf(j,f));const C=new _c(w[0][1],"meters");return g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString"?Un(w,!1,g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",C):g.type==="MultiLineString"?ln(w,!1,g.coordinates,C):g.type==="Polygon"||g.type==="MultiPolygon"?oc(w,!1,g.type==="Polygon"?[g.coordinates]:g.coordinates,C):null}(i,o,this.geometries);if(e.geometryType()==="LineString")return function(h,f,g){const w=[];for(const O of h){const j=[];for(const W of O)j.push(mf(W,f));w.push(j)}const C=new _c(w[0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return ln(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",w,C);if(g.type==="MultiLineString"){let O=1/0;for(let j=0;j<g.coordinates.length;j++){const W=ln(g.coordinates[j],!0,w,C,O);if(isNaN(W))return W;if((O=Math.min(O,W))===0)return O}return O}if(g.type==="Polygon"||g.type==="MultiPolygon"){let O=1/0;for(let j=0;j<w.length;j++){const W=oc(w[j],!0,g.type==="Polygon"?[g.coordinates]:g.coordinates,C,O);if(isNaN(W))return W;if((O=Math.min(O,W))===0)return O}return O}return null}(i,o,this.geometries);if(e.geometryType()==="Polygon")return function(h,f,g){const w=[];for(const O of function(j,W){const K=j.length;if(K<=1)return[j];const oe=[];let ue,be;for(let ke=0;ke<K;ke++){const Fe=Qd(j[ke]);Fe!==0&&(j[ke].area=Math.abs(Fe),be===void 0&&(be=Fe<0),be===Fe<0?(ue&&oe.push(ue),ue=[j[ke]]):ue.push(j[ke]))}return ue&&oe.push(ue),oe}(h)){const j=[];for(let W=0;W<O.length;++W)j.push(ad(O[W],f));w.push(j)}const C=new _c(w[0][0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return oc(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",w,C);if(g.type==="MultiLineString"){let O=1/0;for(let j=0;j<g.coordinates.length;j++){const W=oc(g.coordinates[j],!0,w,C,O);if(isNaN(W))return W;if((O=Math.min(O,W))===0)return O}return O}return g.type==="Polygon"||g.type==="MultiPolygon"?function(O,j,W){let K=1/0;for(const oe of O)for(const ue of j){const be=Vc(oe,ue,W,K);if(isNaN(be))return be;if((K=Math.min(K,be))===0)return K}return K}(g.type==="Polygon"?[g.coordinates]:g.coordinates,w,C):null}(i,o,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function sr(s){if(s instanceof Aa&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof Yl||s instanceof yo)return!1;if(s instanceof Wp)return s.featureConstant;let e=!0;return s.eachChild(i=>{e&&!sr(i)&&(e=!1)}),e}function nc(s){if(s instanceof Aa&&s.name==="feature-state")return!1;let e=!0;return s.eachChild(i=>{e&&!nc(i)&&(e=!1)}),e}function Id(s){if(s instanceof Wp)return new Set([s.key]);let e=new Set;return s.eachChild(i=>{e=new Set([...e,...Id(i)])}),e}function ru(s,e){if(s instanceof Aa&&e.indexOf(s.name)>=0)return!1;let i=!0;return s.eachChild(o=>{i&&!ru(o,e)&&(i=!1)}),i}function Hr(s,e,i){return[s,e,i].filter(Boolean).join("")}function vo(s,e){switch(s){case"string":return Jh(e);case"number":return+e;case"boolean":return!!e;case"color":return So.parse(e);case"formatted":return Wa.fromString(Jh(e));case"resolvedImage":return cl.build(Jh(e))}return e}function ou(s,e,i,o){return o!==void 0&&(s=o*Math.round(s/o)),e!==void 0&&s<e&&(s=e),i!==void 0&&s>i&&(s=i),s}class Wp{constructor(e,i,o,h=!1){this.type=e,this.key=i,this.scope=o,this.featureConstant=h}static parse(e,i){let o=i.expectedType;if(o==null&&(o=ro),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const h=i.parse(e[1],1);if(!(h instanceof hr))return i.error("Key name of 'config' expression must be a string literal.");let f,g=!0;const w=Jh(h.value);if(e.length>=3){const C=i.parse(e[2],2);if(!(C instanceof hr))return i.error("Scope of 'config' expression must be a string literal.");f=Jh(C.value)}if(i.options){const C=Hr(w,f,i._scope),O=i.options.get(C);O&&(g=sr(O.value||O.default))}return new Wp(o,w,f,g)}evaluate(e){const i=Hr(this.key,this.scope,e.scope),o=e.getConfig(i);if(!o)return null;const{type:h,value:f,values:g,minValue:w,maxValue:C,stepValue:O}=o,j=o.default.evaluate(e);let W=j;if(f){const K=e.scope;e.scope=(K||"").split("").slice(1).join(""),W=f.evaluate(e),e.scope=K}return h&&(W=vo(h,W)),W===void 0||w===void 0&&C===void 0&&O===void 0||(typeof W=="number"?W=ou(W,w,C,O):Array.isArray(W)&&(W=W.map(K=>typeof K=="number"?ou(K,w,C,O):K))),f!==void 0&&W!==void 0&&g&&!g.includes(W)&&(W=j,h&&(W=vo(h,W))),(h&&h!==this.type||W!==void 0&&!Kd(cs(W),this.type))&&(W=vo(this.type.kind,W)),W}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class xp{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=e[1];return i.scope.has(o)?new xp(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Ro{constructor(e,i=[],o,h=new yh,f=[],g,w){this.registry=e,this.path=i,this.key=i.map(C=>typeof C=="string"?`['${C}']`:`[${C}]`).join(""),this.scope=h,this.errors=f,this.expectedType=o,this._scope=g,this.options=w}parse(e,i,o,h,f={}){return i||o?this.concat(i,null,o,h)._parse(e,f):this._parse(e,f)}parseObjectValue(e,i,o,h,f,g={}){return this.concat(i,o,h,f)._parse(e,g)}_parse(e,i){function o(h,f,g){return g==="assert"?new Zs(f,[h]):g==="coerce"?new tc(f,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(h){let f=h.parse(e,this);if(!f)return null;if(this.expectedType){const g=this.expectedType,w=f.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||w.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string"){if(this.checkSubtype(g,w))return null}else f=o(f,g,i.typeAnnotation||"coerce");else f=o(f,g,i.typeAnnotation||"assert")}if(!(f instanceof hr)&&f.type.kind!=="resolvedImage"&&_p(f)){const g=new ic(this._scope,this.options);try{f=new hr(f.type,f.evaluate(g))}catch(w){return this.error(w.message),null}}return f}return tc.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o,h){let f=typeof e=="number"?this.path.concat(e):this.path;f=typeof i=="string"?f.concat(i):f;const g=h?this.scope.concat(h):this.scope;return new Ro(this.registry,f,o||null,g,this.errors,this._scope,this.options)}error(e,...i){const o=`${this.key}${i.map(h=>`[${h}]`).join("")}`;this.errors.push(new La(o,e))}checkSubtype(e,i){const o=sd(e,i);return o&&this.error(o),o}}function _p(s){if(s instanceof xp)return _p(s.boundExpression);if(s instanceof Aa&&s.name==="error"||s instanceof eh||s instanceof Yl||s instanceof yo||s instanceof Wp)return!1;const e=s instanceof tc||s instanceof Zs;let i=!0;return s.eachChild(o=>{i=e?i&&_p(o):i&&o instanceof hr}),!!i&&sr(s)&&ru(s,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Ku(s,e){const i=s.length-1;let o,h,f=0,g=i,w=0;for(;f<=g;)if(w=Math.floor((f+g)/2),o=s[w],h=s[w+1],o<=e){if(w===i||e<h)return w;f=w+1}else{if(!(o>e))throw new An("Input is not a number.");g=w-1}return 0}class Lu{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[h,f]of o)this.labels.push(h),this.outputs.push(f)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(e[1],1,Ls);if(!o)return null;const h=[];let f=null;i.expectedType&&i.expectedType.kind!=="value"&&(f=i.expectedType);for(let g=1;g<e.length;g+=2){const w=g===1?-1/0:e[g],C=e[g+1],O=g,j=g+1;if(typeof w!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(h.length&&h[h.length-1][0]>=w)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',O);const W=i.parse(C,j,f);if(!W)return null;f=f||W.type,h.push([w,W])}return new Lu(f,o,h)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return o[0].evaluate(e);const f=i.length;return h>=i[f-1]?o[f-1].evaluate(e):o[Ku(i,h)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const og=.95047,Em=1.08883,nu=4/29,Ld=6/29,Cm=3*Ld*Ld,Pm=Ld*Ld*Ld,Kf=Math.PI/180,Im=180/Math.PI;function gf(s){return s>Pm?Math.pow(s,1/3):s/Cm+nu}function jc(s){return s>Ld?s*s*s:Cm*(s-nu)}function Jf(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function Ou(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function Lm(s){const e=Ou(s.r),i=Ou(s.g),o=Ou(s.b),h=gf((.4124564*e+.3575761*i+.1804375*o)/og),f=gf((.2126729*e+.7151522*i+.072175*o)/1);return{l:116*f-16,a:500*(h-f),b:200*(f-gf((.0193339*e+.119192*i+.9503041*o)/Em)),alpha:s.a}}function Qf(s){let e=(s.l+16)/116,i=isNaN(s.a)?e:e+s.a/500,o=isNaN(s.b)?e:e-s.b/200;return e=1*jc(e),i=og*jc(i),o=Em*jc(o),new So(Jf(3.2404542*i-1.5371385*e-.4985314*o),Jf(-.969266*i+1.8760108*e+.041556*o),Jf(.0556434*i-.2040259*e+1.0572252*o),s.alpha)}function em(s,e,i){const o=e-s;return s+i*(o>180||o<-180?o-360*Math.round(o/360):o)}const Du={forward:Lm,reverse:Qf,interpolate:function(s,e,i){return{l:js(s.l,e.l,i),a:js(s.a,e.a,i),b:js(s.b,e.b,i),alpha:js(s.alpha,e.alpha,i)}}},Bl={forward:function(s){const{l:e,a:i,b:o}=Lm(s),h=Math.atan2(o,i)*Im;return{h:h<0?h+360:h,c:Math.sqrt(i*i+o*o),l:e,alpha:s.a}},reverse:function(s){const e=s.h*Kf,i=s.c;return Qf({l:s.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:s.alpha})},interpolate:function(s,e,i){return{h:em(s.h,e.h,i),c:js(s.c,e.c,i),l:js(s.l,e.l,i),alpha:js(s.alpha,e.alpha,i)}}};var tm=Object.freeze({__proto__:null,hcl:Bl,lab:Du});class dh{constructor(e,i,o,h,f){this.type=e,this.operator=i,this.interpolation=o,this.input=h,this.labels=[],this.outputs=[];for(const[g,w]of f)this.labels.push(g),this.outputs.push(w)}static interpolationFactor(e,i,o,h){let f=0;if(e.name==="exponential")f=Gc(i,e.base,o,h);else if(e.name==="linear")f=Gc(i,1,o,h);else if(e.name==="cubic-bezier"){const g=e.controlPoints;f=new Va(g[0],g[1],g[2],g[3]).solve(Gc(i,1,o,h))}return f}static parse(e,i){let[o,h,f,...g]=e;if(!Array.isArray(h)||h.length===0)return i.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const O=h[1];if(typeof O!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:O}}else{if(h[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const O=h.slice(1);if(O.length!==4||O.some(j=>typeof j!="number"||j<0||j>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:O}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(f=i.parse(f,2,Ls),!f)return null;const w=[];let C=null;o==="interpolate-hcl"||o==="interpolate-lab"?C=Jl:i.expectedType&&i.expectedType.kind!=="value"&&(C=i.expectedType);for(let O=0;O<g.length;O+=2){const j=g[O],W=g[O+1],K=O+3,oe=O+4;if(typeof j!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',K);if(w.length&&w[w.length-1][0]>=j)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',K);const ue=i.parse(W,oe,C);if(!ue)return null;C=C||ue.type,w.push([j,ue])}return C.kind==="number"||C.kind==="color"||C.kind==="array"&&C.itemType.kind==="number"&&typeof C.N=="number"?new dh(C,o,h,f,w):i.error(`Type ${Xn(C)} is not interpolatable.`)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return o[0].evaluate(e);const f=i.length;if(h>=i[f-1])return o[f-1].evaluate(e);const g=Ku(i,h),w=dh.interpolationFactor(this.interpolation,h,i[g],i[g+1]),C=o[g].evaluate(e),O=o[g+1].evaluate(e);return this.operator==="interpolate"?lh[this.type.kind.toLowerCase()](C,O,w):this.operator==="interpolate-hcl"?Bl.reverse(Bl.interpolate(Bl.forward(C),Bl.forward(O),w)):Du.reverse(Du.interpolate(Du.forward(C),Du.forward(O),w))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)i.push(this.labels[o],this.outputs[o].serialize());return i}}function Gc(s,e,i,o){const h=o-i,f=s-i;return h===0?0:e===1?f/h:(Math.pow(e,f)-1)/(Math.pow(e,h)-1)}class Ju{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let o=null;const h=i.expectedType;h&&h.kind!=="value"&&(o=h);const f=[];for(const w of e.slice(1)){const C=i.parse(w,1+f.length,o,void 0,{typeAnnotation:"omit"});if(!C)return null;o=o||C.type,f.push(C)}const g=h&&f.some(w=>sd(h,w.type));return new Ju(g?ro:o,f)}evaluate(e){let i,o=null,h=0;for(const f of this.args){if(h++,o=f.evaluate(e),o&&o instanceof cl&&!o.available&&(i||(i=o),o=null,h===this.args.length))return i;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Hp{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let f=1;f<e.length-1;f+=2){const g=e[f];if(typeof g!="string")return i.error(`Expected string, but found ${typeof g} instead.`,f);if(/[^a-zA-Z0-9_]/.test(g))return i.error("Variable names must contain only alphanumeric characters or '_'.",f);const w=i.parse(e[f+1],f+1);if(!w)return null;o.push([g,w])}const h=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return h?new Hp(o,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,o]of this.bindings)e.push(i,o.serialize());return e.push(this.result.serialize()),e}}class Qu{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Ls),h=i.parse(e[2],2,Ba(i.expectedType||ro));return o&&h?new Qu(h.type.itemType,o,h):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new An(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new An(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new An(`Array index must be an integer, but found ${i} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return o[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class ep{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Ls),h=i.parse(e[2],2,Ba(i.expectedType||ro));return o&&h?new ep(h.type.itemType,o,h):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new An(`Array index out of bounds: ${i} < 0.`);if(i>o.length-1)throw new An(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i===Math.floor(i))return o[i];const h=Math.floor(i),f=Math.ceil(i),g=o[h],w=o[f];if(typeof g!="number"||typeof w!="number")throw new An(`Cannot interpolate between non-number values at index ${i}.`);const C=i-h;return g*(1-C)+w*C}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class im{constructor(e,i){this.type=zo,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,ro),h=i.parse(e[2],2,ro);return o&&h?Zd(o.type,[zo,Qr,Ls,qd,ro])?new im(o,h):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xn(o.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!Vp(i,["boolean","string","number","null"]))throw new An(`Expected first argument to be of type boolean, string, number or null, but found ${Xn(cs(i))} instead.`);if(!Vp(o,["string","array"]))throw new An(`Expected second argument to be of type array or string, but found ${Xn(cs(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Od{constructor(e,i,o){this.type=Ls,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,ro),h=i.parse(e[2],2,ro);if(!o||!h)return null;if(!Zd(o.type,[zo,Qr,Ls,qd,ro]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xn(o.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,Ls);return f?new Od(o,h,f):null}return new Od(o,h)}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Vp(i,["boolean","string","number","null"]))throw new An(`Expected first argument to be of type boolean, string, number or null, but found ${Xn(cs(i))} instead.`);if(!Vp(o,["string","array"]))throw new An(`Expected second argument to be of type array or string, but found ${Xn(cs(o))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return o.indexOf(i,h)}return o.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class au{constructor(e,i,o,h,f,g){this.inputType=e,this.type=i,this.input=o,this.cases=h,this.outputs=f,this.otherwise=g}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,h;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);const f={},g=[];for(let O=2;O<e.length-1;O+=2){let j=e[O];const W=e[O+1];Array.isArray(j)||(j=[j]);const K=i.concat(O);if(j.length===0)return K.error("Expected at least one branch label.");for(const ue of j){if(typeof ue!="number"&&typeof ue!="string")return K.error("Branch labels must be numbers or strings.");if(typeof ue=="number"&&Math.abs(ue)>Number.MAX_SAFE_INTEGER)return K.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ue=="number"&&Math.floor(ue)!==ue)return K.error("Numeric branch labels must be integer values.");if(o){if(K.checkSubtype(o,cs(ue)))return null}else o=cs(ue);if(f[String(ue)]!==void 0)return K.error("Branch labels must be unique.");f[String(ue)]=g.length}const oe=i.parse(W,O,h);if(!oe)return null;h=h||oe.type,g.push(oe)}const w=i.parse(e[1],1,ro);if(!w)return null;const C=i.parse(e[e.length-1],e.length-1,h);return C?w.type.kind!=="value"&&i.concat(1).checkSubtype(o,w.type)?null:new au(o,h,w,f,g,C):null}evaluate(e){const i=this.input.evaluate(e);return(Kd(cs(i),this.inputType)&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),o=[],h={};for(const g of i){const w=h[this.cases[g]];w===void 0?(h[this.cases[g]]=o.length,o.push([this.cases[g],[g]])):o[w][1].push(g)}const f=g=>this.inputType.kind==="number"?Number(g):g;for(const[g,w]of o)e.push(w.length===1?f(w[0]):w.map(f)),e.push(this.outputs[g].serialize());return e.push(this.otherwise.serialize()),e}}class sm{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const h=[];for(let g=1;g<e.length-1;g+=2){const w=i.parse(e[g],g,zo);if(!w)return null;const C=i.parse(e[g+1],g+1,o);if(!C)return null;h.push([w,C]),o=o||C.type}const f=i.parse(e[e.length-1],e.length-1,o);return f?new sm(o,h,f):null}evaluate(e){for(const[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Xp{constructor(e,i,o,h){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=h}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,ro),h=i.parse(e[2],2,Ls);if(!o||!h)return null;if(!Zd(o.type,[Ba(ro),Qr,ro]))return i.error(`Expected first argument to be of type array or string, but found ${Xn(o.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,Ls);return f?new Xp(o.type,o,h,f):null}return new Xp(o.type,o,h)}evaluate(e){const i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!Vp(i,["string","array"]))throw new An(`Expected first argument to be of type array or string, but found ${Xn(cs(i))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return i.slice(o,h)}return i.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function rm(s,e){return s==="=="||s==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function yf(s,e,i,o){return o.compare(e,i)===0}function ld(s,e,i){const o=s!=="=="&&s!=="!=";return class uT{constructor(f,g,w){this.type=zo,this.lhs=f,this.rhs=g,this.collator=w,this.hasUntypedArgument=f.type.kind==="value"||g.type.kind==="value"}static parse(f,g){if(f.length!==3&&f.length!==4)return g.error("Expected two or three arguments.");const w=f[0];let C=g.parse(f[1],1,ro);if(!C)return null;if(!rm(w,C.type))return g.concat(1).error(`"${w}" comparisons are not supported for type '${Xn(C.type)}'.`);let O=g.parse(f[2],2,ro);if(!O)return null;if(!rm(w,O.type))return g.concat(2).error(`"${w}" comparisons are not supported for type '${Xn(O.type)}'.`);if(C.type.kind!==O.type.kind&&C.type.kind!=="value"&&O.type.kind!=="value")return g.error(`Cannot compare types '${Xn(C.type)}' and '${Xn(O.type)}'.`);o&&(C.type.kind==="value"&&O.type.kind!=="value"?C=new Zs(O.type,[C]):C.type.kind!=="value"&&O.type.kind==="value"&&(O=new Zs(C.type,[O])));let j=null;if(f.length===4){if(C.type.kind!=="string"&&O.type.kind!=="string"&&C.type.kind!=="value"&&O.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(j=g.parse(f[3],3,ku),!j)return null}return new uT(C,O,j)}evaluate(f){const g=this.lhs.evaluate(f),w=this.rhs.evaluate(f);if(o&&this.hasUntypedArgument){const C=cs(g),O=cs(w);if(C.kind!==O.kind||C.kind!=="string"&&C.kind!=="number")throw new An(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${C.kind}, ${O.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const C=cs(g),O=cs(w);if(C.kind!=="string"||O.kind!=="string")return e(f,g,w)}return this.collator?i(f,g,w,this.collator.evaluate(f)):e(f,g,w)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[s];return this.eachChild(g=>{f.push(g.serialize())}),f}}}const zu=ld("==",function(s,e,i){return e===i},yf),ng=ld("!=",function(s,e,i){return e!==i},function(s,e,i,o){return!yf(0,e,i,o)}),ag=ld("<",function(s,e,i){return e<i},function(s,e,i,o){return o.compare(e,i)<0}),Yp=ld(">",function(s,e,i){return e>i},function(s,e,i,o){return o.compare(e,i)>0}),Lh=ld("<=",function(s,e,i){return e<=i},function(s,e,i,o){return o.compare(e,i)<=0}),lg=ld(">=",function(s,e,i){return e>=i},function(s,e,i,o){return o.compare(e,i)>=0});class $p{constructor(e,i,o,h,f,g){this.type=Qr,this.number=e,this.locale=i,this.currency=o,this.unit=h,this.minFractionDigits=f,this.maxFractionDigits=g}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const o=i.parse(e[1],1,Ls);if(!o)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return i.error("NumberFormat options argument must be an object.");let f=null;if(h.locale&&(f=i.parseObjectValue(h.locale,2,"locale",Qr),!f))return null;let g=null;if(h.currency&&(g=i.parseObjectValue(h.currency,2,"currency",Qr),!g))return null;let w=null;if(h.unit&&(w=i.parseObjectValue(h.unit,2,"unit",Qr),!w))return null;let C=null;if(h["min-fraction-digits"]&&(C=i.parseObjectValue(h["min-fraction-digits"],2,"min-fraction-digits",Ls),!C))return null;let O=null;return h["max-fraction-digits"]&&(O=i.parseObjectValue(h["max-fraction-digits"],2,"max-fraction-digits",Ls),!O)?null:new $p(o,f,g,w,C,O)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class xf{constructor(e){this.type=Ls,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Xn(o.type)} instead.`):new xf(o):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new An(`Expected value to be of type string or array, but found ${Xn(cs(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function _f(s){return function(){s=1831565813+(s|=0)|0;let e=Math.imul(s^s>>>15,1|s);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Oh={"==":zu,"!=":ng,">":Yp,"<":ag,">=":lg,"<=":Lh,array:Zs,at:Qu,"at-interpolated":ep,boolean:Zs,case:sm,coalesce:Ju,collator:eh,format:ec,image:Ql,in:im,"index-of":Od,interpolate:dh,"interpolate-hcl":dh,"interpolate-lab":dh,length:xf,let:Hp,literal:hr,match:au,number:Zs,"number-format":$p,object:Zs,slice:Xp,step:Lu,string:Zs,"to-boolean":tc,"to-color":tc,"to-number":tc,"to-string":tc,var:xp,within:Yl,distance:yo,config:Wp};function om(s,[e,i,o,h]){e=e.evaluate(s),i=i.evaluate(s),o=o.evaluate(s);const f=h?h.evaluate(s):1,g=gp(e,i,o,f);if(g)throw new An(g);return new So(e/255,i/255,o/255,f)}function Ru(s,[e,i,o,h]){e=e.evaluate(s),i=i.evaluate(s),o=o.evaluate(s);const f=h?h.evaluate(s):1,g=function(O,j,W,K){return typeof O=="number"&&O>=0&&O<=360?typeof j=="number"&&j>=0&&j<=100&&typeof W=="number"&&W>=0&&W<=100?K===void 0||typeof K=="number"&&K>=0&&K<=1?null:`Invalid hsla value [${[O,j,W,K].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof K=="number"?[O,j,W,K]:[O,j,W]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof K=="number"?[O,j,W,K]:[O,j,W]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,o,f);if(g)throw new An(g);const w=`hsla(${e}, ${i}%, ${o}%, ${f})`,C=So.parse(w);if(!C)throw new An(`Failed to parse HSLA color: ${w}`);return C}function vf(s,e){return s in e}function lu(s,e){const i=e[s];return i===void 0?null:i}function ac(s){return{type:s}}function qp(s){return{result:"success",value:s}}function lc(s){return{result:"error",value:s}}function vp(s,e){return!!s&&!!s.parameters&&s.parameters.indexOf(e)>-1}function bp(s){return s["property-type"]==="data-driven"}function nm(s){return vp(s.expression,"measure-light")}function Om(s){return vp(s.expression,"zoom")}function hd(s){return!!s.expression&&s.expression.interpolated}function Bu(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function Zp(s){return s}function Wc(s,e){const i=e.type==="color",o=s.stops&&typeof s.stops[0][0]=="object",h=o||!(o||s.property!==void 0),f=s.type||(hd(e)?"exponential":"interval");if(i&&((s=ga({},s)).stops&&(s.stops=s.stops.map(O=>[O[0],So.parse(O[1])])),s.default=So.parse(s.default?s.default:e.default)),s.colorSpace&&s.colorSpace!=="rgb"&&!tm[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let g,w,C;if(f==="exponential")g=_h;else if(f==="interval")g=Dm;else if(f==="categorical"){g=bf,w=Object.create(null);for(const O of s.stops)w[O[0]]=O[1];C=typeof s.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);g=bn}if(o){const O={},j=[];for(let oe=0;oe<s.stops.length;oe++){const ue=s.stops[oe],be=ue[0].zoom;O[be]===void 0&&(O[be]={zoom:be,type:s.type,property:s.property,default:s.default,stops:[]},j.push(be)),O[be].stops.push([ue[0].value,ue[1]])}const W=[];for(const oe of j)W.push([O[oe].zoom,Wc(O[oe],e)]);const K={name:"linear"};return{kind:"composite",interpolationType:K,interpolationFactor:dh.interpolationFactor.bind(void 0,K),zoomStops:W.map(oe=>oe[0]),evaluate:({zoom:oe},ue)=>_h({stops:W,base:s.base},e,oe).evaluate(oe,ue)}}if(h){const O=f==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:O,interpolationFactor:dh.interpolationFactor.bind(void 0,O),zoomStops:s.stops.map(j=>j[0]),evaluate:({zoom:j})=>g(s,e,j,w,C)}}return{kind:"source",evaluate(O,j){const W=j&&j.properties?j.properties[s.property]:void 0;return W===void 0?cd(s.default,e.default):g(s,e,W,w,C)}}}function cd(s,e,i){return s!==void 0?s:e!==void 0?e:i!==void 0?i:void 0}function bf(s,e,i,o,h){return cd(typeof i===h?o[i]:void 0,s.default,e.default)}function Dm(s,e,i){if(rd(i)!=="number")return cd(s.default,e.default);const o=s.stops.length;if(o===1||i<=s.stops[0][0])return s.stops[0][1];if(i>=s.stops[o-1][0])return s.stops[o-1][1];const h=Ku(s.stops.map(f=>f[0]),i);return s.stops[h][1]}function _h(s,e,i){const o=s.base!==void 0?s.base:1;if(rd(i)!=="number")return cd(s.default,e.default);const h=s.stops.length;if(h===1||i<=s.stops[0][0])return s.stops[0][1];if(i>=s.stops[h-1][0])return s.stops[h-1][1];const f=Ku(s.stops.map(j=>j[0]),i),g=function(j,W,K,oe){const ue=oe-K,be=j-K;return ue===0?0:W===1?be/ue:(Math.pow(W,be)-1)/(Math.pow(W,ue)-1)}(i,o,s.stops[f][0],s.stops[f+1][0]),w=s.stops[f][1],C=s.stops[f+1][1];let O=lh[e.type]||Zp;if(s.colorSpace&&s.colorSpace!=="rgb"){const j=tm[s.colorSpace];O=(W,K)=>j.reverse(j.interpolate(j.forward(W),j.forward(K),g))}return typeof w.evaluate=="function"?{evaluate(...j){const W=w.evaluate.apply(void 0,j),K=C.evaluate.apply(void 0,j);if(W!==void 0&&K!==void 0)return O(W,K,g)}}:O(w,C,g)}function bn(s,e,i){return e.type==="color"?i=So.parse(i):e.type==="formatted"?i=Wa.fromString(i.toString()):e.type==="resolvedImage"?i=cl.build(i.toString()):rd(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),cd(i,s.default,e.default)}Aa.register(Oh,{error:[{kind:"error"},[Qr],(s,[e])=>{throw new An(e.evaluate(s))}],typeof:[Qr,[ro],(s,[e])=>Xn(cs(e.evaluate(s)))],"to-rgba":[Ba(Ls,4),[Jl],(s,[e])=>e.evaluate(s).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Ba(Ls,4),[Jl],(s,[e])=>e.evaluate(s).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Jl,[Ls,Ls,Ls],om],rgba:[Jl,[Ls,Ls,Ls,Ls],om],hsl:[Jl,[Ls,Ls,Ls],Ru],hsla:[Jl,[Ls,Ls,Ls,Ls],Ru],has:{type:zo,overloads:[[[Qr],(s,[e])=>vf(e.evaluate(s),s.properties())],[[Qr,Kh],(s,[e,i])=>vf(e.evaluate(s),i.evaluate(s))]]},get:{type:ro,overloads:[[[Qr],(s,[e])=>lu(e.evaluate(s),s.properties())],[[Qr,Kh],(s,[e,i])=>lu(e.evaluate(s),i.evaluate(s))]]},"feature-state":[ro,[Qr],(s,[e])=>lu(e.evaluate(s),s.featureState||{})],properties:[Kh,[],s=>s.properties()],"geometry-type":[Qr,[],s=>s.geometryType()],worldview:[Qr,[],s=>s.globals.worldview||""],id:[ro,[],s=>s.id()],zoom:[Ls,[],s=>s.globals.zoom],pitch:[Ls,[],s=>s.globals.pitch||0],"distance-from-center":[Ls,[],s=>s.distanceFromCenter()],"measure-light":[Ls,[Qr],(s,[e])=>s.measureLight(e.evaluate(s))],"heatmap-density":[Ls,[],s=>s.globals.heatmapDensity||0],"line-progress":[Ls,[],s=>s.globals.lineProgress||0],"raster-value":[Ls,[],s=>s.globals.rasterValue||0],"raster-particle-speed":[Ls,[],s=>s.globals.rasterParticleSpeed||0],"sky-radial-progress":[Ls,[],s=>s.globals.skyRadialProgress||0],accumulated:[ro,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[Ls,ac(Ls),(s,e)=>{let i=0;for(const o of e)i+=o.evaluate(s);return i}],"*":[Ls,ac(Ls),(s,e)=>{let i=1;for(const o of e)i*=o.evaluate(s);return i}],"-":{type:Ls,overloads:[[[Ls,Ls],(s,[e,i])=>e.evaluate(s)-i.evaluate(s)],[[Ls],(s,[e])=>-e.evaluate(s)]]},"/":[Ls,[Ls,Ls],(s,[e,i])=>e.evaluate(s)/i.evaluate(s)],"%":[Ls,[Ls,Ls],(s,[e,i])=>e.evaluate(s)%i.evaluate(s)],ln2:[Ls,[],()=>Math.LN2],pi:[Ls,[],()=>Math.PI],e:[Ls,[],()=>Math.E],"^":[Ls,[Ls,Ls],(s,[e,i])=>Math.pow(e.evaluate(s),i.evaluate(s))],sqrt:[Ls,[Ls],(s,[e])=>Math.sqrt(e.evaluate(s))],log10:[Ls,[Ls],(s,[e])=>Math.log(e.evaluate(s))/Math.LN10],ln:[Ls,[Ls],(s,[e])=>Math.log(e.evaluate(s))],log2:[Ls,[Ls],(s,[e])=>Math.log(e.evaluate(s))/Math.LN2],sin:[Ls,[Ls],(s,[e])=>Math.sin(e.evaluate(s))],cos:[Ls,[Ls],(s,[e])=>Math.cos(e.evaluate(s))],tan:[Ls,[Ls],(s,[e])=>Math.tan(e.evaluate(s))],asin:[Ls,[Ls],(s,[e])=>Math.asin(e.evaluate(s))],acos:[Ls,[Ls],(s,[e])=>Math.acos(e.evaluate(s))],atan:[Ls,[Ls],(s,[e])=>Math.atan(e.evaluate(s))],min:[Ls,ac(Ls),(s,e)=>Math.min(...e.map(i=>i.evaluate(s)))],max:[Ls,ac(Ls),(s,e)=>Math.max(...e.map(i=>i.evaluate(s)))],abs:[Ls,[Ls],(s,[e])=>Math.abs(e.evaluate(s))],round:[Ls,[Ls],(s,[e])=>{const i=e.evaluate(s);return i<0?-Math.round(-i):Math.round(i)}],floor:[Ls,[Ls],(s,[e])=>Math.floor(e.evaluate(s))],ceil:[Ls,[Ls],(s,[e])=>Math.ceil(e.evaluate(s))],"filter-==":[zo,[Qr,ro],(s,[e,i])=>s.properties()[e.value]===i.value],"filter-id-==":[zo,[ro],(s,[e])=>s.id()===e.value],"filter-type-==":[zo,[Qr],(s,[e])=>s.geometryType()===e.value],"filter-<":[zo,[Qr,ro],(s,[e,i])=>{const o=s.properties()[e.value],h=i.value;return typeof o==typeof h&&o<h}],"filter-id-<":[zo,[ro],(s,[e])=>{const i=s.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[zo,[Qr,ro],(s,[e,i])=>{const o=s.properties()[e.value],h=i.value;return typeof o==typeof h&&o>h}],"filter-id->":[zo,[ro],(s,[e])=>{const i=s.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[zo,[Qr,ro],(s,[e,i])=>{const o=s.properties()[e.value],h=i.value;return typeof o==typeof h&&o<=h}],"filter-id-<=":[zo,[ro],(s,[e])=>{const i=s.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[zo,[Qr,ro],(s,[e,i])=>{const o=s.properties()[e.value],h=i.value;return typeof o==typeof h&&o>=h}],"filter-id->=":[zo,[ro],(s,[e])=>{const i=s.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[zo,[ro],(s,[e])=>e.value in s.properties()],"filter-has-id":[zo,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[zo,[Ba(Qr)],(s,[e])=>e.value.indexOf(s.geometryType())>=0],"filter-id-in":[zo,[Ba(ro)],(s,[e])=>e.value.indexOf(s.id())>=0],"filter-in-small":[zo,[Qr,Ba(ro)],(s,[e,i])=>i.value.indexOf(s.properties()[e.value])>=0],"filter-in-large":[zo,[Qr,Ba(ro)],(s,[e,i])=>function(o,h,f,g){for(;f<=g;){const w=f+g>>1;if(h[w]===o)return!0;h[w]>o?g=w-1:f=w+1}return!1}(s.properties()[e.value],i.value,0,i.value.length-1)],all:{type:zo,overloads:[[[zo,zo],(s,[e,i])=>e.evaluate(s)&&i.evaluate(s)],[ac(zo),(s,e)=>{for(const i of e)if(!i.evaluate(s))return!1;return!0}]]},any:{type:zo,overloads:[[[zo,zo],(s,[e,i])=>e.evaluate(s)||i.evaluate(s)],[ac(zo),(s,e)=>{for(const i of e)if(i.evaluate(s))return!0;return!1}]]},"!":[zo,[zo],(s,[e])=>!e.evaluate(s)],"is-supported-script":[zo,[Qr],(s,[e])=>{const i=s.globals&&s.globals.isSupportedScript;return!i||i(e.evaluate(s))}],upcase:[Qr,[Qr],(s,[e])=>e.evaluate(s).toUpperCase()],downcase:[Qr,[Qr],(s,[e])=>e.evaluate(s).toLowerCase()],concat:[Qr,ac(ro),(s,e)=>e.map(i=>Jh(i.evaluate(s))).join("")],"resolved-locale":[Qr,[ku],(s,[e])=>e.evaluate(s).resolvedLocale()],random:[Ls,[Ls,Ls,ro],(s,e)=>{const[i,o,h]=e.map(g=>g.evaluate(s));if(i>o||i===o)return i;let f;if(typeof h=="string")f=function(g){let w=0;if(g.length===0)return w;for(let C=0;C<g.length;C++)w=(w<<5)-w+g.charCodeAt(C),w|=0;return w}(h);else{if(typeof h!="number")throw new An(`Invalid seed input: ${h}`);f=h}return i+_f(f)()*(o-i)}]});class wp{constructor(e,i,o,h){this.expression=e,this._warningHistory={},this._evaluator=new ic(o,h),this._defaultValue=i?function(f){return f.type==="color"&&(Bu(f.default)||Array.isArray(f.default))?new So(0,0,0,0):f.type==="color"?So.parse(f.default)||null:f.default===void 0?null:f.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=Id(e)}evaluateWithoutErrorHandling(e,i,o,h,f,g,w,C){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=h||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=C||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,h,f,g,w,C){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=C||null;try{const O=this.expression.evaluate(this._evaluator);if(O==null||typeof O=="number"&&O!=O)return this._defaultValue;if(this._enumValues&&!(O in this._enumValues))throw new An(`Expected value to be one of ${Object.keys(this._enumValues).map(j=>JSON.stringify(j)).join(", ")}, but found ${JSON.stringify(O)} instead.`);return O}catch(O){return this._warningHistory[O.message]||(this._warningHistory[O.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${O.message}`)),this._defaultValue}}}function Ge(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in Oh}function J(s,e,i,o){const h=new Ro(Oh,[],e?function(g){const w={color:Jl,string:Qr,number:Ls,enum:Qr,boolean:zo,formatted:Ph,resolvedImage:gc};return g.type==="array"?Ba(w[g.value]||ro,g.length):w[g.type]}(e):void 0,void 0,void 0,i,o),f=h.parse(s,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?qp(new wp(f,e,i,o)):lc(h.errors)}class ge{constructor(e,i,o,h){this.kind=e,this._styleExpression=i,this.isLightConstant=o,this.isLineProgressConstant=h,this.isStateDependent=e!=="constant"&&!nc(i.expression),this.configDependencies=Id(i.expression)}evaluateWithoutErrorHandling(e,i,o,h,f,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,h,f,g)}evaluate(e,i,o,h,f,g){return this._styleExpression.evaluate(e,i,o,h,f,g)}}class xe{constructor(e,i,o,h,f,g){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!nc(i.expression),this.isLightConstant=f,this.isLineProgressConstant=g,this.configDependencies=Id(i.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,i,o,h,f,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,h,f,g)}evaluate(e,i,o,h,f,g){return this._styleExpression.evaluate(e,i,o,h,f,g)}interpolationFactor(e,i,o){return this.interpolationType?dh.interpolationFactor(this.interpolationType,e,i,o):0}}function Ie(s,e,i,o){if((s=J(s,e,i,o)).result==="error")return s;const h=s.value.expression,f=sr(h);if(!f&&!bp(e))return lc([new La("","data expressions not supported")]);const g=ru(h,["zoom","pitch","distance-from-center"]);if(!g&&!Om(e))return lc([new La("","zoom expressions not supported")]);const w=ru(h,["measure-light"]);if(!w&&!nm(e))return lc([new La("","measure-light expression not supported")]);const C=ru(h,["line-progress"]);if(!C&&!function(W){return vp(W.expression,"line-progress")}(e))return lc([new La("","line-progress expression not supported")]);const O=e.expression&&e.expression.relaxZoomRestriction,j=Ye(h);return j||g||O?j instanceof La?lc([j]):j instanceof dh&&!hd(e)?lc([new La("",'"interpolate" expressions cannot be used with this property')]):qp(j?new xe(f&&C?"camera":"composite",s.value,j.labels,j instanceof dh?j.interpolation:void 0,w,C):new ge(f&&C?"constant":"source",s.value,w,C)):lc([new La("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class je{constructor(e,i){this._parameters=e,this._specification=i,ga(this,Wc(this._parameters,this._specification))}static deserialize(e){return new je(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ye(s){let e=null;if(s instanceof Hp)e=Ye(s.result);else if(s instanceof Ju){for(const i of s.args)if(e=Ye(i),e)break}else(s instanceof Lu||s instanceof dh)&&s.input instanceof Aa&&s.input.name==="zoom"&&(e=s);return e instanceof La||s.eachChild(i=>{const o=Ye(i);o instanceof La?e=o:e&&o&&e!==o&&(e=new La("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var mt,bt,Bt=function(){if(bt)return mt;bt=1,mt=e;var s=3;function e(i,o,h){var f=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var g=new Int32Array(this.arrayBuffer);i=g[0],this.d=(o=g[1])+2*(h=g[2]);for(var w=0;w<this.d*this.d;w++){var C=g[s+w],O=g[s+w+1];f.push(C===O?null:g.subarray(C,O))}var j=g[s+f.length+1];this.keys=g.subarray(g[s+f.length],j),this.bboxes=g.subarray(j),this.insert=this._insertReadonly}else{this.d=o+2*h;for(var W=0;W<this.d*this.d;W++)f.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=i,this.padding=h,this.scale=o/i,this.uid=0;var K=h/o*i;this.min=-K,this.max=i+K}return e.prototype.insert=function(i,o,h,f,g){this._forEachCell(o,h,f,g,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(f),this.bboxes.push(g)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,o,h,f,g,w){this.cells[g].push(w)},e.prototype.query=function(i,o,h,f,g){var w=this.min,C=this.max;if(i<=w&&o<=w&&C<=h&&C<=f&&!g)return Array.prototype.slice.call(this.keys);var O=[];return this._forEachCell(i,o,h,f,this._queryCell,O,{},g),O},e.prototype._queryCell=function(i,o,h,f,g,w,C,O){var j=this.cells[g];if(j!==null)for(var W=this.keys,K=this.bboxes,oe=0;oe<j.length;oe++){var ue=j[oe];if(C[ue]===void 0){var be=4*ue;(O?O(K[be+0],K[be+1],K[be+2],K[be+3]):i<=K[be+2]&&o<=K[be+3]&&h>=K[be+0]&&f>=K[be+1])?(C[ue]=!0,w.push(W[ue])):C[ue]=!1}}},e.prototype._forEachCell=function(i,o,h,f,g,w,C,O){for(var j=this._convertToCellCoord(i),W=this._convertToCellCoord(o),K=this._convertToCellCoord(h),oe=this._convertToCellCoord(f),ue=j;ue<=K;ue++)for(var be=W;be<=oe;be++){var ke=this.d*be+ue;if((!O||O(this._convertFromCellCoord(ue),this._convertFromCellCoord(be),this._convertFromCellCoord(ue+1),this._convertFromCellCoord(be+1)))&&g.call(this,i,o,h,f,ke,w,C,O))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,o=s+this.cells.length+1+1,h=0,f=0;f<this.cells.length;f++)h+=this.cells[f].length;var g=new Int32Array(o+h+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var w=o,C=0;C<i.length;C++){var O=i[C];g[s+C]=w,g.set(O,w),w+=O.length}return g[s+i.length]=w,g.set(this.keys,w),g[s+i.length+1]=w+=this.keys.length,g.set(this.bboxes,w),w+=this.bboxes.length,g.buffer},mt}(),gt=Rn(Bt);const Lt={};function qe(s,e,i={}){Object.defineProperty(s,"_classRegistryKey",{value:e,writable:!1}),Lt[e]={klass:s,omit:i.omit||[]}}qe(Object,"Object"),gt.serialize=function(s,e){const i=s.toArrayBuffer();return e&&e.add(i),{buffer:i}},gt.deserialize=function(s){return new gt(s.buffer)},Object.defineProperty(gt,"name",{value:"Grid"}),qe(gt,"Grid"),typeof DOMMatrix<"u"&&qe(DOMMatrix,"DOMMatrix"),qe(So,"Color"),qe(Error,"Error"),qe(Wa,"Formatted"),qe(Ad,"FormattedSection"),qe(Gr,"AJAXError"),qe(cl,"ResolvedImage"),qe(je,"StylePropertyFunction"),qe(wp,"StyleExpression",{omit:["_evaluator"]}),qe(fl,"ImageId"),qe(Jd,"ImageVariant"),qe(xe,"ZoomDependentExpression"),qe(ge,"ZoomConstantExpression"),qe(Aa,"CompoundExpression",{omit:["_evaluate"]});for(const s in Oh)Lt[Oh[s]._classRegistryKey]||qe(Oh[s],`Expression${s}`);function vt(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function _t(s){return self.ImageBitmap&&s instanceof ImageBitmap}function Wt(s,e){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(vt(s)||_t(s))return e&&e.add(s),s;if(ArrayBuffer.isView(s))return e&&e.add(s.buffer),s;if(s instanceof ImageData)return e&&e.add(s.data.buffer),s;if(Array.isArray(s)){const i=[];for(const o of s)i.push(Wt(o,e));return i}if(s instanceof Map){const i={$name:"Map",entries:[]};for(const[o,h]of s.entries())i.entries.push(Wt(o),Wt(h,e));return i}if(s instanceof Set){const i={$name:"Set"};let o=0;for(const h of s.values())i[++o]=Wt(h);return i}if(s instanceof DOMMatrix){const i={$name:"DOMMatrix"},o=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const h of o)i[h]=s[h];return i}if(typeof s=="bigint")return{$name:"BigInt",value:s.toString()};if(typeof s=="object"){const i=s.constructor,o=i._classRegistryKey;if(!o)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const h=i.serialize?i.serialize(s,e):{};if(!i.serialize){for(const f in s)s.hasOwnProperty(f)&&(Lt[o].omit.indexOf(f)>=0||(h[f]=Wt(s[f],e)));s instanceof Error&&(h.message=s.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(h.$name=o),h}throw new Error("can't serialize object of type "+typeof s)}function Gt(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||vt(s)||_t(s)||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(Gt);if(typeof s=="object"){const e=s.$name||"Object";if(e==="Map"){const h=s.entries||[],f=new Map;for(let g=0;g<h.length;g+=2)f.set(Gt(h[g]),Gt(h[g+1]));return f}if(e==="Set"){const h=new Set;for(const f of Object.keys(s))f!=="$name"&&h.add(Gt(s[f]));return h}if(e==="DOMMatrix"){let h;return h=s.is2D?[s.a,s.b,s.c,s.d,s.e,s.f]:[s.m11,s.m12,s.m13,s.m14,s.m21,s.m22,s.m23,s.m24,s.m31,s.m32,s.m33,s.m34,s.m41,s.m42,s.m43,s.m44],new DOMMatrix(h)}if(e==="BigInt")return BigInt(s.value);const{klass:i}=Lt[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(s);const o=Object.create(i.prototype);for(const h of Object.keys(s))h!=="$name"&&(o[h]=Gt(s[h]));return o}throw new Error("can't deserialize object of type "+typeof s)}const Vt={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519,Osage:s=>s>=66736&&s<=66815,"CJK Unified Ideographs Extension B":s=>s>=131072&&s<=173791};function ji(s){for(const e of s)if(os(e.charCodeAt(0)))return!0;return!1}function Ms(s){for(const e of s)if(!zi(e.charCodeAt(0)))return!1;return!0}function zi(s){return!(Vt.Arabic(s)||Vt["Arabic Supplement"](s)||Vt["Arabic Extended-A"](s)||Vt["Arabic Presentation Forms-A"](s)||Vt["Arabic Presentation Forms-B"](s))}function os(s){return!(s!==746&&s!==747&&(s<4352||!(Vt["Bopomofo Extended"](s)||Vt.Bopomofo(s)||Vt["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||Vt["CJK Compatibility Ideographs"](s)||Vt["CJK Compatibility"](s)||Vt["CJK Radicals Supplement"](s)||Vt["CJK Strokes"](s)||!(!Vt["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||Vt["CJK Unified Ideographs Extension A"](s)||Vt["CJK Unified Ideographs"](s)||Vt["Enclosed CJK Letters and Months"](s)||Vt["Hangul Compatibility Jamo"](s)||Vt["Hangul Jamo Extended-A"](s)||Vt["Hangul Jamo Extended-B"](s)||Vt["Hangul Jamo"](s)||Vt["Hangul Syllables"](s)||Vt.Hiragana(s)||Vt["Ideographic Description Characters"](s)||Vt.Kanbun(s)||Vt["Kangxi Radicals"](s)||Vt["Katakana Phonetic Extensions"](s)||Vt.Katakana(s)&&s!==12540||!(!Vt["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!Vt["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||Vt["Unified Canadian Aboriginal Syllabics"](s)||Vt["Unified Canadian Aboriginal Syllabics Extended"](s)||Vt["Vertical Forms"](s)||Vt["Yijing Hexagram Symbols"](s)||Vt["Yi Syllables"](s)||Vt["Yi Radicals"](s))))}function Fs(s){return!(os(s)||function(e){return!!(Vt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Vt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Vt["Letterlike Symbols"](e)||Vt["Number Forms"](e)||Vt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Vt["Control Pictures"](e)&&e!==9251||Vt["Optical Character Recognition"](e)||Vt["Enclosed Alphanumerics"](e)||Vt["Geometric Shapes"](e)||Vt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Vt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Vt["CJK Symbols and Punctuation"](e)||Vt.Katakana(e)||Vt["Private Use Area"](e)||Vt["CJK Compatibility Forms"](e)||Vt["Small Form Variants"](e)||Vt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(s))}function Xi(s){return Vt.Arabic(s)||Vt["Arabic Supplement"](s)||Vt["Arabic Extended-A"](s)||Vt["Arabic Presentation Forms-A"](s)||Vt["Arabic Presentation Forms-B"](s)}function Es(s){return s>=1424&&s<=2303||Vt["Arabic Presentation Forms-A"](s)||Vt["Arabic Presentation Forms-B"](s)}function Ns(s,e){return!(!e&&Es(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||Vt.Khmer(s))}function rr(s){for(const e of s)if(Es(e.charCodeAt(0)))return!0;return!1}const bs={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Ks=null,or=bs.unavailable,Jo=null;const co=function(s){s&&typeof s=="string"&&s.indexOf("NetworkError")>-1&&(or=bs.error),Ks&&Ks(s)};function eo(){ya.fire(new Ln("pluginStateChange",{pluginStatus:or,pluginURL:Jo}))}const ya=new zc,ta=function(){return or},Ea=function(){if(or!==bs.deferred||!Jo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");or=bs.loading,eo(),Jo&&Ch({url:Jo},s=>{s?co(s):(or=bs.loaded,eo())})},mn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>or===bs.loaded||mn.applyArabicShaping!=null,isLoading:()=>or===bs.loading,setState(s){or=s.pluginStatus,Jo=s.pluginURL},isParsing:()=>or===bs.parsing,isParsed:()=>or===bs.parsed,getPluginURL:()=>Jo};class qr{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness,this.worldview=i.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,o){for(const h of i)if(!Ns(h.charCodeAt(0),o))return!1;return!0}(e,mn.isLoaded())}}class Sl{constructor(e,i,o,h){this.property=e,this.value=i,this.expression=function(f,g,w,C){if(Bu(f))return new je(f,g);if(Ge(f)||Array.isArray(f)&&f.length>0){const O=Ie(f,g,w,C);if(O.result==="error")throw new Error(O.value.map(j=>`${j.key}: ${j.message}`).join(", "));return O.value}{let O=f;return typeof f=="string"&&g.type==="color"&&(O=So.parse(f)),{kind:"constant",configDependencies:new Set,evaluate:()=>O}}}(i===void 0?e.specification.default:i,e.specification,o,h)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,o){return this.property.possiblyEvaluate(this,e,i,o)}}class oo{constructor(e,i,o){this.property=e,this.value=new Sl(e,void 0,i,o)}transitioned(e,i){return new am(this.property,this.value,i,qt({},e.transition,this.transition),e.now)}untransitioned(){return new am(this.property,this.value,null,{},0)}}class Hc{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=o,this.configDependencies=new Set}getValue(e){return mr(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new oo(this._values[e].property,this._scope,this._options)),this._values[e].value=new Sl(this._values[e].property,i===null?void 0:mr(i),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const o=this._properties.properties;if(e)for(const h in e){const f=e[h];if(h.endsWith("-transition")){const g=h.slice(0,-11);o[g]&&this.setTransition(g,f)}else o.hasOwnProperty(h)&&this.setValue(h,f)}}getTransition(e){return mr(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new oo(this._values[e].property)),this._values[e].transition=mr(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o);const h=this.getTransition(i);h!==void 0&&(e[`${i}-transition`]=h)}return e}transitioned(e,i){const o=new pn(this._properties);for(const h of Object.keys(this._values))o._values[h]=this._values[h].transitioned(e,i._values[h]);return o}untransitioned(){const e=new pn(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class am{constructor(e,i,o,h,f){const g=h.delay||0,w=h.duration||0;f=f||0,this.property=e,this.value=i,this.begin=f+g,this.end=this.begin+w,e.specification.transition&&(h.delay||h.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){const h=e.now||0,f=this.value.possiblyEvaluate(e,i,o),g=this.prior;if(g){if(h>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(h<this.begin)return g.possiblyEvaluate(e,i,o);{const w=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,i,o),f,We(w))}}return f}}class pn{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){const h=new tp(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(e,i,o);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Cg{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=o,this.configDependencies=new Set}getValue(e){return mr(this._values[e].value)}setValue(e,i){this._values[e]=new Sl(this._values[e].property,i===null?void 0:mr(i),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o){const h=new tp(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(e,i,o);return h}}class wf{constructor(e,i,o){this.property=e,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,h){return this.property.evaluate(this.value,this.parameters,e,i,o,h)}}class tp{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Oi{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,o){const h=lh[this.specification.type];return h?h(e,i,o):e}}class ms{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,h){return new wf(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},o,h)}:e.expression,i)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new wf(this,{kind:"constant",value:void 0},e.parameters);const h=lh[this.specification.type];return h?new wf(this,{kind:"constant",value:h(e.value.value,i.value.value,o)},e.parameters):e}evaluate(e,i,o,h,f,g){return e.kind==="constant"?e.value:e.evaluate(i,o,h,f,g)}}class Tp{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,h){return!!e.expression.evaluate(i,null,{},o,h)}interpolate(){return!1}}class kn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new qr(0,{});for(const o in e){const h=e[o];h.specification.overridable&&this.overridableProperties.push(o);const f=this.defaultPropertyValues[o]=new Sl(h,void 0),g=this.defaultTransitionablePropertyValues[o]=new oo(h);this.defaultTransitioningPropertyValues[o]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=f.possiblyEvaluate(i)}}}qe(ms,"DataDrivenProperty"),qe(Oi,"DataConstantProperty"),qe(Tp,"ColorRampProperty");var Zt=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-wall-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function vh(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function zm(s){if(Array.isArray(s))return s.map(zm);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const e={};for(const i in s)e[i]=zm(s[i]);return e}return vh(s)}function Ho(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const e of s.slice(1))if(!Ho(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function hg(s,e="",i=null,o="fill"){if(s==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ho(s)||(s=Fu(s));const h=s;let f=!0;try{f=function(j){if(!ip(j))return j;let W=zm(j);return Fl(W),W=Pg(W),W}(h)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(h,null,2)}
        `)}let g=null,w=null;if(o!=="background"&&o!=="sky"&&o!=="slot"){w=Zt[`filter_${o}`];const j=J(f,w,e,i);if(j.result==="error")throw new Error(j.value.map(W=>`${W.key}: ${W.message}`).join(", "));g=(W,K,oe)=>j.value.evaluate(W,K,{},oe)}let C=null,O=null;if(f!==h){const j=J(h,w,e,i);if(j.result==="error")throw new Error(j.value.map(W=>`${W.key}: ${W.message}`).join(", "));C=(W,K,oe,ue,be)=>j.value.evaluate(W,K,{},oe,void 0,void 0,ue,be),O=!sr(j.value.expression)}return{filter:g,dynamicFilter:C||void 0,needGeometry:xa(f),needFeature:!!O}}function Pg(s){if(!Array.isArray(s))return s;const e=function(i){if(Ml.has(i[0])){for(let o=1;o<i.length;o++)if(ip(i[o]))return!0}return i}(s);return e===!0?e:e.map(i=>Pg(i))}function Fl(s){let e=!1;const i=[];if(s[0]==="case"){for(let o=1;o<s.length-1;o+=2)e=e||ip(s[o]),i.push(s[o+1]);i.push(s[s.length-1])}else if(s[0]==="match"){e=e||ip(s[1]);for(let o=2;o<s.length-1;o+=2)i.push(s[o+1]);i.push(s[s.length-1])}else if(s[0]==="step"){e=e||ip(s[1]);for(let o=1;o<s.length-1;o+=2)i.push(s[o+1])}e&&(s.length=0,s.push("any",...i));for(let o=1;o<s.length;o++)Fl(s[o])}function ip(s){if(!Array.isArray(s))return!1;if((e=s[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<s.length;i++)if(ip(s[i]))return!0;return!1}const Ml=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ny(s,e){return s<e?-1:s>e?1:0}function xa(s){if(!Array.isArray(s))return!1;if(s[0]==="within"||s[0]==="distance")return!0;for(let e=1;e<s.length;e++)if(xa(s[e]))return!0;return!1}function Fu(s){if(!s)return!0;const e=s[0];return s.length<=1?e!=="any":e==="=="?el(s[1],s[2],"=="):e==="!="?ia(el(s[1],s[2],"==")):e==="<"||e===">"||e==="<="||e===">="?el(s[1],s[2],e):e==="any"?(i=s.slice(1),["any"].concat(i.map(Fu))):e==="all"?["all"].concat(s.slice(1).map(Fu)):e==="none"?["all"].concat(s.slice(1).map(Fu).map(ia)):e==="in"?tl(s[1],s.slice(2)):e==="!in"?ia(tl(s[1],s.slice(2))):e==="has"?cg(s[1]):e!=="!has"||ia(cg(s[1]));var i}function el(s,e,i){switch(s){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,s,e]}}function tl(s,e){if(e.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",s,["literal",e.sort(ny)]]:["filter-in-small",s,["literal",e]]}}function cg(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function ia(s){return["!",s]}const Dh="";function hu(s,e){return e?`${s}${Dh}${e}`:s}const Nl="-transition",_a=new Set(["fill","line","background","hillshade","raster"]);class th extends zc{constructor(e,i,o,h,f){if(super(),this.id=e.id,this.fqid=hu(this.id,o),this.type=e.type,this.scope=o,this.lut=h,this.options=f,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const g=J(this.filter,Zt[`filter_${e.type}`]);g.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...g.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new Cg(i.layout,this.scope,f),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new Hc(i.paint,this.scope,f);for(const g in e.paint)this.setPaintProperty(g,e.paint[g]);for(const g in e.layout)this.setLayoutProperty(g,e.layout[g]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new tp(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&_a.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const o=this._unevaluatedLayout;o._properties.properties[e]&&(o.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Nl)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const o=this._transitionablePaint,h=o._properties.properties;if(e.endsWith(Nl)){const W=e.slice(0,-11);return h[W]&&o.setTransition(W,i||void 0),!1}if(!h[e])return!1;const f=o._values[e],g=f.value.isDataDriven(),w=f.value;o.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const C=o._values[e].value,O=C.isDataDriven(),j=e.endsWith("pattern")||e==="line-dasharray";return O||g||j||this._handleOverridablePaintPropertyUpdate(e,w,C)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,o){return null}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return Ws({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof wf&&bp(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=hg(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,o,h,f,g,w,C,O){}}const Rm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class On{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Vo{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&i.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function bo(s,e=1){let i=0,o=0;return{members:s.map(h=>{const f=Rm[h.type].BYTES_PER_ELEMENT,g=i=Dd(i,Math.max(e,f)),w=h.components||1;return o=Math.max(o,f),i+=f*w,{name:h.name,type:h.type,components:w,offset:g}}),size:Dd(i,Math.max(o,e)),alignment:e}}function Dd(s,e){return Math.ceil(s/e)*e}class Vl extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const h=2*e;return this.int16[h+0]=i,this.int16[h+1]=o,e}}Vl.prototype.bytesPerElement=4,qe(Vl,"StructArrayLayout2i4");class Tf extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o)}emplace(e,i,o,h){const f=3*e;return this.int16[f+0]=i,this.int16[f+1]=o,this.int16[f+2]=h,e}}Tf.prototype.bytesPerElement=6,qe(Tf,"StructArrayLayout3i6");class Sf extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,h)}emplace(e,i,o,h,f){const g=4*e;return this.int16[g+0]=i,this.int16[g+1]=o,this.int16[g+2]=h,this.int16[g+3]=f,e}}Sf.prototype.bytesPerElement=8,qe(Sf,"StructArrayLayout4i8");class Sp extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Sp.prototype.bytesPerElement=4,qe(Sp,"StructArrayLayout1f4");class Nu extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o)}emplace(e,i,o,h){const f=4*e,g=2*e;return this.int16[f+0]=i,this.int16[f+1]=o,this.float32[g+1]=h,e}}Nu.prototype.bytesPerElement=8,qe(Nu,"StructArrayLayout2i1f8");class Mp extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o)}emplace(e,i,o,h){const f=4*e;return this.int16[f+0]=i,this.int16[f+1]=o,this.int16[f+2]=h,e}}Mp.prototype.bytesPerElement=8,qe(Mp,"StructArrayLayout3i8");class cu extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,o,h,f)}emplace(e,i,o,h,f,g){const w=5*e;return this.int16[w+0]=i,this.int16[w+1]=o,this.int16[w+2]=h,this.int16[w+3]=f,this.int16[w+4]=g,e}}cu.prototype.bytesPerElement=10,qe(cu,"StructArrayLayout5i10");class dd extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,f,g,w){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,o,h,f,g,w)}emplace(e,i,o,h,f,g,w,C){const O=6*e,j=12*e,W=3*e;return this.int16[O+0]=i,this.int16[O+1]=o,this.uint8[j+4]=h,this.uint8[j+5]=f,this.uint8[j+6]=g,this.uint8[j+7]=w,this.float32[W+2]=C,e}}dd.prototype.bytesPerElement=12,qe(dd,"StructArrayLayout2i4ub1f12");class Xc extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o)}emplace(e,i,o,h){const f=3*e;return this.float32[f+0]=i,this.float32[f+1]=o,this.float32[f+2]=h,e}}Xc.prototype.bytesPerElement=12,qe(Xc,"StructArrayLayout3f12");class Kp extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,o,h,f)}emplace(e,i,o,h,f,g){const w=6*e,C=3*e;return this.uint16[w+0]=i,this.uint16[w+1]=o,this.uint16[w+2]=h,this.uint16[w+3]=f,this.float32[C+2]=g,e}}Kp.prototype.bytesPerElement=12,qe(Kp,"StructArrayLayout4ui1f12");class Bm extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,h)}emplace(e,i,o,h,f){const g=4*e;return this.uint16[g+0]=i,this.uint16[g+1]=o,this.uint16[g+2]=h,this.uint16[g+3]=f,e}}Bm.prototype.bytesPerElement=8,qe(Bm,"StructArrayLayout4ui8");class ud extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,f,g){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,o,h,f,g)}emplace(e,i,o,h,f,g,w){const C=6*e;return this.int16[C+0]=i,this.int16[C+1]=o,this.int16[C+2]=h,this.int16[C+3]=f,this.int16[C+4]=g,this.int16[C+5]=w,e}}ud.prototype.bytesPerElement=12,qe(ud,"StructArrayLayout6i12");class Ap extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,f,g,w,C,O,j,W,K){const oe=this.length;return this.resize(oe+1),this.emplace(oe,e,i,o,h,f,g,w,C,O,j,W,K)}emplace(e,i,o,h,f,g,w,C,O,j,W,K,oe){const ue=12*e;return this.int16[ue+0]=i,this.int16[ue+1]=o,this.int16[ue+2]=h,this.int16[ue+3]=f,this.uint16[ue+4]=g,this.uint16[ue+5]=w,this.uint16[ue+6]=C,this.uint16[ue+7]=O,this.int16[ue+8]=j,this.int16[ue+9]=W,this.int16[ue+10]=K,this.int16[ue+11]=oe,e}}Ap.prototype.bytesPerElement=24,qe(Ap,"StructArrayLayout4i4ui4i24");class zd extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,f,g){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,o,h,f,g)}emplace(e,i,o,h,f,g,w){const C=10*e,O=5*e;return this.int16[C+0]=i,this.int16[C+1]=o,this.int16[C+2]=h,this.float32[O+2]=f,this.float32[O+3]=g,this.float32[O+4]=w,e}}zd.prototype.bytesPerElement=20,qe(zd,"StructArrayLayout3i3f20");class wn extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,h)}emplace(e,i,o,h,f){const g=4*e;return this.float32[g+0]=i,this.float32[g+1]=o,this.float32[g+2]=h,this.float32[g+3]=f,e}}wn.prototype.bytesPerElement=16,qe(wn,"StructArrayLayout4f16");class Mf extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Mf.prototype.bytesPerElement=4,qe(Mf,"StructArrayLayout1ul4");class wc extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const h=2*e;return this.uint16[h+0]=i,this.uint16[h+1]=o,e}}wc.prototype.bytesPerElement=4,qe(wc,"StructArrayLayout2ui4");class Tc extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,f,g,w,C,O,j,W,K,oe){const ue=this.length;return this.resize(ue+1),this.emplace(ue,e,i,o,h,f,g,w,C,O,j,W,K,oe)}emplace(e,i,o,h,f,g,w,C,O,j,W,K,oe,ue){const be=20*e,ke=10*e;return this.int16[be+0]=i,this.int16[be+1]=o,this.int16[be+2]=h,this.int16[be+3]=f,this.int16[be+4]=g,this.float32[ke+3]=w,this.float32[ke+4]=C,this.float32[ke+5]=O,this.float32[ke+6]=j,this.int16[be+14]=W,this.uint32[ke+8]=K,this.uint16[be+18]=oe,this.uint16[be+19]=ue,e}}Tc.prototype.bytesPerElement=40,qe(Tc,"StructArrayLayout5i4f1i1ul2ui40");class dg extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,f,g,w){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,o,h,f,g,w)}emplace(e,i,o,h,f,g,w,C){const O=8*e;return this.int16[O+0]=i,this.int16[O+1]=o,this.int16[O+2]=h,this.int16[O+4]=f,this.int16[O+5]=g,this.int16[O+6]=w,this.int16[O+7]=C,e}}dg.prototype.bytesPerElement=16,qe(dg,"StructArrayLayout3i2i2i16");class lm extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,o,h,f)}emplace(e,i,o,h,f,g){const w=4*e,C=8*e;return this.float32[w+0]=i,this.float32[w+1]=o,this.float32[w+2]=h,this.int16[C+6]=f,this.int16[C+7]=g,e}}lm.prototype.bytesPerElement=16,qe(lm,"StructArrayLayout2f1f2i16");class du extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,f,g){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,o,h,f,g)}emplace(e,i,o,h,f,g,w){const C=20*e,O=5*e;return this.uint8[C+0]=i,this.uint8[C+1]=o,this.float32[O+1]=h,this.float32[O+2]=f,this.float32[O+3]=g,this.float32[O+4]=w,e}}du.prototype.bytesPerElement=20,qe(du,"StructArrayLayout2ub4f20");class ml extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o)}emplace(e,i,o,h){const f=3*e;return this.uint16[f+0]=i,this.uint16[f+1]=o,this.uint16[f+2]=h,e}}ml.prototype.bytesPerElement=6,qe(ml,"StructArrayLayout3ui6");class Jp extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,f,g,w,C,O,j,W,K,oe,ue,be,ke,Fe,Qe,it,Se,Xe){const st=this.length;return this.resize(st+1),this.emplace(st,e,i,o,h,f,g,w,C,O,j,W,K,oe,ue,be,ke,Fe,Qe,it,Se,Xe)}emplace(e,i,o,h,f,g,w,C,O,j,W,K,oe,ue,be,ke,Fe,Qe,it,Se,Xe,st){const dt=30*e,Ot=15*e,Pt=60*e;return this.int16[dt+0]=i,this.int16[dt+1]=o,this.int16[dt+2]=h,this.float32[Ot+2]=f,this.float32[Ot+3]=g,this.uint16[dt+8]=w,this.uint16[dt+9]=C,this.uint32[Ot+5]=O,this.uint32[Ot+6]=j,this.uint32[Ot+7]=W,this.uint16[dt+16]=K,this.uint16[dt+17]=oe,this.uint16[dt+18]=ue,this.float32[Ot+10]=be,this.float32[Ot+11]=ke,this.uint8[Pt+48]=Fe,this.uint8[Pt+49]=Qe,this.uint8[Pt+50]=it,this.uint32[Ot+13]=Se,this.int16[dt+28]=Xe,this.uint8[Pt+58]=st,e}}Jp.prototype.bytesPerElement=60,qe(Jp,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class hm extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,f,g,w,C,O,j,W,K,oe,ue,be,ke,Fe,Qe,it,Se,Xe,st,dt,Ot,Pt,Dt,Jt,yi,$i,Ii,Hi,Ki,bi){const Gi=this.length;return this.resize(Gi+1),this.emplace(Gi,e,i,o,h,f,g,w,C,O,j,W,K,oe,ue,be,ke,Fe,Qe,it,Se,Xe,st,dt,Ot,Pt,Dt,Jt,yi,$i,Ii,Hi,Ki,bi)}emplace(e,i,o,h,f,g,w,C,O,j,W,K,oe,ue,be,ke,Fe,Qe,it,Se,Xe,st,dt,Ot,Pt,Dt,Jt,yi,$i,Ii,Hi,Ki,bi,Gi){const mi=20*e,xi=40*e,ss=80*e;return this.float32[mi+0]=i,this.float32[mi+1]=o,this.int16[xi+4]=h,this.int16[xi+5]=f,this.int16[xi+6]=g,this.int16[xi+7]=w,this.int16[xi+8]=C,this.int16[xi+9]=O,this.int16[xi+10]=j,this.int16[xi+11]=W,this.int16[xi+12]=K,this.uint16[xi+13]=oe,this.uint16[xi+14]=ue,this.uint16[xi+15]=be,this.uint16[xi+16]=ke,this.uint16[xi+17]=Fe,this.uint16[xi+18]=Qe,this.uint16[xi+19]=it,this.uint16[xi+20]=Se,this.uint16[xi+21]=Xe,this.uint16[xi+22]=st,this.uint16[xi+23]=dt,this.uint16[xi+24]=Ot,this.uint16[xi+25]=Pt,this.uint16[xi+26]=Dt,this.uint16[xi+27]=Jt,this.uint32[mi+14]=yi,this.float32[mi+15]=$i,this.float32[mi+16]=Ii,this.float32[mi+17]=Hi,this.float32[mi+18]=Ki,this.uint8[ss+76]=bi,this.uint16[xi+39]=Gi,e}}hm.prototype.bytesPerElement=80,qe(hm,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Qp extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,f,g){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,o,h,f,g)}emplace(e,i,o,h,f,g,w){const C=6*e;return this.float32[C+0]=i,this.float32[C+1]=o,this.float32[C+2]=h,this.float32[C+3]=f,this.float32[C+4]=g,this.float32[C+5]=w,e}}Qp.prototype.bytesPerElement=24,qe(Qp,"StructArrayLayout6f24");class sp extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,o,h,f)}emplace(e,i,o,h,f,g){const w=5*e;return this.float32[w+0]=i,this.float32[w+1]=o,this.float32[w+2]=h,this.float32[w+3]=f,this.float32[w+4]=g,e}}sp.prototype.bytesPerElement=20,qe(sp,"StructArrayLayout5f20");class rp extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,f,g,w){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,o,h,f,g,w)}emplace(e,i,o,h,f,g,w,C){const O=7*e;return this.float32[O+0]=i,this.float32[O+1]=o,this.float32[O+2]=h,this.float32[O+3]=f,this.float32[O+4]=g,this.float32[O+5]=w,this.float32[O+6]=C,e}}rp.prototype.bytesPerElement=28,qe(rp,"StructArrayLayout7f28");class uu extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,f,g,w,C,O,j,W){const K=this.length;return this.resize(K+1),this.emplace(K,e,i,o,h,f,g,w,C,O,j,W)}emplace(e,i,o,h,f,g,w,C,O,j,W,K){const oe=11*e;return this.float32[oe+0]=i,this.float32[oe+1]=o,this.float32[oe+2]=h,this.float32[oe+3]=f,this.float32[oe+4]=g,this.float32[oe+5]=w,this.float32[oe+6]=C,this.float32[oe+7]=O,this.float32[oe+8]=j,this.float32[oe+9]=W,this.float32[oe+10]=K,e}}uu.prototype.bytesPerElement=44,qe(uu,"StructArrayLayout11f44");class op extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,f,g,w,C,O){const j=this.length;return this.resize(j+1),this.emplace(j,e,i,o,h,f,g,w,C,O)}emplace(e,i,o,h,f,g,w,C,O,j){const W=9*e;return this.float32[W+0]=i,this.float32[W+1]=o,this.float32[W+2]=h,this.float32[W+3]=f,this.float32[W+4]=g,this.float32[W+5]=w,this.float32[W+6]=C,this.float32[W+7]=O,this.float32[W+8]=j,e}}op.prototype.bytesPerElement=36,qe(op,"StructArrayLayout9f36");class bh extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const h=2*e;return this.float32[h+0]=i,this.float32[h+1]=o,e}}bh.prototype.bytesPerElement=8,qe(bh,"StructArrayLayout2f8");class Sc extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,h)}emplace(e,i,o,h,f){const g=6*e;return this.uint32[3*e+0]=i,this.uint16[g+2]=o,this.uint16[g+3]=h,this.uint16[g+4]=f,e}}Sc.prototype.bytesPerElement=12,qe(Sc,"StructArrayLayout1ul3ui12");class Vu extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Vu.prototype.bytesPerElement=2,qe(Vu,"StructArrayLayout1ui2");class kp extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,f,g,w,C,O,j,W,K,oe,ue,be,ke){const Fe=this.length;return this.resize(Fe+1),this.emplace(Fe,e,i,o,h,f,g,w,C,O,j,W,K,oe,ue,be,ke)}emplace(e,i,o,h,f,g,w,C,O,j,W,K,oe,ue,be,ke,Fe){const Qe=16*e;return this.float32[Qe+0]=i,this.float32[Qe+1]=o,this.float32[Qe+2]=h,this.float32[Qe+3]=f,this.float32[Qe+4]=g,this.float32[Qe+5]=w,this.float32[Qe+6]=C,this.float32[Qe+7]=O,this.float32[Qe+8]=j,this.float32[Qe+9]=W,this.float32[Qe+10]=K,this.float32[Qe+11]=oe,this.float32[Qe+12]=ue,this.float32[Qe+13]=be,this.float32[Qe+14]=ke,this.float32[Qe+15]=Fe,e}}kp.prototype.bytesPerElement=64,qe(kp,"StructArrayLayout16f64");class Af extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,f,g,w){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,o,h,f,g,w)}emplace(e,i,o,h,f,g,w,C){const O=10*e,j=5*e;return this.uint16[O+0]=i,this.uint16[O+1]=o,this.uint16[O+2]=h,this.uint16[O+3]=f,this.float32[j+2]=g,this.float32[j+3]=w,this.float32[j+4]=C,e}}Af.prototype.bytesPerElement=20,qe(Af,"StructArrayLayout4ui3f20");class kf extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}kf.prototype.bytesPerElement=2,qe(kf,"StructArrayLayout1i2");class Yc extends Vo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}Yc.prototype.bytesPerElement=1,qe(Yc,"StructArrayLayout1ub1");class Mc extends On{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Mc.prototype.size=40;class Xo extends Tc{get(e){return new Mc(this,e)}}qe(Xo,"CollisionBoxArray");class Fm extends On{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Fm.prototype.size=60;class pd extends Jp{get(e){return new Fm(this,e)}}qe(pd,"PlacedSymbolArray");class Ep extends On{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Ep.prototype.size=80;class np extends hm{get(e){return new Ep(this,e)}}qe(np,"SymbolInstanceArray");class ap extends Sp{getoffsetX(e){return this.float32[1*e+0]}}qe(ap,"GlyphOffsetArray");class Ef extends Vl{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}qe(Ef,"SymbolLineVertexArray");class Uo extends On{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Uo.prototype.size=12;class Uu extends Sc{get(e){return new Uo(this,e)}}qe(Uu,"FeatureIndexArray");class $l extends wc{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}qe($l,"FillExtrusionCentroidArray");class Fn extends On{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Fn.prototype.size=6;class ef extends Tf{get(e){return new Fn(this,e)}}qe(ef,"FillExtrusionWallArray");const ug=bo([{name:"a_pos",components:2,type:"Int16"}],4),Cf=bo([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),zh=bo([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class sa{constructor(e=[]){this.segments=e}_prepareSegment(e,i,o,h){let f=this.segments[this.segments.length-1];return e>sa.MAX_VERTEX_ARRAY_LENGTH&&Ar(`Max vertices per segment is ${sa.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>sa.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==h)&&(f={vertexOffset:i,primitiveOffset:o,vertexLength:0,primitiveLength:0},h!==void 0&&(f.sortKey=h),this.segments.push(f)),f}prepareSegment(e,i,o,h){return this._prepareSegment(e,i.length,o.length,h)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,h){return new sa([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:h,vaos:{},sortKey:0}])}}function Ha(s,e){return 256*(s=at(Math.floor(s),0,255))+at(Math.floor(e),0,255)}sa.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,qe(sa,"SegmentVector");const Rd=bo([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),cm=bo([{name:"a_pattern_b",components:4,type:"Uint16"}]),dl=bo([{name:"a_dash",components:4,type:"Uint16"}]);class ju{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,o,h){this.ids.push(dm(e)),this.positions.push(i,o,h)}eachPosition(e,i){const o=dm(e);let h=0,f=this.ids.length-1;for(;h<f;){const g=h+f>>1;this.ids[g]>=o?f=g:h=g+1}for(;this.ids[h]===o;)i(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(e,i){const o=new Float64Array(e.ids),h=new Uint32Array(e.positions);return Pf(o,h,0,o.length-1),i&&(i.add(o.buffer),i.add(h.buffer)),{ids:o,positions:h}}static deserialize(e){const i=new ju;let o;i.ids=e.ids,i.positions=e.positions;for(const h of i.ids)h!==o&&i.uniqueIds.push(h),o=h;return i.indexed=!0,i}}function dm(s){const e=+s;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Ol(String(s))}function Pf(s,e,i,o){for(;i<o;){const h=s[i+o>>1];let f=i-1,g=o+1;for(;;){do f++;while(s[f]<h);do g--;while(s[g]>h);if(f>=g)break;fd(s,f,g),fd(e,3*f,3*g),fd(e,3*f+1,3*g+1),fd(e,3*f+2,3*g+2)}g-i<o-g?(Pf(s,e,i,g),i=g+1):(Pf(s,e,g+1,o),o=g)}}function fd(s,e,i){const o=s[e];s[e]=s[i],s[i]=o}qe(ju,"FeaturePositionMap");class pu{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,o){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Nm extends pu{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}}class ra extends pu{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class ih extends pu{constructor(e){super(e),this.current=[0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}}class fu extends pu{constructor(e){super(e),this.current=[0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}}class um extends pu{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class Gu extends pu{constructor(e){super(e),this.current=So.transparent.toPremultipliedRenderColor(null)}set(e,i,o){this.fetchUniformLocation(e,i)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}const pg=new Float32Array(16);class lp extends pu{constructor(e){super(e),this.current=pg}set(e,i,o){if(this.fetchUniformLocation(e,i)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let h=1;h<16;h++)if(o[h]!==this.current[h]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}}const tf=new Float32Array(9),mu=new Float32Array(4);class Wu extends pu{constructor(e){super(e),this.current=mu}set(e,i,o){if(this.fetchUniformLocation(e,i)){for(let h=0;h<4;h++)if(o[h]!==this.current[h]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}}function Cp(s){return[Ha(255*s.r,255*s.g),Ha(255*s.b,255*s.a)]}class Vm{constructor(e,i,o,h){this.value=e,this.uniformNames=i.map(f=>`u_${f}`),this.type=o,this.context=h}setUniform(e,i,o,h,f){const g=h.constantOr(this.value);i.set(e,f,g instanceof So?g.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):g)}getBinding(e,i){return this.type==="color"?new Gu(e):new ra(e)}}class If{constructor(e,i){this.uniformNames=i.map(o=>`u_${o}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,o,h,f){let g=null;f!=="u_pattern"&&f!=="u_dash"||(g=this.pattern),f==="u_pattern_b"&&(g=this.patternTransition),f==="u_pixel_ratio"&&(g=this.pixelRatio),g&&i.set(e,f,g)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new um(e):new ra(e)}}class md{constructor(e,i,o,h){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map(f=>({name:`a_${f}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,i,o,h,f,g,w,C){const O=this.paintVertexArray.length,j=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new qr(0,{brightness:g,worldview:C}),i,{},f,h,w):this.expression.kind==="constant"&&this.expression.value,W=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new qr(0,{brightness:g,worldview:C}),i,{},f,h,w):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(O,e,j,W?null:this.context.lut)}updatePaintArray(e,i,o,h,f,g,w,C){const O=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:w,worldview:C},o,h,void 0,f):this.expression.kind==="constant"&&this.expression.value,j=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new qr(0,{brightness:w,worldview:C}),o,h,void 0,f):this.lutExpression.value)==="none";this._setPaintValue(e,i,O,j?null:this.context.lut)}_setPaintValue(e,i,o,h){if(this.type==="color"){const f=Cp(o.toPremultipliedRenderColor(h));for(let g=e;g<i;g++)this.paintVertexArray.emplace(g,f[0],f[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ac{constructor(e,i,o,h,f,g){this.expression=e,this.uniformNames=i.map(w=>`u_${w}_t`),this.type=o,this.useIntegerZoom=h,this.context=f,this.maxValue=0,this.paintVertexAttributes=i.map(w=>({name:`a_${w}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,i,o,h,f,g,w,C){const O=this.expression.evaluate(new qr(this.context.zoom,{brightness:g,worldview:C}),i,{},f,h,w),j=this.expression.evaluate(new qr(this.context.zoom+1,{brightness:g,worldview:C}),i,{},f,h,w),W=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new qr(0,{brightness:g,worldview:C}),i,{},f,h,w):this.lutExpression.value)==="none",K=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(K,e,O,j,W?null:this.context.lut)}updatePaintArray(e,i,o,h,f,g,w,C){const O=this.expression.evaluate({zoom:this.context.zoom,brightness:w,worldview:C},o,h,void 0,f),j=this.expression.evaluate({zoom:this.context.zoom+1,brightness:w,worldview:C},o,h,void 0,f),W=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new qr(0,{brightness:w,worldview:C}),o,h,void 0,f):this.lutExpression.value)==="none";this._setPaintValue(e,i,O,j,W?null:this.context.lut)}_setPaintValue(e,i,o,h,f){if(this.type==="color"){const g=Cp(o.toPremultipliedRenderColor(f)),w=Cp(o.toPremultipliedRenderColor(f));for(let C=e;C<i;C++)this.paintVertexArray.emplace(C,g[0],g[1],w[0],w[1])}else{for(let g=e;g<i;g++)this.paintVertexArray.emplace(g,o,h);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,o,h,f){const g=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,w=at(this.expression.interpolationFactor(g,this.context.zoom,this.context.zoom+1),0,1);i.set(e,f,w)}getBinding(e,i){return new ra(e)}}class $c{constructor(e,i,o,h,f){this.expression=e,this.layerId=f,this.paintVertexAttributes=(o==="array"?dl:Rd).members;for(let g=0;g<i.length;++g);this.paintVertexArray=new h,this.paintTransitionVertexArray=new Bm}populatePaintArray(e,i,o,h){const f=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(f,e,i.patterns&&i.patterns[this.layerId],o)}updatePaintArray(e,i,o,h,f,g,w){this._setPaintValues(e,i,o.patterns&&o.patterns[this.layerId],g)}_setPaintValues(e,i,o,h){if(!h||!o)return;const f=h[o[0]],g=h[o[1]];if(f){if(f){const{tl:w,br:C,pixelRatio:O}=f;for(let j=e;j<i;j++)this.paintVertexArray.emplace(j,w[0],w[1],C[0],C[1],O)}if(g){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:w,br:C}=g;for(let O=e;O<i;O++)this.paintTransitionVertexArray.emplace(O,w[0],w[1],C[0],C[1])}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,cm.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class sf{constructor(e,i,o=()=>!0){this.binders={},this._buffers=[],this.context=i;const h=[];for(const f in e.paint._values){const g=e.paint.get(f);if(f.endsWith("-use-theme")||!o(f)||!(g instanceof wf&&bp(g.property.specification)))continue;const w=r(f,e.type),C=g.value,O=g.property.specification.type,j=!!g.property.useIntegerZoom,W=f==="line-dasharray"||f.endsWith("pattern"),K=e.paint.get(`${f}-use-theme`),oe=f==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||K&&K.value.kind!=="constant";if(C.kind!=="constant"||oe)if(C.kind==="source"||oe||W){const ue=b(f,O,"source");this.binders[f]=W?new $c(C,w,O,ue,e.id):new md(C,w,O,ue),h.push(`/a_${f}`)}else{const ue=b(f,O,"composite");this.binders[f]=new Ac(C,w,O,j,i,ue),h.push(`/z_${f}`)}else this.binders[f]=W?new If(C.value,w):new Vm(C.value,w,O,i),h.push(`/u_${f}`);K&&(this.binders[f].lutExpression=K.value)}this.cacheKey=h.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof md||i instanceof Ac?i.maxValue:0}populatePaintArrays(e,i,o,h,f,g,w,C){for(const O in this.binders){const j=this.binders[O];j.context=this.context,(j instanceof md||j instanceof Ac||j instanceof $c)&&j.populatePaintArray(e,i,o,h,f,g,w,C)}}setConstantPatternPositions(e,i){for(const o in this.binders){const h=this.binders[o];h instanceof If&&h.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof $c?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,o,h,f,g,w,C,O,j){let W=!1;const K=Object.keys(e),oe=K.length!==0&&!C,ue=oe?K:i.uniqueIds;this.context.lut=f.lut;for(const be in this.binders){const ke=this.binders[be];if(ke.context=this.context,(ke instanceof md||ke instanceof Ac||ke instanceof $c)&&ke.expression&&ke.expression.kind&&ke.expression.kind!=="constant"&&(ke.expression.isStateDependent===!0||ke.expression.isLightConstant===!1)){const Fe=f.paint.get(be);ke.expression=Fe.value;for(const Qe of ue){const it=e[Qe.toString()];i.eachPosition(Qe,(Se,Xe,st)=>{const dt=h.feature(Se);ke.updatePaintArray(Xe,st,dt,it,g,w,O,j)})}if(!oe)for(const Qe of o.uniqueIds){const it=e[Qe.toString()];o.eachPosition(Qe,(Se,Xe,st)=>{const dt=h.feature(Se);ke.updatePaintArray(Xe,st,dt,it,g,w,O,j)})}W=!0}}return W}defines(){const e=[];for(const i in this.binders){const o=this.binders[i];(o instanceof Vm||o instanceof If)&&e.push(...o.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof md||o instanceof Ac||o instanceof $c)for(let h=0;h<o.paintVertexAttributes.length;h++)e.push(o.paintVertexAttributes[h].name);if(o instanceof $c)for(let h=0;h<cm.members.length;h++)e.push(cm.members[h].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof Vm||o instanceof If||o instanceof Ac)for(const h of o.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const o in this.binders){const h=this.binders[o];if(h instanceof Vm||h instanceof If||h instanceof Ac)for(const f of h.uniformNames)i.push({name:f,property:o,binding:h.getBinding(e,f)})}return i}setUniforms(e,i,o,h,f){for(const{name:g,property:w,binding:C}of o)this.binders[w].setUniform(e,C,f,h.get(w),g)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof md||i instanceof Ac||i instanceof $c)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof $c&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const o=this.binders[i];(o instanceof md||o instanceof Ac||o instanceof $c)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof md||i instanceof Ac||i instanceof $c)&&i.destroy()}}}class c{constructor(e,i,o=()=>!0){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new sf(h,i,o);this.needsUpload=!1,this._featureMap=new ju,this._featureMapWithoutIds=new ju,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,o,h,f,g,w,C,O){for(const j in this.programConfigurations)this.programConfigurations[j].populatePaintArrays(e,i,h,f,g,w,C,O);i.id!==void 0?this._featureMap.add(i.id,o,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,o,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,h,f,g,w,C){for(const O of o)this.needsUpload=this.programConfigurations[O.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,O,h,f,g,w||0,C)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const t={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function r(s,e){return t[s]||[s.replace(`${e}-`,"").replace(/-/g,"_")]}const d={"line-pattern":{source:Kp,composite:Kp},"fill-pattern":{source:Kp,composite:Kp},"fill-extrusion-pattern":{source:Kp,composite:Kp},"line-dasharray":{source:Bm,composite:Bm}},_={color:{source:bh,composite:wn},number:{source:Sp,composite:bh}};function b(s,e,i){const o=d[s];return o&&o[i]||_[e][i]}qe(Vm,"ConstantBinder"),qe(If,"PatternConstantBinder"),qe(md,"SourceExpressionBinder"),qe($c,"PatternCompositeBinder"),qe(Ac,"CompositeExpressionBinder"),qe(sf,"ProgramConfiguration",{omit:["_buffers"]}),qe(c,"ProgramConfigurationSet");const E=ns/Math.PI/2,D=5,U=6,Z=16383,ie=64,de=[ie,32,16],ne=-E,me=E;function Ce(s,e,i,o=E){return i=lr(i),[s*Math.sin(i)*o,-e*o,s*Math.cos(i)*o]}function Me(s,e,i){return Ce(Math.cos(lr(s)),Math.sin(lr(s)),e,i)}const Pe=63710088e-1,Ne=2*Math.PI*Pe;class He{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new He(oi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,o=this.lat*i,h=e.lat*i,f=Math.sin(o)*Math.sin(h)+Math.cos(o)*Math.cos(h)*Math.cos((e.lng-this.lng)*i);return Pe*Math.acos(Math.min(f,1))}toBounds(e=0){const i=360*e/40075017,o=i/Math.cos(Math.PI/180*this.lat);return new lt({lng:this.lng-o,lat:this.lat-i},{lng:this.lng+o,lat:this.lat+i})}toEcef(e){return Me(this.lat,this.lng,E+e*E/Pe)}static convert(e){if(e instanceof He)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new He(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new He(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class lt{constructor(e,i){if(e)if(i)this.setSouthWest(e).setNorthEast(i);else if(e.length===4){const o=e;this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]])}else{const o=e;this.setSouthWest(o[0]).setNorthEast(o[1])}}setNorthEast(e){return this._ne=e instanceof He?new He(e.lng,e.lat):He.convert(e),this}setSouthWest(e){return this._sw=e instanceof He?new He(e.lng,e.lat):He.convert(e),this}extend(e){const i=this._sw,o=this._ne;let h,f;if(e instanceof He)h=e,f=e;else{if(!(e instanceof lt))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(lt.convert(e)):this.extend(He.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(He.convert(e)):this;if(h=e._sw,f=e._ne,!h||!f)return this}return i||o?(i.lng=Math.min(h.lng,i.lng),i.lat=Math.min(h.lat,i.lat),o.lng=Math.max(f.lng,o.lng),o.lat=Math.max(f.lat,o.lat)):(this._sw=new He(h.lng,h.lat),this._ne=new He(f.lng,f.lat)),this}getCenter(){return new He((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new He(this.getWest(),this.getNorth())}getSouthEast(){return new He(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:o}=He.convert(e);let h=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&h}static convert(e){if(e)return e instanceof lt?e:new lt(e)}}const ut=0,kt=25.5;function wt(s){return Ne*Math.cos(s*Math.PI/180)}function xt(s){return(180+s)/360}function pt(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function At(s,e){return s/wt(e)}function Ct(s){return 360*s-180}function ti(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function si(s,e){return s*wt(ti(e))}const wi=85.051129;function _i(s){return Math.cos(lr(at(s,-85.051129,wi)))}function Bi(s,e){const i=at(e,ut,kt),o=Math.pow(2,i);return _i(s)*Ne/(512*o)}function Kt(s){return 1/Math.cos(s*Math.PI/180)}function ui(s,e=0){const i=Math.exp(Math.PI*(1-(s.y+e/ns)/(1<<s.z)*2));return 80150034*i/(i*i+1)/ns/(1<<s.z)}class Ft{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){const o=He.convert(e);return new Ft(xt(o.lng),pt(o.lat),At(i,o.lat))}toLngLat(){return new He(Ct(this.x),ti(this.y))}toAltitude(){return si(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ne*Kt(ti(this.y))}}function Ai(s,e,i,o,h,f,g,w,C){const O=(e+o)/2,j=(i+h)/2,W=new Wi(O,j);w(W),function(K,oe,ue,be,ke,Fe){const Qe=ue-ke,it=be-Fe;return Math.abs((be-oe)*Qe-(ue-K)*it)/Math.hypot(Qe,it)}(W.x,W.y,f.x,f.y,g.x,g.y)>=C?(Ai(s,e,i,O,j,f,W,w,C),Ai(s,O,j,o,h,W,g,w,C)):s.push(g)}function ai(s,e,i){let o=s[0],h=o.x,f=o.y;e(o);const g=[o];for(let w=1;w<s.length;w++){const C=s[w],{x:O,y:j}=C;e(C),Ai(g,h,f,O,j,o,C,e,i),h=O,f=j,o=C}return g}function Di(s,e,i,o){if(o(e,i)){const h=e.add(i)._mult(.5);Di(s,e,h,o),Di(s,h,i,o)}else s.push(i)}function Yi(s,e){let i=s[0];const o=[i];for(let h=1;h<s.length;h++){const f=s[h];Di(o,i,f,e),i=f}return o}const Mi=Math.pow(2,14)-1,qi=-Mi-1;function _s(s,e){const i=Math.round(s.x*e),o=Math.round(s.y*e);return s.x=at(i,qi,Mi),s.y=at(o,qi,Mi),(i<s.x||i>s.x+1||o<s.y||o>s.y+1)&&Ar("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function Ts(s,e,i){const o=s.loadGeometry(),h=s.extent,f=ns/h;if(e&&i&&i.projection.isReprojectedInTileSpace){const g=1<<e.z,{scale:w,x:C,y:O,projection:j}=i,W=K=>{const oe=Ct((e.x+K.x/h)/g),ue=ti((e.y+K.y/h)/g),be=j.project(oe,ue);K.x=(be.x*w-C)*h,K.y=(be.y*w-O)*h};for(let K=0;K<o.length;K++)if(s.type!==1)o[K]=ai(o[K],W,1);else{const oe=[];for(const ue of o[K])ue.x<0||ue.x>=h||ue.y<0||ue.y>=h||(W(ue),oe.push(ue));o[K]=oe}}for(const g of o)for(const w of g)_s(w,f);return o}function us(s,e){return{type:s.type,id:s.id,properties:s.properties,geometry:e?Ts(s):[]}}var Os,Rs,Js,ur,Pr,Bo,Tn,xo={};function Yo(){if(Rs)return Os;Rs=1;var s=Zl();function e(h,f,g,w,C){this.properties={},this.extent=g,this.type=0,this._pbf=h,this._geometry=-1,this._keys=w,this._values=C,h.readFields(i,this,f)}function i(h,f,g){h==1?f.id=g.readVarint():h==2?function(w,C){for(var O=w.readVarint()+w.pos;w.pos<O;){var j=C._keys[w.readVarint()],W=C._values[w.readVarint()];C.properties[j]=W}}(g,f):h==3?f.type=g.readVarint():h==4&&(f._geometry=g.pos)}function o(h){for(var f,g,w=0,C=0,O=h.length,j=O-1;C<O;j=C++)w+=((g=h[j]).x-(f=h[C]).x)*(f.y+g.y);return w}return Os=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var h=this._pbf;h.pos=this._geometry;for(var f,g=h.readVarint()+h.pos,w=1,C=0,O=0,j=0,W=[];h.pos<g;){if(C<=0){var K=h.readVarint();w=7&K,C=K>>3}if(C--,w===1||w===2)O+=h.readSVarint(),j+=h.readSVarint(),w===1&&(f&&W.push(f),f=[]),f.push(new s(O,j));else{if(w!==7)throw new Error("unknown command "+w);f&&f.push(f[0].clone())}}return f&&W.push(f),W},e.prototype.bbox=function(){var h=this._pbf;h.pos=this._geometry;for(var f=h.readVarint()+h.pos,g=1,w=0,C=0,O=0,j=1/0,W=-1/0,K=1/0,oe=-1/0;h.pos<f;){if(w<=0){var ue=h.readVarint();g=7&ue,w=ue>>3}if(w--,g===1||g===2)(C+=h.readSVarint())<j&&(j=C),C>W&&(W=C),(O+=h.readSVarint())<K&&(K=O),O>oe&&(oe=O);else if(g!==7)throw new Error("unknown command "+g)}return[j,K,W,oe]},e.prototype.toGeoJSON=function(h,f,g){var w,C,O=this.extent*Math.pow(2,g),j=this.extent*h,W=this.extent*f,K=this.loadGeometry(),oe=e.types[this.type];function ue(Fe){for(var Qe=0;Qe<Fe.length;Qe++){var it=Fe[Qe];Fe[Qe]=[360*(it.x+j)/O-180,360/Math.PI*Math.atan(Math.exp((180-360*(it.y+W)/O)*Math.PI/180))-90]}}switch(this.type){case 1:var be=[];for(w=0;w<K.length;w++)be[w]=K[w][0];ue(K=be);break;case 2:for(w=0;w<K.length;w++)ue(K[w]);break;case 3:for(K=function(Fe){var Qe=Fe.length;if(Qe<=1)return[Fe];for(var it,Se,Xe=[],st=0;st<Qe;st++){var dt=o(Fe[st]);dt!==0&&(Se===void 0&&(Se=dt<0),Se===dt<0?(it&&Xe.push(it),it=[Fe[st]]):it.push(Fe[st]))}return it&&Xe.push(it),Xe}(K),w=0;w<K.length;w++)for(C=0;C<K[w].length;C++)ue(K[w][C])}K.length===1?K=K[0]:oe="Multi"+oe;var ke={type:"Feature",geometry:{type:oe,coordinates:K},properties:this.properties};return"id"in this&&(ke.id=this.id),ke},Os}function Nn(){if(ur)return Js;ur=1;var s=Yo();function e(o,h){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(i,this,h),this.length=this._features.length}function i(o,h,f){o===15?h.version=f.readVarint():o===1?h.name=f.readString():o===5?h.extent=f.readVarint():o===2?h._features.push(f.pos):o===3?h._keys.push(f.readString()):o===4&&h._values.push(function(g){for(var w=null,C=g.readVarint()+g.pos;g.pos<C;){var O=g.readVarint()>>3;w=O===1?g.readString():O===2?g.readFloat():O===3?g.readDouble():O===4?g.readVarint64():O===5?g.readVarint():O===6?g.readSVarint():O===7?g.readBoolean():null}return w}(f))}return Js=e,e.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var h=this._pbf.readVarint()+this._pbf.pos;return new s(this._pbf,h,this.extent,this._keys,this._values)},Js}function Er(){return Tn||(Tn=1,xo.VectorTile=function(){if(Bo)return Pr;Bo=1;var s=Nn();function e(i,o,h){if(i===3){var f=new s(h,h.readVarint()+h.pos);f.length&&(o[f.name]=f)}}return Pr=function(i,o){this.layers=i.readFields(e,{},o)},Pr}(),xo.VectorTileFeature=Yo(),xo.VectorTileLayer=Nn()),xo}var br=Er();const zr="3d_elevation_id",_n="level";class Xa{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,o){return this.get(e,!0,i,o)}optional(e,i,o){return this.get(e,!1,i,o)}success(){return this._valid}get(e,i,o,h){const f=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&f!==void 0&&!Number.isNaN(f)?o(h?h(f):f):i&&(this._valid=!1),this}}class Mo{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,o){return this.featureFunc(e,i,o)}parseVertex(e,i,o){return this.vertexFunc(e,i,o)}}const jo=new Mo((s,e,i)=>s.reset(e).require(zr,o=>{i.id=o}).optional("fixed_height_relative",o=>{i.constantHeight=o},Xr.decodeRelativeHeight).geometry(o=>{i.bounds=o},Am).success(),(s,e,i)=>s.reset(e).require(zr,o=>{i.id=o}).require("elevation_idx",o=>{i.idx=o}).require("extent",o=>{i.extent=o}).require("height_relative",o=>{i.height=o},Xr.decodeRelativeHeight).geometry(o=>{i.position=o},Xr.getPoint).success()),Yn=new Mo((s,e,i)=>s.reset(e).require(zr,o=>{i.id=o}).optional("fixed_height",o=>{i.constantHeight=o},Xr.decodeMetricHeight).geometry(o=>{i.bounds=o},Am).success(),(s,e,i)=>s.reset(e).require(zr,o=>{i.id=o}).require("elevation_idx",o=>{i.idx=o}).require("extent",o=>{i.extent=o}).require("height",o=>{i.height=o},Xr.decodeMetricHeight).geometry(o=>{i.position=o},Xr.getPoint).success());class Xr{static getPoint(e){return Mh(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){const i=[],o=[],h=e.length,f=new Xa;for(let w=0;w<h;w++){const C=e.feature(w),O=C.properties.hasOwnProperty("version")?String(C.properties.version):void 0,j=(g=O)?g==="1.0.1"?Yn:void 0:jo;if(j===void 0){Ar(`Unknown elevation feature version number ${O||"(unknown)"}`);continue}const W=C.properties.hasOwnProperty("type")?C.properties.type:void 0;if(W){if(br.VectorTileFeature.types[C.type]==="Point"&&W==="curve_point"){const K={};j.parseVertex(f,C,K)&&i.push(K)}else if(br.VectorTileFeature.types[C.type]==="Polygon"&&W==="curve_meta"){const K={};j.parseFeature(f,C,K)&&o.push(K)}}}var g;return{vertices:i,features:o}}}class $n{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,o){const h=To(i,this.dir);if(Math.abs(h)<1e-6)return!1;const f=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/h;return o[0]=this.pos[0]+this.dir[0]*f,o[1]=this.pos[1]+this.dir[1]*f,!0}}class hn{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,o){const h=Zo(i,this.dir);if(Math.abs(h)<1e-6)return!1;const f=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/h;return o[0]=this.pos[0]+this.dir[0]*f,o[1]=this.pos[1]+this.dir[1]*f,o[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(e,i,o){if(function(oe,ue){var be=oe[0],ke=oe[1],Fe=oe[2],Qe=ue[0],it=ue[1],Se=ue[2];return Math.abs(be-Qe)<=Ni*Math.max(1,Math.abs(be),Math.abs(Qe))&&Math.abs(ke-it)<=Ni*Math.max(1,Math.abs(ke),Math.abs(it))&&Math.abs(Fe-Se)<=Ni*Math.max(1,Math.abs(Fe),Math.abs(Se))}(this.pos,e)||i===0)return o[0]=o[1]=o[2]=0,!1;const[h,f,g]=this.dir,w=this.pos[0]-e[0],C=this.pos[1]-e[1],O=this.pos[2]-e[2],j=h*h+f*f+g*g,W=2*(w*h+C*f+O*g),K=W*W-4*j*(w*w+C*C+O*O-i*i);if(K<0){const oe=Math.max(-W/2,0),ue=w+h*oe,be=C+f*oe,ke=O+g*oe,Fe=Math.hypot(ue,be,ke);return o[0]=ue*i/Fe,o[1]=be*i/Fe,o[2]=ke*i/Fe,!1}{const oe=(-W-Math.sqrt(K))/(2*j);if(oe<0){const ue=Math.hypot(w,C,O);return o[0]=w*i/ue,o[1]=C*i/ue,o[2]=O*i/ue,!1}return o[0]=w+h*oe,o[1]=C+f*oe,o[2]=O+g*oe,!0}}}class cn{constructor(e,i,o,h,f){this.TL=e,this.TR=i,this.BR=o,this.BL=h,this.horizon=f}static fromInvProjectionMatrix(e,i,o){const h=[-1,1,1],f=[1,1,1],g=[1,-1,1],w=[-1,-1,1],C=mo(h,h,e),O=mo(f,f,e),j=mo(g,g,e),W=mo(w,w,e);return new cn(C,O,j,W,i/o)}}function dn(s,e,i){let o=1/0,h=-1/0;const f=[];for(const g of s){Qs(f,g,e);const w=Zo(f,i);o=Math.min(o,w),h=Math.max(h,w)}return[o,h]}function _o(s,e){let i=!0;for(let o=0;o<s.planes.length;o++){const h=s.planes[o];let f=0;for(let g=0;g<e.length;g++)f+=Zo(h,e[g])+h[3]>=0;if(f===0)return 0;f!==e.length&&(i=!1)}return i?2:1}function qn(s,e){for(const i of s.projections){const o=dn(e,s.points[0],i.axis);if(i.projection[1]<o[0]||i.projection[0]>o[1])return 0}return 1}function uh(s,e){let i=0;const o=[0,0,0,0];for(let g=0;g<s.length;g++)o[0]=s[g][0],o[1]=s[g][1],o[2]=s[g][2],o[3]=1,(h=o)[0]*(f=e)[0]+h[1]*f[1]+h[2]*f[2]+h[3]*f[3]>=0&&i++;var h,f;return i}class sn{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Go.fromPoints(this.points),this.projections=[],this.frustumEdges=[Qs([],this.points[2],this.points[3]),Qs([],this.points[0],this.points[3]),Qs([],this.points[4],this.points[0]),Qs([],this.points[5],this.points[1]),Qs([],this.points[6],this.points[2]),Qs([],this.points[7],this.points[3])];for(const o of this.frustumEdges){const h=[0,-o[2],o[1]],f=[o[2],0,-o[0]];this.projections.push({axis:h,projection:dn(this.points,this.points[0],h)}),this.projections.push({axis:f,projection:dn(this.points,this.points[0],f)})}}static fromInvProjectionMatrix(e,i,o,h){const f=Math.pow(2,o),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(O=>{const j=Ps([],O,e),W=1/j[3]/i*f;return(K=j)[0]=(oe=j)[0]*(ue=[W,W,h?1/j[3]:W,W])[0],K[1]=oe[1]*ue[1],K[2]=oe[2]*ue[2],K[3]=oe[3]*ue[3],K;var K,oe,ue}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(O=>{const j=Lo([],pa([],Qs([],g[O[0]],g[O[1]]),Qs([],g[O[2]],g[O[1]]))),W=-Zo(j,g[O[1]]);return j.concat(W)}),C=[];for(let O=0;O<g.length;O++)C.push([g[O][0],g[O][1],g[O][2]]);return new sn(C,w)}intersectsPrecise(e,i,o){for(let h=0;h<i.length;h++)if(!uh(e,i[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!uh(e,this.planes[h]))return 0;for(const h of o)for(const f of this.frustumEdges){const g=pa([],h,f),w=No(g);if(w===0)continue;gr(g,g,1/w);const C=dn(this.points,this.points[0],g),O=dn(e,this.points[0],g);if(C[0]>O[1]||O[0]>C[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const o=i[3];if(Zo([i[0],i[1],i[2]],e)+o<0)return!1}return!0}}class Go{static fromPoints(e){const i=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(const h of e)fi(i,i,h),xl(o,o,h);return new Go(i,o)}static fromTileIdAndHeight(e,i,o){const h=1<<e.canonical.z,f=e.canonical.x,g=e.canonical.y;return new Go([f/h,g/h,i],[(f+1)/h,(g+1)/h,o])}static applyTransform(e,i){const o=e.getCorners();for(let h=0;h<o.length;++h)mo(o[h],o[h],i);return Go.fromPoints(o)}static applyTransformFast(e,i){const o=[i[12],i[13],i[14]],h=[...o];for(let f=0;f<3;f++)for(let g=0;g<3;g++){const w=i[4*g+f],C=w*e.min[g],O=w*e.max[g];o[f]+=Math.min(C,O),h[f]+=Math.max(C,O)}return new Go(o,h)}static projectAabbCorners(e,i){const o=e.getCorners();for(let h=0;h<o.length;++h)mo(o[h],o[h],i);return o}constructor(e,i){this.min=e,this.max=i,this.center=gr([],on([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],o=Da(this.min),h=Da(this.max);for(let f=0;f<i.length;f++)o[f]=i[f]?this.min[f]:this.center[f],h[f]=i[f]?this.center[f]:this.max[f];return h[2]=this.max[2],new Go(o,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?_o(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?_o(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?qn(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?qn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}qe(Go,"Aabb");class hc{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,o=i[1],h=-i[0],f=(e.extent+1)*this.metersToTile;return[new Wi(Math.trunc(e.position[0]+o*f),Math.trunc(e.position[1]+h*f)),new Wi(Math.trunc(e.position[0]-o*f),Math.trunc(e.position[1]-h*f))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Rh{constructor(e,i,o,h,f,g){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:o,max:o},this.safeArea=i,this.constantHeight=o,this.constantHeight==null&&(this.constantHeight!=null||h.length!==0)){this.vertices=h,this.edges=f,this.edges=this.edges.filter(w=>{return w.a<this.vertices.length&&w.b<this.vertices.length&&!((C=this.vertices[w.a].position)[0]===(O=this.vertices[w.b].position)[0]&&C[1]===O[1]);var C,O}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const w of this.vertices)this.vertexProps.push({dir:Mh(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,w.height),this.heightRange.max=Math.max(this.heightRange.max,w.height);for(const w of this.edges){const C=this.vertices[w.a].position,O=this.vertices[w.b].position,j=Wl(ll(),O,C),W=Jc(j),K=Tu(ll(),j,1/W);this.edgeProps.push({vec:j,dir:K,len:W});const oe=this.vertexProps[w.a].dir,ue=this.vertexProps[w.b].dir;Sa(oe,oe,K),Sa(ue,ue,K)}for(const w of this.vertexProps)w.dir[0]===0&&w.dir[1]===0||Td(w.dir,w.dir);this.tessellate(g)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[o,h]=i;return js(this.vertices[this.edges[o].a].height,this.vertices[this.edges[o].b].height,h)}computeSlopeNormal(e,i){const o=this.getClosestEdge(e);if(!o)return pi(0,0,1);const h=o[0],f=this.edges[h],g=this.edgeProps[h].vec,w=pi(g[0],g[1],(this.vertices[f.b].height-this.vertices[f.a].height)*i),C=pi(w[1],-w[0],0);pa(C,C,w);const O=No(C);return O>0?gr(C,C,1/O):pi(0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,o=Number.POSITIVE_INFINITY,h=0;const f=Mh(e.x,e.y);for(let g=0;g<this.edges.length;g++){const w=this.edges[g],C=this.edgeProps[g].dir,O=new $n(f,this.edgeProps[g].dir),j=this.vertices[w.a].position,W=this.vertices[w.b].position,K=ll(),oe=ll(),ue=O.intersectsPlane(j,this.vertexProps[w.a].dir,K),be=O.intersectsPlane(W,this.vertexProps[w.b].dir,oe);if(!ue||!be)continue;const ke=Wl(ll(),oe,K),Fe=Wl(ll(),f,K),Qe=To(ke,ke),it=Qe>0?To(Fe,ke)/Qe:0,Se=at(it,0,1),Xe=Math.abs((it-Se)*this.edgeProps[g].len),st=Wl(ll(),f,j),dt=Xe+Math.abs(To(st,Mh(C[1],-C[0])));dt<o&&(i=g,o=dt,h=Se)}return[i,h]}tessellate(e){for(let i=this.edges.length-1;i>=0;--i){const o=this.edges[i].a,h=this.edges[i].b,{position:f,height:g,extent:w}=this.vertices[o],{position:C,height:O,extent:j}=this.vertices[h],W=this.vertexProps[o].dir,K=this.vertexProps[h].dir,oe=pi(f[0]/e,f[1]/e,g),ue=pi(C[0]/e,C[1]/e,O),be=pi(W[1],-W[0],0);gr(be,be,w);const ke=pi(K[1],-K[0],0);if(gr(ke,ke,j),this.distSqLines(pi(oe[0]+.5*be[0],oe[1]+.5*be[1],oe[2]+.5*be[2]),pi(ue[0]-.5*ke[0],ue[1]-.5*ke[1],ue[2]-.5*ke[2]),pi(oe[0]-.5*be[0],oe[1]-.5*be[1],oe[2]-.5*be[2]),pi(ue[0]+.5*ke[0],ue[1]+.5*ke[1],ue[2]+.5*ke[2]))<=.0025000000000000005)continue;const Fe=this.vertices.length,Qe=Sa(ll(),f,C);this.vertices.push({position:Tu(Qe,Qe,.5),height:.5*(g+O),extent:.5*(w+j)});const it=Sa(ll(),W,K);this.vertexProps.push({dir:Td(it,it)}),this.edges.splice(i,1),this.edgeProps.splice(i,1),this.edges.push({a:o,b:Fe}),this.edges.push({a:Fe,b:h});const Se=Wl(ll(),this.vertices[Fe].position,f),Xe=Jc(Se),st={vec:Se,dir:Tu(ll(),Se,1/Xe),len:Xe};this.edgeProps.push(st),this.edgeProps.push(st)}}distSqLines(e,i,o,h){const f=Io(Cs(),i,e),g=Io(Cs(),h,o),w=Io(Cs(),e,o),C=Zo(f,f),O=Zo(f,g),j=Zo(f,w),W=Zo(g,g),K=Zo(g,w),oe=C*W-O*O;if(oe===0){const ke=Zo(w,g)/Zo(g,g);return za(Ul(Cs(),o,h,ke),e)}const ue=(O*K-j*W)/oe,be=(C*K-O*j)/oe;return za(Ul(Cs(),e,i,ue),Ul(Cs(),o,h,be))}}class Bd{static parseFrom(e,i){const o=Xr.parse(e);if(!o)return[];let{vertices:h,features:f}=o;const g=1/ui(i);f.sort((j,W)=>j.id-W.id),h.sort((j,W)=>j.id-W.id||j.idx-W.idx),h=h.filter((j,W,K)=>W===K.findIndex(oe=>oe.id===j.id&&oe.idx===j.idx));const w=new Array;let C=0;const O=h.length;for(const j of f){if(j.constantHeight){w.push(new Rh(j.id,j.bounds,j.constantHeight));continue}for(;C!==O&&h[C].id<j.id;)C++;if(C===O||h[C].id!==j.id)continue;const W=new Array,K=new Array,oe=C;for(;C!==O&&h[C].id===j.id;){const ue=h[C];if(W.push({position:ue.position,height:ue.height,extent:ue.extent}),C!==oe&&h[C-1].idx===ue.idx-1){const be=C-oe;K.push({a:be-1,b:be})}C++}w.push(new Rh(j.id,j.bounds,void 0,W,K,g))}return w}static getElevationFeature(e,i){if(!i)return;const o=+e.properties[zr];return Number.isNaN(o)?void 0:i.find(h=>h.id===o)}}class gu{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*ns,this.yOffset=(e.y*this.zScale-i.y)*ns)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,o){const h=this.constantElevation(i,o);return h??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),o))}computeBiasedHeight(e,i){return i<=0?e:e+i*zt(0,i,e>=0?e:Math.abs(.5*e))}}qe(Rh,"ElevationFeature");class qc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Vl,this.indexArray=new ml,this.segments=new sa,this.programConfigurations=new c(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Sp),this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,o,h){const f=this.layers[0],g=[];let w=null;f.type==="circle"&&(w=f.layout.get("circle-sort-key"));for(const{feature:O,id:j,index:W,sourceLayerIndex:K}of e){const oe=this.layers[0]._featureFilter.needGeometry,ue=us(O,oe);if(!this.layers[0]._featureFilter.filter(new qr(this.zoom,{worldview:this.worldview}),ue,o))continue;const be=w?w.evaluate(ue,{},o):void 0,ke={id:j,properties:O.properties,type:O.type,sourceLayerIndex:K,index:W,geometry:oe?ue.geometry:Ts(O,o,h),patterns:{},sortKey:be};g.push(ke)}w&&g.sort((O,j)=>O.sortKey-j.sortKey);let C=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new ud,C=h.projection);for(const O of g){const{geometry:j,index:W,sourceLayerIndex:K}=O,oe=e[W].feature;this.addFeature(O,j,W,i.availableImages,o,C,i.brightness,i.elevationFeatures),i.featureIndex.insert(oe,j,W,K,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,i,o,h,f,g,w){this.programConfigurations.updatePaintArrays(e,i,f,o,h,g,w,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ug.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,zh.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Cf.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,i,o,h,f,g,w,C){let O;this.elevationMode!=="none"&&(O=Bd.getElevationFeature(e,C));for(const j of i)for(const W of j){const K=W.x,oe=W.y;if(K<0||K>=ns||oe<0||oe>=ns)continue;if(g){const ke=g.projectTilePoint(K,oe,f),Fe=g.upVector(f,K,oe);this.addGlobeExtVertex(ke,Fe),this.addGlobeExtVertex(ke,Fe),this.addGlobeExtVertex(ke,Fe),this.addGlobeExtVertex(ke,Fe)}const ue=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),be=ue.vertexLength;if(this.addCircleVertex(K,oe,-1,-1),this.addCircleVertex(K,oe,1,-1),this.addCircleVertex(K,oe,1,1),this.addCircleVertex(K,oe,-1,1),this.elevationMode!=="none"){const ke=O?O.pointElevation(new Wi(K,oe)):0;this.hasElevation=this.hasElevation||ke!==0;for(let Fe=0;Fe<4;Fe++)this.elevatedLayoutVertexArray.emplaceBack(ke)}this.indexArray.emplaceBack(be,be+1,be+2),this.indexArray.emplaceBack(be,be+2,be+3),ue.vertexLength+=4,ue.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},h,f,w,void 0,this.worldview)}addCircleVertex(e,i,o,h){this.layoutVertexArray.emplaceBack(2*e+(o+1)/2,2*i+(h+1)/2)}addGlobeExtVertex(e,i){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}}function kc(s,e){for(let i=0;i<s.length;i++)if(gd(e,s[i]))return!0;for(let i=0;i<e.length;i++)if(gd(s,e[i]))return!0;return!!Lf(s,e)}function hp(s,e,i){return!!gd(s,e)||!!pm(e,s,i)}function Fd(s,e){if(s.length===1)return Pp(e,s[0]);for(let i=0;i<e.length;i++){const o=e[i];for(let h=0;h<o.length;h++)if(gd(s,o[h]))return!0}for(let i=0;i<s.length;i++)if(Pp(e,s[i]))return!0;for(let i=0;i<e.length;i++)if(Lf(s,e[i]))return!0;return!1}function yu(s,e,i){if(s.length>1){if(Lf(s,e))return!0;for(let o=0;o<e.length;o++)if(pm(e[o],s,i))return!0}for(let o=0;o<s.length;o++)if(pm(s[o],e,i))return!0;return!1}function Lf(s,e){if(s.length===0||e.length===0)return!1;for(let i=0;i<s.length-1;i++){const o=s[i],h=s[i+1];for(let f=0;f<e.length-1;f++)if(fg(o,h,e[f],e[f+1]))return!0}return!1}function fg(s,e,i,o){return Ko(s,i,o)!==Ko(e,i,o)&&Ko(s,e,i)!==Ko(s,e,o)}function Of(s,e,i){return(s.x-i.x)*(e.y-i.y)-(s.y-i.y)*(e.x-i.x)}function Df(s,e,i,o){const h=Of(s,e,o),f=Of(s,e,i);if(Math.sign(h)===Math.sign(f))return;const g=Of(i,o,s),w=g+f-h;return Math.sign(g)!==Math.sign(w)?[g/(g-w),f/(f-h)]:void 0}function pm(s,e,i){const o=i*i;if(e.length===1)return s.distSqr(e[0])<o;for(let h=1;h<e.length;h++)if(mg(s,e[h-1],e[h])<o)return!0;return!1}function mg(s,e,i){const o=e.distSqr(i);if(o===0)return s.distSqr(e);const h=((s.x-e.x)*(i.x-e.x)+(s.y-e.y)*(i.y-e.y))/o;return s.distSqr(h<0?e:h>1?i:i.sub(e)._mult(h)._add(e))}function Pp(s,e){let i,o,h,f=!1;for(let g=0;g<s.length;g++){i=s[g];for(let w=0,C=i.length-1;w<i.length;C=w++)o=i[w],h=i[C],o.y>e.y!=h.y>e.y&&e.x<(h.x-o.x)*(e.y-o.y)/(h.y-o.y)+o.x&&(f=!f)}return f}function gd(s,e){let i=!1;for(let o=0,h=s.length-1;o<s.length;h=o++){const f=s[o],g=s[h];f.y>e.y!=g.y>e.y&&e.x<(g.x-f.x)*(e.y-f.y)/(g.y-f.y)+f.x&&(i=!i)}return i}function fm(s,e,i,o,h){for(const g of s)if(e<=g.x&&i<=g.y&&o>=g.x&&h>=g.y)return!0;const f=[new Wi(e,i),new Wi(e,h),new Wi(o,h),new Wi(o,i)];if(s.length>2){for(const g of f)if(gd(s,g))return!0}for(let g=0;g<s.length-1;g++)if(xu(s[g],s[g+1],f))return!0;return!1}function xu(s,e,i){const o=i[0],h=i[2];if(s.x<o.x&&e.x<o.x||s.x>h.x&&e.x>h.x||s.y<o.y&&e.y<o.y||s.y>h.y&&e.y>h.y)return!1;const f=Ko(s,e,i[0]);return f!==Ko(s,e,i[1])||f!==Ko(s,e,i[2])||f!==Ko(s,e,i[3])}function Hu(s,e,i,o,h,f){let g=e.y-s.y,w=s.x-e.x;if(f=f||0){const C=g*g+w*w;if(C===0)return!0;const O=Math.sqrt(C);g/=O,w/=O}return!((i.x-s.x)*g+(i.y-s.y)*w-f<0||(o.x-s.x)*g+(o.y-s.y)*w-f<0||(h.x-s.x)*g+(h.y-s.y)*w-f<0)}function Ig(s,e,i,o,h,f,g){return!(Hu(s,e,o,h,f,g)||Hu(e,i,o,h,f,g)||Hu(i,s,o,h,f,g)||Hu(o,h,s,e,i,g)||Hu(h,f,s,e,i,g)||Hu(f,o,s,e,i,g))}function Um(s,e,i){const o=e.paint.get(s).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(s)}function ay(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function ly(s,e,i,o,h){if(!e[0]&&!e[1])return s;const f=Wi.convert(e)._mult(h);i==="viewport"&&f._rotate(-o);const g=[];for(let w=0;w<s.length;w++)g.push(s[w].sub(f));return g}function hy(s,e,i,o){const h=Wi.convert(s)._mult(o);return e==="viewport"&&h._rotate(-i),h}let yx,Lg;function xx(s,e,i){var o=2*Math.PI*6378137/256/Math.pow(2,i);return[s*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}qe(qc,"CircleBucket",{omit:["layers"]});class mm{constructor(e,i,o){this.z=e,this.x=i,this.y=o,this.key=gm(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const o=function(f,g,w){var C=xx(256*f,256*(g=Math.pow(2,w)-g-1),w),O=xx(256*(f+1),256*(g+1),w);return C[0]+","+C[1]+","+O[0]+","+O[1]}(this.x,this.y,this.z),h=function(f,g,w){let C,O="";for(let j=f;j>0;j--)C=1<<j-1,O+=(g&C?1:0)+(w&C?2:0);return O}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ny{constructor(e,i){this.wrap=e,this.canonical=i,this.key=gm(e,i.z,i.z,i.x,i.y)}}class cc{constructor(e,i,o,h,f){this.overscaledZ=e,this.wrap=i,this.canonical=new mm(o,+h,+f),this.key=i===0&&e===o?this.canonical.key:gm(i,e,o,h,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new cc(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new cc(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return gm(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const o=this.canonical.z-e;return gm(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new cc(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,h=2*this.canonical.y;return[new cc(i,this.wrap,i,o,h),new cc(i,this.wrap,i,o+1,h),new cc(i,this.wrap,i,o,h+1),new cc(i,this.wrap,i,o+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new cc(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new cc(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ny(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function gm(s,e,i,o,h){const f=1<<Math.min(i,22);let g=f*(h%f)+o%f;return s&&i<22&&(g+=f*f*((s<0?-2*s-1:2*s)%(1<<2*(22-i)))),16*(32*g+i)+(e-i)}const cy=[s=>{let e=s.canonical.x-1,i=s.wrap;return e<0&&(e=(1<<s.canonical.z)-1,i--),new cc(s.overscaledZ,i,s.canonical.z,e,s.canonical.y)},s=>{let e=s.canonical.x+1,i=s.wrap;return e===1<<s.canonical.z&&(e=0,i++),new cc(s.overscaledZ,i,s.canonical.z,e,s.canonical.y)},s=>new cc(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,(s.canonical.y===0?1<<s.canonical.z:s.canonical.y)-1),s=>new cc(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y===(1<<s.canonical.z)-1?0:s.canonical.y+1)];qe(mm,"CanonicalTileID"),qe(cc,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const _x=bo([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:jm}=_x,Vy=bo([{name:"a_pos_3",components:3,type:"Int16"}]);var Uy=bo([{name:"a_pos",type:"Int16",components:2}]);function gg(s){return s*E/Pe}const vx=[new Go([ne,ne,ne],[me,me,me]),new Go([ne,ne,ne],[0,0,me]),new Go([0,ne,ne],[me,0,me]),new Go([ne,0,ne],[0,me,me]),new Go([0,0,ne],[me,me,me])];function bx(s,e,i,o=!0){const h=gr([],s._camera.position,s.worldSize),f=[e,i,1,1];Ps(f,f,s.pixelMatrixInverse),Lc(f,f,1/f[3]);const g=Lo([],Qs([],f,h)),w=s.globeMatrix,C=[w[12],w[13],w[14]],O=Qs([],C,h),j=No(O),W=Lo([],O),K=s.worldSize/(2*Math.PI),oe=Zo(W,g),ue=Math.asin(K/j);if(ue<Math.acos(oe)){if(!o)return null;const Dt=[],Jt=[];gr(Dt,g,j/oe),Lo(Jt,Qs(Jt,Dt,O)),Lo(g,on(g,O,gr(g,Jt,Math.tan(ue)*j)))}const be=[];new hn(h,g).closestPointOnSphere(C,K,be);const ke=Lo([],fn(w,0)),Fe=Lo([],fn(w,1)),Qe=Lo([],fn(w,2)),it=Zo(ke,be),Se=Zo(Fe,be),Xe=Zo(Qe,be),st=ei(Math.asin(-Se/K));let dt=ei(Math.atan2(it,Xe));dt=s.center.lng+function(Dt,Jt){const yi=(Jt-Dt+180)%360-180;return yi<-180?yi+360:yi}(s.center.lng,dt);const Ot=xt(dt),Pt=at(pt(st),0,1);return new Ft(Ot,Pt)}class wx{constructor(e,i,o){this.a=Qs([],e,o),this.b=Qs([],i,o),this.center=o;const h=Lo([],this.a),f=Lo([],this.b);this.angle=Math.acos(Zo(h,f))}}function yg(s,e){if(s.angle===0)return null;let i;return i=s.a[e]===0?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[e]/s.a[e]/Math.sin(s.angle)-1/Math.tan(s.angle)),i<0||i>1?null:function(o,h,f,g){const w=Math.sin(f);return o*(Math.sin((1-g)*f)/w)+h*(Math.sin(g*f)/w)}(s.a[e],s.b[e],s.angle,at(i,0,1))+s.center[e]}function Ip(s){if(s.z<=1)return vx[s.z+2*s.y+s.x];const e=Dg(Og(s));return Go.fromPoints(e)}function rf(s,e,i){return gr(s,s,1-i),Kn(s,s,e,i)}function dy(s,e,i){for(const o of s)mo(o,o,e),gr(o,o,i)}function jy(s,e,i,o){const h=e/s.worldSize,f=s.globeMatrix;if(i.z<=1){const Pt=Ip(i).getCorners();return dy(Pt,f,h),Go.fromPoints(Pt)}const g=Og(i,o),w=Dg(g,E+gg(s._tileCoverLift));dy(w,f,h);const C=Number.MAX_VALUE,O=[-C,-C,-C],j=[C,C,C];if(g.contains(s.center)){for(const Jt of w)fi(j,j,Jt),xl(O,O,Jt);O[2]=0;const Pt=s.point,Dt=[Pt.x*h,Pt.y*h,0];return fi(j,j,Dt),xl(O,O,Dt),new Go(j,O)}if(s._tileCoverLift>0){for(const Pt of w)fi(j,j,Pt),xl(O,O,Pt);return new Go(j,O)}const W=[f[12]*h,f[13]*h,f[14]*h],K=g.getCenter(),oe=at(s.center.lat,-85.051129,wi),ue=at(K.lat,-85.051129,wi),be=xt(s.center.lng),ke=pt(oe);let Fe=be-xt(K.lng);const Qe=ke-pt(ue);Fe>.5?Fe-=1:Fe<-.5&&(Fe+=1);let it=0;Math.abs(Fe)>Math.abs(Qe)?it=Fe>=0?1:3:(it=Qe>=0?0:2,Kn(W,W,[f[4]*h,f[5]*h,f[6]*h],-Math.sin(lr(Qe>=0?g.getSouth():g.getNorth()))*E));const Se=w[it],Xe=w[(it+1)%4],st=new wx(Se,Xe,W),dt=[yg(st,0)||Se[0],yg(st,1)||Se[1],yg(st,2)||Se[2]],Ot=Lp(s.zoom);if(Ot>0){const Pt=function({x:Jt,y:yi,z:$i},Ii,Hi,Ki,bi){const Gi=1/(1<<$i);let mi=Jt*Gi,xi=mi+Gi,ss=yi*Gi,rs=ss+Gi,tr=0;const Vs=(mi+xi)/2-Ki;return Vs>.5?tr=-1:Vs<-.5&&(tr=1),mi=((mi+tr)*Ii-(Ki*=Ii))*Hi+Ki,xi=((xi+tr)*Ii-Ki)*Hi+Ki,ss=(ss*Ii-(bi*=Ii))*Hi+bi,rs=(rs*Ii-bi)*Hi+bi,[[mi,rs,0],[xi,rs,0],[xi,ss,0],[mi,ss,0]]}(i,e,s._pixelsPerMercatorPixel,be,ke);for(let Jt=0;Jt<w.length;Jt++)rf(w[Jt],Pt[Jt],Ot);const Dt=on([],Pt[it],Pt[(it+1)%4]);gr(Dt,Dt,.5),rf(dt,Dt,Ot)}for(const Pt of w)fi(j,j,Pt),xl(O,O,Pt);return j[2]=Math.min(Se[2],Xe[2]),fi(j,j,dt),xl(O,O,dt),new Go(j,O)}function Og({x:s,y:e,z:i},o=!1){const h=1/(1<<i),f=new He(Ct(s*h),e===(1<<i)-1&&o?-90:ti((e+1)*h)),g=new He(Ct((s+1)*h),e===0&&o?90:ti(e*h));return new lt(f,g)}function Dg(s,e=E){const i=lr(s.getNorth()),o=lr(s.getSouth()),h=Math.cos(i),f=Math.cos(o),g=Math.sin(i),w=Math.sin(o),C=s.getWest(),O=s.getEast();return[Ce(f,w,C,e),Ce(f,w,O,e),Ce(h,g,O,e),Ce(h,g,C,e)]}function zg(s,e,i,o){const h=1<<i.z,f=(s/ns+i.x)/h;return Me(ti((e/ns+i.y)/h),Ct(f),o)}function Rg({min:s,max:e}){return Z/Math.max(e[0]-s[0],e[1]-s[1],e[2]-s[2])}const uy=new Float64Array(16);function Bg(s){const e=Rg(s),i=rn(uy,[e,e,e]);return Nr(i,i,Pl([],s.min))}function Fg(s){const e=(o=s.min,(i=uy)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=o[0],i[13]=o[1],i[14]=o[2],i[15]=1,i);var i,o;const h=1/Rg(s);return Or(e,e,[h,h,h])}function py(s){const e=ns/(2*Math.PI);return s/(2*Math.PI)/e}function Ng(s,e){return ns/(512*Math.pow(2,s))*Rg(Ip(e))}function Tx(s,e,i,o,h){const f=py(i),g=[s,e,-i/(2*Math.PI)],w=hs(new Float64Array(16));return Nr(w,w,g),Or(w,w,[f,f,f]),ir(w,w,lr(-h)),fr(w,w,lr(-o)),w}function Lp(s){return zt(D,U,s)}function Gy(s,e){const i=Me(e.lat,e.lng),o=function(ue){const be=Me(ue._center.lat,ue._center.lng);let ke=pa([],pi(0,1,0),be);const Fe=Pi([],-ue.angle,be);ke=mo(ke,ke,Fe),Pi(Fe,-ue._pitch,ke);const Qe=Lo([],be);return gr(Qe,Qe,gg(ue.cameraToCenterDistance/ue.pixelsPerMeter)),mo(Qe,Qe,Fe),on([],be,Qe)}(s);return g=(h=Io([],o,i))[0],w=h[1],C=h[2],O=(f=i)[0],j=f[1],W=f[2],oe=(K=Math.sqrt(g*g+w*w+C*C)*Math.sqrt(O*O+j*j+W*W))&&Zo(h,f)/K,Math.acos(Math.min(Math.max(oe,-1),1));var h,f,g,w,C,O,j,W,K,oe}function Vg(s,e){return Gy(s,e)>Math.PI/2*1.01}const Wy=lr(85),fy=Math.cos(Wy),Hy=Math.sin(Wy),n_=zs(),Ug=s=>{const e=[];return s.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),s.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Sx(s,e,i,o,h,f,g,w,C){if(f&&s.queryGeometry.isAboveHorizon)return!1;f&&(C*=s.pixelToTileUnitsFactor);const O=s.tileID.canonical,j=i.projection.upVectorScale(O,i.center.lat,i.worldSize).metersToTile;for(const W of e)for(const K of W){const oe=K.add(w),ue=h&&i.elevation?i.elevation.exaggeration()*h.getElevationAt(oe.x,oe.y,!0):0,be=i.projection.projectTilePoint(oe.x,oe.y,O);if(ue>0){const it=i.projection.upVector(O,oe.x,oe.y);be.x+=it[0]*j*ue,be.y+=it[1]*j*ue,be.z+=it[2]*j*ue}const ke=f?oe:my(be.x,be.y,be.z,o),Fe=f?s.tilespaceRays.map(it=>Mx(it,ue)):s.queryGeometry.screenGeometry,Qe=Ps([],[be.x,be.y,be.z,1],o);if(!g&&f?C*=Qe[3]/i.cameraToCenterDistance:g&&!f&&(C*=i.cameraToCenterDistance/Qe[3]),f){const it=ti((K.y/ns+O.y)/(1<<O.z));C/=i.projection.pixelsPerMeter(it,1)/At(1,it)}if(hp(Fe,ke,C))return!0}return!1}function my(s,e,i,o){const h=Ps([],[s,e,i,1],o);return new Wi(h[0]/h[3],h[1]/h[3])}const Xy=pi(0,0,0),jg=pi(0,0,1);function Mx(s,e){const i=Cs();return Xy[2]=e,s.intersectsPlane(Xy,jg,i),new Wi(i[0],i[1])}class gy extends qc{}let Ax,Gg,he,u;function v(s,{width:e,height:i},o,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*i*o)throw new RangeError("mismatched image size")}else h=new Uint8Array(e*i*o);return s.width=e,s.height=i,s.data=h,s}function M(s,e,i){const{width:o,height:h}=e;o===s.width&&h===s.height||(z(s,e,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,o),height:Math.min(s.height,h)},i,null),s.width=o,s.height=h,s.data=e.data)}function z(s,e,i,o,h,f,g,w){if(h.width===0||h.height===0)return e;if(h.width>s.width||h.height>s.height||i.x>s.width-h.width||i.y>s.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||o.x>e.width-h.width||o.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const C=s.data,O=e.data,j=f===4&&w;for(let W=0;W<h.height;W++){const K=((i.y+W)*s.width+i.x)*f,oe=((o.y+W)*e.width+o.x)*f;if(j)for(let ue=0;ue<h.width;ue++){const be=K+ue*f+3,ke=oe+ue*f;O[ke+0]=255,O[ke+1]=255,O[ke+2]=255,O[ke+3]=C[be]}else if(g)for(let ue=0;ue<h.width;ue++){const be=K+ue*f,ke=oe+ue*f,Fe=new So(C[be+0]/255,C[be+1]/255,C[be+2]/255,C[be+3]).toNonPremultipliedRenderColor(g).toArray();O[ke+0]=Fe[0],O[ke+1]=Fe[1],O[ke+2]=Fe[2],O[ke+3]=Fe[3]}else for(let ue=0;ue<h.width*f;ue++)O[oe+ue]=C[K+ue]}return e}qe(gy,"HeatmapBucket",{omit:["layers"]});class F{constructor(e,i){v(this,e,1,i)}resize(e){M(this,new F(e),1)}clone(){return new F({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,h,f){z(e,i,o,h,f,1,null)}}class V{constructor(e,i){v(this,e,4,i)}resize(e){M(this,new V(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new V({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,h,f,g,w){z(e,i,o,h,f,4,g,w)}}class G{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function Q(s){const e={},i=s.resolution||256,o=s.clips?s.clips.length:1,h=s.image||new V({width:i,height:o}),f=(g,w,C)=>{e[s.evaluationKey]=C;const O=s.expression.evaluate(e),j=O?O.toNonPremultipliedRenderColor(null):null;j&&(h.data[g+w+0]=Math.floor(255*j.r),h.data[g+w+1]=Math.floor(255*j.g),h.data[g+w+2]=Math.floor(255*j.b),h.data[g+w+3]=Math.floor(255*j.a))};if(s.clips)for(let g=0,w=0;g<o;++g,w+=4*i)for(let C=0,O=0;C<i;C++,O+=4){const j=C/(i-1),{start:W,end:K}=s.clips[g];f(w,O,W*(1-j)+K*j)}else for(let g=0,w=0;g<i;g++,w+=4)f(0,w,g/(i-1));return h}qe(F,"AlphaImage"),qe(V,"RGBAImage");const le=bo([{name:"a_pos",components:2,type:"Int16"}],4),ye=bo([{name:"a_road_z_offset",components:1,type:"Float32"}],4),ce=bo([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),we=bo([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Le(s,e,i=2){const o=e&&e.length,h=o?e[0]*i:s.length;let f=Ue(s,0,h,i,!0);const g=[];if(!f||f.next===f.prev)return g;let w,C,O;if(o&&(f=function(j,W,K,oe){const ue=[];for(let be=0,ke=W.length;be<ke;be++){const Fe=Ue(j,W[be]*oe,be<ke-1?W[be+1]*oe:j.length,oe,!1);Fe===Fe.next&&(Fe.steiner=!0),ue.push(Li(Fe))}ue.sort(ii);for(let be=0;be<ue.length;be++)K=ri(ue[be],K);return K}(s,e,f,i)),s.length>80*i){w=1/0,C=1/0;let j=-1/0,W=-1/0;for(let K=i;K<h;K+=i){const oe=s[K],ue=s[K+1];oe<w&&(w=oe),ue<C&&(C=ue),oe>j&&(j=oe),ue>W&&(W=ue)}O=Math.max(j-w,W-C),O=O!==0?32767/O:0}return tt(f,g,i,w,C,O,0),g}function Ue(s,e,i,o,h){let f;if(h===function(g,w,C,O){let j=0;for(let W=w,K=C-O;W<C;W+=O)j+=(g[K]-g[W])*(g[W+1]+g[K+1]),K=W;return j}(s,e,i,o)>0)for(let g=e;g<i;g+=o)f=Sn(g/o|0,s[g],s[g+1],f);else for(let g=i-o;g>=e;g-=o)f=Sn(g/o|0,s[g],s[g+1],f);return f&&Lr(f,f.next)&&(Mn(f),f=f.next),f}function et(s,e){if(!s)return s;e||(e=s);let i,o=s;do if(i=!1,o.steiner||!Lr(o,o.next)&&ks(o.prev,o,o.next)!==0)o=o.next;else{if(Mn(o),o=e=o.prev,o===o.next)break;i=!0}while(i||o!==e);return e}function tt(s,e,i,o,h,f,g){if(!s)return;!g&&f&&function(C,O,j,W){let K=C;do K.z===0&&(K.z=ki(K.x,K.y,O,j,W)),K.prevZ=K.prev,K.nextZ=K.next,K=K.next;while(K!==C);K.prevZ.nextZ=null,K.prevZ=null,function(oe){let ue,be=1;do{let ke,Fe=oe;oe=null;let Qe=null;for(ue=0;Fe;){ue++;let it=Fe,Se=0;for(let st=0;st<be&&(Se++,it=it.nextZ,it);st++);let Xe=be;for(;Se>0||Xe>0&&it;)Se!==0&&(Xe===0||!it||Fe.z<=it.z)?(ke=Fe,Fe=Fe.nextZ,Se--):(ke=it,it=it.nextZ,Xe--),Qe?Qe.nextZ=ke:oe=ke,ke.prevZ=Qe,Qe=ke;Fe=it}Qe.nextZ=null,be*=2}while(ue>1)}(K)}(s,o,h,f);let w=s;for(;s.prev!==s.next;){const C=s.prev,O=s.next;if(f?ht(s,o,h,f):$e(s))e.push(C.i,s.i,O.i),Mn(s),s=O.next,w=O.next;else if((s=O)===w){g?g===1?tt(s=yt(et(s),e),e,i,o,h,f,2):g===2&&ci(s,e,i,o,h,f):tt(et(s),e,i,o,h,f,1);break}}}function $e(s){const e=s.prev,i=s,o=s.next;if(ks(e,i,o)>=0)return!1;const h=e.x,f=i.x,g=o.x,w=e.y,C=i.y,O=o.y,j=Math.min(h,f,g),W=Math.min(w,C,O),K=Math.max(h,f,g),oe=Math.max(w,C,O);let ue=o.next;for(;ue!==e;){if(ue.x>=j&&ue.x<=K&&ue.y>=W&&ue.y<=oe&&vs(h,w,f,C,g,O,ue.x,ue.y)&&ks(ue.prev,ue,ue.next)>=0)return!1;ue=ue.next}return!0}function ht(s,e,i,o){const h=s.prev,f=s,g=s.next;if(ks(h,f,g)>=0)return!1;const w=h.x,C=f.x,O=g.x,j=h.y,W=f.y,K=g.y,oe=Math.min(w,C,O),ue=Math.min(j,W,K),be=Math.max(w,C,O),ke=Math.max(j,W,K),Fe=ki(oe,ue,e,i,o),Qe=ki(be,ke,e,i,o);let it=s.prevZ,Se=s.nextZ;for(;it&&it.z>=Fe&&Se&&Se.z<=Qe;){if(it.x>=oe&&it.x<=be&&it.y>=ue&&it.y<=ke&&it!==h&&it!==g&&vs(w,j,C,W,O,K,it.x,it.y)&&ks(it.prev,it,it.next)>=0||(it=it.prevZ,Se.x>=oe&&Se.x<=be&&Se.y>=ue&&Se.y<=ke&&Se!==h&&Se!==g&&vs(w,j,C,W,O,K,Se.x,Se.y)&&ks(Se.prev,Se,Se.next)>=0))return!1;Se=Se.nextZ}for(;it&&it.z>=Fe;){if(it.x>=oe&&it.x<=be&&it.y>=ue&&it.y<=ke&&it!==h&&it!==g&&vs(w,j,C,W,O,K,it.x,it.y)&&ks(it.prev,it,it.next)>=0)return!1;it=it.prevZ}for(;Se&&Se.z<=Qe;){if(Se.x>=oe&&Se.x<=be&&Se.y>=ue&&Se.y<=ke&&Se!==h&&Se!==g&&vs(w,j,C,W,O,K,Se.x,Se.y)&&ks(Se.prev,Se,Se.next)>=0)return!1;Se=Se.nextZ}return!0}function yt(s,e){let i=s;do{const o=i.prev,h=i.next.next;!Lr(o,h)&&Cr(o,i,i.next,h)&&Yr(o,h)&&Yr(h,o)&&(e.push(o.i,i.i,h.i),Mn(i),Mn(i.next),i=s=h),i=i.next}while(i!==s);return et(i)}function ci(s,e,i,o,h,f){let g=s;do{let w=g.next.next;for(;w!==g.prev;){if(g.i!==w.i&&Ys(g,w)){let C=En(g,w);return g=et(g,g.next),C=et(C,C.next),tt(g,e,i,o,h,f,0),void tt(C,e,i,o,h,f,0)}w=w.next}g=g.next}while(g!==s)}function ii(s,e){let i=s.x-e.x;return i===0&&(i=s.y-e.y,i===0)&&(i=(s.next.y-s.y)/(s.next.x-s.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function ri(s,e){const i=function(h,f){let g=f;const w=h.x,C=h.y;let O,j=-1/0;if(Lr(h,g))return g;do{if(Lr(h,g.next))return g.next;if(C<=g.y&&C>=g.next.y&&g.next.y!==g.y){const be=g.x+(C-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(be<=w&&be>j&&(j=be,O=g.x<g.next.x?g:g.next,be===w))return O}g=g.next}while(g!==f);if(!O)return null;const W=O,K=O.x,oe=O.y;let ue=1/0;g=O;do{if(w>=g.x&&g.x>=K&&w!==g.x&&ls(C<oe?w:j,C,K,oe,C<oe?j:w,C,g.x,g.y)){const be=Math.abs(C-g.y)/(w-g.x);Yr(g,h)&&(be<ue||be===ue&&(g.x>O.x||g.x===O.x&&Ri(O,g)))&&(O=g,ue=be)}g=g.next}while(g!==W);return O}(s,e);if(!i)return e;const o=En(i,s);return et(o,o.next),et(i,i.next)}function Ri(s,e){return ks(s.prev,s,e.prev)<0&&ks(e.next,s,s.next)<0}function ki(s,e,i,o,h){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-i)*h|0)|s<<8))|s<<4))|s<<2))|s<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Li(s){let e=s,i=s;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==s);return i}function ls(s,e,i,o,h,f,g,w){return(h-g)*(e-w)>=(s-g)*(f-w)&&(s-g)*(o-w)>=(i-g)*(e-w)&&(i-g)*(f-w)>=(h-g)*(o-w)}function vs(s,e,i,o,h,f,g,w){return!(s===g&&e===w)&&ls(s,e,i,o,h,f,g,w)}function Ys(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!function(i,o){let h=i;do{if(h.i!==i.i&&h.next.i!==i.i&&h.i!==o.i&&h.next.i!==o.i&&Cr(h,h.next,i,o))return!0;h=h.next}while(h!==i);return!1}(s,e)&&(Yr(s,e)&&Yr(e,s)&&function(i,o){let h=i,f=!1;const g=(i.x+o.x)/2,w=(i.y+o.y)/2;do h.y>w!=h.next.y>w&&h.next.y!==h.y&&g<(h.next.x-h.x)*(w-h.y)/(h.next.y-h.y)+h.x&&(f=!f),h=h.next;while(h!==i);return f}(s,e)&&(ks(s.prev,s,e.prev)||ks(s,e.prev,e))||Lr(s,e)&&ks(s.prev,s,s.next)>0&&ks(e.prev,e,e.next)>0)}function ks(s,e,i){return(e.y-s.y)*(i.x-e.x)-(e.x-s.x)*(i.y-e.y)}function Lr(s,e){return s.x===e.x&&s.y===e.y}function Cr(s,e,i,o){const h=nr(ks(s,e,i)),f=nr(ks(s,e,o)),g=nr(ks(i,o,s)),w=nr(ks(i,o,e));return h!==f&&g!==w||!(h!==0||!Ur(s,i,e))||!(f!==0||!Ur(s,o,e))||!(g!==0||!Ur(i,s,o))||!(w!==0||!Ur(i,e,o))}function Ur(s,e,i){return e.x<=Math.max(s.x,i.x)&&e.x>=Math.min(s.x,i.x)&&e.y<=Math.max(s.y,i.y)&&e.y>=Math.min(s.y,i.y)}function nr(s){return s>0?1:s<0?-1:0}function Yr(s,e){return ks(s.prev,s,s.next)<0?ks(s,e,s.next)>=0&&ks(s,s.prev,e)>=0:ks(s,e,s.prev)<0||ks(s,s.next,e)<0}function En(s,e){const i=Bh(s.i,s.x,s.y),o=Bh(e.i,e.x,e.y),h=s.next,f=e.prev;return s.next=e,e.prev=s,i.next=h,h.prev=i,o.next=i,i.prev=o,f.next=o,o.prev=f,o}function Sn(s,e,i,o){const h=Bh(s,e,i);return o?(h.next=o.next,h.prev=o,o.next.prev=h,o.next=h):(h.prev=h,h.next=h),h}function Mn(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Bh(s,e,i){return{i:s,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function $o(s,e){const i=s.length;if(i<=1)return[s];const o=[];let h,f;for(let g=0;g<i;g++){const w=to(s[g]);w!==0&&(s[g].area=Math.abs(w),f===void 0&&(f=w<0),f===w<0?(h&&o.push(h),h=[s[g]]):h.push(s[g]))}if(h&&o.push(h),e>1)for(let g=0;g<o.length;g++)o[g].length<=e||(zl(o[g],e,1,o[g].length-1,Ca),o[g]=o[g].slice(0,e));return o}function Ca(s,e){return e.area-s.area}function Do(s,e,i=1){if(!s)return null;const o=typeof s=="string"?cl.from(s).getPrimary():s.getPrimary(),h=typeof s=="string"?null:s.getSecondary();for(const f of[o,h]){if(!f)continue;const g=f.id.toString();e.has(g)||e.set(g,[]),f.scaleSelf(i),e.get(g).push(f)}return{primary:o.toString(),secondary:h?h.toString():null}}function go(s,e,i,o){const h=o.patternDependencies;let f=!1;for(const g of e){const w=g.paint.get(`${s}-pattern`);w.isConstant()||(f=!0),Do(w.constantOr(null),h,i)&&(f=!0)}return f}function Al(s,e,i,o,h,f){const g=f.patternDependencies;for(const w of e){const C=w.paint.get(`${s}-pattern`).value;if(C.kind!=="constant"){let O=C.evaluate({zoom:o},i,{},f.availableImages);O=O&&O.name?O.name:O;const j=Do(O,g,h);if(!j)continue;const{primary:W,secondary:K}=j;W&&(i.patterns[w.id]=[W,K].filter(Boolean))}}return i}class oa{constructor(){this.polygons=new Map}add(e,...i){this.polygons.has(e)?this.polygons.get(e).push(...i):this.polygons.set(e,i)}merge(e){for(const[i,o]of e.polygons)this.add(i,...o)}}class na{constructor(){this.portals=[]}static evaluate(e){if(e.length===0)return new na;let i=[];for(const O of e)i.push(...O.portals);if(i.length===0)return new na;const o=(O,j)=>O<=0&&j<=0||O>=ns&&j>=ns;for(const O of i){const j=O.va,W=O.vb;(o(j.x,W.x)||o(j.y,W.y))&&(O.type="border")}const h=i.filter(O=>O.type!=="unevaluated"),f=i.filter(O=>O.type==="unevaluated");if(f.length===0)return new na;f.sort((O,j)=>O.hash===j.hash?O.isTunnel===j.isTunnel?0:O.isTunnel?-1:1:O.hash<j.hash?1:-1),i=h.concat(f);let g=h.length,w=g,C=g;do if(w++,w===i.length||i[g].hash!==i[w].hash){if(w-g==2){C<g&&(i[C]=i[g],i[g]=null);const O=i[C],j=i[w-1];O.type=O.isTunnel!==j.isTunnel?"tunnel":"polygon",O.connection={a:O.connection.a,b:j.connection.a},C++}g=w}while(g!==i.length);return i.splice(C),i.sort((O,j)=>O.hash<j.hash?1:-1),{portals:i}}}qe(na,"ElevationPortalGraph"),qe(oa,"ElevationPolygons");class ph{constructor(e,i,o){this.outPositions=e,this.outNormals=i,this.outIndices=o,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,i,o){let h=e[2];o!=null&&(h*=o);const f=this.getVec3Bits(e)<<96n|this.getVec3Bits(i),g=this.vertexLookup.get(f);if(g!=null)return g;const w=this.outPositions.length;this.vertexLookup.set(f,w);const C=Math.trunc(16384*i[0]),O=Math.trunc(16384*i[1]),j=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],h),this.outNormals.emplaceBack(C,O,j),w}addVertices(e,i,...o){const h=[];for(const f of o){const g=this.addVertex(f,e,i);h.push(g)}return h}addTriangles(e,i,o){if(i&&o){const h=o.length===1,f=pi(0,0,0);for(let g=0;g<e.length;g+=3){const w=i[e[g+0]],C=i[e[g+1]],O=i[e[g+2]],j=h?o[0]:o[e[g+1]],W=h?o[0]:o[e[g+2]],K=this.addVertex(pi(w.x,w.y,h?o[0]:o[e[g+0]]),f),oe=this.addVertex(pi(C.x,C.y,j),f),ue=this.addVertex(pi(O.x,O.y,W),f);this.outIndices.emplaceBack(K,oe,ue)}}else for(let h=0;h<e.length;h+=3)this.outIndices.emplaceBack(e[h+0],e[h+1],e[h+2])}addQuad(e,i){const o=this.addVertices(i,void 0,...e.map(C=>pi(C.coord.x,C.coord.y,C.height))),[h,f,g,w]=o;this.addTriangles([h,f,g,g,w,h])}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class sh{constructor(e,i,o,h){this.unevaluatedPortals=new na,this.portalPolygons=new oa,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Nu,this.vertexNormals=new Mp,this.indexArray=new ml,this.tileToMeters=ui(e),this.bridgeProgramConfigurations=new c(i,{zoom:o,lut:h},f=>f!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new c(i,{zoom:o,lut:h},f=>f!=="fill-bridge-guard-rail-color")}addVertices(e,i){const o=this.unevalVertices.length;for(let h=0;h<e.length;h++)this.unevalVertices.push(e[h]),this.unevalHeights.push(i[h]);return o}addTriangles(e,i,o){const h=o?this.unevalTunnelTriangles:this.unevalTriangles;for(const f of e)h.push(f+i)}addRenderableRing(e,i,o,h,f,g){const w=[new Wi(f.min.x,f.min.y),new Wi(f.max.x,f.min.y),new Wi(f.max.x,f.max.y),new Wi(f.min.x,f.max.y)];for(let C=0;C<o-1;C++){const O=i+C,j=O+1,W=this.unevalVertices[O],K=this.unevalVertices[j];if(!(W.x>=f.min.x&&W.x<=f.max.x&&W.y>=f.min.y&&W.y<=f.max.y||K.x>=f.min.x&&K.x<=f.max.x&&K.y>=f.min.y&&K.y<=f.max.y||xu(W,K,w))||this.isOnBorder(W.x,K.x)||this.isOnBorder(W.y,K.y))continue;const oe=sh.computeEdgeHash(this.unevalVertices[O],this.unevalVertices[j]);let ue,be=this.vertexHashLookup.get(sh.computePosHash(W));be!=null?ue=be.next:(be=this.vertexHashLookup.get(sh.computePosHash(K)),ue=be!=null?be.prev:oe),this.unevalEdges.push({polygonIdx:e,a:O,b:j,hash:oe,portalHash:ue,isTunnel:h,type:"unevaluated",featureInfo:g})}}addPortalCandidates(e,i,o,h,f){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:f});const g=i[0];this.vertexHashLookup.clear();let w=sh.computeEdgeHash(g[g.length-2],g[g.length-1]);for(let C=0;C<g.length-1;C++){const O=g[C+0],j=g[C+1],W=Mh(j.x-O.x,j.y-O.y),K=Jc(W);if(K===0)continue;let oe="unevaluated";const ue=h.pointElevation(O),be=h.pointElevation(j);Math.abs(ue)<.01&&Math.abs(be)<.01?oe="entrance":(this.isOnBorder(O.x,j.x)||this.isOnBorder(O.y,j.y))&&(oe="border");const ke=sh.computeEdgeHash(O,j);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:O,vb:j,vab:W,length:K,hash:ke,isTunnel:o,type:oe});const Fe=sh.computePosHash(O);this.vertexHashLookup.set(Fe,{prev:w,next:ke}),w=ke}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),o=K=>{K.primitiveLength=this.indexArray.length-K.primitiveOffset},h=new ph(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const f=i(),g=i(),w=i(),C=(K,oe)=>{K.sort((be,ke)=>be.type===oe&&ke.type!==oe?-1:be.type!==oe&&ke.type===oe?1:0);const ue=K.findIndex(be=>be.type!==oe);return ue>=0?ue:K.length};let O=0;this.unevalEdges.length>0&&(O=C(this.unevalEdges,"none"),this.constructBridgeStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:O},this.tileToMeters)),o(w);const j=i(),W=i();if(this.unevalEdges.length>0){const K=this.unevalEdges.splice(O),oe=C(K,"tunnel")+O;this.unevalEdges.push(...K),this.constructTunnelStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:O},{min:O,max:oe})}o(j),h.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),o(W),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),o(g),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),o(f),this.maskSegments=sa.simpleSegment(0,W.primitiveOffset,0,W.primitiveLength),this.depthSegments=sa.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength),this.renderableBridgeSegments=sa.simpleSegment(0,w.primitiveOffset,0,w.primitiveLength),this.renderableTunnelSegments=sa.simpleSegment(0,j.primitiveOffset,0,j.primitiveLength),this.shadowCasterSegments=sa.simpleSegment(0,f.primitiveOffset,0,f.primitiveLength)}update(e,i,o,h,f,g,w,C){this.bridgeProgramConfigurations.updatePaintArrays(e,i,f,o,h,g,w,C),this.tunnelProgramConfigurations.updatePaintArrays(e,i,f,o,h,g,w,C)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,ce.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,we.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,i,o,h,f){const g=(w,C)=>{for(let O=0;O<C.length-1;O++){const j=C[O].featureIndex,W=C[O+1].vertexStart,K=e.feature(j);w.populatePaintArrays(W,K,j,{},o,i,h,void 0,f)}};g(this.bridgeProgramConfigurations,this.bridgeFeatureSections),g(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,i,o,h,f){const g=new Map;for(let w=h;w<f;w++){const C=o[w],O=C.a,j=C.b,W=sh.computePosHash(e[O]),K=sh.computePosHash(e[j]);g.has(W)||g.set(W,{}),g.has(K)||g.set(K,{});const oe=g.get(W),ue=g.get(K);i[O]<=0&&i[j]<=0||(oe.to=j,ue.from=O)}return g}constructBridgeStructures(e,i,o,h,f,g){e.clearVertexLookup();const w=this.computeVertexConnections(i,o,h,f.min,f.max),C=1/g,O=.5*C,j=oe=>pi(i[oe].x,i[oe].y,o[oe]*C),W=oe=>{const ue=w.get(sh.computePosHash(i[oe])),be=ue.from,ke=ue.to;if(!be||!ke)return;const Fe=j(be),Qe=j(oe),it=j(ke),Se=pi(0,0,0);if(!Wh(Fe,Qe)){const st=Qs(Cs(),Qe,Fe);on(Se,Se,Lo(st,st))}if(!Wh(it,Qe)){const st=Qs(Cs(),it,Qe);on(Se,Se,Lo(st,st))}const Xe=_l(Se);return Xe>0?gr(Se,Se,1/Xe):void 0};let K=Number.POSITIVE_INFINITY;this.sortSubarray(h,f.min,f.max,(oe,ue)=>oe.featureInfo.featureIndex-ue.featureInfo.featureIndex);for(let oe=f.min;oe<f.max;oe++){const ue=h[oe];if(!ue.featureInfo.guardRailEnabled)continue;const be=this.prepareEdgePoints(i,o,ue,(Br,Bs)=>Br>Bs);if(be==null)continue;const ke=be[0],Fe=be[1],Qe=pi(ke.coord.x,ke.coord.y,C*ke.height),it=pi(Fe.coord.x,Fe.coord.y,C*Fe.height);if(Wh(Qe,it))continue;const Se=Qs(Cs(),it,Qe);Lo(Se,Se);const Xe=Br=>Lo(Br,Br),st=W(ue.a)||Se,dt=W(ue.b)||Se,Ot=Xe(pi(st[1],-st[0],0)),Pt=Xe(pi(dt[1],-dt[0],0)),Dt=Xe(pa(Cs(),Ot,st)),Jt=Xe(pa(Cs(),Pt,dt)),yi=Cs(),$i=[on(Cs(),Qe,gr(yi,Qs(yi,Ot,Dt),O)),on(Cs(),Qe,gr(yi,on(yi,Ot,Dt),O)),on(Cs(),Qe,gr(yi,Dt,O)),Qe],Ii=[on(Cs(),it,gr(yi,Qs(yi,Pt,Jt),O)),on(Cs(),it,gr(yi,on(yi,Pt,Jt),O)),on(Cs(),it,gr(yi,Jt,O)),it];K=this.addFeatureSection(ue.featureInfo.featureIndex,K,this.bridgeFeatureSections,e);const[Hi,Ki]=e.addVertices(Ot,g,$i[0],$i[1]),[bi,Gi]=e.addVertices(Pt,g,Ii[0],Ii[1]);e.addTriangles([Hi,Ki,bi,Ki,Gi,bi]);const[mi,xi]=e.addVertices(Dt,g,$i[1],$i[2]),[ss,rs]=e.addVertices(Jt,g,Ii[1],Ii[2]);e.addTriangles([mi,xi,ss,xi,rs,ss]);const[tr,Vs]=e.addVertices(Pl(Ot,Ot),g,$i[2],$i[3]),[gs,ts]=e.addVertices(Pl(Pt,Pt),g,Ii[2],Ii[3]);e.addTriangles([tr,Vs,gs,Vs,ts,gs])}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,i,o,h,f,g){e.clearVertexLookup();let w=Number.POSITIVE_INFINITY;const C=(j,W)=>j.featureInfo.featureIndex-W.featureInfo.featureIndex;this.sortSubarray(h,f.min,f.max,C),this.sortSubarray(h,g.min,g.max,C);const O=j=>Lo(j,j);for(let j=f.min;j<f.max;j++){const W=this.prepareEdgePoints(i,o,h[j],(be,ke)=>be<ke);if(W==null)continue;const[K,oe]=W,ue=O(pi(-(oe.coord.y-K.coord.y),oe.coord.x-K.coord.x,0));w=this.addFeatureSection(h[j].featureInfo.featureIndex,w,this.tunnelFeatureSections,e),e.addQuad([K,oe,{coord:oe.coord,height:h[j].isTunnel?-.1:0},{coord:K.coord,height:h[j].isTunnel?-.1:0}],ue)}for(let j=g.min;j<g.max;j++){const W=h[j];W.isTunnel&&([W.a,W.b]=[W.b,W.a]);const K=i[W.a],oe=i[W.b],ue=O(pi(-(oe.y-K.y),oe.x-K.x,0));w=this.addFeatureSection(W.featureInfo.featureIndex,w,this.tunnelFeatureSections,e),e.addQuad([{coord:oe,height:0},{coord:K,height:0},{coord:K,height:o[W.a]+4},{coord:oe,height:o[W.b]+4}],ue),e.addQuad([{coord:K,height:0},{coord:oe,height:0},{coord:oe,height:o[W.b]+4},{coord:K,height:o[W.a]+4}],ue)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}prepareEdgePoints(e,i,o,h){let f=i[o.a],g=i[o.b];const w=h(f,0),C=h(g,0);if(w&&C)return[{coord:e[o.a],height:f},{coord:e[o.b],height:g}];if(!w&&!C)return;const O=e[o.a].clone(),j=e[o.b].clone();if(w){if(!C){const W=g/(g-f);j.x=js(j.x,O.x,W),j.y=js(j.y,O.y,W),g=js(g,f,W)}}else{const W=f/(f-g);O.x=js(O.x,j.x,W),O.y=js(O.y,j.y,W),f=js(f,g,W)}return[{coord:O,height:f},{coord:j,height:g}]}prepareEdges(e,i){if(i.length===0)return;i.sort((w,C)=>w.hash===C.hash?C.polygonIdx-w.polygonIdx:C.hash>w.hash?1:-1);let o=0,h=0,f=0,g=i[o].polygonIdx;do h++,(h===i.length||i[o].hash!==i[h].hash)&&((h-o==1||i[h-1].polygonIdx!==g)&&(f<o&&(i[f]=i[o],i[o]=null),i[f].type="none",f++),o=h,o!==i.length&&(g=i[o].polygonIdx));while(o!==i.length);if(i.splice(f),i.length!==0&&e.length!==0){i.sort((O,j)=>O.portalHash<j.portalHash?1:-1);let w=0,C=0;for(;w!==i.length&&C!==e.length;){const O=i[w],j=e[C];O.portalHash>j.hash?w++:j.hash>O.portalHash?C++:(O.type=j.type,w++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=ns&&i>=ns}addFeatureSection(e,i,o,h){return e!==i&&(i=e,o.push({featureIndex:e,vertexStart:h.getVertexCount()}),h.clearVertexLookup()),i}sortSubarray(e,i,o,h){const f=e.slice(i,o);f.sort(h),e.splice(i,f.length,...f)}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(sh.computePosHash(e))<<32n|BigInt(sh.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var _u,Ec={exports:{}},aa=(_u||(_u=1,function(s,e){(function(i){function o(nt,ft){return nt>ft?1:nt<ft?-1:0}var h=function(nt,ft){nt===void 0&&(nt=o),ft===void 0&&(ft=!1),this._compare=nt,this._root=null,this._size=0,this._noDuplicates=!!ft},f={size:{configurable:!0}};function g(nt,ft,Si,as,ys){var ps=ys-as;if(ps>0){var Ds=as+Math.floor(ps/2),Tr={key:ft[Ds],data:Si[Ds],parent:nt};return Tr.left=g(Tr,ft,Si,as,Ds),Tr.right=g(Tr,ft,Si,Ds+1,ys),Tr}return null}function w(nt,ft,Si,as,ys){if(!(Si>=as)){for(var ps=nt[Si+as>>1],Ds=Si-1,Tr=as+1;;){do Ds++;while(ys(nt[Ds],ps)<0);do Tr--;while(ys(nt[Tr],ps)>0);if(Ds>=Tr)break;var Eo=nt[Ds];nt[Ds]=nt[Tr],nt[Tr]=Eo,Eo=ft[Ds],ft[Ds]=ft[Tr],ft[Tr]=Eo}w(nt,ft,Si,Tr,ys),w(nt,ft,Tr+1,as,ys)}}h.prototype.rotateLeft=function(nt){var ft=nt.right;ft&&(nt.right=ft.left,ft.left&&(ft.left.parent=nt),ft.parent=nt.parent),nt.parent?nt===nt.parent.left?nt.parent.left=ft:nt.parent.right=ft:this._root=ft,ft&&(ft.left=nt),nt.parent=ft},h.prototype.rotateRight=function(nt){var ft=nt.left;ft&&(nt.left=ft.right,ft.right&&(ft.right.parent=nt),ft.parent=nt.parent),nt.parent?nt===nt.parent.left?nt.parent.left=ft:nt.parent.right=ft:this._root=ft,ft&&(ft.right=nt),nt.parent=ft},h.prototype._splay=function(nt){for(;nt.parent;){var ft=nt.parent;ft.parent?ft.left===nt&&ft.parent.left===ft?(this.rotateRight(ft.parent),this.rotateRight(ft)):ft.right===nt&&ft.parent.right===ft?(this.rotateLeft(ft.parent),this.rotateLeft(ft)):ft.left===nt&&ft.parent.right===ft?(this.rotateRight(ft),this.rotateLeft(ft)):(this.rotateLeft(ft),this.rotateRight(ft)):ft.left===nt?this.rotateRight(ft):this.rotateLeft(ft)}},h.prototype.splay=function(nt){for(var ft,Si,as,ys,ps;nt.parent;)(Si=(ft=nt.parent).parent)&&Si.parent?((as=Si.parent).left===Si?as.left=nt:as.right=nt,nt.parent=as):(nt.parent=null,this._root=nt),ys=nt.left,ps=nt.right,nt===ft.left?(Si&&(Si.left===ft?(ft.right?(Si.left=ft.right,Si.left.parent=Si):Si.left=null,ft.right=Si,Si.parent=ft):(ys?(Si.right=ys,ys.parent=Si):Si.right=null,nt.left=Si,Si.parent=nt)),ps?(ft.left=ps,ps.parent=ft):ft.left=null,nt.right=ft,ft.parent=nt):(Si&&(Si.right===ft?(ft.left?(Si.right=ft.left,Si.right.parent=Si):Si.right=null,ft.left=Si,Si.parent=ft):(ps?(Si.left=ps,ps.parent=Si):Si.left=null,nt.right=Si,Si.parent=nt)),ys?(ft.right=ys,ys.parent=ft):ft.right=null,nt.left=ft,ft.parent=nt)},h.prototype.replace=function(nt,ft){nt.parent?nt===nt.parent.left?nt.parent.left=ft:nt.parent.right=ft:this._root=ft,ft&&(ft.parent=nt.parent)},h.prototype.minNode=function(nt){if(nt===void 0&&(nt=this._root),nt)for(;nt.left;)nt=nt.left;return nt},h.prototype.maxNode=function(nt){if(nt===void 0&&(nt=this._root),nt)for(;nt.right;)nt=nt.right;return nt},h.prototype.insert=function(nt,ft){var Si=this._root,as=null,ys=this._compare;if(this._noDuplicates)for(;Si;){if(as=Si,ys(Si.key,nt)===0)return;Si=ys(Si.key,nt)<0?Si.right:Si.left}else for(;Si;)as=Si,Si=ys(Si.key,nt)<0?Si.right:Si.left;return Si={key:nt,data:ft,left:null,right:null,parent:as},as?ys(as.key,Si.key)<0?as.right=Si:as.left=Si:this._root=Si,this.splay(Si),this._size++,Si},h.prototype.find=function(nt){for(var ft=this._root,Si=this._compare;ft;){var as=Si(ft.key,nt);if(as<0)ft=ft.right;else{if(!(as>0))return ft;ft=ft.left}}return null},h.prototype.contains=function(nt){for(var ft=this._root,Si=this._compare;ft;){var as=Si(nt,ft.key);if(as===0)return!0;ft=as<0?ft.left:ft.right}return!1},h.prototype.remove=function(nt){var ft=this.find(nt);if(!ft)return!1;if(this.splay(ft),ft.left)if(ft.right){var Si=this.minNode(ft.right);Si.parent!==ft&&(this.replace(Si,Si.right),Si.right=ft.right,Si.right.parent=Si),this.replace(ft,Si),Si.left=ft.left,Si.left.parent=Si}else this.replace(ft,ft.left);else this.replace(ft,ft.right);return this._size--,!0},h.prototype.removeNode=function(nt){if(!nt)return!1;if(this.splay(nt),nt.left)if(nt.right){var ft=this.minNode(nt.right);ft.parent!==nt&&(this.replace(ft,ft.right),ft.right=nt.right,ft.right.parent=ft),this.replace(nt,ft),ft.left=nt.left,ft.left.parent=ft}else this.replace(nt,nt.left);else this.replace(nt,nt.right);return this._size--,!0},h.prototype.erase=function(nt){var ft=this.find(nt);if(ft){this.splay(ft);var Si=ft.left,as=ft.right,ys=null;Si&&(Si.parent=null,ys=this.maxNode(Si),this.splay(ys),this._root=ys),as&&(Si?ys.right=as:this._root=as,as.parent=ys),this._size--}},h.prototype.pop=function(){var nt=this._root,ft=null;if(nt){for(;nt.left;)nt=nt.left;ft={key:nt.key,data:nt.data},this.remove(nt.key)}return ft},h.prototype.next=function(nt){var ft=nt;if(ft)if(ft.right)for(ft=ft.right;ft&&ft.left;)ft=ft.left;else for(ft=nt.parent;ft&&ft.right===nt;)nt=ft,ft=ft.parent;return ft},h.prototype.prev=function(nt){var ft=nt;if(ft)if(ft.left)for(ft=ft.left;ft&&ft.right;)ft=ft.right;else for(ft=nt.parent;ft&&ft.left===nt;)nt=ft,ft=ft.parent;return ft},h.prototype.forEach=function(nt){for(var ft=this._root,Si=[],as=!1,ys=0;!as;)ft?(Si.push(ft),ft=ft.left):Si.length>0?(nt(ft=Si.pop(),ys++),ft=ft.right):as=!0;return this},h.prototype.range=function(nt,ft,Si,as){for(var ys=[],ps=this._compare,Ds=this._root;ys.length!==0||Ds;)if(Ds)ys.push(Ds),Ds=Ds.left;else{if(ps((Ds=ys.pop()).key,ft)>0)break;if(ps(Ds.key,nt)>=0&&Si.call(as,Ds))return this;Ds=Ds.right}return this},h.prototype.keys=function(){for(var nt=this._root,ft=[],Si=[],as=!1;!as;)nt?(ft.push(nt),nt=nt.left):ft.length>0?(nt=ft.pop(),Si.push(nt.key),nt=nt.right):as=!0;return Si},h.prototype.values=function(){for(var nt=this._root,ft=[],Si=[],as=!1;!as;)nt?(ft.push(nt),nt=nt.left):ft.length>0?(nt=ft.pop(),Si.push(nt.data),nt=nt.right):as=!0;return Si},h.prototype.at=function(nt){for(var ft=this._root,Si=[],as=!1,ys=0;!as;)if(ft)Si.push(ft),ft=ft.left;else if(Si.length>0){if(ft=Si.pop(),ys===nt)return ft;ys++,ft=ft.right}else as=!0;return null},h.prototype.load=function(nt,ft,Si){if(nt===void 0&&(nt=[]),ft===void 0&&(ft=[]),Si===void 0&&(Si=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var as=nt.length;return Si&&w(nt,ft,0,as-1,this._compare),this._root=g(null,nt,ft,0,as),this._size=as,this},h.prototype.min=function(){var nt=this.minNode(this._root);return nt?nt.key:null},h.prototype.max=function(){var nt=this.maxNode(this._root);return nt?nt.key:null},h.prototype.isEmpty=function(){return this._root===null},f.size.get=function(){return this._size},h.createTree=function(nt,ft,Si,as,ys){return new h(Si,ys).load(nt,ft,as)},Object.defineProperties(h.prototype,f);var C=0,O=1,j=2,W=3,K=0,oe=1,ue=2,be=3;function ke(nt,ft,Si){ft===null?(nt.inOut=!1,nt.otherInOut=!0):(nt.isSubject===ft.isSubject?(nt.inOut=!ft.inOut,nt.otherInOut=ft.otherInOut):(nt.inOut=!ft.otherInOut,nt.otherInOut=ft.isVertical()?!ft.inOut:ft.inOut),ft&&(nt.prevInResult=!Fe(ft,Si)||ft.isVertical()?ft.prevInResult:ft));var as=Fe(nt,Si);nt.resultTransition=as?function(ys,ps){var Ds,Tr=!ys.inOut,Eo=!ys.otherInOut;switch(ps){case K:Ds=Tr&&Eo;break;case oe:Ds=Tr||Eo;break;case be:Ds=Tr^Eo;break;case ue:Ds=ys.isSubject?Tr&&!Eo:Eo&&!Tr}return Ds?1:-1}(nt,Si):0}function Fe(nt,ft){switch(nt.type){case C:switch(ft){case K:return!nt.otherInOut;case oe:return nt.otherInOut;case ue:return nt.isSubject&&nt.otherInOut||!nt.isSubject&&!nt.otherInOut;case be:return!0}break;case j:return ft===K||ft===oe;case W:return ft===ue;case O:return!1}return!1}var Qe=function(nt,ft,Si,as,ys){this.left=ft,this.point=nt,this.otherEvent=Si,this.isSubject=as,this.type=ys||C,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},it={inResult:{configurable:!0}};function Se(nt,ft){return nt[0]===ft[0]&&nt[1]===ft[1]}Qe.prototype.isBelow=function(nt){var ft=this.point,Si=this.otherEvent.point;return this.left?(ft[0]-nt[0])*(Si[1]-nt[1])-(Si[0]-nt[0])*(ft[1]-nt[1])>0:(Si[0]-nt[0])*(ft[1]-nt[1])-(ft[0]-nt[0])*(Si[1]-nt[1])>0},Qe.prototype.isAbove=function(nt){return!this.isBelow(nt)},Qe.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},it.inResult.get=function(){return this.resultTransition!==0},Qe.prototype.clone=function(){var nt=new Qe(this.point,this.left,this.otherEvent,this.isSubject,this.type);return nt.contourId=this.contourId,nt.resultTransition=this.resultTransition,nt.prevInResult=this.prevInResult,nt.isExteriorRing=this.isExteriorRing,nt.inOut=this.inOut,nt.otherInOut=this.otherInOut,nt},Object.defineProperties(Qe.prototype,it);var Xe=11102230246251565e-32,st=134217729,dt=(3+8*Xe)*Xe;function Ot(nt,ft,Si,as,ys){var ps,Ds,Tr,Eo,Co=ft[0],Jr=as[0],Dn=0,ha=0;Jr>Co==Jr>-Co?(ps=Co,Co=ft[++Dn]):(ps=Jr,Jr=as[++ha]);var Po=0;if(Dn<nt&&ha<Si)for(Jr>Co==Jr>-Co?(Tr=ps-((Ds=Co+ps)-Co),Co=ft[++Dn]):(Tr=ps-((Ds=Jr+ps)-Jr),Jr=as[++ha]),ps=Ds,Tr!==0&&(ys[Po++]=Tr);Dn<nt&&ha<Si;)Jr>Co==Jr>-Co?(Tr=ps-((Ds=ps+Co)-(Eo=Ds-ps))+(Co-Eo),Co=ft[++Dn]):(Tr=ps-((Ds=ps+Jr)-(Eo=Ds-ps))+(Jr-Eo),Jr=as[++ha]),ps=Ds,Tr!==0&&(ys[Po++]=Tr);for(;Dn<nt;)Tr=ps-((Ds=ps+Co)-(Eo=Ds-ps))+(Co-Eo),Co=ft[++Dn],ps=Ds,Tr!==0&&(ys[Po++]=Tr);for(;ha<Si;)Tr=ps-((Ds=ps+Jr)-(Eo=Ds-ps))+(Jr-Eo),Jr=as[++ha],ps=Ds,Tr!==0&&(ys[Po++]=Tr);return ps===0&&Po!==0||(ys[Po++]=ps),Po}function Pt(nt){return new Float64Array(nt)}var Dt=33306690738754716e-32,Jt=22204460492503146e-32,yi=11093356479670487e-47,$i=Pt(4),Ii=Pt(8),Hi=Pt(12),Ki=Pt(16),bi=Pt(4);function Gi(nt,ft,Si){var as=function(ys,ps,Ds,Tr,Eo,Co){var Jr=(ps-Co)*(Ds-Eo),Dn=(ys-Eo)*(Tr-Co),ha=Jr-Dn;if(Jr===0||Dn===0||Jr>0!=Dn>0)return ha;var Po=Math.abs(Jr+Dn);return Math.abs(ha)>=Dt*Po?ha:-function(rl,wa,In,Cl,Pa,ca,Ta){var Vn,so,jn,ol,yr,tn,Ia,gl,Oa,Vh,Zn,Th,af,bu,jd,lf,zy,Uh,Cc=rl-Pa,wu=In-Pa,up=wa-ca,Yu=Cl-ca;$i[0]=(jd=(gl=Cc-(Ia=(tn=st*Cc)-(tn-Cc)))*(Vh=Yu-(Oa=(tn=st*Yu)-(tn-Yu)))-((bu=Cc*Yu)-Ia*Oa-gl*Oa-Ia*Vh))-((Zn=jd-(zy=(gl=up-(Ia=(tn=st*up)-(tn-up)))*(Vh=wu-(Oa=(tn=st*wu)-(tn-wu)))-((lf=up*wu)-Ia*Oa-gl*Oa-Ia*Vh)))+(yr=jd-Zn))+(yr-zy),$i[1]=(af=bu-((Th=bu+Zn)-(yr=Th-bu))+(Zn-yr))-((Zn=af-lf)+(yr=af-Zn))+(yr-lf),$i[2]=Th-((Uh=Th+Zn)-(yr=Uh-Th))+(Zn-yr),$i[3]=Uh;var Kx=function(T2,hw){for(var cw=hw[0],bb=1;bb<4;bb++)cw+=hw[bb];return cw}(0,$i),q0=Jt*Ta;if(Kx>=q0||-Kx>=q0||(Vn=rl-(Cc+(yr=rl-Cc))+(yr-Pa),jn=In-(wu+(yr=In-wu))+(yr-Pa),so=wa-(up+(yr=wa-up))+(yr-ca),ol=Cl-(Yu+(yr=Cl-Yu))+(yr-ca),Vn===0&&so===0&&jn===0&&ol===0)||(q0=yi*Ta+dt*Math.abs(Kx),(Kx+=Cc*ol+Yu*Vn-(up*jn+wu*so))>=q0||-Kx>=q0))return Kx;bi[0]=(jd=(gl=Vn-(Ia=(tn=st*Vn)-(tn-Vn)))*(Vh=Yu-(Oa=(tn=st*Yu)-(tn-Yu)))-((bu=Vn*Yu)-Ia*Oa-gl*Oa-Ia*Vh))-((Zn=jd-(zy=(gl=so-(Ia=(tn=st*so)-(tn-so)))*(Vh=wu-(Oa=(tn=st*wu)-(tn-wu)))-((lf=so*wu)-Ia*Oa-gl*Oa-Ia*Vh)))+(yr=jd-Zn))+(yr-zy),bi[1]=(af=bu-((Th=bu+Zn)-(yr=Th-bu))+(Zn-yr))-((Zn=af-lf)+(yr=af-Zn))+(yr-lf),bi[2]=Th-((Uh=Th+Zn)-(yr=Uh-Th))+(Zn-yr),bi[3]=Uh;var ES=Ot(4,$i,4,bi,Ii);bi[0]=(jd=(gl=Cc-(Ia=(tn=st*Cc)-(tn-Cc)))*(Vh=ol-(Oa=(tn=st*ol)-(tn-ol)))-((bu=Cc*ol)-Ia*Oa-gl*Oa-Ia*Vh))-((Zn=jd-(zy=(gl=up-(Ia=(tn=st*up)-(tn-up)))*(Vh=jn-(Oa=(tn=st*jn)-(tn-jn)))-((lf=up*jn)-Ia*Oa-gl*Oa-Ia*Vh)))+(yr=jd-Zn))+(yr-zy),bi[1]=(af=bu-((Th=bu+Zn)-(yr=Th-bu))+(Zn-yr))-((Zn=af-lf)+(yr=af-Zn))+(yr-lf),bi[2]=Th-((Uh=Th+Zn)-(yr=Uh-Th))+(Zn-yr),bi[3]=Uh;var CS=Ot(ES,Ii,4,bi,Hi);bi[0]=(jd=(gl=Vn-(Ia=(tn=st*Vn)-(tn-Vn)))*(Vh=ol-(Oa=(tn=st*ol)-(tn-ol)))-((bu=Vn*ol)-Ia*Oa-gl*Oa-Ia*Vh))-((Zn=jd-(zy=(gl=so-(Ia=(tn=st*so)-(tn-so)))*(Vh=jn-(Oa=(tn=st*jn)-(tn-jn)))-((lf=so*jn)-Ia*Oa-gl*Oa-Ia*Vh)))+(yr=jd-Zn))+(yr-zy),bi[1]=(af=bu-((Th=bu+Zn)-(yr=Th-bu))+(Zn-yr))-((Zn=af-lf)+(yr=af-Zn))+(yr-lf),bi[2]=Th-((Uh=Th+Zn)-(yr=Uh-Th))+(Zn-yr),bi[3]=Uh;var PS=Ot(CS,Hi,4,bi,Ki);return Ki[PS-1]}(ys,ps,Ds,Tr,Eo,Co,Po)}(nt[0],nt[1],ft[0],ft[1],Si[0],Si[1]);return as>0?-1:as<0?1:0}function mi(nt,ft){var Si=nt.point,as=ft.point;return Si[0]>as[0]?1:Si[0]<as[0]?-1:Si[1]!==as[1]?Si[1]>as[1]?1:-1:function(ys,ps,Ds,Tr){return ys.left!==ps.left?ys.left?1:-1:Gi(Ds,ys.otherEvent.point,ps.otherEvent.point)!==0?ys.isBelow(ps.otherEvent.point)?-1:1:!ys.isSubject&&ps.isSubject?1:-1}(nt,ft,Si)}function xi(nt,ft,Si){var as=new Qe(ft,!1,nt,nt.isSubject),ys=new Qe(ft,!0,nt.otherEvent,nt.isSubject);return Se(nt.point,nt.otherEvent.point)&&console.warn("what is that, a collapsed segment?",nt),as.contourId=ys.contourId=nt.contourId,mi(ys,nt.otherEvent)>0&&(nt.otherEvent.left=!0,ys.left=!1),nt.otherEvent.otherEvent=ys,nt.otherEvent=as,Si.push(ys),Si.push(as),Si}function ss(nt,ft){return nt[0]*ft[1]-nt[1]*ft[0]}function rs(nt,ft){return nt[0]*ft[0]+nt[1]*ft[1]}function tr(nt,ft,Si){var as=function(Eo,Co,Jr,Dn,ha){var Po=[Co[0]-Eo[0],Co[1]-Eo[1]],rl=[Dn[0]-Jr[0],Dn[1]-Jr[1]];function wa(tn,Ia,gl){return[tn[0]+Ia*gl[0],tn[1]+Ia*gl[1]]}var In=[Jr[0]-Eo[0],Jr[1]-Eo[1]],Cl=ss(Po,rl),Pa=Cl*Cl,ca=rs(Po,Po);if(Pa>0){var Ta=ss(In,rl)/Cl;if(Ta<0||Ta>1)return null;var Vn=ss(In,Po)/Cl;return Vn<0||Vn>1?null:Ta===0||Ta===1?[wa(Eo,Ta,Po)]:Vn===0||Vn===1?[wa(Jr,Vn,rl)]:[wa(Eo,Ta,Po)]}if((Pa=(Cl=ss(In,Po))*Cl)>0)return null;var so=rs(Po,In)/ca,jn=so+rs(Po,rl)/ca,ol=Math.min(so,jn),yr=Math.max(so,jn);return ol<=1&&yr>=0?ol===1?[wa(Eo,ol>0?ol:0,Po)]:yr===0?[wa(Eo,yr<1?yr:1,Po)]:[wa(Eo,ol>0?ol:0,Po),wa(Eo,yr<1?yr:1,Po)]:null}(nt.point,nt.otherEvent.point,ft.point,ft.otherEvent.point),ys=as?as.length:0;if(ys===0||ys===1&&(Se(nt.point,ft.point)||Se(nt.otherEvent.point,ft.otherEvent.point))||ys===2&&nt.isSubject===ft.isSubject)return 0;if(ys===1)return Se(nt.point,as[0])||Se(nt.otherEvent.point,as[0])||xi(nt,as[0],Si),Se(ft.point,as[0])||Se(ft.otherEvent.point,as[0])||xi(ft,as[0],Si),1;var ps=[],Ds=!1,Tr=!1;return Se(nt.point,ft.point)?Ds=!0:mi(nt,ft)===1?ps.push(ft,nt):ps.push(nt,ft),Se(nt.otherEvent.point,ft.otherEvent.point)?Tr=!0:mi(nt.otherEvent,ft.otherEvent)===1?ps.push(ft.otherEvent,nt.otherEvent):ps.push(nt.otherEvent,ft.otherEvent),Ds&&Tr||Ds?(ft.type=O,nt.type=ft.inOut===nt.inOut?j:W,Ds&&!Tr&&xi(ps[1].otherEvent,ps[0].point,Si),2):Tr?(xi(ps[0],ps[1].point,Si),3):ps[0]!==ps[3].otherEvent?(xi(ps[0],ps[1].point,Si),xi(ps[1],ps[2].point,Si),3):(xi(ps[0],ps[1].point,Si),xi(ps[3].otherEvent,ps[2].point,Si),3)}function Vs(nt,ft){if(nt===ft)return 0;if(Gi(nt.point,nt.otherEvent.point,ft.point)!==0||Gi(nt.point,nt.otherEvent.point,ft.otherEvent.point)!==0)return Se(nt.point,ft.point)?nt.isBelow(ft.otherEvent.point)?-1:1:nt.point[0]===ft.point[0]?nt.point[1]<ft.point[1]?-1:1:mi(nt,ft)===1?ft.isAbove(nt.point)?-1:1:nt.isBelow(ft.point)?-1:1;if(nt.isSubject!==ft.isSubject)return nt.isSubject?-1:1;var Si=nt.point,as=ft.point;return Si[0]===as[0]&&Si[1]===as[1]?(Si=nt.otherEvent.point)[0]===(as=ft.otherEvent.point)[0]&&Si[1]===as[1]?0:nt.contourId>ft.contourId?1:-1:mi(nt,ft)===1?1:-1}var gs=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function ts(nt,ft,Si,as){var ys,ps=nt+1,Ds=ft[nt].point,Tr=ft.length;for(ps<Tr&&(ys=ft[ps].point);ps<Tr&&ys[0]===Ds[0]&&ys[1]===Ds[1];){if(!Si[ps])return ps;++ps<Tr&&(ys=ft[ps].point)}for(ps=nt-1;Si[ps]&&ps>as;)ps--;return ps}gs.prototype.isExterior=function(){return this.holeOf==null};var Br=Us,Bs=Us;function Us(nt,ft){if(!(this instanceof Us))return new Us(nt,ft);if(this.data=nt||[],this.length=this.data.length,this.compare=ft||Mr,this.length>0)for(var Si=(this.length>>1)-1;Si>=0;Si--)this._down(Si)}function Mr(nt,ft){return nt<ft?-1:nt>ft?1:0}Us.prototype={push:function(nt){this.data.push(nt),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var nt=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),nt}},peek:function(){return this.data[0]},_up:function(nt){for(var ft=this.data,Si=this.compare,as=ft[nt];nt>0;){var ys=nt-1>>1,ps=ft[ys];if(Si(as,ps)>=0)break;ft[nt]=ps,nt=ys}ft[nt]=as},_down:function(nt){for(var ft=this.data,Si=this.compare,as=this.length>>1,ys=ft[nt];nt<as;){var ps=1+(nt<<1),Ds=ps+1,Tr=ft[ps];if(Ds<this.length&&Si(ft[Ds],Tr)<0&&(ps=Ds,Tr=ft[Ds]),Si(Tr,ys)>=0)break;ft[nt]=Tr,nt=ps}ft[nt]=ys}},Br.default=Bs;var $r=Math.max,Wr=Math.min,uo=0;function Kr(nt,ft,Si,as,ys,ps){var Ds,Tr,Eo,Co,Jr,Dn;for(Ds=0,Tr=nt.length-1;Ds<Tr;Ds++)if(Co=nt[Ds+1],Jr=new Qe(Eo=nt[Ds],!1,void 0,ft),Dn=new Qe(Co,!1,Jr,ft),Jr.otherEvent=Dn,Eo[0]!==Co[0]||Eo[1]!==Co[1]){Jr.contourId=Dn.contourId=Si,ps||(Jr.isExteriorRing=!1,Dn.isExteriorRing=!1),mi(Jr,Dn)>0?Dn.left=!0:Jr.left=!0;var ha=Eo[0],Po=Eo[1];ys[0]=Wr(ys[0],ha),ys[1]=Wr(ys[1],Po),ys[2]=$r(ys[2],ha),ys[3]=$r(ys[3],Po),as.push(Jr),as.push(Dn)}}var po=[];function Pn(nt,ft,Si){typeof nt[0][0][0]=="number"&&(nt=[nt]),typeof ft[0][0][0]=="number"&&(ft=[ft]);var as=function(Po,rl,wa){var In=null;return Po.length*rl.length==0&&(wa===K?In=po:wa===ue?In=Po:wa!==oe&&wa!==be||(In=Po.length===0?rl:Po)),In}(nt,ft,Si);if(as)return as===po?null:as;var ys=[1/0,1/0,-1/0,-1/0],ps=[1/0,1/0,-1/0,-1/0],Ds=function(Po,rl,wa,In,Cl){var Pa,ca,Ta,Vn,so,jn,ol=new Br(null,mi);for(Ta=0,Vn=Po.length;Ta<Vn;Ta++)for(so=0,jn=(Pa=Po[Ta]).length;so<jn;so++)(ca=so===0)&&uo++,Kr(Pa[so],!0,uo,ol,wa,ca);for(Ta=0,Vn=rl.length;Ta<Vn;Ta++)for(so=0,jn=(Pa=rl[Ta]).length;so<jn;so++)ca=so===0,Cl===ue&&(ca=!1),ca&&uo++,Kr(Pa[so],!1,uo,ol,In,ca);return ol}(nt,ft,ys,ps,Si);if(as=function(Po,rl,wa,In,Cl){var Pa=null;return(wa[0]>In[2]||In[0]>wa[2]||wa[1]>In[3]||In[1]>wa[3])&&(Cl===K?Pa=po:Cl===ue?Pa=Po:Cl!==oe&&Cl!==be||(Pa=Po.concat(rl))),Pa}(nt,ft,ys,ps,Si))return as===po?null:as;for(var Tr=function(Po){var rl,wa,In=function(Ta){var Vn,so,jn,ol,yr=[];for(so=0,jn=Ta.length;so<jn;so++)((Vn=Ta[so]).left&&Vn.inResult||!Vn.left&&Vn.otherEvent.inResult)&&yr.push(Vn);for(var tn=!1;!tn;)for(tn=!0,so=0,jn=yr.length;so<jn;so++)so+1<jn&&mi(yr[so],yr[so+1])===1&&(ol=yr[so],yr[so]=yr[so+1],yr[so+1]=ol,tn=!1);for(so=0,jn=yr.length;so<jn;so++)(Vn=yr[so]).otherPos=so;for(so=0,jn=yr.length;so<jn;so++)(Vn=yr[so]).left||(ol=Vn.otherPos,Vn.otherPos=Vn.otherEvent.otherPos,Vn.otherEvent.otherPos=ol);return yr}(Po),Cl={},Pa=[],ca=function(){if(!Cl[rl]){var Ta=Pa.length,Vn=function(yr,tn,Ia){var gl=new gs;if(yr.prevInResult!=null){var Oa=yr.prevInResult,Vh=Oa.outputContourId;if(Oa.resultTransition>0){var Zn=tn[Vh];if(Zn.holeOf!=null){var Th=Zn.holeOf;tn[Th].holeIds.push(Ia),gl.holeOf=Th,gl.depth=tn[Vh].depth}else tn[Vh].holeIds.push(Ia),gl.holeOf=Vh,gl.depth=tn[Vh].depth+1}else gl.holeOf=null,gl.depth=tn[Vh].depth}else gl.holeOf=null,gl.depth=0;return gl}(In[rl],Pa,Ta),so=function(yr){Cl[yr]=!0,yr<In.length&&In[yr]&&(In[yr].outputContourId=Ta)},jn=rl,ol=rl;for(Vn.points.push(In[rl].point);so(jn),so(jn=In[jn].otherPos),Vn.points.push(In[jn].point),!((jn=ts(jn,In,Cl,ol))==ol||jn>=In.length)&&In[jn];);Pa.push(Vn)}};for(rl=0,wa=In.length;rl<wa;rl++)ca();return Pa}(function(Po,rl,wa,In,Cl,Pa){for(var ca,Ta,Vn,so=new h(Vs),jn=[],ol=Math.min(In[2],Cl[2]);Po.length!==0;){var yr=Po.pop();if(jn.push(yr),Pa===K&&yr.point[0]>ol||Pa===ue&&yr.point[0]>In[2])break;if(yr.left){Ta=ca=so.insert(yr),ca=ca!==(Vn=so.minNode())?so.prev(ca):null,Ta=so.next(Ta);var tn=ca?ca.key:null;if(ke(yr,tn,Pa),Ta&&tr(yr,Ta.key,Po)===2&&(ke(yr,tn,Pa),ke(Ta.key,yr,Pa)),ca&&tr(ca.key,yr,Po)===2){var Ia=ca;ke(tn,(Ia=Ia!==Vn?so.prev(Ia):null)?Ia.key:null,Pa),ke(yr,tn,Pa)}}else Ta=ca=so.find(yr=yr.otherEvent),ca&&Ta&&(ca=ca!==Vn?so.prev(ca):null,Ta=so.next(Ta),so.remove(yr),Ta&&ca&&tr(ca.key,Ta.key,Po))}return jn}(Ds,0,0,ys,ps,Si)),Eo=[],Co=0;Co<Tr.length;Co++){var Jr=Tr[Co];if(Jr.isExterior()){for(var Dn=[Jr.points],ha=0;ha<Jr.holeIds.length;ha++)Dn.push(Tr[Jr.holeIds[ha]].points);Eo.push(Dn)}}return Eo}var ba={UNION:oe,DIFFERENCE:ue,INTERSECTION:K,XOR:be};i.diff=function(nt,ft){return Pn(nt,ft,ue)},i.intersection=function(nt,ft){return Pn(nt,ft,K)},i.operations=ba,i.union=function(nt,ft){return Pn(nt,ft,oe)},i.xor=function(nt,ft){return Pn(nt,ft,be)},Object.defineProperty(i,"__esModule",{value:!0})})(e)}(0,Ec.exports)),Ec.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function il(s,e,i,o){const h=[],f=o===0?(g,w,C,O,j,W)=>{g.push(new Wi(W,C+(W-w)/(O-w)*(j-C)))}:(g,w,C,O,j,W)=>{g.push(new Wi(w+(W-C)/(j-C)*(O-w),W))};for(const g of s){const w=[];for(const C of g){if(C.length<=2)continue;const O=[];for(let K=0;K<C.length-1;K++){const oe=C[K].x,ue=C[K].y,be=C[K+1].x,ke=C[K+1].y,Fe=o===0?oe:ue,Qe=o===0?be:ke;Fe<e?Qe>e&&f(O,oe,ue,be,ke,e):Fe>i?Qe<i&&f(O,oe,ue,be,ke,i):O.push(C[K]),Qe<e&&Fe>=e&&f(O,oe,ue,be,ke,e),Qe>i&&Fe<=i&&f(O,oe,ue,be,ke,i)}let j=C[C.length-1];const W=o===0?j.x:j.y;W>=e&&W<=i&&O.push(j),O.length&&(j=O[O.length-1],O[0].x===j.x&&O[0].y===j.y||O.push(O[0]),w.push(O))}w.length&&h.push(w)}return h}function zf(s,e){const i=Op(s),o=Op([e]),h=aa.intersection(i,o);return h==null?[]:xm(h)}function ym(s,e){let o=Op(s,65536);for(;e.valid();e.next()){const[h,f]=e.get(),g=h.x*65536,w=h.y*65536,C=f.x*65536,O=f.y*65536,j=C-g,W=O-w,K=Math.hypot(j,W),oe=Math.trunc(W/K*3),ue=-Math.trunc(j/K*3);o=aa.diff(o,[[[g,w],[C,O],[C+oe,O+ue],[g+oe,w+ue],[g,w]]])}return xm(o,1/65536)}function Op(s,e=1){return[s.map(i=>i.map(o=>[o.x*e,o.y*e]))]}function xm(s,e=1){return s.map(i=>i.map((o,h)=>{const f=o.map(g=>new Wi(g[0]*e,g[1]*e).round());return h>0&&f.reverse(),f}))}class yd{constructor(e,i){this.layoutVertexArray=new Vl,this.indexArray=new ml,this.lineIndexArray=new wc,this.triangleSegments=new sa,this.lineSegments=new sa,this.programConfigurations=new c(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new Sp)}update(e,i,o,h,f,g,w,C){this.programConfigurations.updatePaintArrays(e,i,f,o,h,g,w,C)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,le.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,ye.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,o,h,f,g,w){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,o,h,f,g,void 0,w)}}class Rf{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new yd(e,!1),this.elevationBufferData=new yd(e,!0),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,o,h){this.hasPattern=go("fill",this.layers,this.pixelRatio,i);const f=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:w,id:C,index:O,sourceLayerIndex:j}of e){const W=this.layers[0]._featureFilter.needGeometry,K=us(w,W);if(!this.layers[0]._featureFilter.filter(new qr(this.zoom,{worldview:this.worldview}),K,o))continue;const oe=f?f.evaluate(K,{},o,i.availableImages):void 0,ue={id:C,properties:w.properties,type:w.type,sourceLayerIndex:j,index:O,geometry:W?K.geometry:Ts(w,o,h),patterns:{},sortKey:oe};g.push(ue)}f&&g.sort((w,C)=>w.sortKey-C.sortKey);for(const w of g){const{geometry:C,index:O,sourceLayerIndex:j}=w;if(this.hasPattern){const W=Al("fill",this.layers,w,this.zoom,this.pixelRatio,i);this.patternFeatures.push(W)}else this.addFeature(w,C,O,o,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[O].feature,C,O,j,this.index)}}update(e,i,o,h,f,g,w){this.bufferData.update(e,i,o,h,f,g,w,this.worldview),this.elevationBufferData.update(e,i,o,h,f,g,w,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,i,o,h,f,g,w,this.worldview)}addFeatures(e,i,o,h,f,g){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,i,o,h,g,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,o,h,f,g=[],w,C){const O=$o(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,O,h,o,C):this.addGeometry(O,this.bufferData),this.bufferData.populatePaintArrays(e,o,f,g,h,w,this.worldview),this.elevationBufferData.populatePaintArrays(e,o,f,g,h,w,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,i,o,h,f){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(i,o,h,f,this.worldview))}addElevatedRoadFeature(e,i,o,h,f){const g=new Array,w=Bd.getElevationFeature(e,f);if(!w)return void this.addGeometry(i,this.bufferData);{const O=this.clipPolygonsToTile(i,1);O.length>0&&g.push({polygons:O,elevationFeature:w,elevationTileID:o})}const C={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},o),featureIndex:h};for(const O of g)if(O.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new sh(O.elevationTileID,this.layers,this.zoom,this.lut));const W=O.elevationFeature.isTunnel();let K=0;e.properties.hasOwnProperty(_n)&&(K=+e.properties[_n]);for(const oe of O.polygons)this.elevatedStructures.addPortalCandidates(O.elevationFeature.id,oe,W,O.elevationFeature,K)}O.elevationFeature.constantHeight==null&&(O.polygons=this.prepareElevatedPolygons(O.polygons,O.elevationFeature,O.elevationTileID));const j=new gu(o,O.elevationTileID);this.addElevatedGeometry(O.polygons,j,O.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,h,C)}}addElevatedGeometry(e,i,o,h,f,g){const w={elevation:o,elevationSampler:i,bias:h,index:f,featureInfo:g},[C,O]=this.addGeometry(e,this.elevationBufferData,w);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:C,max:O}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,C),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,O))}addGeometry(e,i,o){let h=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,g=null;o&&(g=o.elevationSampler.constantElevation(o.elevation,o.bias),g!=null&&(h=g,f=g));const w=(C,O,j)=>{if(o!=null)if(O.push(C),g!=null)i.elevatedLayoutVertexArray.emplaceBack(g),j.push(g);else{const W=o.elevationSampler.pointElevation(C,o.elevation,o.bias);i.elevatedLayoutVertexArray.emplaceBack(W),j.push(W),h=Math.min(h,W),f=Math.max(f,W)}};for(const C of e){let O=0;for(const it of C)O+=it.length;const j=i.triangleSegments.prepareSegment(O,i.layoutVertexArray,i.indexArray),W=j.vertexLength,K=[],oe=[],ue=[],be=[],ke=[],Fe=i.layoutVertexArray.length;for(const it of C){if(it.length===0)continue;it!==C[0]&&oe.push(K.length/2);const Se=i.lineSegments.prepareSegment(it.length,i.layoutVertexArray,i.lineIndexArray),Xe=Se.vertexLength;o&&ke.push(i.layoutVertexArray.length-Fe),w(it[0],ue,be),i.layoutVertexArray.emplaceBack(it[0].x,it[0].y),i.lineIndexArray.emplaceBack(Xe+it.length-1,Xe),K.push(it[0].x),K.push(it[0].y);for(let st=1;st<it.length;st++)w(it[st],ue,be),i.layoutVertexArray.emplaceBack(it[st].x,it[st].y),i.lineIndexArray.emplaceBack(Xe+st-1,Xe+st),K.push(it[st].x),K.push(it[st].y);Se.vertexLength+=it.length,Se.primitiveLength+=it.length}const Qe=Le(K,oe);for(let it=0;it<Qe.length;it+=3)i.indexArray.emplaceBack(W+Qe[it],W+Qe[it+1],W+Qe[it+2]);if(Qe.length>0&&o&&this.elevationMode==="hd-road-base"){const it=o.elevation.isTunnel(),Se=o.elevation.safeArea,Xe=this.elevatedStructures.addVertices(ue,be);this.elevatedStructures.addTriangles(Qe,Xe,it);const st=ke.length;if(st>0){for(let dt=0;dt<st-1;dt++)this.elevatedStructures.addRenderableRing(o.index,ke[dt]+Xe,ke[dt+1]-ke[dt],it,Se,o.featureInfo);this.elevatedStructures.addRenderableRing(o.index,ke[st-1]+Xe,ue.length-ke[st-1],it,Se,o.featureInfo)}}j.vertexLength+=O,j.primitiveLength+=Qe.length/3}return[h,f]}prepareElevatedPolygons(e,i,o){const h=1/ui(o),f=[];for(const g of e){const w=ym(g,new hc(i,h));f.push(...w)}return f}clipPolygonsToTile(e,i){const o=-i,h=-i,f=ns+i,g=ns+i;let w=0;const C=[],O=[];for(;w<e.length;w++){const K=e[w],oe=Am(K);(oe.min.x>=o&&oe.max.x<=f&&oe.min.y>=h&&oe.max.y<=g?C:O).push(K)}if(C.length===e.length)return e;const j=[new Wi(o,h),new Wi(f,h),new Wi(f,g),new Wi(o,g),new Wi(o,h)],W=C;for(const K of O)W.push(...zf(K,j));return W}}let Yy,$y,xg,Gm;qe(Rf,"FillBucket",{omit:["layers","patternFeatures"]}),qe(yd,"FillBufferData"),qe(sh,"ElevatedStructures");class kx{constructor(e,i,o,h){if(this.triangleCount=i.length/3,this.min=new Wi(0,0),this.max=new Wi(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[f,g]=[e[0].clone(),e[0].clone()];for(let W=1;W<e.length;++W){const K=e[W];f.x=Math.min(f.x,K.x),f.y=Math.min(f.y,K.y),g.x=Math.max(g.x,K.x),g.y=Math.max(g.y,K.y)}if(h){const W=Math.ceil(Math.max(g.x-f.x,g.y-f.y)/h);o=Math.max(o,W)}if(o===0)return;this.min=f,this.max=g;const w=this.max.sub(this.min);w.x=Math.max(w.x,1),w.y=Math.max(w.y,1);const C=Math.max(w.x,w.y)/o;this.cellsX=Math.max(1,Math.ceil(w.x/C)),this.cellsY=Math.max(1,Math.ceil(w.y/C)),this.xScale=1/C,this.yScale=1/C;const O=[];for(let W=0;W<this.triangleCount;W++){const K=e[i[3*W+0]].sub(this.min),oe=e[i[3*W+1]].sub(this.min),ue=e[i[3*W+2]].sub(this.min),be=Xu(Math.floor(Math.min(K.x,oe.x,ue.x)),this.xScale,this.cellsX),ke=Xu(Math.floor(Math.max(K.x,oe.x,ue.x)),this.xScale,this.cellsX),Fe=Xu(Math.floor(Math.min(K.y,oe.y,ue.y)),this.yScale,this.cellsY),Qe=Xu(Math.floor(Math.max(K.y,oe.y,ue.y)),this.yScale,this.cellsY),it=new Wi(0,0),Se=new Wi(0,0),Xe=new Wi(0,0),st=new Wi(0,0);for(let dt=Fe;dt<=Qe;++dt){it.y=Se.y=dt*C,Xe.y=st.y=(dt+1)*C;for(let Ot=be;Ot<=ke;++Ot)it.x=Xe.x=Ot*C,Se.x=st.x=(Ot+1)*C,(Ig(K,oe,ue,it,Se,st)||Ig(K,oe,ue,it,st,Xe))&&O.push({cellIdx:dt*this.cellsX+Ot,triIdx:W})}}if(O.length===0)return;O.sort((W,K)=>W.cellIdx-K.cellIdx||W.triIdx-K.triIdx);let j=0;for(;j<O.length;){const W=O[j].cellIdx,K={start:this.payload.length,len:0};for(;j<O.length&&O[j].cellIdx===W;)++K.len,this.payload.push(O[j++].triIdx);this.cells[W]=K}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const o=Xu(e.x-this.min.x,this.xScale,this.cellsX),h=Xu(e.y-this.min.y,this.yScale,this.cellsY),f=this.cells[h*this.cellsX+o];if(f){this._lazyInitLookup();for(let g=0;g<f.len;g++){const w=this.payload[f.start+g],C=Math.floor(w/8),O=1<<w%8;if(!(this.lookup[C]&O)&&(this.lookup[C]|=O,i.push(w),i.length===this.triangleCount))return}}}query(e,i,o){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const h=Xu(e.x-this.min.x,this.xScale,this.cellsX),f=Xu(i.x-this.min.x,this.xScale,this.cellsX),g=Xu(e.y-this.min.y,this.yScale,this.cellsY),w=Xu(i.y-this.min.y,this.yScale,this.cellsY);for(let C=g;C<=w;C++)for(let O=h;O<=f;O++){const j=this.cells[C*this.cellsX+O];if(j)for(let W=0;W<j.len;W++){const K=this.payload[j.start+W],oe=Math.floor(K/8),ue=1<<K%8;if(!(this.lookup[oe]&ue)&&(this.lookup[oe]|=ue,o.push(K),o.length===this.triangleCount))return}}}}function Xu(s,e,i){return Math.max(0,Math.min(i-1,Math.floor(s*e)))}qe(kx,"TriangleGridIndex");class qy{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[],this.worldview=e.worldview}updateFootprints(e,i){for(const o of this.footprints)i.push({footprint:o,id:e})}populate(e,i,o,h){const f=[];for(const{feature:g,id:w,index:C,sourceLayerIndex:O}of e){const j=this.layers[0]._featureFilter.needGeometry,W=us(g,j);if(!this.layers[0]._featureFilter.filter(new qr(this.zoom,{worldview:this.worldview}),W,o))continue;const K={id:w,properties:g.properties,type:g.type,sourceLayerIndex:O,index:C,geometry:j?W.geometry:Ts(g,o,h),patterns:{}};f.push(K)}for(const g of f){const{geometry:w,index:C,sourceLayerIndex:O}=g;this.addFeature(g,w,C,o,{},i.availableImages,i.brightness),i.featureIndex.insert(e[C].feature,w,C,O,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,o,h,f,g,w){}destroy(){}addFeature(e,i,o,h,f,g=[],w){for(const C of $o(i,2)){const O=[],j=[],W=[],K=new Wi(1/0,1/0),oe=new Wi(-1/0,-1/0);for(const ke of C)if(ke.length!==0){ke!==C[0]&&W.push(j.length/2);for(let Fe=0;Fe<ke.length;Fe++)j.push(ke[Fe].x),j.push(ke[Fe].y),O.push(ke[Fe]),K.x=Math.min(K.x,ke[Fe].x),K.y=Math.min(K.y,ke[Fe].y),oe.x=Math.max(oe.x,ke[Fe].x),oe.y=Math.max(oe.y,ke[Fe].y)}const ue=Le(j,W),be=new kx(O,ue,8,256);this.footprints.push({vertices:O,indices:ue,grid:be,min:K,max:oe})}}}qe(qy,"ClipBucket",{omit:["layers"]});const R_=bo([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),B_=bo([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),F_=bo([{name:"a_centroid_pos",components:2,type:"Uint16"}]),_g=bo([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Ex=bo([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),N_=bo([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:E0}=R_,Wg=Number.MAX_SAFE_INTEGER;function Hg(s,e,i,o){return s.order<e||s.order===Wg||!(s.clipMask&i)||function(h,f){return f.length!==0&&f.find(g=>g===h)===void 0}(o,s.clipScope)}function Xg(s,e){return s.x-e.x||s.y-e.y}function Yg(s,e){return Xg(s.min,e.min)===0&&Xg(s.max,e.max)===0}function $g(s,e){return!(s.min.x>e.max.x||s.max.x<e.min.x||s.min.y>e.max.y||s.max.y<e.min.y)}function qg(s,e){if(s.length!==e.length)return!1;for(let i=0;i<s.length;i++)if(s[i].sourceId!==e[i].sourceId||!Yg(s[i],e[i])||s[i].order!==e[i].order||s[i].clipMask!==e[i].clipMask||!Ra(s[i].clipScope,e[i].clipScope))return!1;return!0}function Dp(s,e,i){const o=1/ns,h=1/(1<<i.canonical.z),f=(e.x*o+i.canonical.x)*h+i.wrap,g=(e.y*o+i.canonical.y)*h;return{min:new Wi((s.x*o+i.canonical.x)*h+i.wrap,(s.y*o+i.canonical.y)*h),max:new Wi(f,g)}}function yy(s,e,i){const o=1<<i.canonical.z,h=((e.x-i.wrap)*o-i.canonical.x)*ns,f=(e.y*o-i.canonical.y)*ns;return{min:new Wi(((s.x-i.wrap)*o-i.canonical.x)*ns,(s.y*o-i.canonical.y)*ns),max:new Wi(h,f)}}function V_(s,e,i,o,h,f,g){const w=s.indices,C=s.vertices,O=[];for(let j=o;j<o+h;j+=3){const W=e[i[j+0]+f],K=e[i[j+1]+f],oe=e[i[j+2]+f],ue=Math.min(W.x,K.x,oe.x),be=Math.max(W.x,K.x,oe.x),ke=Math.min(W.y,K.y,oe.y),Fe=Math.max(W.y,K.y,oe.y);O.length=0,s.grid.query(new Wi(ue,ke),new Wi(be,Fe),O);for(let Qe=0;Qe<O.length;Qe++){const it=O[Qe];if(Ig(C[w[3*it+0]],C[w[3*it+1]],C[w[3*it+2]],W,K,oe,g))return!0}}return!1}function xy(s,e,i,o){if(!s||!i)return!1;let h=s.vertices;if(!e.canonical.equals(o.canonical)||e.wrap!==o.wrap){if(i.vertices.length<s.vertices.length)return xy(i,o,s,e);const f=e.canonical,g=o.canonical,w=Math.pow(2,g.z-f.z);h=s.vertices.map(C=>new Wi((C.x+f.x*ns)*w-g.x*ns,(C.y+f.y*ns)*w-g.y*ns))}return V_(i,h,s.indices,0,s.indices.length,0,0)}function xd(s,e,i,o){const h=Math.pow(2,o.z-i.z);return new Wi((s+i.x*ns)*h-o.x*ns,(e+i.y*ns)*h-o.y*ns)}function Cx(s,e){const i=[];e.grid.queryPoint(s,i);const o=e.indices,h=e.vertices;for(let f=0;f<i.length;f++){const g=i[f];if(gd([h[o[3*g+0]],h[o[3*g+1]],h[o[3*g+2]]],s))return!0}return!1}const Wm=[new Wi(0,0),new Wi(ns,0),new Wi(ns,ns),new Wi(0,ns)];function Zg(s,e){const i=[];let o=[];if(!e||s.length<2)return[s];if(s.length===2)return xu(s[0],s[1],Wm)?[s]:[];for(let h=0;h<s.length+2;h++){const f=s[h%s.length],g=s[(h+1)%s.length],w=xu(h===0?s[s.length-1]:s[(h-1)%s.length],f,Wm),C=xu(f,g,Wm),O=w||C;O&&o.push(f),O&&C||o.length>0&&(o.length>1&&i.push(o),o=[])}return o.length>1&&i.push(o),i}const _y=br.VectorTileFeature.types,vy=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],Px=["fill-extrusion-flood-light-ground-radius"],C0=Math.pow(2,13),a_=Math.pow(2,15)-1,l_=new Wi(0,1),Nd=2147483648;function _m(s,e,i,o,h,f,g,w){s.emplaceBack((e<<1)+g,(i<<1)+f,(Math.floor(o*C0)<<1)+h,Math.round(w))}function la(s,e,i){s.emplaceBack(e.x*ns,e.y*ns,i?1:0)}function of(s,e,i,o,h,f){s.emplaceBack(e.x,e.y,(i.x<<1)+o,(i.y<<1)+h,f)}function Kg(s,e,i){s.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Zy{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class dc{constructor(){this.centroidXY=new Wi(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Wi(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Wi(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Wi(this.max.x-this.min.x,this.max.y-this.min.y)}}class vg{constructor(){this.acc=new Wi(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,o){this.accCount++,this.acc._add(i);let h=!!this.borders;i.x<e.min.x?(e.min.x=i.x,h=!0):i.x>e.max.x&&(e.max.x=i.x,h=!0),i.y<e.min.y?(e.min.y=i.y,h=!0):i.y>e.max.y&&(e.max.y=i.y,h=!0),((i.x===0||i.x===ns)&&i.x===o.x)!=((i.y===0||i.y===ns)&&i.y===o.y)&&this.processBorderOverlap(i,o),h&&this.checkBorderIntersection(i,o)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,js(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>ns!=e.x>ns&&this.addBorderIntersection(1,js(i.y,e.y,(ns-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,js(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>ns!=e.y>ns&&this.addBorderIntersection(3,js(i.x,e.x,(ns-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const o=this.borders[e];i<o[0]&&(o[0]=i),i>o[1]&&(o[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const o=e.x===0?0:1;this.addBorderIntersection(o,i.y),this.addBorderIntersection(o,e.y)}else{const o=e.y===0?2:3;this.addBorderIntersection(o,i.x),this.addBorderIntersection(o,e.x)}}centroid(){return this.accCount===0?new Wi(0,0):new Wi(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function Hm(s,e){const i=s.add(e)._unit(),o=at(s.x*i.x+s.y*i.y,-1,1);var h,f,g;return h=Math.acos(o),Math.min(4,Math.max(-4,Math.tan(h)))/4*a_*((f=s).x*(g=e).y-f.y*g.x<0?-1:1)}const U_=[s=>s.x<0,s=>s.x>ns,s=>s.y<0,s=>s.y>ns];function Bf(s,e,i,o){const h=[4];if(o===0)return h;i._mult(o);const f=s.sub(i),g=e.sub(i),w=[s,e,f,g];for(let C=0;C<4;C++)for(const O of w)if(U_[C](O)){h.push(C);break}return h}class bg{constructor(e){this.vertexArray=new cu,this.indexArray=new ml,this.programConfigurations=new c(e.layers,{zoom:e.zoom,lut:e.lut},i=>Px.includes(i)),this._segments=new sa,this.hiddenByLandmarkVertexArray=new Yc,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new sa}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,o,h=!1){const f=e.length;if(f>2){let g=Math.max(0,this._segments.get().length-1);const w=this._segments._prepareSegment(4*f,this.vertexArray.length,2*this._segmentToGroundQuads[g].length);let C;g!==this._segments.get().length-1&&(g++,this._segmentToGroundQuads[g]=[],this._segmentToRegionTriCounts[g]=[0,0,0,0,0]);{const O=e[0],j=e[1];C=Hm(O.sub(e[f-1])._perp()._unit(),j.sub(O)._perp()._unit())}for(let O=0;O<f;O++){const j=O===f-1?0:O+1,W=e[O],K=e[j],oe=e[j===f-1?0:j+1],ue=K.sub(W)._perp()._unit(),be=Hm(ue,oe.sub(K)._perp()._unit()),ke=C,Fe=be;if(cp(W,K,i)||h&&Ix(W,i)&&Ix(K,i)){C=be;continue}const Qe=w.vertexLength;of(this.vertexArray,W,K,1,1,ke),of(this.vertexArray,W,K,1,0,ke),of(this.vertexArray,W,K,0,1,Fe),of(this.vertexArray,W,K,0,0,Fe),w.vertexLength+=4;const it=Bf(W,K,ue,o);for(const Se of it)this._segmentToGroundQuads[g].push({id:Qe,region:Se}),this._segmentToRegionTriCounts[g][Se]+=2,w.primitiveLength+=2;C=be}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let o=0;o<i;o++)this._segmentToGroundQuads[o].sort((h,f)=>h.region-f.region);for(let o=0;o<i;o++){const h=this._segmentToGroundQuads[o],f=e[o],g=this._segmentToRegionTriCounts[o];g.reduce((C,O)=>C+O,0);let w=0;for(let C=0;C<=4;C++){const O=g[C];if(O!==0){let j=this.regionSegments[C];j||(j=this.regionSegments[C]=new sa);const W={vertexOffset:f.vertexOffset,primitiveOffset:f.primitiveOffset+w,vertexLength:f.vertexLength,primitiveLength:O};j.get().push(W)}w+=O}for(let C=0;C<h.length;C++){const O=h[C].id;this.indexArray.emplaceBack(O,O+1,O+3),this.indexArray.emplaceBack(O,O+3,O+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,o,h,f,g,w){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,o,h,f,g,void 0,w)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,B_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,o,h,f,g,w,C){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,o,h,f,g,w,C)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const o=e.flags&Nd?1:0;for(let h=e.groundVertexArrayOffset;h<i;++h)this.hiddenByLandmarkVertexArray.emplace(h,o);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,Ex.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class by{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ml,this.footprintVertices=new Vl,this.footprintSegments=[],this.layoutVertexArray=new Sf,this.centroidVertexArray=new $l,this.wallVertexArray=new ef,this.indexArray=new ml,this.programConfigurations=new c(e.layers,{zoom:e.zoom,lut:e.lut},i=>vy.includes(i)),this.segments=new sa,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new bg(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,o,h){this.features=[],this.hasPattern=go("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=ui(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:f,id:g,index:w,sourceLayerIndex:C}of e){const O=this.layers[0]._featureFilter.needGeometry,j=us(f,O);if(!this.layers[0]._featureFilter.filter(new qr(this.zoom,{worldview:this.worldview}),j,o))continue;const W={id:g,sourceLayerIndex:C,index:w,geometry:O?j.geometry:Ts(f,o,h),properties:f.properties,type:f.type,patterns:{}},K=this.layoutVertexArray.length,oe=_y[W.type]==="Polygon";if(this.hasPattern)this.features.push(Al("fill-extrusion",this.layers,W,this.zoom,this.pixelRatio,i));else if(this.wallMode)for(const ue of W.geometry)for(const be of Zg(ue,oe))this.addFeature(W,[be],w,o,{},i.availableImages,h,i.brightness);else this.addFeature(W,W.geometry,w,o,{},i.availableImages,h,i.brightness);i.featureIndex.insert(f,W.geometry,w,C,this.index,K)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,o,h,f,g){for(const w of this.features){const C=_y[w.type]==="Polygon",{geometry:O}=w;if(this.wallMode)for(const j of O)for(const W of Zg(j,C))this.addFeature(w,[W],w.index,i,o,h,f,g);else this.addFeature(w,O,w.index,i,o,h,f,g)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,o,h,f,g,w){this.programConfigurations.updatePaintArrays(e,i,f,o,h,g,w,this.worldview),this.groundEffect.update(e,i,f,o,h,g,w,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,E0),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,_g.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,N_.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,F_.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,h,f,g,w,C){const O=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,j=[new Wi(0,0),new Wi(ns,ns)],W=w.projection,K=W.name==="globe",oe=this.wallMode||_y[e.type]==="Polygon",ue=new vg;ue.centroidDataIndex=this.centroidData.length;const be=new dc,ke=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},h)<=0,Fe=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},h);let Qe;if(be.height=Fe,be.vertexArrayOffset=this.layoutVertexArray.length,be.groundVertexArrayOffset=this.groundEffect.vertexArray.length,K&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ud),this.wallMode){if(K)return void Ar("Non zero fill-extrusion-line-width is not yet supported on globe.");if(i.length!==1)return;Qe=function(Dt){const Jt=Dt[0].x===Dt[Dt.length-1].x&&Dt[0].y===Dt[Dt.length-1].y;(function(gs){let ts=0;const Br=gs.length;for(let Bs=0;Bs<Br;Bs++)ts+=(gs[(Bs+1)%Br].x-gs[Bs].x)*(gs[(Bs+1)%Br].y+gs[Bs].y);return ts>=0})(Dt)||(Dt=Dt.reverse());const $i={geometry:[],joinNormals:[],indices:[]},Ii=[],Hi=[],Ki=[];let bi=Dt.length;for(;bi>=2&&Dt[bi-1].equals(Dt[bi-2]);)bi--;if(bi<(Jt?3:2))return $i;let Gi,mi,xi,ss,rs,tr=0;for(;tr<bi-1&&Dt[tr].equals(Dt[tr+1]);)tr++;Jt&&(Gi=Dt[bi-2],rs=Dt[tr].sub(Gi)._unit()._perp());for(let gs=tr;gs<bi;gs++){if(xi=gs===bi-1?Jt?Dt[tr+1]:void 0:Dt[gs+1],xi&&Dt[gs].equals(xi))continue;rs&&(ss=rs),Gi&&(mi=Gi),Gi=Dt[gs],rs=xi?xi.sub(Gi)._unit()._perp():ss,ss=ss||rs;let ts=ss.add(rs);ts.x===0&&ts.y===0||ts._unit();const Br=ts.x*rs.x+ts.y*rs.y,Bs=Br!==0?1/Br:1/0,Us=ss.x*rs.y-ss.y*rs.x>0;let Mr="miter";const $r=2;Mr==="miter"&&Bs>$r&&(Mr="bevel"),Mr==="bevel"&&(Bs>100&&(Mr="flipbevel"),Bs<$r&&(Mr="miter"));const Wr=(uo,Kr,po,Pn)=>{const ba=new Wi(uo.x,uo.y),nt=new Wi(uo.x,uo.y);ba.x+=Kr.x*Pn,ba.y+=Kr.y*Pn,nt.x-=Kr.x*Math.max(po,1),nt.y-=Kr.y*Math.max(po,1),Ki.push(Kr),Ii.push(ba),Hi.push(nt)};if(Mr==="miter")ts._mult(Bs),Wr(Gi,ts,0,0);else if(Mr==="flipbevel")ts=rs.mult(-1),Wr(Gi,ts,0,0),Wr(Gi,ts.mult(-1),0,0);else{const uo=-Math.sqrt(Bs*Bs-1),Kr=Us?uo:0,po=Us?0:uo;mi&&Wr(Gi,ss,Kr,po),xi&&Wr(Gi,rs,Kr,po)}}$i.geometry=[...Ii,...Hi.reverse(),Ii[0]],$i.joinNormals=[...Ki,...Ki.reverse(),Ki[Ki.length-1]];const Vs=$i.geometry.length-1;for(let gs=0;gs<Vs/2;gs++)if(gs+1<Vs/2){let ts=gs,Br=gs+1,Bs=Vs-1-gs,Us=Vs-2-gs;ts=ts===0?Vs-1:ts-1,Br=Br===0?Vs-1:Br-1,Bs=Bs===0?Vs-1:Bs-1,Us=Us===0?Vs-1:Us-1,$i.indices.push(Bs),$i.indices.push(Br),$i.indices.push(ts),$i.indices.push(Bs),$i.indices.push(Us),$i.indices.push(Br)}return $i}(i[0]),i=[Qe.geometry]}const it=(Dt,Jt)=>Dt<(Jt.length-1)/2||Dt===Jt.length-1,Se=this.wallMode?[i]:$o(i,500);for(let Dt=Se.length-1;Dt>=0;Dt--){const Jt=Se[Dt];(Jt.length===0||(Xe=Jt[0]).every(yi=>yi.x<=0)||Xe.every(yi=>yi.x>=ns)||Xe.every(yi=>yi.y<=0)||Xe.every(yi=>yi.y>=ns))&&Se.splice(Dt,1)}var Xe;let st;if(K)st=W_(Se,j,h);else{st=[];for(const Dt of Se)st.push({polygon:Dt,bounds:j})}const dt=oe?this.edgeRadius:0,Ot=dt>0&&this.zoom<17,Pt=(Dt,Jt)=>{if(Dt.length===0)return!1;const yi=Dt[Dt.length-1];return Jt.x===yi.x&&Jt.y===yi.y};for(const{polygon:Dt,bounds:Jt}of st){let yi=0,$i=0;for(const bi of Dt)oe&&!bi[0].equals(bi[bi.length-1])&&bi.push(bi[0]),$i+=oe?bi.length-1:bi.length;const Ii=this.segments.prepareSegment((oe?5:4)*$i,this.layoutVertexArray,this.indexArray);be.footprintSegIdx<0&&(be.footprintSegIdx=this.footprintSegments.length),be.polygonSegIdx<0&&(be.polygonSegIdx=this.polygonSegments.length);const Hi={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ki=new Zy;if(Ki.vertexOffset=this.footprintVertices.length,Ki.indexOffset=3*this.footprintIndices.length,Ki.ringIndices=[],oe){const bi=[],Gi=[];yi=Ii.vertexLength;for(let xi=0;xi<Dt.length;xi++){const ss=Dt[xi];ss.length&&xi!==0&&Gi.push(bi.length/2);const rs=[];let tr,Vs;tr=ss[1].sub(ss[0])._perp()._unit(),Ki.ringIndices.push(ss.length-1);for(let gs=1;gs<ss.length;gs++){const ts=ss[gs],Br=ss[gs===ss.length-1?1:gs+1],Bs=ts.clone();if(dt){Vs=Br.sub(ts)._perp()._unit();const Us=tr.add(Vs)._unit(),Mr=dt*Math.min(4,1/(tr.x*Us.x+tr.y*Us.y));Bs.x+=Mr*Us.x,Bs.y+=Mr*Us.y,Bs.x=Math.round(Bs.x),Bs.y=Math.round(Bs.y),tr=Vs}if(!ke||dt!==0&&!Ot||Pt(rs,Bs)||rs.push(Bs),_m(this.layoutVertexArray,Bs.x,Bs.y,0,0,1,1,0),this.wallMode){const Us=it(gs,ss);la(this.wallVertexArray,Qe.joinNormals[gs],!Us)}Ii.vertexLength++,this.footprintVertices.emplaceBack(ts.x,ts.y),bi.push(ts.x,ts.y),K&&Kg(this.layoutVertexExtArray,W.projectTilePoint(Bs.x,Bs.y,h),W.upVector(h,Bs.x,Bs.y))}ke&&(dt===0||Ot)&&(rs.length!==0&&Pt(rs,rs[0])&&rs.pop(),this.groundEffect.addData(rs,Jt,O))}const mi=this.wallMode?Qe.indices:Le(bi,Gi);for(let xi=0;xi<mi.length;xi+=3)this.footprintIndices.emplaceBack(Ki.vertexOffset+mi[xi+0],Ki.vertexOffset+mi[xi+1],Ki.vertexOffset+mi[xi+2]),this.indexArray.emplaceBack(yi+mi[xi],yi+mi[xi+2],yi+mi[xi+1]),Ii.primitiveLength++;Ki.indexCount+=mi.length,Ki.vertexCount+=this.footprintVertices.length-Ki.vertexOffset}for(let bi=0;bi<Dt.length;bi++){const Gi=Dt[bi];ue.startRing(be,Gi[0]);let mi=Gi.length>4&&h_(Gi[Gi.length-2],Gi[0],Gi[1]),xi=dt?j_(Gi[Gi.length-2],Gi[0],Gi[1],dt):0;const ss=[];let rs,tr,Vs;tr=Gi[1].sub(Gi[0])._perp()._unit();let gs=!0;for(let ts=1,Br=0;ts<Gi.length;ts++){let Bs=Gi[ts-1],Us=Gi[ts];const Mr=Gi[ts===Gi.length-1?1:ts+1];if(ue.appendEdge(be,Us,Bs),cp(Us,Bs,Jt)){dt&&(tr=Mr.sub(Us)._perp()._unit(),gs=!gs);continue}const $r=Us.sub(Bs)._perp(),Wr=$r.x/(Math.abs($r.x)+Math.abs($r.y)),uo=$r.y>0?1:0,Kr=Bs.dist(Us);if(Br+Kr>32768&&(Br=0),dt){Vs=Mr.sub(Us)._perp()._unit();let nt=G_(Bs,Us,Mr,Ky(tr,Vs),dt);isNaN(nt)&&(nt=0);const ft=Us.sub(Bs)._unit();Bs=Bs.add(ft.mult(xi))._round(),Us=Us.add(ft.mult(-nt))._round(),xi=nt,tr=Vs,ke&&this.zoom>=17&&(Pt(ss,Bs)||ss.push(Bs),Pt(ss,Us)||ss.push(Us))}const po=Ii.vertexLength,Pn=Gi.length>4&&h_(Bs,Us,Mr);let ba=vm(Br,mi,gs);if(_m(this.layoutVertexArray,Bs.x,Bs.y,Wr,uo,0,0,ba),_m(this.layoutVertexArray,Bs.x,Bs.y,Wr,uo,0,1,ba),this.wallMode){const nt=it(ts-1,Gi),ft=Qe.joinNormals[ts-1];la(this.wallVertexArray,ft,nt),la(this.wallVertexArray,ft,nt)}if(Br+=Kr,ba=vm(Br,Pn,!gs),mi=Pn,_m(this.layoutVertexArray,Us.x,Us.y,Wr,uo,0,0,ba),_m(this.layoutVertexArray,Us.x,Us.y,Wr,uo,0,1,ba),this.wallMode){const nt=it(ts,Gi),ft=Qe.joinNormals[ts];la(this.wallVertexArray,ft,nt),la(this.wallVertexArray,ft,nt)}if(Ii.vertexLength+=4,this.indexArray.emplaceBack(po+0,po+1,po+2),this.indexArray.emplaceBack(po+1,po+3,po+2),Ii.primitiveLength+=2,dt){const nt=yi+(ts===1?Gi.length-2:ts-2),ft=ts===1?yi:nt+1;if(this.indexArray.emplaceBack(po+1,nt,po+3),this.indexArray.emplaceBack(nt,ft,po+3),Ii.primitiveLength+=2,rs===void 0&&(rs=po),!cp(Mr,Gi[ts],Jt)){const Si=ts===Gi.length-1?rs:Ii.vertexLength;this.indexArray.emplaceBack(po+2,po+3,Si),this.indexArray.emplaceBack(po+3,Si+1,Si),this.indexArray.emplaceBack(po+3,ft,Si+1),Ii.primitiveLength+=3}gs=!gs}if(K){const nt=this.layoutVertexExtArray,ft=W.projectTilePoint(Bs.x,Bs.y,h),Si=W.projectTilePoint(Us.x,Us.y,h),as=W.upVector(h,Bs.x,Bs.y),ys=W.upVector(h,Us.x,Us.y);Kg(nt,ft,as),Kg(nt,ft,as),Kg(nt,Si,ys),Kg(nt,Si,ys)}}oe&&(yi+=Gi.length-1),ke&&dt&&this.zoom>=17&&(ss.length!==0&&Pt(ss,ss[0])&&ss.pop(),this.groundEffect.addData(ss,Jt,O,dt>0))}this.footprintSegments.push(Ki),Hi.triangleCount=this.indexArray.length-Hi.triangleArrayOffset,this.polygonSegments.push(Hi),++be.footprintSegLen,++be.polygonSegLen}if(be.vertexCount=this.layoutVertexArray.length-be.vertexArrayOffset,be.groundVertexCount=this.groundEffect.vertexArray.length-be.groundVertexArrayOffset,be.vertexCount!==0){if(be.centroidXY=ue.borders?l_:this.encodeCentroid(ue,be),this.centroidData.push(be),ue.borders){this.featuresOnBorder.push(ue);const Dt=this.featuresOnBorder.length-1;for(let Jt=0;Jt<ue.borders.length;Jt++)ue.borders[Jt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Jt].push(Dt)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,f,g,h,C,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(e,o,f,g,h,C,this.worldview),this.maxHeight=Math.max(this.maxHeight,Fe)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,o)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}splitToSubtiles(){const e=[];for(let w=0;w<this.centroidData.length;w++){const C=this.centroidData[w],O=+(C.min.y+C.max.y>ns),j=2*O+(+(C.min.x+C.max.x>ns)^O);for(let W=0;W<C.polygonSegLen;W++){const K=C.polygonSegIdx+W;e.push({centroidIdx:w,subtile:j,polygonSegmentIdx:K,triangleSegmentIdx:this.polygonSegments[K].triangleSegIdx})}}const i=new ml;e.sort((w,C)=>w.triangleSegmentIdx===C.triangleSegmentIdx?w.subtile-C.subtile:w.triangleSegmentIdx-C.triangleSegmentIdx);let o=0,h=0,f=0;for(const w of e){if(w.triangleSegmentIdx!==o)break;f++}const g=e.length;for(;h!==e.length;){o=e[h].triangleSegmentIdx;let w=0,C=h,O=h;for(let j=C;j<f&&e[j].subtile===w;j++)O++;for(;C!==f;){const j=e[C];w=j.subtile;const W=this.centroidData[j.centroidIdx].min.clone(),K=this.centroidData[j.centroidIdx].max.clone(),oe={vertexOffset:this.segments.segments[o].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[o].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let ue=C;ue<O;ue++){const be=e[ue],ke=this.polygonSegments[be.polygonSegmentIdx],Fe=this.centroidData[be.centroidIdx].min,Qe=this.centroidData[be.centroidIdx].max,it=this.indexArray.uint16;for(let Se=ke.triangleArrayOffset;Se<ke.triangleArrayOffset+ke.triangleCount;Se++)i.emplaceBack(it[3*Se],it[3*Se+1],it[3*Se+2]);oe.primitiveLength+=ke.triangleCount,W.x=Math.min(W.x,Fe.x),W.y=Math.min(W.y,Fe.y),K.x=Math.max(K.x,Qe.x),K.y=Math.max(K.y,Qe.y)}oe.primitiveLength>0&&this.triangleSubSegments.push({segment:oe,min:W,max:K}),C=O;for(let ue=C;ue<f&&e[ue].subtile===e[C].subtile;ue++)O++}h=f;for(let j=h;j<g&&e[j].triangleSegmentIdx===e[h].triangleSegmentIdx;j++)f++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,o){const h=new sa;if(this.wallMode){for(const be of this.triangleSubSegments)h.segments.push(be.segment);return h}let f=0,g=0;const w=1<<e.canonical.z;if(i){const be=i.getMinMaxForTile(e);be&&(f=be.min,g=be.max)}g+=this.maxHeight;const C=e.toUnwrapped();let O;const j=[C.canonical.x/w+C.wrap,C.canonical.y/w],W=[(C.canonical.x+1)/w+C.wrap,(C.canonical.y+1)/w],K=(be,ke,Fe)=>[be[0]*(1-Fe[0])+ke[0]*Fe[0],be[1]*(1-Fe[1])+ke[1]*Fe[1]],oe=[],ue=[];for(const be of this.triangleSubSegments){oe[0]=be.min.x/ns,oe[1]=be.min.y/ns,ue[0]=be.max.x/ns,ue[1]=be.max.y/ns;const ke=K(j,W,oe),Fe=K(j,W,ue);if(new Go([ke[0],ke[1],f],[Fe[0],Fe[1],g]).intersectsPrecise(o)===0){O&&(h.segments.push(O),O=void 0);continue}const Qe=be.segment;O&&O.vertexOffset!==Qe.vertexOffset&&(h.segments.push(O),O=void 0),O?(O.vertexLength+=Qe.vertexLength,O.primitiveLength+=Qe.primitiveLength):O={vertexOffset:Qe.vertexOffset,primitiveLength:Qe.primitiveLength,vertexLength:Qe.vertexLength,primitiveOffset:Qe.primitiveOffset,sortKey:void 0,vaos:{}}}return O&&h.segments.push(O),h}encodeCentroid(e,i){const o=e.centroid(),h=i.span(),f=Math.min(7,Math.round(h.x*this.tileToMeter/10)),g=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new Wi(at(o.x,1,ns-1)<<3|f,at(o.y,1,ns-1)<<3|g)}encodeBorderCentroid(e){if(!e.borders)return new Wi(0,0);const i=e.borders,o=Number.MAX_VALUE;if(i[0][0]!==o||i[1][0]!==o){const h=i[0][0]!==o?0:1;return new Wi(6|(i[0][0]!==o?0:65528),(i[h][0]+i[h][1])/2<<3|6)}{const h=i[2][0]!==o?2:3;return new Wi((i[h][0]+i[h][1])/2<<3|6,6|(i[2][0]!==o?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=Nd,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,o=e.vertexCount+e.vertexArrayOffset,h=e.flags&Nd?l_:e.centroidXY,f=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==h.y||f!==h.x){for(let g=i;g<o;++g)this.centroidVertexArray.emplace(g,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,o){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const h=i.getReplacementRegionsForTile(e.toUnwrapped());if(qg(this.activeReplacements,h))return;if(this.activeReplacements=h,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const g of this.centroidData)g.flags&=2147483647;const f=[];for(const g of this.activeReplacements){if(g.order<o)continue;const w=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-e.canonical.z));for(const C of this.centroidData)if(!(C.flags&Nd||g.min.x>C.max.x||C.min.x>g.max.x||g.min.y>C.max.y||C.min.y>g.max.y))for(let O=0;O<C.footprintSegLen;O++){const j=this.footprintSegments[C.footprintSegIdx+O];if(f.length=0,Xm(this.footprintVertices,j.vertexOffset,j.vertexCount,g.footprintTileId.canonical,e.canonical,f),V_(g.footprint,f,this.footprintIndices.uint16,j.indexOffset,j.indexCount,-j.vertexOffset,-w)){C.flags|=Nd;break}}}for(const g of this.centroidData)this.writeCentroidToBuffer(g);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,o){let h=!1;for(let f=0;f<o.footprintSegLen;f++){const g=this.footprintSegments[o.footprintSegIdx+f];let w=0;for(const C of g.ringIndices){for(let O=w,j=C+w-1;O<C+w;j=O++){const W=this.footprintVertices.int16[2*(O+g.vertexOffset)+0],K=this.footprintVertices.int16[2*(O+g.vertexOffset)+1],oe=this.footprintVertices.int16[2*(j+g.vertexOffset)+1];K>i!=oe>i&&e<(this.footprintVertices.int16[2*(j+g.vertexOffset)+0]-W)*(i-K)/(oe-K)+W&&(h=!h)}w=C}}return h}getHeightAtTileCoord(e,i){let o=Number.NEGATIVE_INFINITY,h=!0;const f=4*(e+ns)*ns+(i+ns);if(this.partLookup.hasOwnProperty(f)){const g=this.partLookup[f];return g?{height:g.height,hidden:!!(g.flags&Nd)}:void 0}for(const g of this.centroidData)e>g.max.x||g.min.x>e||i>g.max.y||g.min.y>i||this.footprintContainsPoint(e,i,g)&&g&&g.height>o&&(o=g.height,this.partLookup[f]=g,h=!!(g.flags&Nd));if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:h};this.partLookup[f]=void 0}}function Ky(s,e){const i=s.add(e)._unit();return s.x*i.x+s.y*i.y}function j_(s,e,i,o){const h=e.sub(s)._perp()._unit(),f=i.sub(e)._perp()._unit();return G_(s,e,i,Ky(h,f),o)}function G_(s,e,i,o,h){const f=Math.sqrt(1-o*o);return Math.min(s.dist(e)/3,e.dist(i)/3,h*f/o)}function cp(s,e,i){return s.x<i[0].x&&e.x<i[0].x||s.x>i[1].x&&e.x>i[1].x||s.y<i[0].y&&e.y<i[0].y||s.y>i[1].y&&e.y>i[1].y}function Ix(s,e){return s.x<e[0].x||s.x>e[1].x||s.y<e[0].y||s.y>e[1].y}function h_(s,e,i){if(s.x<0||s.x>=ns||e.x<0||e.x>=ns||i.x<0||i.x>=ns)return!1;const o=i.sub(e),h=o.perp(),f=s.sub(e);return(o.x*f.x+o.y*f.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(f.x*f.x+f.y*f.y))>-.866&&h.x*f.x+h.y*f.y<0}function vm(s,e,i){const o=e?2|s:-3&s;return i?1|o:-2&o}function wg(){const s=Math.PI/32,e=Math.tan(s),i=Pe;return i*Math.sqrt(1+2*e*e)-i}function W_(s,e,i){const o=1<<i.z,h=Ct(i.x/o),f=Ct((i.x+1)/o),g=ti(i.y/o),w=ti((i.y+1)/o);return function(C,O,j,W,K=0,oe){const ue=[];if(!C.length||!j||!W)return ue;const be=(st,dt)=>{for(const Ot of st)ue.push({polygon:Ot,bounds:dt})},ke=Math.ceil(Math.log2(j)),Fe=Math.ceil(Math.log2(W)),Qe=ke-Fe,it=[];for(let st=0;st<Math.abs(Qe);st++)it.push(Qe>0?0:1);for(let st=0;st<Math.min(ke,Fe);st++)it.push(0),it.push(1);let Se=C;if(Se=il(Se,O[0].y-K,O[1].y+K,1),Se=il(Se,O[0].x-K,O[1].x+K,0),!Se.length)return ue;const Xe=[];for(it.length?Xe.push({polygons:Se,bounds:O,depth:0}):be(Se,O);Xe.length;){const st=Xe.pop(),dt=st.depth,Ot=it[dt],Pt=st.bounds[0],Dt=st.bounds[1],Jt=Ot===0?Pt.x:Pt.y,yi=Ot===0?Dt.x:Dt.y,$i=oe?oe(Ot,Jt,yi):.5*(Jt+yi),Ii=il(st.polygons,Jt-K,$i+K,Ot),Hi=il(st.polygons,$i-K,yi+K,Ot);if(Ii.length){const Ki=[Pt,new Wi(Ot===0?$i:Dt.x,Ot===1?$i:Dt.y)];it.length>dt+1?Xe.push({polygons:Ii,bounds:Ki,depth:dt+1}):be(Ii,Ki)}if(Hi.length){const Ki=[new Wi(Ot===0?$i:Pt.x,Ot===1?$i:Pt.y),Dt];it.length>dt+1?Xe.push({polygons:Hi,bounds:Ki,depth:dt+1}):be(Hi,Ki)}}return ue}(s,e,Math.ceil((f-h)/11.25),Math.ceil((g-w)/11.25),1,(C,O,j)=>{if(C===0)return .5*(O+j);{const W=ti((i.y+O/ns)/o);return(pt(.5*(ti((i.y+j/ns)/o)+W))*o-i.y)*ns}})}function Xm(s,e,i,o,h,f){const g=Math.pow(2,o.z-h.z);for(let w=0;w<i;w++){let C=s.int16[2*(w+e)+0],O=s.int16[2*(w+e)+1];C=(C+h.x*ns)*g-o.x*ns,O=(O+h.y*ns)*g-o.y*ns,f.push(new Wi(C,O))}}let Ff,c_;qe(by,"FillExtrusionBucket",{omit:["layers","features"]}),qe(dc,"PartData"),qe(Zy,"FootprintSegment"),qe(vg,"BorderCentroidData"),qe(bg,"GroundEffect");class Ym extends Wi{constructor(e,i,o){super(e,i),this.z=o}}class Nf extends Ym{constructor(e,i,o,h){super(e,i,o),this.w=h}}function Jy(s,e,i,o){const h=i==="x"?"y":"x",f=(o-s[i])/(e[i]-s[i]);s[h]=Math.round(s[h]+(e[h]-s[h])*f),s[i]=o,s.hasOwnProperty("z")&&(s.z=js(s.z,e.z,f)),s.hasOwnProperty("w")&&(s.w=js(s.w,e.w,f))}function d_(s,e,i,o){const h=i,f=o;for(const g of["x","y"]){let w=s,C=e;w[g]>=C[g]&&(w=e,C=s),w[g]<h&&C[g]>h&&Jy(w,C,g,h),w[g]<f&&C[g]>f&&Jy(C,w,g,f)}}function Lx(s,e,i,o,h,f){const g=[];for(let w=0;w<s.length;w++){const C=s[w];let O;const j=g.length;let W=0;for(let K=0;K<C.length-1;K++){let oe=C[K],ue=C[K+1],be=0;const ke=W;let Fe,Qe;f&&(be=Math.hypot(ue.x-oe.x,ue.y-oe.y),W+=be,Fe=oe,Qe=ue),oe.x<e&&ue.x<e||(oe.x<e?oe=new Wi(e,oe.y+(e-oe.x)/(ue.x-oe.x)*(ue.y-oe.y))._round():ue.x<e&&(ue=new Wi(e,oe.y+(e-oe.x)/(ue.x-oe.x)*(ue.y-oe.y))._round()),oe.y<i&&ue.y<i||(oe.y<i?oe=new Wi(oe.x+(i-oe.y)/(ue.y-oe.y)*(ue.x-oe.x),i)._round():ue.y<i&&(ue=new Wi(oe.x+(i-oe.y)/(ue.y-oe.y)*(ue.x-oe.x),i)._round()),oe.x>=o&&ue.x>=o||(oe.x>=o?oe=new Wi(o,oe.y+(o-oe.x)/(ue.x-oe.x)*(ue.y-oe.y))._round():ue.x>=o&&(ue=new Wi(o,oe.y+(o-oe.x)/(ue.x-oe.x)*(ue.y-oe.y))._round()),oe.y>=h&&ue.y>=h||(oe.y>=h?oe=new Wi(oe.x+(h-oe.y)/(ue.y-oe.y)*(ue.x-oe.x),h)._round():ue.y>=h&&(ue=new Wi(oe.x+(h-oe.y)/(ue.y-oe.y)*(ue.x-oe.x),h)._round()),O&&oe.equals(O[O.length-1])||(O=[oe],g.push(O),f&&f.push({progress:{min:ke+H_(Fe,Qe,oe)*be,max:1},parentIndex:w,prevPoint:Fe,nextPoint:Qe})),O.push(ue),f&&(f[f.length-1].progress.max=ke+H_(Fe,Qe,ue)*be,f[f.length-1].nextPoint=Qe)))))}if(f&&W>0)for(let K=j;K<g.length;K++)f[K].progress.min/=W,f[K].progress.max/=W}return g}function Ox(s,e,i,o,h){if(s.length<2)return void o.push(s);const f=[];for(;e.valid();){const[O,j]=e.get();for(let W=0;W<s.length-1;W++){const K=s[W],oe=s[W+1],ue=Df(K,oe,O,j);if(ue){const[be]=ue,ke=new Wi(js(K.x,oe.x,be),js(K.y,oe.y,be));f.push({t:W+be,distance:0,point:ke})}}e.next()}if(f.length===0)return void o.push(s);f.sort((O,j)=>O.t-j.t);let g=0,w=0,C=[];for(o.push(C);g!==s.length;){if(w===f.length){for(;g!==s.length;)C.length!==0&&C[C.length-1].equals(s[g])||C.push(s[g]),g++;break}f[w].t<=g?(C.length!==0&&C[C.length-1].equals(f[w].point)||C.push(f[w].point),Math.trunc(f[w].t),w++):(C.length!==0&&C[C.length-1].equals(s[g])||C.push(s[g]),g++)}}function H_(s,e,i){return s.x!==e.x?(i.x-s.x)/(e.x-s.x):s.y!==e.y?(i.y-s.y)/(e.y-s.y):0}function Jg(s,e){return s.x*e.x+s.y*e.y}function u_(s,e){if(s.length===1){let i=0;const o=e[i++];let h;for(;!h||o.equals(h);)if(h=e[i++],!h)return 1/0;for(;i<e.length;i++){const f=e[i],g=s[0],w=h.sub(o),C=f.sub(o),O=g.sub(o),j=Jg(w,w),W=Jg(w,C),K=Jg(C,C),oe=Jg(O,w),ue=Jg(O,C),be=j*K-W*W,ke=(K*oe-W*ue)/be,Fe=(j*ue-W*oe)/be,Qe=o.z*(1-ke-Fe)+h.z*ke+f.z*Fe;if(isFinite(Qe))return Qe}return 1/0}{let i=1/0;for(const o of e)i=Math.min(i,o.z);return i}}function X_(s,e,i,o,h,f,g,w){const C=g*h.getElevationAt(s,e,!0,!0),O=f[0]!==0,j=O?f[1]===0?g*(f[0]/7-450):g*function(W,K,oe){const ue=Math.floor(K[0]/8),be=Math.floor(K[1]/8),ke=10*(K[0]-8*ue),Fe=10*(K[1]-8*be),Qe=W.getElevationAt(ue,be,!0,!0),it=W.getMeterToDEM(oe),Se=Math.floor(.5*(ke*it-1)),Xe=Math.floor(.5*(Fe*it-1)),st=W.tileCoordToPixel(ue,be),dt=2*Se+1,Ot=2*Xe+1,Pt=function(Hi,Ki,bi,Gi,mi){return[Hi.getElevationAtPixel(Ki,bi,!0),Hi.getElevationAtPixel(Ki+mi,bi,!0),Hi.getElevationAtPixel(Ki,bi+mi,!0),Hi.getElevationAtPixel(Ki+Gi,bi+mi,!0)]}(W,st.x-Se,st.y-Xe,dt,Ot),Dt=Math.abs(Pt[0]-Pt[1]),Jt=Math.abs(Pt[2]-Pt[3]),yi=Math.abs(Pt[0]-Pt[2])+Math.abs(Pt[1]-Pt[3]),$i=Math.min(.25,.5*it*(Dt+Jt)/dt),Ii=Math.min(.25,.5*it*yi/Ot);return Qe+Math.max($i*ke,Ii*Fe)}(h,f,w):C;return{base:C+(i===0?-1:i),top:O?Math.max(j+o,C+i+2):C+o}}class P0{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Y_{constructor(){this.tasks={},this.taskQueue=[],Ss(["process"],this),this.invoker=new P0(this.process),this.nextId=0}add(e,i){const o=this.nextId++,h=function({type:f,isSymbolTile:g,zoom:w}){return w=w||0,f==="message"?0:f!=="maybePrepare"||g?f!=="parseTile"||g?f==="parseTile"&&g?300-w:f==="maybePrepare"&&g?400-w:500:200-w:100-w}(i);if(h===0){try{e()}finally{}return null}return this.tasks[o]={fn:e,metadata:i,priority:h,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let h=0;h<this.taskQueue.length;h++){const f=this.tasks[this.taskQueue[h]];f.priority<i&&(i=f.priority,e=h)}if(e===null)return null;const o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class Qy{constructor(e,i,o){this.target=e,this.parent=i,this.mapId=o,this.callbacks={},this.cancelCallbacks={},Ss(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Y_}send(e,i,o,h,f=!1,g){const w=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=g,this.callbacks[w]=o);const C=new Set;return this.target.postMessage({id:w,type:e,hasCallback:!!o,targetMapId:h,mustQueue:f,sourceMapId:this.mapId,data:Wt(i,C)},C),{cancel:()=>{o&&delete this.callbacks[w],this.target.postMessage({id:w,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const o=i.id;if(o&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const h=this.cancelCallbacks[o];delete this.cancelCallbacks[o],h&&h.cancel()}else if(i.mustQueue||ao(self)){const h=this.callbacks[o],f=this.scheduler.add(()=>this.processTask(o,i),h&&h.metadata||{type:"message"});f&&(this.cancelCallbacks[o]=f)}else this.processTask(o,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const o=this.callbacks[e];delete this.callbacks[e],o&&(i.error?o(Gt(i.error)):o(null,Gt(i.data)))}else{const o=new Set,h=i.hasCallback?(g,w)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:g?Wt(g):null,data:Wt(w,o)},o)}:()=>{},f=Gt(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,f,h);else if(this.parent.getWorkerSource){const g=i.type.split("."),{source:w,scope:C}=f;this.parent.getWorkerSource(i.sourceMapId,g[0],w,C)[g[1]](f,h)}else h(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Tg={workerUrl:"",workerClass:null,workerParams:void 0};const zp="mapboxgl_preloaded_worker_pool";class Fh{constructor(){this.active={}}acquire(e,i=Fh.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(Tg.workerClass!=null?new Tg.workerClass:new self.Worker(Tg.workerUrl,Tg.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[zp]}numActive(){return Object.keys(this.active).length}}Fh.workerCount=2;class dp{constructor(e,i,o="Worker",h=Fh.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=li();const f=this.workerPool.acquire(this.id,h);for(let g=0;g<f.length;g++){const w=new dp.Actor(f[g],i,this.id);w.name=`${o} ${g}`,this.actors.push(w)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,o){jt(this.actors,(h,f)=>{h.send(e,i,f)},o=o||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Vd,p_;function wy(){return Vd||(Vd=new Fh),Vd}dp.Actor=Qy;class I0{constructor(e){this.module=e}createIntArray(e){const i=new Int32Array(e),o=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heap32.set(i,o/i.BYTES_PER_ELEMENT),o}createFloatArray(e){const i=new Float32Array(e),o=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heapF32.set(i,o/i.BYTES_PER_ELEMENT),o}createStringBuffer(e){const i=this.module.malloc(e.length+1);for(let o=0;o<e.length;++o)this.module.heapU8[i+o]=e.charCodeAt(o);return this.module.heapU8[i+e.length]=0,i}readStringBuffer(e){let i="";for(;this.module.heapU8[e]!==0;)i+=String.fromCharCode(this.module.heapU8[e]),++e;return i}setStyle(e){const i=e.entranceColorRgb,o=e.facadeGlazingColorRgb,h=e.roofColorRgb,f=e.wallColorRgb,g=e.normalScale;this.module.setStyle(i[0],i[1],i[2],o[0],o[1],o[2],h[0],h[1],h[2],f[0],f[1],f[2],g[0],g[1],g[2],e.tileToMeters)}setAOOptions(e,i){this.module.setAOOptions(e?1:0,i)}setMetricOptions(e,i){this.module.setMetricOptions(e?1:0,i)}setFacadeOptions(e,i,o){this.module.setFacadeOptions(e,i,o)}generateMesh(e,i){for(const w of e){const C=this.createStringBuffer(w.roofType),O=[0],j=[];for(const oe of w.coordinates)if(Array.isArray(oe)){for(const ue of oe)j.push(ue.x),j.push(ue.y);O.push(j.length)}const W=this.createIntArray(O),K=this.createFloatArray(j);this.module.addFeature(w.id,w.sourceId,w.minHeight,w.height,C,w.roofType.length,K,W,O.length-1),this.module.free(C),this.module.free(W),this.module.free(K)}for(const w of i){let C;C=w.entrances?JSON.parse(w.entrances):[];const O=this.createFloatArray(C),j=[];for(const K of w.coordinates)j.push(K.x),j.push(K.y);const W=this.createFloatArray(j);this.module.addFacade(w.sourceId,w.crossPerc,w.distanceToRoad,O,C.length,W,j.length),this.module.free(O),this.module.free(W)}if(!this.module.generateMesh()){const w=this.module.getLastError();return this.readStringBuffer(w)}const o=this.module.getMeshCount(),h=new Array(o);for(let w=0;w<o;w++){const C=this.module.getPositionsPtr(w),O=this.module.getPositionsLength(w),j=new Float32Array(this.module.heapF32.buffer,C,O),W=this.module.getNormalsPtr(w),K=this.module.getNormalsLength(w),oe=new Float32Array(this.module.heapF32.buffer,W,K),ue=this.module.getColorsPtr(w),be=this.module.getColorsLength(w),ke=new Uint8Array(this.module.heapU8.buffer,ue,be),Fe=this.module.getAOPtr(w),Qe=this.module.getAOLength(w),it=new Float32Array(this.module.heapF32.buffer,Fe,Qe),Se=this.module.getIndicesPtr(w),Xe=this.module.getIndicesLength(w),st=new Int32Array(this.module.heap32.buffer,Se,Xe),dt=this.module.getBuildingPart(w),Ot=this.readStringBuffer(dt);h[w]={positions:j,normals:oe,colors:ke,ao:it,indices:st,buildingPart:Ot}}const f=this.module.getRingCount(),g=[];for(let w=0;w<f;w++){const C=this.module.getRingPtr(w),O=this.module.getRingLength(w),j=new Float32Array(this.module.heapF32.buffer,C,O);g.push(j)}return{meshes:h,modifiedPolygonRings:g}}}let bm,$m,rh,Sg,nf,Ty=null,_d=null,$_=null,Dx=null;function Sy(){return ao(self)&&self.worker.dracoUrl?self.worker.dracoUrl:$m||Ua.DRACO_URL}function f_(){if(ao(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Sg)return Sg;const s=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Sg=WebAssembly.validate(s)?Ua.MESHOPT_SIMD_URL:Ua.MESHOPT_URL,Sg}const ex={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},L0={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Ud={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function m_(s,e,i){const o=i.json.bufferViews.length,h=i.buffers.length;e.bufferView=o,i.json.bufferViews[o]={buffer:h,byteLength:s.byteLength},i.buffers[h]=s}const My="KHR_draco_mesh_compression";function g_(s,e){const i=s.extensions&&s.extensions[My];if(!i)return;const o=new rh.Decoder,h=x_(e,i.bufferView),f=new rh.Mesh;if(!o.DecodeArrayToMesh(h,h.byteLength,f))throw new Error("Failed to decode Draco mesh");const g=e.json.accessors[s.indices],w=ex[g.componentType],C=g.count*w.BYTES_PER_ELEMENT,O=rh._malloc(C);w===Uint16Array?o.GetTrianglesUInt16Array(f,C,O):o.GetTrianglesUInt32Array(f,C,O),m_(rh.memory.buffer.slice(O,O+C),g,e),rh._free(O);for(const j of Object.keys(i.attributes)){const W=o.GetAttributeByUniqueId(f,i.attributes[j]),K=e.json.accessors[s.attributes[j]],oe=L0[K.componentType],ue=K.count*Ud[K.type]*ex[K.componentType].BYTES_PER_ELEMENT,be=rh._malloc(ue);o.GetAttributeDataArrayForAllPoints(f,W,rh[oe],ue,be),m_(rh.memory.buffer.slice(be,be+ue),K,e),rh._free(be)}o.destroy(),f.destroy(),delete s.extensions[My]}const zx="EXT_meshopt_compression";function O0(s,e){if(!s.extensions||!s.extensions[zx])return;const i=s.extensions[zx],o=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),h=new Uint8Array(i.count*i.byteStride);nf.decodeGltfBuffer(h,i.count,i.byteStride,o,i.mode,i.filter),s.buffer=e.buffers.length,s.byteOffset=0,e.buffers[s.buffer]=h.buffer,delete s.extensions[zx]}const qm=1179937895,y_=new TextDecoder("utf8");function Vf(s,e){return new URL(s,e).href}function Rp(s,e,i,o){return fetch(Vf(s.uri,o)).then(h=>h.arrayBuffer()).then(h=>{e.buffers[i]=h})}function x_(s,e){const i=s.json.bufferViews[e];return new Uint8Array(s.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function __(s,e,i,o){if(s.uri){const h=Vf(s.uri,o);return fetch(h).then(f=>f.blob()).then(f=>createImageBitmap(f)).then(f=>{e.images[i]=f})}if(s.bufferView!==void 0){const h=x_(e,s.bufferView),f=new Blob([h],{type:s.mimeType});return createImageBitmap(f).then(g=>{e.images[i]=g})}}function v_(s,e=0,i){const o={json:null,images:[],buffers:[]};if(new Uint32Array(s,e,1)[0]===qm){const j=new Uint32Array(s,e);let W=2;const K=(j[W++]>>2)-3,oe=j[W++]>>2;if(W++,o.json=JSON.parse(y_.decode(j.subarray(W,W+oe))),W+=oe,W<K){const ue=j[W++];W++;const be=e+(W<<2);o.buffers[0]=s.slice(be,be+ue)}}else o.json=JSON.parse(y_.decode(new Uint8Array(s,e)));const{buffers:h,images:f,meshes:g,extensionsUsed:w,bufferViews:C}=o.json;let O=Promise.resolve();if(h){const j=[];for(let W=0;W<h.length;W++){const K=h[W];K.uri?j.push(Rp(K,o,W,i)):o.buffers[W]||(o.buffers[W]=null)}O=Promise.all(j)}return O.then(()=>{const j=[],W=w&&w.includes(My),K=w&&w.includes(zx);if(W&&j.push(function(){if(!rh)return bm??(bm=function(oe){let ue,be=null;function ke(){ue=new Uint8Array(be.buffer)}function Fe(){throw new Error("Unexpected Draco error.")}const Qe={a:{a:Fe,d:function(it,Se,Xe){return ue.copyWithin(it,Se,Se+Xe)},c:function(it){const Se=ue.length,Xe=Math.max(it>>>0,Math.ceil(1.2*Se)),st=Math.ceil((Xe-Se)/65536);try{return be.grow(st),ke(),!0}catch{return!1}},b:Fe}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(oe,Qe):oe.then(it=>it.arrayBuffer()).then(it=>WebAssembly.instantiate(it,Qe))).then(it=>{const{Rb:Se,Qb:Xe,P:st,T:dt,X:Ot,Ja:Pt,La:Dt,Qa:Jt,Va:yi,Wa:$i,eb:Ii,jb:Hi,f:Ki,e:bi,yb:Gi,zb:mi,Ab:xi,Bb:ss,Db:rs,Gb:tr}=it.instance.exports;be=bi;const Vs=(()=>{let gs=0,ts=0,Br=0,Bs=0;return Us=>{Br&&(Se(Bs),Se(gs),ts+=Br,Br=gs=0),gs||(ts+=128,gs=Xe(ts));const Mr=Us.length+7&-8;let $r=gs;Mr>=ts&&(Br=Mr,$r=Bs=Xe(Mr));for(let Wr=0;Wr<Us.length;Wr++)ue[$r+Wr]=Us[Wr];return $r}})();return ke(),Ki(),{memory:bi,_free:Se,_malloc:Xe,Mesh:class{constructor(){this.ptr=st()}destroy(){dt(this.ptr)}},Decoder:class{constructor(){this.ptr=Pt()}destroy(){Hi(this.ptr)}DecodeArrayToMesh(gs,ts,Br){const Bs=Vs(gs),Us=Dt(this.ptr,Bs,ts,Br.ptr);return!!Ot(Us)}GetAttributeByUniqueId(gs,ts){return{ptr:Jt(this.ptr,gs.ptr,ts)}}GetTrianglesUInt16Array(gs,ts,Br){yi(this.ptr,gs.ptr,ts,Br)}GetTrianglesUInt32Array(gs,ts,Br){$i(this.ptr,gs.ptr,ts,Br)}GetAttributeDataArrayForAllPoints(gs,ts,Br,Bs,Us){Ii(this.ptr,gs.ptr,ts.ptr,Br,Bs,Us)}},DT_INT8:Gi(),DT_UINT8:mi(),DT_INT16:xi(),DT_UINT16:ss(),DT_UINT32:rs(),DT_FLOAT32:tr()}})}(fetch(Sy())),bm.then(oe=>{rh=oe,bm=void 0}))}()),K&&j.push(function(){if(nf)return;const oe=function(ue){let be;const ke=WebAssembly.instantiateStreaming(ue,{}).then(it=>{be=it.instance,be.exports.__wasm_call_ctors()}),Fe={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Qe={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:ke,supported:!0,decodeGltfBuffer(it,Se,Xe,st,dt,Ot){(function(Pt,Dt,Jt,yi,$i,Ii,Hi){const Ki=Pt.exports.sbrk,bi=yi+3&-4,Gi=Ki(bi*$i),mi=Ki(Ii.length),xi=new Uint8Array(Pt.exports.memory.buffer);xi.set(Ii,mi);const ss=Dt(Gi,yi,$i,mi,Ii.length);if(ss===0&&Hi&&Hi(Gi,bi,$i),Jt.set(xi.subarray(Gi,Gi+yi*$i)),Ki(Gi-Ki(0)),ss!==0)throw new Error(`Malformed buffer data: ${ss}`)})(be,be.exports[Qe[dt]],it,Se,Xe,st,be.exports[Fe[Ot]])}}}(fetch(f_()));return oe.ready.then(()=>{nf=oe})}()),f)for(let oe=0;oe<f.length;oe++)j.push(__(f[oe],o,oe,i));return(j.length?Promise.all(j):Promise.resolve()).then(()=>{if(W&&g)for(const{primitives:oe}of g)for(const ue of oe)g_(ue,o);if(K&&g&&C)for(const oe of C)O0(oe,o);return o})})}class Rx{constructor(e){this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.hasPattern=!1,this.worldview=e.worldview}updateFootprints(e,i){}prepare(){return function(){if(Dx!=null||$_!=null)return null;if(_d!=null)return _d;const e=fetch(Ua.BUILDING_GEN_URL);return _d=function(i){let o,h,f,g;function w(){o=new Uint8Array(g.buffer),h=new Int32Array(g.buffer),f=new Float32Array(g.buffer)}function C(){throw new Error("Unexpected BuildingGen error.")}const O=()=>{},j={a:{a:C,f:function(W){const K=o.length,oe=Math.max(W>>>0,Math.ceil(1.2*K)),ue=Math.ceil((oe-K)/65536);try{return g.grow(ue),w(),!0}catch{return!1}},g:C,b:O,c:O,d:O,e:O}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,j):i.then(W=>W.arrayBuffer()).then(W=>WebAssembly.instantiate(W,j))).then(W=>{const K=W.instance.exports;return(0,K.g)(),g=K.f,w(),new I0({setStyle:K.h,setAOOptions:K.i,setMetricOptions:K.j,setFacadeOptions:K.k,addFeature:K.l,addFacade:K.m,generateMesh:K.n,getLastError:K.o,getMeshCount:K.p,getPositionsPtr:K.q,getPositionsLength:K.r,getNormalsPtr:K.s,getNormalsLength:K.t,getColorsPtr:K.u,getColorsLength:K.v,getAOPtr:K.w,getAOLength:K.x,getIndicesPtr:K.y,getIndicesLength:K.z,getBuildingPart:K.A,getRingCount:K.B,getRingPtr:K.C,getRingLength:K.D,free:K.E,malloc:K.F,heapU8:o,heap32:h,heapF32:f})})}(e).then(i=>(_d=null,Dx=i,Dx)).catch(i=>{Ar("Could not load building-gen"),_d=null,$_=i}),_d}()}populate(e,i,o,h){}update(e,i,o,h,f,g,w){}isEmpty(){return!1}uploadPending(){return!1}upload(e){}destroy(){}getHeightAtTileCoord(e,i){return{height:Number.NEGATIVE_INFINITY,hidden:!0}}}let Bx,q_;qe(Rx,"BuildingBucket",{omit:["layers"]});const Z_=bo([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),K_=bo([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:J_}=Z_,b_=bo([{name:"a_packed",components:3,type:"Float32"}]),{members:Q_}=b_,w_=bo([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:D0}=w_;class T_{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new F({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const o=this.getKey(e,i);return this.positions[o]}trim(){const e=this.width,i=this.height=Zi(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,o){const h=[];let f=e.length%2==1?-e[e.length-1]*o:0,g=e[0]*o,w=!0;h.push({left:f,right:g,isDash:w,zeroLength:e[0]===0});let C=e[0];for(let O=1;O<e.length;O++){w=!w;const j=e[O];f=C*o,C+=j,g=C*o,h.push({left:f,right:g,isDash:w,zeroLength:j===0})}return h}addRoundDash(e,i,o){const h=i/2;for(let f=-o;f<=o;f++){const g=this.width*(this.nextRow+o+f);let w=0,C=e[w];for(let O=0;O<this.width;O++){O/C.right>1&&(C=e[++w]);const j=Math.abs(O-C.left),W=Math.abs(O-C.right),K=Math.min(j,W);let oe;const ue=f/o*(h+1);if(C.isDash){const be=h-Math.abs(ue);oe=Math.sqrt(K*K+be*be)}else oe=h-Math.sqrt(K*K+ue*ue);this.image.data[g+O]=Math.max(0,Math.min(255,oe+128))}}}addRegularDash(e,i){for(let C=e.length-1;C>=0;--C){const O=e[C],j=e[C+1];O.zeroLength?e.splice(C,1):j&&j.isDash===O.isDash&&(j.left=O.left,e.splice(C,1))}const o=e[0],h=e[e.length-1];o.isDash===h.isDash&&(o.left=h.left-this.width,h.right=o.right+this.width);const f=this.width*this.nextRow;let g=0,w=e[g];for(let C=0;C<this.width;C++){C/w.right>1&&(w=e[++g]);const O=Math.abs(C-w.left),j=Math.abs(C-w.right),W=Math.min(O,j);this.image.data[f+C]=Math.max(0,Math.min(255,(w.isDash?W:-W)+i+128))}}addDash(e,i){const o=this.getKey(e,i);if(this.positions[o])return this.positions[o];const h=i==="round",f=h?7:0,g=2*f+1;if(this.nextRow+g>this.height)return Ar("LineAtlas out of space"),null;e.length===0&&e.push(1);let w=0;for(let j=0;j<e.length;j++)e[j]<0&&(Ar("Negative value is found in line dasharray, replacing values with 0"),e[j]=0),w+=e[j];if(w!==0){const j=this.width/w,W=this.getDashRanges(e,this.width,j);h?this.addRoundDash(W,j,f):this.addRegularDash(W,i==="square"?.5*j:0)}const C=this.nextRow+f;this.nextRow+=g;const O={tl:[C,f],br:[w,0]};return this.positions[o]=O,O}}qe(T_,"LineAtlas");const z0=br.VectorTileFeature.types,e0=Math.cos(Math.PI/180*37.5),t0=Math.cos(Math.PI/180*5);class tx{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new dd,this.layoutVertexArray2=new Xc,this.patternVertexArray=new Xc,this.indexArray=new ml,this.programConfigurations=new c(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new sa,this.maxLineLength=0,this.zOffsetVertexArray=new Xc,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:ns/64,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,o,h){this.hasPattern=go("line",this.layers,this.pixelRatio,i);const f=this.layers[0].layout.get("line-sort-key");this.tileToMeter=ui(o);const g=this.layers[0].layout.get("line-elevation-reference");if(g==="hd-road-markup")this.elevationType="road";else{const K=this.layers[0].layout.get("line-z-offset"),oe=K.isConstant()&&!K.constantOr(0);this.elevationType=g!=="sea"&&g!=="ground"&&oe?"none":"offset",this.elevationType==="offset"&&g==="none"&&Ar(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const w=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&w!==void 0;const C=[];for(const{feature:K,id:oe,index:ue,sourceLayerIndex:be}of e){const ke=this.layers[0]._featureFilter.needGeometry,Fe=us(K,ke);if(!this.layers[0]._featureFilter.filter(new qr(this.zoom,{worldview:this.worldview}),Fe,o))continue;const Qe=f?f.evaluate(Fe,{},o):void 0,it={id:oe,properties:K.properties,type:K.type,sourceLayerIndex:be,index:ue,geometry:ke?Fe.geometry:Ts(K,o,h),patterns:{},sortKey:Qe};C.push(it)}f&&C.sort((K,oe)=>K.sortKey-oe.sortKey);const{lineAtlas:O,featureIndex:j}=i,W=this.addConstantDashes(O);for(const K of C){const{geometry:oe,index:ue,sourceLayerIndex:be}=K;if(W&&this.addFeatureDashes(K,O),this.hasPattern){const ke=Al("line",this.layers,K,this.zoom,this.pixelRatio,i);this.patternFeatures.push(ke)}else this.addFeature(K,oe,ue,o,O.positions,i.availableImages,i.brightness,i.elevationFeatures);j.insert(e[ue].feature,oe,ue,be,this.index)}}addConstantDashes(e){let i=!1;for(const o of this.layers){const h=o.paint.get("line-dasharray").value,f=o.layout.get("line-cap").value;if(h.kind!=="constant"||f.kind!=="constant")i=!0;else{const g=f.value,w=h.value;if(!w)continue;e.addDash(w,g)}}return i}addFeatureDashes(e,i){const o=this.zoom;for(const h of this.layers){const f=h.paint.get("line-dasharray").value,g=h.layout.get("line-cap").value;if(f.kind==="constant"&&g.kind==="constant")continue;let w,C;if(f.kind==="constant"){if(w=f.value,!w)continue}else w=f.evaluate({zoom:o},e);C=g.kind==="constant"?g.value:g.evaluate({zoom:o},e),i.addDash(w,C),e.patterns[h.id]=[i.getKey(w,C)]}}update(e,i,o,h,f,g,w,C){this.programConfigurations.updatePaintArrays(e,i,f,o,h,g,w,C)}addFeatures(e,i,o,h,f,g){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,i,o,h,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Q_)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,D0)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,K_.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,J_),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,o,h,f,g,w,C){const O=this.layers[0].layout,j=O.get("line-join").evaluate(e,{}),W=O.get("line-cap").evaluate(e,{}),K=O.get("line-miter-limit"),oe=O.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=O.get("line-z-offset").value;const ue=this.layers[0].paint.get("line-width").value;if(ue.kind!=="constant"&&ue.isLineProgressConstant===!1&&(this.variableWidthValue=ue),this.elevationType==="road"){const be=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,h,C,j,W,K,oe)){const[ke,Fe]=this.clipRuntimeLinesToTile(i,1);for(let Qe=0;Qe<ke.length;Qe++){const it=ke[Qe],Se=Fe[Qe],Xe={progress:{min:Se.progress.min,max:Se.progress.max},nextDir:this.computeSegNextDir(Se,it),prevDir:this.computeSegPrevDir(Se,it)};this.addLine(it,e,h,j,W,K,oe,Xe)}this.fillNonElevatedRoadSegment(be)}}else for(const be of i)this.addLine(be,e,h,j,W,K,oe);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,f,g,h,w,void 0,this.worldview)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return Lx(e,-i,-i,ns+i,ns+i)}clipRuntimeLinesToTile(e,i){const o=[];return[Lx(e,-i,-i,ns+i,ns+i,o),o]}addElevatedRoadFeature(e,i,o,h,f,g,w,C){const O=[],j=Bd.getElevationFeature(e,h);if(j){const W=this.clipLinesToTile(i,1),K=this.prepareElevatedLines(W,j,o);for(const oe of K)O.push({geometry:oe,elevation:j,elevationTileID:o,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(O.length===0)return!1;for(const W of O){const K=this.layoutVertexArray.length;this.addLine(W.geometry,e,o,f,g,w,C);const oe=new gu(o,W.elevationTileID);if(W.elevation)for(let ue=K;ue<this.layoutVertexArray.length;ue++){const be=new Wi(this.layoutVertexArray.int16[6*ue]>>1,this.layoutVertexArray.int16[6*ue+1]>>1),ke=oe.pointElevation(be,W.elevation,.05);this.updateHeightRange(ke),this.zOffsetVertexArray.emplaceBack(ke,0,0)}else this.fillNonElevatedRoadSegment(K)}return!0}prepareElevatedLines(e,i,o){if(i.constantHeight!=null)return e;const h=[],f=1/ui(o);for(const g of e)Ox(g,new hc(i,f),0,h);return h}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,o,h,f,g,w,C){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const O=h==="none";this.patternJoinNone=this.hasPattern&&O,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const j=C&&C.progress.min>0,W=C&&C.progress.max<1;if(this.lineClips){let Ot={min:this.lineClips.start,max:this.lineClips.end},Pt=1;if(C){const yi=this.lineClips.end-this.lineClips.start;Ot=function($i,Ii,Hi){return{min:Hh($i.min,Ii,Hi),max:Hh($i.max,Ii,Hi)}}(C.progress,{min:0,max:1},Ot),yi>0&&(Pt=(Ot.max-Ot.min)/yi)}const Dt=+i.properties.mapbox_clip_feature_len,Jt=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(Dt)||Number.isNaN(Jt)){for(let $i=0;$i<e.length-1;$i++)this.totalDistance+=e[$i].dist(e[$i+1]);const yi=this.totalDistance/(Ot.max-Ot.min);this.totalFeatureLength=Number.isFinite(yi)?yi:0,this.lineClips.start=Ot.min,this.lineClips.end=Ot.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Dt,this.distance=Jt*Pt,this.lineClips.start=Ot.min,this.lineClips.end=Ot.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const K=z0[i.type]==="Polygon";let oe=e.length;for(;oe>=2&&e[oe-1].equals(e[oe-2]);)oe--;let ue=0;for(;ue<oe-1&&e[ue].equals(e[ue+1]);)ue++;if(oe<(K?3:2))return;h==="bevel"&&(g=1.05);const be=this.segments.prepareSegment(10*oe,this.layoutVertexArray,this.indexArray);let ke,Fe,Qe,it,Se,Xe,st,dt;C&&C.prevDir&&(Xe=C.prevDir.perp()),C&&C.nextDir&&(st=C.nextDir.perp()),this.e1=this.e2=-1,K&&(ke=e[oe-2],Se=e[ue].sub(ke)._unit()._perp());for(let Ot=ue;Ot<oe;Ot++){if(Qe=Ot===oe-1?K?e[ue+1]:void 0:e[Ot+1],Qe&&e[Ot].equals(Qe))continue;Se&&(it=Se),ke&&(Fe=ke),ke=e[Ot],dt=this.evaluateLineProgressFeatures(Fe?Fe.dist(ke):0),Se=Qe?Qe.sub(ke)._unit()._perp():it,it=it||Se;const Pt=Fe&&Qe;let Dt=Pt?h:K||O?"butt":f;const Jt=it.x*Se.x+it.y*Se.y;if(O){const mi=function(xi){if(xi.patternJoinNone){const ss=xi.segmentPoints.length/2,rs=xi.lineSoFar-xi.segmentStart;for(let tr=0;tr<ss;++tr){const Vs=xi.segmentPoints[2*tr+1],gs=Math.round(xi.segmentPoints[2*tr])+.5+.25*Vs;xi.patternVertexArray.emplaceBack(gs,rs,xi.segmentStart),xi.patternVertexArray.emplaceBack(gs,rs,xi.segmentStart)}xi.segmentPoints.length=0}xi.e1=xi.e2=-1};if(Pt&&Jt<t0){this.updateDistance(Fe,ke),this.addCurrentVertex(ke,it,1,1,be,dt),mi(this),this.addCurrentVertex(ke,Se,-1,-1,be,dt);continue}if(Fe){if(!Qe){this.updateDistance(Fe,ke),this.addCurrentVertex(ke,it,1,1,be,dt),mi(this);continue}Dt="miter"}}let yi=it.add(Se);yi.x===0&&yi.y===0||yi._unit();const $i=yi.x*Se.x+yi.y*Se.y,Ii=$i!==0?1/$i:1/0,Hi=2*Math.sqrt(2-2*$i),Ki=$i<e0&&Fe&&Qe,bi=it.x*Se.y-it.y*Se.x>0,Gi=this.overscaling<=16?15*ns/(512*this.overscaling):0;if(Pt&&Dt==="round"){if(Ii<w)Dt="miter";else if(Ii<=2){const mi=ix(ke,-10,ns+10);Dt=this.elevationType==="offset"&&(mi||this.hasCrossSlope)?"miter":"fakeround"}}if(Dt==="miter"&&Ii>g&&(Dt="bevel"),Dt==="bevel"&&(Ii>2&&(Dt="flipbevel"),Ii<g&&(Dt="miter")),Fe&&!(Dt==="miter"&&Ki)&&this.updateDistance(Fe,ke),Dt==="miter")if(Ki){const mi=ke.dist(Fe);if(mi>2*Gi){const ss=ke.sub(ke.sub(Fe)._mult(Gi/mi)._round());this.updateDistance(Fe,ss),this.addCurrentVertex(ss,it,0,0,be,dt),Fe=ss}this.updateDistance(Fe,ke),yi._mult(Ii),this.addCurrentVertex(ke,yi,0,0,be,dt);const xi=ke.dist(Qe);if(xi>2*Gi){const ss=ke.add(Qe.sub(ke)._mult(Gi/xi)._round());this.updateDistance(ke,ss),this.addCurrentVertex(ss,Se,0,0,be,dt),ke=ss}}else yi._mult(Ii),this.addCurrentVertex(ke,yi,0,0,be,dt);else if(Dt==="flipbevel"){if(Ii>100)yi=Se.mult(-1);else{const mi=Ii*it.add(Se).mag()/it.sub(Se).mag();yi._perp()._mult(mi*(bi?-1:1))}this.addCurrentVertex(ke,yi,0,0,be,dt),this.addCurrentVertex(ke,yi.mult(-1),0,0,be,dt)}else if(Dt==="bevel"||Dt==="fakeround"){dt!=null&&Fe&&this.addCurrentVertex(ke,st||it,-1,-1,be,dt);const mi=ke.dist(Fe)<=2*Gi&&Dt!=="bevel",xi=yi.mult(bi?1:-1);xi._mult(Ii);const ss=Se.mult(bi?-1:1),rs=it.mult(bi?-1:1),tr=this.evaluateLineProgressFeatures(this.distance);if(dt==null&&(this.addHalfVertex(ke,xi.x,xi.y,!1,!bi,0,be,tr),mi||this.addHalfVertex(ke,xi.x+2*rs.x,xi.y+2*rs.y,!1,bi,0,be,tr)),Dt==="fakeround"){const Vs=Math.round(180*Hi/Math.PI/20);this.addHalfVertex(ke,rs.x,rs.y,!1,bi,0,be,tr);for(let gs=0;gs<Vs;gs++){let ts=gs/Vs;if(ts!==.5){const Bs=ts-.5;ts+=ts*Bs*(ts-1)*((1.0904+Jt*(Jt*(3.55645-1.43519*Jt)-3.2452))*Bs*Bs+(.848013+Jt*(.215638*Jt-1.06021)))}const Br=ss.sub(rs)._mult(ts)._add(rs)._unit();this.addHalfVertex(ke,Br.x,Br.y,!1,bi,0,be,tr)}this.addHalfVertex(ke,ss.x,ss.y,!1,bi,0,be,tr)}mi||dt!=null||this.addHalfVertex(ke,xi.x+2*ss.x,xi.y+2*ss.y,!1,bi,0,be,tr),dt!=null&&Qe&&this.addCurrentVertex(ke,Xe||Se,1,1,be,dt)}else if(Dt==="butt")this.addCurrentVertex(ke,yi,0,0,be,dt);else if(Dt==="square"){if(!Fe){const mi=j?0:-1;this.addCurrentVertex(ke,yi,mi,mi,be,dt)}if(this.addCurrentVertex(ke,yi,0,0,be,dt),Fe){const mi=W?0:1;this.addCurrentVertex(ke,yi,mi,mi,be,dt)}}else if(Dt==="round"){if(Fe){const mi=!Pt&&st?st:it;this.addCurrentVertex(ke,mi,0,0,be,dt),!Pt&&W||this.addCurrentVertex(ke,mi,1,1,be,dt,!0)}if(Qe){const mi=!Pt&&Xe?Xe:Se;!Pt&&j||this.addCurrentVertex(ke,mi,-1,-1,be,dt,!0),this.addCurrentVertex(ke,mi,0,0,be,dt)}}}}addVerticesTo(e,i,o,h,f,g,w,C,O,j){const W=(i.w-e.w)/this.tessellationStep|0;let K=0;const oe=this.scaledDistance;if(W>1){this.lineSoFar=e.w;const be=(i.x-e.x)/W,ke=(i.y-e.y)/W,Fe=(i.z-e.z)/W,Qe=(i.w-e.w)/W;for(let it=1;it<W;++it){e.x+=be,e.y+=ke,e.z+=Fe,this.lineSoFar+=Qe,K+=Qe;const Se=this.evaluateLineProgressFeatures(this.prevDistance+K);this.scaledDistance=(this.prevDistance+K)/this.totalDistance,this.addHalfVertex(e,o,h,j,!1,w,O,Se),this.addHalfVertex(e,f,g,j,!0,-C,O,Se)}}this.lineSoFar=i.w,this.scaledDistance=oe;const ue=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,o,h,j,!1,w,O,ue),this.addHalfVertex(i,f,g,j,!0,-C,O,ue)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Ar(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,o,h,f,g,w=!1){const C=i.x+i.y*o,O=i.y-i.x*o,j=i.y*h-i.x,W=-i.y-i.x*h;if(g!=null){const K=this.elevationType==="offset",oe=-10,ue=ns+10,be=g.zOffset,ke=new Nf(e.x,e.y,be,this.lineSoFar),Fe=!!K&&ix(e,oe,ue),Qe=this.lineSoFar,it=this.distance;if(this.currentVertex)if(Fe){const Se=this.currentVertexIsOutside,Xe=this.currentVertex,st=new Nf(e.x,e.y,be,this.lineSoFar);if(d_(Xe,st,oe,ue),!ix(st,oe,ue)){if(Se){this.e1=this.e2=-1,this.distance-=Xe.dist(ke),this.lineSoFar=Xe.w;const dt=this.evaluateLineProgressFeatures(Xe.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Xe,C,O,w,!1,o,f,dt),this.addHalfVertex(Xe,j,W,w,!0,-h,f,dt),this.prevDistance=this.distance}this.distance=this.prevDistance+Xe.dist(st),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Xe,st,C,O,j,W,o,h,f,w),this.distance=it,this.scaledDistance=this.distance/this.totalDistance}}else{const Se=this.currentVertex;if(this.currentVertexIsOutside){d_(Se,ke,oe,ue),this.e1=this.e2=-1,this.distance-=Se.dist(ke),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=Se.w;const Xe=this.evaluateLineProgressFeatures(Se.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Se,C,O,w,!1,o,f,Xe),this.addHalfVertex(Se,j,W,w,!0,-h,f,Xe),this.prevDistance=this.distance,this.distance=it,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(Se,ke,C,O,j,W,o,h,f,w)}else Fe||(this.addHalfVertex(e,C,O,w,!1,o,f,g),this.addHalfVertex(e,j,W,w,!0,-h,f,g));this.currentVertex=ke,this.currentVertexIsOutside=Fe,this.lineSoFar=Qe}else this.addHalfVertex(e,C,O,w,!1,o,f,g),this.addHalfVertex(e,j,W,w,!0,-h,f,g)}addHalfVertex({x:e,y:i},o,h,f,g,w,C,O){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),g||this.segmentPoints.push(this.lineSoFar-this.segmentStart,w)),this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(i<<1)+(g?1:0),Math.round(63*o)+128,Math.round(63*h)+128,1+(w===0?0:w<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const W=js(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,W)}const j=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,j),C.primitiveLength++),g?this.e2=j:this.e1=j,O!=null&&this.zOffsetVertexArray.emplaceBack(O.zOffset,O.variableWidth,O.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function ix(s,e,i){return s.x<e||s.x>i||s.y<e||s.y>i}let i0,Fx;function s0(s,e,i){return e*(ns/(s.tileSize*Math.pow(2,i-s.tileID.overscaledZ)))}qe(tx,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const r0=(s,e,i)=>(1-i)*s+i*e;function Zm(s,e){return 1/s0(s,1,e.tileZoom)}function sx(s,e,i,o){return s.translatePosMatrix(o||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Nx=s=>{const e=[];Vx(s)&&e.push("RENDER_LINE_DASH"),s.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=s.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),s.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const o=s.layout.get("line-join").constantOr("miter")==="none",h=!!s.paint.get("line-pattern").constantOr(1);return o&&h&&e.push("LINE_JOIN_NONE"),e};function Vx(s){const e=s.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let S_;const rx=()=>S_||(S_={layout:i0||(i0=new kn({"line-cap":new ms(Zt.layout_line["line-cap"]),"line-join":new ms(Zt.layout_line["line-join"]),"line-miter-limit":new Oi(Zt.layout_line["line-miter-limit"]),"line-round-limit":new Oi(Zt.layout_line["line-round-limit"]),"line-sort-key":new ms(Zt.layout_line["line-sort-key"]),"line-z-offset":new ms(Zt.layout_line["line-z-offset"]),"line-elevation-reference":new Oi(Zt.layout_line["line-elevation-reference"]),"line-cross-slope":new Oi(Zt.layout_line["line-cross-slope"]),visibility:new Oi(Zt.layout_line.visibility),"line-width-unit":new Oi(Zt.layout_line["line-width-unit"])})),paint:Fx||(Fx=new kn({"line-opacity":new ms(Zt.paint_line["line-opacity"]),"line-color":new ms(Zt.paint_line["line-color"]),"line-translate":new Oi(Zt.paint_line["line-translate"]),"line-translate-anchor":new Oi(Zt.paint_line["line-translate-anchor"]),"line-width":new ms(Zt.paint_line["line-width"]),"line-gap-width":new ms(Zt.paint_line["line-gap-width"]),"line-offset":new ms(Zt.paint_line["line-offset"]),"line-blur":new ms(Zt.paint_line["line-blur"]),"line-dasharray":new ms(Zt.paint_line["line-dasharray"]),"line-pattern":new ms(Zt.paint_line["line-pattern"]),"line-pattern-cross-fade":new Oi(Zt.paint_line["line-pattern-cross-fade"]),"line-gradient":new Tp(Zt.paint_line["line-gradient"]),"line-trim-offset":new Oi(Zt.paint_line["line-trim-offset"]),"line-trim-fade-range":new Oi(Zt.paint_line["line-trim-fade-range"]),"line-trim-color":new Oi(Zt.paint_line["line-trim-color"]),"line-emissive-strength":new Oi(Zt.paint_line["line-emissive-strength"]),"line-border-width":new ms(Zt.paint_line["line-border-width"]),"line-border-color":new ms(Zt.paint_line["line-border-color"]),"line-occlusion-opacity":new Oi(Zt.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new ms({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new ms({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new ms({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new ms({type:"string",default:"default","property-type":"data-driven"})}))},S_);class Qg extends ms{possiblyEvaluate(e,i){return i=new qr(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition,worldview:i.worldview}),super.possiblyEvaluate(e,i)}evaluate(e,i,o,h){return i=qt({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,o,h)}}let ox;function Mg(s,e){return e>0?e+2*s:s}const R0=bo([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),B0=bo([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),F0=bo([{name:"a_projected_pos",components:4,type:"Float32"}],4);bo([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Ay=bo([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),Ux=bo([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),o0=bo([{name:"a_texb",components:2,type:"Uint16"}]),N0=bo([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),n0=bo([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);bo([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ey=bo([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),a0=bo([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);bo([{name:"triangle",components:3,type:"Uint16"}]),bo([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),bo([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),bo([{type:"Float32",name:"offsetX"}]),bo([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var wh=24;function l0(s,e,i){return s.sections.forEach(o=>{o.text=function(h,f,g){const w=f.layout.get("text-transform").evaluate(g,{});return w==="uppercase"?h=h.toLocaleUpperCase():w==="lowercase"&&(h=h.toLocaleLowerCase()),mn.applyArabicShaping&&(h=mn.applyArabicShaping(h)),h}(o.text,e,i)}),s}const Ag={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function V0(s){return s==="︶"||s==="﹈"||s==="︸"||s==="﹄"||s==="﹂"||s==="︾"||s==="︼"||s==="︺"||s==="︘"||s==="﹀"||s==="︐"||s==="︓"||s==="︔"||s==="｀"||s==="￣"||s==="︑"||s==="︒"}function jx(s){return s==="︵"||s==="﹇"||s==="︷"||s==="﹃"||s==="﹁"||s==="︽"||s==="︻"||s==="︹"||s==="︗"||s==="︿"}var h0,Gx,c0,Wx={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function ky(){return h0||(h0=1,Wx.read=function(s,e,i,o,h){var f,g,w=8*h-o-1,C=(1<<w)-1,O=C>>1,j=-7,W=i?h-1:0,K=i?-1:1,oe=s[e+W];for(W+=K,f=oe&(1<<-j)-1,oe>>=-j,j+=w;j>0;f=256*f+s[e+W],W+=K,j-=8);for(g=f&(1<<-j)-1,f>>=-j,j+=o;j>0;g=256*g+s[e+W],W+=K,j-=8);if(f===0)f=1-O;else{if(f===C)return g?NaN:1/0*(oe?-1:1);g+=Math.pow(2,o),f-=O}return(oe?-1:1)*g*Math.pow(2,f-o)},Wx.write=function(s,e,i,o,h,f){var g,w,C,O=8*f-h-1,j=(1<<O)-1,W=j>>1,K=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,oe=o?0:f-1,ue=o?1:-1,be=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(w=isNaN(e)?1:0,g=j):(g=Math.floor(Math.log(e)/Math.LN2),e*(C=Math.pow(2,-g))<1&&(g--,C*=2),(e+=g+W>=1?K/C:K*Math.pow(2,1-W))*C>=2&&(g++,C/=2),g+W>=j?(w=0,g=j):g+W>=1?(w=(e*C-1)*Math.pow(2,h),g+=W):(w=e*Math.pow(2,W-1)*Math.pow(2,h),g=0));h>=8;s[i+oe]=255&w,oe+=ue,w/=256,h-=8);for(g=g<<h|w,O+=h;O>0;s[i+oe]=255&g,oe+=ue,g/=256,O-=8);s[i+oe-ue]|=128*be}),Wx}function ty(){if(c0)return Gx;c0=1,Gx=e;var s=ky();function e(Se){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(Se)?Se:new Uint8Array(Se||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var i=4294967296,o=1/i,h=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function f(Se){return Se.type===e.Bytes?Se.readVarint()+Se.pos:Se.pos+1}function g(Se,Xe,st){return st?4294967296*Xe+(Se>>>0):4294967296*(Xe>>>0)+(Se>>>0)}function w(Se,Xe,st){var dt=Xe<=16383?1:Xe<=2097151?2:Xe<=268435455?3:Math.floor(Math.log(Xe)/(7*Math.LN2));st.realloc(dt);for(var Ot=st.pos-1;Ot>=Se;Ot--)st.buf[Ot+dt]=st.buf[Ot]}function C(Se,Xe){for(var st=0;st<Se.length;st++)Xe.writeVarint(Se[st])}function O(Se,Xe){for(var st=0;st<Se.length;st++)Xe.writeSVarint(Se[st])}function j(Se,Xe){for(var st=0;st<Se.length;st++)Xe.writeFloat(Se[st])}function W(Se,Xe){for(var st=0;st<Se.length;st++)Xe.writeDouble(Se[st])}function K(Se,Xe){for(var st=0;st<Se.length;st++)Xe.writeBoolean(Se[st])}function oe(Se,Xe){for(var st=0;st<Se.length;st++)Xe.writeFixed32(Se[st])}function ue(Se,Xe){for(var st=0;st<Se.length;st++)Xe.writeSFixed32(Se[st])}function be(Se,Xe){for(var st=0;st<Se.length;st++)Xe.writeFixed64(Se[st])}function ke(Se,Xe){for(var st=0;st<Se.length;st++)Xe.writeSFixed64(Se[st])}function Fe(Se,Xe){return(Se[Xe]|Se[Xe+1]<<8|Se[Xe+2]<<16)+16777216*Se[Xe+3]}function Qe(Se,Xe,st){Se[st]=Xe,Se[st+1]=Xe>>>8,Se[st+2]=Xe>>>16,Se[st+3]=Xe>>>24}function it(Se,Xe){return(Se[Xe]|Se[Xe+1]<<8|Se[Xe+2]<<16)+(Se[Xe+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(Se,Xe,st){for(st=st||this.length;this.pos<st;){var dt=this.readVarint(),Ot=dt>>3,Pt=this.pos;this.type=7&dt,Se(Ot,Xe,this),this.pos===Pt&&this.skip(dt)}return Xe},readMessage:function(Se,Xe){return this.readFields(Se,Xe,this.readVarint()+this.pos)},readFixed32:function(){var Se=Fe(this.buf,this.pos);return this.pos+=4,Se},readSFixed32:function(){var Se=it(this.buf,this.pos);return this.pos+=4,Se},readFixed64:function(){var Se=Fe(this.buf,this.pos)+Fe(this.buf,this.pos+4)*i;return this.pos+=8,Se},readSFixed64:function(){var Se=Fe(this.buf,this.pos)+it(this.buf,this.pos+4)*i;return this.pos+=8,Se},readFloat:function(){var Se=s.read(this.buf,this.pos,!0,23,4);return this.pos+=4,Se},readDouble:function(){var Se=s.read(this.buf,this.pos,!0,52,8);return this.pos+=8,Se},readVarint:function(Se){var Xe,st,dt=this.buf;return Xe=127&(st=dt[this.pos++]),st<128?Xe:(Xe|=(127&(st=dt[this.pos++]))<<7,st<128?Xe:(Xe|=(127&(st=dt[this.pos++]))<<14,st<128?Xe:(Xe|=(127&(st=dt[this.pos++]))<<21,st<128?Xe:function(Ot,Pt,Dt){var Jt,yi,$i=Dt.buf;if(Jt=(112&(yi=$i[Dt.pos++]))>>4,yi<128||(Jt|=(127&(yi=$i[Dt.pos++]))<<3,yi<128)||(Jt|=(127&(yi=$i[Dt.pos++]))<<10,yi<128)||(Jt|=(127&(yi=$i[Dt.pos++]))<<17,yi<128)||(Jt|=(127&(yi=$i[Dt.pos++]))<<24,yi<128)||(Jt|=(1&(yi=$i[Dt.pos++]))<<31,yi<128))return g(Ot,Jt,Pt);throw new Error("Expected varint not more than 10 bytes")}(Xe|=(15&(st=dt[this.pos]))<<28,Se,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var Se=this.readVarint();return Se%2==1?(Se+1)/-2:Se/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var Se=this.readVarint()+this.pos,Xe=this.pos;return this.pos=Se,Se-Xe>=12&&h?function(st,dt,Ot){return h.decode(st.subarray(dt,Ot))}(this.buf,Xe,Se):function(st,dt,Ot){for(var Pt="",Dt=dt;Dt<Ot;){var Jt,yi,$i,Ii=st[Dt],Hi=null,Ki=Ii>239?4:Ii>223?3:Ii>191?2:1;if(Dt+Ki>Ot)break;Ki===1?Ii<128&&(Hi=Ii):Ki===2?(192&(Jt=st[Dt+1]))==128&&(Hi=(31&Ii)<<6|63&Jt)<=127&&(Hi=null):Ki===3?(yi=st[Dt+2],(192&(Jt=st[Dt+1]))==128&&(192&yi)==128&&((Hi=(15&Ii)<<12|(63&Jt)<<6|63&yi)<=2047||Hi>=55296&&Hi<=57343)&&(Hi=null)):Ki===4&&(yi=st[Dt+2],$i=st[Dt+3],(192&(Jt=st[Dt+1]))==128&&(192&yi)==128&&(192&$i)==128&&((Hi=(15&Ii)<<18|(63&Jt)<<12|(63&yi)<<6|63&$i)<=65535||Hi>=1114112)&&(Hi=null)),Hi===null?(Hi=65533,Ki=1):Hi>65535&&(Hi-=65536,Pt+=String.fromCharCode(Hi>>>10&1023|55296),Hi=56320|1023&Hi),Pt+=String.fromCharCode(Hi),Dt+=Ki}return Pt}(this.buf,Xe,Se)},readBytes:function(){var Se=this.readVarint()+this.pos,Xe=this.buf.subarray(this.pos,Se);return this.pos=Se,Xe},readPackedVarint:function(Se,Xe){if(this.type!==e.Bytes)return Se.push(this.readVarint(Xe));var st=f(this);for(Se=Se||[];this.pos<st;)Se.push(this.readVarint(Xe));return Se},readPackedSVarint:function(Se){if(this.type!==e.Bytes)return Se.push(this.readSVarint());var Xe=f(this);for(Se=Se||[];this.pos<Xe;)Se.push(this.readSVarint());return Se},readPackedBoolean:function(Se){if(this.type!==e.Bytes)return Se.push(this.readBoolean());var Xe=f(this);for(Se=Se||[];this.pos<Xe;)Se.push(this.readBoolean());return Se},readPackedFloat:function(Se){if(this.type!==e.Bytes)return Se.push(this.readFloat());var Xe=f(this);for(Se=Se||[];this.pos<Xe;)Se.push(this.readFloat());return Se},readPackedDouble:function(Se){if(this.type!==e.Bytes)return Se.push(this.readDouble());var Xe=f(this);for(Se=Se||[];this.pos<Xe;)Se.push(this.readDouble());return Se},readPackedFixed32:function(Se){if(this.type!==e.Bytes)return Se.push(this.readFixed32());var Xe=f(this);for(Se=Se||[];this.pos<Xe;)Se.push(this.readFixed32());return Se},readPackedSFixed32:function(Se){if(this.type!==e.Bytes)return Se.push(this.readSFixed32());var Xe=f(this);for(Se=Se||[];this.pos<Xe;)Se.push(this.readSFixed32());return Se},readPackedFixed64:function(Se){if(this.type!==e.Bytes)return Se.push(this.readFixed64());var Xe=f(this);for(Se=Se||[];this.pos<Xe;)Se.push(this.readFixed64());return Se},readPackedSFixed64:function(Se){if(this.type!==e.Bytes)return Se.push(this.readSFixed64());var Xe=f(this);for(Se=Se||[];this.pos<Xe;)Se.push(this.readSFixed64());return Se},skip:function(Se){var Xe=7&Se;if(Xe===e.Varint)for(;this.buf[this.pos++]>127;);else if(Xe===e.Bytes)this.pos=this.readVarint()+this.pos;else if(Xe===e.Fixed32)this.pos+=4;else{if(Xe!==e.Fixed64)throw new Error("Unimplemented type: "+Xe);this.pos+=8}},writeTag:function(Se,Xe){this.writeVarint(Se<<3|Xe)},realloc:function(Se){for(var Xe=this.length||16;Xe<this.pos+Se;)Xe*=2;if(Xe!==this.length){var st=new Uint8Array(Xe);st.set(this.buf),this.buf=st,this.length=Xe}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(Se){this.realloc(4),Qe(this.buf,Se,this.pos),this.pos+=4},writeSFixed32:function(Se){this.realloc(4),Qe(this.buf,Se,this.pos),this.pos+=4},writeFixed64:function(Se){this.realloc(8),Qe(this.buf,-1&Se,this.pos),Qe(this.buf,Math.floor(Se*o),this.pos+4),this.pos+=8},writeSFixed64:function(Se){this.realloc(8),Qe(this.buf,-1&Se,this.pos),Qe(this.buf,Math.floor(Se*o),this.pos+4),this.pos+=8},writeVarint:function(Se){(Se=+Se||0)>268435455||Se<0?function(Xe,st){var dt,Ot;if(Xe>=0?(dt=Xe%4294967296|0,Ot=Xe/4294967296|0):(Ot=~(-Xe/4294967296),4294967295^(dt=~(-Xe%4294967296))?dt=dt+1|0:(dt=0,Ot=Ot+1|0)),Xe>=18446744073709552e3||Xe<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");st.realloc(10),function(Pt,Dt,Jt){Jt.buf[Jt.pos++]=127&Pt|128,Pt>>>=7,Jt.buf[Jt.pos++]=127&Pt|128,Pt>>>=7,Jt.buf[Jt.pos++]=127&Pt|128,Pt>>>=7,Jt.buf[Jt.pos++]=127&Pt|128,Jt.buf[Jt.pos]=127&(Pt>>>=7)}(dt,0,st),function(Pt,Dt){var Jt=(7&Pt)<<4;Dt.buf[Dt.pos++]|=Jt|((Pt>>>=3)?128:0),Pt&&(Dt.buf[Dt.pos++]=127&Pt|((Pt>>>=7)?128:0),Pt&&(Dt.buf[Dt.pos++]=127&Pt|((Pt>>>=7)?128:0),Pt&&(Dt.buf[Dt.pos++]=127&Pt|((Pt>>>=7)?128:0),Pt&&(Dt.buf[Dt.pos++]=127&Pt|((Pt>>>=7)?128:0),Pt&&(Dt.buf[Dt.pos++]=127&Pt)))))}(Ot,st)}(Se,this):(this.realloc(4),this.buf[this.pos++]=127&Se|(Se>127?128:0),Se<=127||(this.buf[this.pos++]=127&(Se>>>=7)|(Se>127?128:0),Se<=127||(this.buf[this.pos++]=127&(Se>>>=7)|(Se>127?128:0),Se<=127||(this.buf[this.pos++]=Se>>>7&127))))},writeSVarint:function(Se){this.writeVarint(Se<0?2*-Se-1:2*Se)},writeBoolean:function(Se){this.writeVarint(!!Se)},writeString:function(Se){Se=String(Se),this.realloc(4*Se.length),this.pos++;var Xe=this.pos;this.pos=function(dt,Ot,Pt){for(var Dt,Jt,yi=0;yi<Ot.length;yi++){if((Dt=Ot.charCodeAt(yi))>55295&&Dt<57344){if(!Jt){Dt>56319||yi+1===Ot.length?(dt[Pt++]=239,dt[Pt++]=191,dt[Pt++]=189):Jt=Dt;continue}if(Dt<56320){dt[Pt++]=239,dt[Pt++]=191,dt[Pt++]=189,Jt=Dt;continue}Dt=Jt-55296<<10|Dt-56320|65536,Jt=null}else Jt&&(dt[Pt++]=239,dt[Pt++]=191,dt[Pt++]=189,Jt=null);Dt<128?dt[Pt++]=Dt:(Dt<2048?dt[Pt++]=Dt>>6|192:(Dt<65536?dt[Pt++]=Dt>>12|224:(dt[Pt++]=Dt>>18|240,dt[Pt++]=Dt>>12&63|128),dt[Pt++]=Dt>>6&63|128),dt[Pt++]=63&Dt|128)}return Pt}(this.buf,Se,this.pos);var st=this.pos-Xe;st>=128&&w(Xe,st,this),this.pos=Xe-1,this.writeVarint(st),this.pos+=st},writeFloat:function(Se){this.realloc(4),s.write(this.buf,Se,this.pos,!0,23,4),this.pos+=4},writeDouble:function(Se){this.realloc(8),s.write(this.buf,Se,this.pos,!0,52,8),this.pos+=8},writeBytes:function(Se){var Xe=Se.length;this.writeVarint(Xe),this.realloc(Xe);for(var st=0;st<Xe;st++)this.buf[this.pos++]=Se[st]},writeRawMessage:function(Se,Xe){this.pos++;var st=this.pos;Se(Xe,this);var dt=this.pos-st;dt>=128&&w(st,dt,this),this.pos=st-1,this.writeVarint(dt),this.pos+=dt},writeMessage:function(Se,Xe,st){this.writeTag(Se,e.Bytes),this.writeRawMessage(Xe,st)},writePackedVarint:function(Se,Xe){Xe.length&&this.writeMessage(Se,C,Xe)},writePackedSVarint:function(Se,Xe){Xe.length&&this.writeMessage(Se,O,Xe)},writePackedBoolean:function(Se,Xe){Xe.length&&this.writeMessage(Se,K,Xe)},writePackedFloat:function(Se,Xe){Xe.length&&this.writeMessage(Se,j,Xe)},writePackedDouble:function(Se,Xe){Xe.length&&this.writeMessage(Se,W,Xe)},writePackedFixed32:function(Se,Xe){Xe.length&&this.writeMessage(Se,oe,Xe)},writePackedSFixed32:function(Se,Xe){Xe.length&&this.writeMessage(Se,ue,Xe)},writePackedFixed64:function(Se,Xe){Xe.length&&this.writeMessage(Se,be,Xe)},writePackedSFixed64:function(Se,Xe){Xe.length&&this.writeMessage(Se,ke,Xe)},writeBytesField:function(Se,Xe){this.writeTag(Se,e.Bytes),this.writeBytes(Xe)},writeFixed32Field:function(Se,Xe){this.writeTag(Se,e.Fixed32),this.writeFixed32(Xe)},writeSFixed32Field:function(Se,Xe){this.writeTag(Se,e.Fixed32),this.writeSFixed32(Xe)},writeFixed64Field:function(Se,Xe){this.writeTag(Se,e.Fixed64),this.writeFixed64(Xe)},writeSFixed64Field:function(Se,Xe){this.writeTag(Se,e.Fixed64),this.writeSFixed64(Xe)},writeVarintField:function(Se,Xe){this.writeTag(Se,e.Varint),this.writeVarint(Xe)},writeSVarintField:function(Se,Xe){this.writeTag(Se,e.Varint),this.writeSVarint(Xe)},writeStringField:function(Se,Xe){this.writeTag(Se,e.Bytes),this.writeString(Xe)},writeFloatField:function(Se,Xe){this.writeTag(Se,e.Fixed32),this.writeFloat(Xe)},writeDoubleField:function(Se,Xe){this.writeTag(Se,e.Fixed64),this.writeDouble(Xe)},writeBooleanField:function(Se,Xe){this.writeVarintField(Se,!!Xe)}},Gx}var Hx=Rn(ty());const Ey=3;function Cy(s,e,i){e.glyphs=[],s===1&&i.readMessage(Bp,e)}function Bp(s,e,i){if(s===3){const{id:o,bitmap:h,width:f,height:g,left:w,top:C,advance:O}=i.readMessage(iy,{});e.glyphs.push({id:o,bitmap:new F({width:f+2*Ey,height:g+2*Ey},h),metrics:{width:f,height:g,left:w,top:C,advance:O}})}else s===4?e.ascender=i.readSVarint():s===5&&(e.descender=i.readSVarint())}function iy(s,e,i){s===1?e.id=i.readVarint():s===2?e.bitmap=i.readBytes():s===3?e.width=i.readVarint():s===4?e.height=i.readVarint():s===5?e.left=i.readSVarint():s===6?e.top=i.readSVarint():s===7&&(e.advance=i.readVarint())}const Xx=Ey,kl={horizontal:1,vertical:2,horizontalOnly:3};class nx{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const o=new nx;return o.scale=e||1,o.fontStack=i,o}static forImage(e){const i=new nx;return i.image=e,i}}class Py{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,o){const h=new Py;for(let f=0;f<e.sections.length;f++){const g=e.sections[f];g.image?h.addImageSection(g,o):h.addTextSection(g,i)}return h}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,o){let h="";for(let f=0;f<i.length;f++){const g=i.charCodeAt(f+1)||null,w=i.charCodeAt(f-1)||null;h+=!o&&(g&&Fs(g)&&!Ag[i[f+1]]||w&&Fs(w)&&!Ag[i[f-1]])||!Ag[i[f]]?i[f]:Ag[i[f]]}return h}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&Ly[this.text.charCodeAt(o)];o++)e++;let i=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&Ly[this.text.charCodeAt(o)];o--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const o=new Py;return o.text=this.text.substring(e,i),o.sectionIndex=this.sectionIndex.slice(e,i),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(nx.forText(e.scale,e.fontStack||i));const o=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(o)}addImageSection(e,i){const o=e.image?e.image.getPrimary():null;if(!o)return void Ar("Can't add FormattedSection with an empty image.");o.scaleSelf(i);const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCodePoint(h),this.sections.push(nx.forImage(o)),this.sectionIndex.push(this.sections.length-1)):Ar("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Iy(s,e,i,o,h,f,g,w,C,O,j,W,K,oe,ue,be=1){const ke=Py.fromFeature(s,h,be);W===kl.vertical&&ke.verticalizePunctuation(K);let Fe=[];const Qe=function(dt,Ot,Pt,Dt,Jt,yi){if(!dt)return[];const $i=[],Ii=function(Gi,mi,xi,ss,rs,tr){let Vs=0;for(let gs=0;gs<Gi.length();gs++){const ts=Gi.getSection(gs);Vs+=M_(Gi.getCodePoint(gs),ts,ss,rs,mi,tr)}return Vs/Math.max(1,Math.ceil(Vs/xi))}(dt,Ot,Pt,Dt,Jt,yi),Hi=dt.text.indexOf("​")>=0;let Ki=0;for(let Gi=0;Gi<dt.length();Gi++){const mi=dt.getSection(Gi),xi=dt.getCodePoint(Gi);if(Ly[xi]||(Ki+=M_(xi,mi,Dt,Jt,Ot,yi)),Gi<dt.length()-1){const ss=!((bi=xi)<11904||!(Vt["Bopomofo Extended"](bi)||Vt.Bopomofo(bi)||Vt["CJK Compatibility Forms"](bi)||Vt["CJK Compatibility Ideographs"](bi)||Vt["CJK Compatibility"](bi)||Vt["CJK Radicals Supplement"](bi)||Vt["CJK Strokes"](bi)||Vt["CJK Symbols and Punctuation"](bi)||Vt["CJK Unified Ideographs Extension A"](bi)||Vt["CJK Unified Ideographs"](bi)||Vt["Enclosed CJK Letters and Months"](bi)||Vt["Halfwidth and Fullwidth Forms"](bi)||Vt.Hiragana(bi)||Vt["Ideographic Description Characters"](bi)||Vt["Kangxi Radicals"](bi)||Vt["Katakana Phonetic Extensions"](bi)||Vt.Katakana(bi)||Vt["Vertical Forms"](bi)||Vt["Yi Radicals"](bi)||Vt["Yi Syllables"](bi)));(wm[xi]||ss||mi.image)&&$i.push(sy(Gi+1,Ki,Ii,$i,Oy(xi,dt.getCodePoint(Gi+1),ss&&Hi),!1))}}var bi;return Yx(sy(dt.length(),Ki,Ii,$i,0,!0))}(ke,O,f,e,o,oe),{processBidirectionalText:it,processStyledBidirectionalText:Se}=mn;if(it&&ke.sections.length===1){const dt=it(ke.toString(),Qe);for(const Ot of dt){const Pt=new Py;Pt.text=Ot,Pt.sections=ke.sections;for(let Dt=0;Dt<Ot.length;Dt++)Pt.sectionIndex.push(0);Fe.push(Pt)}}else if(Se){const dt=Se(ke.text,ke.sectionIndex,Qe);for(const Ot of dt){const Pt=new Py;Pt.text=Ot[0],Pt.sectionIndex=Ot[1],Pt.sections=ke.sections,Fe.push(Pt)}}else Fe=function(dt,Ot){const Pt=[],Dt=dt.text;let Jt=0;for(const yi of Ot)Pt.push(dt.substring(Jt,yi)),Jt=yi;return Jt<Dt.length&&Pt.push(dt.substring(Jt,Dt.length)),Pt}(ke,Qe);const Xe=[],st={positionedLines:Xe,text:ke.toString(),top:j[1],bottom:j[1],left:j[0],right:j[0],writingMode:W,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(dt,Ot,Pt,Dt,Jt,yi,$i,Ii,Hi,Ki,bi,Gi){let mi=0,xi=0,ss=0;const rs=Ii==="right"?1:Ii==="left"?0:.5;let tr=!1;for(const Us of Jt){const Mr=Us.getSections();for(const $r of Mr){if($r.image)continue;const Wr=Ot[$r.fontStack];if(Wr&&(tr=Wr.ascender!==void 0&&Wr.descender!==void 0,!tr))break}if(!tr)break}let Vs=0;for(const Us of Jt){Us.trim();const Mr=Us.getMaxScale(),$r=(Mr-1)*wh,Wr={positionedGlyphs:[],lineOffset:0};dt.positionedLines[Vs]=Wr;const uo=Wr.positionedGlyphs;let Kr=0;if(!Us.length()){xi+=yi,++Vs;continue}let po=0,Pn=0;for(let nt=0;nt<Us.length();nt++){const ft=Us.getSection(nt),Si=Us.getSectionIndex(nt),as=Us.getCodePoint(nt);let ys=ft.scale,ps=null,Ds=null,Tr=null,Eo=wh,Co=0;Hi===kl.vertical&&((gs=as)===12312||gs===12313||gs===12316||gs===12540||gs===12448)&&(Hi=kl.horizontal);const Jr=!(Hi===kl.horizontal||!bi&&!os(as)||bi&&(Ly[as]||Xi(as)));if(ft.image){const Dn=Dt.get(ft.image.toString());if(!Dn)continue;Tr=ft.image,dt.iconsInText=dt.iconsInText||!0,Ds=Dn.paddedRect;const ha=Dn.displaySize;ys=ys*wh/Gi,ps={width:ha[0],height:ha[1],left:0,top:-3,advance:Jr?ha[1]:ha[0],localGlyph:!1},Co=tr?-ps.height*ys:Mr*wh-17-ha[1]*ys,Eo=ps.advance;const Po=(Jr?ha[0]:ha[1])*ys-wh*Mr;Po>0&&Po>Kr&&(Kr=Po)}else{const Dn=Pt[ft.fontStack];if(!Dn)continue;Dn[as]&&(Ds=Dn[as]);const ha=Ot[ft.fontStack];if(!ha)continue;const Po=ha.glyphs[as];if(!Po)continue;if(ps=Po.metrics,Eo=as!==8203?wh:0,tr){const rl=ha.ascender!==void 0?Math.abs(ha.ascender):0,wa=ha.descender!==void 0?Math.abs(ha.descender):0,In=(rl+wa)*ys;po<In&&(po=In,Pn=(rl-wa)/2*ys),Co=-rl*ys}else Co=(Mr-ys)*wh-17}Jr?(dt.verticalizable=!0,uo.push({glyph:as,image:Tr,x:mi,y:xi+Co,vertical:Jr,scale:ys,localGlyph:ps.localGlyph,fontStack:ft.fontStack,sectionIndex:Si,metrics:ps,rect:Ds}),mi+=Eo*ys+Ki):(uo.push({glyph:as,image:Tr,x:mi,y:xi+Co,vertical:Jr,scale:ys,localGlyph:ps.localGlyph,fontStack:ft.fontStack,sectionIndex:Si,metrics:ps,rect:Ds}),mi+=ps.advance*ys+Ki)}uo.length!==0&&(ss=Math.max(mi-Ki,ss),tr?l(uo,rs,Kr,Pn,yi*Mr/2):l(uo,rs,Kr,0,yi/2)),mi=0;const ba=yi*Mr+Kr;Wr.lineOffset=Math.max(Kr,$r),xi+=ba,++Vs}var gs;const ts=xi,{horizontalAlign:Br,verticalAlign:Bs}=q($i);(function(Us,Mr,$r,Wr,uo,Kr){const po=(Mr-$r)*uo,Pn=-Kr*Wr;for(const ba of Us)for(const nt of ba.positionedGlyphs)nt.x+=po,nt.y+=Pn})(dt.positionedLines,rs,Br,Bs,ss,ts),dt.top+=-Bs*ts,dt.bottom=dt.top+ts,dt.left+=-Br*ss,dt.right=dt.left+ss,dt.hasBaseline=tr}(st,e,i,o,Fe,g,w,C,W,O,K,ue),!function(dt){for(const Ot of dt)if(Ot.positionedGlyphs.length!==0)return!1;return!0}(Xe))return st}const Ly={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},wm={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function M_(s,e,i,o,h,f){if(e.image){const g=o.get(e.image.toString());return g?g.displaySize[0]*e.scale*wh/f+h:0}{const g=i[e.fontStack],w=g&&g.glyphs[s];return w?w.metrics.advance*e.scale+h:0}}function A_(s,e,i,o){const h=Math.pow(s-e,2);return o?s<e?h/2:2*h:h+Math.abs(i)*i}function Oy(s,e,i){let o=0;return s===10&&(o-=1e4),i&&(o+=150),s!==40&&s!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function sy(s,e,i,o,h,f){let g=null,w=A_(e,i,h,f);for(const C of o){const O=A_(e-C.x,i,h,f)+C.badness;O<=w&&(g=C,w=O)}return{index:s,x:e,priorBreak:g,badness:w}}function Yx(s){return s?Yx(s.priorBreak).concat(s.index):[]}function q(s){let e=.5,i=.5;switch(s){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function l(s,e,i,o,h){if(!(e||i||o||h))return;const f=s.length-1,g=s[f],w=(g.x+g.metrics.advance*g.scale)*e;for(let C=0;C<=f;C++)s[C].x-=w,s[C].y+=i+o+h}function p(s){return s.imagePrimary!==void 0&&s.top!==void 0&&s.bottom!==void 0&&s.left!==void 0&&s.right!==void 0}function y(s,e,i,o){const{horizontalAlign:h,verticalAlign:f}=q(o),g=i[0]-s.displaySize[0]*h,w=i[1]-s.displaySize[1]*f;return{imagePrimary:s,imageSecondary:e,top:w,bottom:w+s.displaySize[1],left:g,right:g+s.displaySize[0]}}function T(s,e,i,o,h,f){const g=s.imagePrimary;let w;if(g.content){const ke=g.content,Fe=g.pixelRatio||1;w=[ke[0]/Fe,ke[1]/Fe,g.displaySize[0]-ke[2]/Fe,g.displaySize[1]-ke[3]/Fe]}const C=e.left*f,O=e.right*f;let j,W,K,oe;i==="width"||i==="both"?(oe=h[0]+C-o[3],W=h[0]+O+o[1]):(oe=h[0]+(C+O-g.displaySize[0])/2,W=oe+g.displaySize[0]);const ue=e.top*f,be=e.bottom*f;return i==="height"||i==="both"?(j=h[1]+ue-o[0],K=h[1]+be+o[2]):(j=h[1]+(ue+be-g.displaySize[1])/2,K=j+g.displaySize[1]),{imagePrimary:g,imageSecondary:void 0,top:j,right:W,bottom:K,left:oe,collisionPadding:w}}function A(s){return!s.imagePrimary.stretchX}function P(s){return!s.imagePrimary.stretchY}function I(s){return{width:s.right-s.left,height:s.bottom-s.top}}const B=128;function X(s,e,i){const{expression:o}=e;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new qr(s+1,{worldview:i}))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:f}=o;let g=0;for(;g<h.length&&h[g]<=s;)g++;g=Math.max(0,g-1);let w=g;for(;w<h.length&&h[w]<s+1;)w++;w=Math.min(h.length-1,w);const C=h[g],O=h[w];return o.kind==="composite"?{kind:"composite",minZoom:C,maxZoom:O,interpolationType:f}:{kind:"camera",minZoom:C,maxZoom:O,minSize:o.evaluate(new qr(C,{worldview:i})),maxSize:o.evaluate(new qr(O,{worldview:i})),interpolationType:f}}}function re(s,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:h}){return s.kind==="source"?o/B:s.kind==="composite"?js(o/B,h/B,i):e}function te(s,e,i=1){let o=0,h=0;if(s.kind==="constant")h=s.layoutSize*i;else if(s.kind!=="source"){const{interpolationType:f,minZoom:g,maxZoom:w}=s,C=f?at(dh.interpolationFactor(f,e,g,w),0,1):0;s.kind==="camera"?h=js(s.minSize,s.maxSize,C)*i:o=C*i}return{uSizeT:o,uSize:h}}class pe extends Wi{constructor(e,i,o,h,f){super(e,i),this.angle=h,this.z=o,f!==void 0&&(this.segment=f)}clone(){return new pe(this.x,this.y,this.z,this.angle,this.segment)}}function _e(s,e,i,o,h){if(e.segment===void 0)return!0;let f=e,g=e.segment+1,w=0;for(;w>-i/2;){if(g--,g<0)return!1;w-=s[g].dist(f),f=s[g]}w+=s[g].dist(s[g+1]),g++;const C=[];let O=0;for(;w<i/2;){const j=s[g],W=s[g+1];if(!W)return!1;let K=s[g-1].angleTo(j)-j.angleTo(W);for(K=Math.abs((K+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:w,angleDelta:K}),O+=K;w-C[0].distance>o;)O-=C.shift().angleDelta;if(O>h)return!1;g++,w+=j.dist(W)}return!0}function Ee(s){let e=0;for(let i=0;i<s.length-1;i++)e+=s[i].dist(s[i+1]);return e}function De(s,e,i){return s?.6*e*i:0}function Re(s,e){return Math.max(s?s.right-s.left:0,e?e.right-e.left:0)}function Be(s,e,i,o,h,f){const g=De(i,h,f),w=Re(i,o)*f;let C=0;const O=Ee(s)/2;for(let j=0;j<s.length-1;j++){const W=s[j],K=s[j+1],oe=W.dist(K);if(C+oe>O){const ue=(O-C)/oe,be=js(W.x,K.x,ue),ke=js(W.y,K.y,ue),Fe=new pe(be,ke,0,K.angleTo(W),j);return!g||_e(s,Fe,w,g,e)?Fe:void 0}C+=oe}}function Ze(s,e,i,o,h,f,g,w,C){const O=De(o,f,g),j=Re(o,h),W=j*g,K=s[0].x===0||s[0].x===C||s[0].y===0||s[0].y===C;return e-W<e/4&&(e=W+e/4),rt(s,K?e/2*w%e:(j/2+2*f)*g*w%e,e,O,i,W,K,!1,C)}function rt(s,e,i,o,h,f,g,w,C){const O=f/2,j=Ee(s);let W=0,K=e-i,oe=[];for(let ue=0;ue<s.length-1;ue++){const be=s[ue],ke=s[ue+1],Fe=be.dist(ke),Qe=ke.angleTo(be);for(;K+i<W+Fe;){K+=i;const it=(K-W)/Fe,Se=js(be.x,ke.x,it),Xe=js(be.y,ke.y,it);if(Se>=0&&Se<C&&Xe>=0&&Xe<C&&K-O>=0&&K+O<=j){const st=new pe(Se,Xe,0,Qe,ue);o&&!_e(s,st,f,o,h)||oe.push(st)}}W+=Fe}return w||oe.length||g||(oe=rt(s,W/2,i,o,h,f,g,!0,C)),oe}function Yt(s){let e=0,i=0;for(const g of s)e+=g.w*g.h,i=Math.max(i,g.w);s.sort((g,w)=>w.h-g.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let h=0,f=0;for(const g of s)for(let w=o.length-1;w>=0;w--){const C=o[w];if(!(g.w>C.w||g.h>C.h)){if(g.x=C.x,g.y=C.y,f=Math.max(f,g.y+g.h),h=Math.max(h,g.x+g.w),g.w===C.w&&g.h===C.h){const O=o.pop();w<o.length&&(o[w]=O)}else g.h===C.h?(C.x+=g.w,C.w-=g.w):g.w===C.w?(C.y+=g.h,C.h-=g.h):(o.push({x:C.x+g.w,y:C.y,w:C.w-g.w,h:g.h}),C.y+=g.h,C.h-=g.h);break}}return{w:h,h:f,fill:e/(h*f)||0}}qe(pe,"Anchor");const Ut=1;class Xt{static getImagePositionScale(e,i,o){if(i&&e&&e.options&&e.options.transform){const h=e.options.transform;return{x:h.a,y:h.d}}return{x:o,y:o}}constructor(e,i,o,h){this.paddedRect=e;const{pixelRatio:f,version:g,stretchX:w,stretchY:C,content:O,sdf:j,usvg:W}=i;this.pixelRatio=f,this.stretchX=w,this.stretchY=C,this.content=O,this.version=g,this.padding=o,this.sdf=j,this.usvg=W,this.scale=Xt.getImagePositionScale(h,W,f)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function Ci(s,e,i){const o=Jd.parse(s),h=function(f,g,w=[1,1]){return{x:0,y:0,w:(f.data?f.data.width:f.width*w[0])+2*g,h:(f.data?f.data.height:f.height*w[1])+2*g}}(e,i,[o.options.transform.a,o.options.transform.d]);return{bin:h,imagePosition:new Xt(h,e,i,o),imageVariant:o}}class di{constructor(e,i,o){const h=new Map,f=new Map;this.haveRenderCallbacks=[];const g=[];this.addImages(e,h,Ut,g),this.addImages(i,f,2,g);const{w,h:C}=Yt(g),O=new V({width:w||1,height:C||1});for(const[j,W]of e.entries()){const K=h.get(j).paddedRect;V.copy(W.data,O,{x:0,y:0},{x:K.x+Ut,y:K.y+Ut},W.data,o,W.sdf)}for(const[j,W]of i.entries()){const K=f.get(j),oe=K.paddedRect;let ue=K.padding;const be=oe.x+ue,ke=oe.y+ue,Fe=W.data.width,Qe=W.data.height;ue=ue>1?ue-1:ue,V.copy(W.data,O,{x:0,y:0},{x:be,y:ke},W.data,o),V.copy(W.data,O,{x:0,y:Qe-ue},{x:be,y:ke-ue},{width:Fe,height:ue},o),V.copy(W.data,O,{x:0,y:0},{x:be,y:ke+Qe},{width:Fe,height:ue},o),V.copy(W.data,O,{x:Fe-ue,y:0},{x:be-ue,y:ke},{width:ue,height:Qe},o),V.copy(W.data,O,{x:0,y:0},{x:be+Fe,y:ke},{width:ue,height:Qe},o),V.copy(W.data,O,{x:Fe-ue,y:Qe-ue},{x:be-ue,y:ke-ue},{width:ue,height:ue},o),V.copy(W.data,O,{x:0,y:Qe-ue},{x:be+Fe,y:ke-ue},{width:ue,height:ue},o),V.copy(W.data,O,{x:0,y:0},{x:be+Fe,y:ke+Qe},{width:ue,height:ue},o),V.copy(W.data,O,{x:Fe-ue,y:0},{x:be-ue,y:ke+Qe},{width:ue,height:ue},o)}this.lut=o,this.image=O,this.iconPositions=h,this.patternPositions=f}addImages(e,i,o,h){for(const[f,g]of e.entries()){const{bin:w,imagePosition:C,imageVariant:O}=Ci(f,g,o);i.set(f,C),h.push(w),g.hasRenderCallback&&this.haveRenderCallbacks.push(O.id)}}patchUpdatedImages(e,i,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>e.hasImage(h,o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,o);for(const h of e.getUpdatedImages(o)){for(const f of this.iconPositions.keys()){const g=Jd.parse(f);if(fl.isEqual(g.id,h)){const w=e.getImage(h,o);this.patchUpdatedImage(this.iconPositions.get(f),w,i)}}for(const f of this.patternPositions.keys()){const g=Jd.parse(f);if(fl.isEqual(g.id,h)){const w=e.getImage(h,o);this.patchUpdatedImage(this.patternPositions.get(f),w,i)}}}}patchUpdatedImage(e,i,o){if(!e||!i||e.version===i.version)return;e.version=i.version;const[h,f]=e.tl,g=e.sdf;if(this.lut||g){const w={width:i.data.width,height:i.data.height},C=new V(w);V.copy(i.data,C,{x:0,y:0},{x:0,y:0},w,this.lut,g),o.update(C,{position:{x:h,y:f}})}else o.update(i.data,{position:{x:h,y:f}})}}qe(Xt,"ImagePosition"),qe(di,"ImageAtlas");const vi=1e20;function es(s,e,i,o,h,f,g,w,C){for(let O=e;O<e+o;O++)ws(s,i*f+O,f,h,g,w,C);for(let O=i;O<i+h;O++)ws(s,O*f+e,1,o,g,w,C)}function ws(s,e,i,o,h,f,g){f[0]=0,g[0]=-1e20,g[1]=vi,h[0]=s[e];for(let w=1,C=0,O=0;w<o;w++){h[w]=s[e+w*i];const j=w*w;do{const W=f[C];O=(h[w]-h[W]+j-W*W)/(w-W)/2}while(O<=g[C]&&--C>-1);C++,f[C]=w,g[C]=O,g[C+1]=vi}for(let w=0,C=0;w<o;w++){for(;g[C+1]<w;)C++;const O=f[C],j=w-O;s[e+w*i]=h[O]+j*j}}const As=2,$s={none:0,ideographs:1,all:2};class kr{constructor(e,i,o){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=o,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,o){const h=[],f=this.urls[i]||Ua.GLYPHS_URL;for(const g in e)for(const w of e[g])h.push({stack:g,id:w});jt(h,({stack:g,id:w},C)=>{let O=this.entries[g];O||(O=this.entries[g]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let j=O.glyphs[w];if(j!==void 0)return void C(null,{stack:g,id:w,glyph:j});if(j=this._tinySDF(O,g,w),j)return O.glyphs[w]=j,void C(null,{stack:g,id:w,glyph:j});const W=Math.floor(w/256);if(256*W>65535)return Ar("glyphs > 65535 not supported"),void C(null,{stack:g,id:w,glyph:j});if(O.ranges[W])return void C(null,{stack:g,id:w,glyph:j});let K=O.requests[W];K||(K=O.requests[W]=[],kr.loadGlyphRange(g,W,f,this.requestManager,(oe,ue)=>{if(ue){O.ascender=ue.ascender,O.descender=ue.descender;for(const be in ue.glyphs)this._doesCharSupportLocalGlyph(+be)||(O.glyphs[+be]=ue.glyphs[+be]);O.ranges[W]=!0}for(const be of K)be(oe,ue);delete O.requests[W]})),K.push((oe,ue)=>{oe?C(oe):ue&&C(null,{stack:g,id:w,glyph:ue.glyphs[w]||null})})},(g,w)=>{if(g)o(g);else if(w){const C={};for(const{stack:O,id:j,glyph:W}of w)C[O]===void 0&&(C[O]={}),C[O].glyphs===void 0&&(C[O].glyphs={}),C[O].glyphs[j]=W&&{id:W.id,bitmap:W.bitmap.clone(),metrics:W.metrics},C[O].ascender=this.entries[O].ascender,C[O].descender=this.entries[O].descender;o(null,C)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==$s.none&&(this.localGlyphMode===$s.all?!!this.localFontFamily:!!this.localFontFamily&&(Vt["CJK Unified Ideographs"](e)||Vt["Hangul Syllables"](e)||Vt.Hiragana(e)||Vt.Katakana(e)||Vt["CJK Symbols and Punctuation"](e)||Vt["CJK Unified Ideographs Extension A"](e)||Vt["CJK Unified Ideographs Extension B"](e)||Vt.Osage(e)))}_tinySDF(e,i,o){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(o))return;let f=e.tinySDF;if(!f){let be="400";/bold/i.test(i)?be="900":/medium/i.test(i)?be="500":/light/i.test(i)&&(be="200"),f=e.tinySDF=new kr.TinySDF({fontFamily:h,fontWeight:be,fontSize:24*As,buffer:3*As,radius:8*As}),f.fontWeight=be}if(this.localGlyphs[f.fontWeight][o])return this.localGlyphs[f.fontWeight][o];const g=String.fromCodePoint(o),{data:w,width:C,height:O,glyphWidth:j,glyphHeight:W,glyphLeft:K,glyphTop:oe,glyphAdvance:ue}=f.draw(g);return this.localGlyphs[f.fontWeight][o]={id:o,bitmap:new F({width:C,height:O},w),metrics:{width:j/As,height:W/As,left:K/As,top:oe/As-27,advance:ue/As,localGlyph:!0}}}}kr.loadGlyphRange=function(s,e,i,o,h){const f=256*e,g=f+255,w=o.transformRequest(o.normalizeGlyphsURL(i).replace("{fontstack}",s).replace("{range}",`${f}-${g}`),Dc.Glyphs);Ch(w,(C,O)=>{if(C)h(C);else if(O){const j={},W=function(K){return new Hx(K).readFields(Cy,{})}(O);for(const K of W.glyphs)j[K.id]=K;h(null,{glyphs:j,ascender:W.ascender,descender:W.descender})}})},kr.TinySDF=class{constructor({fontSize:s=24,buffer:e=3,radius:i=8,cutoff:o=.25,fontFamily:h="sans-serif",fontWeight:f="normal",fontStyle:g="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=i;const w=this.size=s+4*e,C=this._createCanvas(w),O=this.ctx=C.getContext("2d",{willReadFrequently:!0});O.font=`${g} ${f} ${s}px ${h}`,O.textBaseline="alphabetic",O.textAlign="left",O.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(s){const e=document.createElement("canvas");return e.width=e.height=s,e}draw(s){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:o,actualBoundingBoxLeft:h,actualBoundingBoxRight:f}=this.ctx.measureText(s),g=Math.ceil(i),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-h))),C=Math.min(this.size-this.buffer,g+Math.ceil(o)),O=w+2*this.buffer,j=C+2*this.buffer,W=Math.max(O*j,0),K=new Uint8ClampedArray(W),oe={data:K,width:O,height:j,glyphWidth:w,glyphHeight:C,glyphTop:g,glyphLeft:0,glyphAdvance:e};if(w===0||C===0)return oe;const{ctx:ue,buffer:be,gridInner:ke,gridOuter:Fe}=this;ue.clearRect(be,be,w,C),ue.fillText(s,be,be+g);const Qe=ue.getImageData(be,be,w,C);Fe.fill(vi,0,W),ke.fill(0,0,W);for(let it=0;it<C;it++)for(let Se=0;Se<w;Se++){const Xe=Qe.data[4*(it*w+Se)+3]/255;if(Xe===0)continue;const st=(it+be)*O+Se+be;if(Xe===1)Fe[st]=0,ke[st]=vi;else{const dt=.5-Xe;Fe[st]=dt>0?dt*dt:0,ke[st]=dt<0?dt*dt:0}}es(Fe,0,0,O,j,O,this.f,this.v,this.z),es(ke,be,be,w,C,O,this.f,this.v,this.z);for(let it=0;it<W;it++){const Se=Math.sqrt(Fe[it])-Math.sqrt(ke[it]);K[it]=Math.round(255-255*(Se/this.radius+this.cutoff))}return oe}};const pr=Ut;function Vr(s,e){return s+e[1]-e[0]}function cr(s,e,i,o,h=1){const f=[],g=s.imagePrimary,w=g.pixelRatio,C=g.paddedRect.w-2*pr,O=g.paddedRect.h-2*pr,j=(s.right-s.left)*h,W=(s.bottom-s.top)*h,K=g.stretchX||[[0,C]],oe=g.stretchY||[[0,O]],ue=K.reduce(Vr,0),be=oe.reduce(Vr,0),ke=C-ue,Fe=O-be;let Qe=0,it=ue,Se=0,Xe=be,st=0,dt=ke,Ot=0,Pt=Fe;if(g.content&&o){const Jt=g.content;Qe=Zr(K,0,Jt[0]),Se=Zr(oe,0,Jt[1]),it=Zr(K,Jt[0],Jt[2]),Xe=Zr(oe,Jt[1],Jt[3]),st=Jt[0]-Qe,Ot=Jt[1]-Se,dt=Jt[2]-Jt[0]-it,Pt=Jt[3]-Jt[1]-Xe}const Dt=(Jt,yi,$i,Ii)=>{const Hi=Qo(Jt.stretch-Qe,it,j,s.left*h),Ki=en(Jt.fixed-st,dt,Jt.stretch,ue),bi=Qo(yi.stretch-Se,Xe,W,s.top*h),Gi=en(yi.fixed-Ot,Pt,yi.stretch,be),mi=Qo($i.stretch-Qe,it,j,s.left*h),xi=en($i.fixed-st,dt,$i.stretch,ue),ss=Qo(Ii.stretch-Se,Xe,W,s.top*h),rs=en(Ii.fixed-Ot,Pt,Ii.stretch,be),tr=new Wi(Hi,bi),Vs=new Wi(mi,bi),gs=new Wi(mi,ss),ts=new Wi(Hi,ss),Br=new Wi(Ki/w,Gi/w),Bs=new Wi(xi/w,rs/w),Us=e*Math.PI/180;if(Us){const po=Math.sin(Us),Pn=Math.cos(Us),ba=[Pn,-po,po,Pn];tr._matMult(ba),Vs._matMult(ba),ts._matMult(ba),gs._matMult(ba)}const Mr=Jt.stretch+Jt.fixed,$r=$i.stretch+$i.fixed,Wr=yi.stretch+yi.fixed,uo=Ii.stretch+Ii.fixed,Kr=s.imageSecondary;return{tl:tr,tr:Vs,bl:ts,br:gs,texPrimary:{x:g.paddedRect.x+pr+Mr,y:g.paddedRect.y+pr+Wr,w:$r-Mr,h:uo-Wr},texSecondary:Kr?{x:Kr.paddedRect.x+pr+Mr,y:Kr.paddedRect.y+pr+Wr,w:$r-Mr,h:uo-Wr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Br,pixelOffsetBR:Bs,minFontScaleX:dt/w/j,minFontScaleY:Pt/w/W,isSDF:i}};if(o&&(g.stretchX||g.stretchY)){const Jt=Cn(K,ke,ue),yi=Cn(oe,Fe,be);for(let $i=0;$i<Jt.length-1;$i++){const Ii=Jt[$i],Hi=Jt[$i+1];for(let Ki=0;Ki<yi.length-1;Ki++)f.push(Dt(Ii,yi[Ki],Hi,yi[Ki+1]))}}else f.push(Dt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:C+1},{fixed:0,stretch:O+1}));return f}function Zr(s,e,i){let o=0;for(const h of s)o+=Math.max(e,Math.min(i,h[1]))-Math.max(e,Math.min(i,h[0]));return o}function Cn(s,e,i){const o=[{fixed:-1,stretch:0}];for(const[h,f]of s){const g=o[o.length-1];o.push({fixed:h-g.stretch,stretch:g.stretch}),o.push({fixed:h-g.stretch,stretch:g.stretch+(f-h)})}return o.push({fixed:e+pr,stretch:i}),o}function Qo(s,e,i,o){return s/e*i+o}function en(s,e,i,o){return s-e*i/o}function uc(s,e,i,o){const h=e+s.positionedLines[o].lineOffset;return o===0?i+h/2:i+(h+(e+s.positionedLines[o-1].lineOffset))/2}function gn(s,e=1,i=!1){let o=1/0,h=1/0,f=-1/0,g=-1/0;const w=s[0];for(let oe=0;oe<w.length;oe++){const ue=w[oe];(!oe||ue.x<o)&&(o=ue.x),(!oe||ue.y<h)&&(h=ue.y),(!oe||ue.x>f)&&(f=ue.x),(!oe||ue.y>g)&&(g=ue.y)}const C=Math.min(f-o,g-h);let O=C/2;const j=new iu([],va);if(C===0)return new Wi(o,h);for(let oe=o;oe<f;oe+=C)for(let ue=h;ue<g;ue+=C)j.push(new Fo(oe+O,ue+O,O,s));let W=function(oe){let ue=0,be=0,ke=0;const Fe=oe[0];for(let Qe=0,it=Fe.length,Se=it-1;Qe<it;Se=Qe++){const Xe=Fe[Qe],st=Fe[Se],dt=Xe.x*st.y-st.x*Xe.y;be+=(Xe.x+st.x)*dt,ke+=(Xe.y+st.y)*dt,ue+=3*dt}return new Fo(be/ue,ke/ue,0,oe)}(s),K=j.length;for(;j.length;){const oe=j.pop();(oe.d>W.d||!W.d)&&(W=oe,i&&console.log("found best %d after %d probes",Math.round(1e4*oe.d)/1e4,K)),oe.max-W.d<=e||(O=oe.h/2,j.push(new Fo(oe.p.x-O,oe.p.y-O,O,s)),j.push(new Fo(oe.p.x+O,oe.p.y-O,O,s)),j.push(new Fo(oe.p.x-O,oe.p.y+O,O,s)),j.push(new Fo(oe.p.x+O,oe.p.y+O,O,s)),K+=4)}return i&&(console.log(`num probes: ${K}`),console.log(`best distance: ${W.d}`)),W.p}function va(s,e){return e.max-s.max}class Fo{constructor(e,i,o,h){this.p=new Wi(e,i),this.h=o,this.d=function(f,g){let w=!1,C=1/0;for(let O=0;O<g.length;O++){const j=g[O];for(let W=0,K=j.length,oe=K-1;W<K;oe=W++){const ue=j[W],be=j[oe];ue.y>f.y!=be.y>f.y&&f.x<(be.x-ue.x)*(f.y-ue.y)/(be.y-ue.y)+ue.x&&(w=!w),C=Math.min(C,mg(f,ue,be))}}return(w?1:-1)*Math.sqrt(C)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const Ao=Object.keys,oh=Number.POSITIVE_INFINITY,Ya=Math.sqrt(2);function El(s,[e,i]){let o=0,h=0;if(i===oh){e<0&&(e=0);const f=e/Ya;switch(s){case"top-right":case"top-left":h=f-7;break;case"bottom-right":case"bottom-left":h=7-f;break;case"bottom":h=7-e;break;case"top":h=e-7}switch(s){case"top-right":case"bottom-right":o=-f;break;case"top-left":case"bottom-left":o=f;break;case"left":o=e;break;case"right":o=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),s){case"top-right":case"top-left":case"top":h=i-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-i}switch(s){case"top-right":case"bottom-right":case"right":o=-e;break;case"top-left":case"bottom-left":case"left":o=e}}return[o,h]}function Nh(s,e,i,o,h,f,g,w,C){if(!e||!e.usvg)return;const O=I(o),j=I(h),W=f!=="both"&&f!=="width"||!A(o)?1:j.width/O.width,K=f!=="both"&&f!=="height"||!P(o)?1:j.height/O.height;i.scaleSelf(W,K);const oe=i.toString();g.set(oe,i),w.set(oe,e);const{imagePosition:ue}=Ci(oe,e,Ut);C.set(oe,ue)}function Tm(s,e,i,o,h,f,g,w,C){if(!s)return;const O=function(j,W,K,oe,ue,be){if(j.kind==="camera")return j.maxSize;if(j.kind==="composite"){const ke=W.possiblyEvaluate(new qr(j.maxZoom,{worldview:be}),K).evaluate(ue,{},K),Fe=W.possiblyEvaluate(new qr(j.minZoom,{worldview:be}),K).evaluate(ue,{},K);return Math.max(ke,Fe)}return W.possiblyEvaluate(new qr(oe,{worldview:be})).evaluate(ue,{},K)}(e,i,o,h,f,C);return s.scaleSelf(O*w*g)}function Fp(s,e,i,o,h,f,g,w,C){return{iconPrimary:Tm(s.getPrimary(),e,i,o,h,f,g,w,C),iconSecondary:Tm(s.getSecondary(),e,i,o,h,f,g,w,C)}}function vd(s,e,i){if(!e)return;const o=i.get(s.toString()),h=i.get(e.toString());h&&(o.paddedRect.w===h.paddedRect.w&&o.paddedRect.h===h.paddedRect.h||Ar(`Mismatch in icon variant sizes: ${s.toString()} and ${e.toString()}`),o.usvg!==h.usvg&&Ar(`Mismatch in icon variant image types: ${s.id} and ${e.id}`))}function H(s,e,i,o){if(!s)return;const h=e.get(i.toString());if(s.imagePrimary=h,o){const f=e.get(o.toString());s.imageSecondary=f}}function n(s,e){for(const i in s.horizontal)m(s.horizontal[i],e);m(s.vertical,e)}function m(s,e){if(s){for(const i of s.positionedLines)for(const o of i.positionedGlyphs)if(o.image!==null){const h=o.image.toString();o.rect=e.get(h).paddedRect}}}function x(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function S(s,e,i,o,h,f,g,w,C){const O=Y(f.horizontal)||f.vertical,j=i.get("icon-text-fit-padding").evaluate(o,{},h);let W,K=e;return e&&C!=="none"&&(s.allowVerticalPlacement&&f.vertical&&(W=T(e,f.vertical,C,j,w,g)),O&&(K=T(e,O,C,j,w,g))),{defaultShapedIcon:K,verticallyShapedIcon:W}}function k(s,e,i,o,h,f,g,w,C,O,j,W,K,oe,ue,be,ke,Fe,Qe,it){let Se=g.textMaxSize.evaluate(e,{},K);Se===void 0?Se=w*g.textScaleFactor:Se*=g.textScaleFactor;const Xe=s.layers[0].layout,st=Y(i.horizontal)||i.vertical,dt=oe.name==="globe",Ot=wh,Pt=s.tilePixelRatio*Se/Ot,Dt=(Ki=s.overscaling,s.zoom>18&&Ki>2&&(Ki>>=1),Math.max(ns/(512*Ki),1)*Xe.get("symbol-spacing")),Jt=Xe.get("text-padding")*s.tilePixelRatio,yi=Xe.get("icon-padding")*s.tilePixelRatio,$i=lr(Xe.get("text-max-angle")),Ii=Xe.get("icon-rotation-alignment")==="map"&&it!=="point",Hi=Dt/2;var Ki;s.hasAnyIconTextFit===!1&&ke!=="none"&&(s.hasAnyIconTextFit=!0);const bi=e.properties?+e.properties[zr]:null,Gi=bi&&s.elevationFeatureIdToIndex?s.elevationFeatureIdToIndex.get(bi):65535,mi=(xi,ss,rs)=>{if(ss.x<0||ss.x>=ns||ss.y<0||ss.y>=ns)return;let tr=null;if(dt){const{x:Vs,y:gs,z:ts}=oe.projectTilePoint(ss.x,ss.y,rs);tr={anchor:new pe(Vs,gs,ts,0,void 0),up:oe.upVector(rs,ss.x,ss.y)}}(function(Vs,gs,ts,Br,Bs,Us,Mr,$r,Wr,uo,Kr,po,Pn,ba,nt,ft,Si,as,ys,ps,Ds,Tr,Eo,Co,Jr,Dn,ha,Po,rl){const wa=Vs.addToLineVertexArray(gs,Br);let In,Cl,Pa,ca,Ta,Vn,so,jn=0,ol=0,yr=0,tn=0,Ia=-1,gl=-1;const Oa={};let Vh=Ol("");const Zn=ts?ts.anchor:gs,Th=Po!=="none";let af=0,bu=0;if(Wr._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Uh=Wr.layout.get("text-offset").evaluate(Ds,{},Jr);af=Uh[0]*wh,bu=Uh[1]*wh}else af=Wr.layout.get("text-radial-offset").evaluate(Ds,{},Jr)*wh,bu=oh;if(Vs.allowVerticalPlacement&&Bs.vertical){const Uh=Bs.vertical;if(nt)Vn=$(Uh),$r&&(so=$($r));else{const Cc=Wr.layout.get("text-rotate").evaluate(Ds,{},Jr)+90;Pa=se(uo,Zn,gs,Kr,po,Pn,Uh,ba,Cc,ft),$r&&(ca=se(uo,Zn,gs,Kr,po,Pn,$r,as,Cc))}}if(Us){const Uh=Vs.iconSizeData,Cc=Wr.layout.get("icon-rotate").evaluate(Ds,{},Jr),wu=cr(Us,Cc,Eo,Th,Tr.iconScaleFactor),up=$r?cr($r,Cc,Eo,Th,Tr.iconScaleFactor):void 0;Cl=se(uo,Zn,gs,Kr,po,Pn,Us,as,Cc,null),jn=4*wu.length;let Yu=null;Uh.kind==="source"?(Yu=[B*Wr.layout.get("icon-size").evaluate(Ds,{},Jr)*Tr.iconScaleFactor],Yu[0]>R&&Ar(`${Vs.layerIds[0]}: Value for "icon-size" is >= ${L}. Reduce your "icon-size".`)):Uh.kind==="composite"&&(Yu=[B*Tr.compositeIconSizes[0].evaluate(Ds,{},Jr)*Tr.iconScaleFactor,B*Tr.compositeIconSizes[1].evaluate(Ds,{},Jr)*Tr.iconScaleFactor],(Yu[0]>R||Yu[1]>R)&&Ar(`${Vs.layerIds[0]}: Value for "icon-size" is >= ${L}. Reduce your "icon-size".`)),Vs.addSymbols(Vs.icon,wu,Yu,ps,ys,Ds,void 0,ts,gs,wa.lineStartIndex,wa.lineLength,-1,Co,Jr,Dn,ha),Ia=Vs.icon.placedSymbolArray.length-1,up&&(ol=4*up.length,Vs.addSymbols(Vs.icon,up,Yu,ps,ys,Ds,kl.vertical,ts,gs,wa.lineStartIndex,wa.lineLength,-1,Co,Jr,Dn,ha),gl=Vs.icon.placedSymbolArray.length-1)}for(const Uh in Bs.horizontal){const Cc=Uh,wu=Bs.horizontal[Cc];In||(Vh=Ol(wu.text),nt?Ta=$(wu):In=se(uo,Zn,gs,Kr,po,Pn,wu,ba,Wr.layout.get("text-rotate").evaluate(Ds,{},Jr),ft));const up=wu.positionedLines.length===1;if(yr+=N(Vs,ts,gs,wu,Mr,Wr,nt,Ds,ft,wa,Bs.vertical?kl.horizontal:kl.horizontalOnly,up?Ao(Bs.horizontal):[Cc],Oa,Ia,Tr,Co,Jr,Dn),up)break}Bs.vertical&&(tn+=N(Vs,ts,gs,Bs.vertical,Mr,Wr,nt,Ds,ft,wa,kl.vertical,["vertical"],Oa,gl,Tr,Co,Jr,Dn));let jd=-1;const lf=(Uh,Cc)=>Uh?Math.max(Uh,Cc):Cc;jd=lf(Ta,jd),jd=lf(Vn,jd),jd=lf(so,jd);const zy=jd>-1?1:0;Vs.glyphOffsetArray.length>=65535&&Ar("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ds.sortKey!==void 0&&Vs.addToSortKeyRanges(Vs.symbolInstances.length,Ds.sortKey),Vs.symbolInstances.emplaceBack(gs.x,gs.y,Zn.x,Zn.y,Zn.z,Oa.right>=0?Oa.right:-1,Oa.center>=0?Oa.center:-1,Oa.left>=0?Oa.left:-1,Oa.vertical>=0?Oa.vertical:-1,Ia,gl,Vh,In!==void 0?In:Vs.collisionBoxArray.length,In!==void 0?In+1:Vs.collisionBoxArray.length,Pa!==void 0?Pa:Vs.collisionBoxArray.length,Pa!==void 0?Pa+1:Vs.collisionBoxArray.length,Cl!==void 0?Cl:Vs.collisionBoxArray.length,Cl!==void 0?Cl+1:Vs.collisionBoxArray.length,ca||Vs.collisionBoxArray.length,ca?ca+1:Vs.collisionBoxArray.length,Kr,yr,tn,jn,ol,zy,0,af,bu,jd,0,Th?1:0,rl)})(s,ss,tr,xi,i,o,f,h,s.layers[0],s.collisionBoxArray,e.index,e.sourceLayerIndex,s.index,Jt,Qe,O,0,yi,Ii,Fe,e,g,j,W,K,ue,be,ke,Gi)};if(it==="line")for(const xi of Lx(e.geometry,0,0,ns,ns)){const ss=Ze(xi,Dt,$i,i.vertical||st,o,Ot,Pt,s.overscaling,ns);for(const rs of ss)st&&ee(s,st.text,Hi,rs)||mi(xi,rs,K)}else if(it==="line-center"){for(const xi of e.geometry)if(xi.length>1){const ss=Be(xi,$i,i.vertical||st,o,Ot,Pt);ss&&mi(xi,ss,K)}}else if(e.type==="Polygon")for(const xi of $o(e.geometry,0)){const ss=gn(xi,16);mi(xi[0],new pe(ss.x,ss.y,0,0,void 0),K)}else if(e.type==="LineString")for(const xi of e.geometry)mi(xi,new pe(xi[0].x,xi[0].y,0,0,void 0),K);else if(e.type==="Point")for(const xi of e.geometry)for(const ss of xi)mi([ss],new pe(ss.x,ss.y,0,0,void 0),K)}const L=255,R=L*B;function N(s,e,i,o,h,f,g,w,C,O,j,W,K,oe,ue,be,ke,Fe){const Qe=function(Xe,st,dt,Ot,Pt,Dt,Jt,yi){const $i=[];if(st.positionedLines.length===0)return $i;const Ii=Ot.layout.get("text-rotate").evaluate(Dt,{})*Math.PI/180,Hi=function(xi){const ss=xi[0],rs=xi[1],tr=ss*rs;return tr>0?[ss,-rs]:tr<0?[-ss,rs]:ss===0?[rs,ss]:[rs,-ss]}(dt);let Ki=Math.abs(st.top-st.bottom);for(const xi of st.positionedLines)Ki-=xi.lineOffset;const bi=st.positionedLines.length,Gi=Ki/bi;let mi=st.top-dt[1];for(let xi=0;xi<bi;++xi){const ss=st.positionedLines[xi];mi=uc(st,Gi,mi,xi);for(const rs of ss.positionedGlyphs){if(!rs.rect)continue;const tr=rs.rect||{};let Vs=Xx+1,gs=!0,ts=1,Br=0;if(rs.image){const Ds=Jt.get(rs.image.toString());if(!Ds)continue;if(Ds.sdf){Ar("SDF images are not supported in formatted text and will be ignored.");continue}gs=!1,ts=Ds.pixelRatio,Vs=Ut/ts}const Bs=(Pt||yi)&&rs.vertical,Us=rs.metrics.advance*rs.scale/2,Mr=rs.metrics,$r=rs.rect;if($r===null)continue;yi&&st.verticalizable&&(Br=rs.image?Us-rs.metrics.width*rs.scale/2:0);const Wr=Pt?[rs.x+Us,rs.y]:[0,0];let uo=[0,0],Kr=[0,0],po=!1;Pt||(Bs?(Kr=[rs.x+Us+Hi[0],rs.y+Hi[1]-Br],po=!0):uo=[rs.x+Us+dt[0],rs.y+dt[1]-Br]);const Pn=$r.w*rs.scale/(ts*(rs.localGlyph?As:1)),ba=$r.h*rs.scale/(ts*(rs.localGlyph?As:1));let nt,ft,Si,as;if(Bs){const Ds=rs.y-mi,Tr=new Wi(-Us,Us-Ds),Eo=-Math.PI/2,Co=new Wi(...Kr);nt=new Wi(-Us+uo[0],uo[1]),nt._rotateAround(Eo,Tr)._add(Co),nt.x+=-Ds+Us,nt.y-=(Mr.left-Vs)*rs.scale;const Jr=rs.image?Mr.advance*rs.scale:wh*rs.scale,Dn=String.fromCodePoint(rs.glyph);V0(Dn)?nt.x+=(1-Vs)*rs.scale:jx(Dn)?nt.x+=Jr-Mr.height*rs.scale+(-Vs-1)*rs.scale:nt.x+=rs.image||Mr.width+2*Vs===$r.w&&Mr.height+2*Vs===$r.h?(Jr-ba)/2:(Jr-(Mr.height+2*Vs)*rs.scale)/2,ft=new Wi(nt.x,nt.y-Pn),Si=new Wi(nt.x+ba,nt.y),as=new Wi(nt.x+ba,nt.y-Pn)}else{const Ds=(Mr.left-Vs)*rs.scale-Us+uo[0],Tr=(-Mr.top-Vs)*rs.scale+uo[1],Eo=Ds+Pn,Co=Tr+ba;nt=new Wi(Ds,Tr),ft=new Wi(Eo,Tr),Si=new Wi(Ds,Co),as=new Wi(Eo,Co)}if(Ii){let Ds;Ds=Pt?new Wi(0,0):po?new Wi(Hi[0],Hi[1]):new Wi(dt[0],dt[1]),nt._rotateAround(Ii,Ds),ft._rotateAround(Ii,Ds),Si._rotateAround(Ii,Ds),as._rotateAround(Ii,Ds)}const ys=new Wi(0,0),ps=new Wi(0,0);$i.push({tl:nt,tr:ft,bl:Si,br:as,texPrimary:tr,texSecondary:void 0,writingMode:st.writingMode,glyphOffset:Wr,sectionIndex:rs.sectionIndex,isSDF:gs,pixelOffsetTL:ys,pixelOffsetBR:ps,minFontScaleX:0,minFontScaleY:0})}}return $i}(0,o,C,f,g,w,h,s.allowVerticalPlacement),it=s.textSizeData;let Se=null;it.kind==="source"?(Se=[B*f.layout.get("text-size").evaluate(w,{},ke)*ue.textScaleFactor],Se[0]>R&&Ar(`${s.layerIds[0]}: Value for "text-size" is >= ${L}. Reduce your "text-size".`)):it.kind==="composite"&&(Se=[B*ue.compositeTextSizes[0].evaluate(w,{},ke)*ue.textScaleFactor,B*ue.compositeTextSizes[1].evaluate(w,{},ke)*ue.textScaleFactor],(Se[0]>R||Se[1]>R)&&Ar(`${s.layerIds[0]}: Value for "text-size" is >= ${L}. Reduce your "text-size".`)),s.addSymbols(s.text,Qe,Se,C,g,w,j,e,i,O.lineStartIndex,O.lineLength,oe,be,ke,Fe,!1);for(const Xe of W)K[Xe]=s.text.placedSymbolArray.length-1;return 4*Qe.length}function Y(s){for(const e in s)return s[e];return null}function se(s,e,i,o,h,f,g,w,C,O){let j=g.top,W=g.bottom,K=g.left,oe=g.right;if(p(g)&&g.collisionPadding){const ue=g.collisionPadding;K-=ue[0],j-=ue[1],oe+=ue[2],W+=ue[3]}if(C){const ue=new Wi(K,j),be=new Wi(oe,j),ke=new Wi(K,W),Fe=new Wi(oe,W),Qe=lr(C);let it=new Wi(0,0);O&&(it=new Wi(O[0],O[1])),ue._rotateAround(Qe,it),be._rotateAround(Qe,it),ke._rotateAround(Qe,it),Fe._rotateAround(Qe,it),K=Math.min(ue.x,be.x,ke.x,Fe.x),oe=Math.max(ue.x,be.x,ke.x,Fe.x),j=Math.min(ue.y,be.y,ke.y,Fe.y),W=Math.max(ue.y,be.y,ke.y,Fe.y)}return s.emplaceBack(e.x,e.y,e.z,i.x,i.y,K,j,oe,W,w,o,h,f),s.length-1}function $(s){p(s)&&s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const e=s.bottom-s.top;return e>0?Math.max(10,e):null}function ee(s,e,i,o){const h=s.compareText;if(e in h){const f=h[e];for(let g=f.length-1;g>=0;g--)if(o.dist(f[g])<i)return!0}else h[e]=[];return h[e].push(o),!1}function ae(s,e){const i=s.fovAboveCenter,o=s.elevation?s.elevation.getMinElevationBelowMSL()*e:0,h=(s._camera.position[2]*s.worldSize-o)/Math.cos(s._pitch),f=Math.sin(i)*h/Math.sin(Math.max(Math.PI/2-s._pitch-i,.01));let g=Math.sin(s._pitch)*f+h;const w=h*(1/s._horizonShift);if(!s.elevation||s.elevation.exaggeration()===0){let C=Math.max(s.zoom-17,0);s.isOrthographic&&(C/=10),g*=1+C}return Math.min(1.01*g,w)}function fe(s,e){if(!e.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:e};const i=Math.pow(2,-s.z),o=s.x*i,h=(s.x+1)*i,f=s.y*i,g=(s.y+1)*i,w=Ct(o),C=Ct(h),O=ti(f),j=ti(g),W=e.project(w,O),K=e.project(C,O),oe=e.project(C,j),ue=e.project(w,j);let be=Math.min(W.x,K.x,oe.x,ue.x),ke=Math.min(W.y,K.y,oe.y,ue.y),Fe=Math.max(W.x,K.x,oe.x,ue.x),Qe=Math.max(W.y,K.y,oe.y,ue.y);const it=i/16;function Se(st,dt,Ot,Pt,Dt,Jt){const yi=(Ot+Dt)/2,$i=(Pt+Jt)/2,Ii=e.project(Ct(yi),ti($i)),Hi=Math.max(0,be-Ii.x,ke-Ii.y,Ii.x-Fe,Ii.y-Qe);be=Math.min(be,Ii.x),Fe=Math.max(Fe,Ii.x),ke=Math.min(ke,Ii.y),Qe=Math.max(Qe,Ii.y),Hi>it&&(Se(st,Ii,Ot,Pt,yi,$i),Se(Ii,dt,yi,$i,Dt,Jt))}Se(W,K,o,f,h,f),Se(K,oe,h,f,h,g),Se(oe,ue,h,g,o,g),Se(ue,W,o,g,o,f),be-=it,ke-=it,Fe+=it,Qe+=it;const Xe=1/Math.max(Fe-be,Qe-ke);return{scale:Xe,x:be*Xe,y:ke*Xe,x2:Fe*Xe,y2:Qe*Xe,projection:e}}function ve(s,{x:e,y:i},o=0){return new Wi(((e-o)*s.scale-s.x)*ns,(i*s.scale-s.y)*ns)}const Te=hs(new Float32Array(16));class Ae{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new He(0,0)}projectTilePoint(e,i,o){return{x:e,y:i,z:0}}locationPoint(e,i,o,h=!0){return e._coordinatePoint(e.locationCoordinate(i,o),h)}pixelsPerMeter(e,i){return At(1,e)*i}pixelSpaceConversion(e,i,o){return 1}farthestPixelDistance(e){return ae(e,e.pixelsPerMeter)}pointCoordinate(e,i,o,h){const f=e.horizonLineFromTop(!1),g=new Wi(i,Math.max(f,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(g,h))}pointCoordinate3D(e,i,o){const h=new Wi(i,o);if(e.elevation)return e.elevation.pointCoordinate(h);{const f=this.pointCoordinate(e,h.x,h.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const o=e.horizonLineFromTop();return i.y<o}createInversionMatrix(e,i){return Te}createTileMatrix(e,i,o){let h,f,g;const w=o.canonical,C=hs(new Float64Array(16));if(this.isReprojectedInTileSpace){const O=fe(w,this);h=1,f=O.x+o.wrap*O.scale,g=O.y,Or(C,C,[h/O.scale,h/O.scale,e.pixelsPerMeter/i])}else h=i/e.zoomScale(w.z),f=(w.x+Math.pow(2,w.z)*o.wrap)*h,g=w.y*h;return Nr(C,C,[f,g,0]),Or(C,C,[h/ns,h/ns,1]),C}upVector(e,i,o){return[0,0,1]}upVectorScale(e,i,o){return{metersToTile:1}}}class Ve extends Ae{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,o]=this.parallels=e.parallels||[29.5,45.5],h=Math.sin(lr(i));this.n=(h+Math.sin(lr(o)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:o,c:h,r0:f}=this,g=lr(e-this.center[0]),w=lr(i),C=Math.sqrt(h-2*o*Math.sin(w))/o;return{x:C*Math.sin(g*o),y:C*Math.cos(g*o)-f,z:0}}unproject(e,i){const{n:o,c:h,r0:f}=this,g=f+i;let w=Math.atan2(e,Math.abs(g))*Math.sign(g);g*o<0&&(w-=Math.PI*Math.sign(e)*Math.sign(g));const C=lr(this.center[0])*o;w=oi(w,-Math.PI-C,Math.PI-C);const O=at(ei(w/o)+this.center[0],-180,180),j=Math.asin(at((h-(e*e+g*g)*o*o)/(2*o),-1,1)),W=at(ei(j),-85.051129,wi);return new He(O,W)}}const Ke=1.340264,Tt=-.081106,St=893e-6,Mt=.003796,Nt=Math.sqrt(3)/2;class Rt extends Ae{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const o=Math.asin(Nt*Math.sin(i)),h=o*o,f=h*h*h;return{x:.5*(e*Math.cos(o)/(Nt*(Ke+3*Tt*h+f*(7*St+9*Mt*h)))/Math.PI+.5),y:1-.5*(o*(Ke+Tt*h+f*(St+Mt*h))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,h=o*o,f=h*h*h;for(let j,W,K,oe=0;oe<12&&(W=o*(Ke+Tt*h+f*(St+Mt*h))-i,K=Ke+3*Tt*h+f*(7*St+9*Mt*h),j=W/K,o=at(o-j,-Math.PI/3,Math.PI/3),h=o*o,f=h*h*h,!(Math.abs(j)<1e-12));++oe);const g=Nt*e*(Ke+3*Tt*h+f*(7*St+9*Mt*h))/Math.cos(o),w=Math.asin(Math.sin(o)/Nt),C=at(180*g/Math.PI,-180,180),O=at(180*w/Math.PI,-85.051129,wi);return new He(C,O)}}class $t extends Ae{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const o=360*(e-.5),h=at(360*(.5-i),-85.051129,wi);return new He(o,h)}}const Ti=Math.PI/2;function hi(s){return Math.tan((Ti+s)/2)}class Ei extends Ae{constructor(e){super(e),this.center=e.center||[0,30];const[i,o]=this.parallels=e.parallels||[30,30];let h=lr(i),f=lr(o);this.southernCenter=h+f<0,this.southernCenter&&(h=-h,f=-f);const g=Math.cos(h),w=hi(h);this.n=h===f?Math.sin(h):Math.log(g/Math.cos(f))/Math.log(hi(f)/w),this.f=g*Math.pow(hi(h),this.n)/this.n}project(e,i){i=lr(i),this.southernCenter&&(i=-i),e=lr(e-this.center[0]);const o=1e-6,{n:h,f}=this;f>0?i<-Ti+o&&(i=-Ti+o):i>Ti-o&&(i=Ti-o);const g=f/Math.pow(hi(i),h);let w=g*Math.sin(h*e),C=f-g*Math.cos(h*e);return w=.5*(w/Math.PI+.5),C=.5*(C/Math.PI+.5),{x:w,y:this.southernCenter?C:1-C,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:o,f:h}=this,f=h-i,g=Math.sign(f),w=Math.sign(o)*Math.sqrt(e*e+f*f);let C=Math.atan2(e,Math.abs(f))*g;f*o<0&&(C-=Math.PI*Math.sign(e)*g);const O=at(ei(C/o)+this.center[0],-180,180),j=at(ei(2*Math.atan(Math.pow(h/w,1/o))-Ti),-85.051129,wi);return new He(O,this.southernCenter?-j:j)}}class Ji extends Ae{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:xt(e),y:pt(i),z:0}}unproject(e,i){const o=Ct(e),h=ti(i);return new He(o,h)}}const er=lr(wi);class Is extends Ae{project(e,i){const o=(i=lr(i))*i,h=o*o;return{x:.5*((e=lr(e))*(.8707-.131979*o+h*(h*(.003971*o-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+o*(.015085+h*(.028874*o-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,h=25,f=0,g=o*o;do{g=o*o;const O=g*g;f=(o*(1.007226+g*(.015085+O*(.028874*g-.044475-.005916*O)))-i)/(1.007226+g*(.045255+O*(.259866*g-.311325-.005916*11*O))),o=at(o-f,-er,er)}while(Math.abs(f)>1e-6&&--h>0);g=o*o;const w=at(ei(e/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),C=ei(o);return new He(w,C)}}const Hs=lr(wi);class qs extends Ae{project(e,i){i=lr(i),e=lr(e);const o=Math.cos(i),h=2/Math.PI,f=Math.acos(o*Math.cos(e/2)),g=Math.sin(f)/f,w=.5*(e*h+2*o*Math.sin(e/2)/g)||0,C=.5*(i+Math.sin(i)/g)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(C/Math.PI+1),z:0}}unproject(e,i){let o=e=(2*e-.5)*Math.PI,h=i=(2*(1-i)-1)*Math.PI,f=25;const g=1e-6;let w=0,C=0;do{const O=Math.cos(h),j=Math.sin(h),W=2*j*O,K=j*j,oe=O*O,ue=Math.cos(o/2),be=Math.sin(o/2),ke=2*ue*be,Fe=be*be,Qe=1-oe*ue*ue,it=Qe?1/Qe:0,Se=Qe?Math.acos(O*ue)*Math.sqrt(1/Qe):0,Xe=.5*(2*Se*O*be+2*o/Math.PI)-e,st=.5*(Se*j+h)-i,dt=.5*it*(oe*Fe+Se*O*ue*K)+1/Math.PI,Ot=it*(ke*W/4-Se*j*be),Pt=.125*it*(W*be-Se*j*oe*ke),Dt=.5*it*(K*ue+Se*Fe*O)+.5,Jt=Ot*Pt-Dt*dt;w=(st*Ot-Xe*Dt)/Jt,C=(Xe*Pt-st*dt)/Jt,o=at(o-w,-Math.PI,Math.PI),h=at(h-C,-Hs,Hs)}while((Math.abs(w)>g||Math.abs(C)>g)&&--f>0);return new He(ei(o),ei(h))}}class dr extends Ae{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(lr(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:o,cosPhi:h}=this;return{x:lr(e)*h*o+.5,y:-Math.sin(lr(i))/h*o+.5,z:0}}unproject(e,i){const{scale:o,cosPhi:h}=this,f=-(i-.5)/o,g=at(ei((e-.5)/o)/h,-180,180),w=Math.asin(at(f*h,-1,1)),C=at(ei(w),-85.051129,wi);return new He(g,C)}}class xr extends Ji{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,o){const h=zg(e,i,o);return mo(h,h,Bg(Ip(o))),{x:h[0],y:h[1],z:h[2]}}locationPoint(e,i,o){const h=Me(i.lat,i.lng),f=Lo([],h),g=o?e._centerAltitude+o:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;Kn(h,h,f,At(1,0)*ns*g);const w=hs(new Float64Array(16));return ar(w,e.pixelMatrix,e.globeMatrix),mo(h,h,w),new Wi(h[0],h[1])}pixelsPerMeter(e,i){return At(1,0)*i}pixelSpaceConversion(e,i,o){const h=At(1,e)*i,f=js(At(1,45)*i,h,o);return this.pixelsPerMeter(e,i)/f}createTileMatrix(e,i,o){const h=Fg(Ip(o.canonical));return ar(new Float64Array(16),e.globeMatrix,h)}createInversionMatrix(e,i){const{center:o}=e,h=Bg(Ip(i));return fr(h,h,lr(o.lng)),ir(h,h,lr(o.lat)),Or(h,h,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(e,i,o,h){return bx(e,i,o,!0)||new Ft(0,0)}pointCoordinate3D(e,i,o){const h=this.pointCoordinate(e,i,o,0);return[h.x,h.y,h.z]}isPointAboveHorizon(e,i){return!bx(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(h,f){const g=h.cameraToCenterDistance,w=h._centerAltitude*f,C=h._camera,O=h._camera.forward(),j=on([],gr([],O,-g),[0,0,w]),W=h.worldSize/(2*Math.PI),K=[0,0,-W],oe=h.width/h.height,ue=Math.tan(h.fovAboveCenter),be=gr([],C.up(),ue),ke=gr([],C.right(),ue*oe),Fe=Lo([],on([],on([],O,be),ke)),Qe=[];let it;if(new hn(j,Fe).closestPointOnSphere(K,W,Qe)){const Se=on([],Qe,K),Xe=Qs([],Se,j);it=Math.cos(h.fovAboveCenter)*No(Xe)}else{const Se=Qs([],j,K),Xe=Qs([],K,j);Lo(Xe,Xe);const st=No(Se)-W;it=Math.sqrt(st*(st+2*W));const dt=Math.acos(it/(W+st))-Math.acos(Zo(O,Xe));it*=Math.cos(dt)}return 1.01*it}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=Lp(e.zoom);if(o>0){const h=ae(e,At(1,e.center.lat)*e.worldSize),f=e.worldSize/(2*Math.PI),g=Math.max(e.width,e.height)/e.worldSize*Math.PI;return js(i,h+f*(1-Math.cos(g)),Math.pow(o,10))}return i}upVector(e,i,o){return zg(i,o,e,1)}upVectorScale(e){return{metersToTile:gg(Rg(Ip(e)))}}}function wr(s){const e=s.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(s.name){case"mercator":return new Ji(s);case"equirectangular":return new $t(s);case"naturalEarth":return new Is(s);case"equalEarth":return new Rt(s);case"winkelTripel":return new qs(s);case"albers":return i?new dr(s):new Ve(s);case"lambertConformalConic":return i?new dr(s):new Ei(s);case"globe":return new xr(s)}throw new Error(`Invalid projection name: ${s.name}`)}const io=br.VectorTileFeature.types,sl=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Wo(s,e,i,o,h,f,g,w,C,O,j,W,K){const oe=w?Math.min(R,Math.round(w[0])):0,ue=w?Math.min(R,Math.round(w[1])):0;s.emplaceBack(e,i,Math.round(32*o),Math.round(32*h),f,g,(oe<<1)+(C?1:0),ue,16*O,16*j,256*W,256*K)}function qo(s,e,i){s.emplaceBack(e,i)}function ko(s,e,i,o,h,f,g){s.emplaceBack(e,i,o,h,f,g)}const no=(s,e,i,o)=>{for(let h=0;h<e;h++)s.emplaceBack(i[0],i[1],i[2],o[0],o[1],o[2])};function $a(s,e,i,o,h){s.emplaceBack(e,i,o,h),s.emplaceBack(e,i,o,h),s.emplaceBack(e,i,o,h),s.emplaceBack(e,i,o,h)}function Fa(s){for(const e of s.sections)if(rr(e.text))return!0;return!1}class ul{constructor(e){this.layoutVertexArray=new Ap,this.indexArray=new ml,this.programConfigurations=e,this.segments=new sa,this.dynamicLayoutVertexArray=new wn,this.opacityVertexArray=new Mf,this.placedSymbolArray=new pd,this.iconTransitioningVertexArray=new wc,this.globeExtVertexArray=new zd,this.zOffsetVertexArray=new Sp,this.orientationVertexArray=new Qp}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,o,h,f){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,R0.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,F0.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,sl,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,o0.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,B0.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||f)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Ay.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,Ux.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}qe(ul,"SymbolBuffers");class Zc{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new sa,this.collisionVertexArray=new du,this.collisionVertexArrayExt=new wn}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,N0.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,n0.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}qe(Zc,"CollisionBuffers");class Sm{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=hs([]),this.placementViewportMatrix=hs([]);const i=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=X(this.zoom,i["text-size"],this.worldview),this.iconSizeData=X(this.zoom,i["icon-size"],this.worldview);const o=this.layers[0].layout,h=o.get("symbol-sort-key"),f=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(g=>kl[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new ul(new c(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new ul(new c(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new ap,this.lineVertexArray=new Ef,this.symbolInstances=new np}calculateGlyphDependencies(e,i,o,h,f){for(const g of e){const w=g.codePointAt(0);if(w===void 0)break;if(i[w]=!0,h&&f&&w<=65535){const C=Ag[g];C&&(i[C.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!qg(this.activeReplacements,o)&&(this.activeReplacements=o,!0)}populate(e,i,o,h){const f=this.layers[0],g=f.layout,w=this.projection.name==="globe",C=g.get("text-font"),O=g.get("text-field"),j=g.get("icon-image"),[W,K]=g.get("icon-size-scale-range"),oe=at(i.scaleFactor||1,W,K),ue=(O.value.kind!=="constant"||O.value.value instanceof Wa&&!O.value.value.isEmpty()||O.value.value.toString().length>0)&&(C.value.kind!=="constant"||C.value.value.length>0),be=j.value.kind!=="constant"||!!j.value.value||Object.keys(j.parameters).length>0,ke=g.get("symbol-sort-key");if(this.features=[],!ue&&!be)return;const Fe=i.iconDependencies,Qe=i.glyphDependencies,it=i.availableImages,Se=new qr(this.zoom,{worldview:this.worldview});for(const{feature:Xe,id:st,index:dt,sourceLayerIndex:Ot}of e){const Pt=f._featureFilter.needGeometry,Dt=us(Xe,Pt);if(!f._featureFilter.filter(Se,Dt,o))continue;if(Pt||(Dt.geometry=Ts(Xe,o,h)),w&&Xe.type!==1&&o.z<=5){const Hi=Dt.geometry,Ki=.98078528056,bi=(Gi,mi)=>Zo(zg(Gi.x,Gi.y,o,1),zg(mi.x,mi.y,o,1))<Ki;for(let Gi=0;Gi<Hi.length;Gi++)Hi[Gi]=Yi(Hi[Gi],bi)}let Jt,yi;if(ue){const Hi=f.getValueAndResolveTokens("text-field",Dt,o,it),Ki=Wa.factory(Hi);Fa(Ki)&&(this.hasRTLText=!0),(!this.hasRTLText||ta()==="unavailable"||this.hasRTLText&&mn.isParsed())&&(Jt=l0(Ki,f,Dt))}if(be){const Hi=f.getValueAndResolveTokens("icon-image",Dt,o,it);yi=typeof Hi=="string"?cl.build(Hi):Hi}if(!Jt&&!yi)continue;const $i=this.sortFeaturesByKey?ke.evaluate(Dt,{},o):void 0,Ii={id:st,text:Jt,icon:yi,index:dt,sourceLayerIndex:Ot,geometry:Dt.geometry,properties:Xe.properties,type:io[Xe.type],sortKey:$i};if(this.features.push(Ii),yi){const Hi=this.layers[0]._unevaluatedLayout._values,{iconPrimary:Ki,iconSecondary:bi}=Fp(yi,this.iconSizeData,Hi["icon-size"],o,this.zoom,Ii,this.pixelRatio,oe,this.worldview),Gi=Ki.id.toString();if(Fe.has(Gi)?Fe.get(Gi).push(Ki):Fe.set(Gi,[Ki]),bi){const mi=bi.id.toString();Fe.has(mi)?Fe.get(mi).push(bi):Fe.set(mi,[bi])}}if(Jt){const Hi=C.evaluate(Dt,{},o).join(","),Ki=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(kl.vertical)>=0;for(const bi of Jt.sections)if(bi.image){const Gi=bi.image.getPrimary().scaleSelf(this.pixelRatio),mi=Gi.id.toString(),xi=Fe.get(mi)||[];xi.push(Gi),Fe.set(mi,xi)}else{const Gi=ji(Jt.toString()),mi=bi.fontStack||Hi,xi=Qe[mi]=Qe[mi]||{};this.calculateGlyphDependencies(bi.text,xi,Ki,this.allowVerticalPlacement,Gi)}}}if(g.get("symbol-placement")==="line"&&(this.features=function(Xe){const st={},dt={},Ot=[];let Pt=0;function Dt(Ii){Ot.push(Xe[Ii]),Pt++}function Jt(Ii,Hi,Ki){const bi=dt[Ii];return delete dt[Ii],dt[Hi]=bi,Ot[bi].geometry[0].pop(),Ot[bi].geometry[0]=Ot[bi].geometry[0].concat(Ki[0]),bi}function yi(Ii,Hi,Ki){const bi=st[Hi];return delete st[Hi],st[Ii]=bi,Ot[bi].geometry[0].shift(),Ot[bi].geometry[0]=Ki[0].concat(Ot[bi].geometry[0]),bi}function $i(Ii,Hi,Ki){const bi=Ki?Hi[0][Hi[0].length-1]:Hi[0][0];return`${Ii}:${bi.x}:${bi.y}`}for(let Ii=0;Ii<Xe.length;Ii++){const Hi=Xe[Ii],Ki=Hi.geometry,bi=Hi.text?Hi.text.toString():null;if(!bi){Dt(Ii);continue}const Gi=$i(bi,Ki),mi=$i(bi,Ki,!0);if(Gi in dt&&mi in st&&dt[Gi]!==st[mi]){const xi=yi(Gi,mi,Ki),ss=Jt(Gi,mi,Ot[xi].geometry);delete st[Gi],delete dt[mi],dt[$i(bi,Ot[ss].geometry,!0)]=ss,Ot[xi].geometry=null}else Gi in dt?Jt(Gi,mi,Ki):mi in st?yi(Gi,mi,Ki):(Dt(Ii),st[Gi]=Pt-1,dt[mi]=Pt-1)}return Ot.filter(Ii=>Ii.geometry)}(this.features)),g.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Xe of i.elevationFeatures)this.elevationFeatureIdToIndex.set(Xe.id,this.elevationFeatures.length),this.elevationFeatures.push(Xe)}}else g.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Xe,st)=>Xe.sortKey-st.sortKey)}update(e,i,o,h,f,g,w){this.text.programConfigurations.updatePaintArrays(e,i,f,o,h,g,w,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,i,f,o,h,g,w,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1;const o=ui(e),h=1/o;let f=!1,g=!1;for(let w=0;w<this.symbolInstances.length;w++){const C=this.symbolInstances.get(w),O=pi(1,0,0),j=pi(0,1,0),{numHorizontalGlyphVertices:W,numVerticalGlyphVertices:K,numIconVertices:oe,numVerticalIconVertices:ue}=C,be=W>0||K>0,ke=oe>0,Fe=this.elevationFeatures[C.elevationFeatureIndex];if(Fe){const Qe=new Wi(C.tileAnchorX,C.tileAnchorY),it=.075+Fe.pointElevation(Qe);C.zOffset!==it&&(i=!0,C.zOffset=it);const Se=Fe.computeSlopeNormal(Qe,h),Xe=mh(nl(),pi(0,0,1),Se);Sh(O,O,Xe),Sh(j,j,Xe),O[2]*=o,j[2]*=o,O[0]===1&&O[1]===0&&O[2]===0&&j[0]===0&&j[1]===1&&j[2]===0||(f=f||be,g=g||ke)}if(be&&(no(this.text.orientationVertexArray,W,O,j),no(this.text.orientationVertexArray,K,O,j)),ke){const{placedIconSymbolIndex:Qe,verticalPlacedIconSymbolIndex:it}=C;Qe>=0&&no(this.icon.orientationVertexArray,oe,O,j),it>=0&&no(this.icon.orientationVertexArray,ue,O,j)}}f||(this.text.orientationVertexArray=void 0),g||(this.icon.orientationVertexArray=void 0),i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(f,g,w)=>{o+=g,o>f.length&&f.resize(o);for(let C=-g;C<0;C++)f.emplace(C+o,w)},i=(f,g,w)=>{h+=g,h>f.length&&f.resize(h);for(let C=-g;C<0;C++)f.emplace(C+h,w)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let o=0,h=0;for(let f=0;f<this.symbolInstances.length;f++){const g=this.symbolInstances.get(f),{numHorizontalGlyphVertices:w,numVerticalGlyphVertices:C,numIconVertices:O}=g,j=g.zOffset,W=O>0;if((w>0||C>0)&&(e(this.text.zOffsetVertexArray,w,j),e(this.text.zOffsetVertexArray,C,j)),W){const{placedIconSymbolIndex:K,verticalPlacedIconSymbolIndex:oe}=g;K>=0&&i(this.icon.zOffsetVertexArray,O,j),oe>=0&&i(this.icon.zOffsetVertexArray,g.numVerticalIconVertices,j)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=wr(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const o=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:h,y:f}of i)this.lineVertexArray.emplaceBack(h,f);return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,h,f,g,w,C,O,j,W,K,oe,ue,be,ke){const Fe=e.indexArray,Qe=e.layoutVertexArray,it=e.globeExtVertexArray,Se=e.segments.prepareSegment(4*i.length,Qe,Fe,this.canOverlap?g.sortKey:void 0),Xe=this.glyphOffsetArray.length,st=Se.vertexLength,dt=this.allowVerticalPlacement&&w===kl.vertical?Math.PI/2:0,Ot=g.text&&g.text.sections;for(let Dt=0;Dt<i.length;Dt++){const{tl:Jt,tr:yi,bl:$i,br:Ii,texPrimary:Hi,texSecondary:Ki,pixelOffsetTL:bi,pixelOffsetBR:Gi,minFontScaleX:mi,minFontScaleY:xi,glyphOffset:ss,isSDF:rs,sectionIndex:tr}=i[Dt],Vs=Se.vertexLength,gs=ss[1];if(Wo(Qe,O.x,O.y,Jt.x,gs+Jt.y,Hi.x,Hi.y,o,rs,bi.x,bi.y,mi,xi),Wo(Qe,O.x,O.y,yi.x,gs+yi.y,Hi.x+Hi.w,Hi.y,o,rs,Gi.x,bi.y,mi,xi),Wo(Qe,O.x,O.y,$i.x,gs+$i.y,Hi.x,Hi.y+Hi.h,o,rs,bi.x,Gi.y,mi,xi),Wo(Qe,O.x,O.y,Ii.x,gs+Ii.y,Hi.x+Hi.w,Hi.y+Hi.h,o,rs,Gi.x,Gi.y,mi,xi),C){const{x:ts,y:Br,z:Bs}=C.anchor,[Us,Mr,$r]=C.up;ko(it,ts,Br,Bs,Us,Mr,$r),ko(it,ts,Br,Bs,Us,Mr,$r),ko(it,ts,Br,Bs,Us,Mr,$r),ko(it,ts,Br,Bs,Us,Mr,$r),$a(e.dynamicLayoutVertexArray,ts,Br,Bs,dt)}else $a(e.dynamicLayoutVertexArray,O.x,O.y,O.z,dt);if(ke){const ts=Ki||Hi;qo(e.iconTransitioningVertexArray,ts.x,ts.y),qo(e.iconTransitioningVertexArray,ts.x+ts.w,ts.y),qo(e.iconTransitioningVertexArray,ts.x,ts.y+ts.h),qo(e.iconTransitioningVertexArray,ts.x+ts.w,ts.y+ts.h)}Fe.emplaceBack(Vs,Vs+1,Vs+2),Fe.emplaceBack(Vs+1,Vs+2,Vs+3),Se.vertexLength+=4,Se.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ss[0]),Dt!==i.length-1&&tr===i[Dt+1].sectionIndex||e.programConfigurations.populatePaintArrays(Qe.length,g,g.index,{},oe,ue,be,Ot&&Ot[tr],this.worldview)}const Pt=C?C.anchor:O;e.placedSymbolArray.emplaceBack(Pt.x,Pt.y,Pt.z,O.x,O.y,Xe,this.glyphOffsetArray.length-Xe,st,j,W,O.segment,o?o[0]:0,o?o[1]:0,h[0],h[1],w,0,0,0,K,0)}_commitLayoutVertex(e,i,o,h,f,g,w){e.emplaceBack(i,o,h,f,g,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(e,i,o,h,f,g,w){const C=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),O=C.vertexLength,j=w.tileAnchorX,W=w.tileAnchorY;for(let oe=0;oe<4;oe++)o.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(o.collisionVertexArrayExt,i,e.padding,w.zOffset),this._commitLayoutVertex(o.layoutVertexArray,h,f,g,j,W,new Wi(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,h,f,g,j,W,new Wi(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,h,f,g,j,W,new Wi(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,h,f,g,j,W,new Wi(e.x1,e.y2)),C.vertexLength+=4;const K=o.indexArray;K.emplaceBack(O,O+1),K.emplaceBack(O+1,O+2),K.emplaceBack(O+2,O+3),K.emplaceBack(O+3,O),C.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,o,h,f,g){for(let w=h;w<f;w++){const C=o.get(w),O=this.getSymbolInstanceTextSize(e,g,i,w);this._addCollisionDebugVertices(C,O,this.textCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(e,i,o,h,f,g){for(let w=h;w<f;w++){const C=o.get(w),O=this.getSymbolInstanceIconSize(e,i,g.placedIconSymbolIndex);this._addCollisionDebugVertices(C,O,this.iconCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,g)}}generateCollisionDebugBuffers(e,i,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Zc(dg,ey.members,wc),this.iconCollisionBox=new Zc(dg,ey.members,wc);const h=te(this.iconSizeData,e),f=te(this.textSizeData,e,o);for(let g=0;g<this.symbolInstances.length;g++){const w=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(f,e,i,w.textBoxStartIndex,w.textBoxEndIndex,w),this._addTextDebugCollisionBoxes(f,e,i,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w),this._addIconDebugCollisionBoxes(h,e,i,w.iconBoxStartIndex,w.iconBoxEndIndex,w),this._addIconDebugCollisionBoxes(h,e,i,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w)}}getSymbolInstanceTextSize(e,i,o,h){const f=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:h),g=re(this.textSizeData,e,f)/wh;return this.tilePixelRatio*g}getSymbolInstanceIconSize(e,i,o){const h=this.icon.placedSymbolArray.get(o),f=re(this.iconSizeData,e,h);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,i,o,h){e.emplaceBack(i,-o,-o,h),e.emplaceBack(i,o,-o,h),e.emplaceBack(i,o,o,h),e.emplaceBack(i,-o,o,h)}_updateTextDebugCollisionBoxes(e,i,o,h,f,g,w){for(let C=h;C<f;C++){const O=o.get(C),j=this.getSymbolInstanceTextSize(e,g,i,C);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,j,O.padding,g.zOffset)}}_updateIconDebugCollisionBoxes(e,i,o,h,f,g,w){for(let C=h;C<f;C++){const O=o.get(C),j=this.getSymbolInstanceIconSize(e,i,g.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,j,O.padding,g.zOffset)}}updateCollisionDebugBuffers(e,i,o,h){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const f=te(this.iconSizeData,e,h),g=te(this.textSizeData,e,o);for(let w=0;w<this.symbolInstances.length;w++){const C=this.symbolInstances.get(w);this._updateTextDebugCollisionBoxes(g,e,i,C.textBoxStartIndex,C.textBoxEndIndex,C,o),this._updateTextDebugCollisionBoxes(g,e,i,C.verticalTextBoxStartIndex,C.verticalTextBoxEndIndex,C,o),this._updateIconDebugCollisionBoxes(f,e,i,C.iconBoxStartIndex,C.iconBoxEndIndex,C,h),this._updateIconDebugCollisionBoxes(f,e,i,C.verticalIconBoxStartIndex,C.verticalIconBoxEndIndex,C,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,o,h,f,g,w,C,O){const j={};if(i<o){const{x1:W,y1:K,x2:oe,y2:ue,padding:be,projectedAnchorX:ke,projectedAnchorY:Fe,projectedAnchorZ:Qe,tileAnchorX:it,tileAnchorY:Se,featureIndex:Xe}=e.get(i);j.textBox={x1:W,y1:K,x2:oe,y2:ue,padding:be,projectedAnchorX:ke,projectedAnchorY:Fe,projectedAnchorZ:Qe,tileAnchorX:it,tileAnchorY:Se},j.textFeatureIndex=Xe}if(h<f){const{x1:W,y1:K,x2:oe,y2:ue,padding:be,projectedAnchorX:ke,projectedAnchorY:Fe,projectedAnchorZ:Qe,tileAnchorX:it,tileAnchorY:Se,featureIndex:Xe}=e.get(h);j.verticalTextBox={x1:W,y1:K,x2:oe,y2:ue,padding:be,projectedAnchorX:ke,projectedAnchorY:Fe,projectedAnchorZ:Qe,tileAnchorX:it,tileAnchorY:Se},j.verticalTextFeatureIndex=Xe}if(g<w){const{x1:W,y1:K,x2:oe,y2:ue,padding:be,projectedAnchorX:ke,projectedAnchorY:Fe,projectedAnchorZ:Qe,tileAnchorX:it,tileAnchorY:Se,featureIndex:Xe}=e.get(g);j.iconBox={x1:W,y1:K,x2:oe,y2:ue,padding:be,projectedAnchorX:ke,projectedAnchorY:Fe,projectedAnchorZ:Qe,tileAnchorX:it,tileAnchorY:Se},j.iconFeatureIndex=Xe}if(C<O){const{x1:W,y1:K,x2:oe,y2:ue,padding:be,projectedAnchorX:ke,projectedAnchorY:Fe,projectedAnchorZ:Qe,tileAnchorX:it,tileAnchorY:Se,featureIndex:Xe}=e.get(C);j.verticalIconBox={x1:W,y1:K,x2:oe,y2:ue,padding:be,projectedAnchorX:ke,projectedAnchorY:Fe,projectedAnchorZ:Qe,tileAnchorX:it,tileAnchorY:Se},j.verticalIconFeatureIndex=Xe}return j}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const o=e.placedSymbolArray.get(i),h=o.vertexStartIndex+4*o.numGlyphs;for(let f=o.vertexStartIndex;f<h;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),o=Math.cos(e),h=[],f=[],g=[];for(let w=0;w<this.symbolInstances.length;++w){g.push(w);const C=this.symbolInstances.get(w);h.push(0|Math.round(i*C.tileAnchorX+o*C.tileAnchorY)),f.push(C.featureIndex)}return g.sort((w,C)=>h[w]-h[C]||f[C]-f[w]),g}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:C,verticalPlacedIconSymbolIndex:O}=o;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),f>=0&&f!==h&&this.addIndicesForPlacedSymbol(this.text,f),g>=0&&g!==f&&g!==h&&this.addIndicesForPlacedSymbol(this.text,g),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),C>=0&&this.addIndicesForPlacedSymbol(this.icon,C),O>=0&&this.addIndicesForPlacedSymbol(this.icon,O)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Uf,vu,bd;qe(Sm,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Sm.addDynamicAttributes=$a;class nh{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:qd,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}qe(nh,"FormatSectionOverride",{omit:["defaultValue"]});const ax=()=>bd||(bd={layout:Uf||(Uf=new kn({"symbol-placement":new Oi(Zt.layout_symbol["symbol-placement"]),"symbol-spacing":new Oi(Zt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Oi(Zt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ms(Zt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Oi(Zt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Oi(Zt.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Oi(Zt.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Oi(Zt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Oi(Zt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Oi(Zt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Oi(Zt.layout_symbol["icon-rotation-alignment"]),"icon-size":new ms(Zt.layout_symbol["icon-size"]),"icon-size-scale-range":new Oi(Zt.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new ms(Zt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ms(Zt.layout_symbol["icon-text-fit-padding"]),"icon-image":new ms(Zt.layout_symbol["icon-image"]),"icon-rotate":new ms(Zt.layout_symbol["icon-rotate"]),"icon-padding":new Oi(Zt.layout_symbol["icon-padding"]),"icon-keep-upright":new Oi(Zt.layout_symbol["icon-keep-upright"]),"icon-offset":new ms(Zt.layout_symbol["icon-offset"]),"icon-anchor":new ms(Zt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Oi(Zt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Oi(Zt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Oi(Zt.layout_symbol["text-rotation-alignment"]),"text-field":new ms(Zt.layout_symbol["text-field"]),"text-font":new ms(Zt.layout_symbol["text-font"]),"text-size":new ms(Zt.layout_symbol["text-size"]),"text-size-scale-range":new Oi(Zt.layout_symbol["text-size-scale-range"]),"text-max-width":new ms(Zt.layout_symbol["text-max-width"]),"text-line-height":new ms(Zt.layout_symbol["text-line-height"]),"text-letter-spacing":new ms(Zt.layout_symbol["text-letter-spacing"]),"text-justify":new ms(Zt.layout_symbol["text-justify"]),"text-radial-offset":new ms(Zt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Oi(Zt.layout_symbol["text-variable-anchor"]),"text-anchor":new ms(Zt.layout_symbol["text-anchor"]),"text-max-angle":new Oi(Zt.layout_symbol["text-max-angle"]),"text-writing-mode":new Oi(Zt.layout_symbol["text-writing-mode"]),"text-rotate":new ms(Zt.layout_symbol["text-rotate"]),"text-padding":new Oi(Zt.layout_symbol["text-padding"]),"text-keep-upright":new Oi(Zt.layout_symbol["text-keep-upright"]),"text-transform":new ms(Zt.layout_symbol["text-transform"]),"text-offset":new ms(Zt.layout_symbol["text-offset"]),"text-allow-overlap":new Oi(Zt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Oi(Zt.layout_symbol["text-ignore-placement"]),"text-optional":new Oi(Zt.layout_symbol["text-optional"]),visibility:new Oi(Zt.layout_symbol.visibility)})),paint:vu||(vu=new kn({"icon-opacity":new ms(Zt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new ms(Zt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new ms(Zt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new ms(Zt.paint_symbol["text-emissive-strength"]),"icon-color":new ms(Zt.paint_symbol["icon-color"]),"icon-halo-color":new ms(Zt.paint_symbol["icon-halo-color"]),"icon-halo-width":new ms(Zt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ms(Zt.paint_symbol["icon-halo-blur"]),"icon-translate":new Oi(Zt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Oi(Zt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Oi(Zt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new ms(Zt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new ms(Zt.paint_symbol["text-occlusion-opacity"]),"text-color":new ms(Zt.paint_symbol["text-color"],{runtimeType:Jl,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new ms(Zt.paint_symbol["text-halo-color"]),"text-halo-width":new ms(Zt.paint_symbol["text-halo-width"]),"text-halo-blur":new ms(Zt.paint_symbol["text-halo-blur"]),"text-translate":new Oi(Zt.paint_symbol["text-translate"]),"text-translate-anchor":new Oi(Zt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Oi(Zt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Oi(Zt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Oi(Zt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Oi(Zt.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new ms(Zt.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new ms({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new ms({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new ms({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new ms({type:"string",default:"default","property-type":"data-driven"})}))},bd);class Km extends th{constructor(e,i,o,h){super(e,ax(),i,o,h),this._colorAdjustmentMatrix=hs([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const o=this.layout.get("text-writing-mode");if(o){const h=[];for(const f of o)h.indexOf(f)<0&&h.push(f);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,o,h){return this._saturation===e&&this._contrast===i&&this._brightnessMin===o&&this._brightnessMax===h||(this._colorAdjustmentMatrix=function(f,g,w,C){f=Il(f),g=an(g);const O=zs(),j=f/3,W=1-2*j,K=[W,j,j,0,j,W,j,0,j,j,W,0,0,0,0,1],oe=.5-.5*g,ue=C-w;return ar(O,[ue,0,0,0,0,ue,0,0,0,0,ue,0,w,w,w,1],[g,0,0,0,0,g,0,0,0,0,g,0,oe,oe,oe,1]),ar(O,O,K),O}(e,i,o,h),this._saturation=e,this._contrast=i,this._brightnessMin=o,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,o,h){const f=this.layout.get(e).evaluate(i,{},o,h),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||Ge(g.value)||!f?f:function(w,C){return C.replace(/{([^{}]+)}/g,(O,j)=>j in w?String(w[j]):"")}(i.properties,f)}createBucket(e){return new Sm(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of ax().paint.overridableProperties){if(!Km.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),o=new nh(i),h=new wp(o,i.property.specification,this.scope,this.options);let f=null;f=i.value.kind==="constant"||i.value.kind==="source"?new ge("source",h):new xe("composite",h,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new wf(i.property,f,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&Km.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const o=e.get("text-field"),h=ax().paint.properties[i];let f=!1;const g=w=>{for(const C of w)if(h.overrides&&h.overrides.hasOverride(C))return void(f=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Wa)g(o.value.value.sections);else if(o.value.kind==="source"){const w=O=>{f||(O instanceof hr&&cs(O.value)===Ph?g(O.value.sections):O instanceof ec?g(O.sections):O.eachChild(w))},C=o.value;C._styleExpression&&w(C._styleExpression.expression)}return f}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,o){return{config:new sf(this,{zoom:i,lut:o}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let Dy,$x,Mm,lx;var d0=bo([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Jv(s){switch(s){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Qv(s){switch(s){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class eb{constructor(e,i,o,h){this.context=e,this.format=o,this.useMipmap=h&&h.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:h&&h.premultiply})}update(e,i){const o=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,h=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:f}=this,{gl:g}=f,{x:w,y:C}=i&&i.position?i.position:{x:0,y:0},O=w+o,j=C+h;!this.size||this.size[0]===O&&this.size[1]===j||(g.bindTexture(g.TEXTURE_2D,null),g.deleteTexture(this.texture),this.texture=g.createTexture(),this.size=null),g.bindTexture(g.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA8&&(!i||i.premultiply!==!1));const W=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&O>0&&j>0){const K=this.useMipmap?Math.floor(Math.log2(Math.max(O,j)))+1:1;g.texStorage2D(g.TEXTURE_2D,K,this.format,O,j),this.size=[O,j]}if(this.size)if(W)g.texSubImage2D(g.TEXTURE_2D,0,w,C,Jv(this.format),Qv(this.format),e);else{const K=e.data;K&&g.texSubImage2D(g.TEXTURE_2D,0,w,C,o,h,Jv(this.format),Qv(this.format),K)}this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(e,i,o=!1){const{context:h}=this,{gl:f}=h;f.bindTexture(f.TEXTURE_2D,this.texture),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap&&!o?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,i),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,o,h,f){const{context:g}=this,{gl:w}=g;w.bindTexture(w.TEXTURE_2D,this.texture),i!==this.magFilter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,this.useMipmap?e===w.NEAREST?w.NEAREST_MIPMAP_NEAREST:w.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),o!==this.wrapS&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,o),this.wrapS=o),h!==this.wrapT&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,h),this.wrapT=h),f!==this.compareMode&&(f?(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_COMPARE_MODE,w.COMPARE_REF_TO_TEXTURE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_COMPARE_FUNC,f)):w.texParameteri(w.TEXTURE_2D,w.TEXTURE_COMPARE_MODE,w.NONE),this.compareMode=f)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class rv{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:o}=this,{gl:h}=o;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i),this.wrapS=i)}}function ov(s,e,i,o,h,f,g,w){const C=[s,e,1,i,o,1,h,f,1],O=[g,w,1],j=Qi([],C),[W,K,oe]=ql(O,O,j);return xs(C,C,[W,0,0,0,K,0,0,0,oe])}function Qb(s,e,i,o,h,f,g,w){const C=function(O,j,W,K,oe,ue,be,ke){const Fe=ov(0,0,1,0,1,1,0,1),Qe=ov(O,j,W,K,oe,ue,be,ke);return xs(Qe,Qe,Qi([],Fe))}(s,e,i,o,h,f,g,w);return[C[2]/C[8]/ns,C[5]/C[8]/ns]}function nv(s){return[s[0],Math.min(Math.max(s[1],-85.051129),wi)]}class e1 extends zc{constructor(e,i,o,h){super(),this.id=e,this.dispatcher=o,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new Ln("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=ed(this.map._requestManager.transformRequest(this.url,Dc.Image),(o,h)=>{this._imageRequest=null,this._loaded=!0,o?this.fire(new td(o)):h&&(this.image=h instanceof HTMLImageElement?$h.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new rv(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ln("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof rv||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],o=e[0][1];for(const f of e)f[1]>o&&(o=f[1]),f[1]<i&&(i=f[1]);const h=(o+i)/2;if(h>wi?this.onNorthPole=!0:h<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const f=e.map(Ft.fromLngLat);this.tileID=function(g){let w=1/0,C=1/0,O=-1/0,j=-1/0;for(const be of g)w=Math.min(w,be.x),C=Math.min(C,be.y),O=Math.max(O,be.x),j=Math.max(j,be.y);const W=Math.max(O-w,j-C),K=Math.max(0,Math.floor(-Math.log(W)/Math.LN2)),oe=Math.pow(2,K);let ue=Math.floor((w+O)/2*oe);return ue>1&&(ue-=1),new mm(K,ue,Math.floor((C+j)/2*oe))}(f),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ln("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const Fe in this.tiles){const Qe=this.tiles[Fe];Qe.state!=="loaded"&&(Qe.state="loaded",Qe.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=fe(new mm(0,0,0),this.map.transform.projection),o=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(Fe){const Qe=Fe[1].x-Fe[0].x,it=Fe[1].y-Fe[0].y,Se=Fe[2].x-Fe[1].x,Xe=Fe[2].y-Fe[1].y,st=Fe[3].x-Fe[2].x,dt=Fe[3].y-Fe[2].y,Ot=Fe[0].x-Fe[3].x,Pt=Fe[0].y-Fe[3].y,Dt=Qe*Xe-Se*it,Jt=Se*dt-st*Xe,yi=st*Pt-Ot*dt,$i=Ot*it-Qe*Pt;return Dt>0&&Jt>0&&yi>0&&$i>0||Dt<0&&Jt<0&&yi<0&&$i<0}(o))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=fe(this.tileID,this.map.transform.projection),[f,g,w,C]=this.coordinates.map(Fe=>{const Qe=h.projection.project(Fe[0],Fe[1]);return ve(h,Qe)._round()});this.perspectiveTransform=Qb(f.x,f.y,g.x,g.y,w.x,w.y,C.x,C.y);const O=this._boundsArray=new Sf;O.emplaceBack(f.x,f.y,0,0),O.emplaceBack(g.x,g.y,ns,0),O.emplaceBack(C.x,C.y,0,ns),O.emplaceBack(w.x,w.y,ns,ns),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(O,d0.members),this.boundsSegments=sa.simpleSegment(0,0,4,2);const j=[],W=[nv((K=this.coordinates)[0]),nv(K[1]),nv(K[2]),nv(K[3])];var K;const[oe,ue,be,ke]=function(Fe){let Qe=Fe[0][0],it=Qe,Se=Fe[0][1],Xe=Se;for(let st=1;st<Fe.length;st++)Fe[st][0]<Qe?Qe=Fe[st][0]:Fe[st][0]>it&&(it=Fe[st][0]),Fe[st][1]<Se?Se=Fe[st][1]:Fe[st][1]>Xe&&(Xe=Fe[st][1]);return[Qe,Se,it-Qe,Xe-Se]}(W);{const Fe=new Sf,[Qe,it,Se,Xe]=function(bi){let Gi=bi[0].x,mi=Gi,xi=bi[0].y,ss=xi;for(let rs=1;rs<bi.length;rs++)bi[rs].x<Gi?Gi=bi[rs].x:bi[rs].x>mi&&(mi=bi[rs].x),bi[rs].y<xi?xi=bi[rs].y:bi[rs].y>ss&&(ss=bi[rs].y);return[Gi,xi,mi-Gi,ss-xi]}(o),st=bi=>[(bi.x-Qe)/Se,(bi.y-it)/Xe],[dt,Ot,Pt,Dt]=o.map(st),Jt=function(bi,Gi,mi,xi,ss,rs,tr,Vs){const gs=ov(0,0,1,0,1,1,0,1);return xs(gs,gs,Qi([],ov(bi,Gi,mi,xi,ss,rs,tr,Vs)))}(dt[0],dt[1],Ot[0],Ot[1],Pt[0],Pt[1],Dt[0],Dt[1]);this.elevatedGlobePerspectiveTransform=Qb(dt[0],dt[1],Ot[0],Ot[1],Pt[0],Pt[1],Dt[0],Dt[1]);const yi=(bi,Gi)=>{j.push(bi.lng);const mi=Math.round((bi.lng-oe)/be*ns),xi=Math.round((bi.lat-ue)/ke*ns),ss=st(Gi),rs=ql([],[ss[0],ss[1],1],Jt),tr=Math.round(rs[0]/rs[2]*ns),Vs=Math.round(rs[1]/rs[2]*ns);Fe.emplaceBack(mi,xi,tr,Vs)},$i=o[3].x-o[0].x,Ii=o[3].y-o[0].y,Hi=o[2].x-o[1].x,Ki=o[2].y-o[1].y;for(let bi=0;bi<65;bi++){const Gi=bi/64,mi=[o[0].x+Gi*$i,o[0].y+Gi*Ii],xi=[o[1].x+Gi*Hi,o[1].y+Gi*Ki],ss=xi[0]-mi[0],rs=xi[1]-mi[1];for(let tr=0;tr<65;tr++){const Vs=tr/64,gs={x:mi[0]+ss*Vs,y:mi[1]+rs*Vs};yi(i.projection.unproject(gs.x,gs.y),gs)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(Fe,d0.members)}{this.maxLongitudeTriangleSize=0;let Fe=[],Qe=new ml;const it=(Se,Xe,st)=>{Qe.emplaceBack(Se,Xe,st);const dt=j[Se],Ot=j[Xe],Pt=j[st],Dt=Math.min(Math.min(dt,Ot),Pt),Jt=Math.max(Math.max(dt,Ot),Pt)-Dt;Jt>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Jt),Fe.push(Dt+Jt/2)};for(let Se=0;Se<64;Se++)for(let Xe=0;Xe<64;Xe++){const st=65*Se+Xe,dt=st+1,Ot=st+65,Pt=Ot+1;it(st,Ot,dt),it(dt,Ot,Pt)}[Fe,Qe]=function(Se,Xe){const st=Array.from({length:Se.length},(Pt,Dt)=>Dt);st.sort((Pt,Dt)=>Se[Pt]-Se[Dt]);const dt=[],Ot=new ml;for(let Pt=0;Pt<st.length;Pt++){const Dt=st[Pt];dt.push(Se[Dt]);const Jt=3*Dt,yi=Jt+1;Ot.emplaceBack(Xe.uint16[Jt],Xe.uint16[yi],Xe.uint16[yi+1])}return[dt,Ot]}(Fe,Qe),this.elevatedGlobeTrianglesCenterLongitudes=Fe,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(Qe)}this.elevatedGlobeSegments=sa.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,be/ns,0,ke/ns,0,0,ue,oe,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,o=i.gl;!this._dirty||this.texture instanceof rv||(this.texture?this.texture.update(this.image):(this.texture=new eb(i,this.image,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const o=this.elevatedGlobeTrianglesCenterLongitudes;let h=(f=e+180)+360*Math.round((o[0]-f)/360);var f;const g=new sa,w=(W,K)=>{g.segments.push({vertexOffset:0,primitiveOffset:W,vertexLength:i.segments[0].vertexLength,primitiveLength:K,sortKey:void 0,vaos:{}})},C=.51*this.maxLongitudeTriangleSize;if(Math.abs(o[0]-h)<=C){const W=Ka(o,0,o.length,h+C);return W===o.length||w(W,un(o,W+1,o.length,h+360-C)-W),g}h<o[0]&&(h+=360);const O=un(o,0,o.length,h-C);if(O===o.length)return w(0,o.length),g;w(0,O-0);const j=Ka(o,O+1,o.length,h+C);return j!==o.length&&w(j,o.length-j),g}}const fT=(Math.pow(256,2)-1)/16907520;class t1 extends th{constructor(e,i,o,h){super(e,{layout:Mm||(Mm=new kn({visibility:new Oi(Zt.layout_raster.visibility)})),paint:lx||(lx=new kn({"raster-opacity":new Oi(Zt.paint_raster["raster-opacity"]),"raster-color":new Tp(Zt.paint_raster["raster-color"]),"raster-color-mix":new Oi(Zt.paint_raster["raster-color-mix"]),"raster-color-range":new Oi(Zt.paint_raster["raster-color-range"]),"raster-hue-rotate":new Oi(Zt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Oi(Zt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Oi(Zt.paint_raster["raster-brightness-max"]),"raster-saturation":new Oi(Zt.paint_raster["raster-saturation"]),"raster-contrast":new Oi(Zt.paint_raster["raster-contrast"]),"raster-resampling":new Oi(Zt.paint_raster["raster-resampling"]),"raster-fade-duration":new Oi(Zt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Oi(Zt.paint_raster["raster-emissive-strength"]),"raster-array-band":new Oi(Zt.paint_raster["raster-array-band"]),"raster-elevation":new Oi(Zt.paint_raster["raster-elevation"]),"raster-color-use-theme":new ms({type:"string",default:"default","property-type":"data-driven"})}))},i,o,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof e1&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[o,h]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(o)&&isNaN(h)||o===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=Q({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:o,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[o,h])}}let i1,s1,r1,o1,n1;class a1 extends th{constructor(e,i,o,h){super(e,{layout:i1||(i1=new kn({visibility:new Oi(Zt["layout_raster-particle"].visibility)})),paint:s1||(s1=new kn({"raster-particle-array-band":new Oi(Zt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Oi(Zt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Tp(Zt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Oi(Zt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Oi(Zt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Oi(Zt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Oi(Zt["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Oi(Zt["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new ms({type:"string",default:"default","property-type":"data-driven"})}))},i,o,h),this._updateColorRamp(),this.lastInvalidatedAt=$h.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Q({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=$h.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class mT extends th{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function tb(s,e,i){const o=[0,0,1],h=jl([]);return Gs(h,h,i?-lr(s)+Math.PI:lr(s)),Kc(h,h,-lr(e)),Sh(o,o,h),Lo(o,o)}function l1(s,e){const i=av(s.projection,s.zoom,s.width,s.height),o=function(f,g,w,C,O){const j=new He(w.lng-180*qx,w.lat),W=new He(w.lng+180*qx,w.lat),K=f.project(j.lng,j.lat),oe=f.project(W.lng,W.lat),ue=-Math.atan2(oe.y-K.y,oe.x-K.x),be=Ft.fromLngLat(w);be.y=at(be.y,-1+qx,1-qx);const ke=be.toLngLat(),Fe=f.project(ke.lng,ke.lat),Qe=Ft.fromLngLat(ke);Qe.x+=qx;const it=Qe.toLngLat(),Se=f.project(it.lng,it.lat),Xe=c1(Se.x-Fe.x,Se.y-Fe.y,ue),st=Ft.fromLngLat(ke);st.y+=qx;const dt=st.toLngLat(),Ot=f.project(dt.lng,dt.lat),Pt=c1(Ot.x-Fe.x,Ot.y-Fe.y,ue),Dt=Math.abs(Xe.x)/Math.abs(Pt.y),Jt=hs([]);wo(Jt,Jt,-ue*(1-(O?0:C)));const yi=hs([]);return Or(yi,yi,[1,1-(1-Dt)*C,1]),yi[4]=-Pt.x/Pt.y*C,wo(yi,yi,ue),ar(yi,Jt,yi),yi}(s.projection,0,s.center,i,e),h=h1(s);return Or(o,o,[h,h,1]),o}function h1(s){const e=s.projection,i=av(s.projection,s.zoom,s.width,s.height),o=ib(e,s.center),h=ib(e,He.convert(e.center));return Math.pow(2,o*i+(1-i)*h)}function av(s,e,i,o,h=1/0){const f=s.range;if(!f)return 0;const g=Math.min(h,Math.max(i,o)),w=Math.log(g/1024)/Math.LN2;return zt(f[0]+w,f[1]+w,e)}const qx=1/4e4;function ib(s,e){const i=at(e.lat,-85.051129,wi),o=new He(e.lng-180*qx,i),h=new He(e.lng+180*qx,i),f=s.project(o.lng,i),g=s.project(h.lng,i),w=Ft.fromLngLat(o),C=Ft.fromLngLat(h),O=g.x-f.x,j=g.y-f.y,W=C.x-w.x,K=C.y-w.y,oe=Math.sqrt((W*W+K*K)/(O*O+j*j));return Math.log(oe)/Math.LN2}function c1(s,e,i){const o=Math.cos(i),h=Math.sin(i);return{x:s*o-e*h,y:s*h+e*o}}function d1(s,e,i){hs(s),wo(s,s,lr(e[2])),ir(s,s,lr(e[0])),fr(s,s,lr(e[1])),Or(s,s,i),ar(s,s,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function lv(s,e,i,o,h,f,g,w){const C=[i[0]-e[0],i[1]-e[1],0],O=[o[0]-e[0],o[1]-e[1],0];if(No(C)<1e-12||No(O)<1e-12)return jl(s);const j=pa([],C,O);Lo(j,j),Io(O,o,e),C[2]=(f-h)*w,O[2]=(g-h)*w;const W=C;return pa(W,C,O),Lo(W,W),mh(s,j,W)}function sb(s,e,i=!1){const o=Lp(e.zoom),h=function(f,g,w){const C=g.worldSize,O=[f[12],f[13],f[14]],j=ti(O[1]/C),W=Ct(O[0]/C),K=hs([]),oe=At(1,j)*C,ue=At(1,0)*C*Bi(j,g.zoom),be=1/py(C);let ke=ue*be;if(w){const Se=av(g.projection,g.zoom,g.width,g.height,1024);ke=be*g.projection.pixelSpaceConversion(g.center.lat,C,Se)}const Fe=Me(j,W);on(Fe,Fe,gr([],Lo([],Fe),oe*ke*O[2]));const Qe=function(Se){const Xe=[Se[0],Se[1],Se[2]];let st=[0,1,0];const dt=pa([],st,Xe);return pa(st,Xe,dt),Na(st)===0&&(st=[0,1,0],pa(dt,Xe,st)),Lo(dt,dt),Lo(st,st),Lo(Xe,Xe),[dt[0],dt[1],dt[2],0,st[0],st[1],st[2],0,Xe[0],Xe[1],Xe[2],0,Se[0],Se[1],Se[2],1]}(Fe);Or(K,K,[ke,ke,ke*oe]),Nr(K,K,[-O[0],-O[1],-O[2]]);const it=ar([],g.globeMatrix,Qe);return ar(it,it,K),ar(it,it,f),it}(s,e,i);if(o>0){const f=function(g,w){const C=w.worldSize,O=At(1,0)*C*Bi(w.center.lat,w.zoom)/py(C),j=At(1,w.center.lat)*C,W=hs([]);return fr(W,W,lr(w.center.lng)),ir(W,W,lr(w.center.lat)),Nr(W,W,[0,0,E]),Or(W,W,[O,O,O*j]),Nr(W,W,[w.point.x-.5*C,w.point.y-.5*C,0]),ar(W,W,g),ar(W,w.globeMatrix,W)}(s,e);return function(g,w,C){const O=(ue,be,ke)=>{const Fe=No(ue),Qe=No(be),it=rf(ue,be,ke);return gr(it,it,1/No(it)*js(Fe,Qe,ke))},j=O([g[0],g[1],g[2]],[w[0],w[1],w[2]],C),W=O([g[4],g[5],g[6]],[w[4],w[5],w[6]],C),K=O([g[8],g[9],g[10]],[w[8],w[9],w[10]],C),oe=rf([g[12],g[13],g[14]],[w[12],w[13],w[14]],C);return[j[0],j[1],j[2],0,W[0],W[1],W[2],0,K[0],K[1],K[2],0,oe[0],oe[1],oe[2],1]}(h,f,o)}return h}function u1(s,e,i,o){const h=Go.projectAabbCorners(o,i);let f=Number.MAX_VALUE,g=-1;for(let O=0;O<h.length;++O){const j=h[O];j[0]=(.5*j[0]+.5)*e.width,j[1]=(.5-.5*j[1])*e.height,j[2]<f&&(g=O,f=j[2])}const w=O=>new Wi(h[O][0],h[O][1]);let C;switch(g){case 0:case 6:C=[w(1),w(5),w(4),w(7),w(3),w(2),w(1)];break;case 1:case 7:C=[w(0),w(4),w(5),w(6),w(2),w(3),w(0)];break;case 3:case 5:C=[w(1),w(0),w(4),w(7),w(6),w(2),w(1)];break;default:C=[w(1),w(5),w(6),w(7),w(3),w(0),w(1)]}if(kc(s,C))return f}const gT=bo([{name:"a_pos_3f",components:3,type:"Float32"}]),yT=bo([{name:"a_color_3f",components:3,type:"Float32"}]),xT=bo([{name:"a_color_4f",components:4,type:"Float32"}]),_T=bo([{name:"a_uv_2f",components:2,type:"Float32"}]),vT=bo([{name:"a_normal_3f",components:3,type:"Float32"}]),bT=bo([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),wT=bo([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),p1={None:0,Model:1,Symbol:2,FillExtrusion:4};class hv{constructor(e,i,o,h){this.message=(e?`${e}: `:"")+o,h&&(this.identifier=h),i!=null&&i.__line__&&(this.line=i.__line__)}}function rb(s,e){const i=s.indexOf("://")===-1;try{return new URL(s,i&&e?"http://example.com":void 0),!0}catch{return!1}}class f1{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class m1{constructor(){this.instancedDataArray=new kp,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class ob{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,i){}populate(e,i,o,h){this.tileToMeter=ui(o);const f=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:g,id:w,index:C,sourceLayerIndex:O}of e){const j=w??(g.properties&&g.properties.hasOwnProperty("id")?g.properties.id:void 0),W=us(g,f);if(!this.layers[0]._featureFilter.filter(new qr(this.zoom,{worldview:this.worldview}),W,o))continue;const K={id:j,sourceLayerIndex:O,index:C,geometry:f?W.geometry:Ts(g,o,h),properties:g.properties,type:g.type,patterns:{}},oe=this.addFeature(K,K.geometry,W);oe&&i.featureIndex.insert(g,K.geometry,C,O,this.index,this.instancesPerModel[oe].instancedDataArray.length,ns/32)}this.lookup=null}update(e,i,o,h){for(const f in this.instancesPerModel){const g=this.instancesPerModel[f];for(const w in e)g.idToFeaturesIndex.hasOwnProperty(w)&&(this.evaluate(g.features[g.idToFeaturesIndex[w]],e[w],g,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];for(const h of o.features){const f=this.layers[0],g=h.feature,w=this.canonical,C=f.paint.get("model-rotation").evaluate(g,{},w),O=f.paint.get("model-scale").evaluate(g,{},w),j=f.paint.get("model-translation").evaluate(g,{},w);Wh(h.rotation,C)&&Wh(h.scale,O)&&Wh(h.translation,j)||(this.evaluate(h,h.featureStates,o,!0),e=!0)}}return e}updateReplacement(e,i,o,h){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const f=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(qg(this.activeReplacements,f))return!1;this.activeReplacements=f;let g=!1;for(const w in this.instancesPerModel){const C=this.instancesPerModel[w],O=C.instancedDataArray;for(const j of C.features){const W=j.instancedDataOffset,K=j.instancedDataCount;for(let oe=0;oe<K;oe++){const ue=16*(oe+W);let be=O.float32[ue+0];const ke=be>ns;be=ke?be-ns:be;const Fe=Math.floor(be),Qe=O.float32[ue+1];let it=!1;for(const Se of this.activeReplacements)if(!Hg(Se,o,p1.Model,h)&&!(Se.min.x>Fe||Fe>Se.max.x||Se.min.y>Qe||Qe>Se.max.y)&&(it=Cx(xd(Fe,Qe,e.canonical,Se.footprintTileId.canonical),Se.footprint),it))break;O.float32[ue]=it?be+ns:be,g=g||it!==ke}}}return g}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];o.instancedDataArray.length<0||o.instancedDataArray.length===0||(o.instancedDataBuffer?o.instancedDataBuffer.updateData(o.instancedDataArray):o.instancedDataBuffer=e.createVertexBuffer(o.instancedDataArray,bT.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];o.instancedDataArray.length!==0&&o.instancedDataBuffer&&o.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const i of this.modelUris)e.removeModel(i,"",!0)}addFeature(e,i,o){const h=this.layers[0],f=h.layout.get("model-id").evaluate(o,{},this.canonical);if(!f)return Ar(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),f;(rb(f,!1)||this.styleDefinedModelURLs[f]!==void 0)&&(this.modelUris.includes(f)||this.modelUris.push(f)),this.instancesPerModel[f]||(this.instancesPerModel[f]=new m1);const g=this.instancesPerModel[f],w=g.instancedDataArray,C=new f1(o,w.length);for(const O of i)for(const j of O){if(j.x<0||j.x>=ns||j.y<0||j.y>=ns)continue;const W=(this.lookupDim-1)/ns,K=this.lookupDim*(j.y*W|0)+j.x*W|0;if(this.lookup){if(this.lookup[K]!==0)continue;this.lookup[K]=1}this.instanceCount++;const oe=w.length;w.resize(oe+1),g.instancesEvaluatedElevation.push(0),w.float32[16*oe]=j.x,w.float32[16*oe+1]=j.y}return C.instancedDataCount=g.instancedDataArray.length-C.instancedDataOffset,C.instancedDataCount>0&&(e.id&&(g.idToFeaturesIndex[e.id]=g.features.length),g.features.push(C),this.evaluate(C,{},g,!1)),f}getModelUris(){return this.modelUris}evaluate(e,i,o,h){const f=this.layers[0],g=e.feature,w=this.canonical,C=e.rotation=f.paint.get("model-rotation").evaluate(g,i,w),O=e.scale=f.paint.get("model-scale").evaluate(g,i,w),j=e.translation=f.paint.get("model-translation").evaluate(g,i,w),W=f.paint.get("model-color").evaluate(g,i,w);W.a=f.paint.get("model-color-mix-intensity").evaluate(g,i,w);const K=[];this.maxVerticalOffset<j[2]&&(this.maxVerticalOffset=j[2]),this.maxScale=Math.max(Math.max(this.maxScale,O[0]),Math.max(O[1],O[2])),d1(K,C,O);const oe=Math.round(100*W.a)+W.b/1.05;for(let ue=0;ue<e.instancedDataCount;++ue){const be=e.instancedDataOffset+ue,ke=16*be,Fe=o.instancedDataArray.float32;let Qe=0;h&&(Qe=Fe[ke+6]-o.instancesEvaluatedElevation[be]);const it=0|Fe[ke+1];Fe[ke]=(0|Fe[ke])+W.r/1.05,Fe[ke+1]=it+W.g/1.05,Fe[ke+2]=oe,Fe[ke+3]=1/(w.z>10?this.tileToMeter:ui(w,it)),Fe[ke+4]=j[0],Fe[ke+5]=j[1],Fe[ke+6]=j[2]+Qe,Fe[ke+7]=K[0],Fe[ke+8]=K[1],Fe[ke+9]=K[2],Fe[ke+10]=K[4],Fe[ke+11]=K[5],Fe[ke+12]=K[6],Fe[ke+13]=K[8],Fe[ke+14]=K[9],Fe[ke+15]=K[10],o.instancesEvaluatedElevation[be]=j[2]}}}let g1,y1;qe(ob,"ModelBucket",{omit:["layers"]}),qe(m1,"PerModelAttributes"),qe(f1,"ModelFeature");const k_=64,u0={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function x1(s,e,i,o,h,f,g,w,C,O=!1){const j=i.zoom,W=i.project(o),K=Bi(o.lat,j),oe=1/K;hs(s),Nr(s,s,[W.x+g[0]*oe,W.y+g[1]*oe,g[2]]);let ue=1,be=1;const ke=i.worldSize;if(O){if(i.projection.name==="mercator"){let Se=0;i.elevation&&(Se=i.elevation.getAtPointOrZero(new Ft(W.x/ke,W.y/ke),0));const Xe=Ps([],[W.x,W.y,Se,1],i.projMatrix)[3]/i.cameraToCenterDistance;ue=Xe,be=Xe*Bi(i.center.lat,j)}else if(i.projection.name==="globe"){const Se=sb(s,i),Xe=[0,0,0,1];Ps(Xe,Xe,ar([],i.projMatrix,Se));const st=Xe[3]/i.cameraToCenterDistance,dt=Lp(j),Ot=i.projection.pixelsPerMeter(o.lat,ke)*Bi(o.lat,j),Pt=i.projection.pixelsPerMeter(i.center.lat,ke)*Bi(i.center.lat,j);ue=st/js(Ot,_i(i.center.lat),dt),be=st*K/Ot,ue*=Pt,be*=Pt}}else ue=oe;Or(s,s,[ue,ue,be]);const Fe=[...s],Qe=e.orientation,it=[];if(d1(it,[Qe[0]+h[0],Qe[1]+h[1],Qe[2]+h[2]],f),ar(s,Fe,it),w&&i.elevation){let Se=0;const Xe=[];if(C&&i.elevation){Se=function(dt,Ot,Pt,Dt,Jt){const yi=Ot.elevation;if(!yi)return 0;const $i=Go.projectAabbCorners(Pt,Dt),Ii=At(1,Jt.lat)*Ot.worldSize,Hi=function(ts,Br){const Bs=[0,0,1],Us=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Mr of Us){const $r=ts[Mr.corners[0]],Wr=ts[Mr.corners[1]],uo=ts[Mr.corners[2]],Kr=[Wr[0]-$r[0],Wr[1]-$r[1],Br*(Wr[2]-$r[2])],po=pa(Kr,Kr,[uo[0]-$r[0],uo[1]-$r[1],Br*(uo[2]-$r[2])]);Lo(po,po),Mr.dotProductWithUp=Zo(po,Bs)}return Us.sort((Mr,$r)=>Mr.dotProductWithUp-$r.dotProductWithUp),Us[0].corners}($i,Ii),Ki=$i[Hi[0]],bi=$i[Hi[1]],Gi=$i[Hi[2]],mi=$i[Hi[3]],xi=yi.getAtPointOrZero(new Ft(Ki[0]/Ot.worldSize,Ki[1]/Ot.worldSize),0),ss=yi.getAtPointOrZero(new Ft(bi[0]/Ot.worldSize,bi[1]/Ot.worldSize),0),rs=yi.getAtPointOrZero(new Ft(Gi[0]/Ot.worldSize,Gi[1]/Ot.worldSize),0),tr=yi.getAtPointOrZero(new Ft(mi[0]/Ot.worldSize,mi[1]/Ot.worldSize),0),Vs=(xi+tr)/2,gs=(ss+rs)/2;return Vs>gs?ss<rs?lv(dt,bi,mi,Ki,ss,tr,xi,Ii):lv(dt,Gi,Ki,mi,rs,xi,tr,Ii):xi<tr?lv(dt,Ki,bi,Gi,xi,ss,rs,Ii):lv(dt,mi,Gi,bi,tr,rs,ss,Ii),Math.max(Vs,gs)}(Xe,i,e.aabb,s,o);const st=ar([],fo([],Xe),it);ar(s,Fe,st)}else Se=i.elevation.getAtPointOrZero(new Ft(W.x/ke,W.y/ke),0);Se!==0&&(s[14]+=Se)}}function U0(s,e,i=!1){s.uploaded||(s.gfxTexture=new eb(e,s.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:s.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),s.uploaded=!0,s.image=null)}function TT(s,e,i){s.indexBuffer=e.createIndexBuffer(s.indexArray,!1,!0),s.vertexBuffer=e.createVertexBuffer(s.vertexArray,gT.members,!1,!0),s.normalArray&&(s.normalBuffer=e.createVertexBuffer(s.normalArray,vT.members,!1,!0)),s.texcoordArray&&(s.texcoordBuffer=e.createVertexBuffer(s.texcoordArray,_T.members,!1,!0)),s.colorArray&&(s.colorBuffer=e.createVertexBuffer(s.colorArray,(s.colorArray.bytesPerElement===12?yT:xT).members,!1,!0)),s.featureArray&&(s.pbrBuffer=e.createVertexBuffer(s.featureArray,wT.members,!0)),s.segments=sa.simpleSegment(0,0,s.vertexArray.length,s.indexArray.length);const o=s.material;o.pbrMetallicRoughness.baseColorTexture&&U0(o.pbrMetallicRoughness.baseColorTexture,e),o.pbrMetallicRoughness.metallicRoughnessTexture&&U0(o.pbrMetallicRoughness.metallicRoughnessTexture,e),o.normalTexture&&U0(o.normalTexture,e),o.occlusionTexture&&U0(o.occlusionTexture,e,i),o.emissionTexture&&U0(o.emissionTexture,e)}function nb(s,e,i){if(s.meshes)for(const o of s.meshes)TT(o,e,i);if(s.children)for(const o of s.children)nb(o,e,i)}function cv(s){if(s.meshes)for(const e of s.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(s.children)for(const e of s.children)cv(e)}function ab(s){if(s.meshes)for(const i of s.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(s.children)for(const i of s.children)ab(i)}class p0{constructor(e,i,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=o}static create(e,i,o){const h=o||e.findDEMTileFor(i);if(!h||!h.dem)return;const f=h.dem,g=h.tileID,w=1<<i.canonical.z-g.canonical.z;return new p0(h,f.dim/ns/w,[(i.canonical.x/w-g.canonical.x)*f.dim,(i.canonical.y/w-g.canonical.y)*f.dim])}tileCoordToPixel(e,i){const o=i*this._scale+this._offset[1],h=Math.floor(e*this._scale+this._offset[0]),f=Math.floor(o);return new Wi(h,f)}getElevationAt(e,i,o,h){const f=e*this._scale+this._offset[0],g=i*this._scale+this._offset[1],w=Math.floor(f),C=Math.floor(g),O=this._dem;return h=!!h,o?js(js(O.get(w,C,h),O.get(w,C+1,h),g-C),js(O.get(w+1,C,h),O.get(w+1,C+1,h),g-C),f-w):O.get(w,C,h)}getElevationAtPixel(e,i,o){return this._dem.get(e,i,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*At(1,e)*this._dem.stride}}const lb=new Float32Array(262144),E_=new Uint8Array(262144);function _1(s){let e=0;if(s.meshes)for(const i of s.meshes)e=Math.max(e,i.aabb.max[2]);if(s.children)for(const i of s.children)e=Math.max(e,_1(i));return e}function v1(s,e,i){if(s.meshes)for(const o of s.meshes){if(o.aabb.min[0]===1/0)continue;const h=Go.applyTransform(o.aabb,s.matrix);i.insert(e,h.min[0],h.min[1],h.max[0],h.max[1])}if(s.children)for(const o of s.children)v1(o,e,i)}const b1=["","wall","door","roof","window","lamp","logo"];class w1{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:_1(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Go([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new Go([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const o of this.node.meshes)this.node.lightMeshIndex!==e&&(o.transformedAabb=Go.applyTransformFast(o.aabb,this.node.matrix),i.encapsulate(o.transformedAabb)),e++;this.aabb=i}return this.aabb}}class dv{constructor(e,i,o,h,f,g,w,C){this.id=o,this.layers=e,this.layerIds=this.layers.map(O=>O.fqid),this.stateDependentLayerIds=this.layers.filter(O=>O.isStateDependent()).map(O=>O.id),this.modelTraits|=u0.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,h&&(this.modelTraits|=u0.HasMapboxMeshFeatures),f&&(this.modelTraits|=u0.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=g,this.worldview=C,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const O of i)this.nodesInfo.push(new w1(O)),v1(O,w.featureIndexArray.length,w.grid),w.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,w.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,i){for(const o of this.getNodesInfo()){const h=o.node;h.footprint&&i.push({footprint:h.footprint,id:e})}}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const o=i?this.stateDependentLayers:this.layers;if(!Ra(e,this.states))for(const h of o)this.evaluate(h,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const o of i){const h=o.node;this.uploaded?this.updatePbrBuffer(h):nb(h,e,!0)}for(const o of i)cv(o.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const o of e.meshes)o.pbrBuffer&&(o.pbrBuffer.updateData(o.featureArray),i=!0);return i}needsReEvaluation(e,i,o){const h=e.transform.projectionOptions,f=e.style.getBrightness(),g=this.brightness!==f;if(!this.uploaded||this.dirty||h.name!==this.projection.name||j0(o.paint.get("model-color").value,g)||j0(o.paint.get("model-color-mix-intensity").value,g)||j0(o.paint.get("model-roughness").value,g)||j0(o.paint.get("model-emissive-strength").value,g)||j0(o.paint.get("model-height-based-emissive-strength-multiplier").value,g)){this.projection=h,this.brightness=f;const w=this.getNodesInfo();for(const C of w)C.state=null;return!0}return!1}evaluateTransform(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const o=this.getNodesInfo(),h=this.id.canonical;for(const f of o){const g=f.feature;f.evaluatedTranslation=i.paint.get("model-translation").evaluate(g,{},h),f.evaluatedScale=i.paint.get("model-scale").evaluate(g,{},h)}}evaluate(e,i){const o=this.getNodesInfo();for(const h of o){if(!h.node.meshes)continue;const f=h.feature,g=i&&i[f.id];if(Ra(g,h.state))continue;h.state=structuredClone(g);const w=h.node.meshes&&h.node.meshes[0].featureData,C=h.evaluatedColor[2],O=h.evaluatedRMEA[2],j=this.id.canonical;if(h.hasTranslucentParts=!1,w){for(let W=0;W<b1.length;W++){const K=b1[W];K.length&&(f.properties.part=K);const oe=e.paint.get("model-color").evaluate(f,g,j).toPremultipliedRenderColor(null),ue=e.paint.get("model-color-mix-intensity").evaluate(f,g,j);h.evaluatedColor[W]=[oe.r,oe.g,oe.b,ue],h.evaluatedRMEA[W][0]=e.paint.get("model-roughness").evaluate(f,g,j),h.evaluatedRMEA[W][2]=e.paint.get("model-emissive-strength").evaluate(f,g,j),h.evaluatedRMEA[W][3]=oe.a,h.emissionHeightBasedParams[W]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(f,g,j),!h.hasTranslucentParts&&oe.a<1&&(h.hasTranslucentParts=!0)}delete f.properties.part,MT(h,C!==h.evaluatedColor[2]||O!==h.evaluatedRMEA[2],this.modelTraits)}else h.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(f,g,j);h.evaluatedTranslation=e.paint.get("model-translation").evaluate(f,g,j),h.evaluatedScale=e.paint.get("model-scale").evaluate(f,g,j),this.updatePbrBuffer(h.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,o,h){const f=e.findDEMTileFor(o);if(f&&(f.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(f.dem&&f.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=f.tileID.overscaledZ;const g=p0.create(e,o,f);if(!g)return;this.modelTraits&u0.HasMapboxMeshFeatures&&this.updateDEM(e,g,o,h);for(const w of this.getNodesInfo()){const C=w.node;if(!C.footprint||!C.footprint.vertices||!C.footprint.vertices.length)continue;const O=C.footprint.vertices;let j=g.getElevationAt(O[0].x,O[0].y,!0,!0);for(let W=1;W<O.length;W++)j=Math.min(j,g.getElevationAt(O[W].x,O[W].y,!0,!0));C.elevation=j}}this.terrainTile=f.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,o,h){let f=i._dem._modifiedForSources[h];if(f===void 0&&(i._dem._modifiedForSources[h]=[],f=i._dem._modifiedForSources[h]),f.includes(o.canonical))return;const g=i._dem.dim;f.push(o.canonical);let w=!1;for(const C of this.getNodesInfo()){const O=C.node;if(!O.footprint||!O.footprint.grid)continue;const j=O.footprint.grid,W=i.tileCoordToPixel(j.min.x,j.min.y),K=i.tileCoordToPixel(j.max.x,j.max.y),oe=Math.min(Math.min(g-K.y,W.x),Math.min(W.y,g-K.x));if(oe<0)continue;const ue=at(oe,2,5);let be=Math.max(0,W.x-ue),ke=Math.max(0,W.y-ue),Fe=Math.min(K.x+ue,g-1),Qe=Math.min(K.y+ue,g-1);for(let st=ke;st<=Qe;++st)for(let dt=be;dt<=Fe;++dt)E_[st*g+dt]=255;let it=0,Se=0;for(let st=0;st<j.cellsY;++st)for(let dt=0;dt<j.cellsX;++dt){if(!j.cells[st*j.cellsX+dt])continue;const Ot=i.tileCoordToPixel(j.min.x+dt/j.xScale,j.min.y+st/j.yScale),Pt=i.tileCoordToPixel(j.min.x+(dt+1)/j.xScale,j.min.y+(st+1)/j.yScale);for(let Dt=Ot.y;Dt<=Math.min(Pt.y+1,g-1);++Dt)for(let Jt=Ot.x;Jt<=Math.min(Pt.x+1,g-1);++Jt)E_[Dt*g+Jt]===255&&(E_[Dt*g+Jt]=0,it+=i.getElevationAtPixel(Jt,Dt),Se++)}const Xe=it/Se;be=Math.max(1,W.x-ue),ke=Math.max(1,W.y-ue),Fe=Math.min(K.x+ue,g-2),Qe=Math.min(K.y+ue,g-2),w=!0;for(let st=ke;st<=Qe;++st)for(let dt=be;dt<=Fe;++dt)E_[st*g+dt]===0&&(lb[st*g+dt]=i._dem.set(dt,st,Xe));for(let st=1;st<ue;++st){be=Math.max(1,W.x-st),ke=Math.max(1,W.y-st),Fe=Math.min(K.x+st,g-2),Qe=Math.min(K.y+st,g-2);for(let dt=ke;dt<=Qe;++dt)for(let Ot=be;Ot<=Fe;++Ot){const Pt=dt*g+Ot;if(E_[Pt]===255){let Dt=0,Jt=0,yi=-1,$i=-1;for(let Ii=-1;Ii<=1;++Ii)for(let Hi=-1;Hi<=1;++Hi){const Ki=(dt+Ii)*g+Ot+Hi;if(E_[Ki]>=st)continue;const bi=lb[Ki],Gi=Math.abs(bi);Gi>Jt&&(Dt=bi,Jt=Gi,yi=Hi,$i=Ii)}if(Jt>.1){const Ii=1-(st+.5*Math.abs(yi*$i))/ue;let Hi=i._dem.get(Ot,dt)+Dt*Ii;const Ki=i._dem.get(Ot+yi,dt+$i),bi=i._dem.get(Ot-yi,dt-$i,!0);(Hi-Ki)*(Hi-bi)>0&&(Hi=(Ki+bi)/2),lb[Pt]=i._dem.set(Ot,dt,Hi),E_[Pt]=st}}}}}w&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=$h.now())}setFilter(e){this.filter=e?hg(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new qr(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)cv(i.node),ab(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped());for(const h of this.getNodesInfo()){const f=h.node.footprint;h.hiddenByReplacement=!!f&&!o.find(g=>g.footprint===f)}}getHeightAtTileCoord(e,i){const o=[],h=[0,0,0],f=hs([]);for(const g of this.getNodesInfo()){const w=g.node.meshes[0],C=w.transformedAabb;if(e<C.min[0]||i<C.min[1]||e>C.max[0]||i>C.max[1])continue;if(g.node.hidden===!0)return{height:1/0,maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};_r(f,g.node.matrix),h[0]=e,h[1]=i,mo(h,h,f);const O=(h[0]-w.aabb.min[0])/(w.aabb.max[0]-w.aabb.min[0])*k_|0,j=Math.min(63,(h[1]-w.aabb.min[1])/(w.aabb.max[1]-w.aabb.min[1])*k_|0)*k_+Math.min(63,O),W=w.heightmap[j];if(!(W<0&&g.node.footprint))return g.hiddenByReplacement?void 0:{height:W,maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};if(g.node.footprint.grid.query(new Wi(e,i),new Wi(e,i),o),o.length>0)return{height:void 0,maxHeight:g.feature.properties.height,hidden:g.hiddenByReplacement,verticalScale:g.evaluatedScale[2]}}}}function j0(s,e){return s instanceof ge&&!s.isLightConstant&&e}function ST(s,e,i,o,h,f,g,w){let C=(61440&e|(61440&e)>>4)>>8,O=(3840&e|(3840&e)>>4)>>4,j=240&e|(240&e)>>4;i[3]>0&&(C=js(C,255*i[0],i[3]),O=js(O,255*i[1],i[3]),j=js(j,255*i[2],i[3]));const W=C<<8|O,K=j<<8|Math.floor(255*o[3]),oe=function(st){const dt=at(st,0,2);return Math.min(Math.round(.5*dt*255),255)}(o[2])<<8|15*o[0]<<4|15*o[1],ue=at(h[0],0,1),be=at(h[1],0,1),ke=at(h[2],0,1),Fe=at(h[3],0,1);let Qe,it,Se,Xe;if(ue!==be&&g!==f&&be!==ue){const st=g-f;it=1/(st*(be-ue)),Se=-(f+st*ue)/(st*(be-ue));const dt=at(h[4],-1,1);Xe=Math.pow(10,dt),Qe=255*ke<<8|255*Fe}else Qe=65535,it=0,Se=1,Xe=1;if(s.emplaceBack(W,K,oe,Qe,it,Se,Xe),w){const st=w.length;w.clear();for(let dt=0;dt<st;dt++)w.emplaceBack(W,K,oe,Qe,it,Se,Xe)}}function MT(s,e,i){const o=s.node;let h=0;const f=i&u0.HasMeshoptCompression;for(const g of o.meshes){if(o.lights&&o.lightMeshIndex===h||!g.featureData)continue;g.featureArray=new Af,g.featureArray.reserve(g.featureData.length);let w=e;for(const C of g.featureData){const O=f?65535&C:C>>16&65535,j=f?C>>16&65535:65535&C,W=(15&j)<8?15&j:0,K=s.evaluatedRMEA[W],oe=s.evaluatedColor[W],ue=s.emissionHeightBasedParams[W];let be;if(w&&W===2&&o.lights&&(be=new Af,be.resize(10*o.lights.length)),ST(g.featureArray,O,oe,K,ue,g.aabb.min[2],g.aabb.max[2],be),be&&w){w=!1;const ke=o.meshes[o.lightMeshIndex];ke.featureArray=be,ke.featureArray._trim()}}g.featureArray._trim(),h++}}function T1(s,e,i,o){const h=1<<s.z;e.lat=ti((o/ns+s.y)/h),e.lng=Ct((i/ns+s.x)/h)}function AT(s,e,i,o){const h=s.getNodesInfo()[e];if(!h||h.hiddenByReplacement||!h.node.meshes)return;let f=Number.MAX_VALUE;const g=h.node,w=i.tile,C=o.calculatePosMatrix(w.tileID.toUnwrapped(),o.worldSize),O=h.evaluatedScale;let j=0;o.elevation&&g.elevation&&(j=g.elevation*o.elevation.exaggeration()),Nr(C,C,[(g.anchor?g.anchor[0]:0)*(O[0]-1),(g.anchor?g.anchor[1]:0)*(O[1]-1),j]),Or(C,C,O);const W=i.queryGeometry,K=W.isPointQuery()?W.screenBounds:W.screenGeometry,oe=function(be){const ke=ar([],C,be.matrix);ar(ke,o.expandedFarZProjMatrix,ke);for(let Fe=0;Fe<be.meshes.length;++Fe){const Qe=be.meshes[Fe];if(Fe===be.lightMeshIndex)continue;const it=u1(K,o,ke,Qe.aabb);it!=null&&(f=Math.min(it,f))}if(be.children)for(const Fe of be.children)oe(Fe)};if(oe(g),f===Number.MAX_VALUE)return;const ue=new He(0,0);return T1(w.tileID.canonical,ue,h.node.anchor[0],h.node.anchor[1]),{intersectionZ:f,position:ue,feature:h.feature}}qe(dv,"Tiled3dModelBucket",{omit:["layers"]}),qe(w1,"Tiled3dModelFeature");const kT={circle:class extends th{constructor(s,e,i,o){super(s,{layout:yx||(yx=new kn({"circle-sort-key":new ms(Zt.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Oi(Zt.layout_circle["circle-elevation-reference"]),visibility:new Oi(Zt.layout_circle.visibility)})),paint:Lg||(Lg=new kn({"circle-radius":new ms(Zt.paint_circle["circle-radius"]),"circle-color":new ms(Zt.paint_circle["circle-color"]),"circle-blur":new ms(Zt.paint_circle["circle-blur"]),"circle-opacity":new ms(Zt.paint_circle["circle-opacity"]),"circle-translate":new Oi(Zt.paint_circle["circle-translate"]),"circle-translate-anchor":new Oi(Zt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Oi(Zt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Oi(Zt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ms(Zt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ms(Zt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ms(Zt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Oi(Zt.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new ms({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new ms({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}createBucket(s){return new qc(s)}queryRadius(s){const e=s;return Um("circle-radius",this,e)+Um("circle-stroke-width",this,e)+ay(this.paint.get("circle-translate"))}queryIntersectsFeature(s,e,i,o,h,f,g,w){const C=hy(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,s.pixelToTileUnitsFactor),O=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Sx(s,o,f,g,w,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",C,O)}getProgramIds(){return["circle"]}getDefaultProgramParams(s,e,i){const o=Ug(this);return{config:new sf(this,{zoom:e,lut:i}),defines:o,overrideFog:!1}}is3D(s){return!s&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends th{createBucket(s){return new gy(s)}constructor(s,e,i,o){super(s,{layout:Ax||(Ax=new kn({visibility:new Oi(Zt.layout_heatmap.visibility)})),paint:Gg||(Gg=new kn({"heatmap-radius":new ms(Zt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ms(Zt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Oi(Zt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Tp(Zt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Oi(Zt.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new ms({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Q({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return Um("heatmap-radius",this,s)}queryIntersectsFeature(s,e,i,o,h,f,g,w){const C=this.paint.get("heatmap-radius").evaluate(e,i);return Sx(s,o,f,g,w,!0,!0,new Wi(0,0),C)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(s,e,i){return s==="heatmap"?{config:new sf(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends th{constructor(s,e,i,o){super(s,{layout:he||(he=new kn({visibility:new Oi(Zt.layout_hillshade.visibility)})),paint:u||(u=new kn({"hillshade-illumination-direction":new Oi(Zt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Oi(Zt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Oi(Zt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Oi(Zt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Oi(Zt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Oi(Zt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Oi(Zt.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new ms({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new ms({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new ms({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(s,e,i){return{overrideFog:!1}}},fill:class extends th{constructor(s,e,i,o){super(s,{layout:Yy||(Yy=new kn({"fill-sort-key":new ms(Zt.layout_fill["fill-sort-key"]),visibility:new Oi(Zt.layout_fill.visibility),"fill-elevation-reference":new Oi(Zt.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new ms(Zt.layout_fill["fill-construct-bridge-guard-rail"])})),paint:$y||($y=new kn({"fill-antialias":new Oi(Zt.paint_fill["fill-antialias"]),"fill-opacity":new ms(Zt.paint_fill["fill-opacity"]),"fill-color":new ms(Zt.paint_fill["fill-color"]),"fill-outline-color":new ms(Zt.paint_fill["fill-outline-color"]),"fill-translate":new Oi(Zt.paint_fill["fill-translate"]),"fill-translate-anchor":new Oi(Zt.paint_fill["fill-translate-anchor"]),"fill-pattern":new ms(Zt.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Oi(Zt.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Oi(Zt.paint_fill["fill-emissive-strength"]),"fill-z-offset":new ms(Zt.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new ms(Zt.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new ms(Zt.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new ms({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new ms({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new ms({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new ms({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}getProgramIds(){const s=this.paint.get("fill-pattern"),e=s&&s.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(s,e,i){return{config:new sf(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(s,e){super.recalculate(s,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new Rf(s)}queryRadius(){return ay(this.paint.get("fill-translate"))}queryIntersectsFeature(s,e,i,o,h,f){return!s.queryGeometry.isAboveHorizon&&Fd(ly(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,s.pixelToTileUnitsFactor),o)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(s){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return s!=null?e&&!s:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends th{constructor(s,e,i,o){super(s,{layout:Ff||(Ff=new kn({visibility:new Oi(Zt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Oi(Zt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:c_||(c_=new kn({"fill-extrusion-opacity":new Oi(Zt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ms(Zt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Oi(Zt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Oi(Zt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ms(Zt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Oi(Zt["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new ms(Zt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ms(Zt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Oi(Zt["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Oi(Zt["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Oi(Zt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Oi(Zt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Oi(Zt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Oi(Zt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Oi(Zt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Oi(Zt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Oi(Zt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Oi(Zt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new ms(Zt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new ms(Zt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Oi(Zt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Oi(Zt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Oi(Zt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Oi(Zt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new ms(Zt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new ms(Zt["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Oi(Zt["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new ms({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new ms({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new by(s)}queryRadius(){return ay(this.paint.get("fill-extrusion-translate"))}is3D(s){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(s,e,i,o,h,f,g,w,C){const O=hy(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,s.pixelToTileUnitsFactor),j=this.paint.get("fill-extrusion-height").evaluate(e,i),W=this.paint.get("fill-extrusion-base").evaluate(e,i),K=[0,0],oe=w&&f.elevation,ue=f.elevation?f.elevation.exaggeration():1,be=s.tile.getBucket(this);if(oe&&be instanceof by){const Se=be.centroidVertexArray,Xe=C+1;Xe<Se.length&&(K[0]=Se.geta_centroid_pos0(Xe),K[1]=Se.geta_centroid_pos1(Xe))}if(K[0]===0&&K[1]===1)return!1;f.projection.name==="globe"&&(o=W_([o],[new Wi(0,0),new Wi(ns,ns)],s.tileID.canonical).map(Se=>Se.polygon).flat());const ke=oe?w:null,[Fe,Qe]=function(Se,Xe,st,dt,Ot,Pt,Dt,Jt,yi,$i,Ii){return Se.projection.name==="globe"?function(Hi,Ki,bi,Gi,mi,xi,ss,rs,tr,Vs,gs){const ts=[],Br=[],Bs=Hi.projection.upVectorScale(gs,Hi.center.lat,Hi.worldSize).metersToTile,Us=[0,0,0,1],Mr=[0,0,0,1],$r=(uo,Kr,po,Pn)=>{uo[0]=Kr,uo[1]=po,uo[2]=Pn,uo[3]=1},Wr=wg();bi>0&&(bi+=Wr),Gi+=Wr;for(const uo of Ki){const Kr=[],po=[];for(const Pn of uo){const ba=Pn.x+mi.x,nt=Pn.y+mi.y,ft=Hi.projection.projectTilePoint(ba,nt,gs),Si=Hi.projection.upVector(gs,Pn.x,Pn.y);let as=bi,ys=Gi;if(ss){const ps=X_(ba,nt,bi,Gi,ss,rs,tr,Vs);as+=ps.base,ys+=ps.top}bi!==0?$r(Us,ft.x+Si[0]*Bs*as,ft.y+Si[1]*Bs*as,ft.z+Si[2]*Bs*as):$r(Us,ft.x,ft.y,ft.z),$r(Mr,ft.x+Si[0]*Bs*ys,ft.y+Si[1]*Bs*ys,ft.z+Si[2]*Bs*ys),mo(Us,Us,xi),mo(Mr,Mr,xi),Kr.push(new Ym(Us[0],Us[1],Us[2])),po.push(new Ym(Mr[0],Mr[1],Mr[2]))}ts.push(Kr),Br.push(po)}return[ts,Br]}(Se,Xe,st,dt,Ot,Pt,Dt,Jt,yi,$i,Ii):Dt?function(Hi,Ki,bi,Gi,mi,xi,ss,rs,tr){const Vs=[],gs=[],ts=[0,0,0,1];for(const Br of Hi){const Bs=[],Us=[];for(const Mr of Br){const $r=Mr.x+Gi.x,Wr=Mr.y+Gi.y,uo=X_($r,Wr,Ki,bi,xi,ss,rs,tr);ts[0]=$r,ts[1]=Wr,ts[2]=uo.base,ts[3]=1,Ps(ts,ts,mi),ts[3]=Math.max(ts[3],1e-5);const Kr=new Ym(ts[0]/ts[3],ts[1]/ts[3],ts[2]/ts[3]);ts[0]=$r,ts[1]=Wr,ts[2]=uo.top,ts[3]=1,Ps(ts,ts,mi),ts[3]=Math.max(ts[3],1e-5);const po=new Ym(ts[0]/ts[3],ts[1]/ts[3],ts[2]/ts[3]);Bs.push(Kr),Us.push(po)}Vs.push(Bs),gs.push(Us)}return[Vs,gs]}(Xe,st,dt,Ot,Pt,Dt,Jt,yi,$i):function(Hi,Ki,bi,Gi,mi){const xi=[],ss=[],rs=mi[8]*Ki,tr=mi[9]*Ki,Vs=mi[10]*Ki,gs=mi[11]*Ki,ts=mi[8]*bi,Br=mi[9]*bi,Bs=mi[10]*bi,Us=mi[11]*bi;for(const Mr of Hi){const $r=[],Wr=[];for(const uo of Mr){const Kr=uo.x+Gi.x,po=uo.y+Gi.y,Pn=mi[0]*Kr+mi[4]*po+mi[12],ba=mi[1]*Kr+mi[5]*po+mi[13],nt=mi[2]*Kr+mi[6]*po+mi[14],ft=mi[3]*Kr+mi[7]*po+mi[15],Si=Pn+rs,as=ba+tr,ys=nt+Vs,ps=Math.max(ft+gs,1e-5),Ds=Pn+ts,Tr=ba+Br,Eo=nt+Bs,Co=Math.max(ft+Us,1e-5);$r.push(new Ym(Si/ps,as/ps,ys/ps)),Wr.push(new Ym(Ds/Co,Tr/Co,Eo/Co))}xi.push($r),ss.push(Wr)}return[xi,ss]}(Xe,st,dt,Ot,Pt)}(f,o,W,j,O,g,ke,K,ue,f.center.lat,s.tileID.canonical),it=s.queryGeometry;return function(Se,Xe,st){let dt=1/0;Fd(st,Xe)&&(dt=u_(st,Xe[0]));for(let Ot=0;Ot<Xe.length;Ot++){const Pt=Xe[Ot],Dt=Se[Ot];for(let Jt=0;Jt<Pt.length-1;Jt++){const yi=Pt[Jt],$i=[yi,Pt[Jt+1],Dt[Jt+1],Dt[Jt],yi];kc(st,$i)&&(dt=Math.min(dt,u_(st,$i)))}}return dt!==1/0&&dt}(Fe,Qe,it.isPointQuery()?it.screenBounds:it.screenGeometry)}},building:class extends th{constructor(s,e,i,o){super(s,{layout:Bx||(Bx=new kn({visibility:new Oi(Zt.layout_building.visibility),"building-roof-shape":new ms(Zt.layout_building["building-roof-shape"]),"building-height":new ms(Zt.layout_building["building-height"]),"building-base":new ms(Zt.layout_building["building-base"])})),paint:q_||(q_=new kn({"building-opacity":new Oi(Zt.paint_building["building-opacity"]),"building-ambient-occlusion-wall-intensity":new Oi(Zt.paint_building["building-ambient-occlusion-wall-intensity"]),"building-ambient-occlusion-ground-intensity":new Oi(Zt.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Oi(Zt.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Oi(Zt.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Oi(Zt.paint_building["building-vertical-scale"]),"building-cast-shadows":new Oi(Zt.paint_building["building-cast-shadows"]),"building-color":new ms(Zt.paint_building["building-color"]),"building-emissive-strength":new ms(Zt.paint_building["building-emissive-strength"]),"building-color-use-theme":new ms({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new Rx(s)}},line:class extends th{constructor(s,e,i,o){const h=rx();super(s,h,e,i,o),h.layout&&(this.layout=new tp(h.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Lu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(s,e){super.recalculate(s,e),this.paint._values["line-floorwidth"]=(()=>{if(ox)return ox;const i=rx();return ox=new Qg(i.paint.properties["line-width"].specification),ox.useIntegerZoom=!0,ox})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new tx(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(s,e,i){const o=Nx(this);return{config:new sf(this,{zoom:e,lut:i}),defines:o,overrideFog:!1}}queryRadius(s){const e=s,i=Mg(Um("line-width",this,e),Um("line-gap-width",this,e)),o=Um("line-offset",this,e);return i/2+Math.abs(o)+ay(this.paint.get("line-translate"))}queryIntersectsFeature(s,e,i,o,h,f){if(s.queryGeometry.isAboveHorizon)return!1;const g=ly(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,s.pixelToTileUnitsFactor),w=s.pixelToTileUnitsFactor/2*Mg(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),C=this.paint.get("line-offset").evaluate(e,i);return C&&(o=function(O,j){const W=[],K=new Wi(0,0);for(let oe=0;oe<O.length;oe++){const ue=O[oe],be=[];for(let ke=0;ke<ue.length;ke++){const Fe=ue[ke],Qe=ue[ke+1],it=ke===0?K:Fe.sub(ue[ke-1])._unit()._perp(),Se=ke===ue.length-1?K:Qe.sub(Fe)._unit()._perp(),Xe=it._add(Se)._unit();Xe._mult(1/(Xe.x*Se.x+Xe.y*Se.y)),be.push(Xe._mult(j)._add(Fe))}W.push(be)}return W}(o,C*s.pixelToTileUnitsFactor)),function(O,j,W){for(let K=0;K<j.length;K++){const oe=j[K];if(O.length>=3){for(let ue=0;ue<oe.length;ue++)if(gd(O,oe[ue]))return!0}if(yu(O,oe,W))return!0}return!1}(g,o,w)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(s){return!this.hasElevatedBuckets}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:Km,background:class extends th{constructor(s,e,i,o){super(s,{layout:Dy||(Dy=new kn({visibility:new Oi(Zt.layout_background.visibility)})),paint:$x||($x=new kn({"background-pitch-alignment":new Oi(Zt.paint_background["background-pitch-alignment"]),"background-color":new Oi(Zt.paint_background["background-color"]),"background-pattern":new Oi(Zt.paint_background["background-pattern"]),"background-opacity":new Oi(Zt.paint_background["background-opacity"]),"background-emissive-strength":new Oi(Zt.paint_background["background-emissive-strength"]),"background-color-use-theme":new ms({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(s,e,i){return{overrideFog:!1}}is3D(s){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:t1,"raster-particle":a1,sky:class extends th{constructor(s,e,i,o){super(s,{layout:r1||(r1=new kn({visibility:new Oi(Zt.layout_sky.visibility)})),paint:o1||(o1=new kn({"sky-type":new Oi(Zt.paint_sky["sky-type"]),"sky-atmosphere-sun":new Oi(Zt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Oi(Zt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Oi(Zt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Oi(Zt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Tp(Zt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Oi(Zt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Oi(Zt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Oi(Zt.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new ms({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new ms({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new ms({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="sky-gradient"?this._updateColorRamp():s!=="sky-atmosphere-sun"&&s!=="sky-atmosphere-halo-color"&&s!=="sky-atmosphere-color"&&s!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Q({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(s,e){if(this.paint.get("sky-type")==="atmosphere"){const o=this.paint.get("sky-atmosphere-sun"),h=!o,f=s.style.light,g=f.properties.get("position");return h&&f.properties.get("anchor")==="viewport"&&Ar("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?tb(g.azimuthal,90-g.polar,e):tb(o[0],90-o[1],e)}const i=this.paint.get("sky-gradient-center");return tb(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return s==="atmosphere"?["skyboxCapture","skybox"]:s==="gradient"?["skyboxGradient"]:null}},slot:class extends th{constructor(s,e,i,o){super(s,{paint:n1||(n1=new kn({}))},e,null)}},model:class extends th{constructor(s,e,i,o){super(s,{layout:g1||(g1=new kn({visibility:new Oi(Zt.layout_model.visibility),"model-id":new ms(Zt.layout_model["model-id"])})),paint:y1||(y1=new kn({"model-opacity":new ms(Zt.paint_model["model-opacity"]),"model-rotation":new ms(Zt.paint_model["model-rotation"]),"model-scale":new ms(Zt.paint_model["model-scale"]),"model-translation":new ms(Zt.paint_model["model-translation"]),"model-color":new ms(Zt.paint_model["model-color"]),"model-color-mix-intensity":new ms(Zt.paint_model["model-color-mix-intensity"]),"model-type":new Oi(Zt.paint_model["model-type"]),"model-cast-shadows":new Oi(Zt.paint_model["model-cast-shadows"]),"model-receive-shadows":new Oi(Zt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Oi(Zt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new ms(Zt.paint_model["model-emissive-strength"]),"model-roughness":new ms(Zt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new ms(Zt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Oi(Zt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Oi(Zt.paint_model["model-front-cutoff"]),"model-color-use-theme":new ms({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new ob(s)}getProgramIds(){return["model"]}is3D(s){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(s){return s instanceof dv?ns-1:0}queryIntersectsFeature(s,e,i,o,h,f){if(!this.modelManager)return!1;const g=this.modelManager,w=s.tile.getBucket(this);if(!(w&&w instanceof ob))return!1;for(const C in w.instancesPerModel){const O=w.instancesPerModel[C],j=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(O.idToFeaturesIndex.hasOwnProperty(j)){const W=O.features[O.idToFeaturesIndex[j]],K=g.getModel(C,this.scope);if(!K)return!1;let oe=zs();const ue=new He(0,0),be=w.canonical;let ke=Number.MAX_VALUE;for(let Fe=0;Fe<W.instancedDataCount;++Fe){const Qe=16*(W.instancedDataOffset+Fe),it=O.instancedDataArray.float32,Se=[it[Qe+4],it[Qe+5],it[Qe+6]];T1(be,ue,it[Qe],0|it[Qe+1]),x1(oe,K,f,ue,W.rotation,W.scale,Se,!1,!1,!1),f.projection.name==="globe"&&(oe=sb(oe,f));const Xe=ar([],f.projMatrix,oe),st=s.queryGeometry,dt=u1(st.isPointQuery()?st.screenBounds:st.screenGeometry,f,Xe,K.aabb);dt!=null&&(ke=Math.min(dt,ke))}return ke!==Number.MAX_VALUE&&ke}}return!1}_handleOverridablePaintPropertyUpdate(s,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||s!=="model-color"&&s!=="model-color-mix-intensity"&&s!=="model-rotation"&&s!=="model-scale"&&s!=="model-translation"&&s!=="model-emissive-strength")}_isPropertyZoomDependent(s){const e=this._transitionablePaint._values[s];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof xe}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends th{constructor(s,e,i,o){super(s,{layout:xg||(xg=new kn({"clip-layer-types":new Oi(Zt.layout_clip["clip-layer-types"]),"clip-layer-scope":new Oi(Zt.layout_clip["clip-layer-scope"])})),paint:Gm||(Gm=new kn({}))},e,i,o)}recalculate(s,e){super.recalculate(s,e)}createBucket(s){return new qy(s)}is3D(s){return!0}}},hb=new So(0,0,0),cb={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},db={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},uv={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},ET={PAINT_ORDER_FILL_AND_STROKE:1},G0={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},S1={MASK_TYPE_LUMINANCE:1};function CT(s,e,i){s===1&&e.icons.push(function(o,h){return function(f){if(f.usvg_tree.height||(f.usvg_tree.height=f.usvg_tree.width),!f.metadata)return f;const{metadata:g}=f;if(g.content_area){const{content_area:w}=g;w.top==null&&(w.top=w.left),w.width==null&&(w.width=f.usvg_tree.width),w.height==null&&(w.height=w.width)}return g.stretch_x&&g.stretch_x.length&&M1(g,"x"),g.stretch_y&&g.stretch_y.length&&M1(g,"y"),f}(o.readFields(PT,{name:void 0},h))}(i,i.readVarint()+i.pos))}function M1(s,e){const i=[],o=s[`stretch_${e}`];let h=null;for(let f=0;f<o.length;f++)h===null?h=i.length===0?o[0]:i[i.length-1][1]+o[f]:(i.push([h,h+o[f]]),h=null);s[`stretch_${e}_areas`]=i}function PT(s,e,i){s===1?e.name=i.readString():s===2?e.metadata=function(o,h){return o.readFields(IT,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},h)}(i,i.readVarint()+i.pos):s===3&&(e.usvg_tree=function(o,h){return o.readFields(DT,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},h)}(i,i.readVarint()+i.pos),e.data="usvg_tree")}function IT(s,e,i){s===1?e.stretch_x=i.readPackedVarint():s===2?e.stretch_y=i.readPackedVarint():s===3?e.content_area=function(o,h){return o.readFields(LT,{left:0},h)}(i,i.readVarint()+i.pos):s===4&&e.variables.push(function(o,h){return o.readFields(OT,{name:void 0},h)}(i,i.readVarint()+i.pos))}function LT(s,e,i){s===1?e.left=i.readVarint():s===2?e.width=i.readVarint():s===3?e.top=i.readVarint():s===4&&(e.height=i.readVarint())}function OT(s,e,i){s===1?e.name=i.readString():s===2&&(e.rgb_color=mv(i.readVarint()),e.value="rgb_color")}function DT(s,e,i){s===1?e.width=e.height=i.readVarint():s===2?e.height=i.readVarint():s===3?e.children.push(pv(i,i.readVarint()+i.pos)):s===4?e.linear_gradients.push(function(o,h){return o.readFields(UT,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},h)}(i,i.readVarint()+i.pos)):s===5?e.radial_gradients.push(function(o,h){return o.readFields(GT,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},h)}(i,i.readVarint()+i.pos)):s===7?e.clip_paths.push(function(o,h){return o.readFields(WT,{children:[]},h)}(i,i.readVarint()+i.pos)):s===8&&e.masks.push(function(o,h){const f=o.readFields(HT,{left:0,width:20,mask_type:S1.MASK_TYPE_LUMINANCE,children:[]},h);return f.height==null&&(f.height=f.width),f.top==null&&(f.top=f.left),f}(i,i.readVarint()+i.pos))}function pv(s,e){return s.readFields(zT,{},e)}function zT(s,e,i){s===1?(e.group=function(o,h){return o.readFields(RT,{opacity:255,children:[]},h)}(i,i.readVarint()+i.pos),e.node="group"):s===2&&(e.path=function(o,h){return o.readFields(FT,{paint_order:1,commands:[],step:1,diffs:[],rule:cb.PATH_RULE_NON_ZERO},h)}(i,i.readVarint()+i.pos),e.node="path")}function RT(s,e,i){s===1?e.transform=fv(i,i.readVarint()+i.pos):s===2?e.opacity=i.readVarint():s===5?e.clip_path_idx=i.readVarint():s===6?e.mask_idx=i.readVarint():s===7&&e.children.push(pv(i,i.readVarint()+i.pos))}function fv(s,e){return s.readFields(BT,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function BT(s,e,i){s===1?e.sx=i.readFloat():s===2?e.ky=i.readFloat():s===3?e.kx=i.readFloat():s===4?e.sy=i.readFloat():s===5?e.tx=i.readFloat():s===6&&(e.ty=i.readFloat())}function FT(s,e,i){s===1?e.fill=function(o,h){return o.readFields(NT,{rgb_color:hb,paint:"rgb_color",opacity:255},h)}(i,i.readVarint()+i.pos):s===2?e.stroke=function(o,h){return o.readFields(VT,{rgb_color:hb,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},h)}(i,i.readVarint()+i.pos):s===3?e.paint_order=i.readVarint():s===5?i.readPackedVarint(e.commands):s===6?e.step=i.readFloat():s===7?i.readPackedSVarint(e.diffs):s===8&&(e.rule=i.readVarint())}function NT(s,e,i){s===1?(e.rgb_color=mv(i.readVarint()),e.paint="rgb_color"):s===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):s===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):s===5&&(e.opacity=i.readVarint())}function mv(s){return new So((s>>16&255)/255,(s>>8&255)/255,(255&s)/255,1)}function VT(s,e,i){s===1?(e.rgb_color=mv(i.readVarint()),e.paint="rgb_color"):s===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):s===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):s===5?i.readPackedFloat(e.dasharray):s===6?e.dashoffset=i.readFloat():s===7?e.miterlimit=i.readFloat():s===8?e.opacity=i.readVarint():s===9?e.width=i.readFloat():s===10?e.linecap=i.readVarint():s===11&&(e.linejoin=i.readVarint())}function UT(s,e,i){s===1?e.transform=fv(i,i.readVarint()+i.pos):s===2?e.spread_method=i.readVarint():s===3?e.stops.push(A1(i,i.readVarint()+i.pos)):s===4?e.x1=i.readFloat():s===5?e.y1=i.readFloat():s===6?e.x2=i.readFloat():s===7&&(e.y2=i.readFloat())}function A1(s,e){return s.readFields(jT,{offset:0,opacity:255,rgb_color:hb},e)}function jT(s,e,i){s===1?e.offset=i.readFloat():s===2?e.opacity=i.readVarint():s===3&&(e.rgb_color=mv(i.readVarint()))}function GT(s,e,i){s===1?e.transform=fv(i,i.readVarint()+i.pos):s===2?e.spread_method=i.readVarint():s===3?e.stops.push(A1(i,i.readVarint()+i.pos)):s===4?e.cx=i.readFloat():s===5?e.cy=i.readFloat():s===6?e.r=i.readFloat():s===7?e.fx=i.readFloat():s===8?e.fy=i.readFloat():s===9&&(e.fr=i.readFloat())}function WT(s,e,i){s===1?e.transform=fv(i,i.readVarint()+i.pos):s===2?e.clip_path_idx=i.readVarint():s===3&&e.children.push(pv(i,i.readVarint()+i.pos))}function HT(s,e,i){s===1?e.left=e.top=i.readFloat():s===2?e.width=e.height=i.readFloat():s===3?e.top=i.readFloat():s===4?e.height=i.readFloat():s===5?e.mask_type=i.readVarint():s===6?e.mask_idx=i.readVarint():s===7&&e.children.push(pv(i,i.readVarint()+i.pos))}class XT{static calculate(e={},i=[]){const o=new Map,h=new Map;if(Object.keys(e).length===0)return o;i.forEach(f=>{h.set(f.name,f.rgb_color||new So(0,0,0))});for(const[f,g]of Object.entries(e))h.has(f)?o.set(h.get(f).toString(),g):console.warn(`Ignoring unknown image variable "${f}"`);return o}}function f0(s,e=255,i){const o=e/255,h=s.toString(),f=i.has(h)?i.get(h).clone():s.clone();return f.a*=o,f.toString()}function W0(s,e){if(!Ah()){const i=document.createElement("canvas");return i.width=s,i.height=e,i}return new OffscreenCanvas(s,e)}function YT(s,e){const i=XT.calculate(e.params,s.metadata?s.metadata.variables:[]),o=s.usvg_tree,h=o.width,f=o.height,g=e.transform?e.transform:new DOMMatrix,w=Math.max(1,Math.round(h*g.a)),C=Math.max(1,Math.round(f*g.d)),O=new DOMMatrix([w/h,0,0,C/f,0,0]),j=W0(w,C).getContext("2d");return ub(j,O,o,o,i),j.getImageData(0,0,w,C)}function ub(s,e,i,o,h){for(const f of o.children)k1(s,e,i,f,h)}function k1(s,e,i,o,h){o.group?(s.save(),function(f,g,w,C,O){const j=C.mask_idx!=null?w.masks[C.mask_idx]:null,W=C.clip_path_idx!=null?w.clip_paths[C.clip_path_idx]:null;if(C.transform&&(g=m0(C.transform).preMultiplySelf(g)),!function(ue,be,ke){return ue.opacity!==255||be||ke}(C,W!=null,j!=null))return void ub(f,g,w,C,O);const K=W0(f.canvas.width,f.canvas.height),oe=K.getContext("2d");ub(oe,g,w,C,O),W&&D1(oe,g,w,W),j&&z1(oe,g,w,j,O),f.globalAlpha=C.opacity/255,f.drawImage(K,0,0)}(s,e,i,o.group,h),s.restore()):o.path&&(s.save(),function(f,g,w,C,O){f.setTransform(g),C.paint_order===ET.PAINT_ORDER_FILL_AND_STROKE?(E1(f,w,C,O),P1(f,w,C,O)):(P1(f,w,C,O),E1(f,w,C,O))}(s,e,i,o.path,h),s.restore())}function E1(s,e,i,o){const h=i.fill;if(!h)return;const f=h.opacity/255;switch(s.save(),s.beginPath(),R1(i,s),h.paint){case"rgb_color":s.fillStyle=f0(h.rgb_color,h.opacity,o);break;case"linear_gradient_idx":{const g=e.linear_gradients[h.linear_gradient_idx];g.transform&&s.setTransform(m0(g.transform).preMultiplySelf(s.getTransform())),s.fillStyle=I1(s,g,f,o);break}case"radial_gradient_idx":{const g=e.radial_gradients[h.radial_gradient_idx];g.transform&&s.setTransform(m0(g.transform).preMultiplySelf(s.getTransform())),s.fillStyle=L1(s,g,f,o)}}s.fill(C1(i)),s.restore()}function C1(s){return s.rule===cb.PATH_RULE_NON_ZERO?"nonzero":s.rule===cb.PATH_RULE_EVEN_ODD?"evenodd":void 0}function P1(s,e,i,o){const h=i.stroke;if(!h)return;const f=B1(i);s.lineWidth=h.width,s.miterLimit=h.miterlimit,s.setLineDash(h.dasharray),s.lineDashOffset=h.dashoffset;const g=h.opacity/255;switch(h.paint){case"rgb_color":s.strokeStyle=f0(h.rgb_color,h.opacity,o);break;case"linear_gradient_idx":s.strokeStyle=I1(s,e.linear_gradients[h.linear_gradient_idx],g,o,!0);break;case"radial_gradient_idx":s.strokeStyle=L1(s,e.radial_gradients[h.radial_gradient_idx],g,o,!0)}switch(h.linejoin){case uv.LINE_JOIN_MITER_CLIP:case uv.LINE_JOIN_MITER:s.lineJoin="miter";break;case uv.LINE_JOIN_ROUND:s.lineJoin="round";break;case uv.LINE_JOIN_BEVEL:s.lineJoin="bevel"}switch(h.linecap){case db.LINE_CAP_BUTT:s.lineCap="butt";break;case db.LINE_CAP_ROUND:s.lineCap="round";break;case db.LINE_CAP_SQUARE:s.lineCap="square"}s.stroke(f)}function I1(s,e,i,o,h=!1){if(e.stops.length===1){const K=e.stops[0];return f0(K.rgb_color,K.opacity*i,o)}const{x1:f,y1:g,x2:w,y2:C}=e;let O=new DOMPoint(f,g),j=new DOMPoint(w,C);if(h){const K=m0(e.transform);O=K.transformPoint(O),j=K.transformPoint(j)}const W=s.createLinearGradient(O.x,O.y,j.x,j.y);for(const K of e.stops)W.addColorStop(K.offset,f0(K.rgb_color,K.opacity*i,o));return W}function L1(s,e,i,o,h=!1){if(e.stops.length===1){const Fe=e.stops[0];return f0(Fe.rgb_color,Fe.opacity*i,o)}const f=m0(e.transform),{fx:g,fy:w,fr:C,cx:O,cy:j,r:W}=e;let K=new DOMPoint(g,w),oe=new DOMPoint(O,j),ue=C,be=W;if(h){K=f.transformPoint(K),oe=f.transformPoint(oe);const Fe=(f.a+f.d)/2;ue=C*Fe,be=e.r*Fe}const ke=s.createRadialGradient(K.x,K.y,ue,oe.x,oe.y,be);for(const Fe of e.stops)ke.addColorStop(Fe.offset,f0(Fe.rgb_color,Fe.opacity*i,o));return ke}function O1(s,e,i,o){const h=o.transform?m0(o.transform).preMultiplySelf(e):e,f=W0(s.canvas.width,s.canvas.height),g=f.getContext("2d");for(const C of o.children)if(C.group)O1(g,h,i,C.group);else if(C.path){const O=C.path,j=new Path2D;j.addPath(B1(O),h),g.fill(j,C1(O))}const w=o.clip_path_idx!=null?i.clip_paths[o.clip_path_idx]:null;w&&D1(g,h,i,w),s.globalCompositeOperation="source-over",s.drawImage(f,0,0)}function D1(s,e,i,o){const h=W0(s.canvas.width,s.canvas.height);O1(h.getContext("2d"),e,i,o),s.globalCompositeOperation="destination-in",s.drawImage(h,0,0)}function z1(s,e,i,o,h){if(o.children.length===0)return;const f=o.mask_idx!=null?i.masks[o.mask_idx]:null;f&&z1(s,e,i,f,h);const g=s.canvas.width,w=s.canvas.height,C=W0(g,w),O=C.getContext("2d"),j=o.width,W=o.height,K=o.left,oe=o.top,ue=new Path2D,be=new Path2D;be.rect(K,oe,j,W),ue.addPath(be,e),O.clip(ue);for(const Qe of o.children)k1(O,e,i,Qe,h);const ke=O.getImageData(0,0,g,w),Fe=ke.data;if(o.mask_type===S1.MASK_TYPE_LUMINANCE)for(let Qe=0;Qe<Fe.length;Qe+=4)Fe[Qe+3]=Fe[Qe+3]/255*(.2126*Fe[Qe]+.7152*Fe[Qe+1]+.0722*Fe[Qe+2]);O.putImageData(ke,0,0),s.globalCompositeOperation="destination-in",s.drawImage(C,0,0)}function m0(s){return s?new DOMMatrix([s.sx,s.ky,s.kx,s.sy,s.tx,s.ty]):new DOMMatrix}function R1(s,e){const i=s.step;let o=s.diffs[0]*i,h=s.diffs[1]*i;e.moveTo(o,h);for(let f=0,g=2;f<s.commands.length;f++)switch(s.commands[f]){case G0.PATH_COMMAND_MOVE:o+=s.diffs[g++]*i,h+=s.diffs[g++]*i,e.moveTo(o,h);break;case G0.PATH_COMMAND_LINE:o+=s.diffs[g++]*i,h+=s.diffs[g++]*i,e.lineTo(o,h);break;case G0.PATH_COMMAND_QUAD:{const w=o+s.diffs[g++]*i,C=h+s.diffs[g++]*i;o=w+s.diffs[g++]*i,h=C+s.diffs[g++]*i,e.quadraticCurveTo(w,C,o,h);break}case G0.PATH_COMMAND_CUBIC:{const w=o+s.diffs[g++]*i,C=h+s.diffs[g++]*i,O=w+s.diffs[g++]*i,j=C+s.diffs[g++]*i;o=O+s.diffs[g++]*i,h=j+s.diffs[g++]*i,e.bezierCurveTo(w,C,O,j,o,h);break}case G0.PATH_COMMAND_CLOSE:e.closePath()}return e}function B1(s){return R1(s,new Path2D)}class gv{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}qe(gv,"LRUCache");class pb{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new V(e,e.data)}getFromCache(e,i,o){return this.cacheMap.has(o)||this.cacheMap.set(o,new gv(150)),this.cacheMap.get(o).get(hu(e.toString(),i))}setInCache(e,i,o,h){this.cacheDependenciesMap.has(h)||this.cacheDependenciesMap.set(h,new Map),this.cacheMap.has(h)||this.cacheMap.set(h,new gv(150));const f=this.cacheDependenciesMap.get(h),g=hu(e.id.toString(),o);f.get(g)||f.set(g,new Set);const w=this.cacheMap.get(h),C=e.toString();f.get(g).add(C),w.put(hu(e.toString(),o),i)}removeImagesFromCacheByIds(e,i,o=0){if(!this.cacheMap.has(o)||!this.cacheDependenciesMap.has(o))return;const h=this.cacheMap.get(o),f=this.cacheDependenciesMap.get(o);for(const g of e){const w=hu(g.toString(),i);if(f.has(w)){for(const C of f.get(w))h.delete(C);f.delete(w)}}}rasterize(e,i,o,h,f=YT){const g=this.getFromCache(e,o,h);if(g)return g.clone();const w=f(i.icon,e.options),C=pb._getImage(w);return this.setInCache(e,C,o,h),C.clone()}}class F1{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const o=this.toIdx(e,i);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function N1(s,e,i,o){let h=0,f=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(o[g])<1e-15){if(i[g]<s[g]||i[g]>e[g])return null}else{const w=1/o[g];let C=(s[g]-i[g])*w,O=(e[g]-i[g])*w;if(C>O){const j=C;C=O,O=j}if(C>h&&(h=C),O<f&&(f=O),h>f)return null}return h}function V1(s,e,i,o,h,f,g,w,C,O,j){const W=o-s,K=h-e,oe=f-i,ue=g-s,be=w-e,ke=C-i,Fe=j[1]*ke-j[2]*be,Qe=j[2]*ue-j[0]*ke,it=j[0]*be-j[1]*ue,Se=W*Fe+K*Qe+oe*it;if(Math.abs(Se)<1e-15)return null;const Xe=1/Se,st=O[0]-s,dt=O[1]-e,Ot=O[2]-i,Pt=(st*Fe+dt*Qe+Ot*it)*Xe;if(Pt<0||Pt>1)return null;const Dt=dt*oe-Ot*K,Jt=Ot*W-st*oe,yi=st*K-dt*W,$i=(j[0]*Dt+j[1]*Jt+j[2]*yi)*Xe;return $i<0||Pt+$i>1?null:(ue*Dt+be*Jt+ke*yi)*Xe}function U1(s,e,i){return(s-e)/(i-e)}function j1(s,e,i,o,h,f,g,w,C){const O=1<<i,j=f-o,W=g-h,K=(s+1)/O*j+o,oe=(e+0)/O*W+h,ue=(e+1)/O*W+h;w[0]=(s+0)/O*j+o,w[1]=oe,C[0]=K,C[1]=ue}class G1{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(f){const g=Math.ceil(Math.log2(f.dim/8)),w=[];let C=Math.ceil(Math.pow(2,g));const O=1/C,j=(oe,ue,be,ke,Fe)=>{const Qe=ke?1:0,it=(oe+1)*be-Qe,Se=ue*be,Xe=(ue+1)*be-Qe;Fe[0]=oe*be,Fe[1]=Se,Fe[2]=it,Fe[3]=Xe};let W=new F1(C);const K=[];for(let oe=0;oe<C*C;oe++){j(oe%C,Math.floor(oe/C),O,!1,K);const ue=Zx(K[0],K[1],f),be=Zx(K[2],K[1],f),ke=Zx(K[2],K[3],f),Fe=Zx(K[0],K[3],f);W.minimums.push(Math.min(ue,be,ke,Fe)),W.maximums.push(Math.max(ue,be,ke,Fe)),W.leaves.push(1)}for(w.push(W),C/=2;C>=1;C/=2){const oe=w[w.length-1];W=new F1(C);for(let ue=0;ue<C*C;ue++){j(ue%C,Math.floor(ue/C),2,!0,K);const be=oe.getElevation(K[0],K[1]),ke=oe.getElevation(K[2],K[1]),Fe=oe.getElevation(K[2],K[3]),Qe=oe.getElevation(K[0],K[3]),it=oe.isLeaf(K[0],K[1]),Se=oe.isLeaf(K[2],K[1]),Xe=oe.isLeaf(K[2],K[3]),st=oe.isLeaf(K[0],K[3]),dt=Math.min(be.min,ke.min,Fe.min,Qe.min),Ot=Math.max(be.max,ke.max,Fe.max,Qe.max),Pt=it&&Se&&Xe&&st;W.maximums.push(Ot),W.minimums.push(dt),W.leaves.push(Ot-dt<=5&&Pt?1:0)}w.push(W)}return w}(this.dem),o=i.length-1,h=i[o];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(i,0,0,o,0)}raycastRoot(e,i,o,h,f,g,w=1){return N1([e,i,-100],[o,h,this.maximums[0]*w],f,g)}raycast(e,i,o,h,f,g,w=1){if(!this.nodeCount)return null;const C=this.raycastRoot(e,i,o,h,f,g,w);if(C==null)return null;const O=[],j=[],W=[],K=[],oe=[{idx:0,t:C,nodex:0,nodey:0,depth:0}];for(;oe.length>0;){const{idx:ue,t:be,nodex:ke,nodey:Fe,depth:Qe}=oe.pop();if(this.leaves[ue]){j1(ke,Fe,Qe,e,i,o,h,W,K);const Se=1<<Qe,Xe=(ke+0)/Se,st=(ke+1)/Se,dt=(Fe+0)/Se,Ot=(Fe+1)/Se,Pt=Zx(Xe,dt,this.dem)*w,Dt=Zx(st,dt,this.dem)*w,Jt=Zx(st,Ot,this.dem)*w,yi=Zx(Xe,Ot,this.dem)*w,$i=V1(W[0],W[1],Pt,K[0],W[1],Dt,K[0],K[1],Jt,f,g),Ii=V1(K[0],K[1],Jt,W[0],K[1],yi,W[0],W[1],Pt,f,g),Hi=Math.min($i!==null?$i:Number.MAX_VALUE,Ii!==null?Ii:Number.MAX_VALUE);if(Hi!==Number.MAX_VALUE)return Hi;{const Ki=Kn([],f,g,be);if(W1(Pt,Dt,yi,Jt,U1(Ki[0],W[0],K[0]),U1(Ki[1],W[1],K[1]))>=Ki[2])return be}continue}let it=0;for(let Se=0;Se<this._siblingOffset.length;Se++){j1((ke<<1)+this._siblingOffset[Se][0],(Fe<<1)+this._siblingOffset[Se][1],Qe+1,e,i,o,h,W,K),W[2]=-100,K[2]=this.maximums[this.childOffsets[ue]+Se]*w;const Xe=N1(W,K,f,g);if(Xe!=null){const st=Xe;O[Se]=st;let dt=!1;for(let Ot=0;Ot<it&&!dt;Ot++)st>=O[j[Ot]]&&(j.splice(Ot,0,Se),dt=!0);dt||(j[it]=Se),it++}}for(let Se=0;Se<it;Se++){const Xe=j[Se];oe.push({idx:this.childOffsets[ue]+Xe,t:O[Xe],nodex:(ke<<1)+this._siblingOffset[Xe][0],nodey:(Fe<<1)+this._siblingOffset[Xe][1],depth:Qe+1})}}return null}_addNode(e,i,o){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,o,h,f){if(e[h].isLeaf(i,o)===1)return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const g=h-1,w=e[g];let C=0,O=0;for(let j=0;j<this._siblingOffset.length;j++){const W=2*i+this._siblingOffset[j][0],K=2*o+this._siblingOffset[j][1],oe=w.getElevation(W,K),ue=w.isLeaf(W,K),be=this._addNode(oe.min,oe.max,ue);ue&&(C|=1<<j),O||(O=be)}for(let j=0;j<this._siblingOffset.length;j++)C&1<<j||this._construct(e,2*i+this._siblingOffset[j][0],2*o+this._siblingOffset[j][1],g,O+j)}}function W1(s,e,i,o,h,f){return js(js(s,i,f),js(e,o,f),h)}function Zx(s,e,i){const o=i.dim,h=at(s*o-.5,0,o-1),f=at(e*o-.5,0,o-1),g=Math.floor(h),w=Math.floor(f),C=Math.min(g+1,o-1),O=Math.min(w+1,o-1);return W1(i.get(g,w),i.get(C,w),i.get(g,O),i.get(C,O),h-g,f-w)}const $T={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function qT(s,e,i){return(256*s*256+256*e+i)/10-1e4}function ZT(s,e,i){return 256*s+e+i/256-32768}class yv{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,o,h=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return void Ar(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const f=this.dim=i.height-2,g=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let C=0;C<f;C++)g[this._idx(-1,C)]=g[this._idx(0,C)],g[this._idx(f,C)]=g[this._idx(f-1,C)],g[this._idx(C,-1)]=g[this._idx(C,0)],g[this._idx(C,f)]=g[this._idx(C,f-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(f,-1)]=g[this._idx(f-1,0)],g[this._idx(-1,f)]=g[this._idx(0,f-1)],g[this._idx(f,f)]=g[this._idx(f-1,f-1)]}const w=o==="terrarium"?ZT:qT;for(let C=0;C<g.length;++C){const O=4*C;this.floatView[C]=w(this.pixels[O],this.pixels[O+1],this.pixels[O+2])}this._timestamp=$h.now()}_buildQuadTree(){this._tree=new G1(this)}get(e,i,o=!1){o&&(e=at(e,-1,this.dim),i=at(i,-1,this.dim));const h=this._idx(e,i);return this.floatView[h]}set(e,i,o){const h=this._idx(e,i),f=this.floatView[h];return this.floatView[h]=o,o-f}static getUnpackVector(e){return $T[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const o=[0,0,0,0],h=yv.getUnpackVector(i);let f=Math.floor((e+h[3])/h[2]);return o[2]=f%256,f=Math.floor(f/256),o[1]=f%256,f=Math.floor(f/256),o[0]=f,o}getPixels(){return new G({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=i*this.dim,f=i*this.dim+this.dim,g=o*this.dim,w=o*this.dim+this.dim;switch(i){case-1:h=f-1;break;case 1:f=h+1}switch(o){case-1:g=w-1;break;case 1:w=g+1}const C=-i*this.dim,O=-o*this.dim;for(let j=g;j<w;j++)for(let W=h;W<f;W++){const K=4*this._idx(W,j),oe=4*this._idx(W+C,j+O);this.pixels[K+0]=e.pixels[oe+0],this.pixels[K+1]=e.pixels[oe+1],this.pixels[K+2]=e.pixels[oe+2],this.pixels[K+3]=e.pixels[oe+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function KT(s,e,i){s===1?e.headerLength=i.readFixed32():s===2?e.x=i.readVarint():s===3?e.y=i.readVarint():s===4?e.z=i.readVarint():s===5&&e.layers.push(function(o,h){return o.readFields(iS,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},h)}(i,i.readVarint()+i.pos))}function JT(s,e,i){s===1?(e.delta_filter=function(o,h){return o.readFields(QT,{blockSize:0},h)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):s===2?(i.readVarint(),e.filter="zigzag_filter"):s===3?(i.readVarint(),e.filter="bitshuffle_filter"):s===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function QT(s,e,i){s===1&&(e.blockSize=i.readVarint())}function eS(s,e,i){s===1?(i.readVarint(),e.codec="gzip_data"):s===2?(i.readVarint(),e.codec="jpeg_image"):s===3?(i.readVarint(),e.codec="webp_image"):s===4&&(i.readVarint(),e.codec="png_image")}function tS(s,e,i){let o=0,h=0;s===1?e.firstByte=i.readFixed64():s===2?e.lastByte=i.readFixed64():s===3?e.filters.push(function(f,g){return f.readFields(JT,{},g)}(i,i.readVarint()+i.pos)):s===4?e.codec=function(f,g){return f.readFields(eS,{},g)}(i,i.readVarint()+i.pos):s===5?h=i.readFloat():s===6?o=i.readFloat():s===7?e.bands.push(i.readString()):s===8?e.offset=i.readDouble():s===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=h),e.scale===0&&(e.scale=o)}function iS(s,e,i){s===1?e.version=i.readVarint():s===2?e.name=i.readString():s===3?e.units=i.readString():s===4?e.tileSize=i.readVarint():s===5?e.buffer=i.readVarint():s===6?e.pixelFormat=i.readVarint():s===7&&e.dataIndex.push(function(o,h){return o.readFields(tS,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},h)}(i,i.readVarint()+i.pos))}function sS(s,e,i){if(s===2)(function(o,h,f){o.readFields(rS,f,h)})(i,i.readVarint()+i.pos,e);else if(s===3)throw new Error("Not implemented")}function rS(s,e,i){if(s===1){let o=0;const h=i.readVarint()+i.pos;for(;i.pos<h;)e[o++]=i.readVarint()}}function oS(s,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let o=2;o>=1;o--){const h=o===1?1:0,f=o===2?1:0;for(let g=0;g<e[0];g++){const w=e[1]*g;for(let C=h;C<e[1];C++){const O=e[2]*(C+w);for(let j=f;j<e[2];j++){const W=e[3]*(j+O);for(let K=0;K<e[3];K++){const oe=W+K;s[oe]+=s[oe-i]}}}}i*=e[o]}return s}function nS(s){for(let e=0,i=s.length;e<i;e++)s[e]=s[e]>>>1^-(1&s[e]);return s}function aS(s,e){switch(e){case"uint32":return s;case"uint16":for(let i=0;i<s.length;i+=2){const o=s[i],h=s[i+1];s[i]=(240&o)>>4|(61440&o)>>8|(240&h)<<4|61440&h,s[i+1]=15&o|(3840&o)>>4|(15&h)<<8|(3840&h)<<4}return s;case"uint8":for(let i=0;i<s.length;i+=4){const o=s[i],h=s[i+1],f=s[i+2],g=s[i+3];s[i+0]=(192&o)>>6|(192&h)>>4|(192&f)>>2|192&g,s[i+1]=(48&o)>>4|(48&h)>>2|48&f|(48&g)<<2,s[i+2]=(12&o)>>2|12&h|(12&f)<<2|(12&g)<<4,s[i+3]=3&o|(3&h)<<2|(3&f)<<4|(3&g)<<6}return s;default:throw new Error(`Invalid pixel format, "${e}"`)}}qe(yv,"DEMData"),qe(G1,"DemMinMaxQuadTree",{omit:["dem"]});var Jm=Uint8Array,H0=Uint16Array,lS=Int32Array,H1=new Jm([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),X1=new Jm([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),hS=new Jm([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Y1=function(s,e){for(var i=new H0(31),o=0;o<31;++o)i[o]=e+=1<<s[o-1];var h=new lS(i[30]);for(o=1;o<30;++o)for(var f=i[o];f<i[o+1];++f)h[f]=f-i[o]<<5|o;return{b:i,r:h}},$1=Y1(H1,2),q1=$1.b,cS=$1.r;q1[28]=258,cS[258]=28;for(var dS=Y1(X1,0).b,Z1=new H0(32768),pc=0;pc<32768;++pc){var g0=(43690&pc)>>1|(21845&pc)<<1;Z1[pc]=((65280&(g0=(61680&(g0=(52428&g0)>>2|(13107&g0)<<2))>>4|(3855&g0)<<4))>>8|(255&g0)<<8)>>1}var X0=function(s,e,i){for(var o=s.length,h=0,f=new H0(e);h<o;++h)s[h]&&++f[s[h]-1];var g,w=new H0(e);for(h=1;h<e;++h)w[h]=w[h-1]+f[h-1]<<1;g=new H0(1<<e);var C=15-e;for(h=0;h<o;++h)if(s[h])for(var O=h<<4|s[h],j=e-s[h],W=w[s[h]-1]++<<j,K=W|(1<<j)-1;W<=K;++W)g[Z1[W]>>C]=O;return g},Y0=new Jm(288);for(pc=0;pc<144;++pc)Y0[pc]=8;for(pc=144;pc<256;++pc)Y0[pc]=9;for(pc=256;pc<280;++pc)Y0[pc]=7;for(pc=280;pc<288;++pc)Y0[pc]=8;var K1=new Jm(32);for(pc=0;pc<32;++pc)K1[pc]=5;var uS=X0(Y0,9),pS=X0(K1,5),fb=function(s){for(var e=s[0],i=1;i<s.length;++i)s[i]>e&&(e=s[i]);return e},ry=function(s,e,i){var o=e/8|0;return(s[o]|s[o+1]<<8)>>(7&e)&i},mb=function(s,e){var i=e/8|0;return(s[i]|s[i+1]<<8|s[i+2]<<16)>>(7&e)},fS=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],oy=function(s,e,i){var o=new Error(e||fS[s]);if(o.code=s,Error.captureStackTrace&&Error.captureStackTrace(o,oy),!i)throw o;return o},mS=new Jm(0),gS=typeof TextDecoder<"u"&&new TextDecoder;try{gS.decode(mS,{stream:!0})}catch{}const yS={gzip_data:"gzip"};class kg extends Error{constructor(e){super(e),this.name="MRTError"}}const xS={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},J1={uint32:1,uint16:2,uint8:4},_S={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let gb;class xv{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new kg(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),o=new DataView(e);if(i[0]!==13)throw new kg("File is not a valid MRT.");return o.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),o=this.getHeaderLength(e);if(i.length<o)throw new kg(`Expected header with length >= ${o} but got buffer of length ${i.length}`);const h=function(f,g){return f.readFields(KT,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new gb(i.subarray(0,o)));if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new kg(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(const f of h.layers)this.layers[f.name]=new Q1(f,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],o=this.getLayer(e.layerName);for(let h of e.blockIndices){const f=o.dataIndex[h],g=f.firstByte-e.firstByte,w=f.lastByte-e.firstByte;if(o._blocksInProgress.has(h))continue;const C={layerName:o.name,firstByte:g,lastByte:w,pixelFormat:o.pixelFormat,blockIndex:h,blockShape:[f.bands.length].concat(o.bandShape),buffer:o.buffer,codec:f.codec.codec,filters:f.filters.map(O=>O.filter)};o._blocksInProgress.add(h),i.push(C)}return new ew(i,()=>{i.forEach(h=>o._blocksInProgress.delete(h.blockIndex))},(h,f)=>{if(i.forEach(g=>o._blocksInProgress.delete(g.blockIndex)),h)throw h;f.forEach(g=>{this.getLayer(g.layerName).processDecodedData(g)})})}}class Q1{constructor({version:e,name:i,units:o,tileSize:h,pixelFormat:f,buffer:g,dataIndex:w},C){if(this.version=e,this.version!==1)throw new kg(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=o,this.tileSize=h,this.buffer=g,this.pixelFormat=xS[f],this.dataIndex=w,this.bandShape=[h+2*g,h+2*g,J1[this.pixelFormat]],this._decodedBlocks=new gv(C?C.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return J1[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[o,h]of this.dataIndex.entries()){for(const[f,g]of h.bands.entries())if(g===e)return{bandIndex:i+f,blockIndex:o,blockBandIndex:f};i+=h.bands.length}break;case"number":for(const[o,h]of this.dataIndex.entries()){if(e>=i&&e<i+h.bands.length)return{bandIndex:e,blockIndex:o,blockBandIndex:e-i};i+=h.bands.length}break;default:throw new kg(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,o=-1/0;const h=[],f=new Set;for(const g of e){const{blockIndex:w}=this.getBlockForBand(g);if(w<0)throw new kg(`Invalid band: ${JSON.stringify(g)}`);const C=this.dataIndex[w];h.includes(w)||h.push(w),f.add(w),i=Math.min(i,C.firstByte),o=Math.max(o,C.lastByte)}if(f.size>this.cacheSize)throw new kg(`Number of blocks to decode (${f.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:o,blockIndices:h}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:o}=this.getBlockForBand(e);if(i<0)throw new kg(`Band not found: ${JSON.stringify(e)}`);const h=this._decodedBlocks.get(i.toString());if(!h)throw new kg(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const f=this.dataIndex[i],g=this.bandShape.reduce((O,j)=>O*j,1),w=o*g,C=h.subarray(w,w+g);return{data:C,bytes:new Uint8Array(C.buffer).subarray(C.byteOffset,C.byteOffset+C.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:f.offset,scale:f.scale}}}xv.setPbf=function(s){gb=s};class ew{constructor(e,i,o){this.tasks=e,this._onCancel=i,this._onComplete=o,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}function C_(s,e){const i=s.json.bufferViews[e.bufferView],o=ex[e.componentType];return new o(s.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==Ud[e.type]*o.BYTES_PER_ELEMENT?i.byteStride/o.BYTES_PER_ELEMENT:Ud[e.type]))}function yb(s,e,i,o){const h=ex[e.componentType],f=function(j){switch(j){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(h),g=s.json.bufferViews[e.bufferView],w=g.byteStride?g.byteStride/h.BYTES_PER_ELEMENT:Ud[e.type],C=i.float32,O=C.length/i.capacity;for(let j=0,W=0;j<e.count*w;j+=w,W+=O)for(let K=0;K<O;K++)C[W+K]=o[j+K]*f;i._trim()}function vS(s,e,i){const o=s.indices,h=s.attributes,f={};f.indexArray=new ml;const g=e.json.accessors[o],w=g.count/3;f.indexArray.reserve(w);const C=C_(e,g);for(let K=0;K<w;K++)f.indexArray.emplaceBack(C[3*K],C[3*K+1],C[3*K+2]);f.indexArray._trim(),f.vertexArray=new Xc;const O=e.json.accessors[h.POSITION];f.vertexArray.reserve(O.count);const j=C_(e,O);for(let K=0;K<O.count;K++)f.vertexArray.emplaceBack(j[3*K],j[3*K+1],j[3*K+2]);if(f.vertexArray._trim(),f.aabb=new Go(O.min,O.max),f.centroid=function(K,oe){const ue=[0,0,0],be=K.length;if(be>0){for(let ke=0;ke<be;ke++){const Fe=3*K[ke];ue[0]+=oe[Fe],ue[1]+=oe[Fe+1],ue[2]+=oe[Fe+2]}ue[0]/=be,ue[1]/=be,ue[2]/=be}return ue}(C,j),h.COLOR_0!==void 0){const K=e.json.accessors[h.COLOR_0],oe=Ud[K.type],ue=C_(e,K);f.colorArray=oe===3?new Xc:new wn,f.colorArray.resize(K.count),yb(e,K,f.colorArray,ue)}if(h.NORMAL!==void 0){f.normalArray=new Xc;const K=e.json.accessors[h.NORMAL];f.normalArray.resize(K.count);const oe=C_(e,K);yb(e,K,f.normalArray,oe)}if(h.TEXCOORD_0!==void 0&&i.length>0){f.texcoordArray=new bh;const K=e.json.accessors[h.TEXCOORD_0];f.texcoordArray.resize(K.count);const oe=C_(e,K);yb(e,K,f.texcoordArray,oe)}if(h._FEATURE_ID_RGBA4444!==void 0){const K=e.json.accessors[h._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(f.featureData=C_(e,K))}h._FEATURE_RGBA4444!==void 0&&(f.featureData=new Uint32Array(C_(e,e.json.accessors[h._FEATURE_RGBA4444]).buffer));const W=s.material;return f.material=function(K,oe){const{emissiveFactor:ue=[0,0,0],alphaMode:be="OPAQUE",alphaCutoff:ke=.5,normalTexture:Fe,occlusionTexture:Qe,emissiveTexture:it,doubleSided:Se}=K,{baseColorFactor:Xe=[1,1,1,1],metallicFactor:st=1,roughnessFactor:dt=1,baseColorTexture:Ot,metallicRoughnessTexture:Pt}=K.pbrMetallicRoughness||{},Dt=Qe?oe[Qe.index]:void 0;if(Qe&&Qe.extensions&&Qe.extensions.KHR_texture_transform&&Dt){const Jt=Qe.extensions.KHR_texture_transform;Dt.offsetScale=[Jt.offset[0],Jt.offset[1],Jt.scale[0],Jt.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new So(...Xe),metallicFactor:st,roughnessFactor:dt,baseColorTexture:Ot?oe[Ot.index]:void 0,metallicRoughnessTexture:Pt?oe[Pt.index]:void 0},doubleSided:Se,emissiveFactor:new So(...ue),alphaMode:be,alphaCutoff:ke,normalTexture:Fe?oe[Fe.index]:void 0,occlusionTexture:Dt,emissionTexture:it?oe[it.index]:void 0,defined:K.defined===void 0}}(W!==void 0?e.json.materials[W]:{defined:!1},i),f}function tw(s,e,i){const{matrix:o,rotation:h,translation:f,scale:g,mesh:w,extras:C,children:O}=s,j={};if(j.matrix=o||function(W,K,oe,ue){var be=K[0],ke=K[1],Fe=K[2],Qe=K[3],it=be+be,Se=ke+ke,Xe=Fe+Fe,st=be*it,dt=be*Se,Ot=be*Xe,Pt=ke*Se,Dt=ke*Xe,Jt=Fe*Xe,yi=Qe*it,$i=Qe*Se,Ii=Qe*Xe,Hi=ue[0],Ki=ue[1],bi=ue[2];return W[0]=(1-(Pt+Jt))*Hi,W[1]=(dt+Ii)*Hi,W[2]=(Ot-$i)*Hi,W[3]=0,W[4]=(dt-Ii)*Ki,W[5]=(1-(st+Jt))*Ki,W[6]=(Dt+yi)*Ki,W[7]=0,W[8]=(Ot+$i)*bi,W[9]=(Dt-yi)*bi,W[10]=(1-(st+Pt))*bi,W[11]=0,W[12]=oe[0],W[13]=oe[1],W[14]=oe[2],W[15]=1,W}([],h||[0,0,0,1],f||[0,0,0],g||[1,1,1]),w!==void 0){j.meshes=i[w];const W=j.anchor=[0,0];for(const K of j.meshes){const{min:oe,max:ue}=K.aabb;W[0]+=oe[0]+ue[0],W[1]+=oe[1]+ue[1]}W[0]=Math.floor(W[0]/j.meshes.length/2),W[1]=Math.floor(W[1]/j.meshes.length/2)}if(C&&(C.id&&(j.id=C.id),C.lights&&(j.lights=function(W){if(!W.length)return[];const K=function(Fe){const Qe=atob(Fe),it=new Uint8Array(Qe.length);for(let Se=0;Se<Qe.length;Se++)it[Se]=Qe.codePointAt(Se);return it}(W),oe=[],ue=K.length/24,be=new Uint16Array(K.buffer),ke=new Float32Array(K.buffer);for(let Fe=0;Fe<ue;Fe++){const Qe=be[2*Fe*6]/30,it=be[2*Fe*6+1]/30,Se=be[2*Fe*6+10]/100,Xe=ke[6*Fe+1],st=ke[6*Fe+2],dt=ke[6*Fe+3],Ot=ke[6*Fe+4],Pt=dt-Xe,Dt=Ot-st,Jt=Math.hypot(Pt,Dt);oe.push({pos:[Xe+.5*Pt,st+.5*Dt,it],normal:[Dt/Jt,-Pt/Jt,0],width:Jt,height:Qe,depth:Se,points:[Xe,st,dt,Ot]})}return oe}(C.lights))),O){const W=[];for(const K of O)W.push(tw(e.json.nodes[K],e,i));j.children=W}return j}function bS(s){if(s.vertices.length===0||s.indices.length===0)return null;const e=new kx(s.vertices,s.indices,8,256),[i,o]=[e.min.clone(),e.max.clone()];return{vertices:s.vertices,indices:s.indices,grid:e,min:i,max:o}}function wS(s){if(!s.extras||!s.extras.ground)return null;const e=s.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const o=[];for(const g of i){if(!Array.isArray(g)||g.length!==2)continue;const w=g[0],C=g[1];typeof w=="number"&&typeof C=="number"&&o.push(new Wi(w,C))}if(o.length<3)return null;o.length>1&&o[o.length-1].equals(o[0])&&o.pop();let h=0;for(let g=0;g<o.length;g++){const w=o[g],C=o[(g+1)%o.length],O=o[(g+2)%o.length];h+=(w.x-C.x)*(O.y-C.y)-(O.x-C.x)*(w.y-C.y)}h>0&&o.reverse();const f=Le(o.flatMap(g=>[g.x,g.y]),[]);return f.length===0?null:{vertices:o,indices:f}}function TS(s,e){const i=[],o=[];let h=0;const f=[];for(const g of s){h=i.length;const w=g.vertexArray.float32,C=g.indexArray.uint16;for(let O=0;O<g.vertexArray.length;O++)f[0]=w[3*O+0],f[1]=w[3*O+1],f[2]=w[3*O+2],mo(f,f,e),i.push(new Wi(f[0],f[1]));for(let O=0;O<3*g.indexArray.length;O++)o.push(C[O]+h)}if(o.length%3!=0)return null;for(let g=0;g<o.length;g+=3){const w=i[o[g+0]],C=i[o[g+1]],O=i[o[g+2]];(w.x-C.x)*(O.y-C.y)-(O.x-C.x)*(w.y-C.y)>0&&([o[g+1],o[g+2]]=[o[g+2],o[g+1]])}return{vertices:i,indices:o}}function iw(s){const e=function(C,O){const j=[],W=WebGL2RenderingContext;if(C.json.textures)for(const K of C.json.textures){const oe={magFilter:W.LINEAR,minFilter:W.NEAREST,wrapS:W.REPEAT,wrapT:W.REPEAT};K.sampler!==void 0&&Object.assign(oe,C.json.samplers[K.sampler]),j.push({image:O[K.source],sampler:oe,uploaded:!1})}return j}(s,s.images),i=function(C,O){const j=[];for(const W of C.json.meshes){const K=[];for(const oe of W.primitives)K.push(vS(oe,C,O));j.push(K)}return j}(s,e),{scenes:o,scene:h,nodes:f}=s.json,g=o?o[h||0].nodes:f,w=[];for(const C of g)w.push(tw(f[C],s,i));return function(C,O,j){const W={},K=new Set;for(let oe=0;oe<C.length;oe++){const ue=j[O[oe]];if(!ue.extras)continue;const be=ue.extras["mapbox:footprint:version"],ke=ue.extras["mapbox:footprint:id"];(be||ke)&&K.add(oe),be==="1.0.0"&&ke&&(W[ke]=oe)}for(let oe=0;oe<C.length;oe++){if(K.has(oe))continue;const ue=C[oe],be=j[O[oe]];if(!be.extras)continue;let ke=null;ue.id in W&&(ke=TS(C[W[ue.id]].meshes,ue.matrix)),ke||(ke=wS(be)),ke&&(ue.footprint=bS(ke))}if(K.size>0){const oe=Array.from(K.values()).sort((ue,be)=>ue-be);for(let ue=oe.length-1;ue>=0;ue--)C.splice(oe[ue],1)}}(w,g,s.json.nodes),w}function SS(s){s.heightmap=new Float32Array(4096),s.heightmap.fill(-1);const e=s.vertexArray.float32,i=s.aabb.min[0]-1,o=s.aabb.min[1]-1,h=k_/(s.aabb.max[0]-i+2),f=k_/(s.aabb.max[1]-o+2);for(let g=0;g<e.length;g+=3){const w=e[g+2],C=(e[g+0]-i)*h|0,O=(e[g+1]-o)*f|0;w>s.heightmap[O*k_+C]&&(s.heightmap[O*k_+C]=w)}}function MS(s,e){const i={};i.indexArray=new ml,i.indexArray.reserve(4*s.length),i.vertexArray=new Xc,i.vertexArray.reserve(10*s.length),i.colorArray=new wn,i.vertexArray.reserve(10*s.length);let o=0;for(const g of s){const w=Math.min(10,Math.max(4,1.3*g.height))*e,C=[-g.normal[1],g.normal[0],0],O=Math.min(.29,.1*g.width/g.depth),j=g.width-2*g.depth*e*(O+.01),W=Kn([],g.pos,C,j/2),K=Kn([],g.pos,C,-j/2),oe=[W[0],W[1],W[2]+g.height],ue=[K[0],K[1],K[2]+g.height],be=Kn([],g.normal,C,O);gr(be,be,w);const ke=Kn([],g.normal,C,-O);gr(ke,ke,w),on(be,W,be),on(ke,K,ke),W[2]+=.1,K[2]+=.1,i.vertexArray.emplaceBack(be[0],be[1],be[2]),i.vertexArray.emplaceBack(ke[0],ke[1],ke[2]),i.vertexArray.emplaceBack(W[0],W[1],W[2]),i.vertexArray.emplaceBack(K[0],K[1],K[2]),i.vertexArray.emplaceBack(oe[0],oe[1],oe[2]),i.vertexArray.emplaceBack(ue[0],ue[1],ue[2]),i.vertexArray.emplaceBack(W[0],W[1],W[2]),i.vertexArray.emplaceBack(K[0],K[1],K[2]),i.vertexArray.emplaceBack(be[0],be[1],be[2]),i.vertexArray.emplaceBack(ke[0],ke[1],ke[2]);const Fe=j/w/2;i.colorArray.emplaceBack(-Fe-O,-1,Fe,.8),i.colorArray.emplaceBack(Fe+O,-1,Fe,.8),i.colorArray.emplaceBack(-Fe,0,Fe,1.3),i.colorArray.emplaceBack(Fe,0,Fe,1.3),i.colorArray.emplaceBack(Fe+O,-.8,Fe,.7),i.colorArray.emplaceBack(Fe+O,-.8,Fe,.7),i.colorArray.emplaceBack(0,0,Fe,1.3),i.colorArray.emplaceBack(0,0,Fe,1.3),i.colorArray.emplaceBack(Fe+O,-1.2,Fe,.8),i.colorArray.emplaceBack(Fe+O,-1.2,Fe,.8),i.indexArray.emplaceBack(6+o,4+o,8+o),i.indexArray.emplaceBack(7+o,9+o,5+o),i.indexArray.emplaceBack(0+o,1+o,2+o),i.indexArray.emplaceBack(1+o,3+o,2+o),o+=10}const h={defined:!0};h.emissiveFactor=So.black;const f={};return f.baseColorFactor=So.white,h.pbrMetallicRoughness=f,i.material=h,i.aabb=new Go([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}xv.performDecoding=function(s,e){const i=new Uint8Array(s);return Promise.all(e.tasks.map(o=>{const{layerName:h,firstByte:f,lastByte:g,pixelFormat:w,blockShape:C,blockIndex:O,filters:j,codec:W}=o,K=i.subarray(f,g+1),oe=new Uint32Array(C[0]*C[1]*C[2]);let ue;if(W!=="gzip_data")throw new kg(`Unhandled codec: ${W}`);return ue=function(be,ke){if(!globalThis.DecompressionStream&&ke==="gzip_data")return Promise.resolve(((Se=function(dt){dt[0]==31&&dt[1]==139&&dt[2]==8||oy(6,"invalid gzip data");var Ot=dt[3],Pt=10;4&Ot&&(Pt+=2+(dt[10]|dt[11]<<8));for(var Dt=(Ot>>3&1)+(Ot>>4&1);Dt>0;Dt-=!dt[Pt++]);return Pt+(2&Ot)}(it=be))+8>it.length&&oy(6,"invalid gzip data"),function(dt,Ot,Pt,Dt){var Jt=dt.length;if(!Jt||Ot.f&&!Ot.l)return Pt||new Jm(0);var yi=!Pt,$i=yi||Ot.i!=2,Ii=Ot.i;yi&&(Pt=new Jm(3*Jt));var Hi,Ki,bi=function(Cl){var Pa=Pt.length;if(Cl>Pa){var ca=new Jm(Math.max(2*Pa,Cl));ca.set(Pt),Pt=ca}},Gi=Ot.f||0,mi=Ot.p||0,xi=Ot.b||0,ss=Ot.l,rs=Ot.d,tr=Ot.m,Vs=Ot.n,gs=8*Jt;do{if(!ss){Gi=ry(dt,mi,1);var ts=ry(dt,mi+1,3);if(mi+=3,!ts){var Br=dt[(nt=4+((mi+7)/8|0))-4]|dt[nt-3]<<8,Bs=nt+Br;if(Bs>Jt){Ii&&oy(0);break}$i&&bi(xi+Br),Pt.set(dt.subarray(nt,Bs),xi),Ot.b=xi+=Br,Ot.p=mi=8*Bs,Ot.f=Gi;continue}if(ts==1)ss=uS,rs=pS,tr=9,Vs=5;else if(ts==2){var Us=ry(dt,mi,31)+257,Mr=ry(dt,mi+10,15)+4,$r=Us+ry(dt,mi+5,31)+1;mi+=14;for(var Wr=new Jm($r),uo=new Jm(19),Kr=0;Kr<Mr;++Kr)uo[hS[Kr]]=ry(dt,mi+3*Kr,7);mi+=3*Mr;var po=fb(uo),Pn=(1<<po)-1,ba=X0(uo,po);for(Kr=0;Kr<$r;){var nt,ft=ba[ry(dt,mi,Pn)];if(mi+=15&ft,(nt=ft>>4)<16)Wr[Kr++]=nt;else{var Si=0,as=0;for(nt==16?(as=3+ry(dt,mi,3),mi+=2,Si=Wr[Kr-1]):nt==17?(as=3+ry(dt,mi,7),mi+=3):nt==18&&(as=11+ry(dt,mi,127),mi+=7);as--;)Wr[Kr++]=Si}}var ys=Wr.subarray(0,Us),ps=Wr.subarray(Us);tr=fb(ys),Vs=fb(ps),ss=X0(ys,tr),rs=X0(ps,Vs)}else oy(1);if(mi>gs){Ii&&oy(0);break}}$i&&bi(xi+131072);for(var Ds=(1<<tr)-1,Tr=(1<<Vs)-1,Eo=mi;;Eo=mi){var Co=(Si=ss[mb(dt,mi)&Ds])>>4;if((mi+=15&Si)>gs){Ii&&oy(0);break}if(Si||oy(2),Co<256)Pt[xi++]=Co;else{if(Co==256){Eo=mi,ss=null;break}var Jr=Co-254;Co>264&&(Jr=ry(dt,mi,(1<<(Po=H1[Kr=Co-257]))-1)+q1[Kr],mi+=Po);var Dn=rs[mb(dt,mi)&Tr],ha=Dn>>4;if(Dn||oy(3),mi+=15&Dn,ps=dS[ha],ha>3){var Po=X1[ha];ps+=mb(dt,mi)&(1<<Po)-1,mi+=Po}if(mi>gs){Ii&&oy(0);break}$i&&bi(xi+131072);var rl=xi+Jr;if(xi<ps){var wa=0-ps,In=Math.min(ps,rl);for(wa+xi<0&&oy(3);xi<In;++xi)Pt[xi]=(void 0)[wa+xi]}for(;xi<rl;++xi)Pt[xi]=Pt[xi-ps]}}Ot.l=ss,Ot.p=Eo,Ot.b=xi,Ot.f=Gi,ss&&(Gi=1,Ot.m=tr,Ot.d=rs,Ot.n=Vs)}while(!Gi);return xi!=Pt.length&&yi?(Hi=Pt,((Ki=xi)==null||Ki>Hi.length)&&(Ki=Hi.length),new Jm(Hi.subarray(0,Ki))):Pt.subarray(0,xi)}(it.subarray(Se,-8),{i:2},new Jm(((Fe=it)[(Qe=Fe.length)-4]|Fe[Qe-3]<<8|Fe[Qe-2]<<16|Fe[Qe-1]<<24)>>>0))));var Fe,Qe,it,Se;const Xe=yS[ke];if(!Xe)throw new Error(`Unhandled codec: ${ke}`);const st=new globalThis.DecompressionStream(Xe);return new Response(new Blob([be]).stream().pipeThrough(st)).arrayBuffer().then(dt=>new Uint8Array(dt))}(K,W).then(be=>(function(ke,Fe){ke.readFields(sS,Fe)}(new gb(be),oe),new _S[w](oe.buffer))),ue.then(be=>{for(let ke=j.length-1;ke>=0;ke--)switch(j[ke]){case"delta_filter":oS(be,C);break;case"zigzag_filter":nS(be);break;case"bitshuffle_filter":aS(be,w);break;default:throw new kg(`Unhandled filter "${j[ke]}"`)}return{layerName:h,blockIndex:O,data:be}}).catch(be=>{throw be})}))},qe(ew,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),qe(xv,"MapboxRasterTile"),qe(Q1,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class sw{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const AS=["id","tile","layer","source","sourceLayer","state"];class y0{constructor(e,i,o,h,f){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=o,this._y=h,this.properties=e.properties,this.id=f}clone(){const e=new y0(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of AS)this[i]!==void 0&&(e[i]=this[i]);return e}}class rw{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new gt(ns,16,0),this.featureIndexArray=new Uu,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,o,h,f,g=0,w=0){const C=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,h,f,g);const O=this.grid;for(let j=0;j<i.length;j++){const W=i[j],K=[1/0,1/0,-1/0,-1/0];for(let oe=0;oe<W.length;oe++){const ue=W[oe];K[0]=Math.min(K[0],ue.x),K[1]=Math.min(K[1],ue.y),K[2]=Math.max(K[2],ue.x),K[3]=Math.max(K[3],ue.y)}w!==0&&(K[0]-=w,K[1]-=w,K[2]+=w,K[3]+=w),K[0]<ns&&K[1]<ns&&K[2]>=0&&K[3]>=0&&O.insert(C,K[0],K[1],K[2],K[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new br.VectorTile(new Hx(this.rawTileData)).layers,this.sourceLayerCoder=new sw(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:o,transform:h,tileTransform:f,pixelPosMatrix:g,availableImages:w,worldview:C}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const O=o.bufferedTilespaceBounds,j=this.grid.query(O.min.x,O.min.y,O.max.x,O.max.y,(ue,be,ke,Fe)=>fm(o.bufferedTilespaceGeometry,ue,be,ke,Fe));j.sort(kS);let W=null;h.elevation&&j.length>0&&(W=p0.create(h.elevation,this.tileID));const K={};let oe;for(let ue=0;ue<j.length;ue++){const be=j[ue];if(be===oe)continue;oe=be;const ke=this.featureIndexArray.get(be);let Fe=null;this.is3DTile?this.loadMatchingModelFeature(K,ke,e,o,h,C):this.loadMatchingFeature(K,ke,e,w,C,(Qe,it,Se,Xe=0)=>(Fe||(Fe=Ts(Qe,this.tileID.canonical,f)),it.queryIntersectsFeature(o,Qe,Se,Fe,this.z,h,g,W,Xe)))}return K}loadMatchingFeature(e,i,o,h,f,g){const{featureIndex:w,bucketIndex:C,sourceLayerIndex:O,layoutVertexArrayOffset:j}=i,W=this.bucketLayerIDs[C],K=o.layers,oe=Object.keys(K);if(oe.length&&!vr(oe,W))return;const ue=o.sourceCache,be=this.sourceLayerCoder.decode(O),ke=this.vtLayers[be].feature(w),Fe=this.getId(ke,be);for(let Qe=0;Qe<W.length;Qe++){const it=W[Qe];if(!K[it])continue;const{styleLayer:Se,targets:Xe}=K[it];let st={};Fe!==void 0&&(st=ue.getFeatureState(Se.sourceLayer,Fe));const dt=!g||g(ke,Se,st,j);if(!dt)continue;const Ot=new y0(ke,this.z,this.x,this.y,Fe);Ot.tile=this.tileID.canonical,Ot.state=st;let Pt=this.serializedLayersCache.get(it);Pt||(Pt=Se.serialize(),Pt.id=it,this.serializedLayersCache.set(it,Pt)),Ot.source=Pt.source,Ot.sourceLayer=Pt["source-layer"],Ot.layer=qt({},Pt),Ot.layer.paint=ow(Pt.paint,Se.paint,ke,st,h),Ot.layer.layout=ow(Pt.layout,Se.layout,ke,st,h);let Dt=!1;for(const Jt of Xe){this.updateFeatureProperties(Ot,Jt);const{filter:yi}=Jt;if(yi){if(ke.properties=Ot.properties,yi.needGeometry){const $i=us(ke,!0);if(!yi.filter(new qr(this.tileID.overscaledZ,{worldview:f}),$i,this.tileID.canonical))continue}else if(!yi.filter(new qr(this.tileID.overscaledZ,{worldview:f}),ke))continue}Dt=!0,Jt.targetId&&this.addFeatureVariant(Ot,Jt)}Dt&&this.appendToResult(e,it,w,Ot,dt)}}loadMatchingModelFeature(e,i,o,h,f,g){const{featureIndex:w,bucketIndex:C}=i,O=this.bucketLayerIDs[C],j=o.layers,W=Object.keys(j);if(!W.length||vr(W,O))for(let K=0;K<O.length;K++){const oe=O[K],{styleLayer:ue,targets:be}=j[oe];if(ue.type!=="model")continue;const ke=h.tile,Fe=ke.getBucket(ue);if(!(Fe&&Fe instanceof dv))continue;const Qe=AT(Fe,w,h,f);if(!Qe)continue;const{z:it,x:Se,y:Xe}=ke.tileID.canonical,{feature:st,intersectionZ:dt,position:Ot}=Qe;let Pt={};st.id!==void 0&&(Pt=o.sourceCache.getFeatureState(ue.sourceLayer,st.id));const Dt=new y0({},it,Se,Xe,st.id);Dt.tile=this.tileID.canonical,Dt.state=Pt,Dt.properties=st.properties,Dt.geometry={type:"Point",coordinates:[Ot.lng,Ot.lat]};let Jt=this.serializedLayersCache.get(oe);Jt||(Jt=ue.serialize(),Jt.id=oe,this.serializedLayersCache.set(oe,Jt)),Dt.source=Jt.source,Dt.sourceLayer=Jt["source-layer"],Dt.layer=qt({},Jt);let yi=!1;for(const $i of be){this.updateFeatureProperties(Dt,$i);const{filter:Ii}=$i;if(Ii){if(st.properties=Dt.properties,Ii.needGeometry){if(!Ii.filter(new qr(this.tileID.overscaledZ,{worldview:g}),st,this.tileID.canonical))continue}else if(!Ii.filter(new qr(this.tileID.overscaledZ,{worldview:g}),st))continue}yi=!0,$i.targetId&&this.addFeatureVariant(Dt,$i)}yi&&this.appendToResult(e,oe,w,Dt,dt)}}updateFeatureProperties(e,i,o){if(i.properties){const h={};for(const f in i.properties){const g=i.properties[f].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,o);g!=null&&(h[f]=g)}e.properties=h}}addFeatureVariant(e,i,o){const h={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(h.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(h)}appendToResult(e,i,o,h,f){let g=e[i];g===void 0&&(g=e[i]=[]),g.push({featureIndex:o,feature:h,intersectionZ:f})}lookupSymbolFeatures(e,i,o,h,f,g){const w={};this.loadVTLayers();for(const C of e)this.loadMatchingFeature(w,{bucketIndex:i,sourceLayerIndex:o,featureIndex:C,layoutVertexArrayOffset:0},h,f,g);return w}loadFeature(e){const{featureIndex:i,sourceLayerIndex:o}=e;this.loadVTLayers();const h=this.sourceLayerCoder.decode(o),f=this.vtFeatures[h];if(f[i])return f[i];const g=this.vtLayers[h].feature(i);return f[i]=g,g}hasLayer(e){for(const i of this.bucketLayerIDs)for(const o of i)if(e===o)return!0;return!1}getId(e,i){let o=e.id;if(this.promoteId){const h=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(h!=null)if(Array.isArray(h)){if(!this.promoteIdExpression){const f=J(h);if(f.result!=="success"){const g=f.value.map(w=>`${w.key}: ${w.message}`).join(", ");return void Ar(`Failed to create expression for promoteId: ${g}`)}this.promoteIdExpression=f.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new ic),o=this.promoteIdExpression.evaluate({zoom:0},e)}else o=e.properties[h];typeof o=="boolean"&&(o=Number(o))}return o}}function ow(s,e,i,o,h){return ds(s,(f,g)=>{const w=e instanceof tp?e.get(g):null;return w&&w.evaluate?w.evaluate(i,o,void 0,h):w})}function kS(s,e){return e-s}qe(rw,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const nw=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class xb{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,o]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=o>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const f=nw[15&o];if(!f)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(e,2,1),[w]=new Uint32Array(e,4,1);return new xb(w,g,f,e)}constructor(e,i=64,o=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const f=nw.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,w=e*this.IndexArrayType.BYTES_PER_ELEMENT,C=(8-w%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${o}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+C,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+w+C),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+C,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=i,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return _b(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,o,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:g,nodeSize:w}=this,C=[0,f.length-1,0],O=[];for(;C.length;){const j=C.pop()||0,W=C.pop()||0,K=C.pop()||0;if(W-K<=w){for(let ke=K;ke<=W;ke++){const Fe=g[2*ke],Qe=g[2*ke+1];Fe>=e&&Fe<=o&&Qe>=i&&Qe<=h&&O.push(f[ke])}continue}const oe=K+W>>1,ue=g[2*oe],be=g[2*oe+1];ue>=e&&ue<=o&&be>=i&&be<=h&&O.push(f[oe]),(j===0?e<=ue:i<=be)&&(C.push(K),C.push(oe-1),C.push(1-j)),(j===0?o>=ue:h>=be)&&(C.push(oe+1),C.push(W),C.push(1-j))}return O}within(e,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:f,nodeSize:g}=this,w=[0,h.length-1,0],C=[],O=o*o;for(;w.length;){const j=w.pop()||0,W=w.pop()||0,K=w.pop()||0;if(W-K<=g){for(let ke=K;ke<=W;ke++)lw(f[2*ke],f[2*ke+1],e,i)<=O&&C.push(h[ke]);continue}const oe=K+W>>1,ue=f[2*oe],be=f[2*oe+1];lw(ue,be,e,i)<=O&&C.push(h[oe]),(j===0?e-o<=ue:i-o<=be)&&(w.push(K),w.push(oe-1),w.push(1-j)),(j===0?e+o>=ue:i+o>=be)&&(w.push(oe+1),w.push(W),w.push(1-j))}return C}}function _b(s,e,i,o,h,f){if(h-o<=i)return;const g=o+h>>1;aw(s,e,g,o,h,f),_b(s,e,i,o,g-1,1-f),_b(s,e,i,g+1,h,1-f)}function aw(s,e,i,o,h,f){for(;h>o;){if(h-o>600){const O=h-o+1,j=i-o+1,W=Math.log(O),K=.5*Math.exp(2*W/3),oe=.5*Math.sqrt(W*K*(O-K)/O)*(j-O/2<0?-1:1);aw(s,e,i,Math.max(o,Math.floor(i-j*K/O+oe)),Math.min(h,Math.floor(i+(O-j)*K/O+oe)),f)}const g=e[2*i+f];let w=o,C=h;for($0(s,e,o,i),e[2*h+f]>g&&$0(s,e,o,h);w<C;){for($0(s,e,w,C),w++,C--;e[2*w+f]<g;)w++;for(;e[2*C+f]>g;)C--}e[2*o+f]===g?$0(s,e,o,C):(C++,$0(s,e,C,h)),C<=i&&(o=C+1),i<=C&&(h=C-1)}}function $0(s,e,i,o){vb(s,i,o),vb(e,2*i,2*o),vb(e,2*i+1,2*o+1)}function vb(s,e,i){const o=s[e];s[e]=s[i],s[i]=o}function lw(s,e,i,o){const h=s-i,f=e-o;return h*h+f*f}a.$=Aa,a.A=Ln,a.B=Jd,a.C=hu,a.D=dp,a.E=zc,a.F=2,a.G=Xt,a.H=Yt,a.I=fl,a.J=rd,a.K=class extends hv{},a.L=ga,a.M=vh,a.N=hd,a.O=bp,a.P=Wi,a.Q=Om,a.R=Dc,a.S=Ge,a.T=eb,a.U=zm,a.V=hv,a.W=Ie,a.X=J,a.Y=nc,a.Z=ru,a._=sr,a.a=function(s){return Ua.API_CDN_URL_REGEX.test(s)},a.a$=li,a.a0=$d,a.a1=Ho,a.a2=Bu,a.a3=nm,a.a4=function(s){const e=s.value;let i=[];if(!e)return i;const o=rd(e);return o!=="string"?(i=i.concat([new hv(s.key,e,`string expected, "${o}" found`)]),i):(rb(e,!0)||(i=i.concat([new hv(s.key,e,`invalid url "${e}"`)])),i)},a.a5=Zt,a.a6=Hc,a.a7=kn,a.a8=Oi,a.a9=class{constructor(s){this.specification=s}possiblyEvaluate(s,e){return nn(s.expression.evaluate(e))}interpolate(s,e,i){return{x:js(s.x,e.x,i),y:js(s.y,e.y,i),z:js(s.z,e.z,i),azimuthal:js(s.azimuthal,e.azimuthal,i),polar:js(s.polar,e.polar,i)}}},a.aA=Ps,a.aB=E,a.aC=gd,a.aD=xt,a.aE=ai,a.aF=function(s,e){const i={};for(let o=0;o<e.length;o++){const h=e[o];h in s&&(i[h]=s[h])}return i},a.aG=lt,a.aH=pt,a.aI=class{constructor(s){this.entries={},this.scheduler=s}request(s,e,i,o){const h=this.entries[s]=this.entries[s]||{callbacks:[]};if(h.result){const[f,g]=h.result;return this.scheduler?this.scheduler.add(()=>{o(f,g)},e):o(f,g),()=>{}}return h.callbacks.push(o),h.cancel||(h.cancel=i((f,g)=>{h.result=[f,g];for(const w of h.callbacks)this.scheduler?this.scheduler.add(()=>{w(f,g)},e):w(f,g);setTimeout(()=>delete this.entries[s],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(f=>f!==o),h.callbacks.length||(h.cancel(),delete this.entries[s]))}}},a.aJ=function(s,e,i){const o=JSON.stringify(s.request);return s.data&&(this.deduped.entries[o]={result:[null,s.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},h=>{const f=Ch(s.request,(g,w,C,O)=>{g?h(g):w&&h(null,{vectorTile:i?void 0:new br.VectorTile(new Hx(w)),rawData:w,cacheControl:C,expires:O})});return()=>{f.cancel(),h()}},e)},a.aK=function(s){Xd++,Xd>yn&&(s.getActor().send("enforceCacheSizeLimit",Ma),Xd=0)},a.aL=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},a.aM=cc,a.aN=t1,a.aO=a1,a.aP=e1,a.aQ=function(s,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let o=0;o<s.length;o++){const h=document.createElement("source");cf(s[o])||(i.crossOrigin="Anonymous"),h.src=s[o],i.appendChild(h)}return{cancel:()=>{}}},a.aR=rv,a.aS=function(s){return fetch(s).then(e=>e.arrayBuffer()).then(e=>v_(e,0,s))},a.aT=iw,a.aU=class{constructor(s,e,i,o){this.id=s,this.position=e!=null?new He(e[0],e[1]):new He(0,0),this.orientation=i??[0,0,0],this.nodes=o,this.uploaded=!1,this.aabb=new Go([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(s,e){if(ar(s.matrix,e,s.matrix),s.meshes)for(const i of s.meshes){const o=Go.applyTransformFast(i.aabb,s.matrix);this.aabb.encapsulate(o)}if(s.children)for(const i of s.children)this._applyTransformations(i,s.matrix)}computeBoundsAndApplyParent(){const s=hs([]);for(const e of this.nodes)this._applyTransformations(e,s)}computeModelMatrix(s,e,i,o,h,f,g=!1){x1(this.matrix,this,s.transform,this.position,e,i,o,h,f,g)}upload(s){if(!this.uploaded){for(const e of this.nodes)nb(e,s);for(const e of this.nodes)cv(e);this.uploaded=!0}}destroy(){for(const s of this.nodes)ab(s)}},a.aV=Ss,a.aW=fe,a.aX=Ct,a.aY=ti,a.aZ=Sf,a.a_=ml,a.aa=qr,a.ab=xe,a.ac=Ft,a.ad=mo,a.ae=No,a.af=zt,a.ag=tp,a.ah=Lp,a.ai=js,a.aj=ns,a.ak=Np,a.al=lr,a.am=So,a.an=class{constructor(s){this.specification=s}possiblyEvaluate(s,e){return function([i,o]){const h=nn([1,i,o]);return{x:h.x,y:h.y,z:h.z}}(s.expression.evaluate(e))}interpolate(s,e,i){return{x:js(s.x,e.x,i),y:js(s.y,e.y,i),z:js(s.z,e.z,i)}}},a.ao=function(s,e,i=0,o=!0){const h=new Wi(i,i),f=s.sub(h),g=e.add(h),w=[f,new Wi(g.x,f.y),g,new Wi(f.x,g.y)];return o&&w.push(f.clone()),w},a.ap=function(s,e){const i=[];for(let o=0;o<s.length;o++){const h=oi(o-1,-1,s.length-1),f=oi(o+1,-1,s.length-1),g=s[o],w=s[f],C=s[h].sub(g).unit(),O=w.sub(g).unit(),j=O.angleWithSep(C.x,C.y),W=C.add(O).unit().mult(-1*e/Math.sin(j/2));i.push(g.add(W))}return i},a.aq=ve,a.ar=fm,a.as=function(s,e,i=0){return pi(((e.x-i)*s.scale-s.x)*ns,(e.y*s.scale-s.y)*ns,si(e.z,e.y))},a.at=Qs,a.au=Lo,a.av=hn,a.aw=s0,a.ax=function(s){let e=1/0,i=1/0,o=-1/0,h=-1/0;for(const f of s)e=Math.min(e,f.x),i=Math.min(i,f.y),o=Math.max(o,f.x),h=Math.max(h,f.y);return{min:new Wi(e,i),max:new Wi(o,h)}},a.ay=at,a.az=ar,a.b=function(s){return Ua.API_FONTS_REGEX.test(s)},a.b$=function(s,e,i){i*=.5;var o=e[0],h=e[1],f=e[2],g=e[3],w=Math.sin(i),C=Math.cos(i);return s[0]=o*C+h*w,s[1]=h*C-o*w,s[2]=f*C+g*w,s[3]=g*C-f*w,s},a.b0=Xo,a.b1=Sm,a.b2=function(){mn.isLoading()||mn.isLoaded()||ta()!=="deferred"||Ea()},a.b3=hg,a.b4=us,a.b5=y0,a.b6=lo,a.b7=tx,a.b8=Rf,a.b9=Ts,a.bA=function(s,e){const{x:i,y:o}=s.point,h=Tx(i,o,s.worldSize/s._pixelsPerMercatorPixel,0,0);return ar(h,h,Fg(Ip(e)))},a.bB=is,a.bC=function(s){return s[0]=0,s[1]=0,s[2]=0,s},a.bD=function(s,e){return Math.hypot(e[0]-s[0],e[1]-s[1],e[2]-s[2])},a.bE=Kn,a.bF=pa,a.bG=Zo,a.bH=te,a.bI=kl,a.bJ=re,a.bK=function(s,e,i,o,h){const f=5*e+2;s.float32[f+0]=i,s.float32[f+1]=o,s.float32[f+2]=h},a.bL=$a,a.bM=Lx,a.bN=kc,a.bO=wh,a.bP=Hg,a.bQ=p1,a.bR=xd,a.bS=Cx,a.bT=q,a.bU=El,a.bV=x,a.bW=xb,a.bX=oi,a.bY=gr,a.bZ=_l,a.b_=jl,a.ba=Vl,a.bb=Vu,a.bc=Uy,a.bd=sa,a.be=Le,a.bf=d0,a.bg=function(s,e){const i=Lp(e.zoom);if(i===0)return Ip(s);const o=Og(s),h=Dg(o),f=xt(o.getWest())*e.worldSize,g=xt(o.getEast())*e.worldSize,w=pt(o.getNorth())*e.worldSize,C=pt(o.getSouth())*e.worldSize,O=[f,w,0],j=[g,w,0],W=[f,C,0],K=[g,C,0],oe=_r([],e.globeMatrix);return mo(O,O,oe),mo(j,j,oe),mo(W,W,oe),mo(K,K,oe),h[0]=rf(h[0],W,i),h[1]=rf(h[1],K,i),h[2]=rf(h[2],j,i),h[3]=rf(h[3],O,i),Go.fromPoints(h)},a.bh=Bg,a.bi=_r,a.bj=zg,a.bk=rf,a.bl=Tf,a.bm=Vy,a.bn=rn,a.bo=Nr,a.bp=xv,a.bq=Hx,a.br=Ch,a.bs=function(s,e){const i=[];for(const o in s)o in e||i.push(o);return i},a.bt=jt,a.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.bv=Ra,a.bw=function(s){var e=new Ui(16);return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],e[9]=s[9],e[10]=s[10],e[11]=s[11],e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15],e},a.bx=hs,a.by=wo,a.bz=zs,a.c=fp,a.c$=wy,a.c0=Kc,a.c1=fn,a.c2=function(s,e){return s[0]=-e[0],s[1]=-e[1],s[2]=-e[2],s[3]=e[3],s},a.c3=fo,a.c4=function(s,e,i,o,h){var f,g=1/Math.tan(e/2);return s[0]=g/i,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=g,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,h!=null&&h!==1/0?(s[10]=(h+o)*(f=1/(o-h)),s[14]=2*h*o*f):(s[10]=-1,s[14]=-2*o),s},a.c5=function(s,e,i,o,h,f,g){var w=1/(e-i),C=1/(o-h),O=1/(f-g);return s[0]=-2*w,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*C,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*O,s[11]=0,s[12]=(e+i)*w,s[13]=(h+o)*C,s[14]=(g+f)*O,s[15]=1,s},a.c6=At,a.c7=function(s,e,i){s[4*e+0]=i[0],s[4*e+1]=i[1],s[4*e+2]=i[2],s[4*e+3]=i[3]},a.c8=Nm,a.c9=fu,a.cA=av,a.cB=pl,a.cC=l1,a.cD=function(s){const e=l1(s,!0);return is([],[e[0],e[1],e[4],e[5]])},a.cE=Or,a.cF=cn,a.cG=ir,a.cH=function(s){const{x:e,y:i}=s.point,{lng:o,lat:h}=s._center;return Tx(e,i,s.worldSize,o,h)},a.cI=Qn,a.cJ=ei,a.cK=gm,a.cL=D,a.cM=function(s,e,i){let o=0;for(let h=0;h<2;++h)s[h]>0&&(o+=(s[h]-0)*(s[h]-0)),e[h]<0&&(o+=(0-e[h])*(0-e[h]));return o},a.cN=function(s){return s*s*s*s*s},a.cO=wt,a.cP=45,a.cQ=um,a.cR=function(s,e,i){const o=Math.sqrt(s*s+e*e+i*i),h=o>0?Math.acos(i/o)*vl:0;let f=s!==0||e!==0?Math.atan2(-e,-s)*vl+90:0;return f<0&&(f+=360),[o,f,h]},a.cS=pi,a.cT=nn,a.cU=ui,a.cV=on,a.cW=Go,a.cX=Io,a.cY=function(s){return[Math.pow(s[0],1/2.2),Math.pow(s[1],1/2.2),Math.pow(s[2],1/2.2)]},a.cZ=rb,a.c_=function(s,e){return s.readFields(CT,{icons:[]},e)},a.ca=ra,a.cb=ih,a.cc=lp,a.cd=He,a.ce=wr,a.cf=function(){var s=new Ui(4);return Ui!=Float32Array&&(s[1]=0,s[2]=0),s[0]=1,s[3]=1,s},a.cg=function(s,e,i){var o=e[0],h=e[1],f=e[2],g=e[3],w=Math.sin(i),C=Math.cos(i);return s[0]=o*C+f*w,s[1]=h*C+g*w,s[2]=o*-w+f*C,s[3]=h*-w+g*C,s},a.ch=function(s,e){return s[0]===e[0]&&s[1]===e[1]&&s[2]===e[2]&&s[3]===e[3]},a.ci=Wh,a.cj=function(s){return Math.hypot(s[0],s[1],s[2],s[3])},a.ck=Oc,a.cl=Sh,a.cm=Ny,a.cn=sn,a.co=h1,a.cp=mm,a.cq=jy,a.cr=function(s,e,i,o,h,f,g,w,C){if(C.name==="globe")return jy(s,e,new mm(i,o,h),!1);const O=fe({z:i,x:o,y:h},C);return new Go([(f+O.x/O.scale)*e,e*(O.y/O.scale),g],[(f+O.x2/O.scale)*e,e*(O.y2/O.scale),w])},a.cs=function(s,e,i){return s[0]=Math.min(e[0],i[0]),s[1]=Math.min(e[1],i[1]),s[2]=Math.min(e[2],i[2]),s[3]=Math.min(e[3],i[3]),s},a.ct=function(s,e,i){return s[0]=Math.max(e[0],i[0]),s[1]=Math.max(e[1],i[1]),s[2]=Math.max(e[2],i[2]),s[3]=Math.max(e[3],i[3]),s},a.cu=function(s){const e=Math.round((s+45+360)%360/90)%4;return Oe[e]},a.cv=wi,a.cw=Lc,a.cx=U,a.cy=function(s){const e=hs(new Float64Array(16));ar(e,s.pixelMatrix,s.globeMatrix);const i=[0,ne,0],o=[0,me,0];return mo(i,i,e),mo(o,o,e),[i[0]>0&&i[0]<=s.width&&i[1]>0&&i[1]<=s.height&&!Vg(s,new He(s.center.lat,90)),o[0]>0&&o[0]<=s.width&&o[1]>0&&o[1]<=s.height&&!Vg(s,new He(s.center.lat,-90))]},a.cz=function(s,e){const{scale:i}=s.tileTransform,o=i*ns/(s.tileSize*Math.pow(2,e.zoom-s.tileID.overscaledZ+s.tileID.canonical.z));return function(h,f,g){var w=f[1],C=f[2],O=f[3],j=g[0],W=g[1];return h[0]=f[0]*j,h[1]=w*j,h[2]=C*W,h[3]=O*W,h}(new Float32Array(4),e.inverseAdjustmentMatrix,[o,o])},a.d=function(s){return Ua.API_TILEJSON_REGEX.test(s)},a.d$=kf,a.d0=kr,a.d1=$s,a.d2=Eh,a.d3=co,a.d4=Kl,a.d5=Ol,a.d6=mr,a.d7=function(s){const e=s.indexOf(Dh);return e>=0?s.slice(0,e):s},a.d8=function(s){return s.indexOf(Dh)>=0},a.d9=function(s){const e=s.lastIndexOf(Dh);return e>=0?s.slice(e+1):""},a.dA=Ng,a.dB=an,a.dC=Il,a.dD=256,a.dE=function(s,e){const i=[0,0,0];return mo(i,i,Bg(Ip(e.canonical))),mo(i,i,s),i},a.dF=s=>({u_matrix:new lp(s),u_texsize:new ih(s),u_pixels_to_tile_units:new Wu(s),u_device_pixel_ratio:new ra(s),u_width_scale:new ra(s),u_floor_width_scale:new ra(s),u_image:new Nm(s),u_units_to_pixels:new ih(s),u_tile_units_to_pixels:new ra(s),u_alpha_discard_threshold:new ra(s),u_trim_offset:new ih(s),u_trim_fade_range:new ih(s),u_trim_color:new um(s),u_emissive_strength:new ra(s),u_zbias_factor:new ra(s),u_tile_to_meter:new ra(s),u_ground_shadow_factor:new fu(s),u_pattern_transition:new ra(s)}),a.dG=s=>({u_matrix:new lp(s),u_pixels_to_tile_units:new Wu(s),u_device_pixel_ratio:new ra(s),u_width_scale:new ra(s),u_floor_width_scale:new ra(s),u_units_to_pixels:new ih(s),u_dash_image:new Nm(s),u_gradient_image:new Nm(s),u_image_height:new ra(s),u_texsize:new ih(s),u_tile_units_to_pixels:new ra(s),u_alpha_discard_threshold:new ra(s),u_trim_offset:new ih(s),u_trim_fade_range:new ih(s),u_trim_color:new um(s),u_emissive_strength:new ra(s),u_zbias_factor:new ra(s),u_tile_to_meter:new ra(s),u_ground_shadow_factor:new fu(s)}),a.dH=s=>({u_camera_to_center_distance:new ra(s),u_extrude_scale:new Wu(s),u_device_pixel_ratio:new ra(s),u_matrix:new lp(s),u_inv_rot_matrix:new lp(s),u_merc_center:new ih(s),u_tile_id:new fu(s),u_zoom_transition:new ra(s),u_up_dir:new fu(s),u_emissive_strength:new ra(s)}),a.dI=lm,a.dJ=a0,a.dK=Ug,a.dL=(s,e,i,o,h,f)=>{const g=s.transform,w=g.projection.name==="globe";let C;if(f.paint.get("circle-pitch-alignment")==="map")if(w){const j=Ng(g.zoom,e.canonical)*g._pixelsPerMercatorPixel;C=Float32Array.from([j,0,0,j])}else C=g.calculatePixelsToTileUnitsMatrix(i);else C=new Float32Array([g.pixelsToGLUnits[0],0,0,g.pixelsToGLUnits[1]]);const O={u_camera_to_center_distance:s.transform.getCameraToCenterDistance(g.projection),u_matrix:s.translatePosMatrix(e.projMatrix,i,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_device_pixel_ratio:$h.devicePixelRatio,u_extrude_scale:C,u_inv_rot_matrix:n_,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:f.paint.get("circle-emissive-strength")};if(w){O.u_inv_rot_matrix=o,O.u_merc_center=h,O.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],O.u_zoom_transition=Lp(g.zoom);const j=h[0]*ns,W=h[1]*ns;O.u_up_dir=g.projection.upVector(new mm(0,0,0),j,W)}return O},a.dM=Nx,a.dN=cl,a.dO=(s,e,i,o,h,f,g,w,C,O)=>{const j=s.transform,W=j.pitch<15?r0(.07,.7,at((14-j.zoom)/5,0,1)):.07,K=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:sx(s,e,i,o),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:j.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:h,u_width_scale:f,u_floor_width_scale:g,u_image:0,u_tile_units_to_pixels:Zm(e,j),u_units_to_pixels:[1/j.pixelsToGLUnits[0],1/j.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:w,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(K?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:W,u_tile_to_meter:ui(e.tileID.canonical,0),u_ground_shadow_factor:C,u_pattern_transition:O}},a.dP=(s,e,i,o,h,f,g,w,C,O)=>{const j=s.transform,W=j.calculatePixelsToTileUnitsMatrix(e),K=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",oe=j.pitch<15?r0(.07,.7,at((14-j.zoom)/5,0,1)):.07;return{u_matrix:sx(s,e,i,o),u_pixels_to_tile_units:W,u_device_pixel_ratio:f,u_width_scale:g,u_floor_width_scale:w,u_units_to_pixels:[1/j.pixelsToGLUnits[0],1/j.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:Vx(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Zm(e,s.transform),u_alpha_discard_threshold:0,u_trim_offset:C,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(K?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:oe,u_tile_to_meter:ui(e.tileID.canonical,0),u_ground_shadow_factor:O}},a.dQ=Zi,a.dR=Q,a.dS=si,a.dT=cy,a.dU=by,a.dV=wg,a.dW=Nd,a.dX=450,a.dY=7,a.dZ=fT,a.d_=bo,a.da=function(s){const e=[],i=s.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),s.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},a.db=function(s,e,i,o){return s.type==="custom"?new mT(s,e):new kT[s.type](s,e,i,o)},a.dc=Ws,a.dd=function(s){const e=s.indexOf(Dh);return e>=0?s.slice(e+1):""},a.de=class extends y0{constructor(s,e){super(s._vectorTileFeature,s._z,s._x,s._y,s.id),s.state&&(this.state=Object.assign({},s.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=s.source,this.sourceLayer=s.sourceLayer,this.layer=s.layer)}toJSON(){const s=super.toJSON();return s.target=this.target,s.namespace=this.namespace,s}},a.df=ya,a.dg=Su,a.dh=function(s){return s({pluginStatus:or,pluginURL:Jo}),ya.on("pluginStateChange",s),s},a.di=Gu,a.dj=class extends pu{constructor(s){super(s),this.current=tf}set(s,e,i){if(this.fetchUniformLocation(s,e)){for(let o=0;o<9;o++)if(i[o]!==this.current[o]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},a.dk=We,a.dl=function(s,e,i){const o=Lp(i.zoom),h=s.style.map._antialias,f=s.terrain&&s.terrain.exaggeration()>0;return o===0&&!h&&!f},a.dm=function(s){const e=s.pixelsPerMeter,i=e/At(1,s.center.lat),o=hs(new Float64Array(16));return Nr(o,o,[s.point.x,s.point.y,0]),Or(o,o,[i,i,e]),Float32Array.from(o)},a.dn=Og,a.dp=function(s){const e=wi-5;s=at(s,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(lr(s))),3);return Math.round(i*(de.length-1))},a.dq=function(s,e,i,o){const h=e.getNorth(),f=e.getSouth(),g=e.getWest(),w=e.getEast(),C=1<<s.z,O=w-g,j=h-f,W=O/ie,K=-j/de[i],oe=[0,W,0,K,0,0,h,g,0];if(s.z>0){const ue=180/o;xs(oe,oe,[ue/O+1,0,0,0,ue/j+1,0,-.5*ue/W,.5*ue/K,1])}return oe[2]=C,oe[5]=s.x,oe[8]=s.y,oe},a.dr=Ip,a.ds=function(s,e,i){const o=hs(new Float64Array(16)),h=(e/(1<<s)-.5)*Math.PI*2;return fr(o,i.globeMatrix,h),Float32Array.from(o)},a.dt=class{isDataAvailableAtPoint(s){const e=this._source();if(this.isUsingMockSource()||!e||s.y<0||s.y>1)return!1;const i=e.getSource().maxzoom,o=1<<i,h=Math.floor(s.x),f=Math.floor((s.x-h)*o),g=Math.floor(s.y*o),w=this.findDEMTileFor(new cc(i,h,i,f,g));return!(!w||!w.dem)}getAtPointOrZero(s,e=0){return this.getAtPoint(s,e)||0}getAtPoint(s,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const o=this._source();if(!o||s.y<0||s.y>1)return e;const h=o.getSource().maxzoom,f=1<<h,g=Math.floor(s.x),w=s.x-g,C=new cc(h,g,h,Math.floor(w*f),Math.floor(s.y*f)),O=this.findDEMTileFor(C);if(!O||!O.dem)return e;const j=O.dem,W=1<<O.tileID.canonical.z,K=(w*W-O.tileID.canonical.x)*j.dim,oe=(s.y*W-O.tileID.canonical.y)*j.dim,ue=Math.floor(K),be=Math.floor(oe);return(i?this.exaggeration():1)*js(js(j.get(ue,be),j.get(ue,be+1),oe-be),js(j.get(ue+1,be),j.get(ue+1,be+1),oe-be),K-ue)}getAtTileOffset(s,e,i){const o=1<<s.canonical.z;return this.getAtPointOrZero(new Ft(s.wrap+(s.canonical.x+e/ns)/o,(s.canonical.y+i/ns)/o))}getAtTileOffsetFunc(s,e,i,o){return h=>{const f=this.getAtTileOffset(s,h.x,h.y),g=o.upVector(s.canonical,h.x,h.y);return gr(g,g,f*o.upVectorScale(s.canonical,e,i).metersToTile),g}}getForTilePoints(s,e,i,o){if(this.isUsingMockSource())return!1;const h=p0.create(this,s,o);return!!h&&(e.forEach(f=>{f[2]=this.exaggeration()*h.getElevationAt(f[0],f[1],i)}),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(s);if(!e||!e.dem)return null;const i=e.dem.tree,o=e.tileID,h=1<<s.canonical.z-o.canonical.z;let f=s.canonical.x/h-o.canonical.x,g=s.canonical.y/h-o.canonical.y,w=0;for(let C=0;C<s.canonical.z-o.canonical.z&&!i.leaves[w];C++){f*=2,g*=2;const O=2*Math.floor(g)+Math.floor(f);w=i.childOffsets[w]+O,f%=1,g%=1}return{min:this.exaggeration()*i.minimums[w],max:this.exaggeration()*i.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const s=this.visibleDemTiles;if(s.length===0)return null;let e=!1,i=Number.MAX_VALUE,o=Number.MIN_VALUE;for(const h of s){const f=this.getMinMaxForTile(h.tileID);f&&(i=Math.min(i,f.min),o=Math.max(o,f.max),e=!0)}return e?{min:i,max:o}:null}},a.du=G,a.dv=gg,a.dw=function(s,e){return[Math.pow(s[0],2.2)*e,Math.pow(s[1],2.2)*e,Math.pow(s[2],2.2)*e]},a.dx=Xs,a.dy=function(s,e){var i=Math.sin(e),o=Math.cos(e);return s[0]=o,s[1]=i,s[2]=0,s[3]=-i,s[4]=o,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},a.dz=ql,a.e=Ua,a.e$=sw,a.e0=256,a.e1=Fg,a.e2=Xc,a.e3=fr,a.e4=function(s,e){return s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[4],s[4]=e[5],s[5]=e[6],s[6]=e[8],s[7]=e[9],s[8]=e[10],s},a.e5=sp,a.e6=rp,a.e7=_f,a.e8=function(s,e,i,o,h){return at((s-e)/(i-e)*(h-o)+o,o,h)},a.e9=Gs,a.eA=function(s,e,i){return s[0]=e[0]/i[0],s[1]=e[1]/i[1],s[2]=e[2]/i[2],s},a.eB=Ic,a.eC=Me,a.eD=Na,a.eE=function(s,e,i,o){return s[0]=e,s[1]=i,s[2]=o,s},a.eF=function([s,e,i]){const o=Math.hypot(s,e,i),h=Math.atan2(s,i),f=.5*Math.PI-Math.acos(-e/o);return new He(ei(h),ei(f))},a.eG=wd,a.eH=ib,a.eI=function(s){const e=s.navigator?s.navigator.userAgent:null;return!!function(i){if(Oo==null){const o=i.navigator?i.navigator.userAgent:null;Oo=!!i.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Oo}(s)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},a.eJ=function(s,e){Ma=s,yn=e},a.eK=Vg,a.eL=Gy,a.eM=function(s){const e=[0,0,0],i=hs(new Float64Array(16));return ar(i,s.pixelMatrix,s.globeMatrix),mo(e,e,i),new Wi(e[0],e[1])},a.eN=function(){const s=Vd;s&&(s.isPreloaded()&&s.numActive()===1?(s.release(zp),Vd=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},a.eO=function(){wy().acquire(zp)},a.eP=ta,a.eQ=function(s,e,i=!1){if(or===bs.deferred||or===bs.loading||or===bs.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Jo=$h.resolveURL(s),or=bs.deferred,Ks=e,eo(),i||Ea()},a.eR=function(s){Sg=$h.resolveURL(s),Ty||(Ty=new dp(wy(),new zc)),Ty.broadcast("setMeshoptUrl",Sg)},a.eS=f_,a.eT=function(s){$m=$h.resolveURL(s),Ty||(Ty=new dp(wy(),new zc)),Ty.broadcast("setDracoUrl",$m)},a.eU=Sy,a.eV=Tg,a.eW=function(s){const e=Zh();if(!e)return;const i=e.delete(Qc);s&&i.then(()=>s()).catch(s)},a.eX=Fh,a.eY=qe,a.eZ=F,a.e_=As,a.ea=function(s,e){var i=e[0],o=e[1],h=e[2],f=e[3],g=e[4],w=e[5],C=e[6],O=e[7],j=e[8],W=j*g-w*O,K=-j*f+w*C,oe=O*f-g*C,ue=i*W+o*K+h*oe;return ue?(s[0]=W*(ue=1/ue),s[1]=(-j*o+h*O)*ue,s[2]=(w*o-h*g)*ue,s[3]=K*ue,s[4]=(j*i-h*C)*ue,s[5]=(-w*i+h*f)*ue,s[6]=oe*ue,s[7]=(-O*i+o*C)*ue,s[8]=(g*i-o*f)*ue,s):null},a.eb=Pl,a.ec=Bi,a.ed=sb,a.ee=function(s,e){if(s===e){var i=e[1],o=e[2],h=e[3],f=e[6],g=e[7],w=e[11];s[1]=e[4],s[2]=e[8],s[3]=e[12],s[4]=i,s[6]=e[9],s[7]=e[13],s[8]=o,s[9]=f,s[11]=e[14],s[12]=h,s[13]=g,s[14]=w}else s[0]=e[0],s[1]=e[4],s[2]=e[8],s[3]=e[12],s[4]=e[1],s[5]=e[5],s[6]=e[9],s[7]=e[13],s[8]=e[2],s[9]=e[6],s[10]=e[10],s[11]=e[14],s[12]=e[3],s[13]=e[7],s[14]=e[11],s[15]=e[15];return s},a.ef=Cs,a.eg=[1,1,1],a.eh=class{constructor(s,e,i,o){this.context=s,this.format=o,this.size=i,this.texture=s.gl.createTexture();const[h,f,g]=this.size,{gl:w}=s;w.bindTexture(w.TEXTURE_3D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),w.texImage3D(w.TEXTURE_3D,0,this.format,h,f,g,0,Jv(this.format),Qv(this.format),e.data)}bind(s,e){const{context:i}=this,{gl:o}=i;o.bindTexture(o.TEXTURE_3D,this.texture),s!==this.minFilter&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MAG_FILTER,s),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MIN_FILTER,s),this.minFilter=s),e!==this.wrapS&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_S,e),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}},a.ei=p0,a.ej=function(s,e,i,o){var h=new Ui(4);return h[0]=s,h[1]=e,h[2]=i,h[3]=o,h},a.ek=qa,a.el=function(s,e,i,o){var h=e[0],f=e[1],g=e[2],w=e[3];return s[0]=h+o*(i[0]-h),s[1]=f+o*(i[1]-f),s[2]=g+o*(i[2]-g),s[3]=w+o*(i[3]-w),s},a.em=u0,a.en=wc,a.eo=bh,a.ep=function(s,e,i,o,h,f,g,w,C,O,j,W,K,oe,ue,be){var ke=new Ui(16);return ke[0]=s,ke[1]=e,ke[2]=i,ke[3]=o,ke[4]=h,ke[5]=f,ke[6]=g,ke[7]=w,ke[8]=C,ke[9]=O,ke[10]=j,ke[11]=W,ke[12]=K,ke[13]=oe,ke[14]=ue,ke[15]=be,ke},a.eq=Pe,a.er=op,a.es=uu,a.et=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Wi(1/0,1/0),max:new Wi(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(s,e=!1){const i=Dp(new Wi(0,0),new Wi(ns,ns),s),o=[];if(e&&!$g(i,this._globalClipBounds))return o;for(const h of this._activeRegions){if(h.hiddenByOverlap||!$g(i,h))continue;const f=yy(h.min,h.max,s);o.push({min:f.min,max:f.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask,clipScope:h.clipScope})}return o}setSources(s){this._setSources(s.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const o of e.cache.getVisibleCoordinates()){const h=e.cache.getTile(o).buckets[e.layer];h&&h.updateFootprints(o.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(s){const e=s.getFootprints();if(e.length===0)return;const i=s.getOrder(),o=s.getClipMask(),h=s.getClipScope();for(const f of e){if(!f.footprint)continue;const g=Dp(f.footprint.min,f.footprint.max,f.id);this._activeRegions.push({min:g.min,max:g.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:f.id,footprint:f.footprint,order:i,clipMask:o,clipScope:h})}this._sourceIds.push(s.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||Xg(e.min,i.min)||Xg(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(o,h){const f=(g,w)=>g+w;return o.length-h.length||o.reduce(f,"").localeCompare(h.reduce(f,""))}(e.clipScope,i.clipScope));let s=this._activeRegions.length!==this._prevRegions.length;if(!s){let e=0;for(;!s&&e!==this._activeRegions.length;){const i=this._activeRegions[e],o=this._prevRegions[e];s=i.priority!==o.priority||!Yg(i,o)||i.order!==o.order||i.clipMask!==o.clipMask||!Ra(i.clipScope,o.clipScope),++e}}if(s){++this._updateTime;for(const i of this._activeRegions)i.order!==Wg&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const o=this._activeRegions;if(i>=o.length)return i;const h=o[i].priority;for(;i<o.length&&o[i].priority===h;)++i;return i};if(this._sourceIds.length>1){let i=0,o=e(i);for(;i!==o;){let h=i;const f=i;for(;h!==o;){const g=this._activeRegions[h];g.hiddenByOverlap=!1;for(let w=0;w<f;w++){const C=this._activeRegions[w];if(!C.hiddenByOverlap&&g.order===Wg&&$g(g,C)&&(g.hiddenByOverlap=xy(g.footprint,g.tileId,C.footprint,C.tileId),g.hiddenByOverlap))break}++h}i=o,o=e(i)}}}}_setSources(s){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=s.length-1;e>=0;e--)this._addSource(s[e]);this._computeReplacement()}},a.eu=Wg,a.ev=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.withSkirts.destroy(),s.withoutSkirts.destroy()}_fillGridMeshWithLods(s,e){const i=new Vl,o=new ml,h=[],f=s+1+2,g=e[0]+1,w=e[0]+1+(1+e.length),C=(O,j,W)=>{let K=O===f-1?O-2:O===0?O:O-1;return K+=W?24575:0,[K,j]};for(let O=0;O<f;++O)i.emplaceBack(...C(O,0,!0));for(let O=0;O<g;++O)for(let j=0;j<f;++j)i.emplaceBack(...C(j,O,(j===0||j===f-1)&&!0));for(let O=0;O<e.length;++O){const j=e[O];for(let W=0;W<f;++W)i.emplaceBack(...C(W,j,!0))}for(let O=0;O<e.length;++O){const j=o.length,W=e[O]+1+2,K=new ml;for(let be=0;be<W-1;be++){const ke=be===W-2,Fe=ke?f*(w-e.length+O-be):f;for(let Qe=0;Qe<f-1;Qe++){const it=be*f+Qe;be===0||ke||Qe===0||Qe===f-2?(K.emplaceBack(it+1,it,it+Fe),K.emplaceBack(it+Fe,it+Fe+1,it+1)):(o.emplaceBack(it+1,it,it+Fe),o.emplaceBack(it+Fe,it+Fe+1,it+1))}}const oe=sa.simpleSegment(0,j,i.length,o.length-j);for(let be=0;be<K.uint16.length;be+=3)o.emplaceBack(K.uint16[be],K.uint16[be+1],K.uint16[be+2]);const ue=sa.simpleSegment(0,j,i.length,o.length-j);h.push({withoutSkirts:oe,withSkirts:ue})}return{vertices:i,indices:o,segments:h}}_createGrid(s){const e=this._fillGridMeshWithLods(ie,de);this._gridSegments=e.segments,this._gridBuffer=s.createVertexBuffer(e.vertices,Uy.members),this._gridIndexBuffer=s.createIndexBuffer(e.indices,!0)}_createPoles(s){const e=new ml;for(let g=0;g<=ie;g++)e.emplaceBack(0,g+1,g+2);this._poleIndexBuffer=s.createIndexBuffer(e,!0);const i=new sp,o=new sp,h=new sp,f=new sp;this._poleSegments=[];for(let g=0,w=0;g<D;g++){const C=360/(1<<g);i.emplaceBack(0,-E,0,.5,0),o.emplaceBack(0,-E,0,.5,1),h.emplaceBack(0,-E,0,.5,.5),f.emplaceBack(0,-E,0,.5,.5);for(let O=0;O<=ie;O++){let j=O/ie,W=0;const K=js(0,C,j),[oe,ue,be]=Ce(fy,Hy,K,E);i.emplaceBack(oe,ue,be,j,W),o.emplaceBack(oe,ue,be,j,1-W);const ke=lr(K);j=.5+.5*Math.sin(ke),W=.5+.5*Math.cos(ke),h.emplaceBack(oe,ue,be,j,W),f.emplaceBack(oe,ue,be,j,1-W)}this._poleSegments.push(sa.simpleSegment(w,0,66,64)),w+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(i,jm,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(o,jm,!1),this._texturedPoleNorthVertexBuffer=s.createVertexBuffer(h,jm,!1),this._texturedPoleSouthVertexBuffer=s.createVertexBuffer(f,jm,!1)}getGridBuffers(s,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[s].withSkirts:this._gridSegments[s].withoutSkirts]}getPoleBuffers(s,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}},a.ew=ct,a.ex=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},a.ey=Et,a.ez=Kt,a.f=function(s){return btoa(encodeURIComponent(s).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},a.f0=rw,a.f1=T_,a.f2=zr,a.f3="hd_road_elevation",a.f4=Bd,a.f5=ds,a.f6=na,a.f7=Ci,a.f8=Ut,a.f9=function(s,e,i,o,h,f,g,w=1,C,O,j){s.createArrays(),s.tilePixelRatio=ns/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const W=s.layers[0].layout,K=s.layers[0]._unevaluatedLayout._values,oe={};oe.scaleFactor=w,oe.textSizeScaleRange=W.get("text-size-scale-range"),oe.iconSizeScaleRange=W.get("icon-size-scale-range");const[ue,be]=oe.textSizeScaleRange,[ke,Fe]=oe.iconSizeScaleRange;oe.textScaleFactor=at(oe.scaleFactor,ue,be),oe.iconScaleFactor=at(oe.scaleFactor,ke,Fe);const Qe=K["text-size"],it=K["icon-size"];if(s.textSizeData.kind==="composite"){const{minZoom:Pt,maxZoom:Dt}=s.textSizeData;oe.compositeTextSizes=[Qe.possiblyEvaluate(new qr(Pt,{worldview:j}),f),Qe.possiblyEvaluate(new qr(Dt,{worldview:j}),f)]}if(s.iconSizeData.kind==="composite"){const{minZoom:Pt,maxZoom:Dt}=s.iconSizeData;oe.compositeIconSizes=[it.possiblyEvaluate(new qr(Pt,{worldview:j}),f),it.possiblyEvaluate(new qr(Dt,{worldview:j}),f)]}oe.layoutTextSize=Qe.possiblyEvaluate(new qr(g+1,{worldview:j}),f),oe.layoutIconSize=it.possiblyEvaluate(new qr(g+1,{worldview:j}),f),oe.textMaxSize=Qe.possiblyEvaluate(new qr(18,{worldview:j}),f);const Se=W.get("symbol-placement"),Xe=W.get("text-rotation-alignment")==="map"&&Se!=="point",st=W.get("text-size");let dt=!1;const Ot=[];for(const Pt of s.features){const Dt=W.get("text-font").evaluate(Pt,{},f).join(","),Jt=st.evaluate(Pt,{},f)*oe.textScaleFactor,yi=oe.layoutTextSize.evaluate(Pt,{},f)*oe.textScaleFactor,$i=oe.layoutIconSize.evaluate(Pt,{},f)*oe.iconScaleFactor,Ii={horizontal:{},vertical:void 0},Hi=Pt.text;let Ki,bi=[0,0];if(Hi){const Mr=Hi.toString(),$r=W.get("text-letter-spacing").evaluate(Pt,{},f)*wh,Wr=W.get("text-line-height").evaluate(Pt,{},f)*wh,uo=Ms(Mr)?$r:0,Kr=W.get("text-anchor").evaluate(Pt,{},f),po=W.get("text-variable-anchor");if(!po){const Si=W.get("text-radial-offset").evaluate(Pt,{},f);if(Si)bi=El(Kr,[Si*wh,oh]);else{const as=W.get("text-offset").evaluate(Pt,{},f);bi=[as[0]*wh,as[1]*wh]}}let Pn=Xe?"center":W.get("text-justify").evaluate(Pt,{},f);const ba=Se==="point",nt=ba?W.get("text-max-width").evaluate(Pt,{},f)*wh:1/0,ft=Si=>{s.allowVerticalPlacement&&ji(Mr)&&(Ii.vertical=Iy(Hi,e,i,h,Dt,nt,Wr,Kr,Si,uo,bi,kl.vertical,!0,yi,Jt,C))};if(!Xe&&po){const Si=Pn==="auto"?po.map(ys=>x(ys)):[Pn];let as=!1;for(let ys=0;ys<Si.length;ys++){const ps=Si[ys];if(!Ii.horizontal[ps])if(as)Ii.horizontal[ps]=Ii.horizontal[0];else{const Ds=Iy(Hi,e,i,h,Dt,nt,Wr,"center",ps,uo,bi,kl.horizontal,!1,yi,Jt,C);Ds&&(Ii.horizontal[ps]=Ds,as=Ds.positionedLines.length===1)}}ft("left")}else{if(Pn==="auto"&&(Pn=x(Kr)),ba||W.get("text-writing-mode").indexOf("horizontal")>=0||!ji(Mr)){const Si=Iy(Hi,e,i,h,Dt,nt,Wr,Kr,Pn,uo,bi,kl.horizontal,!1,yi,Jt,C);Si&&(Ii.horizontal[Pn]=Si)}ft(ba?"left":Pn)}}let Gi,mi,xi,ss,rs,tr,Vs=!1;const gs=W.get("icon-text-fit").evaluate(Pt,{},f);if(Pt.icon&&Pt.icon.hasPrimary()){const Mr=Fp(Pt.icon,s.iconSizeData,K["icon-size"],f,s.zoom,Pt,C,oe.iconScaleFactor,j);Gi=Mr.iconPrimary,xi=Mr.iconSecondary;const $r=Gi.toString();if(mi=o.get($r),mi&&(rs=W.get("icon-offset").evaluate(Pt,{},f),tr=W.get("icon-anchor").evaluate(Pt,{},f),Ki=y(h.get($r),xi?h.get(xi.toString()):void 0,rs,tr),Vs=mi.sdf,s.sdfIcons===void 0?s.sdfIcons=mi.sdf:s.sdfIcons!==mi.sdf&&Ar("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(mi.pixelRatio!==s.pixelRatio||W.get("icon-rotate").constantOr(1)!==0)&&(s.iconsNeedLinear=!0)),xi){const Wr=xi.toString();ss=o.get(Wr)}}dt=dt||!(!Pt.icon||!Pt.icon.hasSecondary());const ts=Y(Ii.horizontal)||Ii.vertical;s.iconsInText||(s.iconsInText=!!ts&&ts.iconsInText);const Br=yi*oe.textScaleFactor/wh,{defaultShapedIcon:Bs,verticallyShapedIcon:Us}=S(s,Ki,W,Pt,f,Ii,Br,rs,gs);gs!=="none"&&Ki&&(A(Ki)||P(Ki))&&(Nh(0,mi,Gi,Ki,Bs,gs,O,o,h),Nh(0,ss,xi,Ki,Bs,gs,O,o,h),Us&&(Nh(0,mi,Gi,Ki,Us,gs,O,o,h),Nh(0,ss,xi,Ki,Us,gs,O,o,h))),Ki=Bs,Ot.push({feature:Pt,shapedTextOrientations:Ii,shapedText:ts,shapedIcon:Ki,iconPrimary:Gi,iconSecondary:xi,iconOffset:rs,iconAnchor:tr,verticallyShapedIcon:Us,layoutTextSize:yi,layoutIconSize:$i,textOffset:bi,isSDFIcon:Vs,iconTextFit:gs})}return{featureData:Ot,sizes:oe,hasAnySecondaryIcon:dt,textAlongLine:Xe,symbolPlacement:Se}},a.fa=di,a.fb=function(s,e,i,o,h,f,g,w,C,O){const{featureData:j,hasAnySecondaryIcon:W,sizes:K,textAlongLine:oe,symbolPlacement:ue}=e;for(const be of j){const{shapedIcon:ke,verticallyShapedIcon:Fe,feature:Qe,shapedTextOrientations:it,shapedText:Se,layoutTextSize:Xe,textOffset:st,isSDFIcon:dt,iconPrimary:Ot,iconSecondary:Pt,iconTextFit:Dt,iconOffset:Jt}=be;H(ke,O.iconPositions,Ot,Pt),H(Fe,O.iconPositions,Ot,Pt),n(it,O.iconPositions),vd(Ot,Pt,O.iconPositions),(Se||ke)&&k(s,Qe,it,ke,Fe,C,K,Xe,0,st,dt,o,h,g,w,W,Dt,Jt,oe,ue)}i&&s.generateCollisionDebugBuffers(f,s.collisionBoxArray,K.textScaleFactor)},a.fc=br,a.fd=yv,a.fe=Zl,a.ff=Er,a.fg=ty,a.fh=Rn,a.fi=function(s){let e=0;if(new Uint32Array(s,0,1)[0]!==qm){const i=new Uint32Array(s,0,7),[,,o,h,f,g]=i;e=i.byteLength+h+f+g+f,(o!==s.byteLength||e>=s.byteLength)&&Ar("Invalid b3dm header information.")}return v_(s,e)},a.fj=function(s,e){const i=iw(s);for(const o of i){for(const h of o.meshes)SS(h);o.lights&&(o.lightMeshIndex=o.meshes.length,o.meshes.push(MS(o.lights,e)))}return i},a.fk=dv,a.fl=ao,a.fm=Qy,a.fn=mn,a.fo=bs,a.fp=function(s){fa(),bl!=null&&bl.then(e=>{e.keys().then(i=>{for(let o=0;o<i.length-s;o++)e.delete(i[o]).catch(h=>Ar(h.message))}).catch(i=>Ar(i.message))}).catch(e=>Ar(e.message))},a.g=function(s,e){return Su(qt(s,{method:"GET"}),e)},a.h=qt,a.i=function(s){return Ua.API_STYLE_REGEX.test(s)&&!fp(s)},a.j=function(s){return s.indexOf("mapbox:")===0},a.k=Xh,a.l=qu,a.m=function(s){return decodeURIComponent(atob(s).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},a.n=function(s,e){return Su(qt(s,{type:"json"}),e)},a.o=ed,a.p=function(s,e){return Su(qt(s,{method:"POST"}),e)},a.q=$h,a.r=V,a.s=function(s){try{const e=self[s];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},a.t=Ah,a.u=function(){return function s(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()},a.v=function(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)},a.w=Ar,a.x=function(){return p_||(p_=new Fh),p_},a.y=pb,a.z=td}),ni(["./shared"],function(a){function Ni(ei){const Oe=ei?ei.url.toString():void 0;return Oe?performance.getEntriesByName(Oe):[]}function Ui(ei){if(typeof ei=="number"||typeof ei=="boolean"||typeof ei=="string"||ei==null)return JSON.stringify(ei);if(Array.isArray(ei)){let We="[";for(const ct of ei)We+=`${Ui(ct)},`;return`${We}]`}let Oe="{";for(const We of Object.keys(ei).sort())Oe+=`${We}:${Ui(ei[We])},`;return`${Oe}}`}function is(ei){let Oe="";for(const We of a.bu)Oe+=`/${Ui(ei[We])}`;return Oe}class Xs{constructor(Oe){this.keyCache={},this._layers={},this._layerConfigs={},Oe&&this.replace(Oe)}replace(Oe,We){this._layerConfigs={},this._layers={},this.update(Oe,[],We)}update(Oe,We,ct){this._options=ct;for(const at of Oe)this._layerConfigs[at.id]=at,(this._layers[at.id]=a.db(at,this.scope,null,this._options)).compileFilter(ct),this.keyCache[at.id]&&delete this.keyCache[at.id];for(const at of We)delete this.keyCache[at],delete this._layerConfigs[at],delete this._layers[at];this.familiesBySource={};const Et=function(at,zt){const oi={};for(let qt=0;qt<at.length;qt++){const gi=at[qt];let li=zt&&zt[gi.id];li||(gi.type==="symbol"?li=gi.id:(li=is(gi),gi.type==="line"&&gi.paint&&function Ss(ds){return typeof ds=="string"&&ds==="line-progress"||(Array.isArray(ds)?ds.some(Ss):!(!ds||typeof ds!="object")&&Object.values(ds).some(Ss))}(gi.paint["line-width"])&&(li+=`/${Ui(gi.paint["line-width"])}`))),zt&&(zt[gi.id]=li);let Zi=oi[li];Zi||(Zi=oi[li]=[]),Zi.push(gi)}const jt=[];for(const qt in oi)jt.push(oi[qt]);return jt}(Object.values(this._layerConfigs),this.keyCache);for(const at of Et){const zt=at.map(Zi=>this._layers[Zi.id]),oi=zt[0];if(oi.visibility==="none")continue;const jt=oi.source||"";let qt=this.familiesBySource[jt];qt||(qt=this.familiesBySource[jt]={});const gi=oi.sourceLayer||"_geojsonTileLayer";let li=qt[gi];li||(li=qt[gi]=[]),li.push(zt)}}}const Qi=1*a.e_;class xs{constructor(Oe){const We={},ct=[];for(const oi in Oe){const jt=Oe[oi],qt=We[oi]={};for(const gi in jt.glyphs){const li=jt.glyphs[+gi];if(!li||li.bitmap.width===0||li.bitmap.height===0)continue;const Zi=li.metrics.localGlyph?Qi:1,Ss={x:0,y:0,w:li.bitmap.width+2*Zi,h:li.bitmap.height+2*Zi};ct.push(Ss),qt[gi]=Ss}}const{w:Et,h:at}=a.H(ct),zt=new a.eZ({width:Et||1,height:at||1});for(const oi in Oe){const jt=Oe[oi];for(const qt in jt.glyphs){const gi=jt.glyphs[+qt];if(!gi||gi.bitmap.width===0||gi.bitmap.height===0)continue;const li=We[oi][qt],Zi=gi.metrics.localGlyph?Qi:1;a.eZ.copy(gi.bitmap,zt,{x:0,y:0},{x:li.x+Zi,y:li.y+Zi},gi.bitmap)}}this.image=zt,this.positions=We}}a.eY(xs,"GlyphAtlas");class zs{constructor(Oe){this.tileID=new a.aM(Oe.tileID.overscaledZ,Oe.tileID.wrap,Oe.tileID.canonical.z,Oe.tileID.canonical.x,Oe.tileID.canonical.y),this.tileZoom=Oe.tileZoom,this.uid=Oe.uid,this.zoom=Oe.zoom,this.lut=Oe.lut,this.canonical=Oe.tileID.canonical,this.pixelRatio=Oe.pixelRatio,this.tileSize=Oe.tileSize,this.source=Oe.source,this.scope=Oe.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Oe.showCollisionBoxes,this.collectResourceTiming=!!Oe.request&&Oe.request.collectResourceTiming,this.promoteId=Oe.promoteId,this.isSymbolTile=Oe.isSymbolTile,this.tileTransform=a.aW(Oe.tileID.canonical,Oe.projection),this.projection=Oe.projection,this.worldview=Oe.worldview,this.localizableLayerIds=Oe.localizableLayerIds,this.brightness=Oe.brightness,this.extraShadowCaster=!!Oe.extraShadowCaster,this.tessellationStep=Oe.tessellationStep,this.scaleFactor=Oe.scaleFactor,this.worldview=Oe.worldview}parse(Oe,We,ct,Et,at,zt){this.status="parsing",this.data=Oe,this.collisionBoxArray=new a.b0;const oi=new a.e$(Object.keys(Oe.layers).sort()),jt=new a.f0(this.tileID,this.promoteId);jt.bucketLayerIDs=[];const qt={},gi=new a.f1(256,256),li={featureIndex:jt,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:gi,availableImages:ct,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},Zi=[],Ss=We.familiesBySource[this.source];for(const Ws in Ss){const mr=Oe.layers[Ws];if(!mr)continue;let vr=!1,Rr=!1,Ar=!1;for(const ao of Ss[Ws])ao[0].type==="symbol"?vr=!0:Rr=!0,ao[0].is3D()&&ao[0].type!=="model"&&(Ar=!0);if(this.extraShadowCaster&&!Ar||this.isSymbolTile===!0&&!vr||this.isSymbolTile===!1&&!Rr)continue;mr.version===1&&a.w(`Vector tile source "${this.source}" layer "${Ws}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ko=oi.encode(Ws),to=[];let nn=!1;for(let ao=0,lo=0;ao<mr.length;ao++){const Oo=mr.feature(ao),fn=jt.getId(Oo,Ws);if(this.localizableLayerIds&&this.localizableLayerIds.has(Ws)){const un=Oo.properties?Oo.properties.worldview:null;if(this.worldview&&typeof un=="string")if(un==="all")Oo.properties.$localized=!0;else{if(!un.split(",").includes(this.worldview))continue;Oo.properties.$localized=!0,Oo.properties.worldview=this.worldview}}!nn&&Oo.properties&&Oo.properties.hasOwnProperty(a.f2)&&(nn=!0),to.push({feature:Oo,id:fn,index:lo,sourceLayerIndex:Ko}),lo++}nn&&!li.elevationFeatures&&Oe.layers.hasOwnProperty(a.f3)&&(li.elevationFeatures=a.f4.parseFrom(Oe.layers[a.f3],this.canonical));for(const ao of Ss[Ws]){const lo=ao[0];if(this.extraShadowCaster&&(!lo.is3D()||lo.type==="model")||this.isSymbolTile!==void 0&&lo.type==="symbol"!==this.isSymbolTile||lo.minzoom&&this.zoom<Math.floor(lo.minzoom)||lo.maxzoom&&this.zoom>=lo.maxzoom||lo.visibility==="none")continue;hs(ao,this.zoom,li.brightness,ct,this.worldview);const Oo=qt[lo.id]=lo.createBucket({index:jt.bucketLayerIDs.length,layers:ao,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ko,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Et,worldview:this.worldview});jt.bucketLayerIDs.push(ao.map(un=>a.C(un.id,un.scope)));let fn=Oo.prepare?Oo.prepare():null;fn!=null?(fn=fn.then(()=>Oo.populate(to,li,this.tileID.canonical,this.tileTransform)),Zi.push(fn)):Oo.populate(to,li,this.tileID.canonical,this.tileTransform)}}const ds=()=>{let Ws,mr,vr,Rr,Ar,Ko;gi.trim();const to={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},nn=()=>{if(Ws)return this.status="done",zt(Ws);if(this.extraShadowCaster)this.status="done",zt(null,{buckets:Object.values(qt).filter(lo=>!lo.isEmpty()),featureIndex:jt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:li.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(mr&&vr&&Rr){const lo=new xs(mr),Oo=new Map;for(const[Ka,an]of vr.entries()){const{imagePosition:Il}=a.f7(Ka,an,a.f8);Oo.set(Ka,Il)}const fn={};for(const Ka in qt){const an=qt[Ka];an instanceof a.b1&&(hs(an.layers,this.zoom,li.brightness,ct,this.worldview),fn[Ka]=a.f9(an,mr,lo.positions,vr,Oo,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Ar,this.worldview))}const un={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(at,vr,Ar,()=>{un.iconsPending=!1,ao(fn,lo,un)}),this.rasterizeIfNeeded(at,Rr,Ko,()=>{un.patternsPending=!1,ao(fn,lo,un)})}},ao=(lo,Oo,fn,un)=>{if(fn.iconsPending||fn.patternsPending)return;const Ka=new a.fa(vr,Rr,this.lut);for(const an in qt){const Il=qt[an];if(an in lo)a.fb(Il,lo[an],this.showCollisionBoxes,ct,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,vr,Ka);else if(Il.hasPattern&&(Il instanceof a.b7||Il instanceof a.b8||Il instanceof a.dU)){hs(Il.layers,this.zoom,li.brightness,ct,this.worldview);const Hh=Object.fromEntries(Ka.patternPositions);Il.addFeatures(li,this.tileID.canonical,Hh,ct,this.tileTransform,this.brightness)}}this.status="done",zt(null,{buckets:Object.values(qt).filter(an=>!an.isEmpty()),featureIndex:jt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Oo.image,lineAtlas:gi,imageAtlas:Ka,brightness:li.brightness})};if(!this.extraShadowCaster){const lo=a.f5(li.glyphDependencies,un=>Object.keys(un).map(Number));Object.keys(lo).length?at.send("getGlyphs",{uid:this.uid,stacks:lo,scope:this.scope},(un,Ka)=>{Ws||(Ws=un,mr=Ka,nn())},void 0,!1,to):mr={};const Oo=Array.from(li.iconDependencies.keys()).map(un=>a.I.parse(un));Oo.length?at.send("getImages",{images:Oo,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(un,Ka)=>{Ws||(Ws=un,vr=new Map,Ar=this.updateImageMapAndGetImageTaskQueue(vr,Ka,li.iconDependencies),nn())},void 0,!1,to):(vr=new Map,Ar=new Map);const fn=Array.from(li.patternDependencies.keys()).map(un=>a.I.parse(un));fn.length?at.send("getImages",{images:fn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(un,Ka)=>{Ws||(Ws=un,Rr=new Map,Ko=this.updateImageMapAndGetImageTaskQueue(Rr,Ka,li.patternDependencies),nn())},void 0,!1,to):(Rr=new Map,Ko=new Map)}if(li.elevationFeatures&&li.elevationFeatures.length>0){const lo=[];for(const fn of Object.values(qt))if(fn instanceof a.b8){const un=fn.getUnevaluatedPortalGraph();un&&lo.push(un)}const Oo=a.f6.evaluate(lo);for(const fn of Object.values(qt))if(fn instanceof a.b8){const un=Oe.layers[oi.decode(fn.sourceLayerIndex)];fn.setEvaluatedPortalGraph(Oo,un,this.tileID.canonical,li.availableImages,li.brightness)}}nn()};Zi.length>0?Promise.allSettled(Zi).then(ds).catch(zt):ds()}rasterizeIfNeeded(Oe,We,ct,Et){Array.from(We.values()).some(at=>at.usvg)?this.rasterize(Oe,We,ct,Et):Et()}updateImageMapAndGetImageTaskQueue(Oe,We,ct){const Et=new Map;for(const at of We.keys()){const zt=ct.get(at)||[];for(const oi of zt){const jt=oi.toString(),qt=We.get(oi.id.toString());qt.usvg?Et.has(jt)||(Et.set(jt,oi),Oe.set(jt,Object.assign({},qt))):Oe.set(jt,qt)}}return Et}rasterize(Oe,We,ct,Et){this.rasterizeTask=Oe.send("rasterizeImages",{scope:this.scope,tasks:ct},(at,zt)=>{if(!at)for(const[oi,jt]of zt.entries()){const qt=Object.assign(We.get(oi),{data:jt});We.set(oi,qt)}Et()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function hs(ei,Oe,We,ct,Et){const at=new a.aa(Oe,{brightness:We,worldview:Et});for(const zt of ei)zt.recalculate(at,ct)}class _r extends a.E{constructor(Oe,We,ct,Et,at,zt,oi){super(),this.actor=Oe,this.layerIndex=We,this.availableImages=ct,this.availableModels=Et,this.loadVectorData=zt||a.aJ,this.loading={},this.loaded={},this.deduped=new a.aI(Oe.scheduler),this.isSpriteLoaded=at,this.scheduler=Oe.scheduler,this.brightness=oi}loadTile(Oe,We){const ct=Oe.uid,Et=Oe&&Oe.request,at=Et&&Et.collectResourceTiming,zt=this.loading[ct]=new zs(Oe);zt.abort=this.loadVectorData(Oe,(oi,jt)=>{const qt=!this.loading[ct];if(delete this.loading[ct],zt.cancelRasterize(),qt||oi||!jt)return zt.status="done",qt||(this.loaded[ct]=zt),We(oi);const gi=jt.rawData,li={};jt.expires&&(li.expires=jt.expires),jt.cacheControl&&(li.cacheControl=jt.cacheControl),zt.vectorTile=jt.vectorTile||new a.fc.VectorTile(new a.bq(gi));const Zi=()=>{zt.parse(zt.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Ss,ds)=>{if(Ss||!ds)return We(Ss);const Ws={};if(at){const mr=Ni(Et);mr.length>0&&(Ws.resourceTiming=JSON.parse(JSON.stringify(mr)))}We(null,a.h({rawTileData:gi.slice(0)},ds,li,Ws))})};this.isSpriteLoaded?Zi():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Zi,{type:"parseTile",isSymbolTile:Oe.isSymbolTile,zoom:Oe.tileZoom}):Zi()}),this.loaded=this.loaded||{},this.loaded[ct]=zt})}reloadTile(Oe,We){const ct=this.loaded,Et=Oe.uid;if(ct&&ct[Et]){const at=ct[Et];at.scaleFactor=Oe.scaleFactor,at.showCollisionBoxes=Oe.showCollisionBoxes,at.projection=Oe.projection,at.brightness=Oe.brightness,at.tileTransform=a.aW(Oe.tileID.canonical,Oe.projection),at.extraShadowCaster=Oe.extraShadowCaster,at.lut=Oe.lut,at.worldview=Oe.worldview;const zt=(oi,jt)=>{const qt=at.reloadCallback;qt&&(delete at.reloadCallback,at.parse(at.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,qt)),We(oi,jt)};at.status==="parsing"?at.reloadCallback=zt:at.status==="done"&&(at.vectorTile?at.parse(at.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,zt):zt())}else We(null,void 0)}abortTile(Oe,We){const ct=Oe.uid,Et=this.loading[ct];Et&&(Et.abort&&Et.abort(),delete this.loading[ct]),We()}removeTile(Oe,We){const ct=this.loaded,Et=Oe.uid;ct&&ct[Et]&&delete ct[Et],We()}}class ar{loadTile(Oe,We){const{uid:ct,encoding:Et,rawImageData:at,padding:zt}=Oe,oi=ImageBitmap&&at instanceof ImageBitmap?this.getImageData(at,zt):at;We(null,new a.fd(ct,oi,Et,zt<1))}reloadTile(Oe,We){We(null,null)}abortTile(Oe,We){We()}removeTile(Oe,We){We()}getImageData(Oe,We){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Oe.width,Oe.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Oe.width,this.offscreenCanvas.height=Oe.height,this.offscreenCanvasContext.drawImage(Oe,0,0,Oe.width,Oe.height);const ct=this.offscreenCanvasContext.getImageData(-We,-We,Oe.width+2*We,Oe.height+2*We);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ct}}a.bp.setPbf(a.bq);class Nr{constructor(Oe){this._mrt=new a.bp(Oe.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=Oe.uid,this.tileID=Oe.tileID,this.source=Oe.source}parse(Oe,We){const ct=this._mrt;this.status="parsing",this._entireBuffer=Oe;try{ct.parseHeader(Oe),this._isHeaderLoaded=!0;const Et=[];for(const at in ct.layers){const zt=ct.getLayer(at),oi=zt.getDataRange(zt.getBandList()),jt=ct.createDecodingTask(oi),qt=Oe.slice(oi.firstByte,oi.lastByte+1),gi=a.bp.performDecoding(qt,jt).then(li=>jt.complete(null,li)).catch(li=>jt.complete(li,null));Et.push(gi)}Promise.allSettled(Et).then(()=>We(null,ct)).catch(at=>We(at))}catch(Et){We(Et)}}}class Or{constructor(Oe){this.actor=Oe,this.loading={},this.loaded={}}loadTile(Oe,We){const ct=Oe.uid,Et=Oe.request,at=this.loading[ct]=new Nr(Oe),{cancel:zt}=a.br(Et,(oi,jt,qt,gi)=>{const li=!this.loading[ct];if(delete this.loading[ct],li||oi||!jt)return at.status="done",li||(this.loaded[ct]=at),We(oi);at.parse(jt,(Zi,Ss)=>{if(Zi||!Ss)return We(Zi);We(null,Ss,qt,gi)}),this.loaded[ct]=at});at.abort=zt}reloadTile(Oe,We){We(null,void 0)}abortTile(Oe,We){const ct=Oe.uid,Et=this.loading[ct];Et&&(Et.abort&&Et.abort(),delete this.loading[ct]),We()}removeTile(Oe,We){const ct=Oe.uid;this.loaded[ct]&&delete this.loaded[ct],We()}decodeRasterArray(Oe,We){a.bp.performDecoding(Oe.buffer,Oe.task).then(ct=>We(null,ct)).catch(ct=>We(ct))}}const ir=a.fc.VectorTileFeature.prototype.toGeoJSON;class fr{constructor(Oe){this._feature=Oe,this.extent=a.aj,this.type=Oe.type,this.properties=Oe.tags,"id"in Oe&&!isNaN(Oe.id)&&(this.id=parseInt(Oe.id,10))}loadGeometry(){if(this._feature.type===1){const Oe=[];for(const We of this._feature.geometry)Oe.push([new a.P(We[0],We[1])]);return Oe}{const Oe=[];for(const We of this._feature.geometry){const ct=[];for(const Et of We)ct.push(new a.P(Et[0],Et[1]));Oe.push(ct)}return Oe}}toGeoJSON(Oe,We,ct){return ir.call(this,Oe,We,ct)}}class wo{constructor(Oe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.aj,this.length=Oe.length,this._features=Oe}feature(Oe){return new fr(this._features[Oe])}}class rn{constructor(Oe,We){this.name=Oe,this.extent=a.aj,this.length=We.length,this._features=We}feature(Oe){return new fr(this._features[Oe])}}class Pi extends wo{constructor(Oe){super([]),this.layers={};for(const We in Oe)this.layers[We]=new rn(We,Oe[We])}}const fo=64/4096,pl=128;class Cs{constructor(){this.features=new Map}clear(){this.features.clear()}load(Oe=[],We){for(const ct of Oe){const Et=ct.id;if(Et==null)continue;let at=this.features.get(Et);at&&this.updateCache(at,We),ct.geometry?(at=No(ct),this.updateCache(at,We),this.features.set(Et,at)):this.features.delete(Et),this.updateCache(at,We)}}updateCache(Oe,We){for(const{canonical:ct,uid:Et}of Object.values(We)){const{z:at,x:zt,y:oi}=ct;Da(Oe,Math.pow(2,at),zt,oi)&&delete We[Et]}}getTile(Oe,We,ct){const Et=Math.pow(2,Oe),at=[];for(const zt of this.features.values())Da(zt,Et,We,ct)&&at.push(Qn(zt,Et,We,ct));return{features:at}}getFeatures(){return[...this.features.values()]}}function Da({minX:ei,minY:Oe,maxX:We,maxY:ct},Et,at,zt){return ei<(at+1+fo)/Et&&Oe<(zt+1+fo)/Et&&We>(at-fo)/Et&&ct>(zt-fo)/Et}function No(ei){const{id:Oe,geometry:We,properties:ct}=ei;if(!We)return;if(We.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Et,coordinates:at}=We,zt={id:Oe,type:1,geometry:[],tags:ct,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},oi=zt.geometry;if(Et==="Point")pi(at,oi,zt);else if(Et==="MultiPoint")for(const jt of at)pi(jt,oi,zt);else if(Et==="LineString")zt.type=2,on(at,oi,zt);else if(Et==="MultiLineString")zt.type=2,Io(at,oi,zt);else if(Et==="Polygon")zt.type=3,Io(at,oi,zt,!0);else{if(Et!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");zt.type=3;for(const jt of at)Io(jt,oi,zt,!0)}return zt}function pi([ei,Oe],We,ct){const Et=a.aD(ei);let at=a.aH(Oe);at=at<0?0:at>1?1:at,We.push(Et,at),ct.minX=Math.min(ct.minX,Et),ct.minY=Math.min(ct.minY,at),ct.maxX=Math.max(ct.maxX,Et),ct.maxY=Math.max(ct.maxY,at)}function on(ei,Oe,We,ct=!1,Et=!1){const at=[];for(const zt of ei)pi(zt,at,We);Oe.push(at),ct&&function(zt,oi){let jt=0;for(let qt=0,gi=zt.length,li=gi-2;qt<gi;li=qt,qt+=2)jt+=(zt[qt]-zt[li])*(zt[qt+1]+zt[li+1]);if(jt>0===oi)for(let qt=0,gi=zt.length;qt<gi/2;qt+=2){const li=zt[qt],Zi=zt[qt+1];zt[qt]=zt[gi-2-qt],zt[qt+1]=zt[gi-1-qt],zt[gi-2-qt]=li,zt[gi-1-qt]=Zi}}(at,Et)}function Io(ei,Oe,We,ct=!1){for(let Et=0;Et<ei.length;Et++)on(ei[Et],Oe,We,ct,Et===0)}function Qn(ei,Oe,We,ct){const{id:Et,type:at,geometry:zt,tags:oi}=ei,jt=[];if(at===1)(function(qt,gi,li,Zi,Ss){for(let ds=0;ds<qt.length;ds+=2){const Ws=Math.round(a.aj*(qt[ds+0]*gi-li)),mr=Math.round(a.aj*(qt[ds+1]*gi-Zi));Ss.push([Ws,mr])}})(zt,Oe,We,ct,jt);else for(const qt of zt)fi(qt,Oe,We,ct,jt);return{id:Et,type:at,geometry:jt,tags:oi}}function fi(ei,Oe,We,ct,Et){const zt=a.aj+pl;let oi;for(let jt=0;jt<ei.length-2;jt+=2){let qt=Math.round(a.aj*(ei[jt+0]*Oe-We)),gi=Math.round(a.aj*(ei[jt+1]*Oe-ct)),li=Math.round(a.aj*(ei[jt+2]*Oe-We)),Zi=Math.round(a.aj*(ei[jt+3]*Oe-ct));const Ss=li-qt,ds=Zi-gi;qt<-128&&li<-128||(qt<-128?(gi+=Math.round(ds*((-128-qt)/Ss)),qt=-128):li<-128&&(Zi=gi+Math.round(ds*((-128-qt)/Ss)),li=-128),gi<-128&&Zi<-128||(gi<-128?(qt+=Math.round(Ss*((-128-gi)/ds)),gi=-128):Zi<-128&&(li=qt+Math.round(Ss*((-128-gi)/ds)),Zi=-128),qt>=zt&&li>=zt||(qt>=zt?(gi+=Math.round(ds*((zt-qt)/Ss)),qt=zt):li>=zt&&(Zi=gi+Math.round(ds*((zt-qt)/Ss)),li=zt),gi>=zt&&Zi>=zt||(gi>=zt?(qt+=Math.round(Ss*((zt-gi)/ds)),gi=zt):Zi>=zt&&(li=qt+Math.round(Ss*((zt-gi)/ds)),Zi=zt),oi&&qt===oi[oi.length-1][0]&&gi===oi[oi.length-1][1]||(oi=[[qt,gi]],Et.push(oi)),oi.push([li,Zi])))))}}var xl,gr,Kn,za={exports:{}},Na=function(){if(Kn)return za.exports;Kn=1;var ei=a.fg(),Oe=function(){if(gr)return xl;gr=1;var gi=a.fe(),li=a.ff().VectorTileFeature;function Zi(ds,Ws){this.options=Ws||{},this.features=ds,this.length=ds.length}function Ss(ds,Ws){this.id=typeof ds.id=="number"?ds.id:void 0,this.type=ds.type,this.rawGeometry=ds.type===1?[ds.geometry]:ds.geometry,this.properties=ds.tags,this.extent=Ws||4096}return xl=Zi,Zi.prototype.feature=function(ds){return new Ss(this.features[ds],this.options.extent)},Ss.prototype.loadGeometry=function(){var ds=this.rawGeometry;this.geometry=[];for(var Ws=0;Ws<ds.length;Ws++){for(var mr=ds[Ws],vr=[],Rr=0;Rr<mr.length;Rr++)vr.push(new gi(mr[Rr][0],mr[Rr][1]));this.geometry.push(vr)}return this.geometry},Ss.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ds=this.geometry,Ws=1/0,mr=-1/0,vr=1/0,Rr=-1/0,Ar=0;Ar<ds.length;Ar++)for(var Ko=ds[Ar],to=0;to<Ko.length;to++){var nn=Ko[to];Ws=Math.min(Ws,nn.x),mr=Math.max(mr,nn.x),vr=Math.min(vr,nn.y),Rr=Math.max(Rr,nn.y)}return[Ws,vr,mr,Rr]},Ss.prototype.toGeoJSON=li.prototype.toGeoJSON,xl}();function We(gi){var li=new ei;return function(Zi,Ss){for(var ds in Zi.layers)Ss.writeMessage(3,ct,Zi.layers[ds])}(gi,li),li.finish()}function ct(gi,li){var Zi;li.writeVarintField(15,gi.version||1),li.writeStringField(1,gi.name||""),li.writeVarintField(5,gi.extent||4096);var Ss={keys:[],values:[],keycache:{},valuecache:{}};for(Zi=0;Zi<gi.length;Zi++)Ss.feature=gi.feature(Zi),li.writeMessage(2,Et,Ss);var ds=Ss.keys;for(Zi=0;Zi<ds.length;Zi++)li.writeStringField(3,ds[Zi]);var Ws=Ss.values;for(Zi=0;Zi<Ws.length;Zi++)li.writeMessage(4,qt,Ws[Zi])}function Et(gi,li){var Zi=gi.feature;Zi.id!==void 0&&li.writeVarintField(1,Zi.id),li.writeMessage(2,at,gi),li.writeVarintField(3,Zi.type),li.writeMessage(4,jt,Zi)}function at(gi,li){var Zi=gi.feature,Ss=gi.keys,ds=gi.values,Ws=gi.keycache,mr=gi.valuecache;for(var vr in Zi.properties){var Rr=Zi.properties[vr],Ar=Ws[vr];if(Rr!==null){Ar===void 0&&(Ss.push(vr),Ws[vr]=Ar=Ss.length-1),li.writeVarint(Ar);var Ko=typeof Rr;Ko!=="string"&&Ko!=="boolean"&&Ko!=="number"&&(Rr=JSON.stringify(Rr));var to=Ko+":"+Rr,nn=mr[to];nn===void 0&&(ds.push(Rr),mr[to]=nn=ds.length-1),li.writeVarint(nn)}}}function zt(gi,li){return(li<<3)+(7&gi)}function oi(gi){return gi<<1^gi>>31}function jt(gi,li){for(var Zi=gi.loadGeometry(),Ss=gi.type,ds=0,Ws=0,mr=Zi.length,vr=0;vr<mr;vr++){var Rr=Zi[vr],Ar=1;Ss===1&&(Ar=Rr.length),li.writeVarint(zt(1,Ar));for(var Ko=Ss===3?Rr.length-1:Rr.length,to=0;to<Ko;to++){to===1&&Ss!==1&&li.writeVarint(zt(2,Ko-1));var nn=Rr[to].x-ds,ao=Rr[to].y-Ws;li.writeVarint(oi(nn)),li.writeVarint(oi(ao)),ds+=nn,Ws+=ao}Ss===3&&li.writeVarint(zt(7,1))}}function qt(gi,li){var Zi=typeof gi;Zi==="string"?li.writeStringField(1,gi):Zi==="boolean"?li.writeBooleanField(7,gi):Zi==="number"&&(gi%1!=0?li.writeDoubleField(3,gi):gi<0?li.writeSVarintField(6,gi):li.writeVarintField(5,gi))}return za.exports=We,za.exports.fromVectorTileJs=We,za.exports.fromGeojsonVt=function(gi,li){li=li||{};var Zi={};for(var Ss in gi)Zi[Ss]=new Oe(gi[Ss].features,li),Zi[Ss].name=Ss,Zi[Ss].version=li.version,Zi[Ss].extent=li.extent;return We({layers:Zi})},za.exports.GeoJSONWrapper=Oe,za.exports}(),Pl=a.fh(Na);const Lo={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ei=>ei},Zo=Math.fround||(pa=new Float32Array(1),ei=>(pa[0]=+ei,pa[0]));var pa;const Ul=3,mo=5,ql=6;class Sh{constructor(Oe){this.options=Object.assign(Object.create(Lo),Oe),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Oe){const{log:We,minZoom:ct,maxZoom:Et}=this.options;We&&console.time("total time");const at=`prepare ${Oe.length} points`;We&&console.time(at),this.points=Oe;const zt=[];for(let jt=0;jt<Oe.length;jt++){const qt=Oe[jt];if(!qt.geometry)continue;const[gi,li]=qt.geometry.coordinates,Zi=Zo(Ic(gi)),Ss=Zo(_l(li));zt.push(Zi,Ss,1/0,jt,-1,1),this.options.reduce&&zt.push(0)}let oi=this.trees[Et+1]=this._createTree(zt);We&&console.timeEnd(at);for(let jt=Et;jt>=ct;jt--){const qt=+Date.now();oi=this.trees[jt]=this._createTree(this._cluster(oi,jt)),We&&console.log("z%d: %d clusters in %dms",jt,oi.numItems,+Date.now()-qt)}return We&&console.timeEnd("total time"),this}getClusters(Oe,We){let ct=((Oe[0]+180)%360+360)%360-180;const Et=Math.max(-90,Math.min(90,Oe[1]));let at=Oe[2]===180?180:((Oe[2]+180)%360+360)%360-180;const zt=Math.max(-90,Math.min(90,Oe[3]));if(Oe[2]-Oe[0]>=360)ct=-180,at=180;else if(ct>at){const li=this.getClusters([ct,Et,180,zt],We),Zi=this.getClusters([-180,Et,at,zt],We);return li.concat(Zi)}const oi=this.trees[this._limitZoom(We)],jt=oi.range(Ic(ct),_l(zt),Ic(at),_l(Et)),qt=oi.data,gi=[];for(const li of jt){const Zi=this.stride*li;gi.push(qt[Zi+mo]>1?Wh(qt,Zi,this.clusterProps):this.points[qt[Zi+Ul]])}return gi}getChildren(Oe){const We=this._getOriginId(Oe),ct=this._getOriginZoom(Oe),Et="No cluster with the specified id.",at=this.trees[ct];if(!at)throw new Error(Et);const zt=at.data;if(We*this.stride>=zt.length)throw new Error(Et);const oi=this.options.radius/(this.options.extent*Math.pow(2,ct-1)),jt=at.within(zt[We*this.stride],zt[We*this.stride+1],oi),qt=[];for(const gi of jt){const li=gi*this.stride;zt[li+4]===Oe&&qt.push(zt[li+mo]>1?Wh(zt,li,this.clusterProps):this.points[zt[li+Ul]])}if(qt.length===0)throw new Error(Et);return qt}getLeaves(Oe,We,ct){const Et=[];return this._appendLeaves(Et,Oe,We=We||10,ct=ct||0,0),Et}getTile(Oe,We,ct){const Et=this.trees[this._limitZoom(Oe)],at=Math.pow(2,Oe),{extent:zt,radius:oi}=this.options,jt=oi/zt,qt=(ct-jt)/at,gi=(ct+1+jt)/at,li={features:[]};return this._addTileFeatures(Et.range((We-jt)/at,qt,(We+1+jt)/at,gi),Et.data,We,ct,at,li),We===0&&this._addTileFeatures(Et.range(1-jt/at,qt,1,gi),Et.data,at,ct,at,li),We===at-1&&this._addTileFeatures(Et.range(0,qt,jt/at,gi),Et.data,-1,ct,at,li),li.features.length?li:null}getClusterExpansionZoom(Oe){let We=this._getOriginZoom(Oe)-1;for(;We<=this.options.maxZoom;){const ct=this.getChildren(Oe);if(We++,ct.length!==1)break;Oe=ct[0].properties.cluster_id}return We}_appendLeaves(Oe,We,ct,Et,at){const zt=this.getChildren(We);for(const oi of zt){const jt=oi.properties;if(jt&&jt.cluster?at+jt.point_count<=Et?at+=jt.point_count:at=this._appendLeaves(Oe,jt.cluster_id,ct,Et,at):at<Et?at++:Oe.push(oi),Oe.length===ct)break}return at}_createTree(Oe){const We=new a.bW(Oe.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ct=0;ct<Oe.length;ct+=this.stride)We.add(Oe[ct],Oe[ct+1]);return We.finish(),We.data=Oe,We}_addTileFeatures(Oe,We,ct,Et,at,zt){for(const oi of Oe){const jt=oi*this.stride,qt=We[jt+mo]>1;let gi,li,Zi;if(qt)gi=Qs(We,jt,this.clusterProps),li=We[jt],Zi=We[jt+1];else{const Ws=this.points[We[jt+Ul]];gi=Ws.properties;const[mr,vr]=Ws.geometry.coordinates;li=Ic(mr),Zi=_l(vr)}const Ss={type:1,geometry:[[Math.round(this.options.extent*(li*at-ct)),Math.round(this.options.extent*(Zi*at-Et))]],tags:gi};let ds;ds=qt||this.options.generateId?We[jt+Ul]:this.points[We[jt+Ul]].id,ds!==void 0&&(Ss.id=ds),zt.features.push(Ss)}}_limitZoom(Oe){return Math.max(this.options.minZoom,Math.min(Math.floor(+Oe),this.options.maxZoom+1))}_cluster(Oe,We){const{radius:ct,extent:Et,reduce:at,minPoints:zt}=this.options,oi=ct/(Et*Math.pow(2,We)),jt=Oe.data,qt=[],gi=this.stride;for(let li=0;li<jt.length;li+=gi){if(jt[li+2]<=We)continue;jt[li+2]=We;const Zi=jt[li],Ss=jt[li+1],ds=Oe.within(jt[li],jt[li+1],oi),Ws=jt[li+mo];let mr=Ws;for(const vr of ds){const Rr=vr*gi;jt[Rr+2]>We&&(mr+=jt[Rr+mo])}if(mr>Ws&&mr>=zt){let vr,Rr=Zi*Ws,Ar=Ss*Ws,Ko=-1;const to=(li/gi<<5)+(We+1)+this.points.length;for(const nn of ds){const ao=nn*gi;if(jt[ao+2]<=We)continue;jt[ao+2]=We;const lo=jt[ao+mo];Rr+=jt[ao]*lo,Ar+=jt[ao+1]*lo,jt[ao+4]=to,at&&(vr||(vr=this._map(jt,li,!0),Ko=this.clusterProps.length,this.clusterProps.push(vr)),at(vr,this._map(jt,ao)))}jt[li+4]=to,qt.push(Rr/mr,Ar/mr,1/0,to,-1,mr),at&&qt.push(Ko)}else{for(let vr=0;vr<gi;vr++)qt.push(jt[li+vr]);if(mr>1)for(const vr of ds){const Rr=vr*gi;if(!(jt[Rr+2]<=We)){jt[Rr+2]=We;for(let Ar=0;Ar<gi;Ar++)qt.push(jt[Rr+Ar])}}}}return qt}_getOriginId(Oe){return Oe-this.points.length>>5}_getOriginZoom(Oe){return(Oe-this.points.length)%32}_map(Oe,We,ct){if(Oe[We+mo]>1){const zt=this.clusterProps[Oe[We+ql]];return ct?Object.assign({},zt):zt}const Et=this.points[Oe[We+Ul]].properties,at=this.options.map(Et);return ct&&at===Et?Object.assign({},at):at}}function Wh(ei,Oe,We){return{type:"Feature",id:ei[Oe+Ul],properties:Qs(ei,Oe,We),geometry:{type:"Point",coordinates:[(ct=ei[Oe],360*(ct-.5)),qa(ei[Oe+1])]}};var ct}function Qs(ei,Oe,We){const ct=ei[Oe+mo],Et=ct>=1e4?`${Math.round(ct/1e3)}k`:ct>=1e3?Math.round(ct/100)/10+"k":ct,at=ei[Oe+ql],zt=at===-1?{}:Object.assign({},We[at]);return Object.assign(zt,{cluster:!0,cluster_id:ei[Oe+Ul],point_count:ct,point_count_abbreviated:Et})}function Ic(ei){return ei/360+.5}function _l(ei){const Oe=Math.sin(ei*Math.PI/180),We=.5-.25*Math.log((1+Oe)/(1-Oe))/Math.PI;return We<0?0:We>1?1:We}function qa(ei){const Oe=(180-360*ei)*Math.PI/180;return 360*Math.atan(Math.exp(Oe))/Math.PI-90}function Lc(ei,Oe,We,ct){let Et=ct;const at=Oe+(We-Oe>>1);let zt,oi=We-Oe;const jt=ei[Oe],qt=ei[Oe+1],gi=ei[We],li=ei[We+1];for(let Zi=Oe+3;Zi<We;Zi+=3){const Ss=wd(ei[Zi],ei[Zi+1],jt,qt,gi,li);if(Ss>Et)zt=Zi,Et=Ss;else if(Ss===Et){const ds=Math.abs(Zi-at);ds<oi&&(zt=Zi,oi=ds)}}Et>ct&&(zt-Oe>3&&Lc(ei,Oe,zt,ct),ei[zt+2]=Et,We-zt>3&&Lc(ei,zt,We,ct))}function wd(ei,Oe,We,ct,Et,at){let zt=Et-We,oi=at-ct;if(zt!==0||oi!==0){const jt=((ei-We)*zt+(Oe-ct)*oi)/(zt*zt+oi*oi);jt>1?(We=Et,ct=at):jt>0&&(We+=zt*jt,ct+=oi*jt)}return zt=ei-We,oi=Oe-ct,zt*zt+oi*oi}function Ps(ei,Oe,We,ct){const Et={id:ei??null,type:Oe,geometry:We,tags:ct,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Oe==="Point"||Oe==="MultiPoint"||Oe==="LineString")nl(Et,We);else if(Oe==="Polygon")nl(Et,We[0]);else if(Oe==="MultiLineString")for(const at of We)nl(Et,at);else if(Oe==="MultiPolygon")for(const at of We)nl(Et,at[0]);return Et}function nl(ei,Oe){for(let We=0;We<Oe.length;We+=3)ei.minX=Math.min(ei.minX,Oe[We]),ei.minY=Math.min(ei.minY,Oe[We+1]),ei.maxX=Math.max(ei.maxX,Oe[We]),ei.maxY=Math.max(ei.maxY,Oe[We+1])}function jl(ei,Oe,We,ct){if(!Oe.geometry)return;const Et=Oe.geometry.coordinates;if(Et&&Et.length===0)return;const at=Oe.geometry.type,zt=Math.pow(We.tolerance/((1<<We.maxZoom)*We.extent),2);let oi=[],jt=Oe.id;if(We.promoteId?jt=Oe.properties[We.promoteId]:We.generateId&&(jt=ct||0),at==="Point")Kc(Et,oi);else if(at==="MultiPoint")for(const qt of Et)Kc(qt,oi);else if(at==="LineString")Gs(Et,oi,zt,!1);else if(at==="MultiLineString"){if(We.lineMetrics){for(const qt of Et)oi=[],Gs(qt,oi,zt,!1),ei.push(Ps(jt,"LineString",oi,Oe.properties));return}zn(Et,oi,zt,!1)}else if(at==="Polygon")zn(Et,oi,zt,!0);else{if(at!=="MultiPolygon"){if(at==="GeometryCollection"){for(const qt of Oe.geometry.geometries)jl(ei,{id:jt,geometry:qt,properties:Oe.properties},We,ct);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const qt of Et){const gi=[];zn(qt,gi,zt,!0),oi.push(gi)}}ei.push(Ps(jt,at,oi,Oe.properties))}function Kc(ei,Oe){Oe.push(Gl(ei[0]),fc(ei[1]),0)}function Gs(ei,Oe,We,ct){let Et,at,zt=0;for(let jt=0;jt<ei.length;jt++){const qt=Gl(ei[jt][0]),gi=fc(ei[jt][1]);Oe.push(qt,gi,0),jt>0&&(zt+=ct?(Et*gi-qt*at)/2:Math.sqrt(Math.pow(qt-Et,2)+Math.pow(gi-at,2))),Et=qt,at=gi}const oi=Oe.length-3;Oe[2]=1,Lc(Oe,0,oi,We),Oe[oi+2]=1,Oe.size=Math.abs(zt),Oe.start=0,Oe.end=Oe.size}function zn(ei,Oe,We,ct){for(let Et=0;Et<ei.length;Et++){const at=[];Gs(ei[Et],at,We,ct),Oe.push(at)}}function Gl(ei){return ei/360+.5}function fc(ei){const Oe=Math.sin(ei*Math.PI/180),We=.5-.25*Math.log((1+Oe)/(1-Oe))/Math.PI;return We<0?0:We>1?1:We}function al(ei,Oe,We,ct,Et,at,zt,oi){if(ct/=Oe,at>=(We/=Oe)&&zt<ct)return ei;if(zt<We||at>=ct)return null;const jt=[];for(const qt of ei){const gi=qt.geometry;let li=qt.type;const Zi=Et===0?qt.minX:qt.minY,Ss=Et===0?qt.maxX:qt.maxY;if(Zi>=We&&Ss<ct){jt.push(qt);continue}if(Ss<We||Zi>=ct)continue;let ds=[];if(li==="Point"||li==="MultiPoint")Gd(gi,ds,We,ct,Et);else if(li==="LineString")Oc(gi,ds,We,ct,Et,!1,oi.lineMetrics);else if(li==="MultiLineString")ll(gi,ds,We,ct,Et,!1);else if(li==="Polygon")ll(gi,ds,We,ct,Et,!0);else if(li==="MultiPolygon")for(const Ws of gi){const mr=[];ll(Ws,mr,We,ct,Et,!0),mr.length&&ds.push(mr)}if(ds.length){if(oi.lineMetrics&&li==="LineString"){for(const Ws of ds)jt.push(Ps(qt.id,li,Ws,qt.tags));continue}li!=="LineString"&&li!=="MultiLineString"||(ds.length===1?(li="LineString",ds=ds[0]):li="MultiLineString"),li!=="Point"&&li!=="MultiPoint"||(li=ds.length===3?"Point":"MultiPoint"),jt.push(Ps(qt.id,li,ds,qt.tags))}}return jt.length?jt:null}function Gd(ei,Oe,We,ct,Et){for(let at=0;at<ei.length;at+=3){const zt=ei[at+Et];zt>=We&&zt<=ct&&Mh(Oe,ei[at],ei[at+1],ei[at+2])}}function Oc(ei,Oe,We,ct,Et,at,zt){let oi=mh(ei);const jt=Et===0?Sa:Wl;let qt,gi,li=ei.start;for(let mr=0;mr<ei.length-3;mr+=3){const vr=ei[mr],Rr=ei[mr+1],Ar=ei[mr+2],Ko=ei[mr+3],to=ei[mr+4],nn=Et===0?vr:Rr,ao=Et===0?Ko:to;let lo=!1;zt&&(qt=Math.sqrt(Math.pow(vr-Ko,2)+Math.pow(Rr-to,2))),nn<We?ao>We&&(gi=jt(oi,vr,Rr,Ko,to,We),zt&&(oi.start=li+qt*gi)):nn>ct?ao<ct&&(gi=jt(oi,vr,Rr,Ko,to,ct),zt&&(oi.start=li+qt*gi)):Mh(oi,vr,Rr,Ar),ao<We&&nn>=We&&(gi=jt(oi,vr,Rr,Ko,to,We),lo=!0),ao>ct&&nn<=ct&&(gi=jt(oi,vr,Rr,Ko,to,ct),lo=!0),!at&&lo&&(zt&&(oi.end=li+qt*gi),Oe.push(oi),oi=mh(ei)),zt&&(li+=qt)}let Zi=ei.length-3;const Ss=ei[Zi],ds=ei[Zi+1],Ws=Et===0?Ss:ds;Ws>=We&&Ws<=ct&&Mh(oi,Ss,ds,ei[Zi+2]),Zi=oi.length-3,at&&Zi>=3&&(oi[Zi]!==oi[0]||oi[Zi+1]!==oi[1])&&Mh(oi,oi[0],oi[1],oi[2]),oi.length&&Oe.push(oi)}function mh(ei){const Oe=[];return Oe.size=ei.size,Oe.start=ei.start,Oe.end=ei.end,Oe}function ll(ei,Oe,We,ct,Et,at){for(const zt of ei)Oc(zt,Oe,We,ct,Et,at,!1)}function Mh(ei,Oe,We,ct){ei.push(Oe,We,ct)}function Sa(ei,Oe,We,ct,Et,at){const zt=(at-Oe)/(ct-Oe);return Mh(ei,at,We+(Et-We)*zt,1),zt}function Wl(ei,Oe,We,ct,Et,at){const zt=(at-We)/(Et-We);return Mh(ei,Oe+(ct-Oe)*zt,at,1),zt}function Tu(ei,Oe){const We=[];for(let ct=0;ct<ei.length;ct++){const Et=ei[ct],at=Et.type;let zt;if(at==="Point"||at==="MultiPoint"||at==="LineString")zt=Jc(Et.geometry,Oe);else if(at==="MultiLineString"||at==="Polygon"){zt=[];for(const oi of Et.geometry)zt.push(Jc(oi,Oe))}else if(at==="MultiPolygon"){zt=[];for(const oi of Et.geometry){const jt=[];for(const qt of oi)jt.push(Jc(qt,Oe));zt.push(jt)}}We.push(Ps(Et.id,at,zt,Et.tags))}return We}function Jc(ei,Oe){const We=[];We.size=ei.size,ei.start!==void 0&&(We.start=ei.start,We.end=ei.end);for(let ct=0;ct<ei.length;ct+=3)We.push(ei[ct]+Oe,ei[ct+1],ei[ct+2]);return We}function Td(ei,Oe){if(ei.transformed)return ei;const We=1<<ei.z,ct=ei.x,Et=ei.y;for(const at of ei.features){const zt=at.geometry,oi=at.type;if(at.geometry=[],oi===1)for(let jt=0;jt<zt.length;jt+=2)at.geometry.push(To(zt[jt],zt[jt+1],Oe,We,ct,Et));else for(let jt=0;jt<zt.length;jt++){const qt=[];for(let gi=0;gi<zt[jt].length;gi+=2)qt.push(To(zt[jt][gi],zt[jt][gi+1],Oe,We,ct,Et));at.geometry.push(qt)}}return ei.transformed=!0,ei}function To(ei,Oe,We,ct,Et,at){return[Math.round(We*(ei*ct-Et)),Math.round(We*(Oe*ct-at))]}function Rn(ei,Oe,We,ct,Et){const at=Oe===Et.maxZoom?0:Et.tolerance/((1<<Oe)*Et.extent),zt={features:[],numPoints:0,numSimplified:0,numFeatures:ei.length,source:null,x:We,y:ct,z:Oe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const oi of ei)Za(zt,oi,at,Et);return zt}function Za(ei,Oe,We,ct){const Et=Oe.geometry,at=Oe.type,zt=[];if(ei.minX=Math.min(ei.minX,Oe.minX),ei.minY=Math.min(ei.minY,Oe.minY),ei.maxX=Math.max(ei.maxX,Oe.maxX),ei.maxY=Math.max(ei.maxY,Oe.maxY),at==="Point"||at==="MultiPoint")for(let oi=0;oi<Et.length;oi+=3)zt.push(Et[oi],Et[oi+1]),ei.numPoints++,ei.numSimplified++;else if(at==="LineString")Hl(zt,Et,ei,We,!1,!1);else if(at==="MultiLineString"||at==="Polygon")for(let oi=0;oi<Et.length;oi++)Hl(zt,Et[oi],ei,We,at==="Polygon",oi===0);else if(at==="MultiPolygon")for(let oi=0;oi<Et.length;oi++){const jt=Et[oi];for(let qt=0;qt<jt.length;qt++)Hl(zt,jt[qt],ei,We,!0,qt===0)}if(zt.length){let oi=Oe.tags||null;if(at==="LineString"&&ct.lineMetrics){oi={};for(const qt in Oe.tags)oi[qt]=Oe.tags[qt];oi.mapbox_clip_start=Et.start/Et.size,oi.mapbox_clip_end=Et.end/Et.size}const jt={geometry:zt,type:at==="Polygon"||at==="MultiPolygon"?3:at==="LineString"||at==="MultiLineString"?2:1,tags:oi};Oe.id!==null&&(jt.id=Oe.id),ei.features.push(jt)}}function Hl(ei,Oe,We,ct,Et,at){const zt=ct*ct;if(ct>0&&Oe.size<(Et?zt:ct))return void(We.numPoints+=Oe.length/3);const oi=[];for(let jt=0;jt<Oe.length;jt+=3)(ct===0||Oe[jt+2]>zt)&&(We.numSimplified++,oi.push(Oe[jt],Oe[jt+1])),We.numPoints++;Et&&function(jt,qt){let gi=0;for(let li=0,Zi=jt.length,Ss=Zi-2;li<Zi;Ss=li,li+=2)gi+=(jt[li]-jt[Ss])*(jt[li+1]+jt[Ss+1]);if(gi>0===qt)for(let li=0,Zi=jt.length;li<Zi/2;li+=2){const Ss=jt[li],ds=jt[li+1];jt[li]=jt[Zi-2-li],jt[li+1]=jt[Zi-1-li],jt[Zi-2-li]=Ss,jt[Zi-1-li]=ds}}(oi,at),ei.push(oi)}const mc={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Va{constructor(Oe,We){const ct=(We=this.options=function(at,zt){for(const oi in zt)at[oi]=zt[oi];return at}(Object.create(mc),We)).debug;if(ct&&console.time("preprocess data"),We.maxZoom<0||We.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(We.promoteId&&We.generateId)throw new Error("promoteId and generateId cannot be used together.");let Et=function(at,zt){const oi=[];if(at.type==="FeatureCollection")for(let jt=0;jt<at.features.length;jt++)jl(oi,at.features[jt],zt,jt);else jl(oi,at.type==="Feature"?at:{geometry:at},zt);return oi}(Oe,We);this.tiles={},this.tileCoords=[],ct&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",We.indexMaxZoom,We.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Et=function(at,zt){const oi=zt.buffer/zt.extent;let jt=at;const qt=al(at,1,-1-oi,oi,0,-1,2,zt),gi=al(at,1,1-oi,2+oi,0,-1,2,zt);return(qt||gi)&&(jt=al(at,1,-oi,1+oi,0,-1,2,zt)||[],qt&&(jt=Tu(qt,1).concat(jt)),gi&&(jt=jt.concat(Tu(gi,-1)))),jt}(Et,We),Et.length&&this.splitTile(Et,0,0,0),ct&&(Et.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Oe,We,ct,Et,at,zt,oi){const jt=[Oe,We,ct,Et],qt=this.options,gi=qt.debug;for(;jt.length;){Et=jt.pop(),ct=jt.pop(),We=jt.pop(),Oe=jt.pop();const li=1<<We,Zi=Zl(We,ct,Et);let Ss=this.tiles[Zi];if(!Ss&&(gi>1&&console.time("creation"),Ss=this.tiles[Zi]=Rn(Oe,We,ct,Et,qt),this.tileCoords.push({z:We,x:ct,y:Et}),gi)){gi>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",We,ct,Et,Ss.numFeatures,Ss.numPoints,Ss.numSimplified),console.timeEnd("creation"));const lo=`z${We}`;this.stats[lo]=(this.stats[lo]||0)+1,this.total++}if(Ss.source=Oe,at==null){if(We===qt.indexMaxZoom||Ss.numPoints<=qt.indexMaxPoints)continue}else{if(We===qt.maxZoom||We===at)continue;if(at!=null){const lo=at-We;if(ct!==zt>>lo||Et!==oi>>lo)continue}}if(Ss.source=null,Oe.length===0)continue;gi>1&&console.time("clipping");const ds=.5*qt.buffer/qt.extent,Ws=.5-ds,mr=.5+ds,vr=1+ds;let Rr=null,Ar=null,Ko=null,to=null,nn=al(Oe,li,ct-ds,ct+mr,0,Ss.minX,Ss.maxX,qt),ao=al(Oe,li,ct+Ws,ct+vr,0,Ss.minX,Ss.maxX,qt);Oe=null,nn&&(Rr=al(nn,li,Et-ds,Et+mr,1,Ss.minY,Ss.maxY,qt),Ar=al(nn,li,Et+Ws,Et+vr,1,Ss.minY,Ss.maxY,qt),nn=null),ao&&(Ko=al(ao,li,Et-ds,Et+mr,1,Ss.minY,Ss.maxY,qt),to=al(ao,li,Et+Ws,Et+vr,1,Ss.minY,Ss.maxY,qt),ao=null),gi>1&&console.timeEnd("clipping"),jt.push(Rr||[],We+1,2*ct,2*Et),jt.push(Ar||[],We+1,2*ct,2*Et+1),jt.push(Ko||[],We+1,2*ct+1,2*Et),jt.push(to||[],We+1,2*ct+1,2*Et+1)}}getTile(Oe,We,ct){Oe=+Oe,We=+We,ct=+ct;const Et=this.options,{extent:at,debug:zt}=Et;if(Oe<0||Oe>24)return null;const oi=1<<Oe,jt=Zl(Oe,We=We+oi&oi-1,ct);if(this.tiles[jt])return Td(this.tiles[jt],at);zt>1&&console.log("drilling down to z%d-%d-%d",Oe,We,ct);let qt,gi=Oe,li=We,Zi=ct;for(;!qt&&gi>0;)gi--,li>>=1,Zi>>=1,qt=this.tiles[Zl(gi,li,Zi)];return qt&&qt.source?(zt>1&&(console.log("found parent tile z%d-%d-%d",gi,li,Zi),console.time("drilling down")),this.splitTile(qt.source,gi,li,Zi,Oe,We,ct),zt>1&&console.timeEnd("drilling down"),this.tiles[jt]?Td(this.tiles[jt],at):null):null}}function Zl(ei,Oe,We){return 32*((1<<ei)*We+Oe)+ei}function Wi(ei,Oe){const We=ei.tileID.canonical;if(!this._geoJSONIndex)return void Oe(null,null);const ct=this._geoJSONIndex.getTile(We.z,We.x,We.y);if(!ct)return void Oe(null,null);const Et=jt=>jt.tags&&"3d_elevation_id"in jt.tags&&"source"in jt.tags&&jt.tags.source==="elevation",at=ct.features.filter(jt=>Et(jt));let zt;if(at.length>0){const jt=ct.features.filter(qt=>!Et(qt));zt=new Pi({_geojsonTileLayer:jt,hd_road_elevation:at})}else zt=new wo(ct.features);let oi=Pl(zt);oi.byteOffset===0&&oi.byteLength===oi.buffer.byteLength||(oi=new Uint8Array(oi)),Oe(null,{vectorTile:zt,rawData:oi.buffer})}class Ra extends _r{constructor(Oe,We,ct,Et,at,zt,oi){super(Oe,We,ct,Et,at,Wi,oi),zt&&(this.loadGeoJSON=zt),this._dynamicIndex=new Cs}loadData(Oe,We){const ct=Oe&&Oe.request,Et=ct&&ct.collectResourceTiming;this.loadGeoJSON(Oe,(at,zt)=>{if(at||!zt)return We(at);if(typeof zt!="object")return We(new Error(`Input data given to '${Oe.source}' is not a valid GeoJSON object.`));{try{if(Oe.filter){const jt=a.X(Oe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(jt.result==="error")throw new Error(jt.value.map(qt=>`${qt.key}: ${qt.message}`).join(", "));zt.features=zt.features.filter(qt=>jt.value.evaluate({zoom:0},qt))}Oe.dynamic?(zt.type==="Feature"&&(zt={type:"FeatureCollection",features:[zt]}),Oe.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(zt.features,this.loaded),Oe.cluster&&(zt.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Oe.cluster?new Sh(function({superclusterOptions:jt,clusterProperties:qt}){if(!qt||!jt)return jt;const gi={},li={},Zi={accumulated:null,zoom:0},Ss={properties:null},ds=Object.keys(qt);for(const Ws of ds){const[mr,vr]=qt[Ws],Rr=a.X(vr),Ar=a.X(typeof mr=="string"?[mr,["accumulated"],["get",Ws]]:mr);gi[Ws]=Rr.value,li[Ws]=Ar.value}return jt.map=Ws=>{Ss.properties=Ws;const mr={};for(const vr of ds)mr[vr]=gi[vr].evaluate(Zi,Ss);return mr},jt.reduce=(Ws,mr)=>{Ss.properties=mr;for(const vr of ds)Zi.accumulated=Ws[vr],Ws[vr]=li[vr].evaluate(Zi,Ss)},jt}(Oe)).load(zt.features):Oe.dynamic?this._dynamicIndex:function(jt,qt){return new Va(jt,qt)}(zt,Oe.geojsonVtOptions)}catch(jt){return We(jt)}const oi={};if(Et){const jt=Ni(ct);jt&&(oi.resourceTiming={},oi.resourceTiming[Oe.source]=JSON.parse(JSON.stringify(jt)))}We(null,oi)}})}reloadTile(Oe,We){const ct=this.loaded;return ct&&ct[Oe.uid]?Oe.partial?We(null,void 0):super.reloadTile(Oe,We):this.loadTile(Oe,We)}loadGeoJSON(Oe,We){if(Oe.request)a.n(Oe.request,We);else{if(typeof Oe.data!="string")return We(new Error(`Input data given to '${Oe.source}' is not a valid GeoJSON object.`));try{return We(null,JSON.parse(Oe.data))}catch{return We(new Error(`Input data given to '${Oe.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Oe,We){try{We(null,this._geoJSONIndex.getClusterExpansionZoom(Oe.clusterId))}catch(ct){We(ct)}}getClusterChildren(Oe,We){try{We(null,this._geoJSONIndex.getChildren(Oe.clusterId))}catch(ct){We(ct)}}getClusterLeaves(Oe,We){try{We(null,this._geoJSONIndex.getLeaves(Oe.clusterId,Oe.limit,Oe.offset))}catch(ct){We(ct)}}}class pp{constructor(Oe,We,ct){this.tileID=new a.aM(Oe.tileID.overscaledZ,Oe.tileID.wrap,Oe.tileID.canonical.z,Oe.tileID.canonical.x,Oe.tileID.canonical.y),this.tileZoom=Oe.tileZoom,this.uid=Oe.uid,this.zoom=Oe.zoom,this.canonical=Oe.tileID.canonical,this.pixelRatio=Oe.pixelRatio,this.tileSize=Oe.tileSize,this.source=Oe.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Oe.projection,this.brightness=We,this.worldview=ct}parse(Oe,We,ct,Et){this.status="parsing";const at=new a.aM(ct.tileID.overscaledZ,ct.tileID.wrap,ct.tileID.canonical.z,ct.tileID.canonical.x,ct.tileID.canonical.y),zt=[],oi=We.familiesBySource[ct.source],jt=new a.f0(at,ct.promoteId);jt.bucketLayerIDs=[],jt.is3DTile=!0,a.fi(Oe).then(qt=>{if(!qt)return Et(new Error("Could not parse tile"));const gi=qt.json.extensionsUsed&&qt.json.extensionsUsed.includes("MAPBOX_mesh_features")||qt.json.asset.extras&&qt.json.asset.extras.MAPBOX_mesh_features,li=qt.json.extensionsUsed&&qt.json.extensionsUsed.includes("EXT_meshopt_compression"),Zi=new a.aa(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Ss in oi)for(const ds of oi[Ss]){const Ws=ds[0];jt.bucketLayerIDs.push(ds.map(Rr=>a.C(Rr.id,Rr.scope))),Ws.recalculate(Zi,[]);const mr=a.fj(qt,1/a.cU(ct.tileID.canonical)),vr=new a.fk(ds,mr,at,gi,li,this.brightness,jt,this.worldview);gi||(vr.needsUpload=!0),zt.push(vr),vr.evaluate(Ws)}this.status="done",Et(null,{buckets:zt,featureIndex:jt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(qt=>Et(new Error(qt.message)))}}class vl{constructor(Oe,We,ct,Et,at,zt,oi,jt){this.actor=Oe,this.layerIndex=We,this.availableImages=ct,this.availableModels=Et,this.brightness=oi,this.loading={},this.loaded={},this.worldview=jt}loadTile(Oe,We){const ct=Oe.uid,Et=this.loading[ct]=new pp(Oe,this.brightness,this.worldview);a.br(Oe.request,(at,zt)=>{const oi=!this.loading[ct];return delete this.loading[ct],oi||at?(Et.status="done",oi||(this.loaded[ct]=Et),We(at)):zt&&zt.byteLength!==0?void Et.parse(zt,this.layerIndex,Oe,(jt,qt)=>{Et.status="done",this.loaded=this.loaded||{},this.loaded[ct]=Et,jt||!qt?We(jt):We(null,qt)}):(Et.status="done",this.loaded[ct]=Et,We())})}reloadTile(Oe,We){const ct=this.loaded,Et=Oe.uid;if(ct&&ct[Et]){const at=ct[Et];at.projection=Oe.projection,at.brightness=Oe.brightness;const zt=(oi,jt)=>{at.reloadCallback&&(delete at.reloadCallback,this.loadTile(Oe,We)),We(oi,jt)};at.status==="parsing"?at.reloadCallback=zt:at.status==="done"&&this.loadTile(Oe,We)}}abortTile(Oe,We){const ct=Oe.uid;this.loading[ct]&&delete this.loading[ct],We()}removeTile(Oe,We){const ct=this.loaded,Et=Oe.uid;ct&&ct[Et]&&delete ct[Et],We()}}class lr{constructor(Oe){this.self=Oe,this.actor=new a.fm(Oe,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new a.y,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=a.ce({name:"mercator"}),this.workerSourceTypes={vector:_r,geojson:Ra,"raster-dem":ar,"raster-array":Or,"batched-model":vl},this.workerSources={},this.self.registerWorkerSource=(We,ct)=>{if(this.workerSourceTypes[We])throw new Error(`Worker source with name "${We}" already registered.`);this.workerSourceTypes[We]=ct},this.self.registerRTLTextPlugin=We=>{if(a.fn.isParsed())throw new Error("RTL text plugin already registered.");a.fn.setState({pluginStatus:a.fo.parsed,pluginURL:a.fn.getPluginURL()}),a.fn.applyArabicShaping=We.applyArabicShaping,a.fn.processBidirectionalText=We.processBidirectionalText,a.fn.processStyledBidirectionalText=We.processStyledBidirectionalText;for(const ct of this.rtlPluginParsingListeners)ct(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(Oe,We,ct){delete this.layerIndexes[Oe],delete this.availableImages[Oe],delete this.availableModels[Oe],delete this.workerSources[Oe],ct()}checkIfReady(Oe,We,ct){ct()}setReferrer(Oe,We){this.referrer=We}spriteLoaded(Oe,We){this.isSpriteLoaded[Oe]||(this.isSpriteLoaded[Oe]={});const{scope:ct,isLoaded:Et}=We;if(this.isSpriteLoaded[Oe][ct]=Et,this.workerSources[Oe]&&this.workerSources[Oe][ct])for(const at in this.workerSources[Oe][ct]){const zt=this.workerSources[Oe][ct][at];for(const oi in zt){const jt=zt[oi];jt instanceof _r&&(jt.isSpriteLoaded=Et,jt.fire(new a.A("isSpriteLoaded")))}}}setImages(Oe,We,ct){this.availableImages[Oe]||(this.availableImages[Oe]={});const{scope:Et,images:at}=We;if(this.availableImages[Oe][Et]=at,this.workerSources[Oe]&&this.workerSources[Oe][Et]){for(const zt in this.workerSources[Oe][Et]){const oi=this.workerSources[Oe][Et][zt];for(const jt in oi)oi[jt].availableImages=at}ct()}else ct()}setModels(Oe,{scope:We,models:ct},Et){if(this.availableModels[Oe]||(this.availableModels[Oe]={}),this.availableModels[Oe][We]=ct,this.workerSources[Oe]&&this.workerSources[Oe][We]){for(const at in this.workerSources[Oe][We]){const zt=this.workerSources[Oe][We][at];for(const oi in zt)zt[oi].availableModels=ct}Et()}else Et()}setProjection(Oe,We){this.projections[Oe]=a.ce(We)}setBrightness(Oe,We,ct){this.brightness=We,ct()}setWorldview(Oe,We,ct){this.worldview=We,ct()}setLayers(Oe,We,ct){this.getLayerIndex(Oe,We.scope).replace(We.layers,We.options),ct()}updateLayers(Oe,We,ct){this.getLayerIndex(Oe,We.scope).update(We.layers,We.removedIds,We.options),ct()}loadTile(Oe,We,ct){We.projection=this.projections[Oe]||this.defaultProjection,this.getWorkerSource(Oe,We.type,We.source,We.scope).loadTile(We,ct)}decodeRasterArray(Oe,We,ct){this.getWorkerSource(Oe,We.type,We.source,We.scope).decodeRasterArray(We,ct)}reloadTile(Oe,We,ct){We.projection=this.projections[Oe]||this.defaultProjection,this.getWorkerSource(Oe,We.type,We.source,We.scope).reloadTile(We,ct)}abortTile(Oe,We,ct){this.getWorkerSource(Oe,We.type,We.source,We.scope).abortTile(We,ct)}removeTile(Oe,We,ct){this.getWorkerSource(Oe,We.type,We.source,We.scope).removeTile(We,ct)}removeSource(Oe,We,ct){if(!(this.workerSources[Oe]&&this.workerSources[Oe][We.scope]&&this.workerSources[Oe][We.scope][We.type]&&this.workerSources[Oe][We.scope][We.type][We.source]))return;const Et=this.workerSources[Oe][We.scope][We.type][We.source];delete this.workerSources[Oe][We.scope][We.type][We.source],Et.removeSource!==void 0?Et.removeSource(We,ct):ct()}loadWorkerSource(Oe,We,ct){try{this.self.importScripts(We.url),ct()}catch(Et){ct(Et.toString())}}syncRTLPluginState(Oe,We,ct){if(a.fn.isParsed())ct(null,!0);else if(a.fn.isParsing())this.rtlPluginParsingListeners.push(ct);else try{a.fn.setState(We);const Et=a.fn.getPluginURL();!a.fn.isLoaded()||a.fn.isParsed()||a.fn.isParsing()||Et==null||(a.fn.setState({pluginStatus:a.fo.parsing,pluginURL:a.fn.getPluginURL()}),this.self.importScripts(Et),a.fn.isParsed()?ct(null,!0):this.rtlPluginParsingListeners.push(ct))}catch(Et){ct(Et.toString())}}setDracoUrl(Oe,We){this.dracoUrl=We}getAvailableImages(Oe,We){this.availableImages[Oe]||(this.availableImages[Oe]={});let ct=this.availableImages[Oe][We];return ct||(ct=[]),ct}getAvailableModels(Oe,We){this.availableModels[Oe]||(this.availableModels[Oe]={});let ct=this.availableModels[Oe][We];return ct||(ct={}),ct}getLayerIndex(Oe,We){this.layerIndexes[Oe]||(this.layerIndexes[Oe]={});let ct=this.layerIndexes[Oe][We];return ct||(ct=this.layerIndexes[Oe][We]=new Xs,ct.scope=We),ct}getWorkerSource(Oe,We,ct,Et){const at=this.workerSources;return at[Oe]||(at[Oe]={}),at[Oe][Et]||(at[Oe][Et]={}),at[Oe][Et][We]||(at[Oe][Et][We]={}),this.isSpriteLoaded[Oe]||(this.isSpriteLoaded[Oe]={}),at[Oe][Et][We][ct]||(at[Oe][Et][We][ct]=new this.workerSourceTypes[We]({send:(zt,oi,jt,qt,gi,li)=>this.actor.send(zt,oi,jt,Oe,gi,li),scheduler:this.actor.scheduler},this.getLayerIndex(Oe,Et),this.getAvailableImages(Oe,Et),this.getAvailableModels(Oe,Et),this.isSpriteLoaded[Oe][Et],void 0,this.brightness,this.worldview)),at[Oe][Et][We][ct]}rasterizeImagesWorker(Oe,We,ct){const Et=new Map;for(const[at,{image:zt,imageVariant:oi}]of We.tasks.entries()){const jt=this.imageRasterizer.rasterize(oi,zt,We.scope,Oe);Et.set(at,jt)}ct(void 0,Et)}removeRasterizedImages(Oe,We,ct){this.imageRasterizer.removeImagesFromCacheByIds(We.imageIds,We.scope,Oe),ct()}enforceCacheSizeLimit(Oe,We){a.fp(We)}getWorkerPerformanceMetrics(Oe,We,ct){ct(void 0,void 0)}}return a.fl(self)&&(self.worker=new lr(self)),lr}),ni(["./shared"],function(a){var Ni="3.13.0";const Ui={create:"create",load:"load",fullLoad:"fullLoad"},is={mark(c){performance.mark(c)},measure(c,t,r){performance.measure(c,t,r)}};function Xs(c){const t=c.name.split("?")[0];return a.a(t)&&t.includes("mapbox-gl.js")?"javascript":a.a(t)&&t.includes("mapbox-gl.css")?"css":a.b(t)?"fontRange":a.c(t)?"sprite":a.i(t)?"style":a.d(t)?"tilejson":"other"}var Qi,xs={},zs=function(){if(Qi)return xs;function c(d){return!t(d)}function t(d){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var b,E,D=new Blob([""],{type:"text/javascript"}),U=URL.createObjectURL(D);try{E=new Worker(U),b=!0}catch{b=!1}return E&&E.terminate(),URL.revokeObjectURL(U),b}()?function(){var b=document.createElement("canvas");b.width=b.height=1;var E=b.getContext("2d");if(!E)return!1;var D=E.getImageData(0,0,1,1);return D&&D.width===b.width}()?(r[_=d&&d.failIfMajorPerformanceCaveat]===void 0&&(r[_]=function(b){var E,D=function(U){var Z=document.createElement("canvas"),ie=Object.create(c.webGLContextAttributes);return ie.failIfMajorPerformanceCaveat=U,Z.getContext("webgl2",ie)}(b);if(!D)return!1;try{E=D.createShader(D.VERTEX_SHADER)}catch{return!1}return!(!E||D.isContextLost())&&(D.shaderSource(E,"void main() {}"),D.compileShader(E),D.getShaderParameter(E,D.COMPILE_STATUS)===!0)}(_)),r[_]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var _}Qi=1,xs.supported=c,xs.notSupportedReason=t;var r={};return c.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},xs}();function hs(c,t,r){const d=document.createElement(c);return t!=null&&(d.className=t),r&&r.appendChild(d),d}function _r(c,t,r){const d=document.createElementNS("http://www.w3.org/2000/svg",c);for(const _ of Object.keys(t))d.setAttributeNS(null,_,String(t[_]));return r&&r.appendChild(d),d}const ar=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Nr=ar&&ar.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Or;function ir(){ar&&Nr&&(Or=ar[Nr],ar[Nr]="none")}function fr(){ar&&Nr&&(ar[Nr]=Or)}function wo(c){c.preventDefault(),c.stopPropagation(),window.removeEventListener("click",wo,!0)}function rn(){window.addEventListener("click",wo,!0),window.setTimeout(()=>{window.removeEventListener("click",wo,!0)},0)}function Pi(c,t){const r=c.getBoundingClientRect();return Cs(c,r,t)}function fo(c,t){const r=c.getBoundingClientRect(),d=[];for(let _=0;_<t.length;_++)d.push(Cs(c,r,t[_]));return d}function pl(c){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&c.button===2&&c.ctrlKey?0:c.button}function Cs(c,t,r){const d=c.offsetWidth===t.width?1:c.offsetWidth/t.width;return new a.P((r.clientX-t.left)*d,(r.clientY-t.top)*d)}const Da="01",No="NO_ACCESS_TOKEN";class pi{constructor(t,r,d){this._transformRequestFn=t,this._customAccessToken=r,this._silenceAuthErrors=!!d,this._createSkuToken()}_createSkuToken(){const t=function(){let r="";for(let d=0;d<10;d++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Da,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,r){return this._transformRequestFn&&this._transformRequestFn(t,r)||{url:t}}normalizeStyleURL(t,r){if(!a.j(t))return t;const d=Io(t);return d.params.push(`sdk=js-${Ni}`),d.path=`/styles/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||r)}normalizeGlyphsURL(t,r){if(!a.j(t))return t;const d=Io(t);return d.path=`/fonts/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||r)}normalizeModelURL(t,r){if(!a.j(t))return t;const d=Io(t);return d.path=`/models/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||r)}normalizeSourceURL(t,r,d,_){if(!a.j(t))return t;const b=Io(t);return b.path=`/v4/${b.authority}.json`,b.params.push("secure"),d&&b.params.push(`language=${d}`),_&&b.params.push(`worldview=${_}`),this._makeAPIURL(b,this._customAccessToken||r)}normalizeIconsetURL(t,r){const d=Io(t);return a.j(t)?(d.path=`/styles/v1${d.path}/iconset.pbf`,this._makeAPIURL(d,this._customAccessToken||r)):Qn(d)}normalizeSpriteURL(t,r,d,_){const b=Io(t);return a.j(t)?(b.path=`/styles/v1${b.path}/sprite${r}${d}`,this._makeAPIURL(b,this._customAccessToken||_)):(b.path+=`${r}${d}`,Qn(b))}normalizeTileURL(t,r,d){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!a.j(t))return t;const _=Io(t);_.path=_.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||d&&_.authority!=="raster"&&d===512?"@2x":""}${a.l.supported?".webp":"$1"}`),_.authority==="raster"?_.path=`/${a.e.RASTER_URL_PREFIX}${_.path}`:_.authority==="rasterarrays"?_.path=`/${a.e.RASTERARRAYS_URL_PREFIX}${_.path}`:_.authority==="3dtiles"?_.path=`/${a.e.TILES3D_URL_PREFIX}${_.path}`:(_.path=_.path.replace(/^.+\/v4\//,"/"),_.path=`/${a.e.TILE_URL_VERSION}${_.path}`);const b=this._customAccessToken||function(E){for(const D of E){const U=D.match(/^access_token=(.*)$/);if(U)return U[1]}return null}(_.params)||a.e.ACCESS_TOKEN;return a.e.REQUIRE_ACCESS_TOKEN&&b&&this._skuToken&&_.params.push(`sku=${this._skuToken}`),this._makeAPIURL(_,b)}canonicalizeTileURL(t,r){const d=Io(t);if(!d.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!d.path.match(/\.[\w]+$/))return t;let _="mapbox://";d.path.match(/^\/raster\/v1\//)?_+=`raster/${d.path.replace(`/${a.e.RASTER_URL_PREFIX}/`,"")}`:d.path.match(/^\/rasterarrays\/v1\//)?_+=`rasterarrays/${d.path.replace(`/${a.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:_+=`tiles/${d.path.replace(`/${a.e.TILE_URL_VERSION}/`,"")}`;let b=d.params;return r&&(b=b.filter(E=>!E.match(/^access_token=/))),b.length&&(_+=`?${b.join("&")}`),_}canonicalizeTileset(t,r){const d=!!r&&a.j(r),_=[];for(const b of t.tiles||[])a.k(b)?_.push(this.canonicalizeTileURL(b,d)):_.push(b);return _}_makeAPIURL(t,r){const d="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",_=Io(a.e.API_URL);if(t.protocol=_.protocol,t.authority=_.authority,t.protocol==="http"){const b=t.params.indexOf("secure");b>=0&&t.params.splice(b,1)}if(_.path!=="/"&&(t.path=`${_.path}${t.path}`),!a.e.REQUIRE_ACCESS_TOKEN)return Qn(t);if(r=r||a.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${d}`);if(r[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${d}`)}return t.params=t.params.filter(b=>b.indexOf("access_token")===-1),t.params.push(`access_token=${r||""}`),Qn(t)}}const on=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Io(c){const t=c.match(on);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Qn(c){const t=c.params.length?`?${c.params.join("&")}`:"";return`${c.protocol}://${c.authority}${c.path}${t}`}const fi="mapbox.eventData";function xl(c){if(!c)return null;const t=c.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(a.m(t[1]))}catch{return null}}class gr{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const r=xl(a.e.ACCESS_TOKEN);let d="";return d=r&&r.u?a.f(r.u):a.e.ACCESS_TOKEN||"",t?`${fi}.${t}:${d}`:`${fi}:${d}`}fetchEventData(){const t=a.s("localStorage"),r=this.getStorageKey(),d=this.getStorageKey("uuid");if(t)try{const _=localStorage.getItem(r);_&&(this.eventData=JSON.parse(_));const b=localStorage.getItem(d);b&&(this.anonId=b)}catch{a.w("Unable to read from LocalStorage")}}saveEventData(){const t=a.s("localStorage"),r=this.getStorageKey(),d=this.getStorageKey("uuid"),_=this.anonId;if(t&&_)try{localStorage.setItem(d,_),Object.keys(this.eventData).length>=1&&localStorage.setItem(r,JSON.stringify(this.eventData))}catch{a.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,r,d,_){if(!a.e.EVENTS_URL)return;const b=Io(a.e.EVENTS_URL);b.params.push(`access_token=${_||a.e.ACCESS_TOKEN||""}`);const E={event:this.type,created:new Date(t).toISOString()},D=r?a.h(E,r):E,U={url:Qn(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([D])};this.pendingRequest=a.p(U,Z=>{this.pendingRequest=null,d(Z),this.saveEventData(),this.processRequests(_)})}queueRequest(t,r){this.queue.push(t),this.processRequests(r)}}const Kn=new class extends gr{constructor(c){super("appUserTurnstile"),this._customAccessToken=c}postTurnstileEvent(c,t){a.e.EVENTS_URL&&a.e.ACCESS_TOKEN&&Array.isArray(c)&&c.some(r=>a.j(r)||a.k(r))&&this.queueRequest(Date.now(),t)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=xl(a.e.ACCESS_TOKEN),r=t?t.u:a.e.ACCESS_TOKEN;let d=r!==this.eventData.tokenU;a.v(this.anonId)||(this.anonId=a.u(),d=!0);const _=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),E=new Date(_),D=(_-this.eventData.lastSuccess)/864e5;d=d||D>=1||D<-1||b.getDate()!==E.getDate()}else d=!0;d?this.postEvent(_,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ni,skuId:Da,"enabled.telemetry":!1,userId:this.anonId},b=>{b||(this.eventData.lastSuccess=_,this.eventData.tokenU=r)},c):this.processRequests()}},za=Kn.postTurnstileEvent.bind(Kn),Na=new class extends gr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(c,t,r,d){this.skuToken=t,this.errorCb=d,a.e.EVENTS_URL&&(r||a.e.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},r):this.errorCb(new Error(No)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),a.v(this.anonId)||(this.anonId=a.u()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ni,skuId:Da,skuToken:this.skuToken,userId:this.anonId},d=>{d?this.errorCb(d):t&&(this.success[t]=!0)},c))}remove(){this.errorCb=null}},Pl=Na.postMapLoadEvent.bind(Na),Lo=new class extends gr{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(c){let t=this.mapInstanceIdMap.get(c);return t||(t=a.u(),this.mapInstanceIdMap.set(c,t)),t}getEventId(c){const t=this.eventIdPerMapInstanceMap.get(c)||0;return this.eventIdPerMapInstanceMap.set(c,t+1),t}postStyleLoadEvent(c,t){const{map:r,style:d,importedStyles:_}=t;if(!a.e.EVENTS_URL||!c&&!a.e.ACCESS_TOKEN)return;const b=this.getMapInstanceId(r),E={mapInstanceId:b,eventId:this.getEventId(b),style:d};_.length&&(E.importedStyles=_),this.queueRequest({timestamp:Date.now(),payload:E},c)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:r}=this.queue.shift();this.postEvent(t,r,()=>{},c)}},Zo=Lo.postStyleLoadEvent.bind(Lo),pa=new class extends gr{constructor(){super("gljs.performance")}postPerformanceEvent(c,t){a.e.EVENTS_URL&&(c||a.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},c)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:r}=this.queue.shift(),d=function(_){const b=performance.getEntriesByType("resource"),E=performance.getEntriesByType("mark"),D=function(me){const Ce={};if(me){for(const Me in me)if(Me!=="other")for(const Pe of me[Me]){const Ne=`${Me}ResolveRangeMin`,He=`${Me}ResolveRangeMax`,lt=`${Me}RequestCount`,ut=`${Me}RequestCachedCount`;Ce[Ne]=Math.min(Ce[Ne]||1/0,Pe.startTime),Ce[He]=Math.max(Ce[He]||-1/0,Pe.responseEnd);const kt=wt=>{Ce[wt]===void 0&&(Ce[wt]=0),++Ce[wt]};Pe.transferSize!==void 0&&Pe.transferSize===0&&kt(ut),kt(lt)}}return Ce}(function(me,Ce){const Me={};if(me)for(const Pe of me){const Ne=Ce(Pe);Me[Ne]===void 0&&(Me[Ne]=[]),Me[Ne].push(Pe)}return Me}(b,Xs)),U=window.devicePixelRatio,Z=navigator.connection||navigator.mozConnection||navigator.webkitConnection,ie=Z?Z.effectiveType:void 0,de={counters:[],metadata:[],attributes:[]},ne=(me,Ce,Me)=>{Me!=null&&me.push({name:Ce,value:Me.toString()})};for(const me in D)ne(de.counters,me,D[me]);if(_.interactionRange[0]!==1/0&&_.interactionRange[1]!==-1/0&&(ne(de.counters,"interactionRangeMin",_.interactionRange[0]),ne(de.counters,"interactionRangeMax",_.interactionRange[1])),E)for(const me of Object.keys(Ui)){const Ce=Ui[me],Me=E.find(Pe=>Pe.name===Ce);Me&&ne(de.counters,Ce,Me.startTime)}return ne(de.counters,"visibilityHidden",_.visibilityHidden),ne(de.attributes,"style",function(me){if(me)for(const Ce of me){const Me=Ce.name.split("?")[0];if(a.i(Me)){const Pe=Me.split("/").slice(-2);if(Pe.length===2)return`mapbox://styles/${Pe[0]}/${Pe[1]}`}}}(b)),ne(de.attributes,"terrainEnabled",_.terrainEnabled?"true":"false"),ne(de.attributes,"fogEnabled",_.fogEnabled?"true":"false"),ne(de.attributes,"projection",_.projection),ne(de.attributes,"zoom",_.zoom),ne(de.metadata,"devicePixelRatio",U),ne(de.metadata,"connectionEffectiveType",ie),ne(de.metadata,"navigatorUserAgent",navigator.userAgent),ne(de.metadata,"screenWidth",window.screen.width),ne(de.metadata,"screenHeight",window.screen.height),ne(de.metadata,"windowWidth",window.innerWidth),ne(de.metadata,"windowHeight",window.innerHeight),ne(de.metadata,"mapWidth",_.width/U),ne(de.metadata,"mapHeight",_.height/U),ne(de.metadata,"webglRenderer",_.renderer),ne(de.metadata,"webglVendor",_.vendor),ne(de.metadata,"sdkVersion",Ni),ne(de.metadata,"sdkIdentifier","mapbox-gl-js"),de}(r);for(const _ of d.metadata);for(const _ of d.counters);for(const _ of d.attributes);this.postEvent(t,d,()=>{},c)}},Ul=pa.postPerformanceEvent.bind(pa),mo=new class extends gr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(c,t,r,d){if(!a.e.API_URL||!a.e.SESSION_PATH)return;const _=Io(a.e.API_URL+a.e.SESSION_PATH);_.params.push(`sku=${t||""}`),_.params.push(`access_token=${d||a.e.ACCESS_TOKEN||""}`);const b={url:Qn(_),headers:{"Content-Type":"text/plain"}};this.pendingRequest=a.g(b,E=>{this.pendingRequest=null,r(E),this.saveEventData(),this.processRequests(d)})}getSessionAPI(c,t,r,d){this.skuToken=t,this.errorCb=d,a.e.SESSION_PATH&&a.e.API_URL&&(r||a.e.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},r):this.errorCb(new Error(No)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||this.getSession(r,this.skuToken,d=>{d?this.errorCb(d):t&&(this.success[t]=!0)},c)}remove(){this.errorCb=null}},ql=mo.getSessionAPI.bind(mo),Sh=new Set;function Wh(c,t){t?Sh.add(c):Sh.delete(c)}class Qs{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,r){this._updatedSourceCaches[t]=r,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const r=t.scope;this._updatedLayers[r]=this._updatedLayers[r]||new Set,this._updatedLayers[r].add(t.id),this.setDirty()}removeLayer(t){const r=t.scope;this._removedLayers[r]=this._removedLayers[r]||{},this._updatedLayers[r]=this._updatedLayers[r]||new Set,this._removedLayers[r][t.id]=t,this._updatedLayers[r].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const r in this._updatedLayers)t[r]=t[r]||{},t[r].updatedIds=Array.from(this._updatedLayers[r].values());for(const r in this._removedLayers)t[r]=t[r]||{},t[r].removedIds=Object.keys(this._removedLayers[r]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,r){this._updatedImages[r]=this._updatedImages[r]||new Set,this._updatedImages[r].add(a.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Ic(c){const{userImage:t}=c;return!!(t&&t.render&&t.render())&&(c.data.replace(new Uint8Array(t.data.buffer)),!0)}class _l extends a.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&a.t()&&(this.imageRasterizerDispatcher=new a.D(a.x(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new a.r({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const r=this.atlasTexture.get(t);r&&(r.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,r){this.imageProviders.has(r)||this.imageProviders.set(r,new Map),this.imageProviders.get(r).set(t.id,t)}removeImageProvider(t,r){this.imageProviders.has(r)&&this.imageProviders.get(r).delete(t)}getPendingImageProviders(){const t=[];for(const r of this.imageProviders.values())for(const d of r.values())d.hasPendingRequests()&&t.push(d);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new a.y),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,r){if(this.loaded.get(r)!==t&&(this.loaded.set(r,t),t)){for(const{ids:d,callback:_}of this.requestors)this._notify(d,r,_);this.requestors=[]}}hasImage(t,r){return!!this.getImage(t,r)}getImage(t,r){return this.images.get(r).get(t.toString())}addImage(t,r,d){this._validate(t,d)&&this.images.get(r).set(t.toString(),d)}_validate(t,r){let d=!0;return this._validateStretch(r.stretchX,r.data&&r.data.width)||(this.fire(new a.z(new Error(`Image "${t.name}" has invalid "stretchX" value`))),d=!1),this._validateStretch(r.stretchY,r.data&&r.data.height)||(this.fire(new a.z(new Error(`Image "${t.name}" has invalid "stretchY" value`))),d=!1),this._validateContent(r.content,r)||(this.fire(new a.z(new Error(`Image "${t.name}" has invalid "content" value`))),d=!1),d}_validateStretch(t,r){if(!t)return!0;let d=0;for(const _ of t){if(_[0]<d||_[1]<_[0]||r<_[1])return!1;d=_[1]}return!0}_validateContent(t,r){return t?t.length!==4||!r.usvg&&(t[0]<0||r.data.width<t[0]||t[1]<0||r.data.height<t[1]||t[2]<0||r.data.width<t[2]||t[3]<0||r.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,r,d){const _=this.images.get(r).get(t.toString());d.version=_.version+1,this.images.get(r).set(t.toString(),d),this.updatedImages.get(r).add(t),this.removeFromImageRasterizerCache(t,r)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,r){this.spriteFormat!=="raster"&&(a.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:r}):this.imageRasterizer.removeImagesFromCacheByIds([t],r))}removeImage(t,r){const d=this.images.get(r),_=d.get(t.toString());d.delete(t.toString()),this.patterns.get(r).delete(t.toString()),this.removeFromImageRasterizerCache(t,r),_.userImage&&_.userImage.onRemove&&_.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(r=>a.I.from(r))}getImages(t,r,d){const _=[],b=[],E=this.imageProviders.get(r);for(const ie of t){if(!ie.iconsetId){_.push(ie);continue}const de=E.get(ie.iconsetId);de&&(this.getImage(ie,r)?b.push(ie):de.addPendingRequest(ie))}if(_.length===0)return void this._notify(b,r,d);let D=!0;const U=!!this.loaded.get(r),Z=this.images.get(r);if(!U)for(const ie of _)Z.has(ie.toString())||(D=!1);U||D?this._notify(_,r,d):this.requestors.push({ids:_,scope:r,callback:d})}rasterizeImages(t,r){const d=new Map,{tasks:_,scope:b}=t;for(const[E,D]of _.entries()){const U=this.getImage(D.id,b);U&&d.set(E,{image:U,imageVariant:D})}this._rasterizeImages(b,d,r)}_rasterizeImages(t,r,d){if(a.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:r,scope:t},d);else{const _=new Map;for(const[b,{image:E,imageVariant:D}]of r.entries())_.set(b,this.imageRasterizer.rasterize(D,E,t,0));d(void 0,_)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,r,d){const _=this.images.get(r),b=new Map;for(const E of t){if(!_.get(E.toString())){if(E.iconsetId)continue;this.fire(new a.A("styleimagemissing",{id:E.name}))}const D=_.get(E.toString());if(!D){a.w(`Image "${E.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const U={data:D.usvg?null:D.data.clone(),pixelRatio:D.pixelRatio,sdf:D.sdf,usvg:D.usvg,version:D.version,stretchX:D.stretchX,stretchY:D.stretchY,content:D.content,hasRenderCallback:!!(D.userImage&&D.userImage.render)};D.usvg&&Object.assign(U,{width:D.icon.usvg_tree.width,height:D.icon.usvg_tree.height}),b.set(a.I.toString(E),U)}d(null,b)}getPixelSize(t){const{width:r,height:d}=this.atlasImage.get(t);return{width:r,height:d}}getPattern(t,r,d){const _=t.toString(),b=this.patterns.get(r),E=b.get(_),D=this.getImage(t,r);if(!D)return null;if(E){if(E.position.version===D.version)return E.position;E.position.version=D.version}else{if(D.usvg&&!D.data){const U=this.getPatternInFlightId(_,r);if(this.patternsInFlight.has(U))return null;this.patternsInFlight.add(U);const Z=new a.B(t).scaleSelf(a.q.devicePixelRatio),ie=new Map([[Z.toString(),{image:D,imageVariant:Z}]]);return this._rasterizeImages(r,ie,(de,ne)=>this.storePatternImage(Z,r,D,d,ne)),null}this.storePattern(t,r,D)}return this._updatePatternAtlas(r,d),b.get(_).position}getPatternInFlightId(t,r){return a.C(t,r)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,r,d,_,b){const E=t.toString(),D=b?b.get(E):void 0;D&&(d.data=D,this.storePattern(t.id,r,d),this._updatePatternAtlas(r,_),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),r)))}storePattern(t,r,d){const _={w:d.data.width+2*a.F,h:d.data.height+2*a.F,x:0,y:0},b=new a.G(_,d,a.F);this.patterns.get(r).set(t.toString(),{bin:_,position:b})}bind(t,r){const d=t.gl;let _=this.atlasTexture.get(r);_?this.dirty&&(_.update(this.atlasImage.get(r)),this.dirty=!1):(_=new a.T(t,this.atlasImage.get(r),d.RGBA8),this.atlasTexture.set(r,_)),_.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(t,r){const d=this.patterns.get(t),_=Array.from(d.values()).map(({bin:Z})=>Z),{w:b,h:E}=a.H(_),D=this.atlasImage.get(t);D.resize({width:b||1,height:E||1});const U=this.images.get(t);for(const[Z,{bin:ie,position:de}]of d.entries()){let ne=de.padding;const me=ie.x+ne,Ce=ie.y+ne,Me=U.get(Z).data,Pe=Me.width,Ne=Me.height;ne=ne>1?ne-1:ne,a.r.copy(Me,D,{x:0,y:0},{x:me,y:Ce},{width:Pe,height:Ne},r),a.r.copy(Me,D,{x:0,y:Ne-ne},{x:me,y:Ce-ne},{width:Pe,height:ne},r),a.r.copy(Me,D,{x:0,y:0},{x:me,y:Ce+Ne},{width:Pe,height:ne},r),a.r.copy(Me,D,{x:Pe-ne,y:0},{x:me-ne,y:Ce},{width:ne,height:Ne},r),a.r.copy(Me,D,{x:0,y:0},{x:me+Pe,y:Ce},{width:ne,height:Ne},r),a.r.copy(Me,D,{x:Pe-ne,y:Ne-ne},{x:me-ne,y:Ce-ne},{width:ne,height:ne},r),a.r.copy(Me,D,{x:0,y:Ne-ne},{x:me+Pe,y:Ce-ne},{width:ne,height:ne},r),a.r.copy(Me,D,{x:0,y:0},{x:me+Pe,y:Ce+Ne},{width:ne,height:ne},r),a.r.copy(Me,D,{x:Pe-ne,y:0},{x:me-ne,y:Ce+Ne},{width:ne,height:ne},r)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,r){const d=this.images.get(r);for(const _ of t){if(this.callbackDispatchedThisFrame.get(r).has(_.toString()))continue;this.callbackDispatchedThisFrame.get(r).add(_.toString());const b=d.get(_.toString());Ic(b)&&this.updateImage(_,r,b)}}}function qa(c){const t=c.key,r=c.value,d=c.valueSpec||{},_=c.objectElementValidators||{},b=c.style,E=c.styleSpec;let D=[];const U=a.J(r);if(U!=="object")return[new a.V(t,r,`object expected, ${U} found`)];for(const Z in r){const ie=Z.split(".")[0];let de;_[ie]?de=_[ie]:d[ie]?de=To:_["*"]?de=_["*"]:d["*"]&&(de=To),de?D=D.concat(de({key:(t&&`${t}.`)+Z,value:r[Z],valueSpec:d[ie]||d["*"],style:b,styleSpec:E,object:r,objectKey:Z},r)):D.push(new a.K(t,r[Z],`unknown property "${Z}"`))}for(const Z in d)_[Z]||d[Z].required&&d[Z].default===void 0&&r[Z]===void 0&&D.push(new a.V(t,r,`missing required property "${Z}"`));return D}function Lc(c){const t=c.value,r=c.valueSpec,d=c.style,_=c.styleSpec,b=c.key,E=c.arrayElementValidator||To;if(a.J(t)!=="array")return[new a.V(b,t,`array expected, ${a.J(t)} found`)];if(r.length&&t.length!==r.length)return[new a.V(b,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new a.V(b,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let D={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};_.$version<7&&(D.function=r.function),a.J(r.value)==="object"&&(D=r.value);let U=[];for(let Z=0;Z<t.length;Z++)U=U.concat(E({array:t,arrayIndex:Z,value:t[Z],valueSpec:D,style:d,styleSpec:_,key:`${b}[${Z}]`},!0));return U}function wd(c){const t=c.key,r=c.value,d=c.valueSpec;let _=a.J(r);if(_==="number"&&r!=r&&(_="NaN"),_!=="number")return[new a.V(t,r,`number expected, ${_} found`)];if("minimum"in d){let b=d.minimum;if(a.J(d.minimum)==="array"&&(b=d.minimum[c.arrayIndex]),r<b)return[new a.V(t,r,`${r} is less than the minimum value ${b}`)]}if("maximum"in d){let b=d.maximum;if(a.J(d.maximum)==="array"&&(b=d.maximum[c.arrayIndex]),r>b)return[new a.V(t,r,`${r} is greater than the maximum value ${b}`)]}return[]}function Ps(c){const t=c.valueSpec,r=a.M(c.value.type);let d,_,b,E={};const D=r!=="categorical"&&c.value.property===void 0,U=!D,Z=a.J(c.value.stops)==="array"&&a.J(c.value.stops[0])==="array"&&a.J(c.value.stops[0][0])==="object",ie=qa({key:c.key,value:c.value,valueSpec:c.styleSpec.function,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(me){if(r==="identity")return[new a.V(me.key,me.value,'identity function may not have a "stops" property')];let Ce=[];const Me=me.value;return Ce=Ce.concat(Lc({key:me.key,value:Me,valueSpec:me.valueSpec,style:me.style,styleSpec:me.styleSpec,arrayElementValidator:de})),a.J(Me)==="array"&&Me.length===0&&Ce.push(new a.V(me.key,Me,"array must have at least one stop")),Ce},default:function(me){return To({key:me.key,value:me.value,valueSpec:t,style:me.style,styleSpec:me.styleSpec})}}});return r==="identity"&&D&&ie.push(new a.V(c.key,c.value,'missing required property "property"')),r==="identity"||c.value.stops||ie.push(new a.V(c.key,c.value,'missing required property "stops"')),r==="exponential"&&c.valueSpec.expression&&!a.N(c.valueSpec)&&ie.push(new a.V(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(U&&!a.O(c.valueSpec)?ie.push(new a.V(c.key,c.value,"property functions not supported")):D&&!a.Q(c.valueSpec)&&ie.push(new a.V(c.key,c.value,"zoom functions not supported"))),r!=="categorical"&&!Z||c.value.property!==void 0||ie.push(new a.V(c.key,c.value,'"property" property is required')),ie;function de(me){let Ce=[];const Me=me.value,Pe=me.key;if(a.J(Me)!=="array")return[new a.V(Pe,Me,`array expected, ${a.J(Me)} found`)];if(Me.length!==2)return[new a.V(Pe,Me,`array length 2 expected, length ${Me.length} found`)];if(Z){if(a.J(Me[0])!=="object")return[new a.V(Pe,Me,`object expected, ${a.J(Me[0])} found`)];if(Me[0].zoom===void 0)return[new a.V(Pe,Me,"object stop key must have zoom")];if(Me[0].value===void 0)return[new a.V(Pe,Me,"object stop key must have value")];const Ne=a.M(Me[0].zoom);if(typeof Ne!="number")return[new a.V(Pe,Me[0].zoom,"stop zoom values must be numbers")];if(b&&b>Ne)return[new a.V(Pe,Me[0].zoom,"stop zoom values must appear in ascending order")];Ne!==b&&(b=Ne,_=void 0,E={}),Ce=Ce.concat(qa({key:`${Pe}[0]`,value:Me[0],valueSpec:{zoom:{}},style:me.style,styleSpec:me.styleSpec,objectElementValidators:{zoom:wd,value:ne}}))}else Ce=Ce.concat(ne({key:`${Pe}[0]`,value:Me[0],style:me.style,styleSpec:me.styleSpec},Me));return a.S(a.U(Me[1]))?Ce.concat([new a.V(`${Pe}[1]`,Me[1],"expressions are not allowed in function stops.")]):Ce.concat(To({key:`${Pe}[1]`,value:Me[1],valueSpec:t,style:me.style,styleSpec:me.styleSpec}))}function ne(me,Ce){const Me=a.J(me.value),Pe=a.M(me.value),Ne=me.value!==null?me.value:Ce;if(d){if(Me!==d)return[new a.V(me.key,Ne,`${Me} stop domain type must match previous stop domain type ${d}`)]}else d=Me;if(Me!=="number"&&Me!=="string"&&Me!=="boolean"&&typeof Pe!="number"&&typeof Pe!="string"&&typeof Pe!="boolean")return[new a.V(me.key,Ne,"stop domain value must be a number, string, or boolean")];if(Me!=="number"&&r!=="categorical"){let He=`number expected, ${Me} found`;return a.O(t)&&r===void 0&&(He+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new a.V(me.key,Ne,He)]}return r!=="categorical"||Me!=="number"||typeof Pe=="number"&&isFinite(Pe)&&Math.floor(Pe)===Pe?r!=="categorical"&&Me==="number"&&typeof Pe=="number"&&typeof _=="number"&&_!==void 0&&Pe<_?[new a.V(me.key,Ne,"stop domain values must appear in ascending order")]:(_=Pe,r==="categorical"&&Pe in E?[new a.V(me.key,Ne,"stop domain values must be unique")]:(E[Pe]=!0,[])):[new a.V(me.key,Ne,`integer expected, found ${String(Pe)}`)]}}function nl(c){const t=(c.expressionContext==="property"?a.W:a.X)(a.U(c.value),c.valueSpec);if(t.result==="error")return t.value.map(d=>new a.V(`${c.key}${d.key}`,c.value,d.message));const r=t.value.expression||t.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!r.outputDefined())return[new a.V(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!a.Y(r))return[new a.V(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter")return jl(r,c);if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!a.Z(r,["zoom","feature-state"]))return[new a.V(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!a._(r))return[new a.V(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function jl(c,t){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const _ of t.valueSpec.expression.parameters)r.delete(_);if(r.size===0)return[];const d=[];return c instanceof a.$&&r.has(c.name)?[new a.V(t.key,t.value,`["${c.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(c.eachChild(_=>{d.push(...jl(_,t))}),d)}function Kc(c){const t=c.key,r=c.value,d=c.valueSpec,_=[];return Array.isArray(d.values)?d.values.indexOf(a.M(r))===-1&&_.push(new a.V(t,r,`expected one of [${d.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(d.values).indexOf(a.M(r))===-1&&_.push(new a.V(t,r,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(r)} found`)),_}function Gs(c){return a.a1(a.U(c.value))?nl(a.L({},c,{expressionContext:"filter",valueSpec:c.styleSpec[`filter_${c.layerType||"fill"}`]})):zn(c)}function zn(c){const t=c.value,r=c.key;if(a.J(t)!=="array")return[new a.V(r,t,`array expected, ${a.J(t)} found`)];const d=c.styleSpec;let _,b=[];if(t.length<1)return[new a.V(r,t,"filter array must have at least 1 element")];switch(b=b.concat(Kc({key:`${r}[0]`,value:t[0],valueSpec:d.filter_operator,style:c.style,styleSpec:c.styleSpec})),a.M(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&a.M(t[1])==="$type"&&b.push(new a.V(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&b.push(new a.V(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(_=a.J(t[1]),_!=="string"&&b.push(new a.V(`${r}[1]`,t[1],`string expected, ${_} found`)));for(let E=2;E<t.length;E++)_=a.J(t[E]),a.M(t[1])==="$type"?b=b.concat(Kc({key:`${r}[${E}]`,value:t[E],valueSpec:d.geometry_type,style:c.style,styleSpec:c.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&b.push(new a.V(`${r}[${E}]`,t[E],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let E=1;E<t.length;E++)b=b.concat(zn({key:`${r}[${E}]`,value:t[E],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":_=a.J(t[1]),t.length!==2?b.push(new a.V(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):_!=="string"&&b.push(new a.V(`${r}[1]`,t[1],`string expected, ${_} found`))}return b}function Gl(c,t){const r=c.key,d=c.style,_=c.layer,b=c.styleSpec,E=c.value,D=c.objectKey,U=b[`${t}_${c.layerType}`];if(!U)return[];const Z=D.match(/^(.*)-use-theme$/);if(t==="paint"&&Z&&U[Z[1]])return a.S(E)?[].concat(To({key:c.key,value:E,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:d,styleSpec:b,expressionContext:"property",propertyType:t,propertyKey:D})):To({key:r,value:E,valueSpec:{type:"string"},style:d,styleSpec:b});const ie=D.match(/^(.*)-transition$/);if(t==="paint"&&ie&&U[ie[1]]&&U[ie[1]].transition)return To({key:r,value:E,valueSpec:b.transition,style:d,styleSpec:b});const de=c.valueSpec||U[D];if(!de)return[new a.K(r,E,`unknown property "${D}"`)];let ne;if(a.J(E)==="string"&&a.O(de)&&!de.tokens&&(ne=/^{([^}]+)}$/.exec(E))){const Ce=`\`{ "type": "identity", "property": ${ne?JSON.stringify(ne[1]):'"_"'} }\``;return[new a.V(r,E,`"${D}" does not support interpolation syntax
Use an identity property function instead: ${Ce}.`)]}const me=[];if(c.layerType==="symbol")D!=="text-field"||!d||d.glyphs||d.imports||me.push(new a.V(r,E,'use of "text-field" requires a style "glyphs" property')),D==="text-font"&&a.a2(a.U(E))&&a.M(E.type)==="identity"&&me.push(new a.V(r,E,'"text-font" does not support identity functions'));else if(c.layerType==="model"&&t==="paint"&&_&&_.layout&&_.layout.hasOwnProperty("model-id")&&a.O(de)&&(a.a3(de)||a.Q(de))){const Ce=a.W(a.U(E),de),Me=Ce.value.expression||Ce.value._styleExpression.expression;Me&&!a.Z(Me,["measure-light"])&&(D==="model-emissive-strength"&&a._(Me)&&a.Y(Me)||me.push(new a.V(r,E,`${D} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return me.concat(To({key:c.key,value:E,valueSpec:de,style:d,styleSpec:b,expressionContext:"property",propertyType:t,propertyKey:D}))}function fc(c){return Gl(c,"paint")}function al(c){return Gl(c,"layout")}function Gd(c){let t=[];const r=c.value,d=c.key,_=c.style,b=c.styleSpec;r.type||r.ref||t.push(new a.V(d,r,'either "type" or "ref" is required'));let E=a.M(r.type);const D=a.M(r.ref);if(r.id){const U=a.M(r.id);for(let Z=0;Z<c.arrayIndex;Z++){const ie=_.layers[Z];a.M(ie.id)===U&&t.push(new a.V(d,r.id,`duplicate layer id "${r.id}", previously used at line ${ie.id.__line__}`))}}if("ref"in r){let U;["type","source","source-layer","filter","layout"].forEach(Z=>{Z in r&&t.push(new a.V(d,r[Z],`"${Z}" is prohibited for ref layers`))}),_.layers.forEach(Z=>{a.M(Z.id)===D&&(U=Z)}),U?U.ref?t.push(new a.V(d,r.ref,"ref cannot reference another ref layer")):E=a.M(U.type):typeof D=="string"&&t.push(new a.V(d,r.ref,`ref layer "${D}" not found`))}else if(E!=="background"&&E!=="sky"&&E!=="slot")if(r.source){const U=_.sources&&_.sources[r.source],Z=U&&a.M(U.type);U?Z==="vector"&&E==="raster"?t.push(new a.V(d,r.source,`layer "${r.id}" requires a raster source`)):Z==="raster"&&E!=="raster"?t.push(new a.V(d,r.source,`layer "${r.id}" requires a vector source`)):Z!=="vector"||r["source-layer"]?Z==="raster-dem"&&E!=="hillshade"?t.push(new a.V(d,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):Z!=="raster-array"||["raster","raster-particle"].includes(E)?E==="line"&&r.paint&&(r.paint["line-gradient"]||r.paint["line-trim-offset"])&&Z==="geojson"&&!U.lineMetrics?t.push(new a.V(d,r,`layer "${r.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):E==="raster-particle"&&Z!=="raster-array"&&t.push(new a.V(d,r.source,`layer "${r.id}" requires a 'raster-array' source.`)):t.push(new a.V(d,r.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new a.V(d,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new a.V(d,r.source,`source "${r.source}" not found`))}else t.push(new a.V(d,r,'missing required property "source"'));return t=t.concat(qa({key:d,value:r,valueSpec:b.layer,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{"*":()=>[],type:()=>To({key:`${d}.type`,value:r.type,valueSpec:b.layer.type,style:c.style,styleSpec:c.styleSpec,object:r,objectKey:"type"}),filter:U=>Gs(a.L({layerType:E},U)),layout:U=>qa({layer:r,key:U.key,value:U.value,valueSpec:{},style:U.style,styleSpec:U.styleSpec,objectElementValidators:{"*":Z=>al(a.L({layerType:E},Z))}}),paint:U=>qa({layer:r,key:U.key,value:U.value,valueSpec:{},style:U.style,styleSpec:U.styleSpec,objectElementValidators:{"*":Z=>fc(a.L({layerType:E,layer:r},Z))}})}})),t}function Oc(c){const t=c.value,r=c.key,d=a.J(t);return d!=="string"?[new a.V(r,t,`string expected, ${d} found`)]:[]}const mh={promoteId:function c({key:t,value:r}){if(a.J(r)==="string")return Oc({key:t,value:r});if(Array.isArray(r)){const d=[],_=a.U(r),b=a.X(_);return b.result==="error"&&b.value.forEach(E=>{d.push(new a.V(`${t}${E.key}`,null,`${E.message}`))}),a.Z(b.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||d.push(new a.V(`${t}`,null,"promoteId expression should be only feature dependent")),d}{const d=[];for(const _ in r)d.push(...c({key:`${t}.${_}`,value:r[_]}));return d}}};function ll(c){const t=c.value,r=c.key,d=c.styleSpec,_=c.style;if(!t.type)return[new a.V(r,t,'"type" is required')];const b=a.M(t.type);let E=[];switch(["vector","raster","raster-dem","raster-array"].includes(b)&&(t.url||t.tiles||E.push(new a.K(r,t,'Either "url" or "tiles" is required.'))),b){case"vector":case"raster":case"raster-dem":case"raster-array":return E=E.concat(qa({key:r,value:t,valueSpec:d[`source_${b.replace("-","_")}`],style:c.style,styleSpec:d,objectElementValidators:mh})),E;case"geojson":if(E=qa({key:r,value:t,valueSpec:d.source_geojson,style:_,styleSpec:d,objectElementValidators:mh}),t.cluster)for(const D in t.clusterProperties){const[U,Z]=t.clusterProperties[D],ie=typeof U=="string"?[U,["accumulated"],["get",D]]:U;E.push(...nl({key:`${r}.${D}.map`,value:Z,expressionContext:"cluster-map"})),E.push(...nl({key:`${r}.${D}.reduce`,value:ie,expressionContext:"cluster-reduce"}))}return E;case"video":return qa({key:r,value:t,valueSpec:d.source_video,style:_,styleSpec:d});case"image":return qa({key:r,value:t,valueSpec:d.source_image,style:_,styleSpec:d});case"canvas":return[new a.V(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Kc({key:`${r}.type`,value:t.type,valueSpec:{values:Mh(d)}})}}function Mh(c){return c.source.reduce((t,r)=>{const d=c[r];return d.type.type==="enum"&&(t=t.concat(Object.keys(d.type.values))),t},[])}function Sa(c){const t=c.value,r=c.styleSpec,d=r.light,_=c.style;let b=[];const E=a.J(t);if(t===void 0)return b;if(E!=="object")return b=b.concat([new a.V("light",t,`object expected, ${E} found`)]),b;for(const D in t){const U=D.match(/^(.*)-transition$/),Z=D.match(/^(.*)-use-theme$/);b=b.concat(Z&&d[Z[1]]?To({key:D,value:t[D],valueSpec:{type:"string"},style:_,styleSpec:r}):U&&d[U[1]]&&d[U[1]].transition?To({key:D,value:t[D],valueSpec:r.transition,style:_,styleSpec:r}):d[D]?To({key:D,value:t[D],valueSpec:d[D],style:_,styleSpec:r}):[new a.V(D,t[D],`unknown property "${D}"`)])}return b}function Wl(c){const t=c.value;let r=[];if(!t)return r;const d=a.J(t);if(d!=="object")return r=r.concat([new a.V("light-3d",t,`object expected, ${d} found`)]),r;const _=c.styleSpec,b=_["light-3d"],E=c.key,D=c.style,U=c.style.lights;for(const de of["type","id"])if(!(de in t))return r=r.concat([new a.V("light-3d",t,`missing property ${de} on light`)]),r;if(t.type&&U)for(let de=0;de<c.arrayIndex;de++){const ne=a.M(t.type),me=U[de];a.M(me.type)===ne&&r.push(new a.V(E,t.id,`duplicate light type "${t.type}", previously defined at line ${me.id.__line__}`))}const Z=`properties_light_${t.type}`;if(!(Z in _))return r=r.concat([new a.V("light-3d",t,`Invalid light type ${t.type}`)]),r;const ie=_[Z];for(const de in t)if(de==="properties"){const ne=t[de],me=a.J(ne);if(me!=="object")return r=r.concat([new a.V("properties",ne,`object expected, ${me} found`)]),r;for(const Ce in ne){const Me=Ce.match(/^(.*)-transition$/),Pe=Ce.match(/^(.*)-use-theme$/);r=r.concat(Pe&&ie[Pe[1]]?To({key:de,value:ne[Ce],valueSpec:{type:"string"},style:D,styleSpec:_}):Me&&ie[Me[1]]&&ie[Me[1]].transition?To({key:de,value:t[de],valueSpec:_.transition,style:D,styleSpec:_}):ie[Ce]?To({key:Ce,value:ne[Ce],valueSpec:ie[Ce],style:D,styleSpec:_}):[new a.K(c.key,ne[Ce],`unknown property "${Ce}"`)])}}else r=r.concat(b[de]?To({key:de,value:t[de],valueSpec:b[de],style:D,styleSpec:_}):[new a.K(de,t[de],`unknown property "${de}"`)]);return r}function Tu(c){const t=c.value,r=c.key,d=c.style,_=c.styleSpec,b=_.terrain;let E=[];const D=a.J(t);if(t===void 0||D==="null")return E;if(D!=="object")return E=E.concat([new a.V("terrain",t,`object expected, ${D} found`)]),E;for(const U in t){const Z=U.match(/^(.*)-transition$/),ie=U.match(/^(.*)-use-theme$/);E=E.concat(ie&&b[ie[1]]?To({key:U,value:t[U],valueSpec:{type:"string"},style:d,styleSpec:_}):Z&&b[Z[1]]&&b[Z[1]].transition?To({key:U,value:t[U],valueSpec:_.transition,style:d,styleSpec:_}):b[U]?To({key:U,value:t[U],valueSpec:b[U],style:d,styleSpec:_}):[new a.K(U,t[U],`unknown property "${U}"`)])}if(t.source){const U=d.sources&&d.sources[t.source],Z=U&&a.M(U.type);U?Z!=="raster-dem"&&E.push(new a.V(r,t.source,`terrain cannot be used with a source of type ${String(Z)}, it only be used with a "raster-dem" source type`)):E.push(new a.V(r,t.source,`source "${t.source}" not found`))}else E.push(new a.V(r,t,'terrain is missing required property "source"'));return E}function Jc(c){const t=c.value,r=c.style,d=c.styleSpec,_=d.fog;let b=[];const E=a.J(t);if(t===void 0)return b;if(E!=="object")return b=b.concat([new a.V("fog",t,`object expected, ${E} found`)]),b;for(const D in t){const U=D.match(/^(.*)-transition$/),Z=D.match(/^(.*)-use-theme$/);b=b.concat(Z&&_[Z[1]]?To({key:D,value:t[D],valueSpec:{type:"string"},style:r,styleSpec:d}):U&&_[U[1]]&&_[U[1]].transition?To({key:D,value:t[D],valueSpec:d.transition,style:r,styleSpec:d}):_[D]?To({key:D,value:t[D],valueSpec:_[D],style:r,styleSpec:d}):[new a.K(D,t[D],`unknown property "${D}"`)])}return b}const Td={"*":()=>[],array:Lc,boolean:function(c){const t=c.value,r=c.key,d=a.J(t);return d!=="boolean"?[new a.V(r,t,`boolean expected, ${d} found`)]:[]},number:wd,color:function(c){const t=c.key,r=c.value,d=a.J(r);return d!=="string"?[new a.V(t,r,`color expected, ${d} found`)]:a.a0.parseCSSColor(r)===null?[new a.V(t,r,`color expected, "${r}" found`)]:[]},enum:Kc,filter:Gs,function:Ps,layer:Gd,object:qa,source:ll,model:a.a4,light:Sa,"light-3d":Wl,terrain:Tu,fog:Jc,string:Oc,formatted:function(c){return Oc(c).length===0?[]:nl(c)},resolvedImage:function(c){return Oc(c).length===0?[]:nl(c)},projection:function(c){const t=c.value,r=c.styleSpec,d=r.projection,_=c.style;let b=[];const E=a.J(t);if(E==="object")for(const D in t)b=b.concat(To({key:D,value:t[D],valueSpec:d[D],style:_,styleSpec:r}));else E!=="string"&&(b=b.concat([new a.V("projection",t,`object or string expected, ${E} found`)]));return b},import:function(c){const{value:t,styleSpec:r}=c,{data:d,..._}=t;Object.defineProperty(_,"__line__",{value:t.__line__,enumerable:!1});let b=qa(a.L({},c,{value:_,valueSpec:r.import}));return a.M(_.id)===""&&b.push(new a.V(`${c.key}.id`,_,"import id can't be an empty string")),d&&(b=b.concat(Za(d,r,{key:`${c.key}.data`}))),b},iconset:function(c){const t=c.value,r=c.key,d=c.styleSpec,_=c.style;if(!t.type)return[new a.V(r,t,'"type" is required')];const b=a.M(t.type);let E=[];if(E=E.concat(qa({key:r,value:t,valueSpec:d[`iconset_${b}`],style:_,styleSpec:d})),b==="source"&&t.source){const D=_.sources&&_.sources[t.source],U=D&&a.M(D.type);D?U!=="raster-array"&&E.push(new a.V(r,t.source,`iconset cannot be used with a source of type ${String(U)}, it only be used with a "raster-array" source type`)):E.push(new a.V(r,t.source,`source "${t.source}" not found`))}return E}};function To(c,t=!1){const r=c.value,d=c.valueSpec,_=c.styleSpec;if(d.expression&&a.a2(a.M(r)))return Ps(c);if(d.expression&&a.S(a.U(r)))return nl(c);if(d.type&&Td[d.type]){const b=Td[d.type](c);return t===!0&&b.length>0&&a.J(c.value)==="array"?nl(c):b}return qa(a.L({},c,{valueSpec:d.type?_[d.type]:d}))}function Rn(c){const t=c.value,r=c.key,d=Oc(c);return d.length||(t.indexOf("{fontstack}")===-1&&d.push(new a.V(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&d.push(new a.V(r,t,'"glyphs" url must include a "{range}" token'))),d}function Za(c,t=a.a5,r={}){return To({key:r.key||"",value:c,valueSpec:t.$root,styleSpec:t,style:c,objectElementValidators:{glyphs:Rn,"*":()=>[]}})}function Hl(c,t=a.a5){return Et(Za(c,t))}const mc=c=>Et(ll(c)),Va=c=>Et(Sa(c)),Zl=c=>Et(Wl(c)),Wi=c=>Et(Tu(c)),Ra=c=>Et(Jc(c)),pp=c=>Et(function(t){const r=t.value,d=t.style,_=t.styleSpec,b=_.snow;let E=[];const D=a.J(r);if(r===void 0)return E;if(D!=="object")return E=E.concat([new a.V("snow",r,`object expected, ${D} found`)]),E;for(const U in r){const Z=U.match(/^(.*)-transition$/);E=E.concat(Z&&b[Z[1]]&&b[Z[1]].transition?To({key:U,value:r[U],valueSpec:_.transition,style:d,styleSpec:_}):b[U]?To({key:U,value:r[U],valueSpec:b[U],style:d,styleSpec:_}):[new a.K(U,r[U],`unknown property "${U}"`)])}return E}(c)),vl=c=>Et(function(t){const r=t.value,d=t.style,_=t.styleSpec,b=_.rain;let E=[];const D=a.J(r);if(r===void 0)return E;if(D!=="object")return E=E.concat([new a.V("rain",r,`object expected, ${D} found`)]),E;for(const U in r){const Z=U.match(/^(.*)-transition$/);E=E.concat(Z&&b[Z[1]]&&b[Z[1]].transition?To({key:U,value:r[U],valueSpec:_.transition,style:d,styleSpec:_}):b[U]?To({key:U,value:r[U],valueSpec:b[U],style:d,styleSpec:_}):[new a.K(U,r[U],`unknown property "${U}"`)])}return E}(c)),lr=c=>Et(Gd(c)),ei=c=>Et(Gs(c)),Oe=c=>Et(fc(c)),We=c=>Et(al(c)),ct=c=>Et(a.a4(c));function Et(c){return c.slice().sort((t,r)=>t.line&&r.line?t.line-r.line:0)}function at(c,t){let r=!1;if(t&&t.length)for(const d of t)d instanceof a.K?a.w(d.message):(c.fire(new a.z(new Error(d.message))),r=!0);return r}let zt;class oi extends a.E{constructor(t,r="flat"){super(),this._transitionable=new a.a6(zt||(zt=new a.a7({anchor:new a.a8(a.a5.light.anchor),position:new a.a9(a.a5.light.position),color:new a.a8(a.a5.light.color),intensity:new a.a8(a.a5.light.intensity)}))),this.setLight(t,r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,r,d={}){this._validate(Va,t,d)||(this._transitionable.setTransitionOrValue(t),this.id=r)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,d){return(!d||d.validate!==!1)&&at(this,t.call(Hl,a.h({value:r,style:{glyphs:!0,sprite:!0},styleSpec:a.a5})))}}let jt=class extends a.E{constructor(c,t,r,d,_){super(),this.scope=r,this._transitionable=new a.a6(new a.a7({source:new a.a8(a.a5.terrain.source),exaggeration:new a.a8(a.a5.terrain.exaggeration)}),r,d),this._transitionable.setTransitionOrValue(c,d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=_}get(){return this._transitionable.serialize()}set(c,t){this._transitionable.setTransitionOrValue(c,t)}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}getExaggeration(c){return this._transitioning.possiblyEvaluate(new a.aa(c,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const c=this._transitionable._values.exaggeration;if(!c)return null;const t=c.value.expression;if(!t)return null;let r=-1,d=-1,_=1;for(const b of t.zoomStops)_=t.evaluate(new a.aa(b,{worldview:this.worldview})),_>.01?(r=b,d=-1):d=b;return _<.01&&r>0&&d>r?[r,d]:null}isZoomDependent(){const c=this._transitionable._values.exaggeration;return c!=null&&c.value!=null&&c.value.expression!=null&&c.value.expression instanceof a.ab}};const qt=45,gi=65,li=.05;function Zi(c,t,r,d){const _=a.af(qt,gi,r),[b,E]=Ss(c,d);let D=1-Math.min(1,Math.exp((t-b)/(E-b)*-6));return D*=D*D,D=Math.min(1,1.00747*D),D*_*c.alpha}function Ss(c,t){const r=.5/Math.tan(.5*t);return[c.range[0]+r,c.range[1]+r]}function ds(c,t,r,d,_){const b=a.ad([],[t,r,d],_.mercatorFogMatrix);return Zi(c,a.ae(b),_.pitch,_._fov)}function Ws(c,t,r,d,_,b,E){const D=[[r,d,0],[_,d,0],[_,b,0],[r,b,0]];let U=Number.MAX_VALUE,Z=-Number.MAX_VALUE;for(const ie of D){const de=a.ad([],ie,t),ne=a.ae(de);U=Math.min(U,ne),Z=Math.max(Z,ne)}return[Zi(c,U,E.pitch,E._fov),Zi(c,Z,E.pitch,E._fov)]}class mr extends a.E{constructor(t,r,d,_){super();const b=new a.a7({range:new a.a8(a.a5.fog.range),color:new a.a8(a.a5.fog.color),"color-use-theme":new a.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new a.a8(a.a5.fog["high-color"]),"high-color-use-theme":new a.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new a.a8(a.a5.fog["space-color"]),"space-color-use-theme":new a.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new a.a8(a.a5.fog["horizon-blend"]),"star-intensity":new a.a8(a.a5.fog["star-intensity"]),"vertical-range":new a.a8(a.a5.fog["vertical-range"])});this._transitionable=new a.a6(b,d,new Map(_)),this.set(t,_),this._transitioning=this._transitionable.untransitioned(),this._transform=r,this.properties=new a.ag(b),this.scope=d}get state(){const t=this._transform,r=t.projection.name==="globe",d=a.ah(t.zoom),_=this.properties.get("range"),b=[.5,3];return{range:r?[a.ai(b[0],_[0],d),a.ai(b[1],_[1],d)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,r,d={}){if(this._validate(Ra,t,d))return;const _=a.h({},t);for(const b of Object.keys(a.a5.fog))_[b]===void 0&&(_[b]=a.a5.fog[b].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,r)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const r=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:a.af(qt,gi,t))*r.a}getOpacityAtLatLng(t,r){return this._transform.projection.supportsFog?function(d,_,b){const E=a.ac.fromLngLat(_),D=b.elevation?b.elevation.getAtPointOrZero(E):0;return ds(d,E.x,E.y,D,b)}(this.state,t,r):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const r=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Ws(this.state,r,0,0,a.aj,a.aj,this._transform)}getOpacityForBounds(t,r,d,_,b){return this._transform.projection.supportsFog?Ws(this.state,t,r,d,_,b,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Ss(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const r=[4,5,6,7];for(const d of r){const _=t.points[d];let b;if(_[2]>=0)b=_;else{const E=t.points[d-4];b=a.ak(E,_,E[2]/(E[2]-_[2]))}if(ds(this.state,b[0],b[1],0,this._transform)>=li)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,d){return(!d||d.validate!==!1)&&at(this,t.call(Hl,a.h({value:r,style:{glyphs:!0,sprite:!0},styleSpec:a.a5})))}}let vr,Rr,Ar,Ko,to=class extends a.E{constructor(c,t,r,d){super();const _=vr||(vr=new a.a7({density:new a.a8(a.a5.snow.density),intensity:new a.a8(a.a5.snow.intensity),color:new a.a8(a.a5.snow.color),opacity:new a.a8(a.a5.snow.opacity),vignette:new a.a8(a.a5.snow.vignette),"vignette-color":new a.a8(a.a5.snow["vignette-color"]),"center-thinning":new a.a8(a.a5.snow["center-thinning"]),direction:new a.a8(a.a5.snow.direction),"flake-size":new a.a8(a.a5.snow["flake-size"])}));this._transitionable=new a.a6(_,r,new Map(d)),this.set(c,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new a.ag(_),this.scope=r}get state(){const c=this.properties.get("opacity"),t=this.properties.get("color"),r=this.properties.get("direction"),d=a.al(r[0]),_=-Math.max(a.al(r[1]),.01),b=[Math.cos(d)*Math.cos(_),Math.sin(d)*Math.cos(_),Math.sin(_)],E=this.properties.get("vignette"),D=this.properties.get("vignette-color");return D.a=E,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new a.am(t.r,t.g,t.b,t.a*c),direction:b,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:D}}get(){return this._transitionable.serialize()}set(c,t,r={}){if(this._validate(pp,c,r))return;const d=a.h({},c);for(const _ of Object.keys(a.a5.snow))d[_]===void 0&&(d[_]=a.a5.snow[_].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(c){this._transitionable.setTransitionOrValue(this._options,new Map(c))}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,t,r){return(!r||r.validate!==!1)&&at(this,c.call(Hl,a.h({value:t,style:{glyphs:!0,sprite:!0},styleSpec:a.a5})))}},nn=class extends a.E{constructor(c,t,r,d){super();const _=Rr||(Rr=new a.a7({density:new a.a8(a.a5.rain.density),intensity:new a.a8(a.a5.rain.intensity),color:new a.a8(a.a5.rain.color),opacity:new a.a8(a.a5.rain.opacity),vignette:new a.a8(a.a5.rain.vignette),"vignette-color":new a.a8(a.a5.rain["vignette-color"]),"center-thinning":new a.a8(a.a5.rain["center-thinning"]),direction:new a.a8(a.a5.rain.direction),"droplet-size":new a.a8(a.a5.rain["droplet-size"]),"distortion-strength":new a.a8(a.a5.rain["distortion-strength"])}));this._transitionable=new a.a6(_,r,new Map(d)),this.set(c,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new a.ag(_),this.scope=r}get state(){const c=this.properties.get("opacity"),t=this.properties.get("color"),r=this.properties.get("direction"),d=a.al(r[0]),_=-Math.max(a.al(r[1]),.01),b=[Math.cos(d)*Math.cos(_),Math.sin(d)*Math.cos(_),Math.sin(_)],E=this.properties.get("vignette-color");return E.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new a.am(t.r,t.g,t.b,t.a*c),direction:b,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:E}}get(){return this._transitionable.serialize()}set(c,t,r={}){if(this._validate(vl,c,r))return;const d=a.h({},c);for(const _ of Object.keys(a.a5.rain))d[_]===void 0&&(d[_]=a.a5.rain[_].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(c){this._transitionable.setTransitionOrValue(this._options,new Map(c))}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,t,r){return(!r||r.validate!==!1)&&at(this,c.call(Hl,a.h({value:t,style:{glyphs:!0,sprite:!0},styleSpec:a.a5})))}};class ao extends a.E{constructor(t,r,d,_){super(),this.scope=d,this._options=t,this.properties=new a.ag(r),this._transitionable=new a.a6(r,d,new Map(_)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,r){this._options=t,this._transitionable.setTransitionOrValue(t.properties,r)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class lo{constructor(t,r,d,_){this.screenBounds=t,this.cameraPoint=r,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=d,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(t,r){let d,_;if(t instanceof a.P||typeof t[0]=="number"){const b=a.P.convert(t);d=[b],_=r.isPointAboveHorizon(b)}else{const b=a.P.convert(t[0]),E=a.P.convert(t[1]),D=b.add(E)._div(2);d=[b,E],_=a.ao(b,E).every(U=>r.isPointAboveHorizon(U))&&r.isPointAboveHorizon(D)}return new lo(d,r.getCameraPoint(),_,r)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return a.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const r=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],_=a.ao(r,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>r.x&&this.cameraPoint.x<d.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?_[2]=this.cameraPoint:this.cameraPoint.x<=r.x&&(_[3]=this.cameraPoint)),a.ap(_,t)}bufferedCameraGeometryGlobe(t){const r=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],_=a.ao(r,d,t),b=this.cameraPoint.clone();switch(3*((b.y>r.y)+(b.y>d.y))+((b.x>r.x)+(b.x>d.x))){case 0:_[0]=b,_[4]=b.clone();break;case 1:_.splice(1,0,b);break;case 2:_[1]=b;break;case 3:_.splice(4,0,b);break;case 5:_.splice(2,0,b);break;case 6:_[3]=b;break;case 7:_.splice(3,0,b);break;case 8:_[2]=b}return _}containsTile(t,r,d,_=0){const b=t.queryPadding/r._pixelsPerMercatorPixel+1,E=d?this._bufferedCameraMercator(b,r):this._bufferedScreenMercator(b,r);let D=t.tileID.wrap+(E.unwrapped?_:0);const U=E.polygon.map(Pe=>a.aq(t.tileTransform,Pe,D));if(!a.ar(U,0,0,a.aj,a.aj))return;D=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const Z=this.screenGeometryMercator.polygon.map(Pe=>a.as(t.tileTransform,Pe,D)),ie=Z.map(Pe=>new a.P(Pe[0],Pe[1])),de=r.getFreeCameraOptions().position||new a.ac(0,0,0),ne=a.as(t.tileTransform,de,D),me=Z.map(Pe=>{const Ne=a.at(Pe,Pe,ne);return a.au(Ne,Ne),new a.av(ne,Ne)}),Ce=a.aw(t,1,r.zoom)*r._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:ie,tilespaceRays:me,bufferedTilespaceGeometry:U,bufferedTilespaceBounds:(Me=a.ax(U),Me.min.x=a.ay(Me.min.x,0,a.aj),Me.min.y=a.ay(Me.min.y,0,a.aj),Me.max.x=a.ay(Me.max.x,0,a.aj),Me.max.y=a.ay(Me.max.y,0,a.aj),Me),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:Ce};var Me}_bufferedScreenMercator(t,r){const d=un(t);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let _;return _=r.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),r):{polygon:this.bufferedScreenGeometry(t).map(b=>r.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[d]=_,_}}_bufferedCameraMercator(t,r){const d=un(t);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let _;return _=r.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),r):{polygon:this.bufferedCameraGeometry(t).map(b=>r.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[d]=_,_}}_projectAndResample(t,r){const d=function(b,E){const D=a.az([],E.pixelMatrix,E.globeMatrix),U=[0,-a.aB,0,1],Z=[0,a.aB,0,1],ie=[0,0,0,1];a.aA(U,U,D),a.aA(Z,Z,D),a.aA(ie,ie,D);const de=new a.P(U[0]/U[3],U[1]/U[3]),ne=new a.P(Z[0]/Z[3],Z[1]/Z[3]),me=a.aC(b,de)&&U[3]<ie[3],Ce=a.aC(b,ne)&&Z[3]<ie[3];if(!me&&!Ce)return null;const Me=function(xt,pt,At){for(let Ct=1;Ct<xt.length;Ct++){const ti=fn(pt.pointCoordinate3D(xt[Ct-1]).x),si=fn(pt.pointCoordinate3D(xt[Ct]).x);if(At<0){if(ti<si)return{idx:Ct,t:-ti/(si-1-ti)}}else if(si<ti)return{idx:Ct,t:(1-ti)/(si+1-ti)}}return null}(b,E,me?-1:1);if(!Me)return null;const{idx:Pe,t:Ne}=Me;let He=Pe>1?Oo(b.slice(0,Pe),E):[],lt=Pe<b.length?Oo(b.slice(Pe),E):[];He=He.map(xt=>new a.P(fn(xt.x),xt.y)),lt=lt.map(xt=>new a.P(fn(xt.x),xt.y));const ut=[...He];ut.length===0&&ut.push(lt[lt.length-1]);const kt=a.ai(ut[ut.length-1].y,(lt.length===0?He[0]:lt[0]).y,Ne);let wt;return wt=me?[new a.P(0,kt),new a.P(0,0),new a.P(1,0),new a.P(1,kt)]:[new a.P(1,kt),new a.P(1,1),new a.P(0,1),new a.P(0,kt)],ut.push(...wt),lt.length===0?ut.push(He[0]):ut.push(...lt),{polygon:ut.map(xt=>new a.ac(xt.x,xt.y)),unwrapped:!1}}(t,r);if(d)return d;const _=function(b,E){let D=!1,U=-1/0,Z=0;for(let de=0;de<b.length-1;de++)b[de].x>U&&(U=b[de].x,Z=de);for(let de=0;de<b.length-1;de++){const ne=(Z+de)%(b.length-1),me=b[ne],Ce=b[ne+1];Math.abs(me.x-Ce.x)>.5&&(me.x<Ce.x?(me.x+=1,ne===0&&(b[b.length-1].x+=1)):(Ce.x+=1,ne+1===b.length-1&&(b[0].x+=1)),D=!0)}const ie=a.aD(E.center.lng);return D&&ie<Math.abs(ie-1)&&b.forEach(de=>{de.x-=1}),{polygon:b,unwrapped:D}}(Oo(t,r).map(b=>new a.P(fn(b.x),b.y)),r);return{polygon:_.polygon.map(b=>new a.ac(b.x,b.y)),unwrapped:_.unwrapped}}}function Oo(c,t){return a.aE(c,r=>{const d=t.pointCoordinate3D(r);r.x=d.x,r.y=d.y},1/256)}function fn(c){return c<0?1+c%1:c%1}function un(c){return 100*c|0}function Ka(c,t,r,d,_){const b=function(D,U){if(D)return _(D);if(U){if(c.url&&U.tiles&&c.tiles&&delete c.tiles,U.variants){if(!Array.isArray(U.variants))return _(new Error("variants must be an array"));for(const ie of U.variants){if(ie==null||typeof ie!="object"||ie.constructor!==Object)return _(new Error("variant must be an object"));if(!Array.isArray(ie.capabilities))return _(new Error("capabilities must be an array"));if(ie.capabilities.length===1&&ie.capabilities[0]==="meshopt"){U=a.h(U,ie);break}}}const Z=a.aF(a.h({},U,c),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);Z.tiles=t.canonicalizeTileset(Z,c.url),_(null,Z)}},E=function(D,U,Z){if(!D)return null;if(!U&&!Z)return D;Z=Z||D.worldview_default;const ie=Object.values(D.language||{});if(ie.length===0)return null;const de=Object.values(D.worldview||{});if(de.length===0)return null;const ne=ie.every(Ce=>Ce===U),me=de.every(Ce=>Ce===Z);return ne&&me?D:U in(D.language_options||{})||Z in(D.worldview_options||{})?null:D.language_options&&D.worldview_options?D:null}(c.data,r,d);return E?a.q.frame(()=>b(null,E)):c.url?a.n(t.transformRequest(t.normalizeSourceURL(c.url,null,r,d),a.R.Source),b):a.q.frame(()=>{const{data:D,...U}=c;b(null,U)})}function an(c,t){const r=Math.pow(2,t.z),d=Math.floor(a.aD(c.getWest())*r),_=Math.floor(a.aH(c.getNorth())*r),b=Math.ceil(a.aD(c.getEast())*r),E=Math.ceil(a.aH(c.getSouth())*r);return t.x>=d&&t.x<b&&t.y>=_&&t.y<E}class Il{constructor(t,r,d){this.bounds=t?a.aG.convert(this.validateBounds(t)):null,this.minzoom=r||0,this.maxzoom=d||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const r of t)this.extraBounds.push(a.aG.convert(this.validateBounds(r)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!an(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const r of this.extraBounds)if(an(r,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const r=new Il(t.bounds,t.minzoom,t.maxzoom);return r.addExtraBounds(t.extra_bounds),r}}class Hh extends a.E{constructor(t,r,d,_){if(super(),this.id=t,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.h(this,a.aF(r,["url","scheme","tileSize","promoteId"])),this._options=a.h({type:"vector"},r),this._collectResourceTiming=!!r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new a.aI}load(t){this._loaded=!1,this.fire(new a.A("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map.getWorldview();this._tileJSONRequest=Ka(this._options,this.map._requestManager,r,d,(_,b)=>{if(this._tileJSONRequest=null,this._loaded=!0,_)r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),d&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new a.z(_));else if(b){if(a.h(this,b),this.hasWorldviews=!!b.worldview_options,b.worldview_default&&(this.worldviewDefault=b.worldview_default),b.vector_layers){this.vectorLayers=b.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const E of b.vector_layers)this.vectorLayerIds.push(E.id),b.worldview&&b.worldview[E.source]&&this.localizableLayerIds.add(E.id)}this.tileBounds=Il.fromTileJSON(b),za(b.tiles,this.map._requestManager._customAccessToken),this.fire(new a.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.A("data",{dataType:"source",sourceDataType:"content"}))}t&&t(_)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=a.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return a.h({},this._options)}loadTile(t,r){const d=t.tileID.canonical.url(this.tiles,this.scheme),_=this.map._requestManager.normalizeTileURL(d),b=this.map._requestManager.transformRequest(_,a.R.Tile),E=this.map.style?this.map.style.getLut(this.scope):null,D=E?{image:E.image.clone()}:null,U={request:b,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:D,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:a.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&a.j(d)&&(U.localizableLayerIds=this.localizableLayerIds),U.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=r:t.request=t.actor.send("reloadTile",U,Z.bind(this));else if(t.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",U,Z.bind(this),void 0,!0);else{const ie=a.aJ.call({deduped:this._deduped},U,(de,ne)=>{de||!ne?Z.call(this,de):(U.data={cacheControl:ne.cacheControl,expires:ne.expires,rawData:ne.rawData.slice(0)},t.actor&&t.actor.send("loadTile",U,Z.bind(this),void 0,!0))},!0);t.request={cancel:ie}}function Z(ie,de){return delete t.request,t.aborted?r(null):ie&&ie.status!==404?r(ie):(de&&de.resourceTiming&&(t.resourceTiming=de.resourceTiming),this.map._refreshExpiredTiles&&de&&t.setExpiryData(de),t.loadVectorData(de,this.map.painter),a.aK(this.dispatcher),r(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,r){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ua extends a.E{constructor(t,r,d,_){super(),this.id=t,this.dispatcher=d,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.h({type:"raster"},r),a.h(this,a.aF(r,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new a.A("dataloading",{dataType:"source"}));const r=this.map.getWorldview();this._tileJSONRequest=Ka(this._options,this.map._requestManager,null,r,(d,_)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new a.z(d)):_&&(a.h(this,_),_.raster_layers&&(this.rasterLayers=_.raster_layers,this.rasterLayerIds=this.rasterLayers.map(b=>b.id)),this.tileBounds=Il.fromTileJSON(_),za(_.tiles),this.fire(new a.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(d)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=a.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return a.h({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,r){const d=a.q.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);t.request=a.o(this.map._requestManager.transformRequest(_,a.R.Tile),(b,E,D,U)=>(delete t.request,t.aborted?(t.state="unloaded",r(null)):b?(t.state="errored",r(b)):E?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:D,expires:U}),t.setTexture(E,this.map.painter),t.state="loaded",a.aK(this.dispatcher),void r(null)):r(null)))}abortTile(t,r){t.request&&(t.request.cancel(),delete t.request),r&&r()}unloadTile(t,r){t.texture&&t.texture instanceof a.T?(t.destroy(!0),t.texture&&t.texture instanceof a.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),r&&r()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Xh extends Ua{constructor(t,r,d,_){super(t,r,d,_),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=a.h({type:"raster-array"},r)}triggerRepaint(t){const r=this.map.painter._terrain,d=this.map.style.getSourceCache(this.id);r&&r.enabled&&d&&r._clearRenderCacheForTile(d.id,t.tileID),this.map.triggerRepaint()}loadTile(t,r){const d=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(d,a.R.Tile),b={request:_,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=_,t.actor||(t.actor=this.dispatcher.getActor());const E=(D,U,Z,ie)=>{if(delete t.request,t.aborted)return t.state="unloaded",r(null);if(D)return D.name==="AbortError"?void 0:(t.state="errored",r(D));if(this.map._refreshExpiredTiles&&U&&t.setExpiryData({cacheControl:Z,expires:ie}),this.partial)t.state="empty";else{if(!U)return r(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=U}r(null)};t.request=this.partial?t.fetchHeader(void 0,E.bind(this)):t.actor.send("loadTile",b,E.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,r){const d=t.texture;d&&d instanceof a.T?(t.destroy(!0),this.map.painter.saveTileTexture(d)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,r,d){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(r,d,(_,b)=>{if(_)return t.state="errored",this.fire(new a.z(_)),void this.triggerRepaint(t);b&&(t._isHeaderLoaded=!0,t.setTexture(b,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const r=this.rasterLayers.find(({id:b})=>b===t),d=r&&r.fields,_=d&&d.bands&&d.bands;return _?_[0]:0}getTextureDescriptor(t,r,d){if(!t)return;const _=r.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!_)return;let b=null;r instanceof a.aN?b=r.paint.get("raster-array-band"):r instanceof a.aO&&(b=r.paint.get("raster-particle-array-band"));const E=b||this.getInitialBand(_);if(E!=null)if(t.textureDescriptor){if(!t.updateNeeded(_,E)||d)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,_,E)}getImages(t,r){const d=new Map;for(const _ of t)for(const b of r){const[E,D]=b.split("/"),U=_.getLayer(E);if(!U||!U.hasBand(D)||!U.hasDataForBand(D))continue;const{bytes:Z,tileSize:ie,buffer:de}=U.getBandView(D),ne=ie+2*de,me={data:new a.r({width:ne,height:ne},Z),pixelRatio:2,sdf:!1,usvg:!1,version:0};d.set(b,me)}return d}}const fp={vector:Hh,raster:Ua,"raster-dem":class extends Ua{constructor(c,t,r,d){super(c,t,r,d),this.type="raster-dem",this.maxzoom=22,this._options=a.h({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(c,t){const r=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(_,b){_&&(c.state="errored",t(_)),b&&(c.dem=b,c.dem.onDeserialize(),c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0,c.state="loaded",t(null))}c.request=a.o(this.map._requestManager.transformRequest(r,a.R.Tile),(function(_,b,E,D){if(delete c.request,c.aborted)c.state="unloaded",t(null);else if(_)c.state="errored",t(_);else if(b){this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:E,expires:D});const U=ImageBitmap&&b instanceof ImageBitmap&&a.t(),Z=1-(b.width-a.aL(b.width))/2;Z<1||c.neighboringTiles||(c.neighboringTiles=this._getNeighboringTiles(c.tileID));const ie=U?b:a.q.getImageData(b,Z),de={uid:c.uid,tileID:c.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:ie,encoding:this.encoding,padding:Z};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadTile",de,d.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(c){const t=c.canonical,r=Math.pow(2,t.z),d=(t.x-1+r)%r,_=t.x===0?c.wrap-1:c.wrap,b=(t.x+1+r)%r,E=t.x+1===r?c.wrap+1:c.wrap,D={};return D[new a.aM(c.overscaledZ,_,t.z,d,t.y).key]={backfilled:!1},D[new a.aM(c.overscaledZ,E,t.z,b,t.y).key]={backfilled:!1},t.y>0&&(D[new a.aM(c.overscaledZ,_,t.z,d,t.y-1).key]={backfilled:!1},D[new a.aM(c.overscaledZ,c.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},D[new a.aM(c.overscaledZ,E,t.z,b,t.y-1).key]={backfilled:!1}),t.y+1<r&&(D[new a.aM(c.overscaledZ,_,t.z,d,t.y+1).key]={backfilled:!1},D[new a.aM(c.overscaledZ,c.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},D[new a.aM(c.overscaledZ,E,t.z,b,t.y+1).key]={backfilled:!1}),D}},"raster-array":Xh,geojson:class extends a.E{constructor(c,t,r,d){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(d),this._data=t.data,this._options=a.h({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const _=a.aj/this.tileSize;this.workerOptions=a.h({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*_,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*_,extent:a.aj,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:a.aj,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*_,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(c){this.map=c,this.setData(this._data)}setData(c){return this._data=c,this._updateWorkerData(),this}updateData(c){if(!this._options.dynamic)return this.fire(new a.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof c!="string"&&(c.type==="Feature"&&(c={type:"FeatureCollection",features:[c]}),c.type!=="FeatureCollection"))return this.fire(new a.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof c!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const r of this._data.features)t.set(r.id,r);for(const r of c.features)t.set(r.id,r);this._data.features=[...t.values()]}else this._data=c;return this._updateWorkerData(!0),this}getClusterExpansionZoom(c,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id,scope:this.scope},t),this}getClusterChildren(c,t){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id,scope:this.scope},t),this}getClusterLeaves(c,t,r,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:c,limit:t,offset:r},d),this}_updateWorkerData(c=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.A("dataloading",{dataType:"source"})),this._loaded=!1;const t=a.h({append:c},this.workerOptions);t.scope=this.scope;const r=this._data;typeof r=="string"?(t.request=this.map._requestManager.transformRequest(a.q.resolveURL(r),a.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(d,_)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new a.z(d));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(b.resourceTiming=_.resourceTiming[this.id]),c&&(this._partialReload=!0),this.fire(new a.A("data",b)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(c),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const c=a.C(this.id,this.scope);this.map.style.clearSource(c),this._updateWorkerData()}loadTile(c,t){const r=c.actor?"reloadTile":"loadTile";c.actor=this.actor;const d=this.map.style?this.map.style.getLut(this.scope):null,_=d?{image:d.image.clone()}:null,b=this._partialReload,E={type:this.type,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:_,scope:this.scope,pixelRatio:a.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:c.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:b,worldview:this.map.getWorldview()};c.request=this.actor.send(r,E,(D,U)=>b&&!U?(c.state="loaded",t(null)):(delete c.request,c.destroy(),c.aborted?t(null):D?t(D):(c.loadVectorData(U,this.map.painter,r==="reloadTile"),t(null))),void 0,r==="loadTile")}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0}unloadTile(c,t){this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id,scope:this.scope}),c.destroy()}onRemove(c){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.h({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends a.aP{constructor(c,t,r,d){super(c,t,r,d),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const c=this.options;this.urls=[];for(const t of c.urls)this.urls.push(this.map._requestManager.transformRequest(t,a.R.Source).url);a.aQ(this.urls,(t,r)=>{this._loaded=!0,t?this.fire(new a.z(t)):r&&(this.video=r,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){const t=this.video.seekable;c<t.start(0)||c>t.end(0)?this.fire(new a.z(new a.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const c=this.map.painter.context,t=c.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new a.T(c,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(c)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:a.aP,model:class extends a.E{constructor(c,t,r,d){super(),this.id=c,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const c=[];for(const t in this._options.models){const r=this._options.models[t],d=a.aS(this.map._requestManager.transformRequest(r.uri,a.R.Model).url).then(_=>{if(!_)return;const b=a.aT(_),E=new a.aU(t,r.position,r.orientation,b);E.computeBoundsAndApplyParent(),this.models.push(E)}).catch(_=>{this.fire(new a.z(new Error(`Could not load model ${t} from ${r.uri}: ${_.message}`)))});c.push(d)}Promise.allSettled(c).then(()=>{this._loaded=!0,this.fire(new a.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this._loaded=!0,this.fire(new a.z(new Error(`Could not load models: ${t.message}`)))})}onAdd(c){this.map=c,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(c,t){}serialize(){return this._options}},"batched-model":class extends a.E{constructor(c,t,r,d){super(),this.type="batched-model",this.id=c,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=r,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(d)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest();const c=a.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(c))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(c){this._loaded=!1,this.fire(new a.A("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map.getWorldview();this._tileJSONRequest=Ka(this._options,this.map._requestManager,t,r,(d,_)=>{this._tileJSONRequest=null,this._loaded=!0,d?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),r&&r.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new a.z(d))):_&&(a.h(this,_),_.bounds&&(this.tileBounds=new Il(_.bounds,this.minzoom,this.maxzoom)),za(_.tiles,this.map._requestManager._customAccessToken),this.fire(new a.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.A("data",{dataType:"source",sourceDataType:"content"}))),c&&c(d)})}hasTransition(){return!1}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loaded(){return this._loaded}loadTile(c,t){const r=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(r,a.R.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:c.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:a.q.devicePixelRatio,promoteId:this.promoteId};if(c.actor&&c.state!=="expired")if(c.state==="loading")c.reloadCallback=t;else{if(c.buckets){const b=Object.values(c.buckets);for(const E of b)E.dirty=!0;return void(c.state="loaded")}c.request=c.actor.send("reloadTile",d,_.bind(this))}else c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",d,_.bind(this),void 0,!0);function _(b,E){return c.aborted?t(null):b&&b.status!==404?t(b):(this.map._refreshExpiredTiles&&E&&c.setExpiryData(E),c.loadModelData(E,this.map.painter),c.state="loaded",void t(null))}}serialize(){return a.h({},this._options)}},canvas:class extends a.aP{constructor(c,t,r,d){super(c,t,r,d),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(b=>typeof b!="number"))||this.fire(new a.z(new a.V(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.z(new a.V(`sources.${c}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new a.z(new a.V(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new a.z(new a.V(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.z(new a.V(`sources.${c}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(c){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!c&&!this._playing||this.texture instanceof a.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}},custom:class extends a.E{constructor(c,t,r,d){super(),this.id=c,this.type="custom",this._dataType="raster",this._dispatcher=r,this._implementation=t,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Il(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),a.h(this,a.aF(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(c){this.map=c,this._loaded=!1,this.fire(new a.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(c),this.load()}onRemove(c){this._implementation.onRemove&&this._implementation.onRemove(c)}hasTile(c){if(this._implementation.hasTile){const{x:t,y:r,z:d}=c.canonical;return this._implementation.hasTile({x:t,y:r,z:d})}return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,t){const{x:r,y:d,z:_}=c.tileID.canonical,b=new AbortController;c.request=Promise.resolve(this._implementation.loadTile({x:r,y:d,z:_},{signal:b.signal})).then((function(E){return delete c.request,c.aborted?(c.state="unloaded",t(null)):E===void 0?(c.state="errored",t(null)):E===null?(this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",t(null)):function(D){return D instanceof ImageData||D instanceof HTMLCanvasElement||D instanceof ImageBitmap||D instanceof HTMLImageElement}(E)?(this.loadTileData(c,E),c.state="loaded",void t(null)):(c.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(E=>{E.name!=="AbortError"&&(c.state="errored",t(E))}),c.request.cancel=()=>b.abort()}loadTileData(c,t){c.setTexture(t,this.map.painter)}unloadTile(c,t){if(c.texture&&c.texture instanceof a.T?(c.destroy(!0),c.texture&&c.texture instanceof a.T&&this.map.painter.saveTileTexture(c.texture)):c.destroy(),this._implementation.unloadTile){const{x:r,y:d,z:_}=c.tileID.canonical;this._implementation.unloadTile({x:r,y:d,z:_})}t&&t()}abortTile(c,t){c.request&&c.request.cancel&&(c.request.cancel(),delete c.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(c=>({x:c.canonical.x,y:c.canonical.y,z:c.canonical.z}))}_clearTiles(){const c=a.C(this.id,this.scope);this.map.style.clearSource(c)}_update(){this.fire(new a.A("data",{dataType:"source",sourceDataType:"content"}))}}},Gn=function(c,t,r,d){const _=new fp[t.type](c,t,r,d);if(_.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${_.id}`);return a.aV(["load","abort","unload","serialize","prepare"],_),_};function Yh(c,t,r=""){return`${r}:${t.id||""}:${t.layer.id}:${function(d){if("layerId"in d)return`layer:${d.layerId}`;{const{featuresetId:_,importId:b}=d;return`featureset:${_}${b?`:import:${b}`:""}`}}(c.target)}`}function Sd(c,t,r,d=""){if(c.uniqueFeatureID){const _=Yh(c,t,d);if(r.has(_))return!0;r.add(_)}return!1}function Wd(c,t,r,d,_=!1){const b=t.sourceCache.transform,E=t.sourceCache.tilesIn(c,t.has3DLayers,_);E.sort(Ah);const D=[];for(const U of E){const Z=U.tile.queryRenderedFeatures(t,U,r,d,b,_);Object.keys(Z).length&&D.push({wrappedTileID:U.tile.tileID.wrapped().key,queryResults:Z})}return D.length===0?{}:function(U){const Z={},ie={};for(const de of U){const ne=de.queryResults,me=de.wrappedTileID,Ce=ie[me]=ie[me]||{};for(const Me in ne){const Pe=ne[Me],Ne=Ce[Me]=Ce[Me]||{},He=Z[Me]=Z[Me]||[];for(const lt of Pe)Ne[lt.featureIndex]||(Ne[lt.featureIndex]=!0,He.push(lt))}}return Z}(D)}function Wn(c,t,r,d,_,b){const E={},D=d.queryRenderedSymbols(c),U=[];for(const Z of Object.keys(D).map(Number))U.push(_[Z]);U.sort(Ah);for(const Z of U){const ie=Z.featureIndex.lookupSymbolFeatures(D[Z.bucketInstanceId],Z.bucketIndex,Z.sourceLayerIndex,t,r,b);for(const de in ie){const ne=E[de]=E[de]||[],me=ie[de];me.sort((Ce,Me)=>{const Pe=Z.featureSortOrder;if(Pe){const Ne=Pe.indexOf(Ce.featureIndex);return Pe.indexOf(Me.featureIndex)-Ne}return Me.featureIndex-Ce.featureIndex});for(const Ce of me)ne.push(Ce)}}return E}function $u(c,t){const r=c.getRenderableIds().map(b=>c.getTileByID(b)),d=[],_={};for(let b=0;b<r.length;b++){const E=r[b],D=E.tileID.canonical.key;_[D]||(_[D]=!0,E.querySourceFeatures(d,t))}return d}function Ah(c,t){const r=c.tileID,d=t.tileID;return r.overscaledZ-d.overscaledZ||r.canonical.y-d.canonical.y||r.wrap-d.wrap||r.canonical.x-d.canonical.x}function $h(c,t){const r={};if(!t)return r;for(const d of c){const _=d.layerIds.map(b=>t.getLayer(b)).filter(Boolean);if(_.length!==0){d.layers=_,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map(b=>_.filter(E=>E.id===b)[0]));for(const b of _)r[b.fqid]=d}}return r}const gh=32,Kl=33,Qc=new Uint16Array(8184);for(let c=0;c<2046;c++){let t=c+2,r=0,d=0,_=0,b=0,E=0,D=0;for(1&t?_=b=E=gh:r=d=D=gh;(t>>=1)>1;){const Z=r+_>>1,ie=d+b>>1;1&t?(_=r,b=d,r=E,d=D):(r=_,d=b,_=E,b=D),E=Z,D=ie}const U=4*c;Qc[U+0]=r,Qc[U+1]=d,Qc[U+2]=_,Qc[U+3]=b}const Ma=new Uint16Array(2178),yn=new Uint8Array(1089),Hd=new Uint16Array(1089);function bl(c){return c===0?-.03125:c===32?.03125:0}const qh={type:2,extent:a.aj,loadGeometry:()=>[[new a.P(0,0),new a.P(a.aj+1,0),new a.P(a.aj+1,a.aj+1),new a.P(0,a.aj+1),new a.P(0,0)]]};class Zh{constructor(t,r,d,_,b,E){this.tileID=t,this.uid=a.a$(),this.uses=0,this.tileSize=r,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,_&&_.style&&(this._lastUpdatedBrightness=_.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",_&&_.transform&&(this.projection=_.transform.projection),this.worldview=E}registerFadeDuration(t){const r=t+this.timeAdded;r<a.q.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=a.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,r,d){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=$h(t.buckets,r.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const b=this.buckets[_];if(b instanceof a.b1){if(this.hasSymbolBuckets=!0,!d)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const b=this.buckets[_];if(b instanceof a.b1&&b.hasRTLText){this.hasRTLText=!0,a.b2();break}}this.queryPadding=0;for(const _ in this.buckets){const b=this.buckets[_],E=r.style.getOwnLayer(_);if(!E)continue;const D=E.queryRadius(b);this.queryPadding=Math.max(this.queryPadding,D)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new a.b0}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,r,d){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,$h(t.buckets,r.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const _ in this.buckets){const b=this.buckets[_];b.uploadPending()&&b.upload(t)}const r=t.gl,d=this.imageAtlas;d&&!d.uploaded&&(this.imageAtlasTexture=new a.T(t,d.image,r.RGBA8,{useMipmap:!!d.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new a.T(t,this.glyphAtlasImage,r.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new a.T(t,this.lineAtlas.image,r.R8),this.lineAtlas.uploaded=!0)}prepare(t,r,d){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,d),!r||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const _=r.style.getBrightness();(this._lastUpdatedBrightness||_)&&(this._lastUpdatedBrightness&&_&&Math.abs(this._lastUpdatedBrightness-_)<.001||(this.updateBuckets(r,this._lastUpdatedBrightness!==_),this._lastUpdatedBrightness=_))}queryRenderedFeatures(t,r,d,_,b,E){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const D=function(U,Z){const ie=a.bn([],[.5*U.width,.5*-U.height,1]);return a.bo(ie,ie,[1,-1,0]),a.az(ie,ie,U.calculateProjMatrix(Z.toUnwrapped())),Float32Array.from(ie)}(b,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:r,pixelPosMatrix:D,transform:_,availableImages:d,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(t,r){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const _=d.loadVTLayers(),b=r?r.sourceLayer:"",E=_._geojsonTileLayer||_[b];if(!E)return;const D=a.b3(r&&r.filter),{z:U,x:Z,y:ie}=this.tileID.canonical,de={z:U,x:Z,y:ie};for(let ne=0;ne<E.length;ne++){const me=E.feature(ne);if(D.needGeometry){const Pe=a.b4(me,!0);if(!D.filter(new a.aa(this.tileID.overscaledZ,{worldview:this.worldview}),Pe,this.tileID.canonical))continue}else if(!D.filter(new a.aa(this.tileID.overscaledZ,{worldview:this.worldview}),me))continue;const Ce=d.getId(me,b),Me=new a.b5(me,U,Z,ie,Ce);Me.tile=de,t.push(Me)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const d=a.b6(t.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const d=Date.now();let _=!1;if(this.expirationTime>d)_=!1;else if(r)if(this.expirationTime<r)_=!0;else{const b=this.expirationTime-r;b?this.expirationTime=d+Math.max(b,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,r){if(!this.latestFeatureIndex||!t.style)return;const d=this.latestFeatureIndex.loadVTLayers(),_=t.style.listImages(),b=t.style.getBrightness();for(const E in this.buckets){if(!t.style.hasLayer(E))continue;const D=this.buckets[E],U=D.layers[0],Z=U.sourceLayer||"_geojsonTileLayer",ie=d[Z],de=t.style.getLayerSourceCache(U);let ne={};de&&(ne=de._state.getState(Z,void 0));const me=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},Ce=Object.keys(ne).length>0&&!r;Ce&&!D.stateDependentLayers.length&&!r||D.update(ne,ie,_,me,Ce?D.stateDependentLayers:D.layers,r,b),(D instanceof a.b7||D instanceof a.b8)&&t._terrain&&t._terrain.enabled&&de&&D.uploadPending()&&t._terrain._clearRenderCacheForTile(de.id,this.tileID);const Me=t&&t.style&&t.style.getOwnLayer(E);Me&&(this.queryPadding=Math.max(this.queryPadding,Me.queryRadius(D)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<a.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=a.q.now()+t}setTexture(t,r){const d=r.context,_=d.gl;this.texture=this.texture||r.getTileTexture(t.width),this.texture&&this.texture instanceof a.T?this.texture.update(t):(this.texture=new a.T(d,t,_.RGBA8,{useMipmap:!0}),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE))}setDependencies(t,r){const d={};for(const _ of r)d[_]=!0;this.dependencies[t]=d}hasDependency(t,r){for(const d of t){const _=this.dependencies[d];if(_){for(const b of r)if(_[b])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const d=a.b9(qh,this.tileID.canonical,this.tileTransform)[0],_=new a.ba,b=new a.bb;for(let E=0;E<d.length;E++){const{x:D,y:U}=d[E];_.emplaceBack(D,U),b.emplaceBack(E)}b.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(b),this._tileDebugBuffer=t.createVertexBuffer(_,a.bc.members),this._tileDebugSegments=a.bd.simpleSegment(0,0,_.length,b.length)}_makeTileBoundsBuffers(t,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const d=a.b9(qh,this.tileID.canonical,this.tileTransform)[0];let _,b;if(this.isRaster){const E=function(D,U){const Z=a.aW(D,U),ie=Math.pow(2,D.z);for(let Pe=0;Pe<Kl;Pe++)for(let Ne=0;Ne<Kl;Ne++){const He=a.aX((D.x+(Ne+bl(Ne))/gh)/ie),lt=a.aY((D.y+(Pe+bl(Pe))/gh)/ie),ut=U.project(He,lt),kt=Pe*Kl+Ne;Ma[2*kt+0]=Math.round((ut.x*Z.scale-Z.x)*a.aj),Ma[2*kt+1]=Math.round((ut.y*Z.scale-Z.y)*a.aj)}yn.fill(0),Hd.fill(0);for(let Pe=2045;Pe>=0;Pe--){const Ne=4*Pe,He=Qc[Ne+0],lt=Qc[Ne+1],ut=Qc[Ne+2],kt=Qc[Ne+3],wt=He+ut>>1,xt=lt+kt>>1,pt=wt+xt-lt,At=xt+He-wt,Ct=lt*Kl+He,ti=kt*Kl+ut,si=xt*Kl+wt,wi=Math.hypot((Ma[2*Ct+0]+Ma[2*ti+0])/2-Ma[2*si+0],(Ma[2*Ct+1]+Ma[2*ti+1])/2-Ma[2*si+1])>=16;yn[si]=yn[si]||(wi?1:0),Pe<1022&&(yn[si]=yn[si]||yn[(lt+At>>1)*Kl+(He+pt>>1)]||yn[(kt+At>>1)*Kl+(ut+pt>>1)])}const de=new a.aZ,ne=new a.a_;let me=0;function Ce(Pe,Ne){const He=Ne*Kl+Pe;return Hd[He]===0&&(de.emplaceBack(Ma[2*He+0],Ma[2*He+1],Pe*a.aj/gh,Ne*a.aj/gh),Hd[He]=++me),Hd[He]-1}function Me(Pe,Ne,He,lt,ut,kt){const wt=Pe+He>>1,xt=Ne+lt>>1;if(Math.abs(Pe-ut)+Math.abs(Ne-kt)>1&&yn[xt*Kl+wt])Me(ut,kt,Pe,Ne,wt,xt),Me(He,lt,ut,kt,wt,xt);else{const pt=Ce(Pe,Ne),At=Ce(He,lt),Ct=Ce(ut,kt);ne.emplaceBack(pt,At,Ct)}}return Me(0,0,gh,gh,gh,0),Me(gh,gh,0,0,0,gh),{vertices:de,indices:ne}}(this.tileID.canonical,r);_=E.vertices,b=E.indices}else{_=new a.aZ,b=new a.a_;for(const{x:D,y:U}of d)_.emplaceBack(D,U,0,0);const E=a.be(_.int16.subarray(0,4*_.length),void 0,4);for(let D=0;D<E.length;D+=3)b.emplaceBack(E[D],E[D+1],E[D+2])}this._tileBoundsBuffer=t.createVertexBuffer(_,a.bf.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(b),this._tileBoundsSegments=a.bd.simpleSegment(0,0,_.length,b.length)}_makeGlobeTileDebugBuffers(t,r){const d=r.projection;if(!d||d.name!=="globe"||r.freezeTileCoverage)return;const _=this.tileID.canonical,b=a.bg(_,r),E=a.bh(b),D=a.ah(r.zoom);let U;D>0&&(U=a.bi(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,_,r,E,U,D),this._makeGlobeTileDebugTextBuffer(t,_,r,E,U,D)}_globePoint(t,r,d,_,b,E,D){let U=a.bj(t,r,d);if(E){const Z=1<<d.z,ie=a.aD(_.center.lng),de=a.aH(_.center.lat),ne=(d.x+.5)/Z-ie;let me=0;ne>.5?me=-1:ne<-.5&&(me=1);let Ce=(t/a.aj+d.x)/Z+me,Me=(r/a.aj+d.y)/Z;Ce=(Ce-ie)*_._pixelsPerMercatorPixel+ie,Me=(Me-de)*_._pixelsPerMercatorPixel+de;const Pe=[Ce*_.worldSize,Me*_.worldSize,0];a.ad(Pe,Pe,E),U=a.bk(U,Pe,D)}return a.ad(U,U,b)}_makeGlobeTileDebugBorderBuffer(t,r,d,_,b,E){const D=new a.ba,U=new a.bb,Z=new a.bl,ie=(ne,me,Ce,Me,Pe)=>{const Ne=(Ce-ne)/(Pe-1),He=(Me-me)/(Pe-1),lt=D.length;for(let ut=0;ut<Pe;ut++){const kt=ne+ut*Ne,wt=me+ut*He;D.emplaceBack(kt,wt);const xt=this._globePoint(kt,wt,r,d,_,b,E);Z.emplaceBack(xt[0],xt[1],xt[2]),U.emplaceBack(lt+ut)}},de=a.aj;ie(0,0,de,0,16),ie(de,0,de,de,16),ie(de,de,0,de,16),ie(0,de,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(U),this._tileDebugBuffer=t.createVertexBuffer(D,a.bc.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(Z,a.bm.members),this._tileDebugSegments=a.bd.simpleSegment(0,0,D.length,U.length)}_makeGlobeTileDebugTextBuffer(t,r,d,_,b,E){const D=a.aj/4,U=new a.ba,Z=new a.a_,ie=new a.bl,de=25;Z.reserve(32),U.reserve(de),ie.reserve(de);const ne=(me,Ce)=>de*me+Ce;for(let me=0;me<de;me++){const Ce=me*D;for(let Me=0;Me<de;Me++){const Pe=Me*D;U.emplaceBack(Pe,Ce);const Ne=this._globePoint(Pe,Ce,r,d,_,b,E);ie.emplaceBack(Ne[0],Ne[1],Ne[2])}}for(let me=0;me<4;me++)for(let Ce=0;Ce<4;Ce++){const Me=ne(me,Ce),Pe=ne(me,Ce+1),Ne=ne(me+1,Ce),He=ne(me+1,Ce+1);Z.emplaceBack(Me,Pe,Ne),Z.emplaceBack(Ne,Pe,He)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(Z),this._tileDebugTextBuffer=t.createVertexBuffer(U,a.bc.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(ie,a.bm.members),this._tileDebugTextSegments=a.bd.simpleSegment(0,0,de,32)}destroy(t=!1){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof a.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}a.bp.setPbf(a.bq);class fa extends Zh{constructor(t,r,d,_,b){super(t,r,d,_,b),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexture(t,r){const d=r.context,_=d.gl;this.texture=this.texture||r.getTileTexture(t.width),this.texture&&this.texture instanceof a.T?this.texture.update(t,{premultiply:!1}):this.texture=new a.T(d,t,_.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,r){const d=this._mrt=new a.bp(30),_=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=a.br(_,(b,E,D,U)=>{if(b)r(b);else try{const Z=d.getHeaderLength(E);if(Z>t)return void(this.request=this.fetchHeader(Z,r));d.parseHeader(E),this._isHeaderLoaded=!0;let ie=0;for(const de of Object.values(d.layers))ie=Math.max(ie,de.dataIndex[de.dataIndex.length-1].lastByte);E.byteLength>=ie&&(this.entireBuffer=E),r(null,this.entireBuffer||E,D,U)}catch(Z){r(Z)}}),this.request}fetchBand(t,r,d){const _=this._mrt;if(!this._isHeaderLoaded||!_)return void d(new Error("Tile header is not ready"));const b=this.actor;if(!b)return void d(new Error("Can't fetch tile band without an actor"));let E;const D=(de,ne)=>{E.complete(de,ne),de?d(de):(this.updateTextureDescriptor(t,r),d(null,this.textureDescriptor&&this.textureDescriptor.img))},U=(de,ne)=>{if(de)return d(de);const me=b.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:ne,task:E},D,void 0,!0);this._workQueue.push(()=>{me&&me.cancel(),E.cancel()})},Z=_.getLayer(t);if(!Z)return void d(new Error(`Unknown sourceLayer "${t}"`));if(Z.hasDataForBand(r))return this.updateTextureDescriptor(t,r),void d(null,this.textureDescriptor?this.textureDescriptor.img:null);const ie=Z.getDataRange([r]);if(E=_.createDecodingTask(ie),!E||E.tasks.length)if(this.flushQueues(),this.entireBuffer)U(null,this.entireBuffer.slice(ie.firstByte,ie.lastByte+1));else{const de=Object.assign({},this.requestParams,{headers:{Range:`bytes=${ie.firstByte}-${ie.lastByte}`}}),ne=a.br(de,U);this._fetchQueue.push(()=>{ne.cancel(),E.cancel()})}else d(null)}updateNeeded(t,r){return(!this.textureDescriptor||this.textureDescriptor.band!==r||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,r){if(!this._mrt)return;const d=this._mrt.getLayer(t);if(!d||!d.hasBand(r)||!d.hasDataForBand(r))return;const{bytes:_,tileSize:b,buffer:E,offset:D,scale:U}=d.getBandView(r),Z=b+2*E,ie=new a.r({width:Z,height:Z},_),de=this.texture;de&&de instanceof a.T&&de.update(ie,{premultiply:!1}),this.textureDescriptor={layer:t,band:r,img:ie,buffer:E,offset:D,tileSize:b,format:d.pixelFormat,mix:[U,256*U,65536*U,16777216*U]}}}class Xd{constructor(t,r){this.max=t,this.onRemove=r,this.reset()}reset(){for(const t in this.data)for(const r of this.data[t])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(t,r,d){const _=t.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const b={value:r,timeout:void 0};if(d!==void 0&&(b.timeout=setTimeout(()=>{this.remove(t,b)},d)),this.data[_].push(b),this.order.push(_),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const r=this.data[t].shift();return r.timeout&&clearTimeout(r.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),r.value}getByKey(t){const r=this.data[t];return r?r[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,r){if(!this.has(t))return this;const d=t.wrapped().key,_=r===void 0?0:this.data[d].indexOf(r),b=this.data[d][_];return this.data[d].splice(_,1),b.timeout&&clearTimeout(b.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(b.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(t){const r=[];for(const d in this.data)for(const _ of this.data[d])t(_.value)||r.push(_);for(const d of r)this.remove(d.value.tileID,d)}}class qu{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,d){const _=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][_]=this.stateChanges[t][_]||{},a.h(this.stateChanges[t][_],d),this.deletedStates[t]===null){this.deletedStates[t]={};for(const b in this.state[t])b!==_&&(this.deletedStates[t][b]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][_]===null){this.deletedStates[t][_]={};for(const b in this.state[t][_])d[b]||(this.deletedStates[t][_][b]=null)}else for(const b in d)this.deletedStates[t]&&this.deletedStates[t][_]&&this.deletedStates[t][_][b]===null&&delete this.deletedStates[t][_][b]}removeFeatureState(t,r,d){if(this.deletedStates[t]===null)return;const _=String(r);if(this.deletedStates[t]=this.deletedStates[t]||{},d&&r!==void 0)this.deletedStates[t][_]!==null&&(this.deletedStates[t][_]=this.deletedStates[t][_]||{},this.deletedStates[t][_][d]=null);else if(r!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][_])for(d in this.deletedStates[t][_]={},this.stateChanges[t][_])this.deletedStates[t][_][d]=null;else this.deletedStates[t][_]=null;else this.deletedStates[t]=null}getState(t,r){const d=this.state[t]||{},_=this.stateChanges[t]||{},b=this.deletedStates[t];if(b===null)return{};if(r!==void 0){const D=String(r),U=a.h({},d[D],_[D]);if(b){const Z=b[r];if(Z===null)return{};for(const ie in Z)delete U[ie]}return U}const E=a.h({},d,_);if(b)for(const D in b)delete E[D];return E}initializeTileState(t,r){t.refreshFeatureState(r)}coalesceChanges(t,r){const d={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const b={};for(const E in this.stateChanges[_])this.state[_][E]||(this.state[_][E]={}),a.h(this.state[_][E],this.stateChanges[_][E]),b[E]=this.state[_][E];d[_]=b}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const b={};if(this.deletedStates[_]===null)for(const E in this.state[_])b[E]={},this.state[_][E]={};else for(const E in this.deletedStates[_]){if(this.deletedStates[_][E]===null)this.state[_][E]={};else if(this.state[_][E])for(const D of Object.keys(this.deletedStates[_][E]))delete this.state[_][E][D];b[E]=this.state[_][E]}d[_]=d[_]||{},a.h(d[_],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const _ in t)t[_].refreshFeatureState(r)}}class Ll extends a.E{constructor(t,r,d){super(),this.id=t,this._onlySymbols=d,r.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new Xd(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new qu,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,r){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,r)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const d=this._tiles[r];d.upload(t),d.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(ja).map(t=>t.key)}getRenderableIds(t,r){const d=[];for(const _ in this._tiles)this._isIdRenderable(+_,t,r)&&d.push(this._tiles[_]);return t?d.sort((_,b)=>{const E=_.tileID,D=b.tileID,U=new a.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle),Z=new a.P(D.canonical.x,D.canonical.y)._rotate(this.transform.angle);return E.overscaledZ-D.overscaledZ||Z.y-U.y||Z.x-U.x}).map(_=>_.tileID.key):d.map(_=>_.tileID).sort(ja).map(_=>_.key)}hasRenderableParent(t){const r=this.findLoadedParent(t,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(t,r,d){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(r||!this._tiles[t].holdingForFade())&&(d||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,r){const d=this._tiles[t];d&&(d.state!=="loading"&&(d.state=r),this._loadTile(d,this._tileLoaded.bind(this,d,t,r)))}_tileLoaded(t,r,d,_){if(_)if(t.state="errored",_.status!==404)this._source.fire(new a.z(_,{tile:t}));else{if(this._source.fire(new a.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const b=this.map.painter.terrain;this.update(this.transform,b.getScaledDemTileSize(),!0),b.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=a.q.now(),d==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new a.A("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const r=this.getRenderableIds();for(let _=0;_<r.length;_++){const b=r[_];if(t.neighboringTiles&&t.neighboringTiles[b]){const E=this.getTileByID(b);d(t,E),d(E,t)}}function d(_,b){if(!_.dem||_.dem.borderReady)return;_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0;let E=b.tileID.canonical.x-_.tileID.canonical.x;const D=b.tileID.canonical.y-_.tileID.canonical.y,U=Math.pow(2,_.tileID.canonical.z),Z=b.tileID.key;E===0&&D===0||Math.abs(D)>1||(Math.abs(E)>1&&(Math.abs(E+U)===1?E+=U:Math.abs(E-U)===1&&(E-=U)),b.dem&&_.dem&&(_.dem.backfillBorder(b.dem,E,D),_.neighboringTiles&&_.neighboringTiles[Z]&&(_.neighboringTiles[Z].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,r,d,_){for(const b in this._tiles){let E=this._tiles[b];if(_[b]||!E.hasData()||E.tileID.overscaledZ<=r||E.tileID.overscaledZ>d)continue;let D=E.tileID;for(;E&&E.tileID.overscaledZ>r+1;){const Z=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[Z.key],E&&E.hasData()&&(D=Z)}let U=D;for(;U.overscaledZ>r;)if(U=U.scaledTo(U.overscaledZ-1),t[U.key]){_[D.key]=D;break}}}findLoadedParent(t,r){if(t.key in this._loadedParentTiles){const d=this._loadedParentTiles[t.key];return d&&d.tileID.overscaledZ>=r?d:null}for(let d=t.overscaledZ-1;d>=r;d--){const _=t.scaledTo(d),b=this._getLoadedTile(_);if(b)return b}}_getLoadedTile(t){const r=this._tiles[t.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,r){r=r||this._source.tileSize;const d=Math.ceil(t.width/r)+1,_=Math.ceil(t.height/r)+1,b=Math.floor(d*_*5),E=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,b):b,D=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,E):E;this._cache.setMaxSize(D)}handleWrapJump(t){const r=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,r){const d={};for(const _ in this._tiles){const b=this._tiles[_];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+r),d[b.tileID.key]=b}this._tiles=d;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(+_,this._tiles[_])}}update(t,r,d,_,b){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;this.updateCacheSize(t,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const E=this._source.type==="batched-model";let D,U=this._source.maxzoom;const Z=this.map&&this.map.painter?this.map.painter._terrain:null;if(Z&&Z.sourceCache===this&&Z.attenuationRange()){const ne=Z.attenuationRange()[0],me=Math.floor(ne)-Math.log2(Z.getDemUpscale());U>me&&(U=me)}if(this.used||this.usedForTerrain){if(this._source.tileID)D=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(ne=>new a.aM(ne.canonical.z,ne.wrap,ne.canonical.z,ne.canonical.x,ne.canonical.y));else if(this.tileCoverLift!==0){const ne=t.clone();ne.tileCoverLift=this.tileCoverLift,D=ne.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:U,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:E}),this._source.minzoom<=1&&t.projection.name==="globe"&&(D.push(new a.aM(1,0,1,0,0)),D.push(new a.aM(1,0,1,1,0)),D.push(new a.aM(1,0,1,0,1)),D.push(new a.aM(1,0,1,1,1)))}else if(D=t.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:U,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:E}),this._source.hasTile){const ne=this._source.hasTile.bind(this._source);D=D.filter(me=>ne(me))}}else D=[];if(D.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Bn(this._source.type)){const ne=t.coveringZoomLevel({tileSize:r||this._source.tileSize,roundZoom:this._source.roundZoom&&!d}),me=Math.min(ne,this._source.maxzoom);if(E){const Ce=t.extendTileCover(D,me);for(const Me of Ce)D.push(Me)}else if(b){const Ce=t.extendTileCover(D,me,this.transform._camera.forward());for(const Me of Ce)D.push(Me)}else if(this.castsShadows&&_){const Ce=t.extendTileCover(D,me,_);for(const Me of Ce)this._shadowCasterTiles[Me.key]=!0,D.push(Me)}}const ie=this._updateRetainedTiles(D);if(Bn(this._source.type)&&D.length!==0){const ne={},me={},Ce=Object.keys(ie);for(const Pe of Ce){const Ne=ie[Pe],He=this._tiles[Pe];if(!He||He.fadeEndTime&&He.fadeEndTime<=a.q.now())continue;const lt=this.findLoadedParent(Ne,Math.max(Ne.overscaledZ-Ll.maxOverzooming,this._source.minzoom));lt&&(this._addTile(lt.tileID),ne[lt.tileID.key]=lt.tileID),me[Pe]=Ne}const Me=D[D.length-1].overscaledZ;for(const Pe in this._tiles){const Ne=this._tiles[Pe];if(ie[Pe]||!Ne.hasData())continue;let He=Ne.tileID;for(;He.overscaledZ>Me;){He=He.scaledTo(He.overscaledZ-1);const lt=this._tiles[He.key];if(lt&&lt.hasData()&&me[He.key]){ie[Pe]=Ne.tileID;break}}}for(const Pe in ne)ie[Pe]||(this._coveredTiles[Pe]=!0,ie[Pe]=ne[Pe])}for(const ne in ie)this._tiles[ne].clearFadeHold();const de=a.bs(this._tiles,ie);for(const ne of de){const me=this._tiles[ne];me.hasSymbolBuckets&&!me.holdingForFade()?me.setHoldDuration(this.map._fadeDuration):me.hasSymbolBuckets&&!me.symbolFadeFinished()||this._removeTile(+ne)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const r={};if(t.length===0)return r;const d={},_=t.reduce((Z,ie)=>Math.min(Z,ie.overscaledZ),1/0),b=t[0].overscaledZ,E=Math.max(b-Ll.maxOverzooming,this._source.minzoom),D=Math.max(b+Ll.maxUnderzooming,this._source.minzoom),U={};for(const Z of t){const ie=this._addTile(Z);r[Z.key]=Z,ie.hasData()||_<this._source.maxzoom&&(U[Z.key]=Z)}this._retainLoadedChildren(U,_,D,r);for(const Z of t){let ie=this._tiles[Z.key];if(ie.hasData())continue;if(Z.canonical.z>=this._source.maxzoom){const ne=Z.children(this._source.maxzoom)[0],me=this.getTile(ne);if(me&&me.hasData()){r[ne.key]=ne;continue}}else{const ne=Z.children(this._source.maxzoom);if(r[ne[0].key]&&r[ne[1].key]&&r[ne[2].key]&&r[ne[3].key])continue}let de=ie.wasRequested();for(let ne=Z.overscaledZ-1;ne>=E;--ne){const me=Z.scaledTo(ne);if(d[me.key]||(d[me.key]=!0,ie=this.getTile(me),!ie&&de&&(ie=this._addTile(me)),ie&&(r[me.key]=me,de=ie.wasRequested(),ie.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const r=[];let d,_=this._tiles[t].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){d=this._loadedParentTiles[_.key];break}r.push(_.key);const b=_.scaledTo(_.overscaledZ-1);if(d=this._getLoadedTile(b),d)break;_=b}for(const b of r)this._loadedParentTiles[b]=d}}_addTile(t){let r=this._tiles[t.key];if(r)return r.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),r;r=this._cache.getAndRemove(t),r&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));const d=!!r;if(!d){const _=this.map?this.map.painter:null,b=this._source.tileSize*t.overscaleFactor();r=this._source.type==="raster-array"?new fa(t,b,this.transform.tileZoom,_,this._isRaster):new Zh(t,b,this.transform.tileZoom,_,this._isRaster,this._source.worldview),this._loadTile(r,this._tileLoaded.bind(this,r,t.key,r.state))}return r.uses++,this._tiles[t.key]=r,d||this._source.fire(new a.A("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(t,r){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const d=r.getExpiryTimeout();d&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},d))}_removeTile(t){const r=this._tiles[t];r&&(r.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),r.uses>0||(r.hasData()&&r.state!=="reloading"||r.state==="empty"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,r,d){const _=[],b=this.transform;if(!b)return _;const E=b.projection.name==="globe",D=a.aD(b.center.lng);for(const U in this._tiles){const Z=this._tiles[U];if(d&&Z.clearQueryDebugViz(),Z.holdingForFade())continue;let ie;if(E){const de=Z.tileID.canonical;if(de.z===0){const ne=[Math.abs(a.ay(D,...kh(de,-1))-D),Math.abs(a.ay(D,...kh(de,1))-D)];ie=[0,2*ne.indexOf(Math.min(...ne))-1]}else{const ne=[Math.abs(a.ay(D,...kh(de,-1))-D),Math.abs(a.ay(D,...kh(de,0))-D),Math.abs(a.ay(D,...kh(de,1))-D)];ie=[ne.indexOf(Math.min(...ne))-1]}}else ie=[0];for(const de of ie){const ne=t.containsTile(Z,b,r,de);ne&&_.push(ne)}}return _}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,r){const d=this.getRenderableIds(t,r).map(b=>this._tiles[b].tileID),_=this.transform.projection.name==="globe";for(const b of d)b.projMatrix=this.transform.calculateProjMatrix(b.toUnwrapped()),b.expandedProjMatrix=_?this.transform.calculateProjMatrix(b.toUnwrapped(),!1,!0):b.projMatrix;return d}sortCoordinatesByDistance(t){const r=t.slice(),d=this.transform._camera.position,_=this.transform._camera.forward(),b={};for(const E of r){const D=1/(1<<E.canonical.z);b[E.key]=((E.canonical.x+.5)*D+E.wrap-d[0])*_[0]+((E.canonical.y+.5)*D-d[1])*_[1]-d[2]*_[2]}return r.sort((E,D)=>b[E.key]-b[D.key]),r}hasTransition(){if(this._source.hasTransition())return!0;if(Bn(this._source.type))for(const t in this._tiles){const r=this._tiles[t];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=a.q.now())return!0}return!1}setFeatureState(t,r,d){this._state.updateState(t=t||"_geojsonTileLayer",r,d)}removeFeatureState(t,r,d){this._state.removeFeatureState(t=t||"_geojsonTileLayer",r,d)}getFeatureState(t,r){return this._state.getState(t=t||"_geojsonTileLayer",r)}setDependencies(t,r,d){const _=this._tiles[t];_&&_.setDependencies(r,d)}reloadTilesForDependencies(t,r){for(const d in this._tiles)this._tiles[d].hasDependency(t,r)&&this._reloadTile(+d,"reloading");this._cache.filter(d=>!d.hasDependency(t,r))}_preloadTiles(t,r){if(!this._sourceLoaded){const U=()=>{this._sourceLoaded&&(this._source.off("data",U),this._preloadTiles(t,r))};return void this._source.on("data",U)}const d=new Map,_=Array.isArray(t)?t:[t],b=this.map.painter.terrain,E=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const U of _){const Z=U.coveringTiles({tileSize:E,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const ie of Z)d.set(ie.key,ie);this.usedForTerrain&&U.updateElevation(!1)}const D=Array.from(d.values());a.bt(D,(U,Z)=>{const ie=new Zh(U,this._source.tileSize*U.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(ie,de=>{this._source.type==="raster-dem"&&ie.dem&&this._backfillDEM(ie),Z(de,ie)})},r)}}function ja(c,t){const r=Math.abs(2*c.wrap)-+(c.wrap<0),d=Math.abs(2*t.wrap)-+(t.wrap<0);return c.overscaledZ-t.overscaledZ||d-r||t.canonical.y-c.canonical.y||t.canonical.x-c.canonical.x}function Bn(c){return c==="raster"||c==="image"||c==="video"||c==="custom"}function kh(c,t){const r=1<<c.z;return[c.x/r+t,(c.x+1)/r+t]}Ll.maxOverzooming=10,Ll.maxUnderzooming=3;class Xl{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,r=!1;for(const d in this.style._mergedLayers){const _=this.style._mergedLayers[d];if(_.type==="fill-extrusion"||_.type==="building")this.layers.push({layer:_,visible:t,visibilityChanged:r});else if(_.type==="model"){const b=this.style.getLayerSource(_);b&&b.type==="batched-model"&&this.layers.push({layer:_,visible:t,visibilityChanged:r})}}}onNewFrame(t){this.layersGotHidden=!1;for(const r of this.layers){const d=r.layer;let _=!1;d.type==="fill-extrusion"?_=!d.isHidden(t)&&d.paint.get("fill-extrusion-opacity")>0:d.type==="building"?_=!d.isHidden(t)&&d.paint.get("building-opacity")>0:d.type==="model"&&(_=!d.isHidden(t)&&d.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!_&&r.visible,r.visible=_}}updateZOffset(t,r){this.currentBuildingBuckets=[];for(const _ of this.layers){const b=_.layer,E=this.style.getLayerSourceCache(b);let D=1;b.type==="fill-extrusion"?D=_.visible?b.paint.get("fill-extrusion-vertical-scale"):0:b.type==="building"&&(D=_.visible?b.paint.get("building-vertical-scale"):0);let U=E?E.getTile(r):null;if(!U&&E&&r.canonical.z>E.getSource().minzoom){let Z=r.scaledTo(Math.min(E.getSource().maxzoom,r.overscaledZ-1));for(;Z.overscaledZ>=E.getSource().minzoom&&(U=E.getTile(Z),!U&&Z.overscaledZ!==0);)Z=Z.scaledTo(Z.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:U?U.getBucket(b):null,tileID:U?U.tileID:r,verticalScale:D})}t.hasAnyZOffset=!1;let d=!1;for(let _=0;_<t.symbolInstances.length;_++){const b=t.symbolInstances.get(_),E=b.zOffset,D=this._getHeightAtTileOffset(r,b.tileAnchorX,b.tileAnchorY);b.zOffset=D!==Number.NEGATIVE_INFINITY?D:E,d||E===b.zOffset||(d=!0),t.hasAnyZOffset||b.zOffset===0||(t.hasAnyZOffset=!0)}d&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,r,d,_){let b=r,E=d;if(t.canonical.z!==_.canonical.z){const D=_.canonical,U=1/(1<<t.canonical.z-D.z);b=(r+t.canonical.x*a.aj)*U-D.x*a.aj|0,E=(d+t.canonical.y*a.aj)*U-D.y*a.aj|0}return{tileX:b,tileY:E}}_getHeightAtTileOffset(t,r,d){let _,b;for(let E=0;E<this.layers.length;++E){const D=this.layers[E].layer;if(D.type!=="fill-extrusion"&&D.type!=="building")continue;const{bucket:U,tileID:Z,verticalScale:ie}=this.currentBuildingBuckets[E];if(!U)continue;const{tileX:de,tileY:ne}=this._mapCoordToOverlappingTile(t,r,d,Z),me=U.getHeightAtTileCoord(de,ne);me&&me.height!==void 0&&(me.hidden?_=me.height:b=Math.max(me.height*ie,b||0))}if(b!==void 0)return b;for(let E=0;E<this.layers.length;++E){const D=this.layers[E];if(D.layer.type!=="model"||!D.visible)continue;const{bucket:U,tileID:Z}=this.currentBuildingBuckets[E];if(!U)continue;const{tileX:ie,tileY:de}=this._mapCoordToOverlappingTile(t,r,d,Z),ne=U.getHeightAtTileCoord(ie,de);if(ne&&!ne.hidden)return ne.height===void 0&&_!==void 0?Math.min(ne.maxHeight,_)*ne.verticalScale:ne.height?ne.height*ne.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function mp(c,t){const r={};for(const d in c)d!=="ref"&&(r[d]=c[d]);return a.bu.forEach(d=>{d in t&&(r[d]=t[d])}),r}function Dc(c){c=c.slice();const t=Object.create(null);for(let r=0;r<c.length;r++)t[c[r].id]=c[r];for(let r=0;r<c.length;r++)"ref"in c[r]&&(c[r]=mp(c[r],t[c[r].ref]));return c}const Gr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Eh(c,t,r){r.push({command:Gr.addSource,args:[c,t[c]]})}function Su(c,t,r){t.push({command:Gr.removeSource,args:[c]}),r[c]=!0}function Ch(c,t,r,d){Su(c,r,d),Eh(c,t,r)}function cf(c,t,r){let d;for(d in c[r])if(c[r].hasOwnProperty(d)&&d!=="data"&&!a.bv(c[r][d],t[r][d]))return!1;for(d in t[r])if(t[r].hasOwnProperty(d)&&d!=="data"&&!a.bv(c[r][d],t[r][d]))return!1;return!0}function ma(c,t,r,d,_,b){let E;for(E in t=t||{},c=c||{})c.hasOwnProperty(E)&&(a.bv(c[E],t[E])||r.push({command:b,args:[d,E,t[E],_]}));for(E in t)t.hasOwnProperty(E)&&!c.hasOwnProperty(E)&&(a.bv(c[E],t[E])||r.push({command:b,args:[d,E,t[E],_]}))}function Mu(c){return c.id}function wl(c,t){return c[t.id]=t,c}class ed{constructor(t,r){this.reset(t,r)}reset(t,r){this.points=t||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=a.ay(t,0,1);let r=1,d=this._distances[r];const _=t*this.paddedLength+this.padding;for(;d<_&&r<this._distances.length;)d=this._distances[++r];const b=r-1,E=this._distances[b],D=d-E,U=D>0?(_-E)/D:0;return this.points[b].mult(1-U).add(this.points[r].mult(U))}}class Yd{constructor(t,r,d){const _=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(t/d),this.yCellCount=Math.ceil(r/d);for(let E=0;E<this.xCellCount*this.yCellCount;E++)_.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,r,d,_,b){this._forEachCell(r,d,_,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(b)}insertCircle(t,r,d,_){this._forEachCell(r-_,d-_,r+_,d+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(r),this.circles.push(d),this.circles.push(_)}_insertBoxCell(t,r,d,_,b,E){this.boxCells[b].push(E)}_insertCircleCell(t,r,d,_,b,E){this.circleCells[b].push(E)}_query(t,r,d,_,b,E){if(d<0||t>this.width||_<0||r>this.height)return!b&&[];const D=[];if(t<=0&&r<=0&&this.width<=d&&this.height<=_){if(b)return!0;for(let U=0;U<this.boxKeys.length;U++)D.push({key:this.boxKeys[U],x1:this.bboxes[4*U],y1:this.bboxes[4*U+1],x2:this.bboxes[4*U+2],y2:this.bboxes[4*U+3]});for(let U=0;U<this.circleKeys.length;U++){const Z=this.circles[3*U],ie=this.circles[3*U+1],de=this.circles[3*U+2];D.push({key:this.circleKeys[U],x1:Z-de,y1:ie-de,x2:Z+de,y2:ie+de})}return E?D.filter(E):D}return this._forEachCell(t,r,d,_,this._queryCell,D,{hitTest:b,seenUids:{box:{},circle:{}}},E),b?D.length>0:D}_queryCircle(t,r,d,_,b){const E=t-d,D=t+d,U=r-d,Z=r+d;if(D<0||E>this.width||Z<0||U>this.height)return!_&&[];const ie=[];return this._forEachCell(E,U,D,Z,this._queryCellCircle,ie,{hitTest:_,circle:{x:t,y:r,radius:d},seenUids:{box:{},circle:{}}},b),_?ie.length>0:ie}query(t,r,d,_,b){return this._query(t,r,d,_,!1,b)}hitTest(t,r,d,_,b){return this._query(t,r,d,_,!0,b)}hitTestCircle(t,r,d,_){return this._queryCircle(t,r,d,!0,_)}_queryCell(t,r,d,_,b,E,D,U){const Z=D.seenUids,ie=this.boxCells[b];if(ie!==null){const ne=this.bboxes;for(const me of ie)if(!Z.box[me]){Z.box[me]=!0;const Ce=4*me;if(t<=ne[Ce+2]&&r<=ne[Ce+3]&&d>=ne[Ce+0]&&_>=ne[Ce+1]&&(!U||U(this.boxKeys[me]))){if(D.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[me],x1:ne[Ce],y1:ne[Ce+1],x2:ne[Ce+2],y2:ne[Ce+3]})}}}const de=this.circleCells[b];if(de!==null){const ne=this.circles;for(const me of de)if(!Z.circle[me]){Z.circle[me]=!0;const Ce=3*me;if(this._circleAndRectCollide(ne[Ce],ne[Ce+1],ne[Ce+2],t,r,d,_)&&(!U||U(this.circleKeys[me]))){if(D.hitTest)return E.push(!0),!0;{const Me=ne[Ce],Pe=ne[Ce+1],Ne=ne[Ce+2];E.push({key:this.circleKeys[me],x1:Me-Ne,y1:Pe-Ne,x2:Me+Ne,y2:Pe+Ne})}}}}}_queryCellCircle(t,r,d,_,b,E,D,U){const Z=D.circle,ie=D.seenUids,de=this.boxCells[b];if(de!==null){const me=this.bboxes;for(const Ce of de)if(!ie.box[Ce]){ie.box[Ce]=!0;const Me=4*Ce;if(this._circleAndRectCollide(Z.x,Z.y,Z.radius,me[Me+0],me[Me+1],me[Me+2],me[Me+3])&&(!U||U(this.boxKeys[Ce])))return E.push(!0),!0}}const ne=this.circleCells[b];if(ne!==null){const me=this.circles;for(const Ce of ne)if(!ie.circle[Ce]){ie.circle[Ce]=!0;const Me=3*Ce;if(this._circlesCollide(me[Me],me[Me+1],me[Me+2],Z.x,Z.y,Z.radius)&&(!U||U(this.circleKeys[Ce])))return E.push(!0),!0}}}_forEachCell(t,r,d,_,b,E,D,U){const Z=this._convertToXCellCoord(t),ie=this._convertToYCellCoord(r),de=this._convertToXCellCoord(d),ne=this._convertToYCellCoord(_);for(let me=Z;me<=de;me++)for(let Ce=ie;Ce<=ne;Ce++)if(b.call(this,t,r,d,_,this.xCellCount*Ce+me,E,D,U))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,r,d,_,b,E){const D=_-t,U=b-r,Z=d+E;return Z*Z>D*D+U*U}_circleAndRectCollide(t,r,d,_,b,E,D){const U=(E-_)/2,Z=Math.abs(t-(_+U));if(Z>U+d)return!1;const ie=(D-b)/2,de=Math.abs(r-(b+ie));if(de>ie+d)return!1;if(Z<=U||de<=ie)return!0;const ne=Z-U,me=de-ie;return ne*ne+me*me<=d*d}}const It={unknown:0,flipRequired:1,flipNotRequired:2},Fi=Math.tan(85*Math.PI/180);function fs(c,t,r,d,_,b,E){const D=a.bz();if(r)if(b.name==="globe"){const U=a.bA(_,t);a.az(D,D,U)}else{const U=a.bB([],E);D[0]=U[0],D[1]=U[1],D[4]=U[2],D[5]=U[3],d||a.by(D,D,_.angle)}else a.az(D,_.labelPlaneMatrix,c);return D}function Ir(c,t,r,d,_,b,E){const D=fs(c,t,r,d,_,b,E);return b.name==="globe"&&r||(D[2]=D[6]=D[10]=D[14]=0),D}function Ga(c,t,r,d,_,b,E){if(r){if(b.name==="globe"){const D=fs(c,t,r,d,_,b,E);return a.bi(D,D),a.az(D,c,D),D}{const D=a.bw(c),U=a.bx([]);return U[0]=E[0],U[1]=E[1],U[4]=E[2],U[5]=E[3],a.az(D,D,U),d||a.by(D,D,-_.angle),D}}return _.glCoordMatrix}function xn(c,t,r,d){const _=[c,t,r,1];r?a.aA(_,_,d):So(_,_,d);const b=_[3];return _[0]/=b,_[1]/=b,_[2]/=b,_}function Ol(c,t){return Math.min(.5+c/t*.5,1.5)}function Ln(c,t){const r=c[0]/c[3],d=c[1]/c[3];return r>=-t[0]&&r<=t[0]&&d>=-t[1]&&d<=t[1]}function td(c,t,r,d,_,b,E,D,U,Z){const ie=r.transform,de=d?c.textSizeData:c.iconSizeData,ne=a.bH(de,r.transform.zoom),me=ie.projection.name==="globe",Ce=[256/r.width*2+1,256/r.height*2+1],Me=d?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;Me.clear();let Pe=null;me&&(Pe=d?c.text.globeExtVertexArray:c.icon.globeExtVertexArray);const Ne=c.lineVertexArray,He=d?c.text.placedSymbolArray:c.icon.placedSymbolArray,lt=r.transform.width/r.transform.height;let ut,kt=!1;for(let wt=0;wt<He.length;wt++){const xt=He.get(wt),{numGlyphs:pt,writingMode:At}=xt;if(At!==a.bI.vertical||kt||ut===a.bI.horizontal||(kt=!0),ut=At,(xt.hidden||At===a.bI.vertical)&&!kt){$d(pt,Me);continue}kt=!1;const Ct=new a.P(xt.tileAnchorX,xt.tileAnchorY);let{x:ti,y:si,z:wi}=ie.projection.projectTilePoint(Ct.x,Ct.y,Z.canonical);if(U){const[_s,Ts,us]=U(Ct);ti+=_s,si+=Ts,wi+=us}const _i=[ti,si,wi,1];if(a.aA(_i,_i,t),!Ln(_i,Ce)){$d(pt,Me);continue}const Bi=_i[3],Kt=Ol(r.transform.getCameraToCenterDistance(ie.projection),Bi),ui=a.bJ(de,ne,xt),Ft=E?ui/Kt:ui*Kt,Ai=xn(ti,si,wi,_);if(Ai[3]<=0){$d(pt,Me);continue}let ai={};const Di=a.al(c.layers[0].layout.get("text-max-angle")),Yi=Math.cos(Di),Mi=E?null:U,qi=zc(xt,Ft,!1,D,t,_,b,c.glyphOffsetArray,Ne,Me,Pe,Ai,Ct,ai,lt,Mi,ie.projection,Z,E,Yi);kt=qi.useVertical,Mi&&qi.needsFlipping&&(ai={}),(qi.notEnoughRoom||kt||qi.needsFlipping&&zc(xt,Ft,!0,D,t,_,b,c.glyphOffsetArray,Ne,Me,Pe,Ai,Ct,ai,lt,Mi,ie.projection,Z,E,Yi).notEnoughRoom)&&$d(pt,Me)}d?(c.text.dynamicLayoutVertexBuffer.updateData(Me),Pe&&c.text.globeExtVertexBuffer&&c.text.globeExtVertexBuffer.updateData(Pe)):(c.icon.dynamicLayoutVertexBuffer.updateData(Me),Pe&&c.icon.globeExtVertexBuffer&&c.icon.globeExtVertexBuffer.updateData(Pe))}function id(c,t,r,d,_,b,E,D,U,Z,ie,de,ne,me,Ce,Me,Pe){const{lineStartIndex:Ne,glyphStartIndex:He,segment:lt}=D,ut=He+D.numGlyphs,kt=Ne+D.lineLength,wt=t.getoffsetX(He),xt=t.getoffsetX(ut-1),pt=hl(c*wt,r,d,_,b,E,lt,Ne,kt,U,Z,ie,de,ne,!0,me,Ce,Me,Pe);if(!pt)return null;const At=hl(c*xt,r,d,_,b,E,lt,Ne,kt,U,Z,ie,de,ne,!0,me,Ce,Me,Pe);return At?{first:pt,last:At}:null}function Au(c,t,r,d){return c===a.bI.horizontal&&Math.abs(d)>Math.abs(r)?{useVertical:!0}:c===a.bI.vertical?d>0?{needsFlipping:!0}:null:t!==It.unknown&&function(_,b){return _===0||Math.abs(b/_)>Fi}(r,d)?t===It.flipRequired?{needsFlipping:!0}:null:r<0?{needsFlipping:!0}:null}function zc(c,t,r,d,_,b,E,D,U,Z,ie,de,ne,me,Ce,Me,Pe,Ne,He,lt){const ut=t/24,kt=c.lineOffsetX*ut,wt=c.lineOffsetY*ut,{lineStartIndex:xt,glyphStartIndex:pt,numGlyphs:At,segment:Ct,writingMode:ti,flipState:si}=c,wi=xt+c.lineLength,_i=Bi=>{if(ie){const[Ai,ai,Di]=Bi.up,Yi=Z.length;a.bK(ie,Yi+0,Ai,ai,Di),a.bK(ie,Yi+1,Ai,ai,Di),a.bK(ie,Yi+2,Ai,ai,Di),a.bK(ie,Yi+3,Ai,ai,Di)}const[Kt,ui,Ft]=Bi.point;a.bL(Z,Kt,ui,Ft,Bi.angle)};if(At>1){const Bi=id(ut,D,kt,wt,r,de,ne,c,U,b,me,Me,!1,Pe,Ne,He,lt);if(!Bi)return{notEnoughRoom:!0};if(d&&!r){let[Kt,ui,Ft]=Bi.first.point,[Ai,ai,Di]=Bi.last.point;[Kt,ui]=xn(Kt,ui,Ft,E),[Ai,ai]=xn(Ai,ai,Di,E);const Yi=Au(ti,si,(Ai-Kt)*Ce,ai-ui);if(c.flipState=Yi&&Yi.needsFlipping?It.flipRequired:It.flipNotRequired,Yi)return Yi}_i(Bi.first);for(let Kt=pt+1;Kt<pt+At-1;Kt++){const ui=hl(ut*D.getoffsetX(Kt),kt,wt,r,de,ne,Ct,xt,wi,U,b,me,Me,!1,!1,Pe,Ne,He,lt);if(!ui)return Z.length-=4*(Kt-pt),{notEnoughRoom:!0};_i(ui)}_i(Bi.last)}else{if(d&&!r){const Kt=xn(ne.x,ne.y,0,_),ui=xt+Ct+1,Ft=new a.P(U.getx(ui),U.gety(ui)),Ai=xn(Ft.x,Ft.y,0,_),ai=Ai[3]>0?Ai:Hn(ne,Ft,Kt,1,_,void 0,Pe,Ne.canonical),Di=Au(ti,si,(ai[0]-Kt[0])*Ce,ai[1]-Kt[1]);if(c.flipState=Di&&Di.needsFlipping?It.flipRequired:It.flipNotRequired,Di)return Di}const Bi=hl(ut*D.getoffsetX(pt),kt,wt,r,de,ne,Ct,xt,wi,U,b,me,Me,!1,!1,Pe,Ne,He,lt);if(!Bi)return{notEnoughRoom:!0};_i(Bi)}return{}}function fl(c,t,r,d,_){const{x:b,y:E,z:D}=d.projectTilePoint(c.x,c.y,t);if(!_)return xn(b,E,D,r);const[U,Z,ie]=_(c);return xn(b+U,E+Z,D+ie,r)}function Hn(c,t,r,d,_,b,E,D){const U=fl(c.sub(t)._unit()._add(c),D,_,E,b);return a.at(U,r,U),a.au(U,U),a.bE(U,r,U,d)}function hl(c,t,r,d,_,b,E,D,U,Z,ie,de,ne,me,Ce,Me,Pe,Ne,He){const lt=d?c-t:c+t;let ut=lt>0?1:-1,kt=0;d&&(ut*=-1,kt=Math.PI),ut<0&&(kt+=Math.PI);let wt=D+E+(ut>0?0:1)|0,xt=_,pt=_,At=0,Ct=0;const ti=Math.abs(lt),si=[],wi=[];let _i=b,Bi=_i,Kt=a.bC([]);const ui=()=>Hn(Bi,_i,pt,ti-At+1,ie,ne,Me,Pe.canonical);for(;At+Ct<=ti;){if(wt+=ut,wt<D||wt>=U)return null;if(pt=xt,Bi=_i,si.push(pt),me&&wi.push(Bi),_i=new a.P(Z.getx(wt),Z.gety(wt)),xt=de[wt],!xt){const us=fl(_i,Pe.canonical,ie,Me,ne);xt=us[3]>0?de[wt]=us:ui()}At+=Ct;const _s=a.at([],xt,pt),Ts=a.bD(pt,xt);if(r&&Ts>0&&Ct>0&&a.bG(Kt,_s)/(Ct*Ts)<He)return null;Ct=Ts,Kt=_s}Ce&&ne&&(de[wt]&&(xt=ui(),Ct=a.bD(pt,xt),Kt=a.at([],xt,pt)),de[wt]=xt);const Ft=(ti-At)/Ct,Ai=_i.sub(Bi)._mult(Ft)._add(Bi),ai=a.bE([],pt,Kt,Ft);let Di=[0,0,1],Yi=Kt[0],Mi=Kt[1];if(Ne&&(Di=Me.upVector(Pe.canonical,Ai.x,Ai.y),Di[0]!==0||Di[1]!==0||Di[2]!==1)){const _s=[Di[2],0,-Di[0]],Ts=a.bF([],Di,_s);a.au(_s,_s),a.au(Ts,Ts),Yi=a.bG(Kt,_s),Mi=a.bG(Kt,Ts)}if(r){const _s=a.bF([],Di,Kt);a.au(_s,_s),a.bE(ai,ai,_s,r*ut)}const qi=kt+Math.atan2(Mi,Yi);return si.push(ai),me&&wi.push(Ai),{point:ai,angle:qi,path:si,tilePath:wi,up:Di}}function $d(c,t){const r=t.length,d=r+4*c;t.resize(d),t.float32.fill(-1/0,4*r,4*d)}function So(c,t,r){const d=t[0],_=t[1];return c[0]=r[0]*d+r[4]*_+r[12],c[1]=r[1]*d+r[5]*_+r[13],c[3]=r[3]*d+r[7]*_+r[15],c}const Dl=100;class Md{constructor(t,r,d=new Yd(t.width+200,t.height+200,25),_=new Yd(t.width+200,t.height+200,25)){this.transform=t,this.grid=d,this.ignoredGrid=_,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Dl,this.screenBottomBoundary=t.height+Dl,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=r}placeCollisionBox(t,r,d,_,b,E,D,U){let Z=d.projectedAnchorX,ie=d.projectedAnchorY,de=d.projectedAnchorZ;const ne=d.elevation,me=d.tileID,Ce=t.getProjection();if(ne&&me){const[wt,xt,pt]=Ce.upVector(me.canonical,d.tileAnchorX,d.tileAnchorY),At=Ce.upVectorScale(me.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;Z+=wt*ne*At,ie+=xt*ne*At,de+=pt*ne*At}const Me=this.projectAndGetPerspectiveRatio(D,Z,ie,de,d.tileID,Ce.name==="globe"||!!ne||this.transform.pitch>0,Ce),Pe=E*Me.perspectiveRatio,Ne=(d.x1*r+_.x-d.padding)*Pe+Me.point.x,He=(d.y1*r+_.y-d.padding)*Pe+Me.point.y,lt=(d.x2*r+_.x+d.padding)*Pe+Me.point.x,ut=(d.y2*r+_.y+d.padding)*Pe+Me.point.y,kt=Me.perspectiveRatio<=.55||Me.occluded;return!this.isInsideGrid(Ne,He,lt,ut)||!b&&this.grid.hitTest(Ne,He,lt,ut,U)||kt?{box:[],offscreen:!1,occluded:Me.occluded}:{box:[Ne,He,lt,ut],offscreen:this.isOffscreen(Ne,He,lt,ut),occluded:!1}}placeCollisionCircles(t,r,d,_,b,E,D,U,Z,ie,de,ne,me,Ce,Me){const Pe=[],Ne=this.transform.elevation,He=t.getProjection(),lt=Ne?Ne.getAtTileOffsetFunc(Me,this.transform.center.lat,this.transform.worldSize,He):null,ut=new a.P(d.tileAnchorX,d.tileAnchorY);let{x:kt,y:wt,z:xt}=He.projectTilePoint(ut.x,ut.y,Me.canonical);if(lt){const[Di,Yi,Mi]=lt(ut);kt+=Di,wt+=Yi,xt+=Mi}const pt=He.name==="globe",At=this.projectAndGetPerspectiveRatio(D,kt,wt,xt,Me,pt||!!Ne||this.transform.pitch>0,He),{perspectiveRatio:Ct}=At,ti=(de?E/Ct:E*Ct)/a.bO,si=xn(kt,wt,xt,U),wi=d.lineOffsetX*ti,_i=d.lineOffsetY*ti,Bi=a.al(t.layers[0].layout.get("text-max-angle")),Kt=Math.cos(Bi),ui=At.signedDistanceFromCamera>0?id(ti,b,wi,_i,!1,si,ut,d,_,U,{},Ne&&!de?lt:null,de&&!!Ne,He,Me,de,Kt):null;let Ft=!1,Ai=!1,ai=!0;if(ui&&!At.occluded){const Di=.5*me*Ct+Ce,Yi=new a.P(-100,-100),Mi=new a.P(this.screenRightBoundary,this.screenBottomBoundary),qi=new ed,{first:_s,last:Ts}=ui,us=_s.path.length;let Os=[];for(let ur=us-1;ur>=1;ur--)Os.push(_s.path[ur]);for(let ur=1;ur<Ts.path.length;ur++)Os.push(Ts.path[ur]);const Rs=2.5*Di;Z&&(Os=Os.map(([ur,Pr,Bo],Tn)=>(lt&&!pt&&(Bo=lt(Tn<us-1?_s.tilePath[us-1-Tn]:Ts.tilePath[Tn-us+2])[2]),xn(ur,Pr,Bo,Z))),Os.some(ur=>ur[3]<=0)&&(Os=[]));let Js=[];if(Os.length>0){let ur=1/0,Pr=-1/0,Bo=1/0,Tn=-1/0;for(const xo of Os)ur=Math.min(ur,xo[0]),Bo=Math.min(Bo,xo[1]),Pr=Math.max(Pr,xo[0]),Tn=Math.max(Tn,xo[1]);Pr>=Yi.x&&ur<=Mi.x&&Tn>=Yi.y&&Bo<=Mi.y&&(Js=[Os.map(xo=>new a.P(xo[0],xo[1]))],(ur<Yi.x||Pr>Mi.x||Bo<Yi.y||Tn>Mi.y)&&(Js=a.bM(Js,Yi.x,Yi.y,Mi.x,Mi.y)))}for(const ur of Js){qi.reset(ur,.25*Di);let Pr=0;Pr=qi.length<=.5*Di?1:Math.ceil(qi.paddedLength/Rs)+1;for(let Bo=0;Bo<Pr;Bo++){const Tn=Bo/Math.max(Pr-1,1),xo=qi.lerp(Tn),Yo=xo.x+Dl,Nn=xo.y+Dl;Pe.push(Yo,Nn,Di,0);const Er=Yo-Di,br=Nn-Di,zr=Yo+Di,_n=Nn+Di;if(ai=ai&&this.isOffscreen(Er,br,zr,_n),Ai=Ai||this.isInsideGrid(Er,br,zr,_n),!r&&this.grid.hitTestCircle(Yo,Nn,Di,ne)&&(Ft=!0,!ie))return{circles:[],offscreen:!1,collisionDetected:Ft,occluded:!1}}}}return{circles:!ie&&Ft||!Ai?[]:Pe,offscreen:ai,collisionDetected:Ft,occluded:At.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[];let d=1/0,_=1/0,b=-1/0,E=-1/0;for(const ie of t){const de=new a.P(ie.x+Dl,ie.y+Dl);d=Math.min(d,de.x),_=Math.min(_,de.y),b=Math.max(b,de.x),E=Math.max(E,de.y),r.push(de)}const D=this.grid.query(d,_,b,E).concat(this.ignoredGrid.query(d,_,b,E)),U={},Z={};for(const ie of D){const de=ie.key;if(U[de.bucketInstanceId]===void 0&&(U[de.bucketInstanceId]={}),U[de.bucketInstanceId][de.featureIndex])continue;const ne=[new a.P(ie.x1,ie.y1),new a.P(ie.x2,ie.y1),new a.P(ie.x2,ie.y2),new a.P(ie.x1,ie.y2)];a.bN(r,ne)&&(U[de.bucketInstanceId][de.featureIndex]=!0,Z[de.bucketInstanceId]===void 0&&(Z[de.bucketInstanceId]=[]),Z[de.bucketInstanceId].push(de.featureIndex))}return Z}insertCollisionBox(t,r,d,_,b){(r?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:_,collisionGroupID:b},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,r,d,_,b){const E=r?this.ignoredGrid:this.grid,D={bucketInstanceId:d,featureIndex:_,collisionGroupID:b};for(let U=0;U<t.length;U+=4)E.insertCircle(D,t[U],t[U+1],t[U+2])}projectAndGetPerspectiveRatio(t,r,d,_,b,E,D){const U=[r,d,_,1];let Z=!1;_||this.transform.pitch>0?(a.aA(U,U,t),this.fogState&&b&&D.name!=="globe"&&(Z=function(ne,me,Ce,Me,Pe,Ne){const He=Ne.calculateFogTileMatrix(Pe),lt=[me,Ce,Me];return a.ad(lt,lt,He),Zi(ne,a.ae(lt),Ne.pitch,Ne._fov)}(this.fogState,r,d,_,b.toUnwrapped(),this.transform)>.9)):So(U,U,t);const ie=U[3];return{point:new a.P((U[0]/ie+1)/2*this.transform.width+Dl,(-U[1]/ie+1)/2*this.transform.height+Dl),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(D)/ie*.5,1.5),signedDistanceFromCamera:ie,occluded:E&&U[2]>ie||Z}}isOffscreen(t,r,d,_){return d<Dl||t>=this.screenRightBoundary||_<Dl||r>this.screenBottomBoundary}isInsideGrid(t,r,d,_){return d>=0&&t<this.gridRightBoundary&&_>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const t=a.bx([]);return a.bo(t,t,[-100,-100,0]),t}}function Ja(c,t,r){const d=t.createTileMatrix(c,c.worldSize,r.toUnwrapped());return a.az(new Float32Array(16),c.projMatrix,d)}function js(c,t,r){if(t.projection.name===r.projection.name)return c.projMatrix;const d=r.clone();return d.setProjection(t.projection),Ja(d,t.getProjection(),c)}function Np(c,t,r){return t.name===r.projection.name?c.projMatrix:Ja(r,t,c)}class lh{constructor(t,r,d,_){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?r:-r))):_&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class ga{constructor(t,r,d,_,b,E=!1){this.text=new lh(t?t.text:null,r,d,b),this.icon=new lh(t?t.icon:null,r,_,b),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class La{constructor(t,r,d,_=!1){this.text=t,this.icon=r,this.skipFade=d,this.clipped=_}}class yh{constructor(){this.invProjMatrix=a.bz(),this.viewportMatrix=a.bz(),this.circles=[]}}class qd{constructor(t,r,d,_,b){this.bucketInstanceId=t,this.featureIndex=r,this.sourceLayerIndex=d,this.bucketIndex=_,this.tileID=b}}class Ls{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const r=++this.maxGroupID;this.collisionGroups[t]={ID:r,predicate:d=>d.collisionGroupID===r}}return this.collisionGroups[t]}}function Qr(c,t,r,d,_){const{horizontalAlign:b,verticalAlign:E}=a.bT(c),D=-(b-.5)*t,U=-(E-.5)*r,Z=a.bU(c,d);return new a.P(D+Z[0]*_,U+Z[1]*_)}function zo(c,t,r,d,_){const b=new a.P(c,t);return r&&b._rotate(d?_:-_),b}class Jl{constructor(t,r,d,_,b,E){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new Md(this.transform,b),this.buildingIndex=E,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=r,this.retainedQueryData={},this.collisionGroups=new Ls(d),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,r,d,_,b=1){const E=d.getBucket(r),D=d.latestFeatureIndex;if(!E||!D||r.fqid!==E.layerIds[0])return;const U=E.layers[0].layout,Z=E.layers[0].paint,ie=d.collisionBoxArray,de=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),ne=d.tileSize/a.aj,me=d.tileID.toUnwrapped();this.transform.setProjection(E.projection);const Ce=(Me=d.tileID,Pe=E.getProjection(),Ne=this.transform,Pe.name===this.projection?Ne.calculateProjMatrix(Me.toUnwrapped()):Ja(Ne,Pe,Me));var Me,Pe,Ne;const He=U.get("text-pitch-alignment")==="map",lt=U.get("text-rotation-alignment")==="map";r.compileFilter(r.options);const ut=r.dynamicFilter(),kt=r.dynamicFilterNeedsFeature(),wt=this.transform.calculatePixelsToTileUnitsMatrix(d),xt=Ir(Ce,d.tileID.canonical,He,lt,this.transform,E.getProjection(),wt);let pt=null;if(He){const ui=Ga(Ce,d.tileID.canonical,He,lt,this.transform,E.getProjection(),wt);pt=a.az([],this.transform.labelPlaneMatrix,ui)}let At=null;ut&&d.latestFeatureIndex&&(At={unwrappedTileID:me,dynamicFilter:ut,dynamicFilterNeedsFeature:kt}),this.retainedQueryData[E.bucketInstanceId]=new qd(E.bucketInstanceId,D,E.sourceLayerIndex,E.index,d.tileID);const[Ct,ti]=E.layers[0].layout.get("text-size-scale-range"),si=a.ay(b,Ct,ti),[wi,_i]=U.get("icon-size-scale-range"),Bi=a.ay(b,wi,_i),Kt={bucket:E,layout:U,paint:Z,posMatrix:Ce,textLabelPlaneMatrix:xt,labelToScreenMatrix:pt,clippingData:At,scale:de,textPixelRatio:ne,holdingForFade:d.holdingForFade(),collisionBoxArray:ie,partiallyEvaluatedTextSize:a.bH(E.textSizeData,this.transform.zoom,si),partiallyEvaluatedIconSize:a.bH(E.iconSizeData,this.transform.zoom,Bi),collisionGroup:this.collisionGroups.get(E.sourceID),latestFeatureIndex:d.latestFeatureIndex};if(_)for(const ui of E.sortKeyRanges){const{sortKey:Ft,symbolInstanceStart:Ai,symbolInstanceEnd:ai}=ui;t.push({sortKey:Ft,symbolInstanceStart:Ai,symbolInstanceEnd:ai,parameters:Kt})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:Kt})}attemptAnchorPlacement(t,r,d,_,b,E,D,U,Z,ie,de,ne,me,Ce,Me,Pe,Ne,He){const{textOffset0:lt,textOffset1:ut,crossTileID:kt}=ne,wt=[lt,ut],xt=Qr(t,d,_,wt,b),pt=this.collisionIndex.placeCollisionBox(Ce,b,r,zo(xt.x,xt.y,E,D,this.transform.angle),de,U,Z,ie.predicate);if(Pe){const At=Ce.getSymbolInstanceIconSize(He,this.transform.zoom,ne.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Ce,At,Pe,zo(xt.x,xt.y,E,D,this.transform.angle),de,U,Z,ie.predicate).box.length===0)return}if(pt.box.length>0){let At;return this.prevPlacement&&this.prevPlacement.variableOffsets[kt]&&this.prevPlacement.placements[kt]&&this.prevPlacement.placements[kt].text&&(At=this.prevPlacement.variableOffsets[kt].anchor),this.variableOffsets[kt]={textOffset:wt,width:d,height:_,anchor:t,textScale:b,prevAnchor:At},this.markUsedJustification(Ce,t,ne,Me),Ce.allowVerticalPlacement&&(this.markUsedOrientation(Ce,Me,ne),this.placedOrientations[kt]=Me),{shift:xt,placedGlyphBoxes:pt}}}placeLayerBucketPart(t,r,d,_,b=1){const{bucket:E,layout:D,paint:U,posMatrix:Z,textLabelPlaneMatrix:ie,labelToScreenMatrix:de,clippingData:ne,textPixelRatio:me,holdingForFade:Ce,collisionBoxArray:Me,partiallyEvaluatedTextSize:Pe,partiallyEvaluatedIconSize:Ne,collisionGroup:He,latestFeatureIndex:lt}=t.parameters,ut=D.get("text-optional"),kt=D.get("icon-optional"),wt=D.get("text-allow-overlap"),xt=D.get("icon-allow-overlap"),pt=D.get("text-rotation-alignment")==="map",At=D.get("text-pitch-alignment")==="map",Ct=U.get("symbol-z-offset"),ti=D.get("symbol-elevation-reference")==="sea",[si,wi]=D.get("text-size-scale-range"),[_i,Bi]=D.get("icon-size-scale-range"),Kt=a.ay(b,si,wi),ui=a.ay(b,_i,Bi);this.transform.setProjection(E.projection);let Ft=wt&&(xt||!E.hasIconData()||kt),Ai=xt&&(wt||!E.hasTextData()||ut);const ai=!Ct.isConstant();!E.collisionArrays&&Me&&E.deserializeCollisionBoxes(Me),d&&_&&E.updateCollisionDebugBuffers(this.transform.zoom,Me,Kt,ui);const Di=(Mi,qi,_s)=>{const{crossTileID:Ts,numVerticalGlyphVertices:us}=Mi;let Os=null;if(ne&&ne.dynamicFilterNeedsFeature||ai){const cn=this.retainedQueryData[E.bucketInstanceId];Os=lt.loadFeature({featureIndex:Mi.featureIndex,bucketIndex:cn.bucketIndex,sourceLayerIndex:cn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(ne&&!(0,ne.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Os,this.retainedQueryData[E.bucketInstanceId].tileID.canonical,new a.P(Mi.tileAnchorX,Mi.tileAnchorY),this.transform.calculateDistanceTileData(ne.unwrappedTileID)))return this.placements[Ts]=new La(!1,!1,!1,!0),void r.add(Ts);const Rs=Ct.evaluate(Os,{});if(r.has(Ts))return;if(Ce)return void(this.placements[Ts]=new La(!1,!1,!1));let Js=!1,ur=!1,Pr=!0,Bo=!1,Tn=!1,xo=null,Yo={box:null,offscreen:null,occluded:null},Nn={box:null},Er=null,br=null,zr=null,_n=0,Xa=0,Mo=0;_s.textFeatureIndex?_n=_s.textFeatureIndex:Mi.useRuntimeCollisionCircles&&(_n=Mi.featureIndex),_s.verticalTextFeatureIndex&&(Xa=_s.verticalTextFeatureIndex);const jo=cn=>{cn.tileID=this.retainedQueryData[E.bucketInstanceId].tileID;const dn=this.transform.elevation;cn.elevation=ti?Rs:Rs+(dn?dn.getAtTileOffset(cn.tileID,cn.tileAnchorX,cn.tileAnchorY):0),cn.elevation+=Mi.zOffset},Yn=_s.textBox;if(Yn){jo(Yn);const cn=_o=>{let qn=a.bI.horizontal;if(E.allowVerticalPlacement&&!_o&&this.prevPlacement){const uh=this.prevPlacement.placedOrientations[Ts];uh&&(this.placedOrientations[Ts]=uh,qn=uh,this.markUsedOrientation(E,qn,Mi))}return qn},dn=(_o,qn)=>{if(E.allowVerticalPlacement&&us>0&&_s.verticalTextBox){for(const uh of E.writingModes)if(uh===a.bI.vertical?(Yo=qn(),Nn=Yo):Yo=_o(),Yo&&Yo.box&&Yo.box.length)break}else Yo=_o()};if(D.get("text-variable-anchor")){let _o=D.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ts]){const sn=this.prevPlacement.variableOffsets[Ts];_o.indexOf(sn.anchor)>0&&(_o=_o.filter(Go=>Go!==sn.anchor),_o.unshift(sn.anchor))}const qn=(sn,Go,hc)=>{const Rh=E.getSymbolInstanceTextSize(Pe,Mi,this.transform.zoom,qi),Bd=(sn.x2-sn.x1)*Rh+2*sn.padding,gu=(sn.y2-sn.y1)*Rh+2*sn.padding,qc=Mi.hasIconTextFit&&!xt?Go:null;qc&&jo(qc);let kc={box:[],offscreen:!1,occluded:!1};const hp=wt?2*_o.length:_o.length;for(let Fd=0;Fd<hp;++Fd){const yu=this.attemptAnchorPlacement(_o[Fd%_o.length],sn,Bd,gu,Rh,pt,At,me,Z,He,Fd>=_o.length,Mi,qi,E,hc,qc,Pe,Ne);if(yu&&(kc=yu.placedGlyphBoxes,kc&&kc.box&&kc.box.length)){Js=!0,xo=yu.shift;break}}return kc};dn(()=>qn(Yn,_s.iconBox,a.bI.horizontal),()=>{const sn=_s.verticalTextBox;return sn&&jo(sn),E.allowVerticalPlacement&&!(Yo&&Yo.box&&Yo.box.length)&&us>0&&sn?qn(sn,_s.verticalIconBox,a.bI.vertical):{box:null,offscreen:null,occluded:null}}),Yo&&(Js=Yo.box,Pr=Yo.offscreen,Bo=Yo.occluded);const uh=cn(!(!Yo||!Yo.box));if(!Js&&this.prevPlacement){const sn=this.prevPlacement.variableOffsets[Ts];sn&&(this.variableOffsets[Ts]=sn,this.markUsedJustification(E,sn.anchor,Mi,uh))}}else{const _o=(qn,uh)=>{const sn=E.getSymbolInstanceTextSize(Pe,Mi,this.transform.zoom,qi,b),Go=this.collisionIndex.placeCollisionBox(E,sn,qn,new a.P(0,0),wt,me,Z,He.predicate);return Go&&Go.box&&Go.box.length&&(this.markUsedOrientation(E,uh,Mi),this.placedOrientations[Ts]=uh),Go};dn(()=>_o(Yn,a.bI.horizontal),()=>{const qn=_s.verticalTextBox;return E.allowVerticalPlacement&&us>0&&qn?(jo(qn),_o(qn,a.bI.vertical)):{box:null,offscreen:null,occluded:null}}),cn(!!(Yo&&Yo.box&&Yo.box.length))}}if(Er=Yo,Js=Er&&Er.box&&Er.box.length>0,Pr=Er&&Er.offscreen,Bo=Er&&Er.occluded,Mi.useRuntimeCollisionCircles){const cn=E.text.placedSymbolArray.get(Mi.centerJustifiedTextSymbolIndex>=0?Mi.centerJustifiedTextSymbolIndex:Mi.verticalPlacedTextSymbolIndex),dn=a.bJ(E.textSizeData,Pe,cn),_o=D.get("text-padding");br=this.collisionIndex.placeCollisionCircles(E,wt,cn,E.lineVertexArray,E.glyphOffsetArray,dn,Z,ie,de,d,At,He.predicate,Mi.collisionCircleDiameter*dn/a.bO,_o,this.retainedQueryData[E.bucketInstanceId].tileID),Js=wt||br.circles.length>0&&!br.collisionDetected,Pr=Pr&&br.offscreen,Bo=br.occluded}if(_s.iconFeatureIndex&&(Mo=_s.iconFeatureIndex),_s.iconBox){const cn=dn=>{jo(dn);const _o=Mi.hasIconTextFit&&xo?zo(xo.x,xo.y,pt,At,this.transform.angle):new a.P(0,0),qn=E.getSymbolInstanceIconSize(Ne,this.transform.zoom,Mi.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(E,qn,dn,_o,xt,me,Z,He.predicate)};Nn&&Nn.box&&Nn.box.length&&_s.verticalIconBox?(zr=cn(_s.verticalIconBox),ur=zr.box.length>0):(zr=cn(_s.iconBox),ur=zr.box.length>0),Pr=Pr&&zr.offscreen,Tn=zr.occluded}const Xr=ut||Mi.numHorizontalGlyphVertices===0&&us===0,$n=kt||Mi.numIconVertices===0;if(Xr||$n?$n?Xr||(ur=ur&&Js):Js=ur&&Js:ur=Js=ur&&Js,Js&&Er&&Er.box&&this.collisionIndex.insertCollisionBox(Er.box,D.get("text-ignore-placement"),E.bucketInstanceId,Nn&&Nn.box&&Xa?Xa:_n,He.ID),ur&&zr&&this.collisionIndex.insertCollisionBox(zr.box,D.get("icon-ignore-placement"),E.bucketInstanceId,Mo,He.ID),br&&(Js&&this.collisionIndex.insertCollisionCircles(br.circles,D.get("text-ignore-placement"),E.bucketInstanceId,_n,He.ID),d)){const cn=E.bucketInstanceId;let dn=this.collisionCircleArrays[cn];dn===void 0&&(dn=this.collisionCircleArrays[cn]=new yh);for(let _o=0;_o<br.circles.length;_o+=4)dn.circles.push(br.circles[_o+0]),dn.circles.push(br.circles[_o+1]),dn.circles.push(br.circles[_o+2]),dn.circles.push(br.collisionDetected?1:0)}const hn=E.projection.name!=="globe";Ft=Ft&&(hn||!Bo),Ai=Ai&&(hn||!Tn),this.placements[Ts]=new La(Js||Ft,ur||Ai,Pr||E.justReloaded),r.add(Ts)},Yi=this.retainedQueryData[E.bucketInstanceId].tileID;if(E.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(E,Yi),E.elevationType==="road"&&E.updateRoadElevation(Yi.canonical),E.updateZOffset(),E.sortFeaturesByY){const Mi=E.getSortedSymbolIndexes(this.transform.angle);for(let qi=Mi.length-1;qi>=0;--qi){const _s=Mi[qi];Di(E.symbolInstances.get(_s),_s,E.collisionArrays[_s])}E.hasAnyZOffset&&a.w(`${E.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(E.hasAnyZOffset){const Mi=E.getSortedIndexesByZOffset();for(let qi=0;qi<Mi.length;++qi){const _s=Mi[qi];Di(E.symbolInstances.get(_s),_s,E.collisionArrays[_s])}}else for(let Mi=t.symbolInstanceStart;Mi<t.symbolInstanceEnd;Mi++)Di(E.symbolInstances.get(Mi),Mi,E.collisionArrays[Mi]);if(d&&E.bucketInstanceId in this.collisionCircleArrays){const Mi=this.collisionCircleArrays[E.bucketInstanceId];a.bi(Mi.invProjMatrix,Z),Mi.viewportMatrix=this.collisionIndex.getViewportMatrix()}E.justReloaded=!1}markUsedJustification(t,r,d,_){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:U,crossTileID:Z}=d,ie=a.bV(r),de=_===a.bI.vertical?U:ie==="left"?b:ie==="center"?E:ie==="right"?D:-1;b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=de>=0&&b!==de?0:Z),E>=0&&(t.text.placedSymbolArray.get(E).crossTileID=de>=0&&E!==de?0:Z),D>=0&&(t.text.placedSymbolArray.get(D).crossTileID=de>=0&&D!==de?0:Z),U>=0&&(t.text.placedSymbolArray.get(U).crossTileID=de>=0&&U!==de?0:Z)}markUsedOrientation(t,r,d){const _=r===a.bI.horizontal||r===a.bI.horizontalOnly?r:0,b=r===a.bI.vertical?r:0,{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:D,rightJustifiedTextSymbolIndex:U,verticalPlacedTextSymbolIndex:Z}=d,ie=t.text.placedSymbolArray;E>=0&&(ie.get(E).placedOrientation=_),D>=0&&(ie.get(D).placedOrientation=_),U>=0&&(ie.get(U).placedOrientation=_),Z>=0&&(ie.get(Z).placedOrientation=b)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let d=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const _=r?r.symbolFadeChange(t):1,b=r?r.opacities:{},E=r?r.variableOffsets:{},D=r?r.placedOrientations:{};for(const U in this.placements){const Z=this.placements[U],ie=b[U];ie?(this.opacities[U]=new ga(ie,_,Z.text,Z.icon,null,Z.clipped),d=d||Z.text!==ie.text.placed||Z.icon!==ie.icon.placed):(this.opacities[U]=new ga(null,_,Z.text,Z.icon,Z.skipFade,Z.clipped),d=d||Z.text||Z.icon)}for(const U in b){const Z=b[U];if(!this.opacities[U]){const ie=new ga(Z,_,!1,!1);ie.isHidden()||(this.opacities[U]=ie,d=d||Z.text.placed||Z.icon.placed)}}for(const U in E)this.variableOffsets[U]||!this.opacities[U]||this.opacities[U].isHidden()||(this.variableOffsets[U]=E[U]);for(const U in D)this.placedOrientations[U]||!this.opacities[U]||this.opacities[U].isHidden()||(this.placedOrientations[U]=D[U]);d?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:t)}updateLayerOpacities(t,r,d,_){const b=new Set;for(const E of r){const D=E.getBucket(t);D&&E.latestFeatureIndex&&t.fqid===D.layerIds[0]&&(this.updateBucketOpacities(D,b,E,E.collisionBoxArray,d,_,E.tileID,t.scope),D.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(D,E.tileID),D.elevationType==="road"&&D.updateRoadElevation(E.tileID.canonical),D.updateZOffset())}}updateBucketOpacities(t,r,d,_,b,E,D,U){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const Z=t.layers[0].layout,ie=t.layers[0].paint,de=!!t.layers[0].dynamicFilter(),ne=new ga(null,0,!1,!1,!0),me=Z.get("text-allow-overlap"),Ce=Z.get("icon-allow-overlap"),Me=Z.get("text-variable-anchor"),Pe=Z.get("text-rotation-alignment")==="map",Ne=Z.get("text-pitch-alignment")==="map",He=ie.get("symbol-z-offset"),lt=Z.get("symbol-elevation-reference")==="sea",ut=!He.isConstant(),kt=new ga(null,0,me&&(Ce||!t.hasIconData()||Z.get("icon-optional")),Ce&&(me||!t.hasTextData()||Z.get("text-optional")),!0);!t.collisionArrays&&_&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(_);const wt=(pt,At,Ct)=>{for(let ti=0;ti<At/4;ti++)pt.opacityVertexArray.emplaceBack(Ct)};let xt=0;E&&t.updateReplacement(D,E);for(let pt=0;pt<t.symbolInstances.length;pt++){const At=t.symbolInstances.get(pt),{numHorizontalGlyphVertices:Ct,numVerticalGlyphVertices:ti,crossTileID:si,numIconVertices:wi,tileAnchorX:_i,tileAnchorY:Bi}=At;let Kt=null;const ui=this.retainedQueryData[t.bucketInstanceId];ut&&At&&ui&&(Kt=d.latestFeatureIndex.loadFeature({featureIndex:At.featureIndex,bucketIndex:ui.bucketIndex,sourceLayerIndex:ui.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ft=He.evaluate(Kt,{}),Ai=r.has(si);let ai=this.opacities[si];Ai?ai=ne:ai||(ai=kt,this.opacities[si]=ai),r.add(si);const Di=Ct>0||ti>0,Yi=wi>0,Mi=this.placedOrientations[si],qi=Mi===a.bI.vertical,_s=Mi===a.bI.horizontal||Mi===a.bI.horizontalOnly;!Di&&!Yi||ai.isHidden()||xt++;let Ts=!1;if((Di||Yi)&&E)for(const us of t.activeReplacements){if(a.bP(us,b,a.bQ.Symbol,U)||us.min.x>_i||_i>us.max.x||us.min.y>Bi||Bi>us.max.y)continue;const Os=a.bR(_i,Bi,D.canonical,us.footprintTileId.canonical);if(Ts=a.bS(Os,us.footprint),Ts)break}if(Di){const us=Ts?Zd:sd(ai.text);wt(t.text,Ct,qi?Zd:us),wt(t.text,ti,_s?Zd:us);const Os=ai.text.isHidden(),{leftJustifiedTextSymbolIndex:Rs,centerJustifiedTextSymbolIndex:Js,rightJustifiedTextSymbolIndex:ur,verticalPlacedTextSymbolIndex:Pr}=At,Bo=t.text.placedSymbolArray,Tn=Os||qi?1:0;Rs>=0&&(Bo.get(Rs).hidden=Tn),Js>=0&&(Bo.get(Js).hidden=Tn),ur>=0&&(Bo.get(ur).hidden=Tn),Pr>=0&&(Bo.get(Pr).hidden=Os||_s?1:0);const xo=this.variableOffsets[si];xo&&this.markUsedJustification(t,xo.anchor,At,Mi);const Yo=this.placedOrientations[si];Yo&&(this.markUsedJustification(t,"left",At,Yo),this.markUsedOrientation(t,Yo,At))}if(Yi){const us=Ts?Zd:sd(ai.icon),{placedIconSymbolIndex:Os,verticalPlacedIconSymbolIndex:Rs}=At,Js=t.icon.placedSymbolArray,ur=ai.icon.isHidden()?1:0;Os>=0&&(wt(t.icon,wi,qi?Zd:us),Js.get(Os).hidden=ur),Rs>=0&&(wt(t.icon,At.numVerticalIconVertices,_s?Zd:us),Js.get(Rs).hidden=ur)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const us=t.collisionArrays[pt];if(us){let Os=new a.P(0,0),Rs=!0;if(us.textBox||us.verticalTextBox){if(Me){const ur=this.variableOffsets[si];ur?(Os=Qr(ur.anchor,ur.width,ur.height,ur.textOffset,ur.textScale),Pe&&Os._rotate(Ne?this.transform.angle:-this.transform.angle)):Rs=!1}de&&(Rs=!ai.clipped),us.textBox&&Kh(t.textCollisionBox.collisionVertexArray,ai.text.placed,!Rs||qi,Ft,lt,Os.x,Os.y),us.verticalTextBox&&Kh(t.textCollisionBox.collisionVertexArray,ai.text.placed,!Rs||_s,Ft,lt,Os.x,Os.y)}const Js=Rs&&!!(!_s&&us.verticalIconBox);us.iconBox&&Kh(t.iconCollisionBox.collisionVertexArray,ai.icon.placed,Js,Ft,lt,At.hasIconTextFit?Os.x:0,At.hasIconTextFit?Os.y:0),us.verticalIconBox&&Kh(t.iconCollisionBox.collisionVertexArray,ai.icon.placed,!Js,Ft,lt,At.hasIconTextFit?Os.x:0,At.hasIconTextFit?Os.y:0)}}}if(t.fullyClipped=xt===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const pt=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=pt.invProjMatrix,t.placementViewportMatrix=pt.viewportMatrix,t.collisionCircleArray=pt.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,r){const d=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*d>t}setStale(){this.stale=!0}}function Kh(c,t,r,d,_,b,E){c.emplaceBack(t?1:0,r?1:0,b||0,E||0,d,_?1:0),c.emplaceBack(t?1:0,r?1:0,b||0,E||0,d,_?1:0),c.emplaceBack(t?1:0,r?1:0,b||0,E||0,d,_?1:0),c.emplaceBack(t?1:0,r?1:0,b||0,E||0,d,_?1:0)}const ro=Math.pow(2,25),ku=Math.pow(2,24),Ph=Math.pow(2,17),gc=Math.pow(2,16),Ba=Math.pow(2,9),Xn=Math.pow(2,8),Hf=Math.pow(2,1);function sd(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const t=c.placed?1:0,r=Math.floor(127*c.opacity);return r*ro+t*ku+r*Ph+t*gc+r*Ba+t*Xn+r*Hf+t}const Zd=0;class Vp{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,r,d,_,b,E){const D=this._bucketParts;for(;this._currentTileIndex<t.length;)if(r.getBucketParts(D,_,t[this._currentTileIndex],this._sortAcrossTiles,E),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,D.sort((U,Z)=>U.sortKey-Z.sortKey));this._currentPartIndex<D.length;){const U=D[this._currentPartIndex];if(r.placeLayerBucketPart(U,this._seenCrossTileIDs,d,U.symbolInstanceStart===0,E),this._currentPartIndex++,b())return!0}return!1}}class Kd{constructor(t,r,d,_,b,E,D,U,Z){this.placement=new Jl(t,b,E,D,U,Z),this._currentPlacementIndex=r.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(t,r,d,_,b){const E=a.q.now(),D=()=>{const U=a.q.now()-E;return!this._forceFullPlacement&&U>2};for(;this._currentPlacementIndex>=0;){const U=r[t[this._currentPlacementIndex]],Z=this.placement.collisionIndex.transform.zoom;if(U.type==="symbol"&&(!U.minzoom||U.minzoom<=Z)&&(!U.maxzoom||U.maxzoom>Z)){const ie=U,de=ie.layout.get("symbol-z-elevate"),ne=ie.layout.get("symbol-sort-key").constantOr(1)!==void 0,me=ie.layout.get("symbol-z-order"),Ce=me==="viewport-y"||me==="auto"&&!(me!=="viewport-y"&&ne),Me=ie.layout.get("text-allow-overlap")||ie.layout.get("icon-allow-overlap")||ie.layout.get("text-ignore-placement")||ie.layout.get("icon-ignore-placement"),Pe=Ce&&Me,Ne=this._inProgressLayer=this._inProgressLayer||new Vp(ie),He=a.C(U.source,U.scope);if(Ne.continuePlacement(de||Pe?_[He]:d[He],this.placement,this._showCollisionBoxes,U,D,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Tl=512/a.aj/2;class Ad{constructor(t,r,d){this.tileID=t,this.bucketInstanceId=d,this.index=new a.bW(r.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const _=t.canonical.x*a.aj,b=t.canonical.y*a.aj;for(let E=0;E<r.length;E++){const{key:D,crossTileID:U,tileAnchorX:Z,tileAnchorY:ie}=r.get(E),de=Math.floor((_+Z)*Tl),ne=Math.floor((b+ie)*Tl);this.index.add(de,ne),this.keys.push(D),this.crossTileIDs.push(U)}this.index.finish()}findMatches(t,r,d){const _=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z),b=Tl/Math.pow(2,r.canonical.z-this.tileID.canonical.z),E=r.canonical.x*a.aj,D=r.canonical.y*a.aj;for(let U=0;U<t.length;U++){const Z=t.get(U);if(Z.crossTileID)continue;const{key:ie,tileAnchorX:de,tileAnchorY:ne}=Z,me=Math.floor((E+de)*b),Ce=Math.floor((D+ne)*b),Me=this.index.range(me-_,Ce-_,me+_,Ce+_).sort((Pe,Ne)=>Pe-Ne);for(const Pe of Me){const Ne=this.crossTileIDs[Pe];if(this.keys[Pe]===ie&&!d.has(Ne)){d.add(Ne),Z.crossTileID=Ne;break}}}}}class Wa{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Jd{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const r=Math.round((t-this.lng)/360);if(r!==0)for(const d in this.indexes){const _=this.indexes[d],b={};for(const E in _){const D=_[E];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+r),b[D.tileID.key]=D}this.indexes[d]=b}this.lng=t}addBucket(t,r,d){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let b=0;b<r.symbolInstances.length;b++)r.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const _=this.usedCrossTileIDs[t.overscaledZ];for(const b in this.indexes){const E=this.indexes[b];if(Number(b)>t.overscaledZ)for(const D in E){const U=E[D];U.tileID.isChildOf(t)&&U.findMatches(r.symbolInstances,t,_)}else{const D=E[t.scaledTo(Number(b)).key];D&&D.findMatches(r.symbolInstances,t,_)}}for(let b=0;b<r.symbolInstances.length;b++){const E=r.symbolInstances.get(b);E.crossTileID||(E.crossTileID=d.generate(),_.add(E.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ad(t,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(t,r){for(const d of r.crossTileIDs)this.usedCrossTileIDs[t].delete(d)}removeStaleBuckets(t){let r=!1;for(const d in this.indexes){const _=this.indexes[d];for(const b in _)t[_[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,_[b]),delete _[b],r=!0)}return r}}class cl{constructor(){this.layerIndexes={},this.crossTileIDs=new Wa,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,r,d,_){let b=this.layerIndexes[t.fqid];b===void 0&&(b=this.layerIndexes[t.fqid]=new Jd);let E=!1;const D={};_.name!=="globe"&&b.handleWrapJump(d);for(const U of r){const Z=U.getBucket(t);Z&&t.fqid===Z.layerIds[0]&&(Z.bucketInstanceId||(Z.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(U.tileID,Z,this.crossTileIDs)&&(E=!0),D[Z.bucketInstanceId]=!0)}return b.removeStaleBuckets(D)&&(E=!0),E}pruneUnusedLayers(t){const r={};t.forEach(d=>{r[d]=!0});for(const d in this.layerIndexes)r[d]||delete this.layerIndexes[d]}}const gp=771;class Fr{constructor(t,r,d,_){this.blendFunction=t,this.blendColor=r.toNonPremultipliedRenderColor(null),this.mask=d,this.blendEquation=_}}Fr.Replace=[1,0,1,0],Fr.disabled=new Fr(Fr.Replace,a.am.transparent,[!1,!1,!1,!1]),Fr.unblended=new Fr(Fr.Replace,a.am.transparent,[!0,!0,!0,!0]),Fr.alphaBlended=new Fr([1,gp,1,gp],a.am.transparent,[!0,!0,!0,!0]),Fr.alphaBlendedNonPremultiplied=new Fr([770,gp,770,gp],a.am.transparent,[!0,!0,!0,!0]),Fr.multiply=new Fr([774,0,774,0],a.am.transparent,[!0,!0,!0,!0]);class cs{constructor(t,r,d){this.func=t,this.mask=r,this.range=d}}cs.ReadOnly=!1,cs.ReadWrite=!0,cs.disabled=new cs(519,cs.ReadOnly,[0,1]);const Jh=7680;class hr{constructor(t,r,d,_,b,E){this.test=t,this.ref=r,this.mask=d,this.fail=_,this.depthFail=b,this.pass=E}}hr.disabled=new hr({func:519,mask:0},0,0,Jh,Jh,Jh);const An=1029,Qh=2305;class Zs{constructor(t,r,d){this.enable=t,this.mode=r,this.frontFace=d}}function ec(c,t){const r=a.c1(c,3);a.c3(c,t),a.c7(c,3,r)}function Ql(c,t){const r=a.b_([]);return a.b$(r,r,-t),a.c0(r,r,-c),r}function rd(c,t){const r=[c[0],c[1],0],d=[t[0],t[1],0];if(a.ae(r)>=1e-15){const E=a.au([],r);a.bY(d,E,a.bG(d,E)),t[0]=d[0],t[1]=d[1]}const _=a.bF([],t,c);if(a.bZ(_)<1e-15)return null;const b=Math.atan2(-_[1],_[0]);return Ql(Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2]),b)}Zs.disabled=new Zs(!1,An,Qh),Zs.backCCW=new Zs(!0,An,Qh),Zs.backCW=new Zs(!0,An,2304),Zs.frontCW=new Zs(!0,1028,2304),Zs.frontCCW=new Zs(!0,1028,Qh);class Rc{constructor(t,r){this.position=t,this.orientation=r}get position(){return this._position}set position(t){if(t){const r=t instanceof a.ac?t:new a.ac(t[0],t[1],t[2]);this._renderWorldCopies&&(r.x=a.bX(r.x,0,1)),this._position=r}else this._position=null}lookAtPoint(t,r){if(this.orientation=null,!this.position)return;const d=this.position,_=this._elevation?this._elevation.getAtPointOrZero(a.ac.fromLngLat(t)):0,b=a.ac.fromLngLat(t,_),E=[b.x-d.x,b.y-d.y,b.z-d.z];r||(r=[0,0,1]),r[2]=Math.abs(r[2]),this.orientation=rd(E,r)}setPitchBearing(t,r){this.orientation=Ql(a.al(t),a.al(-r))}}class tc{constructor(t,r){this._transform=a.bx([]),this.orientation=r,this.position=t}get mercatorPosition(){const t=this.position;return new a.ac(t[0],t[1],t[2])}get position(){const t=a.c1(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var r;t&&a.c7(this._transform,3,[(r=t)[0],r[1],r[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||a.b_([]),t&&ec(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),r=this.right();return{bearing:Math.atan2(-r[1],r[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,r){this._orientation=Ql(t,r),ec(this._transform,this._orientation)}forward(){const t=a.c1(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=a.c1(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=a.c1(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,r){const d=new Float64Array(16);return a.bi(d,this.getWorldToCamera(t,r)),d}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,r,d){const _=this.position;a.bY(_,_,-t);const b=new Float64Array(16);return a.bn(b,[d,d,d]),a.bo(b,b,_),b[10]*=r,b}getWorldToCamera(t,r){const d=new Float64Array(16),_=new Float64Array(4),b=this.position;return a.c2(_,this._orientation),a.bY(b,b,-t),a.c3(d,_),a.bo(d,d,b),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=r,d[9]*=r,d[10]*=r,d[11]*=r,d}getCameraToClipPerspective(t,r,d,_){const b=new Float64Array(16);return a.c4(b,t,r,d,_),b}getCameraToClipOrthographic(t,r,d,_,b,E){const D=new Float64Array(16);return a.c5(D,t,r,d,_,b,E),D}getDistanceToElevation(t,r=!1){const d=t===0?0:a.c6(t,r?a.aY(this.position[1]):this.position[1]),_=this.forward();return(d-this.position[2])/_[2]}clone(){return new tc([...this.position],[...this.orientation])}}const Qa={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class ic{constructor(t=0,r=0,d=0,_=0){if(isNaN(t)||t<0||isNaN(r)||r<0||isNaN(d)||d<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=r,this.left=d,this.right=_}interpolate(t,r,d){return r.top!=null&&t.top!=null&&(this.top=a.ai(t.top,r.top,d)),r.bottom!=null&&t.bottom!=null&&(this.bottom=a.ai(t.bottom,r.bottom,d)),r.left!=null&&t.left!=null&&(this.left=a.ai(t.left,r.left,d)),r.right!=null&&t.right!=null&&(this.right=a.ai(t.right,r.right,d)),this}getCenter(t,r){const d=a.ay((this.left+t-this.right)/2,0,t),_=a.ay((this.top+r-this.bottom)/2,0,r);return new a.P(d,_)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ic(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Aa=15;class df{constructor(t,r,d,_,b,E,D){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=t||0,this._maxZoom=r||22,this._minPitch=d??0,this._maxPitch=_??60,this.setProjection(E),this.setMaxBounds(D),this.width=0,this.height=0,this._center=new a.cd(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ic,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new tc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new df(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Aa}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,r=!1){const d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||d)&&this._updateCameraOnTerrain(),(t||d)&&this._constrainCamera(r),this._calcMatrices()}getProjection(){return a.aF(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const r=this.projection?this.getProjection():void 0;this.projection=a.ce(this.projectionOptions);const d=this.getProjection(),_=!a.bv(r,d);return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.ce({name:"mercator"});const r=t!==this.projection.name;return r&&this._calcMatrices(),r}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.c6(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return a.bX(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const r=-t*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=a.cf(),a.cg(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const r=a.ay(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=a.al(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const r=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==r&&(this._unmodified=!1,this._setZoom(r),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,r=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!r||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const d=this._elevation;r||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&d.exaggeration()&&this._centerAltitudeValidForExaggeration!==d.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*d.exaggeration(),this._centerAltitudeValidForExaggeration=d.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=d.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,r=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop();let _=0,b=0;for(let E=0;E<r.length;E++){const D=new a.P(r[E][0]*this.width,d+r[E][1]*(this.height-d)),U=t.pointCoordinate(D);if(!U)continue;const Z=1/Math.hypot(U[0]-this._camera.position[0],U[1]-this._camera.position[1]);_+=U[3]*Z,b+=Z}return b===0?NaN:_/b}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,r=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*r,_=this._mercatorZfromZoom(t),b=this._mercatorZfromZoom(this._maxZoom),E=Math.max(_-d,b);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const r=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let d;d=t.z<this._camera.position[2]?[r.x,r.y,r.z]:[t.x,t.y,t.z];const _=a.ae(a.at([],this._camera.position,d));return a.ay(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let r=!1;if(t.orientation&&!a.ch(t.orientation,this._camera.orientation)&&(r=this._setCameraOrientation(t.orientation)),t.position){const d=[t.position.x,t.position.y,t.position.z];a.ci(d,this._camera.position)||(this._setCameraPosition(d),r=!0)}r&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,r=new Rc;return r.position=new a.ac(t[0],t[1],t[2]),r.orientation=this._camera.orientation,r._elevation=this.elevation,r._renderWorldCopies=this.renderWorldCopies,r}_setCameraOrientation(t){if(!a.cj(t))return!1;a.ck(t,t);const r=a.cl([],[0,0,-1],t),d=a.cl([],[0,-1,0],t);if(d[2]<0)return!1;const _=rd(r,d);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(t){const r=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;t[2]=a.ay(t[2],_/d,_/r),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,r,d){this._unmodified=!1,this._edgeInsets.interpolate(t,r,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const r=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,r)}getVisibleUnwrappedCoordinates(t){const r=[new a.cm(0,t)];if(this.renderWorldCopies){const d=this.pointCoordinate(new a.P(0,0)),_=this.pointCoordinate(new a.P(this.width,0)),b=this.pointCoordinate(new a.P(this.width,this.height)),E=this.pointCoordinate(new a.P(0,this.height)),D=Math.floor(Math.min(d.x,_.x,b.x,E.x)),U=Math.floor(Math.max(d.x,_.x,b.x,E.x)),Z=1;for(let ie=D-Z;ie<=U+Z;ie++)ie!==0&&r.push(new a.cm(ie,t))}return r}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,r,d){let _=[];const b=d!=null,E=!b;if(E&&this.zoom<r||b&&d[0]===0&&d[1]===0)return _;const D=new Set,U=(ie,de,ne,me,Ce)=>{const Me=a.cK(de,ie,ne,me,Ce);D.has(Me)||(_.push(new a.aM(ie,de,ne,me,Ce)),D.add(Me))};for(let ie=0;ie<t.length;ie++){const de=t[ie];if(E&&de.canonical.z!==r)continue;const ne=de.canonical,me=de.overscaledZ,Ce=de.wrap,Me=1<<ne.z,Pe=ne.x+1<Me,Ne=ne.x>0,He=ne.y+1<Me,lt=ne.y>0,ut=de.wrap-(Ne?0:1),kt=de.wrap+(Pe?0:1),wt=Ne?ne.x-1:Me-1,xt=Pe?ne.x+1:0;if(b)d[0]<0?(U(me,kt,ne.z,xt,ne.y),d[1]<0&&He&&(U(me,Ce,ne.z,ne.x,ne.y+1),U(me,kt,ne.z,xt,ne.y+1)),d[1]>0&&lt&&(U(me,Ce,ne.z,ne.x,ne.y-1),U(me,kt,ne.z,xt,ne.y-1))):d[0]>0?(U(me,ut,ne.z,wt,ne.y),d[1]<0&&He&&(U(me,Ce,ne.z,ne.x,ne.y+1),U(me,ut,ne.z,wt,ne.y+1)),d[1]>0&&lt&&(U(me,Ce,ne.z,ne.x,ne.y-1),U(me,ut,ne.z,wt,ne.y-1))):d[1]<0&&He?U(me,Ce,ne.z,ne.x,ne.y+1):lt&&U(me,Ce,ne.z,ne.x,ne.y-1);else{const pt=de.visibleQuadrants;1&pt&&(U(me,ut,ne.z,wt,ne.y),lt&&(U(me,Ce,ne.z,ne.x,ne.y-1),U(me,ut,ne.z,wt,ne.y-1))),2&pt&&(U(me,kt,ne.z,xt,ne.y),lt&&(U(me,Ce,ne.z,ne.x,ne.y-1),U(me,kt,ne.z,xt,ne.y-1))),4&pt&&(U(me,ut,ne.z,wt,ne.y),He&&(U(me,Ce,ne.z,ne.x,ne.y+1),U(me,ut,ne.z,wt,ne.y+1))),8&pt&&(U(me,kt,ne.z,xt,ne.y),He&&(U(me,Ce,ne.z,ne.x,ne.y+1),U(me,kt,ne.z,xt,ne.y+1)))}}const Z=[];for(const ie of _)_.some(de=>ie.isChildOf(de))||Z.push(ie);if(_=Z.filter(ie=>!t.some(de=>!!(ie.overscaledZ<r&&de.isChildOf(ie))||ie.equals(de)||ie.isChildOf(de))),E){const ie=1<<r,de=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ne=[ie*de.x,ie*de.y],me=4,Ce=me*me;_=_.filter(Me=>{const Pe=Me.canonical.x+.5-ne[0],Ne=Me.canonical.y+.5-ne[1];return Pe*Pe+Ne*Ne<Ce})}return _}coveringTiles(t){let r=this.coveringZoomLevel(t);const d=r,_=this.elevation&&this.elevation.exaggeration(),b=_&&!t.isTerrainDEM,E=this.projection.name==="mercator";if(t.minzoom!==void 0&&r<t.minzoom)return[];t.maxzoom!==void 0&&r>t.maxzoom&&(r=t.maxzoom);const D=this.locationCoordinate(this.center),U=this.center.lat,Z=1<<r,ie=[Z*D.x,Z*D.y,0],de=this.projection.name==="globe",ne=!de,me=a.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,ne),Ce=de?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Me=Z*a.c6(1,this.center.lat),Pe=this._camera.position[2]/a.c6(1,this.center.lat),Ne=[Z*Ce.x,Z*Ce.y,Pe*(ne?1:Me)],He=de||_,lt=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ut=this.isLODDisabled(!0)?r:0;let kt;if(this._elevation&&t.isTerrainDEM)kt=1e4*this._elevation.exaggeration();else if(this._elevation){const Ft=this._elevation.getMinMaxForVisibleTiles();kt=Ft?Ft.max:this._centerAltitude}else kt=this._centerAltitude;const wt=t.isTerrainDEM?-kt:this._elevation?this._elevation.getMinElevationBelowMSL():0,xt=this.projection.isReprojectedInTileSpace?a.co(this):1,pt=Ft=>{const ai=new a.ac(Ft.x+25e-6,Ft.y,Ft.z),Di=new a.ac(Ft.x,Ft.y+25e-6,Ft.z),Yi=Ft.toLngLat(),Mi=ai.toLngLat(),qi=Di.toLngLat(),_s=this.locationCoordinate(Yi),Ts=this.locationCoordinate(Mi),us=this.locationCoordinate(qi),Os=Math.hypot(Ts.x-_s.x,Ts.y-_s.y),Rs=Math.hypot(us.x-_s.x,us.y-_s.y);return Math.sqrt(Os*Rs)*xt/25e-6},At=Ft=>{const Ai=kt,ai=wt;return{aabb:a.cr(this,Z,0,0,0,Ft,ai,Ai,this.projection),zoom:0,x:0,y:0,minZ:ai,maxZ:Ai,wrap:Ft,fullyVisible:!1}},Ct=[];let ti=[];const si=r,wi=t.reparseOverscaled?d:r,_i=(Pe-this._centerAltitude)*Me,Bi=Ft=>{if(!this._elevation||!Ft.tileID||!E)return;const Ai=this._elevation.getMinMaxForTile(Ft.tileID),ai=Ft.aabb;Ai?(ai.min[2]=Ai.min,ai.max[2]=Ai.max,ai.center[2]=(ai.min[2]+ai.max[2])/2):(Ft.shouldSplit=ui(Ft),Ft.shouldSplit||(ai.min[2]=ai.max[2]=ai.center[2]=this._centerAltitude))},Kt=(Ft,Ai)=>{if(.707*Ai<Ft)return 1;const ai=Ai/Ft;return ai/(1.4144271570014144+(Math.pow(1.1,ai-1.4144271570014144+1)-1)/(1.1-1)-1)},ui=Ft=>{if(Ft.zoom<ut)return!0;if(Ft.zoom===si)return!1;if(Ft.shouldSplit!=null)return Ft.shouldSplit;const Ai=Ft.aabb.distanceX(Ne),ai=Ft.aabb.distanceY(Ne);let Di=_i,Yi=1;if(de){Di=Ft.aabb.distanceZ(Ne);const Rs=Math.pow(2,Ft.zoom),Js=a.aY((Ft.y+1)/Rs),ur=a.aY(Ft.y/Rs),Pr=Math.min(Math.max(U,Js),ur),Bo=a.cO(Pr)/a.cO(U);if(Yi=Pr===U?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Bo/this._mercatorScaleRatio),this.zoom<=a.cL&&Ft.zoom===si-1&&Bo>=.9)return!0}else if(b&&(Di=Ft.aabb.distanceZ(Ne)*Me),this.projection.isReprojectedInTileSpace&&d<=5){const Rs=Math.pow(2,Ft.zoom),Js=pt(new a.ac((Ft.x+.5)/Rs,(Ft.y+.5)/Rs));Yi=Js>.85?1:Js}if(!E){const Rs=Math.sqrt(Ai*Ai+ai*ai+Di*Di);let Js=(1<<si-Ft.zoom)*lt*Yi;return Js*=Kt(Math.max(Di,_i),Rs),Rs<Js}let Mi=Number.MAX_VALUE,qi=0;const _s=Ft.aabb.getCorners(),Ts=[];for(const Rs of _s){a.at(Ts,Rs,Ne),de||(b?Ts[2]*=Me:Ts[2]=_i);const Js=a.bG(Ts,this._camera.forward());Js<Mi&&(Mi=Js,qi=Math.abs(Ts[2]))}let us=(1<<si-Ft.zoom)*lt*Yi;if(us*=Kt(Math.max(qi,_i),Mi),Mi<us)return!0;const Os=Ft.aabb.closestPoint(ie);return Os[0]===ie[0]&&Os[1]===ie[1]};if(this.renderWorldCopies)for(let Ft=1;Ft<=3;Ft++)Ct.push(At(-Ft)),Ct.push(At(Ft));for(Ct.push(At(0));Ct.length>0;){const Ft=Ct.pop(),Ai=Ft.x,ai=Ft.y;let Di=Ft.fullyVisible;const Yi=()=>this.projection.name==="globe"&&(Ft.y===0||Ft.y===(1<<Ft.zoom)-1);if(!Di){let Mi=He?Ft.aabb.intersects(me):Ft.aabb.intersectsFlat(me);if(Mi===0&&Yi()){const qi=new a.cp(Ft.zoom,Ai,ai);Mi=a.cq(this,Z,qi,!0).intersects(me)}if(Mi===0)continue;Di=Mi===2}if(Ft.zoom!==si&&ui(Ft))for(let Mi=0;Mi<4;Mi++){const qi=(Ai<<1)+Mi%2,_s=(ai<<1)+(Mi>>1),Ts={aabb:E?Ft.aabb.quadrant(Mi):a.cr(this,Z,Ft.zoom+1,qi,_s,Ft.wrap,Ft.minZ,Ft.maxZ,this.projection),zoom:Ft.zoom+1,x:qi,y:_s,wrap:Ft.wrap,fullyVisible:Di,tileID:void 0,shouldSplit:void 0,minZ:Ft.minZ,maxZ:Ft.maxZ};b&&!de&&(Ts.tileID=new a.aM(Ft.zoom+1===si?wi:Ft.zoom+1,Ft.wrap,Ft.zoom+1,qi,_s),Bi(Ts)),Ct.push(Ts)}else{const Mi=Ft.zoom===si?wi:Ft.zoom;if(t.minzoom&&t.minzoom>Mi)continue;let qi=0;if(!Di){let Os=He?Ft.aabb.intersectsPrecise(me):Ft.aabb.intersectsPreciseFlat(me);if(Os===0&&Yi()){const Rs=new a.cp(Ft.zoom,Ai,ai);Os=a.cq(this,Z,Rs,!0).intersectsPrecise(me)}if(Os===0)continue;if(t.calculateQuadrantVisibility)if(me.containsPoint(Ft.aabb.center))qi=15;else for(let Rs=0;Rs<4;Rs++)Ft.aabb.quadrant(Rs).intersects(me)!==0&&(qi|=1<<Rs)}const _s=ie[0]-(.5+Ai+(Ft.wrap<<Ft.zoom))*(1<<r-Ft.zoom),Ts=ie[1]-.5-ai,us=Ft.tileID?Ft.tileID:new a.aM(Mi,Ft.wrap,Ft.zoom,Ai,ai);t.calculateQuadrantVisibility&&(us.visibleQuadrants=qi),ti.push({tileID:us,distanceSq:_s*_s+Ts*Ts})}}if(this.fogCullDistSq){const Ft=this.fogCullDistSq,Ai=this.horizonLineFromTop();ti=ti.filter(ai=>{const Di=[0,0,0,1],Yi=[a.aj,a.aj,0,1],Mi=this.calculateFogTileMatrix(ai.tileID.toUnwrapped());a.aA(Di,Di,Mi),a.aA(Yi,Yi,Mi);const qi=a.cs([],Di,Yi),_s=a.ct([],Di,Yi),Ts=a.cM(qi,_s);if(Ts===0)return!0;let us=!1;const Os=this._elevation;if(Os&&Ts>Ft&&Ai!==0){const Rs=this.calculateProjMatrix(ai.tileID.toUnwrapped());let Js;t.isTerrainDEM||(Js=Os.getMinMaxForTile(ai.tileID)),Js||(Js={min:wt,max:kt});const ur=a.cu(this.rotation),Pr=[ur[0]*a.aj,ur[1]*a.aj,Js.max];a.ad(Pr,Pr,Rs),us=(1-Pr[1])*this.height*.5<Ai}return Ts<Ft||us})}return ti.sort((Ft,Ai)=>Ft.distanceSq-Ai.distanceSq).map(Ft=>Ft.tileID)}resize(t,r){this.width=t,this.height=r,this.pixelsToGLUnits=[2/t,-2/r],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const r=a.ay(t.lat,-85.051129,a.cv),d=this.projection.project(t.lng,r);return new a.P(d.x*this.worldSize,d.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/a.c6(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,r){let d,_;const b=this.centerPoint;if(this.projection.name==="globe"){const D=this.worldSize;d=(r.x-b.x)/D,_=(r.y-b.y)/D}else{const D=this.pointCoordinate(r),U=this.pointCoordinate(b);d=D.x-U.x,_=D.y-U.y}const E=this.locationCoordinate(t);this.setLocation(new a.ac(E.x-d,E.y-_))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,r){return this.projection.locationPoint(this,t,r)}locationPoint3D(t,r){return this.projection.locationPoint(this,t,r,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,r){return this.coordinateLocation(this.pointCoordinate3D(t,r))}locationCoordinate(t,r){const d=r?a.c6(r,t.lat):void 0,_=this.projection.project(t.lng,t.lat);return new a.ac(_.x,_.y,d)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,r){const d=r??this._centerAltitude,_=[t.x,t.y,0,1],b=[t.x,t.y,1,1];a.aA(_,_,this.pixelMatrixInverse),a.aA(b,b,this.pixelMatrixInverse);const E=b[3];a.cw(_,_,1/_[3]),a.cw(b,b,1/E);const D=_[2],U=b[2];return{p0:_,p1:b,t:D===U?0:(d-D)/(U-D)}}screenPointToMercatorRay(t){const r=[t.x,t.y,0,1],d=[t.x,t.y,1,1];return a.aA(r,r,this.pixelMatrixInverse),a.aA(d,d,this.pixelMatrixInverse),a.cw(r,r,1/r[3]),a.cw(d,d,1/d[3]),r[2]=a.c6(r[2],this._center.lat)*this.worldSize,d[2]=a.c6(d[2],this._center.lat)*this.worldSize,a.cw(r,r,1/this.worldSize),a.cw(d,d,1/this.worldSize),new a.av([r[0],r[1],r[2]],a.au([],a.at([],d,r)))}rayIntersectionCoordinate(t){const{p0:r,p1:d,t:_}=t,b=a.c6(r[2],this._center.lat),E=a.c6(d[2],this._center.lat);return new a.ac(a.ai(r[0],d[0],_)/this.worldSize,a.ai(r[1],d[1],_)/this.worldSize,a.ai(b,E,_))}pointCoordinate(t,r=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,r)}pointCoordinate3D(t,r){if(!this.elevation)return this.pointCoordinate(t,r);let d=this.projection.pointCoordinate3D(this,t.x,t.y);if(d)return new a.ac(d[0],d[1],d[2]);let _=0,b=this.horizonLineFromTop();if(t.y>b)return this.pointCoordinate(t,r);const E=.02*b,D=t.clone();for(let U=0;U<10&&b-_>E;U++){D.y=a.ai(_,b,.66);const Z=this.projection.pointCoordinate3D(this,D.x,D.y);Z?(b=D.y,d=Z):_=D.y}return d?new a.ac(d[0],d[1],d[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=a.cx)return!this.isPointAboveHorizon(t);const r=this.pointCoordinate(t);return r.y>=0&&r.y<=1}_coordinatePoint(t,r){const d=r&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,_=[t.x*this.worldSize,t.y*this.worldSize,d+t.toAltitude(),1];return a.aA(_,_,this.pixelMatrix),_[3]>0?new a.P(_[0]/_[3],_[1]/_[3]):new a.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:r}=this._edgeInsets,d=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,b=this.pointLocation3D(new a.P(r,t)),E=this.pointLocation3D(new a.P(_,t)),D=this.pointLocation3D(new a.P(_,d)),U=this.pointLocation3D(new a.P(r,d));let Z=Math.min(b.lng,E.lng,D.lng,U.lng),ie=Math.max(b.lng,E.lng,D.lng,U.lng),de=Math.min(b.lat,E.lat,D.lat,U.lat),ne=Math.max(b.lat,E.lat,D.lat,U.lat);const me=Math.pow(2,-this.zoom)/16*270,Ce=this.projection.name==="globe"?1:4,Me=(Pe,Ne,He,lt,ut)=>{const kt=(Pe+He)/2,wt=(Ne+lt)/2,xt=new a.P(kt,wt),{lng:pt,lat:At}=this.pointLocation3D(xt),Ct=Math.max(0,Z-pt,de-At,pt-ie,At-ne);Z=Math.min(Z,pt),ie=Math.max(ie,pt),de=Math.min(de,At),ne=Math.max(ne,At),(ut<Ce||Ct>me)&&(Me(Pe,Ne,kt,wt,ut+1),Me(kt,wt,He,lt,ut+1))};if(Me(r,t,_,t,1),Me(_,t,_,d,1),Me(_,d,r,d,1),Me(r,d,r,t,1),this.projection.name==="globe"){const[Pe,Ne]=a.cy(this);Pe?(ne=90,ie=180,Z=-180):Ne&&(de=-90,ie=180,Z=-180)}return new a.aG(new a.cd(Z,de),new a.cd(ie,ne))}_getBoundsRectangular(t,r){const{top:d,left:_}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,D=new a.P(_,d),U=new a.P(E,d),Z=new a.P(E,b),ie=new a.P(_,b);let de=this.pointCoordinate(D,t),ne=this.pointCoordinate(U,t);const me=this.pointCoordinate(Z,r),Ce=this.pointCoordinate(ie,r),Me=(Pe,Ne)=>(Ne.y-Pe.y)/(Ne.x-Pe.x);return de.y>1&&ne.y>=0?de=new a.ac((1-Ce.y)/Me(Ce,de)+Ce.x,1):de.y<0&&ne.y<=1&&(de=new a.ac(-Ce.y/Me(Ce,de)+Ce.x,0)),ne.y>1&&de.y>=0?ne=new a.ac((1-me.y)/Me(me,ne)+me.x,1):ne.y<0&&de.y<=1&&(ne=new a.ac(-me.y/Me(me,ne)+me.x,0)),new a.aG().extend(this.coordinateLocation(de)).extend(this.coordinateLocation(ne)).extend(this.coordinateLocation(Ce)).extend(this.coordinateLocation(me))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const r=t.visibleDemTiles.reduce((d,_)=>{if(_.dem){const b=_.dem.tree;d.min=Math.min(d.min,b.minimums[0]),d.max=Math.max(d.max,b.maximums[0])}return d},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(r.min*t.exaggeration(),r.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const r=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,d=this.height/2-r*(1-this._horizonShift);return t?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-85.051129,this.maxLat=a.cv,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.aD(this.minLng)*this.tileSize,this.worldMaxX=a.aD(this.maxLng)*this.tileSize,this.worldMinY=a.aH(this.maxLat)*this.tileSize,this.worldMaxY=a.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,r){return this.projection.createTileMatrix(this,r,t)}calculateDistanceTileData(t){const r=t.key,d=this._distanceTileDataCache;if(d[r])return d[r];const _=t.canonical,b=1/this.height,E=this.cameraWorldSize,D=E/this.zoomScale(_.z),U=(_.x+Math.pow(2,_.z)*t.wrap)*D,Z=_.y*D,ie=this.point;ie.x*=E/this.worldSize,ie.y*=E/this.worldSize;const de=this.angle,ne=Math.sin(-de),me=-Math.cos(-de);return d[r]={bearing:[ne,me],center:[(ie.x-U)*b,(ie.y-Z)*b],scale:D/a.aj*b},d[r]}calculateFogTileMatrix(t){const r=t.key,d=this._fogTileMatrixCache;if(d[r])return d[r];const _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return a.az(_,this.worldToFogMatrix,_),d[r]=new Float32Array(_),d[r]}calculateProjMatrix(t,r=!1,d=!1){const _=t.key;let b;if(b=d?this._expandedProjMatrixCache:r?this._alignedProjMatrixCache:this._projMatrixCache,b[_])return b[_];const E=this.calculatePosMatrix(t,this.worldSize);let D;return D=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.expandedFarZProjMatrix:r?this.alignedProjMatrix:this.projMatrix,a.az(E,D,E),b[_]=new Float32Array(E),b[_]}calculatePixelsToTileUnitsMatrix(t){const r=t.tileID.key,d=this._pixelsToTileUnitsCache;if(d[r])return d[r];const _=a.cz(t,this);return d[r]=_,d[r]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,r=a.bn([],[t,t,t]);return a.az(r,r,this.globeMatrix),r}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const r=a.c6(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(r),_=this._camera.forward(),b=a.c6(1,this._center.lat);d[2]/=b,_[2]/=b,a.au(_,_);const E=t.raycast(d,_,t.exaggeration());if(E){const D=a.bE([],d,_,E),U=new a.ac(D[0],D[1],a.c6(D[2],a.aY(D[1]))),Z=(U.z+a.ae([U.x-d[0],U.y-d[1],U.z-d[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(Z),this._centerAltitude=U.toAltitude(),this._center=this.coordinateLocation(U),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const r=this._elevation,d=a.c6(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(d),b=r.getAtPointOrZero(new a.ac(..._)),E=this.pixelsPerMeter/this.worldSize*b,D=this._minimumHeightOverTerrain(),U=_[2]-E;if(U<=D)if(U<0||t){const Z=this.locationCoordinate(this._center,this._centerAltitude),ie=[_[0],_[1],Z.z-_[2]],de=a.ae(ie);ie[2]-=(D-U)/this._pixelsPerMercatorPixel;const ne=a.ae(ie);if(ne===0)return;a.bY(ie,ie,de/ne*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],Z.z*this._pixelsPerMercatorPixel-ie[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const ne=this.center;return ne.lat=a.ay(ne.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(ne.lng=a.ay(ne.lng,this.minLng,this.maxLng)),this.center=ne,void(this._constraining=!1)}const r=this._unmodified,{x:d,y:_}=this.point;let b=0,E=d,D=_;const U=this.width/2,Z=this.height/2,ie=this.worldMinY*this.scale,de=this.worldMaxY*this.scale;if(_-Z<ie&&(D=ie+Z),_+Z>de&&(D=de-Z),de-ie<this.height&&(b=Math.max(b,this.height/(de-ie)),D=(de+ie)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const ne=this.worldMinX*this.scale,me=this.worldMaxX*this.scale,Ce=this.worldSize/2-(ne+me)/2;E=(d+Ce+this.worldSize)%this.worldSize-Ce,E-U<ne&&(E=ne+U),E+U>me&&(E=me-U),me-ne<this.width&&(b=Math.max(b,this.width/(me-ne)),E=(me+ne)/2)}E===d&&D===_||this._allowWorldUnderZoom||(this.center=this.unproject(new a.P(E,D))),b&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=r,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,r=this.projection.name==="globe",d=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=a.c6(1,this.center.lat)/a.c6(1,a.cP));const _=a.cA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b=this.projection.zAxisUnit==="meters"?d:1,E=this._camera.getWorldToCamera(this.worldSize,b);let D;const U=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(U[8]=2*-t.x/this.width,U[9]=2*t.y/this.height,this.isOrthographic){let At=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ct=At*this.aspect,ti=-Ct,si=-At;Ct-=t.x,ti-=t.x,At+=t.y,si+=t.y,D=this._camera.getCameraToClipOrthographic(ti,Ct,si,At,this._nearZ,this._farZ),((wi,_i,Bi,Kt)=>{for(let ui=0;ui<16;ui++)wi[ui]=a.ai(_i[ui],Bi[ui],Kt)})(D,D,U,a.cN(this.pitch>=Aa?1:this.pitch/Aa))}else D=U;const Z=a.cB([],U,E);let ie=a.cB([],D,E);if(this.projection.isReprojectedInTileSpace){const At=this.locationCoordinate(this.center),Ct=a.bx([]);a.bo(Ct,Ct,[At.x*this.worldSize,At.y*this.worldSize,0]),a.az(Ct,Ct,a.cC(this)),a.bo(Ct,Ct,[-At.x*this.worldSize,-At.y*this.worldSize,0]),a.az(ie,ie,Ct),a.az(Z,Z,Ct),this.inverseAdjustmentMatrix=a.cD(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=a.cE([],ie,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=ie,this.invProjMatrix=a.bi(new Float64Array(16),this.projMatrix),r){const At=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);At[8]=2*-t.x/this.width,At[9]=2*t.y/this.height,this.expandedFarZProjMatrix=a.cB([],At,E)}else this.expandedFarZProjMatrix=this.projMatrix;const de=a.bi([],D);this.frustumCorners=a.cF.fromInvProjectionMatrix(de,this.horizonLineFromTop(),this.height),this.cameraFrustum=a.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!r);const ne=new Float32Array(16);a.bx(ne),a.cE(ne,ne,[1,-1,1]),a.cG(ne,ne,this._pitch),a.by(ne,ne,this.angle);const me=a.c4(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=a.bw(me);const Ce=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;me[8]=2*-t.x/this.width,me[9]=2*(t.y+Ce)/this.height,this.skyboxMatrix=a.az(ne,me,ne);const Me=this.point,Pe=Me.x,Ne=Me.y,He=this.width%2/2,lt=this.height%2/2,ut=Math.cos(this.angle),kt=Math.sin(this.angle),wt=Pe-Math.round(Pe)+ut*He+kt*lt,xt=Ne-Math.round(Ne)+ut*lt+kt*He,pt=new Float64Array(ie);if(a.bo(pt,pt,[wt>.5?wt-1:wt,xt>.5?xt-1:xt,0]),this.alignedProjMatrix=pt,ie=a.bz(),a.cE(ie,ie,[this.width/2,-this.height/2,1]),a.bo(ie,ie,[1,-1,0]),this.labelPlaneMatrix=ie,ie=a.bz(),a.cE(ie,ie,[1,-1,1]),a.bo(ie,ie,[-1,-1,0]),a.cE(ie,ie,[2/this.width,2/this.height,1]),this.glCoordMatrix=ie,this.pixelMatrix=a.az(new Float64Array(16),this.labelPlaneMatrix,Z),this._calcFogMatrices(),this._distanceTileDataCache={},ie=a.bi(new Float64Array(16),this.pixelMatrix),!ie)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=ie,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=a.cH(this);const At=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.ad(At,At,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=ie;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,r=this.cameraPixelsPerMeter,d=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,b=[t,t,r];a.bY(b,b,_),a.bY(d,d,-1),a.cI(d,d,b);const E=a.bz();a.bo(E,E,d),a.cE(E,E,b),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,r,_)}_computeCameraPosition(t){const r=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),_=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*r-t/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-d[0]*b,_.y/this.worldSize-d[1]*b,t/this.worldSize*this._centerAltitude-d[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const r=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=this._camera.position[2],_=t[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(b=Math.min((r-d)/_,1)),this._camera.position=a.bE([],this._camera.position,t,b),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,r=this._camera.forward(),{pitch:d,bearing:_}=this._camera.getPitchBearing(),b=a.c6(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.al(this._maxPitch)),D=Math.max((t[2]-b)/Math.cos(d),E),U=this._zoomFromMercatorZ(D);a.bE(t,t,r,D),this._pitch=a.ay(d,a.al(this.minPitch),a.al(this.maxPitch)),this.angle=a.bX(_,-Math.PI,Math.PI),this._setZoom(a.ay(U,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a.ac(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let r=0,d=a.cx,_=0,b=1/0;for(;d-r>1e-6&&d>r;){const E=r+.5*(d-r),D=this.tileSize*Math.pow(2,E),U=this.getCameraToCenterDistance(this.projection,E,D),Z=this.scaleZoom(U/(Math.max(0,t)*this.tileSize)),ie=Math.abs(E-Z);ie<b&&(b=ie,_=E),E<Z?r=E:d=E}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,r){const d=Math.min(t.x,r.x),_=Math.max(t.x,r.x),b=Math.min(t.y,r.y),E=Math.max(t.y,r.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const D=[new a.P(d,b),new a.P(_,E),new a.P(d,E),new a.P(_,b)],U=this.renderWorldCopies?-3:0,Z=this.renderWorldCopies?4:1;for(const ie of D){const de=this.pointRayIntersection(ie);if(de.t<0)return!0;const ne=this.rayIntersectionCoordinate(de);if(ne.x<U||ne.y<0||ne.x>Z||ne.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.cJ(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.P(0,0),new a.P(this.width,this.height))}zoomDeltaToMovement(t,r){const d=a.ae(a.at([],this._camera.position,t)),_=this._zoomFromMercatorZ(d)+r;return d-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([r,d,_],b){const E=[r,d,_,1];a.aA(E,E,b);const D=E[3]=Math.max(E[3],1e-6);return E[0]/=D,E[1]/=D,E[2]/=D,E}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,t))}}getCameraToCenterDistance(t,r=this.zoom,d=this.worldSize){const _=a.cA(t,r,this.width,this.height,1024),b=t.pixelSpaceConversion(this.center.lat,d,_);let E=.5/Math.tan(.5*this._fov)*this.height*b;return this.isOrthographic&&(E=a.ai(1,E,a.cN(this.pitch>=Aa?1:this.pitch/Aa))),E}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&a.az(t,t,this.globeMatrix),t}getFrustum(t){return a.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const eh=(c,t)=>{if(t>0&&c.terrain&&a.w("Cutoff is currently disabled on terrain"),t<=0||c.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const r=c.transform,d=Math.max(Math.abs(r._zoom-(c.minCutoffZoom-1)),1),_=r.isLODDisabled(!1)?a.af(60,45,r.pitch):a.af(30,15,r.pitch),b=r._farZ-r._nearZ,E=t*r.height,D=((1-(U=_))*r.cameraToCenterDistance+U*(r._farZ+E))*d;var U;return{shouldRenderCutoff:_<1,uniformValues:{u_cutoff_params:[r._nearZ,r._farZ,(D-r._nearZ)/b,(D-E-r._nearZ)/b]}}},zl={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class hh{constructor(t,r){this.aabb=t,this.lastCascade=r}}class uf{add(t,r){const d=this.receivers[t.key];d!==void 0?(d.aabb.min[0]=Math.min(d.aabb.min[0],r.min[0]),d.aabb.min[1]=Math.min(d.aabb.min[1],r.min[1]),d.aabb.min[2]=Math.min(d.aabb.min[2],r.min[2]),d.aabb.max[0]=Math.max(d.aabb.max[0],r.max[0]),d.aabb.max[1]=Math.max(d.aabb.max[1],r.max[1]),d.aabb.max[2]=Math.max(d.aabb.max[2],r.max[2])):this.receivers[t.key]=new hh(r,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,r,d){const _=a.cW.fromPoints(t.points);let b=0;for(const E in this.receivers){const D=this.receivers[E];if(!D||!_.intersectsAabb(D.aabb))continue;D.aabb.min=_.closestPoint(D.aabb.min),D.aabb.max=_.closestPoint(D.aabb.max);const U=D.aabb.getCorners();for(let Z=0;Z<d.length;Z++){let ie=!0;for(const de of U){const ne=[de[0]*r,de[1]*r,de[2]];if(a.ad(ne,ne,d[Z].matrix),ne[0]<-1||ne[0]>1||ne[1]<-1||ne[1]>1){ie=!1;break}}if(D.lastCascade=Z,b=Math.max(b,Z),ie)break}}return b+1}}class Qd{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new uf,this._depthMode=new cs(t.context.gl.LEQUAL,cs.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(zl,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(zl,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(zl,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,r){const d=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!r||!r.properties)return;const _=r.properties.get("shadow-intensity");if(!r.shadowsEnabled()||_<=0||(this._shadowLayerCount=d.style.order.reduce((Ce,Me)=>{const Pe=d.style._mergedLayers[Me];return Ce+(Pe.hasShadowPass()&&!Pe.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const b=d.context,E=zl.shadowMapResolution,D=zl.shadowMapResolution;if(this._cascades.length===0||zl.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Ce=0;Ce<zl.cascadeCount;++Ce){const Me=d._shadowMapDebug,Pe=b.gl,Ne=b.createFramebuffer(E,D,Me,"texture"),He=new a.T(b,{width:E,height:D,data:null},Pe.DEPTH_COMPONENT16);if(Ne.depthAttachment.set(He.texture),Me){const lt=new a.T(b,{width:E,height:D,data:null},Pe.RGBA8);Ne.colorAttachment.set(lt.texture)}this._cascades.push({framebuffer:Ne,texture:He,matrix:[],far:0,boundingSphereRadius:0,frustum:new a.cn,scale:0})}}this.shadowDirection=yc(r);let U=0;if(t.elevation){const Ce=t.elevation,Me=[1e4,-1e4];Ce.visibleDemTiles.filter(Pe=>Pe.dem).forEach(Pe=>{const Ne=Pe.dem.tree;Me[0]=Math.min(Me[0],Ne.minimums[0]),Me[1]=Math.max(Me[1],Ne.maximums[0])}),Me[0]!==1e4&&(U=(Me[1]-Me[0])*Ce.exaggeration())}const Z=1.5*t.cameraToCenterDistance,ie=3*Z,de=new Float64Array(16);for(let Ce=0;Ce<this._cascades.length;++Ce){const Me=this._cascades[Ce];let Pe=t.height/50,Ne=1;zl.cascadeCount===1?Ne=ie:Ce===0?Ne=Z:(Pe=Z,Ne=ie);const[He,lt]=xc(t,this.shadowDirection,Pe,Ne,zl.shadowMapResolution,U);Me.scale=t.scale,Me.matrix=He,Me.boundingSphereRadius=lt,a.bi(de,Me.matrix),Me.frustum=a.cn.fromInvProjectionMatrix(de,1,0,!0),Me.far=Ne}const ne=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[ne].far,this._cascades[ne].far],this._uniformValues.u_shadow_intensity=_,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/zl.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=zl.shadowMapResolution,this._uniformValues.u_shadowmap_0=Qa.ShadowMap0,this._uniformValues.u_shadowmap_1=Qa.ShadowMap0+1,this._groundShadowTiles=d.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const me=d.transform.elevation;for(const Ce of this._groundShadowTiles){let Me={min:0,max:0};if(me){const Pe=me.getMinMaxForTile(Ce);Pe&&(Me=Pe)}this.addShadowReceiver(Ce.toUnwrapped(),Me.min,Me.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,r){if(!this.enabled)return;const d=this.painter,_=d.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(d.transform.getFrustum(0),d.transform.worldSize,this._cascades),_.viewport.set([0,0,zl.shadowMapResolution,zl.shadowMapResolution]);for(let b=0;b<this._numCascadesToRender;++b){d.currentShadowCascade=b,_.bindFramebuffer.set(this._cascades[b].framebuffer.framebuffer),_.clear({color:a.am.white,depth:1});for(const E of t.order){const D=t._mergedLayers[E];if(!D.hasShadowPass()||D.isHidden(d.transform.zoom))continue;const U=t.getLayerSourceCache(D),Z=U?r[U.id]:void 0;(D.type==="model"||Z&&Z.length)&&d.renderLayer(d,U,D,Z)}}d.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,r=t.style,d=t.context,_=d.gl,b=r.directionalLight,E=r.ambientLight;if(!b||!E)return;const D=[],U=eh(t,t.longestCutoffRange);U.shouldRenderCutoff&&D.push("RENDER_CUTOFF"),D.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&D.push("NORMAL_OFFSET");const Z=kd(r,b,E),ie=new cs(_.LEQUAL,cs.ReadOnly,t.depthRangeFor3D),de=new hr({func:_.EQUAL,mask:255},0,255,_.KEEP,_.KEEP,_.KEEP);for(const ne of this._groundShadowTiles){const me=ne.toUnwrapped(),Ce=t.isTileAffectedByFog(ne),Me=t.getOrCreateProgram("groundShadow",{defines:D,overrideFog:Ce});this.setupShadows(me,Me),t.uploadCommonUniforms(d,Me,me,null,U);const Pe={u_matrix:t.transform.calculateProjMatrix(me),u_ground_shadow_factor:Z};Me.draw(t,_.TRIANGLES,ie,de,Fr.multiply,Zs.disabled,Pe,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Fr.unblended:Fr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const r=this.painter.transform,d=r.calculatePosMatrix(t,r.worldSize);return a.az(d,this._cascades[this.painter.currentShadowCascade].matrix,d),Float32Array.from(d)}calculateShadowPassMatrixFromMatrix(t){return a.az(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,r,d,_=0){if(!this.enabled)return;const b=this.painter.transform,E=this.painter.context,D=E.gl,U=this._uniformValues,Z=new Float64Array(16),ie=b.calculatePosMatrix(t,b.worldSize);for(let de=0;de<this._cascades.length;de++)a.az(Z,this._cascades[de].matrix,ie),U[de===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(Z),E.activeTexture.set(D.TEXTURE0+Qa.ShadowMap0+de),this._cascades[de].texture.bindExtraParam(D.LINEAR,D.LINEAR,D.CLAMP_TO_EDGE,D.CLAMP_TO_EDGE,D.GREATER);if(this.useNormalOffset=!!d,this.useNormalOffset){const de=a.cU(t.canonical),ne=2/b.tileSize*a.aj/zl.shadowMapResolution,me=ne*this._cascades[0].boundingSphereRadius,Ce=ne*this._cascades[this._cascades.length-1].boundingSphereRadius,Me=(d==="vector-tile"?1:3)/Math.pow(2,_-t.canonical.z-(1-b.zoom+Math.floor(b.zoom)));U.u_shadow_normal_offset=[de,me*Me,Ce*Me],U.u_shadow_bias=[6e-5,.0012,.012]}else U.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(E,U)}setupShadowsFromMatrix(t,r,d=!1){if(!this.enabled)return;const _=this.painter.context,b=_.gl,E=this._uniformValues,D=new Float64Array(16);for(let U=0;U<zl.cascadeCount;U++)a.az(D,this._cascades[U].matrix,t),E[U===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(D),_.activeTexture.set(b.TEXTURE0+Qa.ShadowMap0+U),this._cascades[U].texture.bindExtraParam(b.LINEAR,b.LINEAR,b.CLAMP_TO_EDGE,b.CLAMP_TO_EDGE,b.GREATER);if(this.useNormalOffset=d,d){const U=zl.normalOffset;E.u_shadow_normal_offset=[1,U,U],E.u_shadow_bias=[6e-5,.0012,.012]}else E.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(_,E)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,r,d,_){if(_[2]>=0)return{};const b=function(U,Z,ie){const de=ie/(1<<U.canonical.z);return new a.cW([U.canonical.x*de+U.wrap*ie,U.canonical.y*de+U.wrap*ie,0],[(U.canonical.x+1)*de+U.wrap*ie,(U.canonical.y+1)*de+U.wrap*ie,Z])}(t,r,d).getCorners(),E=r/-_[2];_[0]<0?(a.cV(b[0],b[0],[_[0]*E,0,0]),a.cV(b[3],b[3],[_[0]*E,0,0])):_[0]>0&&(a.cV(b[1],b[1],[_[0]*E,0,0]),a.cV(b[2],b[2],[_[0]*E,0,0])),_[1]<0?(a.cV(b[0],b[0],[0,_[1]*E,0]),a.cV(b[1],b[1],[0,_[1]*E,0])):_[1]>0&&(a.cV(b[2],b[2],[0,_[1]*E,0]),a.cV(b[3],b[3],[0,_[1]*E,0]));const D={};return D.vertices=b,D.planes=[eu(b[1],b[0],b[4]),eu(b[2],b[1],b[5]),eu(b[3],b[2],b[6]),eu(b[0],b[3],b[7])],D}addShadowReceiver(t,r,d){this._receivers.add(t,a.cW.fromTileIdAndHeight(t,r,d))}getMaxCascadeForTile(t){const r=this._receivers.get(t);return r&&r.lastCascade?r.lastCascade:0}}function eu(c,t,r){const d=a.at([],r,t),_=a.at([],c,t),b=a.bF([],d,_),E=a.ae(b);return E===0?[0,0,1,0]:(a.bY(b,b,1/E),[b[0],b[1],b[2],-a.bG(b,t)])}function yc(c){const t=c.properties.get("direction"),r=a.cR(t.x,t.y,t.z);r[2]=a.ay(r[2],0,75);const d=a.cT([r[0],r[1],r[2]]);return a.cS(d.x,d.y,d.z)}function kd(c,t,r){const d=t.properties.get("color-use-theme")==="none",_=t.properties.get("color"),b=t.properties.get("intensity"),E=t.properties.get("direction"),D=[E.x,E.y,E.z],U=r.properties.get("color-use-theme")==="none",Z=r.properties.get("color"),ie=r.properties.get("intensity"),de=Math.max(a.bG([0,0,1],D),0),ne=[0,0,0];a.bY(ne,Z.toPremultipliedRenderColor(U?null:c.getLut(t.scope)).toArray01Linear().slice(0,3),ie);const me=[0,0,0];return a.bY(me,_.toPremultipliedRenderColor(d?null:c.getLut(r.scope)).toArray01Linear().slice(0,3),de*b),a.cY([ne[0]>0?ne[0]/(ne[0]+me[0]):0,ne[1]>0?ne[1]/(ne[1]+me[1]):0,ne[2]>0?ne[2]/(ne[2]+me[2]):0])}function xc(c,t,r,d,_,b){const E=c.zoom,D=c.scale,U=c.worldSize,Z=1/U,ie=c.aspect,de=Math.sqrt(1+ie*ie)*Math.tan(.5*c.fovX),ne=de*de,me=d-r,Ce=d+r;let Me,Pe;ne>me/Ce?(Me=d,Pe=d*de):(Me=.5*Ce*(1+ne),Pe=.5*Math.sqrt(me*me+2*(d*d+r*r)*ne+Ce*Ce*ne*ne));const Ne=c.projection.pixelsPerMeter(c.center.lat,U),He=c._camera.getCameraToWorldMercator(),lt=[0,0,-Me*Z];a.ad(lt,lt,He);let ut=Pe*Z;const kt=c._edgeInsets;if(!(kt.left===0&&kt.top===0&&kt.right===0&&kt.bottom===0||kt.left===kt.right&&kt.top===kt.bottom)){const Di=c._camera.getWorldToCamera(c.worldSize,c.projection.zAxisUnit==="meters"?Ne:1),Yi=c._camera.getCameraToClipPerspective(c._fov,c.width/c.height,r,d);Yi[8]=2*-c.centerOffset.x/c.width,Yi[9]=2*c.centerOffset.y/c.height;const Mi=new Float64Array(16);a.cB(Mi,Yi,Di);const qi=new Float64Array(16);a.bi(qi,Mi);const _s=a.cn.fromInvProjectionMatrix(qi,U,E,!0);for(const Ts of _s.points){const us=((wt=Ts)[0]/=D,wt[1]/=D,wt[2]=a.c6(wt[2],c._center.lat),wt);ut=Math.max(ut,a.bZ(a.cX([],lt,us)))}}var wt;ut*=_/(_-1);const xt=Math.acos(t[2]),pt=Math.atan2(-t[0],-t[1]),At=new tc;At.position=lt,At.setPitchBearing(xt,pt);const Ct=At.getWorldToCamera(U,Ne),ti=ut*U,si=Math.min(c._mercatorZfromZoom(17)*U*-2,-2*ti),wi=At.getCameraToClipOrthographic(-ti,ti,-ti,ti,si,(ti+b*Ne)/t[2]),_i=new Float64Array(16);a.az(_i,wi,Ct);const Bi=a.cS(Math.floor(1e6*lt[0])/1e6*U,Math.floor(1e6*lt[1])/1e6*U,0),Kt=.5*_,ui=[0,0,0];a.ad(ui,Bi,_i),a.bY(ui,ui,Kt);const Ft=[Math.floor(ui[0]),Math.floor(ui[1]),Math.floor(ui[2])],Ai=[0,0,0];a.at(Ai,ui,Ft),a.bY(Ai,Ai,-1/Kt);const ai=new Float64Array(16);return a.bx(ai),a.bo(ai,ai,Ai),a.az(_i,ai,_i),[_i,ti]}class Xf extends a.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,r){return a.aS(this.requestManager.transformRequest(r,a.R.Model).url).then(d=>{if(!d)return;const _=a.aT(d),b=new a.aU(t,void 0,void 0,_);return b.computeBoundsAndApplyParent(),b}).catch(d=>{if(d&&d.status===404)return null;this.fire(new a.z(new Error(`Could not load model ${t} from ${r}: ${d.message}`)))})}load(t,r,d={forceReload:!1}){this.models[r]||(this.models[r]={});const _=Object.keys(t),b=[],E=[];for(const D of _){const U=t[D];this.hasURLBeenRequested(U)&&!d.forceReload||(this.modelByURL[U]={modelId:D,scope:r},b.push(this.loadModel(D,U)),E.push(D)),this.models[r][D]||(this.models[r][D]={model:null,numReferences:1})}this.numModelsLoading[r]=(this.numModelsLoading[r]||0)+E.length,Promise.allSettled(b).then(D=>{for(let U=0;U<D.length;U++){const{status:Z}=D[U];if(Z==="rejected")continue;const{value:ie}=D[U];this.models[r][E[U]]||(this.models[r][E[U]]={model:null,numReferences:1}),this.models[r][E[U]].model=ie}this.numModelsLoading[r]-=E.length,this.fire(new a.A("data",{dataType:"style"}))}).catch(D=>{this.fire(new a.z(new Error(`Could not load models: ${D.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,r,d={exactIdMatch:!1}){return!!(d.exactIdMatch?this.getModel(t,r):this.getModelByURL(this.modelUris[r][t]))}getModel(t,r){return this.models[r]||(this.models[r]={}),this.models[r][t]?this.models[r][t].model:void 0}getModelByURL(t){if(!t)return null;const r=this.modelByURL[t];return r?this.models[r.scope][r.modelId].model:null}hasModelBeenAdded(t,r){return this.models[r]&&this.models[r][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,r,d){this.models[d]||(this.models[d]={}),this.modelUris[d]||(this.modelUris[d]={});const _=this.requestManager.normalizeModelURL(r);if((this.hasModel(t,d,{exactIdMatch:!0})||this.hasModelBeenAdded(t,d))&&this.modelUris[d][t]===_)this.models[d][t].numReferences++;else if(this.hasURLBeenRequested(_)){const{scope:b,modelId:E}=this.modelByURL[_];this.models[b][E].numReferences++}else this.modelUris[d][t]=_,this.load({[t]:this.modelUris[d][t]},d)}addModelURLs(t,r){this.models[r]||(this.models[r]={}),this.modelUris[r]||(this.modelUris[r]={});const d=this.modelUris[r];for(const _ in t)d[_]=this.requestManager.normalizeModelURL(t[_])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,r){this.models[r]||(this.models[r]={}),this.modelUris[r]||(this.modelUris[r]={});const d={};for(const _ of t)this.hasModel(_,r,{exactIdMatch:!0})||this.hasURLBeenRequested(_)?this.models[r][_].numReferences++:this.modelUris[r][_]&&!this.hasURLBeenRequested(_)?d[_]=this.modelUris[r][_]:!this.hasURLBeenRequested(_)&&a.cZ(_,!1)&&(this.modelUris[r][_]=this.requestManager.normalizeModelURL(_),d[_]=this.modelUris[r][_]);this.load(d,r)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,r,d=!1){if(this.models[r]&&this.models[r][t]&&(this.models[r][t].numReferences--,this.models[r][t].numReferences===0)){const _=this.modelUris[r][t];d||delete this.modelUris[r][t],delete this.modelByURL[_];const b=this.models[r][t].model;if(!b)return;delete this.models[r][t],b.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const r of Object.keys(this.models[t])){const d=this.models[t][r].model;delete this.models[t][r],d&&d.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,r){this.models[r]||(this.models[r]={});for(const d in this.models[r])this.models[r][d].model&&this.models[r][d].model.upload(t.context)}}const Bc=new a.a7({data:new a.a8(a.a5.colorTheme.data)}),Am={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function Fc(c){return c=c||{},Object.assign(c,Am)}class Eu extends a.E{constructor(t){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._floorplanStates={},a.aV(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=t,this._checkFloorplanVisible(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new a.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=t.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=t.stylesheet.indoor.buildingFeaturesetId,this._scope=t.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:t=>(t.feature&&t.feature.properties.floorplan&&this.selectFloorplan(t.feature.properties.floorplan),!0)}),this._checkFloorplanVisible()}_onMove(){this._checkFloorplanVisible()}_checkFloorplanVisible(){if(!this._queryFeatureSetId||!this._map.isStyleLoaded())return;const t=()=>{this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new a.A("floorplangone"))};if(this._map.transform.zoom<13)return void t();const r={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},d=this._map.transform.width,_=this._map.transform.height,b=d*(2/3),E=_*(2/3),D=.5*(d-b),U=.5*(_-E),Z=[new a.P(D,U),new a.P(D+b,U+E)],ie=this._map.queryRenderedFeatures(Z,r);ie.length>0?this._selectedFloorplan&&ie[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=ie[0],this._floorplanSelected()):t()}_floorplanSelected(){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._floorplanStates[this._indoorData.id]=this._floorplanStates[this._indoorData.id]||{},this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[this._indoorData.id]]);const t=this._floorplanStates[this._indoorData.id].selectedBuilding,r=t?this._indoorData.buildings.find(D=>D.id===t):this._indoorData.buildings.length>0?this._indoorData.buildings[0]:null,d=this._floorplanStates[this._indoorData.id].selectedLevel,_=this._indoorData.levels.find(D=>D.id===d),b=this._indoorData.levels.find(D=>!(!r||!r.levels)&&Number(D.levelOrder)===0&&r.levels.includes(D.id)),E=_?_.id:b?b.id:void 0;this.fire(new a.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:E})),r&&this._buildingSelected(r,!1),E&&this._levelSelected(E)}_buildingSelected(t,r){if(!t||!t.id)return void console.warn("IndoorManager: Building or building id is undefined");r&&t.extent&&this._map.fitBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=t?t.id:void 0;const d=this._indoorData.levels.filter(_=>t.levels.includes(_.id));this.fire(new a.A("buildingselected",{buildingId:t.id,levels:d}))}_levelSelected(t){const r=this._indoorData.levels.find(d=>d.id===t);r?(this._updateLevels(r,!0),this.fire(new a.A("levelselected",{levelId:r.id}))):console.warn(`IndoorManager: Level with ID ${t} not found in the current floorplan.`)}_updateLevels(t,r){if(!t||!t.id)throw new Error("IndoorManager: Selected level or level ID is undefined");function d(Z){const ie=Z.indexOf("/floor/");if(ie===-1)return Z;const de=ie+7,ne=Z.indexOf("/",de);return ne===-1?Z.slice(de):Z.slice(de,ne)}this._floorplanStates[this._indoorData.id].selectedLevel=t.id;const _=[],b={},E={},D={},U={};for(const Z of this._indoorData.levels){if(_.push(Z.id),b[Z.id]=Z.levelOrder>=0?3*Math.abs(Z.levelOrder+1):3*Math.abs(Z.levelOrder),E[Z.id]=Z.levelOrder>=0?3*Z.levelOrder:0,this.mergeFloors){const ie=d(t.id),de=d(Z.id);D[Z.id]=de===ie?"true":"false"}else D[Z.id]=Z.id===t.id?"true":"false";U[Z.id]=Z.levelOrder<t.levelOrder?"true":"false"}this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",_]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",b]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",E]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",D]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",U]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",t.levelOrder<0)}selectFloorplan(t){const r={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},d=[new a.P(0,0),new a.P(this._map.transform.width,this._map.transform.height)],_=this._map.queryRenderedFeatures(d,r);if(_.length>0){for(const b of _)if(JSON.parse(b.properties["indoor-data"]).id===t){this._selectedFloorplan=b,this._floorplanSelected();break}}}selectBuilding(t){const r=this._indoorData.buildings.find(d=>d.id===t);this._buildingSelected(r,!0)}selectLevel(t){this._levelSelected(t)}}function Nc(c){if(!c.metadata||!c.metadata.content_area)return;const t=a.q.devicePixelRatio,{left:r,top:d,width:_,height:b}=c.metadata.content_area,E=r*t,D=d*t;return[E,D,E+_*t,D+b*t]}function rg(c){if(c)return c.map(([t,r])=>[t*a.q.devicePixelRatio,r*a.q.devicePixelRatio])}class Yf{constructor(t,r,d){this.id=t,this.scope=r,this.sourceCache=d,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const r=this.sourceCache.getVisibleCoordinates();if(r.length===0)return t;const d=this.sourceCache.getSource();if(!(d instanceof Xh))return t;const _=r.map(E=>this.sourceCache.getTile(E)),b=d.getImages(_,Array.from(this.pendingRequests));for(const[E,D]of b)t.set(a.I.from({name:E,iconsetId:this.id}),D),this.pendingRequests.delete(E);for(const E of this.pendingRequests)this.missingRequests.add(E);return this.pendingRequests.clear(),t}}const yp=(c,t)=>at(c,t&&t.filter(r=>r.identifier!=="source.canvas")),sc=a.aF(Gr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Ed=a.aF(Gr,["setCenter","setZoom","setBearing","setPitch"]),Up=new Set(["background","sky","slot","custom"]),$f={version:8,layers:[],sources:{}},qf={duration:300,delay:0};class Yl extends a.E{constructor(t,r={}){super(),this.map=t,this.scope=r.scope||"",this.globalId=null,this.fragments=[],this.importDepth=r.importDepth||0,this.importsCache=r.importsCache||new Map,this.resolvedImports=r.resolvedImports||new Set,this.transition=a.h({},qf),this._buildingIndex=new Xl(this),this.crossTileSymbolIndex=new cl,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=r.styleChanges||new Qs,this.dispatcher=r.dispatcher?r.dispatcher:new a.D(a.c$(),this),r.imageManager?this.imageManager=r.imageManager:(this.imageManager=new _l(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=r.glyphManager?r.glyphManager:new a.d0(t._requestManager,r.localFontFamily?a.d1.all:r.localIdeographFontFamily?a.d1.ideographs:a.d1.none,r.localFontFamily||r.localIdeographFontFamily),r.modelManager?this.modelManager=r.modelManager:(this.modelManager=new Xf(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=r.configOptions?r.configOptions:new Map,this._configDependentLayers=r.configDependentLayers?r.configDependentLayers:new Set,this._config=r.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:r.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=r.initialConfig,this.dispatcher.broadcast("setReferrer",a.d2());const d=this;this._rtlTextPluginCallback=Yl.registerForPluginStateChange(_=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(b,E)=>{if(a.d3(b),E&&E.every(D=>D))for(const D in d._sourceCaches){const U=d._sourceCaches[D],Z=U.getSource().type;Z!=="vector"&&Z!=="geojson"||U.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const b=this.getOwnSource(_.sourceId);if(b&&b.vectorLayerIds)for(const E in this._layers){const D=this._layers[E];D.source===b.id&&this._validateLayer(D)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(a.j(t))return t;const r=a.d4(t);if(!r.startsWith("http"))try{return new URL(r,location.href).toString()}catch{return r}return r}return`json://${a.d5(JSON.stringify(t))}`}_diffStyle(t,r,d){this.globalId=this._getGlobalId(t);const _=(b,E)=>{try{E(null,this.setState(b,d))}catch(D){E(D,!1)}};if(typeof t=="string"){const b=this.map._requestManager.normalizeStyleURL(t),E=this.map._requestManager.transformRequest(b,a.R.Style);a.n(E,(D,U)=>{D?this.fire(new a.z(D)):U&&_(U,r)})}else typeof t=="object"&&_(t,r)}loadURL(t,r={}){this.fire(new a.A("dataloading",{dataType:"style"}));const d=typeof r.validate=="boolean"?r.validate:!a.j(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,r.accessToken),this.resolvedImports.add(t);const _=this.importsCache.get(t);if(_)return this._load(_,d);const b=this.map._requestManager.transformRequest(t,a.R.Style);this._request=a.n(b,(E,D)=>{if(this._request=null,E)this.fire(new a.z(E));else if(D)return this.importsCache.set(t,D),this._load(D,d)})}loadJSON(t,r={}){this.fire(new a.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=a.q.frame(()=>{this._request=null,this._load(t,r.validate!==!1)})}loadEmpty(){this.fire(new a.A("dataloading",{dataType:"style"})),this._load($f,!1)}_loadImports(t,r,d){if(this.importDepth>=4)return a.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const _=[];for(const b of t){const E=this._createFragmentStyle(b),D=new Promise(ie=>{E.once("style.import.load",ie),E.once("error",ie)}).then(()=>this.mergeAll());if(_.push(D),this.resolvedImports.has(b.url)){E.loadEmpty();continue}const U=b.data||this.importsCache.get(b.url);U?(E.loadJSON(U,{validate:r}),this._isInternalStyle(U)&&(E.globalId=null)):b.url?E.loadURL(b.url,{validate:r}):E.loadEmpty();const Z={style:E,id:b.id,config:b.config};if(d){const ie=this.fragments.findIndex(({id:de})=>de===d);this.fragments=this.fragments.slice(0,ie).concat(Z).concat(this.fragments.slice(ie))}else this.fragments.push(Z)}return Promise.allSettled(_)}getImportGlobalIds(t=this,r=new Set){for(const d of t.fragments)d.style.globalId&&r.add(d.style.globalId),this.getImportGlobalIds(d.style,r);return[...r.values()]}_createFragmentStyle(t){const r=this.scope?a.C(t.id,this.scope):t.id;let d;const _=this._initialConfig&&this._initialConfig[r];(t.config||_)&&(d=a.h({},t.config,_));const b=new Yl(this.map,{scope:r,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:d,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return b.setEventedParent(this.map,{style:b}),b}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,r){const d=t.indoor?Fc(t.schema):t.schema;if(this._isInternalStyle(t)){const E=a.h({},$f,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(E,r)}if(this.updateConfig(this._config,d),r&&yp(this,Hl(t)))return;this._loaded=!0,this.stylesheet=a.d6(t);const _=()=>{for(const Z in t.sources)this.addSource(Z,t.sources[Z],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const Z in t.iconsets)this.addIconset(Z,t.iconsets[Z]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(t.glyphs);const E=Dc(this.stylesheet.layers);if(this._order=E.map(Z=>Z.id),this.stylesheet.light&&a.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const Z=this.stylesheet.lights[0];this.light=new oi(Z.properties,Z.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new oi(this.stylesheet.light)),this._layers={};for(const Z of E){const ie=a.db(Z,this.scope,this._styleColorTheme.lut,this.options);ie.configDependencies.size!==0&&this._configDependentLayers.add(ie.fqid),ie.setEventedParent(this,{layer:{id:ie.id}}),this._layers[ie.id]=ie;const de=this.getOwnLayerSourceCache(ie),ne=!!this.directionalLight&&this.directionalLight.shadowsEnabled();de&&ie.canCastShadows()&&ne&&(de.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const D=this.stylesheet.terrain;D&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(D,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new a.A("data",{dataType:"style"}));const U=this.isRootStyle();t.imports?this._loadImports(t.imports,r).then(()=>{this._reloadImports(),this.fire(new a.A(U?"style.load":"style.import.load"))}).catch(Z=>{this.fire(new a.z(new Error("Failed to load imports",Z))),this.fire(new a.A(U?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new a.A(U?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const b=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(b){const E=this._evaluateColorThemeData(b);this._loadColorTheme(E).then(()=>{_()}).catch(D=>{a.w(`Couldn't load color theme from the stylesheet: ${D}`),_()})}else this._styleColorTheme.lut=null,_()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,r,d,_,b,E,D,U,Z,ie;const de={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(ne=>{if(ne.stylesheet){if(ne.light!=null&&(t=ne.light),ne.stylesheet.lights)for(const me of ne.stylesheet.lights)me.type==="ambient"&&ne.ambientLight!=null&&(r=ne.ambientLight),me.type==="directional"&&ne.directionalLight!=null&&(d=ne.directionalLight);_=this._prioritizeTerrain(_,ne.terrain,ne.stylesheet.terrain),ne.stylesheet.fog&&ne.fog!=null&&(b=ne.fog),ne.stylesheet.snow&&ne.snow!=null&&(E=ne.snow),ne.stylesheet.rain&&ne.rain!=null&&(D=ne.rain),ne.stylesheet.camera!=null&&(ie=ne.stylesheet.camera),ne.stylesheet.projection!=null&&(U=ne.stylesheet.projection),ne.stylesheet.transition!=null&&(Z=ne.stylesheet.transition),de[ne.scope]=ne._styleColorTheme}}),this.light=t,this.ambientLight=r,this.directionalLight=d,this.fog=b,this.snow=E,this.rain=D,this._styleColorThemeForScope=de,_===null?delete this.terrain:this.terrain=_,this.camera=ie||{"camera-projection":"perspective"},this.projection=U||{name:"mercator"},this.transition=a.h({},qf,Z),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const r=d=>{for(const _ of d.fragments)r(_.style);t(d)};r(this)}_prioritizeTerrain(t,r,d){const _=t&&t.drapeRenderMode===0;return d===null?r&&r.drapeRenderMode===0?r:_?t:null:r!=null&&(!t||_||r&&r.drapeRenderMode===1)?r:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(r=>{t=this._prioritizeTerrain(t,r.terrain,r.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(r=>{r.stylesheet.projection!=null&&(t=r.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},r={},d={};this.forEachFragmentStyle(_=>{for(const b in _._sourceCaches){const E=a.C(b,_.scope);t[E]=_._sourceCaches[b]}for(const b in _._otherSourceCaches){const E=a.C(b,_.scope);r[E]=_._otherSourceCaches[b]}for(const b in _._symbolSourceCaches){const E=a.C(b,_.scope);d[E]=_._symbolSourceCaches[b]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=r,this._mergedSymbolSourceCaches=d}mergeLayers(){const t={},r=[],d={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(b=>{for(const E of b._order){const D=b._layers[E];if(D.type==="slot"){const U=a.d7(E);if(t[U])continue;t[U]=[]}D.slot&&t[D.slot]?t[D.slot].push(D):r.push(D)}}),this._mergedOrder=[];const _=(b=[])=>{for(const E of b)if(E.type==="slot"){const D=a.d7(E.id);t[D]&&_(t[D]),this._mergedSlots.push(D)}else{const D=a.C(E.id,E.scope);this._mergedOrder.push(D),d[D]=E,E.is3D(!!this.terrain)&&(this._has3DLayers=!0),E.type==="circle"&&(this._hasCircleLayers=!0),E.type==="symbol"&&(this._hasSymbolLayers=!0),E.type==="clip"&&(this._clipLayerPresent=!0)}};_(r),this._mergedOrder.sort((b,E)=>{const D=d[b],U=d[E];return D.hasInitialOcclusionOpacityProperties?U.is3D(!!this.terrain)?1:0:D.is3D(!!this.terrain)&&U.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=d,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=a.h({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(r,d,_,b){const E=a.h({},d);for(const U of Object.keys(a.a5.colorTheme))E[U]===void 0&&(E[U]=a.a5.colorTheme[U].default);const D=new a.a6(Bc,r,new Map(_));return D.setTransitionOrValue(E,_),D.untransitioned().possiblyEvaluate(new a.aa(0,{worldview:void 0}))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const r=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((d,_)=>{const b="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void d();let E=t;E.startsWith(b)||(E=b+E);const D=a.I.from("mapbox-reserved-lut"),U=new Image;U.src=E,U.onerror=()=>{this._styleColorTheme.lutLoading=!1,_(new Error("Failed to load image data"))},U.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==r)return void d();this._styleColorTheme.lutLoading=!1;const{width:Z,height:ie,data:de}=a.q.getImageData(U);if(ie>32)return void _(new Error("The height of the image must be less than or equal to 32 pixels."));if(Z!==ie*ie)return void _(new Error("The width of the image must be equal to the height squared."));this.getImage(D)&&this.removeImage(D),this.addImage(D,{data:new a.r({width:Z,height:ie},de),pixelRatio:1,sdf:!1,usvg:!1,version:0});const ne=this.imageManager.getImage(D,this.scope);ne?(this._styleColorTheme.lut={image:ne.data,data:t},d()):_(new Error("Missing LUT image."))}})}getLut(t){const r=this._styleColorThemeForScope[t];return r?r.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(r,d,_){let b,E,D;const U=a.q.devicePixelRatio>1?"@2x":"";let Z=a.n(d.transformRequest(d.normalizeSpriteURL(r,U,".json"),a.R.SpriteJSON),(ne,me)=>{Z=null,D||(D=ne,b=me,de())}),ie=a.o(d.transformRequest(d.normalizeSpriteURL(r,U,".png"),a.R.SpriteImage),(ne,me)=>{ie=null,D||(D=ne,E=me,de())});function de(){if(D)_(D);else if(b&&E){const ne=a.q.getImageData(E),me={};for(const Ce in b){const{width:Me,height:Pe,x:Ne,y:He,sdf:lt,pixelRatio:ut,stretchX:kt,stretchY:wt,content:xt}=b[Ce],pt=new a.r({width:Me,height:Pe});a.r.copy(ne,pt,{x:Ne,y:He},{x:0,y:0},{width:Me,height:Pe},null),me[Ce]={data:pt,pixelRatio:ut,sdf:lt,stretchX:kt,stretchY:wt,content:xt,usvg:!1}}_(null,me)}}return{cancel(){Z&&(Z.cancel(),Z=null),ie&&(ie.cancel(),ie=null)}}}(t,this.map._requestManager,(r,d)=>{if(this._spriteRequest=null,r)this.fire(new a.z(r));else if(d){const _=new Map;for(const b in d)_.set(a.I.from(b),d[b]);this.addImages(_)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new a.A("data",{dataType:"style"}))})}addIconset(t,r){if(r.type==="sprite")return void this._loadSprite(r.url);const d=this.getOwnSourceCache(r.source);if(!d)return void this.fire(new a.z(new Error(`Source "${r.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const _=d.getSource();if(_.type!=="raster-array")return void this.fire(new a.z(new Error(`Source "${r.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));_.partial=!1;const b=new Yf(t,this.scope,d);this.imageManager.addImageProvider(b,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!a.j(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const r=this.map._spriteFormat==="auto";var d,_;this._spriteRequest=(_=(b,E)=>{if(this._spriteRequest=null,b)r?this._loadSprite(t):this.fire(new a.z(b));else if(E){const D=new Map;for(const U in E)D.set(a.I.from(U),E[U]);this.addImages(D)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new a.A("data",{dataType:"style"}))},a.br((d=this.map._requestManager).transformRequest(d.normalizeIconsetURL(t),a.R.Iconset),(b,E)=>{if(b)return void _(b);const D={},U=a.c_(new a.bq(E));for(const Z of U.icons){const ie={version:1,pixelRatio:a.q.devicePixelRatio,content:Nc(Z),stretchX:Z.metadata?rg(Z.metadata.stretch_x_areas):void 0,stretchY:Z.metadata?rg(Z.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:Z};D[Z.name]=ie}_(null,D)}))}_validateLayer(t){const r=this.getOwnSource(t.source);if(!r)return;const d=t.sourceLayer;d&&(r.type==="geojson"||r.vectorLayerIds&&r.vectorLayerIds.indexOf(d)===-1)&&this.fire(new a.z(new Error(`Source layer "${d}" does not exist on source "${r.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,r)=>{const d=this.fragments[r];return d&&d.style&&(t.data=d.style.serialize()),t})}_serializeSources(){const t={};for(const r in this._sourceCaches){const d=this._sourceCaches[r].getSource();t[d.id]||(t[d.id]=d.serialize())}return t}_serializeLayers(t){const r=[];for(const d of t){const _=this._layers[d];_&&_.type!=="custom"&&r.push(_.serialize())}return r}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const r=this.getOwnLayer(t);if(r)return r;this.fire(new a.z(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const r=this.getOwnSource(t);if(r)return r;this.fire(new a.z(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,r){const d=this.map.painter;if(d)for(let _=t.minzoom||0;_<(t.maxzoom||25.5);_++){const b=t.getProgramIds();if(b)for(const E of b){const D=t.getDefaultProgramParams(E,r.zoom,this._styleColorTheme.lut);D&&(d.style=this,this.fog&&(d._fogVisible=!0,D.overrideFog=!0,d.getOrCreateProgram(E,D)),d._fogVisible=!1,D.overrideFog=!1,d.getOrCreateProgram(E,D),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(D.overrideRtt=!0,d.getOrCreateProgram(E,D)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const r=this.calculateLightsBrightness();t.brightness=r||0,r!==this._brightness&&(this._brightness=r,this.dispatcher.broadcast("setBrightness",r)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const d=this._changes.isDirty();let _=!1;if(this._changes.isDirty()){const D=this._changes.getLayerUpdatesByScope();for(const U in D){const{updatedIds:Z,removedIds:ie}=D[U];(Z||ie)&&(this._updateWorkerLayers(U,Z,ie),_=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const b={};for(const D in this._mergedSourceCaches){const U=this._mergedSourceCaches[D];b[D]=U.used,U.used=!1,U.tileCoverLift=0}for(const D of this._mergedOrder){const U=this._mergedLayers[D];if(U.recalculate(t,this._availableImages),!U.isHidden(t.zoom)){const Z=this.getLayerSourceCache(U);Z&&(Z.used=!0,Z.tileCoverLift=Math.max(Z.tileCoverLift,U.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(U,t)}):this.precompilePrograms(U,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&_&&this.mergeLayers();const E=this.imageManager.getPendingImageProviders();for(const D of E)D.sourceCache.used=!0;for(const D in b){const U=this._mergedSourceCaches[D];b[D]!==U.used&&U.getSource().fire(new a.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:U.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),d&&this.fire(new a.A("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const r of t){const d=r.resolvePendingRequests(),_=this.getFragmentStyle(r.scope);_&&_.addImages(d)}}_updateTilesForChangedImages(){const t={};for(const r in this._mergedSourceCaches){const d=this._mergedSourceCaches[r].getSource().scope;t[d]=t[d]||this._changes.getUpdatedImages(d),t[d].length!==0&&this._mergedSourceCaches[r].reloadTilesForDependencies(["icons","patterns"],t[d])}for(const r in t)this._changes.resetUpdatedImages(r)}_updateWorkerLayers(t,r,d){const _=this.getFragmentStyle(t);_&&this.dispatcher.broadcast("updateLayers",{layers:r?_._serializeLayers(r):[],scope:t,removedIds:d||[],options:_.options})}setState(t,r){if(this._checkLoaded(),yp(this,Hl(t)))return!1;(t=a.d6(t)).layers=Dc(t.layers);const d=function(E,D){if(!E)return[{command:Gr.setStyle,args:[D]}];let U=[];try{if(!a.bv(E.version,D.version))return[{command:Gr.setStyle,args:[D]}];if(a.bv(E.center,D.center)||U.push({command:Gr.setCenter,args:[D.center]}),a.bv(E.zoom,D.zoom)||U.push({command:Gr.setZoom,args:[D.zoom]}),a.bv(E.bearing,D.bearing)||U.push({command:Gr.setBearing,args:[D.bearing]}),a.bv(E.pitch,D.pitch)||U.push({command:Gr.setPitch,args:[D.pitch]}),a.bv(E.sprite,D.sprite)||U.push({command:Gr.setSprite,args:[D.sprite]}),a.bv(E.glyphs,D.glyphs)||U.push({command:Gr.setGlyphs,args:[D.glyphs]}),a.bv(E.imports,D.imports)||function(me=[],Ce=[],Me){Ce=Ce||[];const Pe=(me=me||[]).map(Mu),Ne=Ce.map(Mu),He=me.reduce(wl,{}),lt=Ce.reduce(wl,{}),ut=Pe.slice();let kt,wt,xt,pt;for(kt=0,wt=0;kt<Pe.length;kt++)xt=Pe[kt],lt.hasOwnProperty(xt)?wt++:(Me.push({command:Gr.removeImport,args:[xt]}),ut.splice(ut.indexOf(xt,wt),1));for(kt=0,wt=0;kt<Ne.length;kt++)xt=Ne[Ne.length-1-kt],ut[ut.length-1-kt]!==xt&&(He.hasOwnProperty(xt)?(Me.push({command:Gr.removeImport,args:[xt]}),ut.splice(ut.lastIndexOf(xt,ut.length-wt),1)):wt++,pt=ut[ut.length-kt],Me.push({command:Gr.addImport,args:[lt[xt],pt]}),ut.splice(ut.length-kt,0,xt));for(const At of Ce){const Ct=He[At.id];Ct&&(delete Ct.data,a.bv(Ct,At)||Me.push({command:Gr.updateImport,args:[At.id,At]}))}}(E.imports,D.imports,U),a.bv(E.transition,D.transition)||U.push({command:Gr.setTransition,args:[D.transition]}),a.bv(E.light,D.light)||U.push({command:Gr.setLight,args:[D.light]}),a.bv(E.fog,D.fog)||U.push({command:Gr.setFog,args:[D.fog]}),a.bv(E.snow,D.snow)||U.push({command:Gr.setSnow,args:[D.snow]}),a.bv(E.rain,D.rain)||U.push({command:Gr.setRain,args:[D.rain]}),a.bv(E.projection,D.projection)||U.push({command:Gr.setProjection,args:[D.projection]}),a.bv(E.lights,D.lights)||U.push({command:Gr.setLights,args:[D.lights]}),a.bv(E.camera,D.camera)||U.push({command:Gr.setCamera,args:[D.camera]}),a.bv(E.iconsets,D.iconsets)||function(me,Ce,Me){let Pe;for(Pe in Ce=Ce||{},me=me||{})me.hasOwnProperty(Pe)&&(Ce.hasOwnProperty(Pe)||Me.push({command:Gr.removeIconset,args:[Pe]}));for(Pe in Ce){if(!Ce.hasOwnProperty(Pe))continue;const Ne=Ce[Pe];me.hasOwnProperty(Pe)?a.bv(me[Pe],Ne)||(Me.push({command:Gr.removeIconset,args:[Pe]}),Me.push({command:Gr.addIconset,args:[Pe,Ne]})):Me.push({command:Gr.addIconset,args:[Pe,Ne]})}}(E.iconsets,D.iconsets,U),!a.bv(E["color-theme"],D["color-theme"]))return[{command:Gr.setStyle,args:[D]}];const Z={},ie=[];(function(me,Ce,Me,Pe){let Ne;for(Ne in Ce=Ce||{},me=me||{})me.hasOwnProperty(Ne)&&(Ce.hasOwnProperty(Ne)||Su(Ne,Me,Pe));for(Ne in Ce){if(!Ce.hasOwnProperty(Ne))continue;const He=Ce[Ne];me.hasOwnProperty(Ne)?a.bv(me[Ne],He)||(me[Ne].type==="geojson"&&He.type==="geojson"&&cf(me,Ce,Ne)?Me.push({command:Gr.setGeoJSONSourceData,args:[Ne,He.data]}):Ch(Ne,Ce,Me,Pe)):Eh(Ne,Ce,Me)}})(E.sources,D.sources,ie,Z);const de=[];E.layers&&E.layers.forEach(me=>{me.source&&Z[me.source]?U.push({command:Gr.removeLayer,args:[me.id]}):de.push(me)});let ne=E.terrain;ne&&Z[ne.source]&&(U.push({command:Gr.setTerrain,args:[void 0]}),ne=void 0),U=U.concat(ie),a.bv(ne,D.terrain)||U.push({command:Gr.setTerrain,args:[D.terrain]}),function(me,Ce,Me){Ce=Ce||[];const Pe=(me=me||[]).map(Mu),Ne=Ce.map(Mu),He=me.reduce(wl,{}),lt=Ce.reduce(wl,{}),ut=Pe.slice(),kt=Object.create(null);let wt,xt,pt,At,Ct,ti,si;for(wt=0,xt=0;wt<Pe.length;wt++)pt=Pe[wt],lt.hasOwnProperty(pt)?xt++:(Me.push({command:Gr.removeLayer,args:[pt]}),ut.splice(ut.indexOf(pt,xt),1));for(wt=0,xt=0;wt<Ne.length;wt++)pt=Ne[Ne.length-1-wt],ut[ut.length-1-wt]!==pt&&(He.hasOwnProperty(pt)?(Me.push({command:Gr.removeLayer,args:[pt]}),ut.splice(ut.lastIndexOf(pt,ut.length-xt),1)):xt++,ti=ut[ut.length-wt],Me.push({command:Gr.addLayer,args:[lt[pt],ti]}),ut.splice(ut.length-wt,0,pt),kt[pt]=!0);for(wt=0;wt<Ne.length;wt++)if(pt=Ne[wt],At=He[pt],Ct=lt[pt],!kt[pt]&&!a.bv(At,Ct))if(a.bv(At.source,Ct.source)&&a.bv(At["source-layer"],Ct["source-layer"])&&a.bv(At.type,Ct.type)){for(si in ma(At.layout,Ct.layout,Me,pt,null,Gr.setLayoutProperty),ma(At.paint,Ct.paint,Me,pt,null,Gr.setPaintProperty),a.bv(At.slot,Ct.slot)||Me.push({command:Gr.setSlot,args:[pt,Ct.slot]}),a.bv(At.filter,Ct.filter)||Me.push({command:Gr.setFilter,args:[pt,Ct.filter]}),a.bv(At.minzoom,Ct.minzoom)&&a.bv(At.maxzoom,Ct.maxzoom)||Me.push({command:Gr.setLayerZoomRange,args:[pt,Ct.minzoom,Ct.maxzoom]}),At)At.hasOwnProperty(si)&&si!=="layout"&&si!=="paint"&&si!=="filter"&&si!=="metadata"&&si!=="minzoom"&&si!=="maxzoom"&&si!=="slot"&&(si.indexOf("paint.")===0?ma(At[si],Ct[si],Me,pt,si.slice(6),Gr.setPaintProperty):a.bv(At[si],Ct[si])||Me.push({command:Gr.setLayerProperty,args:[pt,si,Ct[si]]}));for(si in Ct)Ct.hasOwnProperty(si)&&!At.hasOwnProperty(si)&&si!=="layout"&&si!=="paint"&&si!=="filter"&&si!=="metadata"&&si!=="minzoom"&&si!=="maxzoom"&&si!=="slot"&&(si.indexOf("paint.")===0?ma(At[si],Ct[si],Me,pt,si.slice(6),Gr.setPaintProperty):a.bv(At[si],Ct[si])||Me.push({command:Gr.setLayerProperty,args:[pt,si,Ct[si]]}))}else Me.push({command:Gr.removeLayer,args:[pt]}),ti=ut[ut.lastIndexOf(pt)+1],Me.push({command:Gr.addLayer,args:[Ct,ti]})}(de,D.layers,U)}catch(Z){console.warn("Unable to compute style diff:",Z),U=[{command:Gr.setStyle,args:[D]}]}return U}(this.serialize(),t).filter(E=>!(E.command in Ed));if(d.length===0)return!1;const _=d.filter(E=>!(E.command in sc));if(_.length>0)throw new Error(`Unimplemented: ${_.map(E=>E.command).join(", ")}.`);const b=[];return d.forEach(E=>{b.push(this[E.command](...E.args))}),r&&Promise.all(b).then(r).catch(r),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){for(const[r,d]of t.entries()){if(this.getImage(r))return this.fire(new a.z(new Error(`An image with the name "${r.name}" already exists.`)));this.imageManager.addImage(r,this.scope,d),this._changes.updateImage(r,this.scope)}return this._updateWorkerImages(),this.fire(new a.A("data",{dataType:"style"})),this}addImage(t,r){return this.getImage(t)?this.fire(new a.z(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,r),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new a.A("data",{dataType:"style"})),this)}updateImage(t,r,d=!1){this.imageManager.updateImage(t,this.scope,r),d&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new a.A("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new a.A("data",{dataType:"style"})),this):this.fire(new a.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new a.A("data",{dataType:"style"})),this}addModel(t,r,d={}){return this._checkLoaded(),this._validate(ct,`models.${t}`,r,null,d)||(this.modelManager.addModel(t,r,this.scope),this.fire(new a.A("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this.fire(new a.A("data",{dataType:"style"})),this):this.fire(new a.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,r,d={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(mc,`sources.${t}`,r,null,d))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const _=Gn(t,r,this.dispatcher,this);_.scope=this.scope,_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(_.id),source:_.serialize(),sourceId:_.id}));const b=E=>{const D=(E?"symbol:":"other:")+_.id,U=a.C(D,this.scope),Z=this._sourceCaches[D]=new Ll(U,_,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[_.id]=Z,Z.onAdd(this.map)};b(!1),r.type!=="vector"&&r.type!=="geojson"||b(!0),_.onAdd&&_.onAdd(this.map),d.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const r=this.getOwnSource(t);if(!r)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===t)return this.fire(new a.z(new Error(`Source "${t}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new a.z(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const _=Object.entries(this.stylesheet.iconsets).find(([b,E])=>E.type==="source"&&E.source===t);if(_)return this.fire(new a.z(new Error(`Source "${t}" cannot be removed while iconset "${_[0]}" is using it.`)))}const d=this.getOwnSourceCaches(t);for(const _ of d){const b=a.d7(_.id);delete this._sourceCaches[b],this._changes.discardSourceCacheUpdate(_.id),_.fire(new a.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),r.setEventedParent(null),r.onRemove&&r.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,r){this._checkLoaded(),this.getOwnSource(t).setData(r),this._changes.setDirty()}getOwnSource(t){const r=this.getOwnSourceCache(t);return r&&r.getSource()}getOwnSources(){const t=[];for(const r in this._otherSourceCaches){const d=this.getOwnSourceCache(r);d&&t.push(d.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const r in t){const d=t[r]._tiles;for(const _ in d){const b=d[_];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const r=this._getTransitionParameters();for(const b of t){if(this._validate(Zl,"lights",b))return;switch(b.type){case"ambient":if(this.ambientLight){const E=this.ambientLight;E.set(b),E.updateTransitions(r)}else this.ambientLight=new ao(b,Ar||(Ar=new a.a7({color:new a.a8(a.a5.properties_light_ambient.color),"color-use-theme":new a.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new a.a8(a.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const E=this.directionalLight;E.set(b),E.updateTransitions(r)}else this.directionalLight=new ao(b,Ko||(Ko=new a.a7({direction:new a.an(a.a5.properties_light_directional.direction),color:new a.a8(a.a5.properties_light_directional.color),"color-use-theme":new a.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new a.a8(a.a5.properties_light_directional.intensity),"cast-shadows":new a.a8(a.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new a.a8(a.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new a.a8(a.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const d=Object.assign(r,{worldview:this.map.getWorldview()}),_=new a.aa(this.z||0,d);this.ambientLight&&this.ambientLight.recalculate(_),this.directionalLight&&this.directionalLight.recalculate(_),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,r=this.ambientLight;if(!t||!r)return;const d=ne=>.2126*(ne[0]<=.03928?ne[0]/12.92:Math.pow((ne[0]+.055)/1.055,2.4))+.7152*(ne[1]<=.03928?ne[1]/12.92:Math.pow((ne[1]+.055)/1.055,2.4))+.0722*(ne[2]<=.03928?ne[2]/12.92:Math.pow((ne[2]+.055)/1.055,2.4)),_=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),b=t.properties.get("intensity"),E=t.properties.get("direction"),D=1-a.cR(E.x,E.y,E.z)[2]/90,U=d(_)*b*D,Z=r.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),ie=r.properties.get("intensity"),de=d(Z)*ie;return Number(((U+de)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(a.d8(t)){const r=a.d9(t),d=this.fragments.find(({id:b})=>b===r);if(!d)return;const _=a.d7(t);return d.style.getFragmentStyle(_)}{const r=this.fragments.find(({id:d})=>d===t);return r?r.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const r={},d=(_,b="")=>`${_}::${b}`;this._featuresetSelectors={};for(const _ in t){const b=this._featuresetSelectors[_]=[];for(const E of t[_].selectors){if(E.featureNamespace){const U=this.getOwnLayer(E.layer);if(!U){a.w(`Layer is undefined for selector: ${E.layer}`);continue}const Z=d(U.source,U.sourceLayer);if(Z in r&&r[Z]!==E.featureNamespace){a.w(`"featureNamespace ${E.featureNamespace} of featureset ${_}'s selector is not associated to the same source, skip this selector`);continue}r[Z]=E.featureNamespace}let D;if(E.properties)for(const U in E.properties){const Z=a.X(E.properties[U]);Z.result==="success"&&(D=D||{},D[U]=Z.value)}b.push({layerId:E.layer,namespace:E.featureNamespace,properties:D,uniqueFeatureID:E._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const r=this.getFragmentStyle(t);if(!r||!r.stylesheet.featuresets)return[];const d=[];for(const _ in r.stylesheet.featuresets)d.push({featuresetId:_,importId:r.scope?r.scope:void 0});return d}getFeaturesetLayers(t,r){const d=this.getFragmentStyle(r),_=d.stylesheet.featuresets;if(!_||!_[t])return this.fire(new a.z(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const b=[];for(const E of _[t].selectors){const D=d.getOwnLayer(E.layer);D&&b.push(D)}return b}getConfigProperty(t,r){const d=this.getFragmentStyle(t);if(!d)return null;const _=a.C(r,d.scope),b=d.options.get(_),E=b?b.value||b.default:null;return E?E.serialize():null}setConfigProperty(t,r,d){const _=this.getFragmentStyle(t);if(!_)return;const b=_.stylesheet.indoor?Fc(_.stylesheet.schema):_.stylesheet.schema;if(!b||!b[r])return;const E=a.X(d);if(E.result!=="success")return void yp(this,E.value);const D=E.value.expression,U=a.C(r,_.scope),Z=_.options.get(U);if(!Z)return;let ie;const{minValue:de,maxValue:ne,stepValue:me,type:Ce,values:Me}=b[r],Pe=a.X(b[r].default);Pe.result==="success"&&(ie=Pe.value.expression),ie?(this.options.set(U,Object.assign({},Z,{value:D,default:ie,minValue:de,maxValue:ne,stepValue:me,type:Ce,values:Me})),this.updateConfigDependencies(r)):this.fire(new a.z(new Error(`No schema defined for the config option "${r}" in the "${t}" fragment.`)))}getConfig(t){const r=this.getFragmentStyle(t);if(!r)return null;const d=r.stylesheet.schema;if(!d)return null;const _={};for(const b in d){const E=a.C(b,r.scope),D=r.options.get(E),U=D?D.value||D.default:null;_[b]=U?U.serialize():null}return _}setConfig(t,r){const d=this.getFragmentStyle(t);d&&(d.updateConfig(r,d.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const r=this.getFragmentStyle(t);return r?r.stylesheet.schema:null}setSchema(t,r){const d=this.getFragmentStyle(t);d&&(d.stylesheet.schema=r,d.updateConfig(d._config,r),this.updateConfigDependencies())}updateConfig(t,r){if(this._config=t,t||r)if(r)for(const d in r){let _,b;const E=a.X(r[d].default);if(E.result==="success"&&(_=E.value.expression),t&&t[d]!==void 0){const ne=a.X(t[d]);ne.result==="success"&&(b=ne.value.expression)}const{minValue:D,maxValue:U,stepValue:Z,type:ie,values:de}=r[d];if(_){const ne=a.C(d,this.scope);this.options.set(ne,{default:_,value:b,minValue:D,maxValue:U,stepValue:Z,type:ie,values:de})}else this.fire(new a.z(new Error(`No schema defined for config option "${d}".`)))}else this.fire(new a.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const r of this._configDependentLayers){const d=this.getLayer(r);if(d){if(t&&!d.configDependencies.has(t))continue;d.possiblyEvaluateVisibility(),this._updateLayer(d)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(r=>{const d=r._styleColorTheme.colorThemeOverride?r._styleColorTheme.colorThemeOverride:r._styleColorTheme.colorTheme;if(d){const _=r._evaluateColorThemeData(d);(!r._styleColorTheme.lut&&_!==""||r._styleColorTheme.lut&&_!==r._styleColorTheme.lut.data)&&r.setColorTheme(d)}}),this._changes.setDirty()}addLayer(t,r,d={}){this._checkLoaded();const _=t.id;if(this._layers[_])return void this.fire(new a.z(new Error(`Layer with id "${_}" already exists on this map`)));let b;if(t.type==="custom"){if(yp(this,a.da(t)))return;b=a.db(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(_,t.source),t=a.d6(t),t=a.h(t,{source:_})),this._validate(lr,`layers.${_}`,t,{arrayIndex:-1},d))return;b=a.db(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(b),b.setEventedParent(this,{layer:{id:_}})}b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid);let E=this._order.length;if(r){const ie=this._order.indexOf(r);if(ie===-1)return void this.fire(new a.z(new Error(`Layer with id "${r}" does not exist on this map.`)));b.slot===this._layers[r].slot?E=ie:a.w(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(E,0,_),this._layerOrderChanged=!0,this._layers[_]=b;const D=this.getOwnLayerSourceCache(b),U=!!this.directionalLight&&this.directionalLight.shadowsEnabled();D&&b.canCastShadows()&&U&&(D.castsShadows=!0);const Z=this._changes.getRemovedLayer(b);if(Z&&b.source&&D&&b.type!=="custom"){this._changes.discardLayerRemoval(b);const ie=a.C(b.source,b.scope);Z.type!==b.type?this._changes.updateSourceCache(ie,"clear"):(this._changes.updateSourceCache(ie,"reload"),D.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),b.scope=this.scope,this.mergeLayers()}moveLayer(t,r){this._checkLoaded();const d=this._checkLayer(t);if(!d||t===r)return;const _=this._order.indexOf(t);this._order.splice(_,1);let b=this._order.length;if(r){const E=this._order.indexOf(r);if(E===-1)return void this.fire(new a.z(new Error(`Layer with id "${r}" does not exist on this map.`)));d.slot===this._layers[r].slot?b=E:a.w(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const r=this._checkLayer(t);if(!r)return;r.setEventedParent(null);const d=this._order.indexOf(t);this._order.splice(d,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(r.fqid),this._changes.removeLayer(r);const _=this.getOwnLayerSourceCache(r);if(_&&_.castsShadows){let b=!1;for(const E in this._layers)if(this._layers[E].source===r.source&&this._layers[E].canCastShadows()){b=!0;break}_.castsShadows=b}r.onRemove&&r.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const r in this._layers)if(this._layers[r].type===t)return!0;return!1}setLayerZoomRange(t,r,d){this._checkLoaded();const _=this._checkLayer(t);_&&(_.minzoom===r&&_.maxzoom===d||(r!=null&&(_.minzoom=r),d!=null&&(_.maxzoom=d),this._updateLayer(_)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,r){this._checkLoaded();const d=this._checkLayer(t);d&&d.slot!==r&&(d.slot=r,this._updateLayer(d))}setFilter(t,r,d={}){this._checkLoaded();const _=this._checkLayer(t);if(_&&!a.bv(_.filter,r))return r==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(ei,`layers.${_.id}.filter`,r,{layerType:_.type},d)||(_.filter=a.d6(r),this._updateLayer(_)))}getFilter(t){const r=this._checkLayer(t);if(r)return a.d6(r.filter)}setLayoutProperty(t,r,d,_={}){this._checkLoaded();const b=this._checkLayer(t);if(b&&!a.bv(b.getLayoutProperty(r),d)){if(d!=null&&(!_||_.validate!==!1)&&yp(b,We.call(Hl,{key:`layers.${t}.layout.${r}`,layerType:b.type,objectKey:r,value:d,styleSpec:a.a5,style:{glyphs:!0,sprite:!0}})))return;b.setLayoutProperty(r,d),b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),this._updateLayer(b)}}getLayoutProperty(t,r){const d=this._checkLayer(t);if(d)return d.getLayoutProperty(r)}setPaintProperty(t,r,d,_={}){this._checkLoaded();const b=this._checkLayer(t);if(!b||a.bv(b.getPaintProperty(r),d)||d!=null&&(!_||_.validate!==!1)&&yp(b,Oe.call(Hl,{key:`layers.${t}.paint.${r}`,layerType:b.type,objectKey:r,value:d,styleSpec:a.a5})))return;const E=b.setPaintProperty(r,d);b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),E&&this._updateLayer(b),this._changes.updatePaintProperties(b)}getPaintProperty(t,r){const d=this._checkLayer(t);if(d)return d.getPaintProperty(r)}setFeatureState(t,r){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:U,importId:Z}=t.target,ie=this.getFragmentStyle(Z),de=ie.getFeaturesetLayers(U);for(const{source:ne,sourceLayer:me}of de)ie.setFeatureState({id:t.id,source:ne,sourceLayer:me},r)}else if("layerId"in t.target){const{layerId:U}=t.target,Z=this.getLayer(U);this.setFeatureState({id:t.id,source:Z.source,sourceLayer:Z.sourceLayer},r)}return}const d=t.source,_=t.sourceLayer,b=this._checkSource(d);if(!b)return;const E=b.type;if(E==="geojson"&&_)return void this.fire(new a.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(E==="vector"&&!_)return void this.fire(new a.z(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new a.z(new Error("The feature id parameter must be provided.")));const D=this.getOwnSourceCaches(d);for(const U of D)U.setFeatureState(_,t.id,r)}removeFeatureState(t,r){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:U,importId:Z}=t.target,ie=this.getFragmentStyle(Z),de=ie.getFeaturesetLayers(U);for(const{source:ne,sourceLayer:me}of de)ie.removeFeatureState({id:t.id,source:ne,sourceLayer:me},r)}else if("layerId"in t.target){const{layerId:U}=t.target,Z=this.getLayer(U);this.removeFeatureState({id:t.id,source:Z.source,sourceLayer:Z.sourceLayer},r)}return}const d=t.source,_=this._checkSource(d);if(!_)return;const b=_.type,E=b==="vector"?t.sourceLayer:void 0;if(b==="vector"&&!E)return void this.fire(new a.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(r&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new a.z(new Error("A feature id is required to remove its specific state property.")));const D=this.getOwnSourceCaches(d);for(const U of D)U.removeFeatureState(E,t.id,r)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let b;if("featuresetId"in t.target){const{featuresetId:E,importId:D}=t.target,U=this.getFragmentStyle(D),Z=U.getFeaturesetLayers(E);for(const{source:ie,sourceLayer:de}of Z){const ne=U.getFeatureState({id:t.id,source:ie,sourceLayer:de});if(ne&&!b)b=ne;else if(!a.bv(b,ne))return void this.fire(new a.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:E}=t.target,D=this.getLayer(E);b=this.getFeatureState({id:t.id,source:D.source,sourceLayer:D.sourceLayer})}return b}const r=t.source,d=t.sourceLayer,_=this._checkSource(r);if(_){if(_.type!=="vector"||d)return t.id===void 0&&this.fire(new a.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(r)[0].getFeatureState(d,t.id);this.fire(new a.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=a.h({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return a.h({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),r=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return a.dc({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:r,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},d=>d!==void 0)}_updateFilteredLayers(t){for(const r of Object.values(this._mergedLayers))t(r)&&this._updateLayer(r)}_updateLayer(t){this._changes.updateLayer(t);const r=this.getLayerSourceCache(t),d=a.C(t.source,t.scope),_=this._changes.getUpdatedSourceCaches();t.source&&!_[d]&&r&&r.getSource().type!=="raster"&&(this._changes.updateSourceCache(d,"reload"),r.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const r=D=>this._mergedLayers[D].is3D(!!this.terrain),d=this.order,_={},b=[];for(let D=d.length-1;D>=0;D--){const U=d[D];if(r(U)){_[U]=D;for(const Z of t){const ie=Z[U];if(ie)for(const de of ie)b.push(de)}}}b.sort((D,U)=>U.intersectionZ-D.intersectionZ);const E=[];for(let D=d.length-1;D>=0;D--){const U=d[D];if(r(U))for(let Z=b.length-1;Z>=0;Z--){const ie=b[Z].feature;if(ie.layer&&_[ie.layer.id]<D)break;E.push(ie),b.pop()}else for(const Z of t){const ie=Z[U];if(ie)for(const de of ie)E.push(de.feature)}}return E}queryRenderedFeatures(t,r,d){let _;r&&!Array.isArray(r)&&r.filter&&(this._validate(ei,"queryRenderedFeatures.filter",r.filter,null,r),_=a.b3(r.filter));const b={},E=ie=>{if(Up.has(ie.type))return;const de=this.getOwnLayerSourceCache(ie),ne=b[de.id]=b[de.id]||{sourceCache:de,layers:{},has3DLayers:!1};ie.is3D(!!this.terrain)&&(ne.has3DLayers=!0),ne.layers[ie.fqid]=ne.layers[ie.fqid]||{styleLayer:ie,targets:[]},ne.layers[ie.fqid].targets.push({filter:_})};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new a.z(new Error("parameters.layers must be an Array."))),[];for(const ie of r.layers){const de=this._layers[ie];if(!de)return this.fire(new a.z(new Error(`The layer '${ie}' does not exist in the map's style and cannot be queried for features.`))),[];E(de)}}else for(const ie in this._layers)E(this._layers[ie]);const D=this._queryRenderedFeatures(t,b,d),U=this._flattenAndSortRenderedFeatures(D),Z=[];for(const ie of U)a.dd(ie.layer.id)===this.scope&&Z.push(ie);return Z}queryRenderedFeatureset(t,r,d){let _;r&&!Array.isArray(r)&&r.filter&&(this._validate(ei,"queryRenderedFeatures.filter",r.filter,null,r),_=a.b3(r.filter));const b="mock",E=[];if(r&&r.target)E.push(Object.assign({},r,{targetId:b,filter:_}));else{const ie=this.getFeaturesetDescriptors();for(const de of ie)E.push({targetId:b,filter:_,target:de});for(const{style:de}of this.fragments){const ne=de.getFeaturesetDescriptors();for(const me of ne)E.push({targetId:b,filter:_,target:me})}}const D=this.queryRenderedTargets(t,E,d),U=[],Z=new Set;for(const ie of D)for(const de of ie.variants[b])Sd(de,ie,Z)||U.push(new a.de(ie,de));return U}queryRenderedTargets(t,r,d){const _={},b=(D,U,Z,ie)=>{const de=_[U.id]=_[U.id]||{sourceCache:U,layers:{},has3DLayers:!1};if(de.layers[D.fqid]=de.layers[D.fqid]||{styleLayer:D,targets:[]},D.is3D(!!this.terrain)&&(de.has3DLayers=!0),!ie)return Z.uniqueFeatureID=!1,void de.layers[D.fqid].targets.push(Z);de.layers[D.fqid].targets.push(Object.assign({},Z,{namespace:ie.namespace,properties:ie.properties,uniqueFeatureID:ie.uniqueFeatureID}))};for(const D of r)if("featuresetId"in D.target){const{featuresetId:U,importId:Z}=D.target,ie=this.getFragmentStyle(Z);if(!ie||!ie._featuresetSelectors)continue;const de=ie._featuresetSelectors[U];if(!de){this.fire(new a.z(new Error(`The featureset '${U}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const ne of de){const me=ie.getOwnLayer(ne.layerId);me&&!Up.has(me.type)&&b(me,ie.getOwnLayerSourceCache(me),D,ne)}}else if("layerId"in D.target){const{layerId:U}=D.target,Z=this.getLayer(U);if(!Z||Up.has(Z.type))continue;b(Z,this.getLayerSourceCache(Z),D)}const E=this._queryRenderedFeatures(t,_,d);return this._flattenAndSortRenderedFeatures(E)}_queryRenderedFeatures(t,r,d){const _=[],b=!!this.map._showQueryGeometry,E=lo.createFromScreenPoints(t,d);for(const D in r){const U=Wd(E,r[D],this._availableImages,d,b);Object.keys(U).length&&_.push(U)}if(this.placement)for(const D in r){if(!r[D].sourceCache._onlySymbols)continue;const U=Wn(E.screenGeometry,r[D],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(U).length&&_.push(U)}return _}querySourceFeatures(t,r){const d=r&&r.filter;d&&this._validate(ei,"querySourceFeatures.filter",d,null,r);let _=[];const b=this.getOwnSourceCaches(t);for(const E of b)_=_.concat($u(E,r));return _}addSourceType(t,r,d){return Yl.getSourceType(t)?d(new Error(`A source type called "${t}" already exists.`)):(Yl.setSourceType(t,r),r.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:r.workerSourceURL},d):d(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,r,d={}){this._checkLoaded();const _=this.light.getLight();let b=!1;for(const D in t)if(!a.bv(t[D],_[D])){b=!0;break}if(!b)return;const E=this._getTransitionParameters();this.light.setLight(t,r,d),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=a.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&a.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,r=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),r===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let d=t;const _=t.source==null;if(r===1){if(this.disableElevatedTerrain)return;if(typeof d.source=="object"){const D="terrain-dem-src";this.addSource(D,d.source),d=a.d6(d),d=a.h(d,{source:D})}const b=a.h({},d),E={};if(this.terrain&&_){b.source=this.terrain.get().source;const D=this.terrain?this.getFragmentStyle(this.terrain.scope):null;D&&(E.style=D.serialize())}if(this._validate(Wi,"terrain",b,E))return}if(!this.terrain||this.terrain.scope!==this.scope&&!_||this.terrain&&r!==this.terrain.drapeRenderMode){if(!d)return;this._createTerrain(d,r),this.fire(new a.A("data",{dataType:"style"}))}else{const b=this.terrain,E=b.get();for(const D of Object.keys(a.a5.terrain))!d.hasOwnProperty(D)&&a.a5.terrain[D].default&&(d[D]=a.a5.terrain[D].default);for(const D in t)if(!a.bv(t[D],E[D])){b.set(t,this.options),this.stylesheet.terrain=t;const U=this._getTransitionParameters({duration:0});b.updateTransitions(U),this.fire(new a.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const r=this.fog=new mr(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=r.get();const d=this._getTransitionParameters({duration:0});r.updateTransitions(d)}_createSnow(t){const r=this.snow=new to(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=r.get();const d=this._getTransitionParameters({duration:0});r.updateTransitions(d)}_createRain(t){const r=this.rain=new nn(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=r.get();const d=this._getTransitionParameters({duration:0});r.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const r=this.fog;if(!a.bv(r.get(),t)){r.set(t,this.options),this.stylesheet.fog=r.get();const d=this._getTransitionParameters({duration:0});r.updateTransitions(d)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const r=this.snow;if(!a.bv(r.get(),t)){r.set(t,this.options),this.stylesheet.snow=r.get();const d=this._getTransitionParameters({duration:0});r.updateTransitions(d)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const r=this.rain;if(!a.bv(r.get(),t)){r.set(t,this.options),this.stylesheet.rain=r.get();const d=this._getTransitionParameters({duration:0});r.updateTransitions(d)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const _ in this._layers)this._layers[_].lut=this._styleColorTheme.lut;for(const _ in this._sourceCaches)this._sourceCaches[_].clearTiles()},r=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!r)return this._styleColorTheme.lut=null,void t();const d=this._evaluateColorThemeData(r);this._loadColorTheme(d).then(()=>{this.fire(new a.A("colorthemeset")),t()}).catch(_=>{a.w(`Couldn't set color theme: ${_}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&a.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,r){const d=this.getFragmentStyle(t);d&&(d._styleColorTheme.colorThemeOverride=r,d._reloadColorTheme())}_getTransitionParameters(t){return{now:a.q.now(),transition:a.h(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],r=[];for(const d of this._mergedOrder)this.isLayerDraped(this._mergedLayers[d])?t.push(d):r.push(d);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...r)}_createTerrain(t,r){const d=this.terrain=new jt(t,r,this.scope,this.options,this.map.getWorldview());r===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const _=this._getTransitionParameters({duration:0});d.updateTransitions(_)}_force3DLayerUpdate(){for(const t in this._layers){const r=this._layers[t];r.type==="fill-extrusion"&&this._updateLayer(r)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const r=this._layers[t];r.type==="symbol"&&this._updateLayer(r)}}_validate(t,r,d,_,b={}){if(b&&b.validate===!1)return!1;const E=a.h({},this.serialize());return yp(this,t.call(Hl,a.h({key:r,style:E,value:d,styleSpec:a.a5},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.df.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const r=this.getSourceCaches(t);for(const d of r)d.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const r=this.getSourceCaches(t);for(const d of r)d.resume(),d.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let r;this.directionalLight&&(r=yc(this.directionalLight));const d=new Set;for(const _ in this._mergedLayers){const b=this._mergedLayers[_];b.hasElevation()&&!d.has(b.source)&&d.add(b.source)}for(const _ in this._mergedSourceCaches){const b=this._mergedSourceCaches[_],E=d.has(b._source.id);b.update(t,void 0,void 0,r,E)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const r=this._sourceCaches[t];r.resume(),r.reload()}}_updatePlacement(t,r,d,_,b,E,D=!1){let U=!1,Z=!1;const ie={},de={};for(const ne of this._mergedOrder){const me=this._mergedLayers[ne];if(me.type!=="symbol")continue;const Ce=a.C(me.source,me.scope);let Me=ie[Ce];if(!Me){const Ne=this.getLayerSourceCache(me);if(!Ne)continue;const He=Ne.getRenderableIds(!0).map(lt=>Ne.getTileByID(lt));de[Ce]=He.slice(),Me=ie[Ce]=He.sort((lt,ut)=>ut.tileID.overscaledZ-lt.tileID.overscaledZ||(lt.tileID.isLessThan(ut.tileID)?-1:1))}const Pe=this.crossTileSymbolIndex.addLayer(me,Me,r.center.lng,r.projection);U=U||Pe}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),D=D||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new a.A("neworder")),(D||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.q.now(),r.zoom))&&(this.pauseablePlacement=new Kd(r,this._mergedOrder,D,d,_,b,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,ie,de,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.q.now()),Z=!0),U&&this.pauseablePlacement.placement.setStale()),Z||U){this._buildingIndex.onNewFrame(r.zoom);for(let ne=0;ne<this._mergedOrder.length;ne++){const me=this._mergedLayers[this._mergedOrder[ne]];if(me.type!=="symbol")continue;const Ce=this.isLayerClipped(me);this.placement.updateLayerOpacities(me,ie[a.C(me.source,me.scope)],ne,Ce?E:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,r){this._checkLoaded();const d=this.stylesheet.imports=this.stylesheet.imports||[];if(d.findIndex(({id:b})=>b===t.id)!==-1)return void this.fire(new a.z(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!r)return d.push(t),this._loadImports([t],!0);const _=d.findIndex(({id:b})=>b===r);return _===-1&&this.fire(new a.z(new Error(`Import with id "${r}" does not exist on this map.`))),this.stylesheet.imports=d.slice(0,_).concat(t).concat(d.slice(_)),this._loadImports([t],!0,r)}updateImport(t,r){this._checkLoaded();const d=this.stylesheet.imports||[],_=this.getImportIndex(t);return _===-1?this:typeof r=="string"?(this.setImportUrl(t,r),this):(r.url&&r.url!==d[_].url&&this.setImportUrl(t,r.url),a.bv(r.config,d[_].config)||this.setImportConfig(t,r.config,r.data.schema),a.bv(r.data,d[_].data)||this.setImportData(t,r.data),this)}moveImport(t,r){this._checkLoaded();let d=this.stylesheet.imports||[];const _=this.getImportIndex(t);if(_===-1)return this;const b=this.getImportIndex(r);if(b===-1)return this;const E=d[_],D=this.fragments[_];return d=d.filter(({id:U})=>U!==t),this.fragments=this.fragments.filter(({id:U})=>U!==t),this.stylesheet.imports=d.slice(0,b).concat(E).concat(d.slice(b)),this.fragments=this.fragments.slice(0,b).concat(D).concat(this.fragments.slice(b)),this.mergeLayers(),this}setImportUrl(t,r){this._checkLoaded();const d=this.stylesheet.imports||[],_=this.getImportIndex(t);if(_===-1)return this;d[_].url=r;const b=this.fragments[_];return b.style=this._createFragmentStyle(d[_]),b.style.on("style.import.load",()=>this.mergeAll()),b.style.loadURL(r),this}setImportData(t,r){this._checkLoaded();const d=this.getImportIndex(t),_=this.stylesheet.imports||[];return d===-1?this:r?(this.fragments[d].style.setState(r),this._reloadImports(),this):(delete _[d].data,this.setImportUrl(t,_[d].url))}setImportConfig(t,r,d){this._checkLoaded();const _=this.getImportIndex(t),b=this.stylesheet.imports||[];if(_===-1)return this;r?b[_].config=r:delete b[_].config;const E=this.fragments[_];d&&E.style.stylesheet&&(E.style.stylesheet.schema=d);const D=E.style.stylesheet&&E.style.stylesheet.schema;return E.config=r,E.style.updateConfig(r,D),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const r=this.stylesheet.imports||[],d=this.getImportIndex(t);d!==-1&&(r.splice(d,1),this.fragments[d].style._remove(),this.fragments.splice(d,1),this._reloadImports())}getImportIndex(t){const r=(this.stylesheet.imports||[]).findIndex(d=>d.id===t);return r===-1&&this.fire(new a.z(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),r}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const r in this._mergedOtherSourceCaches){const d=this._mergedOtherSourceCaches[r];d&&t.push(d.getSource())}return t}getSource(t,r){const d=this.getSourceCache(t,r);return d&&d.getSource()}getLayerSource(t){const r=this.getLayerSourceCache(t);return r&&r.getSource()}getSourceCache(t,r){const d=a.C(t,r);return this._mergedOtherSourceCaches[d]}getLayerSourceCache(t){const r=a.C(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[r]:this._mergedOtherSourceCaches[r]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const r=[];return this._mergedOtherSourceCaches[t]&&r.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&r.push(this._mergedSymbolSourceCaches[t]),r}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const r in t){const d=t[r];d==="reload"?this.reloadSource(r):d==="clear"&&this.clearSource(r)}}updateLayers(t){const r=this._changes.getUpdatedPaintProperties();for(const d of r){const _=this.getLayer(d);_&&_.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t,this.scope)}getImages(t,r,d){this.imageManager.getImages(r.images,r.scope,d),this._updateTilesForChangedImages();const _=E=>{if(E){const D=r.images.map(U=>a.I.toString(U));E.setDependencies(r.tileID.key,r.type,D)}},b=a.C(r.source,r.scope);_(this._mergedOtherSourceCaches[b]),_(this._mergedSymbolSourceCaches[b])}rasterizeImages(t,r,d){this.imageManager.rasterizeImages(r,d)}getGlyphs(t,r,d){this.glyphManager.getGlyphs(r.stacks,r.scope,d)}getResource(t,r,d){return a.dg(r,d)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const r=[];return this._otherSourceCaches[t]&&r.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&r.push(this._symbolSourceCaches[t]),r}_isSourceCacheLoaded(t){const r=this.getOwnSourceCaches(t);return r.length===0?(this.fire(new a.z(new Error(`There is no source with ID '${t}'`))),!1):r.every(d=>d.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,r){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const d=t.type==="fill-extrusion"&&t.sourceLayer==="building",_=t.type==="building";if(t.is3D(!!this.terrain)){if(d||_||r&&r.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Yl.getSourceType=function(c){return fp[c]},Yl.setSourceType=function(c,t){fp[c]=t},Yl.registerForPluginStateChange=a.dh;var tu=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,od=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,jp=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Cu="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",_c=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,nd=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,pf=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,ch=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,iu=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,ns=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Cd=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Pd=[];xh(tu,Pd),xh(jp,Pd),xh(od,Pd);const Zu={"_prelude_fog.vertex.glsl":nd,"_prelude_terrain.vertex.glsl":_c,"_prelude_shadow.vertex.glsl":ns,"_prelude_fog.fragment.glsl":pf,"_prelude_shadow.fragment.glsl":Cd,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":ch,"_prelude_raster_particle.glsl":iu},Ih={};jr("",_c),jr(pf,nd),jr(Cd,ns),jr(ch,""),jr(iu,"");const Rl=jr(od,jp),vc=tu;var bc={background:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in highp vec3 v_normal;in highp float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 apply_lighting_linear(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec4 color=vec4(v_color.rgb,1.0);vec3 normal=normalize(v_normal);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,v_color.rgb,v_color.a);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_height));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_height);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3f;out vec4 v_color;out highp vec3 v_normal;out highp float v_height;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));vec3 pos=a_pos_3f;v_height=pos.z;gl_Position=u_matrix*vec4(pos,1.0);
#ifdef RENDER_SHADOWS
vec3 shadow_pos=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:jr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:jr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:jr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:jr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:jr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:jr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:jr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:jr(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:jr(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:jr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:jr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:jr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:jr(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:jr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:jr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:jr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:jr(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
#endif
}`),terrainRaster:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:jr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:jr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Cu),skyboxGradient:jr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Cu),skyboxCapture:jr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:jr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:jr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:jr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:jr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:jr("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:jr("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:jr("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:jr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function xh(c,t){const r=c.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let d of r)if(d=d.trim(),d[0]==="#"&&d.includes("if")&&!d.includes("endif")){d=d.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=d.split(" ");for(const b of _)t.includes(b)||t.push(b)}}function jr(c,t){const r=/#include\s+"([^"]+)"/g,d=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let _=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);_&&(_=_.map(Z=>{const ie=Z.split(" ");return ie[ie.length-1]}),_=[...new Set(_)]);const b={},E=[],D=[];if(c=c.replace(r,(Z,ie)=>(D.push(ie),"")),(t=t.replace(r,(Z,ie)=>(E.push(ie),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let U=[...Pd];xh(c,U),xh(t,U);for(const Z of[...E,...D])Zu[Z]||console.error(`Undefined include: ${Z}`),Ih[Z]||(Ih[Z]=[],xh(Zu[Z],Ih[Z])),U=[...U,...Ih[Z]];return{fragmentSource:c=c.replace(d,(Z,ie,de,ne,me)=>(b[me]=!0,ie==="define"?`
#ifndef HAS_UNIFORM_u_${me}
in ${de} ${ne} ${me};
#else
uniform ${de} ${ne} u_${me};
#endif
`:ie==="initialize"?`
#ifdef HAS_UNIFORM_u_${me}
    ${de} ${ne} ${me} = u_${me};
#endif
`:ie==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${me}
    in ${de} ${ne} ${me};
#endif
`:ie==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(d,(Z,ie,de,ne,me)=>{const Ce=ne==="float"?"vec2":ne,Me=me.match(/color/)?"color":Ce;return ie==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${me}
in ${de} ${ne} a_${me};
#endif
`:b[me]?ie==="define"?`
#ifndef HAS_UNIFORM_u_${me}
uniform lowp float u_${me}_t;
in ${de} ${Ce} a_${me};
out ${de} ${ne} ${me};
#else
uniform ${de} ${ne} u_${me};
#endif
`:ie==="initialize"?Me==="vec4"?`
#ifndef HAS_UNIFORM_u_${me}
    ${me} = a_${me};
#else
    ${de} ${ne} ${me} = u_${me};
#endif
`:`
#ifndef HAS_UNIFORM_u_${me}
    ${me} = unpack_mix_${Me}(a_${me}, u_${me}_t);
#else
    ${de} ${ne} ${me} = u_${me};
#endif
`:ie==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${me}
    in ${de} ${ne} a_${me};
    out ${de} ${ne} ${me};
#endif
`:ie==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${me}
    ${me} = a_${me};
#endif
`:void 0:ie==="define"?`
#ifndef HAS_UNIFORM_u_${me}
uniform lowp float u_${me}_t;
in ${de} ${Ce} a_${me};
#else
uniform ${de} ${ne} u_${me};
#endif
`:ie==="define-instanced"?Me==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${me}0;
in vec4 a_${me}1;
in vec4 a_${me}2;
in vec4 a_${me}3;
#else
uniform ${de} ${ne} u_${me};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${de} ${Ce} a_${me};
#else
uniform ${de} ${ne} u_${me};
#endif
`:ie==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${me}
    ${de} ${ne} ${me} = a_${me};
#endif
`:Me==="vec4"?`
#ifndef HAS_UNIFORM_u_${me}
    ${de} ${ne} ${me} = a_${me};
#else
    ${de} ${ne} ${me} = u_${me};
#endif
`:`
#ifndef HAS_UNIFORM_u_${me}
    ${de} ${ne} ${me} = unpack_mix_${Me}(a_${me}, u_${me}_t);
#else
    ${de} ${ne} ${me} = u_${me};
#endif
`}),staticAttributes:_,usedDefines:U,vertexIncludes:E,fragmentIncludes:D}}class rc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,r,d,_,b,E,D,U){this.context=t;let Z=this.boundPaintVertexBuffers.length!==_.length;for(let de=0;!Z&&de<_.length;de++)this.boundPaintVertexBuffers[de]!==_[de]&&(Z=!0);let ie=this.boundDynamicVertexBuffers.length!==D.length;for(let de=0;!ie&&de<D.length;de++)this.boundDynamicVertexBuffers[de]!==D[de]&&(ie=!0);if(!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==d||Z||ie||this.boundIndexBuffer!==b||this.boundVertexOffset!==E)this.freshBind(r,d,_,b,E,D,U);else{t.bindVertexArrayOES.set(this.vao);for(const de of D)de&&(de.bind(),U&&de.instanceCount&&de.setVertexAttribDivisor(t.gl,r,U));b&&b.dynamicDraw&&b.bind()}}freshBind(t,r,d,_,b,E,D){const U=t.numAttributes,Z=this.context,ie=Z.gl;this.vao&&this.destroy(),this.vao=Z.gl.createVertexArray(),Z.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=_,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=E,r.enableAttributes(ie,t),r.bind(),r.setVertexAttribPointers(ie,t,b);for(const de of d)de.enableAttributes(ie,t),de.bind(),de.setVertexAttribPointers(ie,t,b);for(const de of E)de&&(de.enableAttributes(ie,t),de.bind(),de.setVertexAttribPointers(ie,t,b),D&&de.instanceCount&&de.setVertexAttribDivisor(ie,t,D));_&&_.bind(),Z.currentNumAttributes=U}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Pu(c,t){const r=Math.pow(2,t.canonical.z),d=t.canonical.y;return[new a.ac(0,d/r).toLngLat().lat,new a.ac(0,(d+1)/r).toLngLat().lat]}function ff(c,t,r,d,_,b,E){const D=c.context,U=D.gl,Z=r.hillshadeFBO;if(!Z)return;c.prepareDrawTile();const ie=c.isTileAffectedByFog(t),de=c.getOrCreateProgram("hillshade",{overrideFog:ie});D.activeTexture.set(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,Z.colorAttachment.get());const ne=((Pe,Ne,He,lt)=>{const ut=He.paint.get("hillshade-shadow-color"),kt=He.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",wt=He.paint.get("hillshade-highlight-color"),xt=He.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",pt=He.paint.get("hillshade-accent-color"),At=He.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ct=He.paint.get("hillshade-emissive-strength");let ti=a.al(He.paint.get("hillshade-illumination-direction"));if(He.paint.get("hillshade-illumination-anchor")==="viewport")ti-=Pe.transform.angle;else if(Pe.style&&Pe.style.enable3dLights()&&Pe.style.directionalLight){const wi=Pe.style.directionalLight.properties.get("direction"),_i=a.cR(wi.x,wi.y,wi.z);ti=a.al(_i[1])}const si=!Pe.options.moving;return{u_matrix:lt||Pe.transform.calculateProjMatrix(Ne.tileID.toUnwrapped(),si),u_image:0,u_latrange:Pu(0,Ne.tileID),u_light:[He.paint.get("hillshade-exaggeration"),ti],u_shadow:ut.toPremultipliedRenderColor(kt?null:He.lut),u_highlight:wt.toPremultipliedRenderColor(xt?null:He.lut),u_emissive_strength:Ct,u_accent:pt.toPremultipliedRenderColor(At?null:He.lut)}})(c,r,d,c.terrain?t.projMatrix:null);c.uploadCommonUniforms(D,de,t.toUnwrapped());const{tileBoundsBuffer:me,tileBoundsIndexBuffer:Ce,tileBoundsSegments:Me}=c.getTileBoundsBuffers(r);de.draw(c,U.TRIANGLES,_,b,E,Zs.disabled,ne,d.id,me,Ce,Me)}function mf(c,t,r){if(!t.needsDEMTextureUpload)return;const d=c.context,_=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||c.getTileTexture(r.stride);const b=r.getPixels();t.demTexture?t.demTexture.update(b,{premultiply:!1}):t.demTexture=new a.T(d,b,_.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function ad(c,t,r){const d=c.context,_=d.gl;if(!t.dem)return;const b=t.dem;if(d.activeTexture.set(_.TEXTURE1),mf(c,t,b),!t.demTexture)return;t.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);const E=b.dim;d.activeTexture.set(_.TEXTURE0);let D=t.hillshadeFBO;if(!D){const ne=new a.T(d,{width:E,height:E,data:null},_.RGBA8);ne.bind(_.LINEAR,_.CLAMP_TO_EDGE),D=t.hillshadeFBO=d.createFramebuffer(E,E,!0,"renderbuffer"),D.colorAttachment.set(ne.texture)}d.bindFramebuffer.set(D.framebuffer),d.viewport.set([0,0,E,E]);const{tileBoundsBuffer:U,tileBoundsIndexBuffer:Z,tileBoundsSegments:ie}=c.getMercatorTileBoundsBuffers(),de=[];c.linearFloatFilteringSupported()&&de.push("TERRAIN_DEM_FLOAT_FORMAT"),c.getOrCreateProgram("hillshadePrepare",{defines:de}).draw(c,_.TRIANGLES,cs.disabled,hr.disabled,Fr.unblended,Zs.disabled,((ne,me)=>{const Ce=me.stride,Me=a.bz();return a.c5(Me,0,a.aj,-8192,0,0,1),a.bo(Me,Me,[0,-8192,0]),{u_matrix:Me,u_image:1,u_dimension:[Ce,Ce],u_zoom:ne.overscaledZ}})(t.tileID,b),r.id,U,Z,ie),t.needsHillshadePrepare=!1}class ho{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ka extends ho{getDefault(){return a.am.transparent.toNonPremultipliedRenderColor(null)}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Zf extends ho{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class km extends ho{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class su extends ho{getDefault(){return[!0,!0,!0,!0]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Gp extends ho{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class vn extends ho{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class ea extends ho{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const r=this.current;(t.func!==r.func||t.ref!==r.ref||t.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Vc extends ho{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Uc extends ho{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=t,this.dirty=!1}}class Dr extends ho{getDefault(){return[0,1]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Un extends ho{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=t,this.dirty=!1}}class ln extends ho{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class oc extends ho{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.BLEND):r.disable(r.BLEND),this.current=t,this.dirty=!1}}class Iu extends ho{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class yo extends ho{getDefault(){return a.am.transparent.toNonPremultipliedRenderColor(null)}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class sr extends ho{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class nc extends ho{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=t,this.dirty=!1}}class Id extends ho{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class ru extends ho{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let Hr=class extends ho{getDefault(){return null}set(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)}};class vo extends ho{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class ou extends ho{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Wp extends ho{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class xp extends ho{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ro extends ho{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class _p extends ho{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ku extends ho{getDefault(){return null}set(t){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Lu extends ho{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class og extends ho{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Em extends ho{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class nu extends ho{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Ld extends ho{constructor(t,r){super(t),this.context=t,this.parent=r}getDefault(){return null}}class Cm extends Ld{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Pm extends Ld{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,this.attachment(),r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Kf extends Ld{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,this.attachment(),r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Im extends Pm{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const gf=(c,t,r)=>({u_matrix:c,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:r}),jc=(c,t,r,d,_,b,E,D,U,Z,ie,de,ne,me,Ce,Me)=>({u_proj_matrix:Float32Array.from(c),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:r,u_zoom_transition:_,u_merc_center:b,u_image0:0,u_frustum_tl:E,u_frustum_tr:D,u_frustum_br:U,u_frustum_bl:Z,u_globe_pos:ie,u_globe_radius:de,u_viewport:ne,u_grid_matrix:Me?Float32Array.from(Me):new Float32Array(9),u_skirt_height:me,u_far_z_cutoff:Ce});function Jf(c,t){return c!=null&&t!=null&&!(!c.hasData()||!t.hasData())&&c.demTexture!=null&&t.demTexture!=null&&c.tileID.key!==t.tileID.key}const Ou=new class{constructor(){this.operations={}}newMorphing(c,t,r,d,_){if(c in this.operations){const b=this.operations[c];b.to.tileID.key!==r.tileID.key&&(b.queued=r)}else this.operations[c]={startTime:d,phase:0,duration:_,from:t,to:r,queued:null}}getMorphValuesForProxy(c){if(!(c in this.operations))return null;const t=this.operations[c];return{from:t.from,to:t.to,phase:t.phase}}update(c){for(const t in this.operations){const r=this.operations[t];for(r.phase=(c-r.startTime)/r.duration;r.phase>=1||!this._validOp(r);)if(!this._nextOp(r,c)){delete this.operations[t];break}}}_nextOp(c,t){return!!c.queued&&(c.from=c.to,c.to=c.queued,c.queued=null,c.phase=0,c.startTime=t,!0)}_validOp(c){return c.from.hasData()&&c.to.hasData()}},Lm={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Qf(c,t,r){if(t===0)return 0;const d=t<1&&r===514?.25/t:1;return 6*Math.pow(1.5,22-c)*Math.max(t,1)*d}function em(c,t){const r=1<<c.z;return!t&&(c.x===0||c.x===r-1)||c.y===0||c.y===r-1}const Du=c=>({u_matrix:c});function Bl(c,t,r,d,_){if(_>0){const b=a.q.now(),E=(b-c.timeAdded)/_,D=t?(b-t.timeAdded)/_:-1,U=r.getSource(),Z=d.coveringZoomLevel({tileSize:U.tileSize,roundZoom:U.roundZoom}),ie=!t||Math.abs(t.tileID.overscaledZ-Z)>Math.abs(c.tileID.overscaledZ-Z),de=ie&&c.refreshedUponExpiration?1:a.ay(ie?E:1-D,0,1);return c.refreshedUponExpiration&&E>=1&&(c.refreshedUponExpiration=!1),t?{opacity:1,mix:1-de}:{opacity:de,mix:0}}return{opacity:1,mix:0}}class tm extends Ll{constructor(t){const r={type:"raster-dem",maxzoom:t.transform.maxZoom},d=new a.D(a.c$(),null),_=Gn("mock-dem",r,d,t.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,r){t.state="loaded",r(null)}}class dh extends Ll{constructor(t){const r=Gn("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new a.D(a.c$(),null),t.style);super("proxy",r,!1),r.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,r,d){if(t.freezeTileCoverage)return;this.transform=t;const _=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,E)=>{if(b[E.key]="",!this._tiles[E.key]){const D=new Zh(E,this._source.tileSize*E.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);D.state="loaded",this._tiles[E.key]=D}return b},{});for(const b in this._tiles)b in _||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(t){const r=this.proxyCachedFBO[t];if(r!==void 0){const d=Object.values(r);this.renderCachePool.push(...d),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Gc extends a.aM{constructor(t,r,d){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=r,this.projMatrix=d}}class Ju extends a.dt{constructor(t,r){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[d,_,b]=function(U){const Z=new a.ba,ie=new a.a_,de=131;Z.reserve(17161),ie.reserve(33800);const ne=a.aj/128,me=a.aj+ne/2,Ce=me+ne;for(let Pe=-64;Pe<Ce;Pe+=ne)for(let Ne=-64;Ne<Ce;Ne+=ne){const He=Ne<0||Ne>me||Pe<0||Pe>me?24575:0,lt=a.ay(Math.round(Ne),0,a.aj),ut=a.ay(Math.round(Pe),0,a.aj);Z.emplaceBack(lt+He,ut)}const Me=(Pe,Ne)=>{const He=Ne*de+Pe;ie.emplaceBack(He+1,He,He+de),ie.emplaceBack(He+de,He+de+1,He+1)};for(let Pe=1;Pe<129;Pe++)for(let Ne=1;Ne<129;Ne++)Me(Ne,Pe);return[0,129].forEach(Pe=>{for(let Ne=0;Ne<130;Ne++)Me(Ne,Pe),Me(Pe,Ne)}),[Z,ie,32768]}(),E=t.context;this.gridBuffer=E.createVertexBuffer(d,a.bc.members),this.gridIndexBuffer=E.createIndexBuffer(_),this.gridSegments=a.bd.simpleSegment(0,0,d.length,_.length),this.gridNoSkirtSegments=a.bd.simpleSegment(0,0,d.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new dh(r.map),this.orthoMatrix=a.bz(),a.c5(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,a.aj,0,a.aj,0,1);const D=E.gl;this._overlapStencilMode=new hr({func:D.GEQUAL,mask:255},0,255,D.KEEP,D.KEEP,D.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=r,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new tm(r.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,r,d){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const _=t.terrain.properties,b=t.terrain.drapeRenderMode===0,E=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=a.q.now();const D=t.terrain&&t.terrain.scope,U=_.get("source"),Z=b?this._mockSourceCache:t.getSourceCache(U,D);if(!Z)return void a.w(`Couldn't find terrain source "${U}".`);if(this.sourceCache=Z,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=E?this.calculateExaggeration(r):_.get("exaggeration"),!r.projection.requiresDraping&&E&&this._exaggeration===0)return void this._disable();this.enabled=!0;const ie=()=>{this.sourceCache.used&&a.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const de=this.getScaledDemTileSize();this.sourceCache.update(r,de,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,ie(),this._initializing=!0),ie(),r.updateElevation(!0,d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(r),this._emptyDEMTextureDirty=!0,this._previousZoom=r.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const r=this._previousCameraAltitude,d=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=d;const _=r!=null?d-r:Number.MAX_VALUE;if(Math.abs(_)<2)return this._exaggeration;const b=t.zoom,E=this._style.terrain;if(!this._previousUpdateTimestamp)return E.getExaggeration(b);let D=b-this._previousZoom;const U=this._previousUpdateTimestamp;let Z=b;this._evaluationZoom!=null&&(Z=this._evaluationZoom,Math.abs(b-Z)>.5&&(D=.5*(b-Z+D)),D*_<0&&(Z+=D)),this._evaluationZoom=Z;const ie=E.getExaggeration(Z),de=ie===E.getExaggeration(Math.max(0,Z-.1));if(de&&Math.abs(ie-this._exaggeration)<.01)return ie;let ne=Math.min(.1,.00375*(this._updateTimestamp-U));return(de||ie<.1||Math.abs(D)<1e-4)&&(ne=Math.min(.2,4*ne)),a.ai(this._exaggeration,ie,ne)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const r=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(a.ac.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=r.getIds().map(U=>{const Z=r.getTileByID(U).tileID;return Z.projMatrix=d.calculateProjMatrix(Z.toUnwrapped()),Z});(function(U,Z){const ie=Z.transform.pointCoordinate(Z.transform.getCameraPoint()),de=new a.P(ie.x,ie.y);U.sort((ne,me)=>{if(me.overscaledZ-ne.overscaledZ)return me.overscaledZ-ne.overscaledZ;const Ce=new a.P(ne.canonical.x+(1<<ne.canonical.z)*ne.wrap,ne.canonical.y),Me=new a.P(me.canonical.x+(1<<me.canonical.z)*me.wrap,me.canonical.y),Pe=de.mult(1<<ne.canonical.z);return Pe.x-=.5,Pe.y-=.5,Pe.distSqr(Ce)-Pe.distSqr(Me)})})(_,this.painter);const b=this.proxyToSource||{};this.proxyToSource={},_.forEach(U=>{this.proxyToSource[U.key]={}}),this.terrainTileForTile={};const E=this._style._mergedSourceCaches;for(const U in E){const Z=E[U];if(!Z.used||(Z!==this.sourceCache&&this.resetTileLookupCache(Z.id),this._setupProxiedCoordsForOrtho(Z,t[U],b),Z.usedForTerrain))continue;const ie=t[U];Z.getSource().reparseOverscaled&&this._assignTerrainTiles(ie)}this.proxiedCoords[r.id]=_.map(U=>new Gc(U,U.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1;const D={};this._visibleDemTiles=[];for(const U of this.proxyCoords){const Z=this.terrainTileForTile[U.key];if(!Z)continue;const ie=Z.tileID.key;ie in D||(this._visibleDemTiles.push(Z),D[ie]=ie)}}_assignTerrainTiles(t){this._initializing||t.forEach(r=>{if(this.terrainTileForTile[r.key])return;const d=this._findTileCoveringTileID(r,this.sourceCache);d&&(this.terrainTileForTile[r.key]=d)})}_prepareDEMTextures(){const t=this.painter.context,r=t.gl;for(const d in this.terrainTileForTile){const _=this.terrainTileForTile[d],b=_.dem;!b||_.demTexture&&!_.needsDEMTextureUpload||(t.activeTexture.set(r.TEXTURE1),mf(this.painter,_,b))}}_prepareDemTileUniforms(t,r,d,_){if(!r||r.demTexture==null)return!1;const b=t.tileID.canonical,E=Math.pow(2,r.tileID.canonical.z-b.z),D=_||"";return d[`u_dem_tl${D}`]=[b.x*E%1,b.y*E%1],d[`u_dem_scale${D}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const r=this._visibleDemTiles.reduce((d,_)=>{if(!_.dem)return d;const b=_.dem.tree.minimums[0];return b>0&&t++,d+b},0);return t?r/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,r=t.gl;t.activeTexture.set(r.TEXTURE2);const d=this._getLoadedAreaMinimum(),_=new a.du({width:1,height:1},new Float32Array([d]));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(_,{premultiply:!1}):b=this._emptyDEMTexture=new a.T(t,_,r.R32F,{premultiply:!1}),b}setupElevationDraw(t,r,d){const _=this.painter.context,b=_.gl,E={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};E.u_exaggeration=this.exaggeration();let D=null,U=null,Z=1;if(d&&d.morphing&&this._useVertexMorphing){const me=d.morphing.srcDemTile,Ce=d.morphing.dstDemTile;Z=d.morphing.phase,me&&Ce&&(this._prepareDemTileUniforms(t,me,E,"_prev")&&(U=me),this._prepareDemTileUniforms(t,Ce,E)&&(D=Ce))}const ie=me=>me&&me.demTexture&&this.painter.linearFloatFilteringSupported()?b.LINEAR:b.NEAREST;let de=null;var ne;if(this.enabled?U&&D?(de=D.demTexture,_.activeTexture.set(b.TEXTURE4),U.demTexture.bind(ie(U),b.CLAMP_TO_EDGE),E.u_dem_lerp=Z):(D=this.terrainTileForTile[t.tileID.key],de=this._prepareDemTileUniforms(t,D,E)?D.demTexture:this.emptyDEMTexture):de=this.emptyDEMTexture,_.activeTexture.set(b.TEXTURE2),de&&(E.u_dem_size=(ne=de).size[0]===1?1:ne.size[0]-2,de.bind(ie(D),b.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(d&&d.useDepthForOcclusion,r,E),d&&d.useMeterToDem&&D){const me=(1<<D.tileID.canonical.z)*a.c6(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=me}if(d&&d.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),r.setTerrainUniformValues(_,E),this.painter.transform.projection.name==="globe"){const me=this.globeUniformValues(this.painter.transform,t.tileID.canonical,d&&d.useDenormalizedUpVectorScale);r.setGlobeUniformValues(_,me)}}globeUniformValues(t,r,d){const _=t.projection;return{u_tile_tl_up:_.upVector(r,0,0),u_tile_tr_up:_.upVector(r,a.aj,0),u_tile_br_up:_.upVector(r,a.aj,a.aj),u_tile_bl_up:_.upVector(r,0,a.aj),u_tile_up_scale:d?a.dv(1):_.upVectorScale(r,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const r=this.painter,d=this.painter.context;t.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,r.width,r.height]),r.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,b,E,D,U){if(_.transform.projection.name==="globe")(function(Z,ie,de,ne,me){const Ce=Z.context,Me=Ce.gl;let Pe,Ne;const He=Z.transform,lt=a.dl(Z,Ce,He),ut=(wi,_i)=>{if(Ne===_i)return;const Bi=[Lm[_i],"PROJECTION_GLOBE_VIEW"];lt&&Bi.push("CUSTOM_ANTIALIASING");const Kt=Z.isTileAffectedByFog(wi);Pe=Z.getOrCreateProgram("globeRaster",{defines:Bi,overrideFog:Kt}),Ne=_i},kt=Z.colorModeForRenderPass(),wt=new cs(Me.LEQUAL,cs.ReadWrite,Z.depthRangeFor3D);Ou.update(me);const xt=a.dm(He),pt=[a.aD(He.center.lng),a.aH(He.center.lat)],At=Z.globeSharedBuffers,Ct=[He.width*a.q.devicePixelRatio,He.height*a.q.devicePixelRatio],ti=Float32Array.from(He.globeMatrix),si={useDenormalizedUpVectorScale:!0};{const wi=Z.transform,_i=Qf(wi.zoom,ie.exaggeration(),ie.sourceCache._source.tileSize);Ne=-1;const Bi=Me.TRIANGLES;for(const Kt of ne){const ui=de.getTile(Kt),Ft=hr.disabled,Ai=ie.prevTerrainTileForTile[Kt.key],ai=ie.terrainTileForTile[Kt.key];Jf(Ai,ai)&&Ou.newMorphing(Kt.key,Ai,ai,me,250),Ce.activeTexture.set(Me.TEXTURE0),ui.texture&&ui.texture.bind(Me.LINEAR,Me.CLAMP_TO_EDGE);const Di=Ou.getMorphValuesForProxy(Kt.key),Yi=Di?1:0;Di&&a.L(si,{morphing:{srcDemTile:Di.from,dstDemTile:Di.to,phase:a.dk(Di.phase)}});const Mi=a.dn(Kt.canonical),qi=a.dp(Mi.getCenter().lat),_s=a.dq(Kt.canonical,Mi,qi,wi.worldSize/wi._pixelsPerMercatorPixel),Ts=a.bh(a.dr(Kt.canonical)),us=jc(wi.expandedFarZProjMatrix,ti,xt,Ts,a.ah(wi.zoom),pt,wi.frustumCorners.TL,wi.frustumCorners.TR,wi.frustumCorners.BR,wi.frustumCorners.BL,wi.globeCenterInViewSpace,wi.globeRadius,Ct,_i,wi._farZ,_s);if(ut(Kt,Yi),Pe&&(ie.setupElevationDraw(ui,Pe,si),Z.uploadCommonUniforms(Ce,Pe,Kt.toUnwrapped()),At)){const[Os,Rs,Js]=At.getGridBuffers(qi,_i!==0);Pe.draw(Z,Bi,wt,Ft,kt,Zs.backCCW,us,"globe_raster",Os,Rs,Js)}}}if(At&&(Z.renderDefaultNorthPole||Z.renderDefaultSouthPole)){const wi=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];lt&&wi.push("CUSTOM_ANTIALIASING"),Pe=Z.getOrCreateProgram("globeRaster",{defines:wi});for(const _i of ne){const{x:Bi,y:Kt,z:ui}=_i.canonical,Ft=Kt===0,Ai=Kt===(1<<ui)-1,[ai,Di,Yi,Mi]=At.getPoleBuffers(ui,!1);if(Mi&&(Ft||Ai)){const qi=de.getTile(_i);Ce.activeTexture.set(Me.TEXTURE0),qi.texture&&qi.texture.bind(Me.LINEAR,Me.CLAMP_TO_EDGE);let _s=a.ds(ui,Bi,He);const Ts=a.bh(a.dr(_i.canonical)),us=(Os,Rs)=>Os.draw(Z,Me.TRIANGLES,wt,hr.disabled,kt,Zs.disabled,jc(He.expandedFarZProjMatrix,_s,_s,Ts,0,pt,He.frustumCorners.TL,He.frustumCorners.TR,He.frustumCorners.BR,He.frustumCorners.BL,He.globeCenterInViewSpace,He.globeRadius,Ct,0,He._farZ),"globe_pole_raster",Rs,Yi,Mi);ie.setupElevationDraw(qi,Pe,si),Z.uploadCommonUniforms(Ce,Pe,_i.toUnwrapped()),Ft&&Z.renderDefaultNorthPole&&us(Pe,ai),Ai&&Z.renderDefaultSouthPole&&(_s=a.cE(a.bz(),_s,[1,-1,1]),us(Pe,Di))}}}})(_,b,E,D,U);else{const Z=_.context,ie=Z.gl;let de,ne;const me=_.shadowRenderer,Ce=eh(_,_.longestCutoffRange),Me=kt=>{if(ne===kt)return;const wt=[];wt.push(Lm[kt]),Ce.shouldRenderCutoff&&wt.push("RENDER_CUTOFF"),me&&(wt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),me.useNormalOffset&&wt.push("NORMAL_OFFSET")),de=_.getOrCreateProgram("terrainRaster",{defines:wt}),ne=kt},Pe=_.colorModeForRenderPass(),Ne=new cs(ie.LEQUAL,cs.ReadWrite,_.depthRangeFor3D);Ou.update(U);const He=_.transform,lt=Qf(He.zoom,b.exaggeration(),b.sourceCache._source.tileSize);let ut=[0,0,0];if(me){const kt=_.style.directionalLight,wt=_.style.ambientLight;kt&&wt&&(ut=kd(_.style,kt,wt))}{ne=-1;const kt=ie.TRIANGLES,[wt,xt]=[b.gridIndexBuffer,b.gridSegments];for(const pt of D){const At=E.getTile(pt),Ct=hr.disabled,ti=b.prevTerrainTileForTile[pt.key],si=b.terrainTileForTile[pt.key];Jf(ti,si)&&Ou.newMorphing(pt.key,ti,si,U,250),Z.activeTexture.set(ie.TEXTURE0),At.texture&&At.texture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);const wi=Ou.getMorphValuesForProxy(pt.key),_i=wi?1:0;let Bi;wi&&(Bi={morphing:{srcDemTile:wi.from,dstDemTile:wi.to,phase:a.dk(wi.phase)}});const Kt=gf(pt.projMatrix,em(pt.canonical,He.renderWorldCopies)?lt/10:lt,ut);if(Me(_i),!de)continue;b.setupElevationDraw(At,de,Bi);const ui=pt.toUnwrapped();me&&me.setupShadows(ui,de),_.uploadCommonUniforms(Z,de,ui,null,Ce),de.draw(_,kt,Ne,Ct,Pe,Zs.backCCW,Kt,"terrain_raster",b.gridBuffer,wt,xt)}}}}(r,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,r.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const r=this.painter,d=this.painter.context,_=this.proxySourceCache,b=this.proxiedCoords[_.id],E=this._drapedRenderBatches.shift(),D=r.style.order,U=[];let Z=0;for(const ie of b){const de=_.getTileByID(ie.proxyTileKey),ne=_.proxyCachedFBO[ie.key]?_.proxyCachedFBO[ie.key][t]:void 0,me=ne!==void 0?_.renderCache[ne]:this.pool[Z++],Ce=ne!==void 0;if(de.texture=me.tex,Ce&&!me.dirty){U.push(de.tileID);continue}let Me;d.bindFramebuffer.set(me.fb.framebuffer),this.renderedToTile=!1,me.dirty&&(d.clear({color:a.am.transparent,stencil:0}),me.dirty=!1);for(let Pe=E.start;Pe<=E.end;++Pe){const Ne=r.style._mergedLayers[D[Pe]];if(Ne.isHidden(r.transform.zoom))continue;const He=r.style.getLayerSourceCache(Ne),lt=He?this.proxyToSource[ie.key][He.id]:[ie];if(!lt)continue;const ut=lt;d.viewport.set([0,0,me.fb.width,me.fb.height]),Me!==(He?He.id:null)&&(this._setupStencil(me,lt,Ne,He),Me=He?He.id:null),r.renderLayer(r,He,Ne,ut)}if(this._drapedRenderBatches.length===0)for(const Pe of this._pendingGroundEffectLayers){const Ne=r.style._mergedLayers[D[Pe]];if(Ne.isHidden(r.transform.zoom))continue;const He=r.style.getLayerSourceCache(Ne),lt=He?this.proxyToSource[ie.key][He.id]:[ie];if(!lt)continue;const ut=lt;d.viewport.set([0,0,me.fb.width,me.fb.height]),Me!==(He?He.id:null)&&(this._setupStencil(me,lt,Ne,He),Me=He?He.id:null),r.renderLayer(r,He,Ne,ut)}this.renderedToTile?(me.dirty=!0,U.push(de.tileID)):Ce||--Z,Z===5&&(Z=0,this.renderToBackBuffer(U))}return this.renderToBackBuffer(U),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,r.width,r.height]),E.end+1}postRender(){}isLayerOrderingCorrect(t){const r=t.order.length;let d=-1,_=r;for(let b=0;b<r;++b)this._style.isLayerDraped(t._mergedLayers[t.order[b]])?d=Math.max(d,b):_=Math.min(_,b);return _>d}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(r=>r.dem).forEach(r=>{t=Math.min(t,r.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,r,d){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const E=b.tileID,D=1<<E.overscaledZ,{x:U,y:Z}=E.canonical,ie=U/D,de=(U+1)/D,ne=Z/D,me=(Z+1)/D;return{minx:ie,miny:ne,maxx:de,maxy:me,t:b.dem.tree.raycastRoot(ie,ne,de,me,t,r,d),tile:b}});_.sort((b,E)=>(b.t!==null?b.t:Number.MAX_VALUE)-(E.t!==null?E.t:Number.MAX_VALUE));for(const b of _){if(b.t==null)return null;const E=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,t,r,d);if(E!=null)return E}return null}_createFBO(){const t=this.painter.context,r=t.gl,d=this.drapeBufferSize;t.activeTexture.set(r.TEXTURE0);const _=new a.T(t,{width:d[0],height:d[1],data:null},r.RGBA8);_.bind(r.LINEAR,r.CLAMP_TO_EDGE);const b=t.createFramebuffer(d[0],d[1],!0,null);return b.colorAttachment.set(_.texture),b.depthAttachment=new Im(t,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&r.texParameterf(r.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:b,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const r=this._style._mergedLayers[t],d=r.isHidden(this.painter.transform.zoom);return r.type==="hillshade"||r.type==="custom"?!d&&r.shouldRedrape():!d&&r.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const d of this._style.getSources())if(d instanceof Hh){t=!0;break}if(!t)return;const r={};for(let d=0;d<this._style.order.length;++d){const _=this._style._mergedLayers[this._style.order[d]],b=this._style.getLayerSourceCache(_);if(b&&!r[b.id]&&!_.isHidden(this.painter.transform.zoom)&&_.type==="line"&&_.widthExpression()instanceof a.ab){r[b.id]=!0;for(const E of this.proxyCoords){const D=this.proxyToSource[E.key][b.id];if(D)for(const U of D)this._clearRenderCacheForTile(b.id,U)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const d in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[d]._source instanceof Ua){t=!0;break}if(!t)return;const r={};for(let d=0;d<this._style.order.length;++d){const _=this._style._mergedLayers[this._style.order[d]],b=this._style.getLayerSourceCache(_);if(!b||r[b.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="raster")continue;const E=_.paint.get("raster-fade-duration");for(const D of this.proxyCoords){const U=this.proxyToSource[D.key][b.id];if(U)for(const Z of U){const ie=Bl(b.getTile(Z),b.findLoadedParent(Z,0),b,this.painter.transform,E);(ie.opacity!==1||ie.mix!==0)&&this._clearRenderCacheForTile(b.id,Z)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,r=t.length;if(r===0)return;const d=[];this._pendingGroundEffectLayers=[];let _,b=0,E=this._style._mergedLayers[t[b]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++b<r;)E=this._style._mergedLayers[t[b]];for(;b<r;++b){const D=this._style._mergedLayers[t[b]];D.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(D)?_===void 0&&(_=b):(D.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(b),_!==void 0&&(d.push({start:_,end:b-1}),_=void 0)))}if(_!==void 0&&d.push({start:_,end:b-1}),d.length!==0){const D=d[d.length-1];this._pendingGroundEffectLayers.every(U=>U>D.end)||a.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=d}_setupRenderCache(t){const r=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,r.renderCache.length>r.renderCachePool.length){const E=Object.values(r.proxyCachedFBO);r.proxyCachedFBO={};for(let D=0;D<E.length;++D){const U=Object.values(E[D]);r.renderCachePool.push(...U)}}return}this._clearRasterLayersFromRenderCache();const d=this.proxyCoords,_=this._tilesDirty;for(let E=d.length-1;E>=0;E--){const D=d[E];if(r.getTileByID(D.key),r.proxyCachedFBO[D.key]!==void 0){const U=t[D.key],Z=this.proxyToSource[D.key];let ie=0;for(const de in Z){const ne=Z[de],me=U[de];if(!me||me.length!==ne.length||ne.some((Ce,Me)=>Ce!==me[Me]||_[de]&&_[de].hasOwnProperty(Ce.key))){ie=-1;break}++ie}for(const de in r.proxyCachedFBO[D.key])r.renderCache[r.proxyCachedFBO[D.key][de]].dirty=ie<0||ie!==Object.values(U).length}}const b=[...this._drapedRenderBatches];b.sort((E,D)=>D.end-D.start-(E.end-E.start));for(const E of b)for(const D of d){if(r.proxyCachedFBO[D.key])continue;let U=r.renderCachePool.pop();U===void 0&&r.renderCache.length<50&&(U=r.renderCache.length,r.renderCache.push(this._createFBO())),U!==void 0&&(r.proxyCachedFBO[D.key]={},r.proxyCachedFBO[D.key][E.start]=U,r.renderCache[U].dirty=!0)}this._tilesDirty={}}_setupStencil(t,r,d,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,E=b.gl;if(r.length<=1)return void(this._overlapStencilType=!1);let D;if(d.isTileClipped())D=r.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(r[0].overscaledZ>r[r.length-1].overscaledZ))return void(this._overlapStencilType=!1);D=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+D>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=D,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(r,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):hr.disabled}_renderTileClippingMasks(t,r){const d=this.painter,_=this.painter.context,b=_.gl;d._tileClippingMaskIDs={},_.setColorMode(Fr.disabled),_.setDepthMode(cs.disabled);const E=d.getOrCreateProgram("clippingMask");for(const D of t){const U=d._tileClippingMaskIDs[D.key]=--r;E.draw(d,b.TRIANGLES,cs.disabled,new hr({func:b.ALWAYS,mask:0},U,255,b.KEEP,b.KEEP,b.REPLACE),Fr.disabled,Zs.disabled,Du(D.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(t){const r=this.painter.transform;if(t.x<0||t.x>r.width||t.y<0||t.y>r.height)return null;const d=[t.x,t.y,1,1];a.aA(d,d,r.pixelMatrixInverse),a.cw(d,d,1/d[3]),d[0]/=r.worldSize,d[1]/=r.worldSize;const _=r._camera.position,b=a.c6(1,r.center.lat),E=[_[0],_[1],_[2]/b,0],D=a.cX([],d.slice(0,3),E);a.au(D,D);const U=this.raycast(E,D,this._exaggeration);return U!==null&&U?(a.bE(E,E,D,U),E[3]=E[2],E[2]*=b,E):null}_setupProxiedCoordsForOrtho(t,r,d){if(t.getSource()instanceof a.aP)return this._setupProxiedCoordsForImageSource(t,r,d);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const _=this.proxiedCoords[t.id]=[],b=this.proxyCoords;for(let U=0;U<b.length;U++){const Z=b[U],ie=this._findTileCoveringTileID(Z,t);if(ie){const de=this._createProxiedId(Z,ie,d[Z.key]&&d[Z.key][t.id]);_.push(de),this.proxyToSource[Z.key][t.id]=[de]}}let E=!1;const D=new Set;for(let U=0;U<r.length;U++){const Z=t.getTile(r[U]);if(!Z||!Z.hasData())continue;const ie=this._findTileCoveringTileID(Z.tileID,this.proxySourceCache);if(ie&&ie.tileID.canonical.z!==Z.tileID.canonical.z){const de=this.proxyToSource[ie.tileID.key][t.id],ne=this._createProxiedId(ie.tileID,Z,d[ie.tileID.key]&&d[ie.tileID.key][t.id]);de?de.splice(de.length-1,0,ne):this.proxyToSource[ie.tileID.key][t.id]=[ne];const me=this.proxyToSource[ie.tileID.key][t.id];D.has(me)||D.add(me),_.push(ne),E=!0}}if(this._sourceTilesOverlap[t.id]=E,E&&this._debugParams.sortTilesHiZFirst)for(const U of D)U.sort((Z,ie)=>ie.overscaledZ-Z.overscaledZ)}_setupProxiedCoordsForImageSource(t,r,d){if(!t.getSource().loaded())return;const _=this.proxiedCoords[t.id]=[],b=this.proxyCoords,E=t.getSource(),D=E.tileID;if(!D)return;const U=new a.P(D.x,D.y)._div(1<<D.z),Z=E.coordinates.map(a.ac.fromLngLat).reduce((de,ne)=>(de.min.x=Math.min(de.min.x,ne.x-U.x),de.min.y=Math.min(de.min.y,ne.y-U.y),de.max.x=Math.max(de.max.x,ne.x-U.x),de.max.y=Math.max(de.max.y,ne.y-U.y),de),{min:new a.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),ie=(de,ne)=>{const me=de.wrap+de.canonical.x/(1<<de.canonical.z),Ce=de.canonical.y/(1<<de.canonical.z),Me=a.aj/(1<<de.canonical.z),Pe=ne.wrap+ne.canonical.x/(1<<ne.canonical.z),Ne=ne.canonical.y/(1<<ne.canonical.z);return me+Me<Pe+Z.min.x||me>Pe+Z.max.x||Ce+Me<Ne+Z.min.y||Ce>Ne+Z.max.y};for(let de=0;de<b.length;de++){const ne=b[de];for(let me=0;me<r.length;me++){const Ce=t.getTile(r[me]);if(!Ce||!Ce.hasData()||ie(ne,Ce.tileID))continue;const Me=this._createProxiedId(ne,Ce,d[ne.key]&&d[ne.key][t.id]),Pe=this.proxyToSource[ne.key][t.id];Pe?Pe.push(Me):this.proxyToSource[ne.key][t.id]=[Me],_.push(Me)}}}_createProxiedId(t,r,d){let _=this.orthoMatrix;if(d){const b=d.find(E=>E.key===r.tileID.key);if(b)return b}if(r.tileID.key!==t.key){const b=t.canonical.z-r.tileID.canonical.z;let E,D,U;_=a.bz();const Z=r.tileID.wrap-t.wrap<<t.overscaledZ;b>0?(E=a.aj>>b,D=E*((r.tileID.canonical.x<<b)-t.canonical.x+Z),U=E*((r.tileID.canonical.y<<b)-t.canonical.y)):(E=a.aj<<-b,D=a.aj*(r.tileID.canonical.x-(t.canonical.x+Z<<-b)),U=a.aj*(r.tileID.canonical.y-(t.canonical.y<<-b))),a.c5(_,0,E,0,E,0,1),a.bo(_,_,[D,U,0])}return new Gc(r.tileID,t.key,_)}_findTileCoveringTileID(t,r){let d=r.getTile(t);if(d&&d.hasData())return d;const _=this._findCoveringTileCache[r.id],b=_[t.key];if(d=b?r.getTileByID(b):null,d&&d.hasData()||b===null)return d;let E=d?d.tileID:t,D=E.overscaledZ;const U=r.getSource().minzoom,Z=[];if(!b){const de=r.getSource().maxzoom;if(t.canonical.z>=de){const ne=t.canonical.z-de;r.getSource().reparseOverscaled?(D=Math.max(t.canonical.z+2,r.transform.tileZoom),E=new a.aM(D,t.wrap,de,t.canonical.x>>ne,t.canonical.y>>ne)):ne!==0&&(D=de,E=new a.aM(D,t.wrap,de,t.canonical.x>>ne,t.canonical.y>>ne))}E.key!==t.key&&(Z.push(E.key),d=r.getTile(E))}const ie=de=>{Z.forEach(ne=>{_[ne]=de}),Z.length=0};for(D-=1;D>=U&&(!d||!d.hasData());D--){d&&ie(d.tileID.key);const de=E.calculateScaledKey(D);if(d=r.getTileByID(de),d&&d.hasData())break;const ne=_[de];if(ne===null)break;ne===void 0?Z.push(de):d=r.getTileByID(ne)}return ie(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,r){let d=this._tilesDirty[t];d||(d=this._tilesDirty[t]={}),d[r.key]=!0}}function Hp(c,t,r){const d=function(D,U,Z){const ie=a.bG(U,D),de=a.bG(Z,[.2126,.7152,.0722]),ne=(Ce,Me,Pe)=>(1-Pe)*Ce+Pe*Me,me=ne(1-.3*Math.min(de,1),1,Math.min(ie+1,1));return ne(.92,1,Math.asin(a.ay(U[2],-1,1))/Math.PI+.5)*me}(c,[0,0,1],t),_=[0,0,0];a.bY(_,r.slice(0,3),d);const b=[0,0,0];a.bY(b,t.slice(0,3),c[2]);const E=[0,0,0];return a.cV(E,_,b),a.cY(E)}const Qu=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],ep=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class im{static cacheKey(t,r,d,_){let b=`${r}${_?_.cacheKey:""}`;for(const E of d)t.usedDefines.includes(E)&&(b+=`/${E}`);return b}constructor(t,r,d,_,b,E){const D=t.gl;this.program=D.createProgram(),this.configuration=_,this.name=r,this.fixedDefines=[...E];const U=_?_.getBinderAttributes():[],Z=(d.staticAttributes||[]).concat(U);let ie=_?_.defines():[];ie=ie.concat(E.map(Pe=>`#define ${Pe}`));const de=`#version 300 es
`;let ne=de+ie.concat("precision mediump float;",vc,Rl.fragmentSource).join(`
`);for(const Pe of d.fragmentIncludes)ne+=`
${Zu[Pe]}`;ne+=`
${d.fragmentSource}`;let me=de+ie.concat("precision highp float;",vc,Rl.vertexSource).join(`
`);for(const Pe of d.vertexIncludes)me+=`
${Zu[Pe]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&d.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(me+=`
uniform int u_instanceID;
`),me+=`
${d.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(me=me.replaceAll("gl_InstanceID","u_instanceID"));const Ce=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);D.shaderSource(Ce,ne),D.compileShader(Ce),D.attachShader(this.program,Ce);const Me=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())this.failedToCreate=!0;else{D.shaderSource(Me,me),D.compileShader(Me),D.attachShader(this.program,Me),this.attributes={},this.numAttributes=Z.length;for(let Pe=0;Pe<this.numAttributes;Pe++)if(Z[Pe]){const Ne=Z[Pe].startsWith("a_")?Z[Pe]:`a_${Z[Pe]}`;D.bindAttribLocation(this.program,Pe,Ne),this.attributes[Ne]=Pe}D.linkProgram(this.program),D.deleteShader(Me),D.deleteShader(Ce),this.fixedUniforms=b(t),this.binderUniforms=_?_.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(Pe=>({u_instanceID:new a.c8(Pe)}))(t)),(E.includes("TERRAIN")||r.indexOf("symbol")!==-1||r.indexOf("circle")!==-1)&&(this.terrainUniforms=(Pe=>({u_dem:new a.c8(Pe),u_dem_prev:new a.c8(Pe),u_dem_tl:new a.cb(Pe),u_dem_scale:new a.ca(Pe),u_dem_tl_prev:new a.cb(Pe),u_dem_scale_prev:new a.ca(Pe),u_dem_size:new a.ca(Pe),u_dem_lerp:new a.ca(Pe),u_exaggeration:new a.ca(Pe),u_depth:new a.c8(Pe),u_depth_size_inv:new a.cb(Pe),u_depth_range_unpack:new a.cb(Pe),u_occluder_half_size:new a.ca(Pe),u_occlusion_depth_offset:new a.ca(Pe),u_meter_to_dem:new a.ca(Pe),u_label_plane_matrix_inv:new a.cc(Pe)}))(t)),E.includes("GLOBE")&&(this.globeUniforms=(Pe=>({u_tile_tl_up:new a.c9(Pe),u_tile_tr_up:new a.c9(Pe),u_tile_br_up:new a.c9(Pe),u_tile_bl_up:new a.c9(Pe),u_tile_up_scale:new a.ca(Pe)}))(t)),E.includes("FOG")&&(this.fogUniforms=(Pe=>({u_fog_matrix:new a.cc(Pe),u_fog_range:new a.cb(Pe),u_fog_color:new a.cQ(Pe),u_fog_horizon_blend:new a.ca(Pe),u_fog_vertical_limit:new a.cb(Pe),u_fog_temporal_offset:new a.ca(Pe),u_frustum_tl:new a.c9(Pe),u_frustum_tr:new a.c9(Pe),u_frustum_br:new a.c9(Pe),u_frustum_bl:new a.c9(Pe),u_globe_pos:new a.c9(Pe),u_globe_radius:new a.ca(Pe),u_globe_transition:new a.ca(Pe),u_is_globe:new a.c8(Pe),u_viewport:new a.cb(Pe)}))(t)),E.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Pe=>({u_cutoff_params:new a.cQ(Pe)}))(t)),E.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Pe=>({u_lighting_ambient_color:new a.c9(Pe),u_lighting_directional_dir:new a.c9(Pe),u_lighting_directional_color:new a.c9(Pe),u_ground_radiance:new a.c9(Pe)}))(t)),E.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Pe=>({u_light_matrix_0:new a.cc(Pe),u_light_matrix_1:new a.cc(Pe),u_fade_range:new a.cb(Pe),u_shadow_normal_offset:new a.c9(Pe),u_shadow_intensity:new a.ca(Pe),u_shadow_texel_size:new a.ca(Pe),u_shadow_map_resolution:new a.ca(Pe),u_shadow_direction:new a.c9(Pe),u_shadow_bias:new a.c9(Pe),u_shadowmap_0:new a.c8(Pe),u_shadowmap_1:new a.c8(Pe)}))(t))}}setTerrainUniformValues(t,r){if(!this.terrainUniforms)return;const d=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in r)d[_]&&d[_].set(this.program,_,r[_])}}setGlobeUniformValues(t,r){if(!this.globeUniforms)return;const d=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in r)d[_]&&d[_].set(this.program,_,r[_])}}setFogUniformValues(t,r){if(!this.fogUniforms)return;const d=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in r)d[_].set(this.program,_,r[_])}}setCutoffUniformValues(t,r){if(!this.cutoffUniforms)return;const d=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in r)d[_].set(this.program,_,r[_])}}setLightsUniformValues(t,r){if(!this.lightsUniforms)return;const d=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in r)d[_].set(this.program,_,r[_])}}setShadowUniformValues(t,r){if(this.failedToCreate||!this.shadowUniforms)return;const d=this.shadowUniforms;t.program.set(this.program);for(const _ in r)d[_].set(this.program,_,r[_])}_drawDebugWireframe(t,r,d,_,b,E,D,U,Z,ie){const de=t.options.wireframe;if(de.terrain===!1&&de.layers2D===!1&&de.layers3D===!1)return;const ne=t.context;if(!(!(!de.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!de.layers2D||t._terrain&&t._terrain.renderingToTexture||!Qu.includes(this.name))||!(!de.layers3D||!ep.includes(this.name))))return;const me=ne.gl,Ce=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,b,ne);if(!Ce)return;const Me=[...this.fixedDefines];Me.push("DEBUG_WIREFRAME");const Pe=t.getOrCreateProgram(this.name,{config:this.configuration,defines:Me});ne.program.set(Pe.program);const Ne=(ut,kt,wt)=>{if(kt[ut]&&wt[ut])for(const xt in kt[ut])wt[ut][xt]&&wt[ut][xt].set(wt.program,xt,kt[ut][xt].current)};Z&&Z.setUniforms(Pe.program,ne,Pe.binderUniforms,D,{zoom:U}),Ne("fixedUniforms",this,Pe),Ne("terrainUniforms",this,Pe),Ne("globeUniforms",this,Pe),Ne("fogUniforms",this,Pe),Ne("lightsUniforms",this,Pe),Ne("shadowUniforms",this,Pe),Ce.bind(),ne.setColorMode(new Fr([me.ONE,me.ONE_MINUS_SRC_ALPHA,me.ZERO,me.ONE],a.am.transparent,[!0,!0,!0,!1])),ne.setDepthMode(new cs(r.func===me.LESS?me.LEQUAL:r.func,cs.ReadOnly,r.range)),ne.setStencilMode(hr.disabled);const He=3*E.primitiveLength*2,lt=3*E.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ut=ie||1;for(let kt=0;kt<ut;++kt)Pe.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",kt),me.drawElements(me.LINES,He,me.UNSIGNED_SHORT,lt)}else ie&&ie>1?me.drawElementsInstanced(me.LINES,He,me.UNSIGNED_SHORT,lt,ie):me.drawElements(me.LINES,He,me.UNSIGNED_SHORT,lt);b.bind(),ne.program.set(this.program),ne.setDepthMode(r),ne.setStencilMode(d),ne.setColorMode(_)}checkUniforms(t,r,d){if(this.fixedDefines.includes(r)){for(const _ of Object.keys(d))if(!d[_].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${_} not set but required by ${r} being defined`)}}draw(t,r,d,_,b,E,D,U,Z,ie,de,ne,me,Ce,Me,Pe){const Ne=t.context,He=Ne.gl;if(this.failedToCreate)return;Ne.program.set(this.program),Ne.setDepthMode(d),Ne.setStencilMode(_),Ne.setColorMode(b),Ne.setCullFace(E);for(const kt of Object.keys(this.fixedUniforms))this.fixedUniforms[kt].set(this.program,kt,D[kt]);Ce&&Ce.setUniforms(this.program,Ne,this.binderUniforms,ne,{zoom:me});const lt={[He.POINTS]:1,[He.LINES]:2,[He.TRIANGLES]:3,[He.LINE_STRIP]:1}[r];this.checkUniforms(U,"RENDER_SHADOWS",this.shadowUniforms);const ut=Pe&&Pe>0?1:void 0;for(const kt of de.get()){const wt=kt.vaos||(kt.vaos={});if((wt[U]||(wt[U]=new rc)).bind(Ne,this,Z,Ce?Ce.getPaintVertexBuffers():[],ie,kt.vertexOffset,Me||[],ut),this.forceManualRenderingForInstanceIDShaders){const xt=Pe||1;for(let pt=0;pt<xt;++pt)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",pt),ie?He.drawElements(r,kt.primitiveLength*lt,He.UNSIGNED_SHORT,kt.primitiveOffset*lt*2):He.drawArrays(r,kt.vertexOffset,kt.vertexLength)}else Pe&&Pe>1?He.drawElementsInstanced(r,kt.primitiveLength*lt,He.UNSIGNED_SHORT,kt.primitiveOffset*lt*2,Pe):ie?He.drawElements(r,kt.primitiveLength*lt,He.UNSIGNED_SHORT,kt.primitiveOffset*lt*2):He.drawArrays(r,kt.vertexOffset,kt.vertexLength);r===He.TRIANGLES&&ie&&this._drawDebugWireframe(t,d,_,b,ie,kt,ne,me,Ce,Pe)}}}function Od(c,t,r=0){const d=Math.pow(2,t.tileID.overscaledZ),_=t.tileSize*Math.pow(2,c.transform.tileZoom)/d,b=_*(t.tileID.canonical.x+t.tileID.wrap*d),E=_*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/a.aw(t,1,c.transform.tileZoom),u_pixel_coord_upper:[b>>16,E>>16],u_pixel_coord_lower:[65535&b,65535&E],u_pattern_transition:r}}const au={terrain:0,flat:1},sm=a.bz(),Xp=(c,t,r,d,_,b,E,D,U,Z,ie,de,ne,me,Ce,Me,Pe,Ne)=>{const He=t.style.light,lt=He.properties.get("position"),ut=[lt.x,lt.y,lt.z],kt=a.dx();He.properties.get("anchor")==="viewport"&&(a.dy(kt,-t.transform.angle),a.dz(ut,ut,kt));const wt=He.properties.get("color").toPremultipliedRenderColor(null),xt=t.transform,pt={u_matrix:c,u_lightpos:ut,u_lightintensity:He.properties.get("intensity"),u_lightcolor:[wt.r,wt.g,wt.b],u_vertical_gradient:+r,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:sm,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:au[Z],u_base_type:au[ie],u_ao:_,u_edge_radius:b,u_width_scale:E,u_flood_light_color:Ce,u_vertical_scale:Me,u_flood_light_intensity:Pe,u_ground_shadow_factor:Ne};return xt.projection.name==="globe"&&(pt.u_tile_id=[D.canonical.x,D.canonical.y,1<<D.canonical.z],pt.u_zoom_transition=de,pt.u_inv_rot_matrix=me,pt.u_merc_center=ne,pt.u_up_dir=xt.projection.upVector(new a.cp(0,0,0),ne[0]*a.aj,ne[1]*a.aj),pt.u_height_lift=U),pt},rm=(c,t,r,d,_,b)=>({u_matrix:c,u_edge_radius:t,u_width_scale:r,u_vertical_scale:d,u_height_type:au[_],u_base_type:au[b]}),yf=(c,t,r,d,_,b,E,D,U,Z,ie,de,ne,me,Ce,Me,Pe,Ne)=>{const He=Xp(c,t,r,d,_,b,E,D,Z,ie,de,ne,me,Ce,Me,Pe,1,[0,0,0]),lt={u_height_factor:-Math.pow(2,D.overscaledZ)/U.tileSize/8};return a.h(He,Od(t,U,Ne),lt)},ld=(c,t,r)=>({u_matrix:c,u_emissive_strength:t,u_ground_shadow_factor:r}),zu=(c,t,r,d,_,b=0)=>a.h(ld(c,t,_),Od(r,d,b)),ng=(c,t,r,d)=>({u_matrix:c,u_world:r,u_emissive_strength:t,u_ground_shadow_factor:d}),ag=(c,t,r,d,_,b,E=0)=>a.h(zu(c,t,r,d,b,E),{u_world:_}),Yp=(c,t)=>({u_matrix:c,u_ground_shadow_factor:t}),Lh=(c,t,r,d,_)=>({u_matrix:c,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:r,u_height_scale:d,u_reset_depth:_}),lg=(c,t,r,d)=>{const _=a.aj/r.tileSize;return{u_matrix:c,u_camera_to_center_distance:t.getCameraToCenterDistance(d),u_extrude_scale:[t.pixelsToGLUnits[0]/_,t.pixelsToGLUnits[1]/_]}},$p=(c,t,r=1)=>({u_matrix:c,u_color:t,u_overlay:0,u_overlay_scale:r}),xf=a.bz(),_f=(c,t,r,d,_,b,E)=>{const D=c.transform,U=D.projection.name==="globe",Z=U?a.dA(D.zoom,t.canonical)*D._pixelsPerMercatorPixel:a.aw(r,1,b),ie={u_matrix:t.projMatrix,u_extrude_scale:Z,u_intensity:E,u_inv_rot_matrix:xf,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(U){ie.u_inv_rot_matrix=d,ie.u_merc_center=_,ie.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],ie.u_zoom_transition=a.ah(D.zoom);const de=_[0]*a.aj,ne=_[1]*a.aj;ie.u_up_dir=D.projection.upVector(new a.cp(0,0,0),de,ne)}return ie};function Oh(c,[t,r,d,_],[b,E]){if(b===E)return[0,0,0,0];const D=255*(c-1)/(c*(E-b));return[t*D,r*D,d*D,_*D]}function om(c,t,[r,d]){return r===d?0:.5/c+(t-r)*(c-1)/(c*(d-r))}const Ru=(c,t,r,d,_,b,E,D,U,Z,ie,de,ne,me,Ce,Me,Pe,Ne,He,lt,ut)=>({u_matrix:c,u_normalize_matrix:t,u_globe_matrix:r,u_merc_matrix:d,u_grid_matrix:_,u_tl_parent:b,u_scale_parent:Z,u_fade_t:ie.mix,u_opacity:ie.opacity*de.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:de.paint.get("raster-brightness-min"),u_brightness_high:de.paint.get("raster-brightness-max"),u_saturation_factor:a.dC(de.paint.get("raster-saturation")),u_contrast_factor:a.dB(de.paint.get("raster-contrast")),u_spin_weights:vf(de.paint.get("raster-hue-rotate")),u_perspective_transform:ne,u_raster_elevation:me,u_zoom_transition:E,u_merc_center:D,u_cutoff_params:U,u_colorization_mix:Oh(a.dD,Me,Ne),u_colorization_offset:om(a.dD,Pe,Ne),u_color_ramp:Ce,u_texture_offset:[lt/(He+2*lt),He/(He+2*lt)],u_texture_res:[He+2*lt,He+2*lt],u_emissive_strength:ut});function vf(c){c*=Math.PI/180;const t=Math.sin(c),r=Math.cos(c);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}const lu=.05,ac=(c,t,r,d,_,b,E,D,U,Z,ie,de)=>({u_matrix:c,u_normalize_matrix:t,u_globe_matrix:r,u_merc_matrix:d,u_grid_matrix:_,u_tl_parent:b,u_scale_parent:Z,u_fade_t:ie.mix,u_opacity:ie.opacity,u_image0:0,u_image1:1,u_raster_elevation:de,u_zoom_transition:E,u_merc_center:D,u_cutoff_params:U}),qp=(c,t,r,d,_,b,E,D,U,Z)=>({u_particle_texture:c,u_particle_texture_side_len:t,u_tile_offset:r,u_velocity:d,u_color_ramp:b,u_velocity_res:_,u_max_speed:E,u_uv_offset:D,u_data_scale:[255*U[0],255*U[1]],u_data_offset:Z,u_particle_pos_scale:1.1,u_particle_pos_offset:[lu,lu]}),lc=(c,t,r,d,_,b,E,D,U,Z)=>({u_particle_texture:c,u_particle_texture_side_len:t,u_velocity:r,u_velocity_res:d,u_max_speed:_,u_speed_factor:b,u_reset_rate:E,u_rand_seed:Math.random(),u_uv_offset:D,u_data_scale:[255*U[0],255*U[1]],u_data_offset:Z,u_particle_pos_scale:1.1,u_particle_pos_offset:[lu,lu]}),vp=a.bz(),bp=(c,t,r,d,_,b,E,D,U,Z,ie,de,ne,me,Ce,Me,Pe,Ne,He,lt,ut,kt,wt,xt)=>{const pt=_.transform,At={u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:pt.getCameraToCenterDistance(He),u_rotate_symbol:+r,u_aspect_ratio:pt.width/pt.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:E,u_coord_matrix:D,u_is_text:+Z,u_elevation_from_sea:U?1:0,u_pitch_with_map:+d,u_texsize:ie,u_texsize_icon:de,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:vp,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:vp,u_up_vector:[0,-1,0],u_color_adj_mat:kt,u_icon_transition:wt||0,u_gamma_scale:d?_.transform.getCameraToCenterDistance(He)*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:a.q.devicePixelRatio,u_is_halo:1,u_scale_factor:xt||1,u_ground_shadow_factor:lt,u_inv_matrix:a.bi(a.bz(),E),u_normal_scale:ut};return He.name==="globe"&&(At.u_tile_id=[me.canonical.x,me.canonical.y,1<<me.canonical.z],At.u_zoom_transition=Ce,At.u_inv_rot_matrix=Pe,At.u_merc_center=Me,At.u_camera_forward=pt._camera.forward(),At.u_ecef_origin=a.dE(pt.globeMatrix,me.toUnwrapped()),At.u_tile_matrix=Float32Array.from(pt.globeMatrix),At.u_up_vector=Ne),At},nm=(c,t,r,d)=>({u_matrix:c,u_emissive_strength:t,u_opacity:r,u_color:d}),Om=(c,t,r,d,_,b,E,D,U)=>a.h(function(Z,ie,de,ne,me,Ce){const{width:Me,height:Pe}=ne.imageManager.getPixelSize(ie),Ne=Math.pow(2,Ce.tileID.overscaledZ),He=Ce.tileSize*Math.pow(2,ne.transform.tileZoom)/Ne,lt=He*(Ce.tileID.canonical.x+Ce.tileID.wrap*Ne),ut=He*Ce.tileID.canonical.y;return{u_image:0,u_pattern_tl:de.tl,u_pattern_br:de.br,u_texsize:[Me,Pe],u_pattern_size:de.displaySize,u_pattern_units_to_pixels:me?[ne.transform.width,-1*ne.transform.height]:[1/a.aw(Ce,1,ne.transform.tileZoom),1/a.aw(Ce,1,ne.transform.tileZoom)],u_pixel_coord_upper:[lt>>16,ut>>16],u_pixel_coord_lower:[65535&lt,65535&ut]}}(0,b,E,d,D,U),{u_matrix:c,u_emissive_strength:t,u_opacity:r}),hd=new Float32Array(a.bx([])),Bu=(c,t,r,d,_,b,E,D,U,Z,ie,de,ne,me=[0,0,0],Ce)=>{const Me=_.style.light,Pe=Me.properties.get("position"),Ne=[-Pe.x,-Pe.y,Pe.z],He=a.dx();Me.properties.get("anchor")==="viewport"&&(a.dy(He,-_.transform.angle),a.dz(Ne,Ne,He));const lt=ie.alphaMode==="MASK",ut=Me.properties.get("color").toNonPremultipliedRenderColor(null),kt=ne.paint.get("model-ambient-occlusion-intensity"),wt=ne.paint.get("model-color").constantOr(a.am.white).toNonPremultipliedRenderColor(null);return wt.a=ne.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:c,u_lighting_matrix:t,u_normal_matrix:r,u_node_matrix:d||hd,u_lightpos:Ne,u_lightintensity:Me.properties.get("intensity"),u_lightcolor:[ut.r,ut.g,ut.b],u_camera_pos:me,u_opacity:b,u_baseTextureIsAlpha:0,u_alphaMask:+lt,u_alphaCutoff:ie.alphaCutoff,u_baseColorFactor:E.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:D.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:U,u_roughnessFactor:Z,u_baseColorTexture:Qa.BaseColor,u_metallicRoughnessTexture:Qa.MetallicRoughness,u_normalTexture:Qa.Normal,u_occlusionTexture:Qa.Occlusion,u_emissionTexture:Qa.Emission,u_lutTexture:Qa.LUT,u_color_mix:wt.toArray01(),u_aoIntensity:kt,u_emissive_strength:de,u_occlusionTextureTransform:Ce||[0,0,0,0]}},Zp=(c,t=hd,r=hd)=>({u_matrix:c,u_instance:t,u_node_matrix:r}),Wc={fillExtrusion:c=>({u_matrix:new a.cc(c),u_lightpos:new a.c9(c),u_lightintensity:new a.ca(c),u_lightcolor:new a.c9(c),u_vertical_gradient:new a.ca(c),u_opacity:new a.ca(c),u_edge_radius:new a.ca(c),u_width_scale:new a.ca(c),u_ao:new a.cb(c),u_height_type:new a.c8(c),u_base_type:new a.c8(c),u_tile_id:new a.c9(c),u_zoom_transition:new a.ca(c),u_inv_rot_matrix:new a.cc(c),u_merc_center:new a.cb(c),u_up_dir:new a.c9(c),u_height_lift:new a.ca(c),u_flood_light_color:new a.c9(c),u_vertical_scale:new a.ca(c),u_flood_light_intensity:new a.ca(c),u_ground_shadow_factor:new a.c9(c)}),fillExtrusionDepth:c=>({u_matrix:new a.cc(c),u_edge_radius:new a.ca(c),u_width_scale:new a.ca(c),u_vertical_scale:new a.ca(c),u_height_type:new a.c8(c),u_base_type:new a.c8(c)}),fillExtrusionPattern:c=>({u_matrix:new a.cc(c),u_lightpos:new a.c9(c),u_lightintensity:new a.ca(c),u_lightcolor:new a.c9(c),u_vertical_gradient:new a.ca(c),u_height_factor:new a.ca(c),u_edge_radius:new a.ca(c),u_width_scale:new a.ca(c),u_ao:new a.cb(c),u_height_type:new a.c8(c),u_base_type:new a.c8(c),u_tile_id:new a.c9(c),u_zoom_transition:new a.ca(c),u_inv_rot_matrix:new a.cc(c),u_merc_center:new a.cb(c),u_up_dir:new a.c9(c),u_height_lift:new a.ca(c),u_image:new a.c8(c),u_texsize:new a.cb(c),u_pixel_coord_upper:new a.cb(c),u_pixel_coord_lower:new a.cb(c),u_tile_units_to_pixels:new a.ca(c),u_opacity:new a.ca(c),u_pattern_transition:new a.ca(c)}),fillExtrusionGroundEffect:c=>({u_matrix:new a.cc(c),u_opacity:new a.ca(c),u_ao_pass:new a.ca(c),u_meter_to_tile:new a.ca(c),u_ao:new a.cb(c),u_flood_light_intensity:new a.ca(c),u_flood_light_color:new a.c9(c),u_attenuation:new a.ca(c),u_edge_radius:new a.ca(c),u_fb:new a.c8(c),u_fb_size:new a.ca(c),u_dynamic_offset:new a.ca(c)}),fill:c=>({u_matrix:new a.cc(c),u_emissive_strength:new a.ca(c),u_ground_shadow_factor:new a.c9(c)}),fillPattern:c=>({u_matrix:new a.cc(c),u_emissive_strength:new a.ca(c),u_image:new a.c8(c),u_texsize:new a.cb(c),u_pixel_coord_upper:new a.cb(c),u_pixel_coord_lower:new a.cb(c),u_tile_units_to_pixels:new a.ca(c),u_ground_shadow_factor:new a.c9(c),u_pattern_transition:new a.ca(c)}),fillOutline:c=>({u_matrix:new a.cc(c),u_emissive_strength:new a.ca(c),u_world:new a.cb(c),u_ground_shadow_factor:new a.c9(c)}),fillOutlinePattern:c=>({u_matrix:new a.cc(c),u_emissive_strength:new a.ca(c),u_world:new a.cb(c),u_image:new a.c8(c),u_texsize:new a.cb(c),u_pixel_coord_upper:new a.cb(c),u_pixel_coord_lower:new a.cb(c),u_tile_units_to_pixels:new a.ca(c),u_ground_shadow_factor:new a.c9(c),u_pattern_transition:new a.ca(c)}),building:c=>({u_matrix:new a.cc(c),u_normal_matrix:new a.cc(c),u_opacity:new a.ca(c)}),buildingDepth:c=>({u_matrix:new a.cc(c)}),elevatedStructuresDepth:c=>({u_matrix:new a.cc(c),u_depth_bias:new a.ca(c)}),elevatedStructures:c=>({u_matrix:new a.cc(c),u_ground_shadow_factor:new a.c9(c)}),elevatedStructuresDepthReconstruct:c=>({u_matrix:new a.cc(c),u_camera_pos:new a.c9(c),u_depth_bias:new a.ca(c),u_height_scale:new a.ca(c),u_reset_depth:new a.ca(c)}),circle:a.dH,collisionBox:c=>({u_matrix:new a.cc(c),u_camera_to_center_distance:new a.ca(c),u_extrude_scale:new a.cb(c)}),collisionCircle:c=>({u_matrix:new a.cc(c),u_inv_matrix:new a.cc(c),u_camera_to_center_distance:new a.ca(c),u_viewport_size:new a.cb(c)}),debug:c=>({u_color:new a.di(c),u_matrix:new a.cc(c),u_overlay:new a.c8(c),u_overlay_scale:new a.ca(c)}),clippingMask:c=>({u_matrix:new a.cc(c)}),heatmap:c=>({u_extrude_scale:new a.ca(c),u_intensity:new a.ca(c),u_matrix:new a.cc(c),u_inv_rot_matrix:new a.cc(c),u_merc_center:new a.cb(c),u_tile_id:new a.c9(c),u_zoom_transition:new a.ca(c),u_up_dir:new a.c9(c)}),heatmapTexture:c=>({u_image:new a.c8(c),u_color_ramp:new a.c8(c),u_opacity:new a.ca(c)}),hillshade:c=>({u_matrix:new a.cc(c),u_image:new a.c8(c),u_latrange:new a.cb(c),u_light:new a.cb(c),u_shadow:new a.di(c),u_highlight:new a.di(c),u_emissive_strength:new a.ca(c),u_accent:new a.di(c)}),hillshadePrepare:c=>({u_matrix:new a.cc(c),u_image:new a.c8(c),u_dimension:new a.cb(c),u_zoom:new a.ca(c)}),line:a.dG,linePattern:a.dF,raster:c=>({u_matrix:new a.cc(c),u_normalize_matrix:new a.cc(c),u_globe_matrix:new a.cc(c),u_merc_matrix:new a.cc(c),u_grid_matrix:new a.dj(c),u_tl_parent:new a.cb(c),u_scale_parent:new a.ca(c),u_fade_t:new a.ca(c),u_opacity:new a.ca(c),u_image0:new a.c8(c),u_image1:new a.c8(c),u_brightness_low:new a.ca(c),u_brightness_high:new a.ca(c),u_saturation_factor:new a.ca(c),u_contrast_factor:new a.ca(c),u_spin_weights:new a.c9(c),u_perspective_transform:new a.cb(c),u_raster_elevation:new a.ca(c),u_zoom_transition:new a.ca(c),u_merc_center:new a.cb(c),u_cutoff_params:new a.cQ(c),u_colorization_mix:new a.cQ(c),u_colorization_offset:new a.ca(c),u_color_ramp:new a.c8(c),u_texture_offset:new a.cb(c),u_texture_res:new a.cb(c),u_emissive_strength:new a.ca(c)}),rasterParticle:c=>({u_matrix:new a.cc(c),u_normalize_matrix:new a.cc(c),u_globe_matrix:new a.cc(c),u_merc_matrix:new a.cc(c),u_grid_matrix:new a.dj(c),u_tl_parent:new a.cb(c),u_scale_parent:new a.ca(c),u_fade_t:new a.ca(c),u_opacity:new a.ca(c),u_image0:new a.c8(c),u_image1:new a.c8(c),u_raster_elevation:new a.ca(c),u_zoom_transition:new a.ca(c),u_merc_center:new a.cb(c),u_cutoff_params:new a.cQ(c)}),rasterParticleTexture:c=>({u_texture:new a.c8(c),u_opacity:new a.ca(c)}),rasterParticleDraw:c=>({u_particle_texture:new a.c8(c),u_particle_texture_side_len:new a.ca(c),u_tile_offset:new a.cb(c),u_velocity:new a.c8(c),u_color_ramp:new a.c8(c),u_velocity_res:new a.cb(c),u_max_speed:new a.ca(c),u_uv_offset:new a.cb(c),u_data_scale:new a.cb(c),u_data_offset:new a.ca(c),u_particle_pos_scale:new a.ca(c),u_particle_pos_offset:new a.cb(c)}),rasterParticleUpdate:c=>({u_particle_texture:new a.c8(c),u_particle_texture_side_len:new a.ca(c),u_velocity:new a.c8(c),u_velocity_res:new a.cb(c),u_max_speed:new a.ca(c),u_speed_factor:new a.ca(c),u_reset_rate:new a.ca(c),u_rand_seed:new a.ca(c),u_uv_offset:new a.cb(c),u_data_scale:new a.cb(c),u_data_offset:new a.ca(c),u_particle_pos_scale:new a.ca(c),u_particle_pos_offset:new a.cb(c)}),symbol:c=>({u_is_size_zoom_constant:new a.c8(c),u_is_size_feature_constant:new a.c8(c),u_size_t:new a.ca(c),u_size:new a.ca(c),u_camera_to_center_distance:new a.ca(c),u_rotate_symbol:new a.c8(c),u_aspect_ratio:new a.ca(c),u_fade_change:new a.ca(c),u_matrix:new a.cc(c),u_label_plane_matrix:new a.cc(c),u_coord_matrix:new a.cc(c),u_is_text:new a.c8(c),u_elevation_from_sea:new a.c8(c),u_pitch_with_map:new a.c8(c),u_texsize:new a.cb(c),u_texsize_icon:new a.cb(c),u_texture:new a.c8(c),u_texture_icon:new a.c8(c),u_gamma_scale:new a.ca(c),u_device_pixel_ratio:new a.ca(c),u_tile_id:new a.c9(c),u_zoom_transition:new a.ca(c),u_inv_rot_matrix:new a.cc(c),u_merc_center:new a.cb(c),u_camera_forward:new a.c9(c),u_tile_matrix:new a.cc(c),u_up_vector:new a.c9(c),u_ecef_origin:new a.c9(c),u_is_halo:new a.c8(c),u_icon_transition:new a.ca(c),u_color_adj_mat:new a.cc(c),u_scale_factor:new a.ca(c),u_ground_shadow_factor:new a.c9(c),u_inv_matrix:new a.cc(c),u_normal_scale:new a.ca(c)}),background:c=>({u_matrix:new a.cc(c),u_emissive_strength:new a.ca(c),u_opacity:new a.ca(c),u_color:new a.di(c)}),backgroundPattern:c=>({u_matrix:new a.cc(c),u_emissive_strength:new a.ca(c),u_opacity:new a.ca(c),u_image:new a.c8(c),u_pattern_tl:new a.cb(c),u_pattern_br:new a.cb(c),u_texsize:new a.cb(c),u_pattern_size:new a.cb(c),u_pixel_coord_upper:new a.cb(c),u_pixel_coord_lower:new a.cb(c),u_pattern_units_to_pixels:new a.cb(c)}),terrainRaster:c=>({u_matrix:new a.cc(c),u_image0:new a.c8(c),u_skirt_height:new a.ca(c),u_ground_shadow_factor:new a.c9(c)}),skybox:c=>({u_matrix:new a.cc(c),u_sun_direction:new a.c9(c),u_cubemap:new a.c8(c),u_opacity:new a.ca(c),u_temporal_offset:new a.ca(c)}),skyboxGradient:c=>({u_matrix:new a.cc(c),u_color_ramp:new a.c8(c),u_center_direction:new a.c9(c),u_radius:new a.ca(c),u_opacity:new a.ca(c),u_temporal_offset:new a.ca(c)}),skyboxCapture:c=>({u_matrix_3f:new a.dj(c),u_sun_direction:new a.c9(c),u_sun_intensity:new a.ca(c),u_color_tint_r:new a.cQ(c),u_color_tint_m:new a.cQ(c),u_luminance:new a.ca(c)}),globeRaster:c=>({u_proj_matrix:new a.cc(c),u_globe_matrix:new a.cc(c),u_normalize_matrix:new a.cc(c),u_merc_matrix:new a.cc(c),u_zoom_transition:new a.ca(c),u_merc_center:new a.cb(c),u_image0:new a.c8(c),u_grid_matrix:new a.dj(c),u_skirt_height:new a.ca(c),u_far_z_cutoff:new a.ca(c),u_frustum_tl:new a.c9(c),u_frustum_tr:new a.c9(c),u_frustum_br:new a.c9(c),u_frustum_bl:new a.c9(c),u_globe_pos:new a.c9(c),u_globe_radius:new a.ca(c),u_viewport:new a.cb(c)}),globeAtmosphere:c=>({u_frustum_tl:new a.c9(c),u_frustum_tr:new a.c9(c),u_frustum_br:new a.c9(c),u_frustum_bl:new a.c9(c),u_horizon:new a.ca(c),u_transition:new a.ca(c),u_fadeout_range:new a.ca(c),u_color:new a.cQ(c),u_high_color:new a.cQ(c),u_space_color:new a.cQ(c),u_temporal_offset:new a.ca(c),u_horizon_angle:new a.ca(c)}),model:c=>({u_matrix:new a.cc(c),u_lighting_matrix:new a.cc(c),u_normal_matrix:new a.cc(c),u_node_matrix:new a.cc(c),u_lightpos:new a.c9(c),u_lightintensity:new a.ca(c),u_lightcolor:new a.c9(c),u_camera_pos:new a.c9(c),u_opacity:new a.ca(c),u_baseColorFactor:new a.cQ(c),u_emissiveFactor:new a.cQ(c),u_metallicFactor:new a.ca(c),u_roughnessFactor:new a.ca(c),u_baseTextureIsAlpha:new a.c8(c),u_alphaMask:new a.c8(c),u_alphaCutoff:new a.ca(c),u_baseColorTexture:new a.c8(c),u_metallicRoughnessTexture:new a.c8(c),u_normalTexture:new a.c8(c),u_occlusionTexture:new a.c8(c),u_emissionTexture:new a.c8(c),u_lutTexture:new a.c8(c),u_color_mix:new a.cQ(c),u_aoIntensity:new a.ca(c),u_emissive_strength:new a.ca(c),u_occlusionTextureTransform:new a.cQ(c)}),modelDepth:c=>({u_matrix:new a.cc(c),u_instance:new a.cc(c),u_node_matrix:new a.cc(c)}),groundShadow:c=>({u_matrix:new a.cc(c),u_ground_shadow_factor:new a.c9(c)}),stars:c=>({u_matrix:new a.cc(c),u_up:new a.c9(c),u_right:new a.c9(c),u_intensity_multiplier:new a.ca(c)}),snowParticle:c=>({u_modelview:new a.cc(c),u_projection:new a.cc(c),u_time:new a.ca(c),u_cam_pos:new a.c9(c),u_velocityConeAperture:new a.ca(c),u_velocity:new a.ca(c),u_horizontalOscillationRadius:new a.ca(c),u_horizontalOscillationRate:new a.ca(c),u_boxSize:new a.ca(c),u_billboardSize:new a.ca(c),u_simpleShapeParameters:new a.cb(c),u_screenSize:new a.cb(c),u_thinningCenterPos:new a.cb(c),u_thinningShape:new a.c9(c),u_thinningAffectedRatio:new a.ca(c),u_thinningParticleOffset:new a.ca(c),u_particleColor:new a.cQ(c),u_direction:new a.c9(c)}),rainParticle:c=>({u_modelview:new a.cc(c),u_projection:new a.cc(c),u_time:new a.ca(c),u_cam_pos:new a.c9(c),u_texScreen:new a.c8(c),u_velocityConeAperture:new a.ca(c),u_velocity:new a.ca(c),u_boxSize:new a.ca(c),u_rainDropletSize:new a.cb(c),u_distortionStrength:new a.ca(c),u_rainDirection:new a.c9(c),u_color:new a.cQ(c),u_screenSize:new a.cb(c),u_thinningCenterPos:new a.cb(c),u_thinningShape:new a.c9(c),u_thinningAffectedRatio:new a.ca(c),u_thinningParticleOffset:new a.ca(c),u_shapeDirectionalPower:new a.ca(c),u_shapeNormalPower:new a.ca(c),u_mode:new a.ca(c)}),vignette:c=>({u_vignetteShape:new a.c9(c),u_vignetteColor:new a.cQ(c)}),occlusion:c=>({u_matrix:new a.cc(c),u_anchorPos:new a.c9(c),u_screenSizePx:new a.cb(c),u_occluderSizePx:new a.cb(c),u_color:new a.cQ(c)})};class cd{constructor(t,r,d,_){this.id=cd.uniqueIdxCounter,cd.uniqueIdxCounter++,this.context=t;const b=t.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||_||r.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=cd.uniqueIdxCounter,cd.uniqueIdxCounter++;const r=this.context.gl;this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}cd.uniqueIdxCounter=0;const bf={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Dm{constructor(t,r,d,_,b,E){this.length=r.length,this.attributes=d,this.itemSize=r.bytesPerElement,this.dynamicDraw=_,this.instanceCount=E,this.context=t;const D=t.gl;this.buffer=D.createBuffer(),t.bindVertexBuffer.set(this.buffer),D.bufferData(D.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?D.DYNAMIC_DRAW:D.STATIC_DRAW),this.dynamicDraw||b||r.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,r){for(let d=0;d<this.attributes.length;d++){const _=r.attributes[this.attributes[d].name];_!==void 0&&t.enableVertexAttribArray(_)}}setVertexAttribPointers(t,r,d){for(let _=0;_<this.attributes.length;_++){const b=this.attributes[_],E=r.attributes[b.name];E!==void 0&&t.vertexAttribPointer(E,b.components,t[bf[b.type]],!1,this.itemSize,b.offset+this.itemSize*(d||0))}}setVertexAttribDivisor(t,r,d){for(let _=0;_<this.attributes.length;_++){const b=r.attributes[this.attributes[_].name];b!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(b,d)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class _h{constructor(t,r,d,_,b){this.context=t,this.width=r,this.height=d;const E=this.framebuffer=t.gl.createFramebuffer();_&&(this.colorAttachment=new Cm(t,E)),b&&(this.depthAttachmentType=b,this.depthAttachment=b==="renderbuffer"?new Pm(t,E):new Kf(t,E))}destroy(){const t=this.context.gl;if(this.colorAttachment){const r=this.colorAttachment.get();r&&t.deleteTexture(r)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const r=this.depthAttachment.get();r&&t.deleteRenderbuffer(r)}else{const r=this.depthAttachment.get();r&&t.deleteTexture(r)}t.deleteFramebuffer(this.framebuffer)}}class bn{constructor(t,r){this.gl=t,this.clearColor=new ka(this),this.clearDepth=new Zf(this),this.clearStencil=new km(this),this.colorMask=new su(this),this.depthMask=new Gp(this),this.stencilMask=new vn(this),this.stencilFunc=new ea(this),this.stencilOp=new Vc(this),this.stencilTest=new Uc(this),this.depthRange=new Dr(this),this.depthTest=new Un(this),this.depthFunc=new ln(this),this.blend=new oc(this),this.blendFunc=new Iu(this),this.blendColor=new yo(this),this.blendEquation=new sr(this),this.cullFace=new nc(this),this.cullFaceSide=new Id(this),this.frontFace=new ru(this),this.program=new Hr(this),this.activeTexture=new vo(this),this.viewport=new ou(this),this.bindFramebuffer=new Wp(this),this.bindRenderbuffer=new xp(this),this.bindTexture=new Ro(this),this.bindVertexBuffer=new _p(this),this.bindElementBuffer=new Ku(this),this.bindVertexArrayOES=new Lu(this),this.pixelStoreUnpack=new og(this),this.pixelStoreUnpackPremultiplyAlpha=new Em(this),this.pixelStoreUnpackFlipY=new nu(this),this.options=r?Object.assign({},r):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=r&&!!r.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,r,d){return new cd(this,t,r,d)}createVertexBuffer(t,r,d,_,b){return new Dm(this,t,r,d,_,b)}createRenderbuffer(t,r,d){const _=this.gl,b=_.createRenderbuffer();return this.bindRenderbuffer.set(b),_.renderbufferStorage(_.RENDERBUFFER,t,r,d),this.bindRenderbuffer.set(null),b}createFramebuffer(t,r,d,_){return new _h(this,t,r,d,_)}clear({color:t,depth:r,stencil:d,colorMask:_}){const b=this.gl;let E=0;t&&(E|=b.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(_||[!0,!0,!0,!0])),r!==void 0&&(E|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),d!==void 0&&(E|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),b.clear(E)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){a.bv(t.blendFunction,Fr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let wp;function Ge(c,t,r,d,_,b,E){const D=c.context,U=D.gl,Z=c.transform,ie=c.getOrCreateProgram("collisionBox"),de=[];let ne=0,me=0;for(let ut=0;ut<d.length;ut++){const kt=d[ut],wt=t.getTile(kt),xt=wt.getBucket(r);if(!xt)continue;const pt=js(kt,xt,Z);let At=pt;_[0]===0&&_[1]===0||(At=c.translatePosMatrix(pt,wt,_,b));const Ct=E?xt.textCollisionBox:xt.iconCollisionBox,ti=xt.collisionCircleArray;if(ti.length>0){const si=a.bz(),wi=At;a.cB(si,xt.placementInvProjMatrix,Z.glCoordMatrix),a.cB(si,si,xt.placementViewportMatrix),de.push({circleArray:ti,circleOffset:me,transform:wi,invTransform:si,projection:xt.getProjection()}),ne+=ti.length/4,me=ne}Ct&&(c.terrain&&c.terrain.setupElevationDraw(wt,ie),ie.draw(c,U.LINES,cs.disabled,hr.disabled,c.colorModeForRenderPass(),Zs.disabled,lg(At,Z,wt,xt.getProjection()),r.id,Ct.layoutVertexBuffer,Ct.indexBuffer,Ct.segments,null,Z.zoom,null,[Ct.collisionVertexBuffer,Ct.collisionVertexBufferExt]))}if(!E||!de.length)return;const Ce=c.getOrCreateProgram("collisionCircle"),Me=new a.dI;Me.resize(4*ne),Me._trim();let Pe=0;for(const ut of de)for(let kt=0;kt<ut.circleArray.length/4;kt++){const wt=4*kt,xt=ut.circleArray[wt+0],pt=ut.circleArray[wt+1],At=ut.circleArray[wt+2],Ct=ut.circleArray[wt+3];Me.emplace(Pe++,xt,pt,At,Ct,0),Me.emplace(Pe++,xt,pt,At,Ct,1),Me.emplace(Pe++,xt,pt,At,Ct,2),Me.emplace(Pe++,xt,pt,At,Ct,3)}(!wp||wp.length<2*ne)&&(wp=function(ut){const kt=2*ut,wt=new a.a_;wt.resize(kt),wt._trim();for(let xt=0;xt<kt;xt++){const pt=6*xt;wt.uint16[pt+0]=4*xt+0,wt.uint16[pt+1]=4*xt+1,wt.uint16[pt+2]=4*xt+2,wt.uint16[pt+3]=4*xt+2,wt.uint16[pt+4]=4*xt+3,wt.uint16[pt+5]=4*xt+0}return wt}(ne));const Ne=D.createIndexBuffer(wp,!0),He=D.createVertexBuffer(Me,a.dJ.members,!0);for(const ut of de){const kt={u_matrix:ut.transform,u_inv_matrix:ut.invTransform,u_camera_to_center_distance:(lt=Z).getCameraToCenterDistance(ut.projection),u_viewport_size:[lt.width,lt.height]};Ce.draw(c,U.TRIANGLES,cs.disabled,hr.disabled,c.colorModeForRenderPass(),Zs.disabled,kt,r.id,He,Ne,a.bd.simpleSegment(0,2*ut.circleOffset,ut.circleArray.length,ut.circleArray.length/2),null,Z.zoom)}var lt;He.destroy(),Ne.destroy()}const J=a.bz();function ge(c){const t=c._camera.getWorldToCamera(c.worldSize,1),r=a.az([],t,c.globeMatrix);a.bi(r,r);const d=[0,0,0],_=[0,1,0,0];return a.aA(_,_,r),d[0]=_[0],d[1]=_[1],d[2]=_[2],a.au(d,d),d}function xe({width:c,height:t,anchor:r,textOffset:d,textScale:_},b){const{horizontalAlign:E,verticalAlign:D}=a.bT(r),U=-(E-.5)*c,Z=-(D-.5)*t,ie=a.bU(r,d);return new a.P((U/_+ie[0])*b,(Z/_+ie[1])*b)}function Ie(c,t,r,d,_,b,E,D,U,Z){const ie=c.text.placedSymbolArray,de=c.text.dynamicLayoutVertexArray,ne=c.icon.dynamicLayoutVertexArray,me={},Ce=c.getProjection(),Me=Np(E,Ce,_),Pe=_.elevation,Ne=Ce.upVectorScale(E.canonical,_.center.lat,_.worldSize).metersToTile;de.clear();for(let He=0;He<ie.length;He++){const lt=ie.get(He),{tileAnchorX:ut,tileAnchorY:kt,numGlyphs:wt}=lt,xt=lt.hidden||!lt.crossTileID||c.allowVerticalPlacement&&!lt.placedOrientation?null:d[lt.crossTileID];if(xt){let pt=0,At=0,Ct=0;if(Pe){const Ai=Pe?Pe.getAtTileOffset(E,ut,kt):0,[ai,Di,Yi]=Ce.upVector(E.canonical,ut,kt);pt=Ai*ai*Ne,At=Ai*Di*Ne,Ct=Ai*Yi*Ne}let[ti,si,wi,_i]=xn(lt.projectedAnchorX+pt,lt.projectedAnchorY+At,lt.projectedAnchorZ+Ct,r?Me:b);const Bi=Ol(_.getCameraToCenterDistance(Ce),_i);let Kt=a.bJ(c.textSizeData,U,lt)*Bi/a.bO;r&&(Kt*=c.tilePixelRatio/D);const ui=xe(xt,Kt);r?({x:ti,y:si,z:wi}=Ce.projectTilePoint(ut+ui.x,kt+ui.y,E.canonical),[ti,si,wi]=xn(ti+pt,si+At,wi+Ct,b)):(t&&ui._rotate(-_.angle),ti+=ui.x,si+=ui.y,wi=0);const Ft=c.allowVerticalPlacement&&lt.placedOrientation===a.bI.vertical?Math.PI/2:0;for(let Ai=0;Ai<wt;Ai++)a.bL(de,ti,si,wi,Ft);Z&&lt.associatedIconIndex>=0&&(me[lt.associatedIconIndex]={x:ti,y:si,z:wi,angle:Ft})}else $d(wt,de)}if(Z){ne.clear();const He=c.icon.placedSymbolArray;for(let lt=0;lt<He.length;lt++){const ut=He.get(lt),{numGlyphs:kt}=ut,wt=me[lt];if(ut.hidden||!wt)$d(kt,ne);else{const{x:xt,y:pt,z:At,angle:Ct}=wt;for(let ti=0;ti<kt;ti++)a.bL(ne,xt,pt,At,Ct)}}c.icon.dynamicLayoutVertexBuffer.updateData(ne)}c.text.dynamicLayoutVertexBuffer.updateData(de)}function je(c,t,r,d,_,b,E={}){const D=r.paint.get("icon-translate"),U=r.paint.get("text-translate"),Z=r.paint.get("icon-translate-anchor"),ie=r.paint.get("text-translate-anchor"),de=r.layout.get("icon-rotation-alignment"),ne=r.layout.get("text-rotation-alignment"),me=r.layout.get("icon-pitch-alignment"),Ce=r.layout.get("text-pitch-alignment"),Me=r.layout.get("icon-keep-upright"),Pe=r.layout.get("text-keep-upright"),Ne=r.paint.get("icon-color-saturation"),He=r.paint.get("icon-color-contrast"),lt=r.paint.get("icon-color-brightness-min"),ut=r.paint.get("icon-color-brightness-max"),kt=r.layout.get("symbol-elevation-reference")==="sea",wt=c.context,xt=wt.gl,pt=c.transform,At=de==="map",Ct=ne==="map",ti=me==="map",si=Ce==="map",wi=r.layout.get("symbol-sort-key").constantOr(1)!==void 0;let _i=!1;const Bi=c.depthModeForSublayer(0,cs.ReadOnly),Kt=new cs(c.context.gl.LEQUAL,cs.ReadOnly,c.depthRangeFor3D),ui=[a.aD(pt.center.lng),a.aH(pt.center.lat)],Ft=r.layout.get("text-variable-anchor"),Ai=pt.projection.name==="globe",ai=[],Di=[0,-1,0];for(const Yi of d){const Mi=t.getTile(Yi),qi=Mi.getBucket(r);if(!qi||qi.projection.name==="mercator"&&Ai||qi.fullyClipped)continue;const _s=qi.projection.name==="globe",Ts=_s?a.ah(pt.zoom):0,us=Np(Yi,qi.getProjection(),pt),Os=pt.calculatePixelsToTileUnitsMatrix(Mi),Rs=Ft&&qi.hasTextData(),Js=qi.hasIconTextFit()&&Rs&&qi.hasIconData(),ur=qi.getProjection().createInversionMatrix(pt,Yi.canonical),Pr=(1<<Mi.tileID.canonical.z)*a.aj/c.transform.worldSize,Bo=Mo=>{let jo=[0,0,0];if(Mo){const Yn=c.style.directionalLight,Xr=c.style.ambientLight;Yn&&Xr&&(jo=kd(c.style,Yn,Xr))}return jo},Tn=Mo=>{pt.depthOcclusionForSymbolsAndCircles&&(r.hasInitialOcclusionOpacityProperties||c.terrain)&&(Mo.push("DEPTH_D24"),Mo.push("DEPTH_OCCLUSION"))},xo=()=>{const Mo=At&&r.layout.get("symbol-placement")!=="point",jo=[];Tn(jo);const Yn=Mo||Js,Xr=qi.elevationType==="road"&&ti,$n=c.shadowRenderer,hn=Xr&&!!$n&&$n.enabled,cn=Bo(hn),dn=Xr?Kt:Bi,_o=r.paint.get("icon-image-cross-fade");c.terrainRenderModeElevated()&&ti&&jo.push("PITCH_WITH_MAP_TERRAIN"),_s&&(jo.push("PROJECTION_GLOBE_VIEW"),Yn&&jo.push("PROJECTED_POS_ON_VIEWPORT")),_o>0&&jo.push("ICON_TRANSITION"),qi.icon.zOffsetVertexBuffer&&jo.push("Z_OFFSET"),Ne===0&&He===0&&lt===0&&ut===1||jo.push("COLOR_ADJUSTMENT"),qi.sdfIcons&&jo.push("RENDER_SDF"),hn&&jo.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Xr&&qi.icon.orientationVertexBuffer&&jo.push("ELEVATED_ROADS");const qn=qi.icon.programConfigurations.get(r.id),uh=c.getOrCreateProgram("symbol",{config:qn,defines:jo}),sn=Mi.imageAtlasTexture?Mi.imageAtlasTexture.size:[0,0],Go=qi.iconSizeData,hc=a.bH(Go,pt.zoom),Rh=ti||!pt.isOrthographic,Bd=fs(us,Mi.tileID.canonical,ti,At,pt,qi.getProjection(),Os),gu=Ga(us,Mi.tileID.canonical,ti,At,pt,qi.getProjection(),Os),qc=c.translatePosMatrix(gu,Mi,D,Z,!0),kc=c.translatePosMatrix(us,Mi,D,Z),hp=Yn?J:Bd,Fd=At&&!ti&&!Mo;let yu=Di;!Ai&&!pt.mercatorFromTransition||At||(yu=ge(pt));const Lf=_s?yu:Di,fg=r.getColorAdjustmentMatrix(Ne,He,lt,ut),Of=bp(Go.kind,hc,Fd,ti,c,kc,hp,qc,kt,!1,sn,[0,0],0,Yi,Ts,ui,ur,Lf,qi.getProjection(),cn,Pr,fg,_o,null),Df=Mi.imageAtlasTexture?Mi.imageAtlasTexture:null,pm=r.layout.get("icon-size").constantOr(0)!==1||qi.iconsNeedLinear,mg=qi.sdfIcons||c.options.rotating||c.options.zooming||pm||Rh?xt.LINEAR:xt.NEAREST,Pp=qi.sdfIcons&&r.paint.get("icon-halo-width").constantOr(1)!==0,gd=c.terrain&&ti&&Mo?a.bi(a.bz(),Bd):J;if(Mo&&qi.icon){const fm=pt.elevation,xu=fm?fm.getAtTileOffsetFunc(Yi,pt.center.lat,pt.worldSize,qi.getProjection()):null,Hu=Ir(us,Mi.tileID.canonical,ti,At,pt,qi.getProjection(),Os);td(qi,us,c,!1,Hu,gu,ti,Me,xu,Yi)}return{program:uh,buffers:qi.icon,uniformValues:Of,atlasTexture:Df,atlasTextureIcon:null,atlasInterpolation:mg,atlasInterpolationIcon:null,isSDF:qi.sdfIcons,hasHalo:Pp,depthMode:dn,tile:Mi,renderWithShadows:hn,labelPlaneMatrixInv:gd}},Yo=()=>{const Mo=Ct&&r.layout.get("symbol-placement")!=="point",jo=[],Yn=Mo||Ft||Js,Xr=qi.elevationType==="road"&&si,$n=c.shadowRenderer,hn=Xr&&!!$n&&$n.enabled,cn=Bo(hn),dn=Xr?Kt:Bi;c.terrainRenderModeElevated()&&si&&jo.push("PITCH_WITH_MAP_TERRAIN"),_s&&(jo.push("PROJECTION_GLOBE_VIEW"),Yn&&jo.push("PROJECTED_POS_ON_VIEWPORT")),qi.text.zOffsetVertexBuffer&&jo.push("Z_OFFSET"),qi.iconsInText&&jo.push("RENDER_TEXT_AND_SYMBOL"),jo.push("RENDER_SDF"),hn&&jo.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Xr&&qi.text.orientationVertexBuffer&&jo.push("ELEVATED_ROADS"),Tn(jo);const _o=qi.text.programConfigurations.get(r.id),qn=c.getOrCreateProgram("symbol",{config:_o,defines:jo});let uh,sn=[0,0],Go=null;const hc=qi.textSizeData;qi.iconsInText&&(sn=Mi.imageAtlasTexture?Mi.imageAtlasTexture.size:[0,0],Go=Mi.imageAtlasTexture?Mi.imageAtlasTexture:null,uh=si||!pt.isOrthographic||c.options.rotating||c.options.zooming||hc.kind==="composite"||hc.kind==="camera"?xt.LINEAR:xt.NEAREST);const Rh=Mi.glyphAtlasTexture?Mi.glyphAtlasTexture.size:[0,0],Bd=r.layout.get("text-size-scale-range"),gu=a.ay(c.scaleFactor,Bd[0],Bd[1]),qc=a.bH(hc,pt.zoom,gu),kc=fs(us,Mi.tileID.canonical,si,Ct,pt,qi.getProjection(),Os),hp=Ga(us,Mi.tileID.canonical,si,Ct,pt,qi.getProjection(),Os),Fd=c.translatePosMatrix(hp,Mi,U,ie,!0),yu=c.translatePosMatrix(us,Mi,U,ie),Lf=Yn?J:kc,fg=Ct&&!si&&!Mo;let Of=Di;!Ai&&!pt.mercatorFromTransition||Ct||(Of=ge(pt));const Df=bp(hc.kind,qc,fg,si,c,yu,Lf,Fd,kt,!0,Rh,sn,0,Yi,Ts,ui,ur,_s?Of:Di,qi.getProjection(),cn,Pr,null,null,gu),pm=Mi.glyphAtlasTexture?Mi.glyphAtlasTexture:null,mg=xt.LINEAR,Pp=r.paint.get("text-halo-width").constantOr(1)!==0,gd=c.terrain&&si&&Mo?a.bi(a.bz(),kc):J;if(Mo&&qi.text){const fm=pt.elevation,xu=fm?fm.getAtTileOffsetFunc(Yi,pt.center.lat,pt.worldSize,qi.getProjection()):null,Hu=Ir(us,Mi.tileID.canonical,si,Ct,pt,qi.getProjection(),Os);td(qi,us,c,!0,Hu,hp,si,Pe,xu,Yi)}return{program:qn,buffers:qi.text,uniformValues:Df,atlasTexture:pm,atlasTextureIcon:Go,atlasInterpolation:mg,atlasInterpolationIcon:uh,isSDF:!0,hasHalo:Pp,depthMode:dn,tile:Mi,renderWithShadows:hn,labelPlaneMatrixInv:gd}},Nn=qi.icon.segments.get().length,Er=qi.text.segments.get().length,br=Nn&&!E.onlyText?xo():null,zr=Er&&!E.onlyIcons?Yo():null,_n=r.paint.get("icon-opacity").constantOr(1),Xa=r.paint.get("text-opacity").constantOr(1);if(wi&&qi.canOverlap){_i=!0;const Mo=_n&&!E.onlyText?qi.icon.segments.get():[],jo=Xa&&!E.onlyIcons?qi.text.segments.get():[];for(const Yn of Mo)ai.push({segments:new a.bd([Yn]),sortKey:Yn.sortKey,state:br});for(const Yn of jo)ai.push({segments:new a.bd([Yn]),sortKey:Yn.sortKey,state:zr})}else E.onlyText||ai.push({segments:_n?qi.icon.segments:new a.bd([]),sortKey:0,state:br}),E.onlyIcons||ai.push({segments:Xa?qi.text.segments:new a.bd([]),sortKey:0,state:zr})}_i&&ai.sort((Yi,Mi)=>Yi.sortKey-Mi.sortKey);for(const Yi of ai){const Mi=Yi.state;if(Mi)if(c.terrain?c.terrain.setupElevationDraw(Mi.tile,Mi.program,{useDepthForOcclusion:pt.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Mi.labelPlaneMatrixInv}):c.setupDepthForOcclusion(pt.depthOcclusionForSymbolsAndCircles,Mi.program),wt.activeTexture.set(xt.TEXTURE0),Mi.atlasTexture&&Mi.atlasTexture.bind(Mi.atlasInterpolation,xt.CLAMP_TO_EDGE,!0),Mi.atlasTextureIcon&&(wt.activeTexture.set(xt.TEXTURE1),Mi.atlasTextureIcon&&Mi.atlasTextureIcon.bind(Mi.atlasInterpolationIcon,xt.CLAMP_TO_EDGE,!0)),Mi.renderWithShadows&&c.shadowRenderer.setupShadows(Mi.tile.tileID.toUnwrapped(),Mi.program,"vector-tile",Mi.tile.tileID.overscaledZ),c.uploadCommonLightUniforms(c.context,Mi.program),Mi.hasHalo){const qi=Mi.uniformValues;qi.u_is_halo=1,Ye(Mi.buffers,Yi.segments,r,c,Mi.program,Mi.depthMode,_,b,qi,2),qi.u_is_halo=0}else{if(Mi.isSDF){const qi=Mi.uniformValues;Mi.hasHalo&&(qi.u_is_halo=1,Ye(Mi.buffers,Yi.segments,r,c,Mi.program,Mi.depthMode,_,b,qi,1)),qi.u_is_halo=0}Ye(Mi.buffers,Yi.segments,r,c,Mi.program,Mi.depthMode,_,b,Mi.uniformValues,1)}}}function Ye(c,t,r,d,_,b,E,D,U,Z){const ie=[c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer,c.iconTransitioningVertexBuffer,c.globeExtVertexBuffer,c.zOffsetVertexBuffer,c.orientationVertexBuffer];_.draw(d,d.context.gl.TRIANGLES,b,E,D,Zs.disabled,U,r.id,c.layoutVertexBuffer,c.indexBuffer,t,r.paint,d.transform.zoom,c.programConfigurations.get(r.id),ie,Z)}function mt(c,t){const r=1<<c.canonical.z,d=(t.x*r-c.canonical.x-c.wrap*r)*a.aj,_=(t.y*r-c.canonical.y)*a.aj,b=a.dS(t.z,t.y);return a.cS(d,_,b)}function bt(c,t,r,d,_){if(!r.layout||r.layout.get("fill-elevation-reference")==="none")return;const b=c.context.gl,E=new cs(c.context.gl.LEQUAL,cs.ReadWrite,c.depthRangeFor3D),D=new cs(c.context.gl.GREATER,cs.ReadWrite,c.depthRangeFor3D),U=function(me){const Ce=a.cJ(me.pitch);let Me=.01;return me.isOrthographic&&(Me=a.ai(1e-4,Me,a.cN(Ce>=Aa?1:Ce/Aa))),2*Me}(c.transform),Z=c.transform.getFreeCameraOptions().position,ie="elevatedStructuresDepthReconstruct",de=c.getOrCreateProgram(ie,{defines:["DEPTH_RECONSTRUCTION"]}),ne=c.getOrCreateProgram(ie);for(const me of d){const Ce=t.getTile(me),Me=Ce.getBucket(r);if(!Me)continue;const Pe=Me.elevatedStructures;if(!Pe)continue;const Ne=Me.elevationBufferData.heightRange,He=mt(me.toUnwrapped(),Z),lt=c.translatePosMatrix(me.projMatrix,Ce,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));let ut,kt,wt,xt;if(_==="initialize"){if(!Ne||Ne.min>=1||Pe.depthSegments.segments[0].primitiveLength===0)continue;ut=Lh(lt,He,U,1,0),kt=E,wt=Pe.depthSegments,xt=de}else if(_==="reset"){if(!Ne||Ne.min>=0||Pe.maskSegments.segments[0].primitiveLength===0)continue;ut=Lh(lt,He,0,0,1),kt=D,wt=Pe.maskSegments,xt=de}else if(_==="geometry"){if(Pe.depthSegments.segments[0].primitiveLength===0)continue;ut=Lh(lt,He,U,1,0),kt=E,wt=Pe.depthSegments,xt=ne}xt.draw(c,b.TRIANGLES,kt,hr.disabled,Fr.disabled,Zs.disabled,ut,r.id,Pe.vertexBuffer,Pe.indexBuffer,wt,r.paint,c.transform.zoom)}}function Bt(c,t,r){const{painter:d,sourceCache:_,layer:b,coords:E,colorMode:D,elevationType:U,terrainEnabled:Z,pass:ie}=c,de=d.context.gl,ne=b.paint.get("fill-pattern"),me=b.paint.get("fill-pattern-cross-fade"),Ce=ne.constantOr(null);let Me=U;U!=="road"||t&&!Z||(Me="none");const Pe=Me==="road",Ne=c.painter.shadowRenderer,He=Pe&&!!Ne&&Ne.enabled,lt=new cs(d.context.gl.LEQUAL,cs.ReadOnly,d.depthRangeFor3D);let ut=[0,0,0];if(He){const xt=d.style.directionalLight,pt=d.style.ambientLight;xt&&pt&&(ut=kd(d.style,xt,pt))}const kt=ne&&ne.constantOr(1),wt=(xt,pt)=>{let At,Ct,ti,si,wi;pt?(At=kt&&!b.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ti=de.LINES):(At=kt?"fillPattern":"fill",ti=de.TRIANGLES);for(const _i of E){const Bi=_.getTile(_i);if(kt&&!Bi.patternsLoaded())continue;const Kt=Bi.getBucket(b);if(!Kt)continue;const ui=t?Kt.elevationBufferData:Kt.bufferData;if(ui.isEmpty())continue;d.prepareDrawTile();const Ft=ui.programConfigurations.get(b.id),Ai=d.isTileAffectedByFog(_i),ai=[],Di=[];Pe&&(ai.push("ELEVATED_ROADS"),Di.push(ui.elevatedLayoutVertexBuffer)),He&&ai.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),kt&&(d.context.activeTexture.set(de.TEXTURE0),Bi.imageAtlasTexture&&Bi.imageAtlasTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE),Ft.updatePaintBuffers());let Yi=!1;if(Ce&&Bi.imageAtlas){const us=Bi.imageAtlas,Os=a.dN.from(Ce),Rs=Os.getPrimary().scaleSelf(a.q.devicePixelRatio).toString(),Js=Os.getSecondary(),ur=us.patternPositions.get(Rs),Pr=Js?us.patternPositions.get(Js.scaleSelf(a.q.devicePixelRatio).toString()):null;Yi=!!ur&&!!Pr,ur&&Ft.setConstantPatternPositions(ur,Pr)}me>0&&(Yi||Ft.getPatternTransitionVertexBuffer("fill-pattern"))&&ai.push("FILL_PATTERN_TRANSITION");const Mi=d.getOrCreateProgram(At,{config:Ft,overrideFog:Ai,defines:ai}),qi=d.translatePosMatrix(_i.projMatrix,Bi,b.paint.get("fill-translate"),b.paint.get("fill-translate-anchor"));He&&Ne.setupShadows(Bi.tileID.toUnwrapped(),Mi,"vector-tile",Bi.tileID.overscaledZ);const _s=b.paint.get("fill-emissive-strength");if(pt){si=ui.lineIndexBuffer,wi=ui.lineSegments;const us=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[de.drawingBufferWidth,de.drawingBufferHeight];Ct=At==="fillOutlinePattern"&&kt?ag(qi,_s,d,Bi,us,ut,me):ng(qi,_s,us,ut)}else si=ui.indexBuffer,wi=ui.triangleSegments,Ct=kt?zu(qi,_s,d,Bi,ut,me):ld(qi,_s,ut);d.uploadCommonUniforms(d.context,Mi,_i.toUnwrapped());let Ts=xt;(U==="road"&&!Z||U==="offset")&&(Ts=lt),Mi.draw(d,ti,Ts,r||d.stencilModeForClipping(_i),D,Zs.disabled,Ct,b.id,ui.layoutVertexBuffer,si,wi,b.paint,d.transform.zoom,Ft,Di)}};d.renderPass===ie&&wt(d.depthModeForSublayer(1,d.renderPass==="opaque"?cs.ReadWrite:cs.ReadOnly),!1),Me==="none"&&d.renderPass==="translucent"&&b.paint.get("fill-antialias")&&wt(d.depthModeForSublayer(b.getPaintProperty("fill-outline-color")?2:0,cs.ReadOnly),!0)}function gt(c,t,r,d,_,b,E,D){r.resetLayerRenderingStats(c);const U=c.context,Z=U.gl,ie=c.transform,de=r.paint.get("fill-extrusion-pattern"),ne=r.paint.get("fill-extrusion-pattern-cross-fade"),me=de.constantOr(null),Ce=de.constantOr(1),Me=r.paint.get("fill-extrusion-opacity"),Pe=c.style.enable3dLights(),Ne=r.paint.get(Pe&&!Ce?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),He=[r.paint.get("fill-extrusion-ambient-occlusion-intensity"),Ne],lt=r.layout.get("fill-extrusion-edge-radius"),ut=lt>0&&!r.paint.get("fill-extrusion-rounded-roof"),kt=ut?0:lt,wt=ie.projection.name==="globe"?a.dV():0,xt=ie.projection.name==="globe",pt=xt?a.ah(ie.zoom):0,At=[a.aD(ie.center.lng),a.aH(ie.center.lat)],Ct=r.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ti=r.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Ct?null:r.lut).toArray01().slice(0,3),si=r.paint.get("fill-extrusion-flood-light-intensity"),wi=r.paint.get("fill-extrusion-vertical-scale"),_i=r.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Bi=r.paint.get("fill-extrusion-height-alignment"),Kt=r.paint.get("fill-extrusion-base-alignment"),ui=eh(c,r.paint.get("fill-extrusion-cutoff-fade-range")),Ft=[];let Ai;xt&&Ft.push("PROJECTION_GLOBE_VIEW"),He[0]>0&&Ft.push("FAUX_AO"),ut&&Ft.push("ZERO_ROOF_RADIUS"),D&&Ft.push("HAS_CENTROID"),si>0&&Ft.push("FLOOD_LIGHT"),ui.shouldRenderCutoff&&Ft.push("RENDER_CUTOFF"),_i&&Ft.push("RENDER_WALL_MODE");const ai=c.renderPass==="shadow",Di=c.shadowRenderer,Yi=ai&&!!Di,Mi=ai?Zs.disabled:Zs.backCCW;c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!0);let qi=[0,0,0];if(Di){const us=c.style.directionalLight,Os=c.style.ambientLight;us&&Os&&(qi=kd(c.style,us,Os)),ai||(Ft.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Di.useNormalOffset&&Ft.push("NORMAL_OFFSET")),Ai=Ft.concat(["SHADOWS_SINGLE_CASCADE"])}const _s=Yi?"fillExtrusionDepth":Ce?"fillExtrusionPattern":"fillExtrusion",Ts=r.getLayerRenderingStats();for(const us of d){const Os=t.getTile(us),Rs=Os.getBucket(r);if(!Rs||Rs.projection.name!==ie.projection.name)continue;let Js=!1;Di&&(Js=Di.getMaxCascadeForTile(us.toUnwrapped())===0);const ur=c.isTileAffectedByFog(us),Pr=Rs.programConfigurations.get(r.id);let Bo=!1;if(me&&Os.imageAtlas){const zr=Os.imageAtlas,_n=a.dN.from(me),Xa=_n.getPrimary().scaleSelf(a.q.devicePixelRatio).toString(),Mo=_n.getSecondary(),jo=zr.patternPositions.get(Xa),Yn=Mo?zr.patternPositions.get(Mo.scaleSelf(a.q.devicePixelRatio).toString()):null;Bo=!!jo&&!!Yn,jo&&Pr.setConstantPatternPositions(jo,Yn)}ne>0&&(Bo||Pr.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ft.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Tn=c.getOrCreateProgram(_s,{config:Pr,defines:Js?Ai:Ft,overrideFog:ur});if(c.terrain&&c.terrain.setupElevationDraw(Os,Tn,{useMeterToDem:!0}),!Rs.centroidVertexBuffer){const zr=Tn.attributes.a_centroid_pos;zr!==void 0&&Z.vertexAttrib2f(zr,0,0)}!ai&&Di&&Di.setupShadows(Os.tileID.toUnwrapped(),Tn,"vector-tile",Os.tileID.overscaledZ),Ce&&(c.context.activeTexture.set(Z.TEXTURE0),Os.imageAtlasTexture&&Os.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),Pr.updatePaintBuffers());const xo=r.paint.get("fill-extrusion-vertical-gradient"),Yo=1/Rs.tileToMeter;let Nn;if(ai&&Di){if(Gt(Os.tileID,Rs,c))continue;const zr=Di.calculateShadowPassMatrixFromTile(Os.tileID.toUnwrapped());Nn=rm(zr,kt,Yo,wi,Bi,Kt)}else{const zr=c.translatePosMatrix(us.expandedProjMatrix,Os,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),_n=ie.projection.createInversionMatrix(ie,us.canonical);Nn=Ce?yf(zr,c,xo,Me,He,kt,Yo,us,Os,wt,Bi,Kt,pt,At,_n,ti,wi,ne):Xp(zr,c,xo,Me,He,kt,Yo,us,wt,Bi,Kt,pt,At,_n,ti,wi,si,qi)}c.uploadCommonUniforms(U,Tn,us.toUnwrapped(),null,ui);let Er=Rs.segments;if(ie.projection.name==="mercator"&&!ai&&(Er=Rs.getVisibleSegments(Os.tileID,c.terrain,c.transform.getFrustum(0)),!Er.get().length))continue;if(Ts)if(ai)for(const zr of Er.get())Ts.numRenderedVerticesInShadowPass+=zr.primitiveLength;else for(const zr of Er.get())Ts.numRenderedVerticesInTransparentPass+=zr.primitiveLength;const br=[];(c.terrain||D)&&br.push(Rs.centroidVertexBuffer),xt&&br.push(Rs.layoutVertexExtBuffer),_i&&br.push(Rs.wallVertexBuffer),Tn.draw(c,U.gl.TRIANGLES,_,b,E,Mi,Nn,r.id,Rs.layoutVertexBuffer,Rs.indexBuffer,Er,r.paint,c.transform.zoom,Pr,br)}c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!1)}function Lt(c,t,r,d,_,b,E,D,U,Z,ie,de,ne,me,Ce,Me,Pe,Ne,He){const lt=c.context,ut=lt.gl,kt=c.transform,wt=c.transform.zoom,xt=[],pt=eh(c,r.paint.get("fill-extrusion-cutoff-fade-range"));Z==="clear"?(xt.push("CLEAR_SUBPASS"),He&&(xt.push("CLEAR_FROM_TEXTURE"),lt.activeTexture.set(ut.TEXTURE0),He.bind(ut.LINEAR,ut.CLAMP_TO_EDGE))):Z==="sdf"&&xt.push("SDF_SUBPASS"),Pe&&xt.push("HAS_CENTROID"),pt.shouldRenderCutoff&&xt.push("RENDER_CUTOFF");const At=r.layout.get("fill-extrusion-edge-radius"),Ct=(ti,si,wi,_i,Bi)=>{const Kt=si.programConfigurations.get(r.id),ui=c.isTileAffectedByFog(ti),Ft=c.getOrCreateProgram("fillExtrusionGroundEffect",{config:Kt,defines:xt,overrideFog:ui}),Ai=((Di,Yi,Mi,qi,_s,Ts,us,Os,Rs,Js,ur)=>({u_matrix:Yi,u_opacity:Mi,u_ao_pass:qi?1:0,u_meter_to_tile:_s,u_ao:Ts,u_flood_light_intensity:us,u_flood_light_color:Os,u_attenuation:Rs,u_edge_radius:Js,u_fb:0,u_fb_size:ur,u_dynamic_offset:1}))(0,_i,ie,U,Bi,[de,ne*Bi],me,Ce,Me,wt>=17?0:At*Bi,He?He.size[0]:0),ai=[];Pe&&ai.push(si.hiddenByLandmarkVertexBuffer),c.uploadCommonUniforms(lt,Ft,ti.toUnwrapped(),null,pt),Ft.draw(c,lt.gl.TRIANGLES,_,b,E,D,Ai,r.id,si.vertexBuffer,si.indexBuffer,wi,r.paint,wt,Kt,ai)};for(const ti of d){const si=t.getTile(ti),wi=si.getBucket(r);if(!wi||wi.projection.name!==kt.projection.name||!wi.groundEffect||wi.groundEffect&&!wi.groundEffect.hasData())continue;const _i=wi.groundEffect,Bi=1/wi.tileToMeter;{const Kt=c.translatePosMatrix(ti.projMatrix,si,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),ui=_i.getDefaultSegment();Ct(ti,_i,ui,Kt,Bi)}if(Ne)for(let Kt=0;Kt<4;Kt++){const ui=a.dT[Kt](ti),Ft=t.getTile(ui);if(!Ft)continue;const Ai=Ft.getBucket(r);if(!Ai||Ai.projection.name!==kt.projection.name||!Ai.groundEffect||Ai.groundEffect&&!Ai.groundEffect.hasData())continue;const ai=Ai.groundEffect;let Di,Yi;Kt===0?(Di=[-8192,0,0],Yi=1):Kt===1?(Di=[a.aj,0,0],Yi=0):Kt===2?(Di=[0,-8192,0],Yi=3):(Di=[0,a.aj,0],Yi=2);const Mi=ai.regionSegments[Yi];if(!Mi)continue;const qi=new Float32Array(16);a.bo(qi,ti.projMatrix,Di),Ct(ti,ai,Mi,c.translatePosMatrix(qi,si,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),Bi)}}}function qe(c,t,r,d,_,b,E){d.centroidVertexArray.length===0&&d.createCentroidsBuffer();const D=b?b.findDEMTileFor(r):null;if(!(D&&D.dem||E))return;b&&D&&D.dem&&d.selfDEMTileTimestamp!==D.dem._timestamp&&(d.borderDoneWithNeighborZ=[-1,-1,-1,-1],d.selfDEMTileTimestamp=D.dem._timestamp);const U=Ne=>new a.P(Math.ceil((Ne+a.dX)*a.dY),0),Z=Ne=>{const He=t.getSource().minzoom,lt=kt=>{const wt=t.getTileByID(kt);if(wt&&wt.hasData())return wt.getBucket(_)},ut=[0,-1,1];for(const kt of ut){if(Ne.overscaledZ+kt<He)continue;const wt=lt(Ne.calculateScaledKey(Ne.overscaledZ+kt));if(wt)return wt}},ie=[0,0,0],de=(Ne,He)=>(ie[0]=Math.min(Ne.min.y,He.min.y),ie[1]=Math.max(Ne.max.y,He.max.y),ie[2]=a.aj-He.min.x>Ne.max.x?He.min.x-a.aj:Ne.max.x,ie),ne=(Ne,He)=>(ie[0]=Math.min(Ne.min.x,He.min.x),ie[1]=Math.max(Ne.max.x,He.max.x),ie[2]=a.aj-He.min.y>Ne.max.y?He.min.y-a.aj:Ne.max.y,ie),me=[(Ne,He)=>de(Ne,He),(Ne,He)=>de(He,Ne),(Ne,He)=>ne(Ne,He),(Ne,He)=>ne(He,Ne)],Ce=(Ne,He,lt,ut,kt,wt,xt)=>{if(!b)return 0;const pt=[[wt?lt:Ne,wt?Ne:lt,0],[wt?lt:He,wt?He:lt,0]],At=xt<0?a.aj+xt:xt,Ct=[wt?At:(Ne+He)/2,wt?(Ne+He)/2:At,0];return lt===0&&xt<0||lt!==0&&xt>0?b.getForTilePoints(kt,[Ct],!0,ut):pt.push(Ct),b.getForTilePoints(r,pt,!0,D),Math.max(pt[0][2],pt[1][2],Ct[2])/b.exaggeration()};for(let Ne=0;Ne<4;Ne++){const He=d.borderFeatureIndices[Ne];if(He.length===0)continue;const lt=a.dT[Ne](r),ut=Z(lt);if(!(ut&&ut instanceof a.dU))continue;const kt=b?b.findDEMTileFor(lt):null;if(!(kt&&kt.dem||E)||(b&&kt&&kt.dem&&d.borderDEMTileTimestamp[Ne]!==kt.dem._timestamp&&(d.borderDoneWithNeighborZ[Ne]=-1,d.borderDEMTileTimestamp[Ne]=kt.dem._timestamp),d.borderDoneWithNeighborZ[Ne]===ut.canonical.z))continue;ut.centroidVertexArray.length===0&&ut.createCentroidsBuffer();const wt=(Ne<2?1:5)-Ne,xt=ut.borderDoneWithNeighborZ[wt]!==d.canonical.z,pt=ut.borderFeatureIndices[wt];let At=0;if(d.canonical.z!==ut.canonical.z){for(const Ct of He)d.showCentroid(d.featuresOnBorder[Ct]);if(xt)for(const Ct of pt)ut.showCentroid(ut.featuresOnBorder[Ct]);d.borderDoneWithNeighborZ[Ne]=ut.canonical.z,ut.borderDoneWithNeighborZ[wt]=d.canonical.z}for(const Ct of He){const ti=d.featuresOnBorder[Ct],si=d.centroidData[ti.centroidDataIndex],wi=ti.borders[Ne];let _i;for(;At<pt.length;){_i=ut.featuresOnBorder[pt[At]];const Bi=_i.borders[wt];if(Bi[1]>wi[0]+3||Bi[0]>wi[0]-3)break;ut.showCentroid(_i),At++}if(_i&&At<pt.length){const Bi=At;let Kt=0;for(;!(_i.borders[wt][0]>wi[1]-3)&&(Kt++,++At!==pt.length);)_i=ut.featuresOnBorder[pt[At]];_i=ut.featuresOnBorder[pt[Bi]];let ui=!1;if(Kt>=1){const ai=_i.borders[wt];Math.abs(wi[0]-ai[0])<3&&Math.abs(wi[1]-ai[1])<3&&(Kt=1,ui=!0,At=Bi+1)}else if(Kt===0){d.showCentroid(ti);continue}const Ft=ut.centroidData[_i.centroidDataIndex];E&&ui&&(((Me=si).flags|(Pe=Ft).flags)&a.dW?(Me.flags|=a.dW,Pe.flags|=a.dW):(Me.flags&=2147483647,Pe.flags&=2147483647));const Ai=ti.intersectsCount()>1||_i.intersectsCount()>1;if(Kt>1)At=Bi,si.centroidXY=Ft.centroidXY=new a.P(0,0);else if(kt&&kt.dem&&!Ai){const ai=me[Ne](si,Ft),Di=Ne%2?a.aj-1:0,Yi=Ce(ai[0],Math.min(a.aj-1,ai[1]),Di,kt,lt,Ne<2,ai[2]);si.centroidXY=Ft.centroidXY=U(Yi)}else Ai?si.centroidXY=Ft.centroidXY=new a.P(0,0):(si.centroidXY=d.encodeBorderCentroid(ti),Ft.centroidXY=ut.encodeBorderCentroid(_i));d.writeCentroidToBuffer(si),ut.writeCentroidToBuffer(Ft)}else d.showCentroid(ti)}d.borderDoneWithNeighborZ[Ne]=ut.canonical.z,ut.borderDoneWithNeighborZ[wt]=d.canonical.z}var Me,Pe;(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(c)}const vt=[1,0,0],_t=[0,1,0],Wt=[0,0,1];function Gt(c,t,r){const d=r.transform,_=r.shadowRenderer;if(!_)return!0;const b=c.toUnwrapped(),E=d.tileSize*_._cascades[r.currentShadowCascade].scale;let D=t.maxHeight;if(d.elevation){const Me=d.elevation.getMinMaxForTile(c);Me&&(D+=Me.max)}const U=[..._.shadowDirection];U[2]=-U[2];const Z=_.computeSimplifiedTileShadowVolume(b,D,E,U);if(!Z)return!1;const ie=[vt,_t,Wt,U,[U[0],0,U[2]],[0,U[1],U[2]]],de=d.projection.name==="globe",ne=d.scaleZoom(E),me=a.cn.fromInvProjectionMatrix(d.invProjMatrix,d.worldSize,ne,!de),Ce=_.getCurrentCascadeFrustum();return me.intersectsPrecise(Z.vertices,Z.planes,ie)===0||Ce.intersectsPrecise(Z.vertices,Z.planes,ie)===0}function Vt(c){return[c[0]*a.dZ,c[1]*a.dZ,c[2]*a.dZ,0]}function ji(c,t,r,d,_,b,E,D,U){const Z=d.getSource(),ie=r.globeSharedBuffers;if(!ie)return;let de,ne,me;if(t&&(de=d.getTile(t)),Z instanceof a.aP?(ne=Z.texture,me=a.ds(0,0,r.transform)):de&&t&&(ne=de.texture,me=a.ds(t.canonical.z,t.canonical.x,r.transform)),!ne||!me)return;c||(me=a.cE(a.bz(),me,[1,-1,1]));const Ce=r.context,Me=Ce.gl,Pe=_.paint.get("raster-resampling")==="nearest"?Me.NEAREST:Me.LINEAR,Ne=r.colorModeForDrapableLayerRenderPass(b),He=E.defines;He.push("GLOBE_POLES");const lt=new cs(Me.LEQUAL,cs.ReadWrite,r.depthRangeFor3D),ut=Float32Array.from(r.transform.expandedFarZProjMatrix),kt=Float32Array.from(a.bh(a.dr(new a.cp(0,0,0))));r.terrain&&r.terrain.prepareDrawTile(),Ce.activeTexture.set(Me.TEXTURE0),ne.bind(Pe,Me.CLAMP_TO_EDGE),Ce.activeTexture.set(Me.TEXTURE1),ne.bind(Pe,Me.CLAMP_TO_EDGE),"useMipmap"in ne&&Ce.extTextureFilterAnisotropic&&r.transform.pitch>20&&Me.texParameterf(Me.TEXTURE_2D,Ce.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Ce.extTextureFilterAnisotropicMax);const[wt,xt,pt,At]=t?ie.getPoleBuffers(t.canonical.z,!1):ie.getPoleBuffers(0,!0),Ct=_.paint.get("raster-elevation");let ti;c?(ti=wt,r.renderDefaultNorthPole=Ct!==0):(ti=xt,r.renderDefaultSouthPole=Ct!==0);const si=Vt(E.mix),wi=((Bi,Kt,ui,Ft,Ai,ai,Di,Yi,Mi,qi,_s,Ts,us)=>Ru(Bi,Kt,ui,new Float32Array(16),new Float32Array(9),[0,0],Ft,[0,0],[0,0,0,0],1,{opacity:1,mix:0},ai,[0,0],Yi,2,qi,_s,Ts,1,0,us))(ut,kt,me,a.ah(r.transform.zoom),0,_,0,Ct,0,si,E.offset,E.range,b),_i=r.getOrCreateProgram("raster",{defines:He});r.uploadCommonUniforms(Ce,_i,null),_i.draw(r,Me.TRIANGLES,lt,U,Ne,D,wi,_.id,ti,pt,At)}function Ms(c){const t=c._nearZ,r=c.projection.farthestPixelDistance(c),d=r-t,_=.2*c.height,b=t+_;return[t,r,(b-_-t)/d,(b-t)/d]}function zi(c,t,r,d){if(c)return t instanceof Xh&&c instanceof fa?t.getTextureDescriptor(c,r,!0):{texture:c.texture,mix:Vt(d.mix),offset:d.offset,buffer:0,tileSize:1}}var os=a.d_([{name:"a_index",type:"Int16",components:1}]);class Fs{constructor(t,r,d,_){const b={width:d[0],height:d[1],data:null},E=t.gl;this.targetColorTexture=new a.T(t,b,E.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new a.T(t,b,E.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(r,_),this.lastInvalidatedAt=0}updateParticleTexture(t,r){if(this.particleTextureDimension===r.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const d=this.context.gl,_=r.width*r.height;this.particleTexture0=new a.T(this.context,r,d.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new a.T(this.context,r,d.RGBA8,{premultiply:!1,useMipmap:!1});const b=new a.d$;b.reserve(_);for(let E=0;E<_;E++)b.emplaceBack(E);this.particleIndexBuffer=this.context.createVertexBuffer(b,os.members,!0),this.particleSegment=a.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=r.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=a.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Xi(c,t,r){if(!c)return null;const d=t.getTextureDescriptor(c,r,!0);if(!d)return null;let{texture:_,mix:b,offset:E,tileSize:D,buffer:U,format:Z}=d;if(!_||!Z)return null;let ie=!1;return Z==="uint32"&&(ie=!0,b[3]=0,b=Oh(a.e0,b,[0,r.paint.get("raster-particle-max-speed")]),E=om(a.e0,E,[0,r.paint.get("raster-particle-max-speed")])),{texture:_,textureOffset:[U/(D+2*U),D/(D+2*U)],tileSize:D,scalarData:ie,scale:b,offset:E,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[Z]]}}function Es(c){const t=c._nearZ,r=c.projection.farthestPixelDistance(c),d=r-t,_=.2*c.height,b=t+_;return[t,r,(b-_-t)/d,(b-t)/d]}const Ns=new a.am(1,0,0,1),rr=new a.am(0,1,0,1),bs=new a.am(0,0,1,1),Ks=new a.am(1,0,1,1),or=new a.am(0,1,1,1);function Jo(c,t,r,d,_,b){for(let E=0;E<r.length;E++)if(_){const Z=new a.am(d.r*.8,d.g*.8,d.b*.8,1);co(c,t,r[E],d,-1,-1,b),co(c,t,r[E],d,-1,1,b),co(c,t,r[E],d,1,1,b),co(c,t,r[E],d,1,-1,b),co(c,t,r[E],Z,0,0,b)}else co(c,t,r[E],d,0,0,b)}function co(c,t,r,d,_,b,E){const D=c.context,U=c.transform,Z=D.gl,ie=U.projection.name==="globe",de=ie?["PROJECTION_GLOBE_VIEW"]:[];let ne=a.bw(r.projMatrix);if(ie&&a.ah(U.zoom)>0){const si=a.bg(r.canonical,U),wi=a.e1(si);ne=a.az(new Float32Array(16),U.globeMatrix,wi),a.az(ne,U.projMatrix,ne)}const me=a.bz();me[12]+=2*_/(a.q.devicePixelRatio*U.width),me[13]+=2*b/(a.q.devicePixelRatio*U.height),a.az(ne,me,ne);const Ce=c.getOrCreateProgram("debug",{defines:de}),Me=t.getTileByID(r.key);c.terrain&&c.terrain.setupElevationDraw(Me,Ce);const Pe=cs.disabled,Ne=hr.disabled,He=c.colorModeForRenderPass(),lt="$debug";D.activeTexture.set(Z.TEXTURE0),c.emptyTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),ie?Me._makeGlobeTileDebugBuffers(c.context,U):Me._makeDebugTileBoundsBuffers(c.context,U.projection);const ut=Me._tileDebugBuffer||c.debugBuffer,kt=Me._tileDebugIndexBuffer||c.debugIndexBuffer,wt=Me._tileDebugSegments||c.debugSegments;if(Ce.draw(c,Z.LINE_STRIP,Pe,Ne,He,Zs.disabled,$p(ne,d.toPremultipliedRenderColor(null)),lt,ut,kt,wt,null,null,null,[Me._globeTileDebugBorderBuffer]),E){const si=Me.latestRawTileData,wi=Math.floor((si&&si.byteLength||0)/1024);let _i=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(_i+=` => ${r.overscaledZ}`),_i+=` ${Me.state}`,_i+=` ${wi}kb`,function(Bi,Kt){Bi.initDebugOverlayCanvas();const ui=Bi.debugOverlayCanvas,Ft=Bi.context.gl,Ai=Bi.debugOverlayCanvas.getContext("2d");Ai.clearRect(0,0,ui.width,ui.height),Ai.shadowColor="white",Ai.shadowBlur=2,Ai.lineWidth=1.5,Ai.strokeStyle="white",Ai.textBaseline="top",Ai.font="bold 36px Open Sans, sans-serif",Ai.fillText(Kt,5,5),Ai.strokeText(Kt,5,5),Bi.debugOverlayTexture.update(ui),Bi.debugOverlayTexture.bind(Ft.LINEAR,Ft.CLAMP_TO_EDGE)}(c,_i)}const xt=t.getTile(r).tileSize,pt=512/Math.min(xt,512)*(r.overscaledZ/U.zoom)*.5,At=Me._tileDebugTextBuffer||c.debugBuffer,Ct=Me._tileDebugTextIndexBuffer||c.quadTriangleIndexBuffer,ti=Me._tileDebugTextSegments||c.debugSegments;Ce.draw(c,Z.TRIANGLES,Pe,Ne,Fr.alphaBlended,Zs.disabled,$p(ne,a.am.transparent.toPremultipliedRenderColor(null),pt),lt,At,Ct,ti,null,null,null,[Me._globeTileDebugTextBuffer])}function eo(c,t,r,d){ta(c,0,t+r/2,c.transform.width,r,d)}function ya(c,t,r,d){ta(c,t-r/2,0,r,c.transform.height,d)}function ta(c,t,r,d,_,b){const E=c.context,D=E.gl;D.enable(D.SCISSOR_TEST),D.scissor(t*a.q.devicePixelRatio,r*a.q.devicePixelRatio,d*a.q.devicePixelRatio,_*a.q.devicePixelRatio),E.clear({color:b}),D.disable(D.SCISSOR_TEST)}const Ea=a.d_([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:mn}=Ea;function qr(c,t,r,d){c.emplaceBack(t,r,d)}class Sl{constructor(t){this.vertexArray=new a.e2,this.indices=new a.a_,qr(this.vertexArray,-1,-1,1),qr(this.vertexArray,1,-1,1),qr(this.vertexArray,-1,1,1),qr(this.vertexArray,1,1,1),qr(this.vertexArray,-1,-1,-1),qr(this.vertexArray,1,-1,-1),qr(this.vertexArray,-1,1,-1),qr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,mn),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=a.bd.simpleSegment(0,0,36,12)}}function oo(c,t,r,d,_,b){const E=c.context.gl,D=t.paint.get("sky-atmosphere-color"),U=t.paint.get("sky-atmosphere-halo-color"),Z=t.paint.get("sky-atmosphere-sun-intensity"),ie=((de,ne,me,Ce,Me)=>({u_matrix_3f:de,u_sun_direction:ne,u_sun_intensity:me,u_color_tint_r:[Ce.r,Ce.g,Ce.b,Ce.a],u_color_tint_m:[Me.r,Me.g,Me.b,Me.a],u_luminance:5e-5}))(a.e4(a.dx(),d),_,Z,D.toPremultipliedRenderColor(null),U.toPremultipliedRenderColor(null));E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+b,t.skyboxTexture,0),r.draw(c,E.TRIANGLES,cs.disabled,hr.disabled,Fr.unblended,Zs.frontCW,ie,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const Hc=a.d_([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class am{constructor(t){const r=new a.e5;r.emplaceBack(-1,1,1,0,0),r.emplaceBack(1,1,1,1,0),r.emplaceBack(1,-1,1,1,1),r.emplaceBack(-1,-1,1,0,1);const d=new a.a_;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(r,Hc.members),this.indexBuffer=t.createIndexBuffer(d),this.segments=a.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const pn=a.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Cg{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class wf{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Fr([1,gp,1,gp],a.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Fr([1,0,1,0],a.am.transparent,[!1,!1,!1,!0]),this.params=new Cg,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const r=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new am(r);const d=this.params.sizeRange,_=this.params.intensityRange,b=function(ie){const de=a.e7(30),ne=[];for(let me=0;me<ie;++me){const Ce=2*Math.PI*de(),Me=Math.acos(1-2*de())-.5*Math.PI;ne.push(a.cS(Math.cos(Me)*Math.cos(Ce),Math.cos(Me)*Math.sin(Ce),Math.sin(Me)))}return ne}(this.params.starsCount),E=a.e7(300),D=new a.e6,U=new a.a_;let Z=0;for(let ie=0;ie<b.length;++ie){const de=a.bY([],b[ie],200),ne=Math.max(0,1+.01*d*(1*E()-.5)),me=Math.max(0,1+.01*_*(1*E()-.5));D.emplaceBack(de[0],de[1],de[2],-1,-1,ne,me),D.emplaceBack(de[0],de[1],de[2],1,-1,ne,me),D.emplaceBack(de[0],de[1],de[2],1,1,ne,me),D.emplaceBack(de[0],de[1],de[2],-1,1,ne,me),U.emplaceBack(Z+0,Z+1,Z+2),U.emplaceBack(Z+0,Z+2,Z+3),Z+=4}this.starsVx=r.createVertexBuffer(D,pn.members),this.starsIdx=r.createIndexBuffer(U),this.starsSegments=a.bd.simpleSegment(0,0,D.length,U.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,r){const d=t.context,_=d.gl,b=t.transform,E=new cs(_.LEQUAL,cs.ReadOnly,[0,1]),D=a.ah(b.zoom),U=t.style.getLut(r.scope),Z=r.properties.get("color-use-theme")==="none",ie=r.properties.get("color").toNonPremultipliedRenderColor(Z?null:U).toArray01(),de=r.properties.get("high-color-use-theme")==="none",ne=r.properties.get("high-color").toNonPremultipliedRenderColor(de?null:U).toArray01(),me=r.properties.get("space-color-use-theme")==="none",Ce=r.properties.get("space-color").toNonPremultipliedRenderColor(me?null:U).toArray01(),Me=5e-4,Pe=a.e8(r.properties.get("horizon-blend"),0,1,Me,.25),Ne=a.dl(t,d,b)&&Pe===Me?b.worldSize/(2*Math.PI*1.025)-1:b.globeRadius,He=t.frameCounter/1e3%1,lt=a.ae(b.globeCenterInViewSpace),ut=Math.sqrt(Math.pow(lt,2)-Math.pow(Ne,2)),kt=Math.acos(ut/lt),wt=xt=>{const pt=b.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];xt&&pt.push("ALPHA_PASS");const At=t.getOrCreateProgram("globeAtmosphere",{defines:pt}),Ct=((si,wi,_i,Bi,Kt,ui,Ft,Ai,ai,Di,Yi,Mi)=>({u_frustum_tl:si,u_frustum_tr:wi,u_frustum_br:_i,u_frustum_bl:Bi,u_horizon:Kt,u_transition:ui,u_fadeout_range:Ft,u_color:Ai,u_high_color:ai,u_space_color:Di,u_temporal_offset:Yi,u_horizon_angle:Mi}))(b.frustumCorners.TL,b.frustumCorners.TR,b.frustumCorners.BR,b.frustumCorners.BL,b.frustumCorners.horizon,D,Pe,ie,ne,Ce,He,kt);t.uploadCommonUniforms(d,At);const ti=this.atmosphereBuffer;ti&&At.draw(t,_.TRIANGLES,E,hr.disabled,xt?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Zs.backCW,Ct,xt?"atmosphere_glow_alpha":"atmosphere_glow",ti.vertexBuffer,ti.indexBuffer,ti.segments)};wt(!1),wt(!0)}drawStars(t,r){const d=a.ay(r.properties.get("star-intensity"),0,1);if(d===0)return;const _=t.context,b=_.gl,E=t.transform,D=t.getOrCreateProgram("stars"),U=a.b_([]);a.c0(U,U,-E._pitch),a.b$(U,U,-E.angle),a.c0(U,U,a.al(E._center.lat)),a.e9(U,U,-a.al(E._center.lng));const Z=a.c3(new Float32Array(16),U),ie=a.az([],E.starsProjMatrix,Z),de=a.e4([],Z),ne=a.ea([],de),me=[0,1,0];a.dz(me,me,ne),a.bY(me,me,this.params.sizeMultiplier);const Ce=[1,0,0];a.dz(Ce,Ce,ne),a.bY(Ce,Ce,this.params.sizeMultiplier);const Me=(Pe=me,Ne=Ce,He=d,{u_matrix:Float32Array.from(ie),u_up:Pe,u_right:Ne,u_intensity_multiplier:He});var Pe,Ne,He;t.uploadCommonUniforms(_,D),this.starsVx&&this.starsIdx&&D.draw(t,b.TRIANGLES,cs.disabled,hr.disabled,this.colorModeAlphaBlendedWriteRGB,Zs.disabled,Me,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function tp(c,t){const r=[...c],d=t.cameraWorldSizeForFog/t.worldSize,_=a.bx([]);return a.cE(_,_,[d,d,1]),a.az(r,_,r),a.az(r,t.worldToFogMatrix,r),r}function Oi(c,t,r,d,_){const b=r.material,E=d.context,{baseColorTexture:D,metallicRoughnessTexture:U}=b.pbrMetallicRoughness,{normalTexture:Z,occlusionTexture:ie,emissionTexture:de}=b;function ne(Ce,Me,Pe){if(Ce&&(c.push(Me),E.activeTexture.set(E.gl.TEXTURE0+Pe),Ce.gfxTexture)){const{minFilter:Ne,magFilter:He,wrapS:lt,wrapT:ut}=Ce.sampler;Ce.gfxTexture.bindExtraParam(Ne,He,lt,ut)}}ne(D,"HAS_TEXTURE_u_baseColorTexture",Qa.BaseColor),ne(U,"HAS_TEXTURE_u_metallicRoughnessTexture",Qa.MetallicRoughness),ne(Z,"HAS_TEXTURE_u_normalTexture",Qa.Normal),ne(ie,"HAS_TEXTURE_u_occlusionTexture",Qa.Occlusion),ne(de,"HAS_TEXTURE_u_emissionTexture",Qa.Emission),_&&(_.texture||(_.texture=new a.eh(d.context,_.image,[_.image.height,_.image.height,_.image.height],E.gl.RGBA8)),E.activeTexture.set(E.gl.TEXTURE0+Qa.LUT),_.texture&&_.texture.bind(E.gl.LINEAR,E.gl.CLAMP_TO_EDGE),c.push("APPLY_LUT_ON_GPU")),r.texcoordBuffer&&(c.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(r.texcoordBuffer)),r.colorBuffer&&(c.push(r.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(r.colorBuffer)),r.normalBuffer&&(c.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(r.normalBuffer)),r.pbrBuffer&&(c.push("HAS_ATTRIBUTE_a_pbr"),c.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(r.pbrBuffer)),b.alphaMode!=="OPAQUE"&&b.alphaMode!=="MASK"||c.push("UNPREMULT_TEXTURE_IN_SHADER"),b.defined||c.push("DIFFUSE_SHADED");const me=d.shadowRenderer;me&&(c.push("RENDER_SHADOWS","DEPTH_TEXTURE"),me.useNormalOffset&&c.push("NORMAL_OFFSET"))}function ms(c,t,r,d,_,b){const E=r.paint.get("model-opacity").constantOr(1),D=t.context,U=new cs(t.context.gl.LEQUAL,cs.ReadWrite,t.depthRangeFor3D),Z=t.transform,ie=c.mesh,de=ie.material,ne=de.pbrMetallicRoughness,me=t.style.fog;let Ce;Ce=t.transform.projection.zAxisUnit==="pixels"?[...c.nodeModelMatrix]:a.az([],d.zScaleMatrix,c.nodeModelMatrix),a.az(Ce,d.negCameraPosMatrix,Ce);const Me=a.bi([],Ce);a.ee(Me,Me);const Pe=r.paint.get("model-color-use-theme").constantOr("default")==="none",Ne=r.paint.get("model-emissive-strength").constantOr(0),He=Bu(new Float32Array(c.worldViewProjection),new Float32Array(Ce),new Float32Array(Me),null,t,E,ne.baseColorFactor,de.emissiveFactor,ne.metallicFactor,ne.roughnessFactor,de,Ne,r),lt={defines:[]},ut=[],kt=t.shadowRenderer;kt&&(kt.useNormalOffset=!1),Oi(lt.defines,ut,ie,t,Pe?null:r.lut);let wt=null;if(me){const At=tp(c.nodeModelMatrix,t.transform);if(wt=new Float32Array(At),Z.projection.name!=="globe"){const Ct=ie.aabb.min,ti=ie.aabb.max,[si,wi]=me.getOpacityForBounds(At,Ct[0],Ct[1],ti[0],ti[1]);lt.overrideFog=si>=li||wi>=li}}const xt=eh(t,r.paint.get("model-cutoff-fade-range"));xt.shouldRenderCutoff&&lt.defines.push("RENDER_CUTOFF");const pt=t.getOrCreateProgram("model",lt);t.uploadCommonUniforms(D,pt,null,wt,xt),t.renderPass!=="shadow"&&kt&&kt.setupShadowsFromMatrix(c.nodeModelMatrix,pt),pt.draw(t,D.gl.TRIANGLES,U,_,b,ie.material.doubleSided?Zs.disabled:Zs.backCCW,He,r.id,ie.vertexBuffer,ie.indexBuffer,ie.segments,r.paint,t.transform.zoom,void 0,ut)}function Tp(c,t,r,d,_,b,E){let D;D=c.projection.name==="globe"?a.ed(r,c):[...r],a.az(D,D,t.matrix);const U=a.az([],d,D);if(t.meshes)for(const Z of t.meshes){if(Z.material.alphaMode!=="BLEND"){E.push({mesh:Z,depth:0,modelIndex:_,worldViewProjection:U,nodeModelMatrix:D});continue}const ie=a.ad([],Z.centroid,U);!c.isOrthographic&&ie[2]<=0||b.push({mesh:Z,depth:ie[2],modelIndex:_,worldViewProjection:U,nodeModelMatrix:D})}if(t.children)for(const Z of t.children)Tp(c,Z,r,d,_,b,E)}function kn(c,t,r,d){const _=r.shadowRenderer;if(!_)return;const b=_.getShadowPassDepthMode(),E=_.getShadowPassColorMode(),D=_.calculateShadowPassMatrixFromMatrix(t),U=Zp(D);r.getOrCreateProgram("modelDepth",{defines:r._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(r,r.context.gl.TRIANGLES,b,hr.disabled,E,Zs.backCCW,U,d.id,c.vertexBuffer,c.indexBuffer,c.segments,d.paint,r.transform.zoom,void 0,void 0)}function Zt(c,t,r){const d=t.updateZoomBasedPaintProperties(),_=function(b,E,D){let U,Z,ie,de=b.terrain?b.terrain.exaggeration():0;if(b.terrain&&de>0){const ne=b.terrain,me=ne.findDEMTileFor(D);me&&me.dem?U=a.ei.create(ne,D,me):de=0}if(de===0&&(E.terrainElevationMin=0,E.terrainElevationMax=0),de===E.validForExaggeration&&(de===0||U&&U._demTile&&U._demTile.tileID===E.validForDEMTile.id&&U._dem._timestamp===E.validForDEMTile.timestamp))return!1;for(const ne in E.instancesPerModel){const me=E.instancesPerModel[ne];for(let Ce=0;Ce<me.instancedDataArray.length;++Ce){const Me=(U?de*U.getElevationAt(0|me.instancedDataArray.float32[16*Ce],0|me.instancedDataArray.float32[16*Ce+1],!0,!0):0)+me.instancesEvaluatedElevation[Ce];me.instancedDataArray.float32[16*Ce+6]=Me,Z=Z?Math.min(E.terrainElevationMin,Me):Me,ie=ie?Math.max(E.terrainElevationMax,Me):Me}}return E.terrainElevationMin=Z||0,E.terrainElevationMax=ie||0,E.validForExaggeration=de,E.validForDEMTile=U&&U._demTile?{id:U._demTile.tileID,timestamp:U._dem._timestamp}:{id:void 0,timestamp:0},!0}(c,t,r);(d||_)&&(t.uploaded=!1,t.upload(c.context))}const vh={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new a.cW([0,0,0],[a.aj,a.aj,0])};function zm(c,t){const r=1<<c.canonical.z,d=t.getFreeCameraOptions().position,_=t.elevation,b=c.canonical.x/r,E=(c.canonical.x+1)/r,D=c.canonical.y/r,U=(c.canonical.y+1)/r;let Z=t._centerAltitude;if(_){const me=_.getMinMaxForTile(c);me&&me.max>Z&&(Z=me.max)}const ie=a.ay(d.x,b,E)-d.x,de=a.ay(d.y,D,U)-d.y,ne=a.c6(Z,t.center.lat)-d.z;return t._zoomFromMercatorZ(Math.sqrt(ie*ie+de*de+ne*ne))}function Ho(c,t,r,d,_,b,E){const D=c.context,U=c.renderPass==="shadow",Z=c.shadowRenderer,ie=U&&Z?Z.getShadowPassDepthMode():new cs(D.gl.LEQUAL,cs.ReadWrite,c.depthRangeFor3D),de=c.isTileAffectedByFog(b);if(r.meshes)for(const ne of r.meshes){const me=["MODEL_POSITION_ON_GPU"],Ce=[];let Me,Pe,Ne;d.instancedDataArray.length>20&&me.push("INSTANCED_ARRAYS");const He=eh(c,t.paint.get("model-cutoff-fade-range"));if(He.shouldRenderCutoff&&me.push("RENDER_CUTOFF"),U&&Z)Me=c.getOrCreateProgram("modelDepth",{defines:me}),Pe=Zp(E.shadowTileMatrix,E.shadowTileMatrix,Float32Array.from(r.matrix)),Ne=Z.getShadowPassColorMode();else{Oi(me,Ce,ne,c,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),Me=c.getOrCreateProgram("model",{defines:me,overrideFog:de});const ut=ne.material,kt=ut.pbrMetallicRoughness,wt=t.paint.get("model-opacity").constantOr(1),xt=t.paint.get("model-emissive-strength").constantOr(0);Pe=Bu(b.expandedProjMatrix,Float32Array.from(r.matrix),new Float32Array(16),null,c,wt,kt.baseColorFactor,ut.emissiveFactor,kt.metallicFactor,kt.roughnessFactor,ut,xt,t,_),Z&&(E.shadowUniformsInitialized?Me.setShadowUniformValues(D,Z.getShadowUniformValues()):(Z.setupShadows(b.toUnwrapped(),Me,"model-tile",b.overscaledZ),E.shadowUniformsInitialized=!0)),Ne=He.shouldRenderCutoff||wt<1||ut.alphaMode!=="OPAQUE"?Fr.alphaBlended:Fr.unblended}c.uploadCommonUniforms(D,Me,b.toUnwrapped(),null,He);const lt=ne.material.doubleSided?Zs.disabled:Zs.backCCW;if(d.instancedDataArray.length>20)Ce.push(d.instancedDataBuffer),Me.draw(c,D.gl.TRIANGLES,ie,hr.disabled,Ne,lt,Pe,t.id,ne.vertexBuffer,ne.indexBuffer,ne.segments,t.paint,c.transform.zoom,void 0,Ce,d.instancedDataArray.length);else{const ut=U?"u_instance":"u_normal_matrix";for(let kt=0;kt<d.instancedDataArray.length;++kt)Pe[ut]=new Float32Array(d.instancedDataArray.arrayBuffer,64*kt,16),Me.draw(c,D.gl.TRIANGLES,ie,hr.disabled,Ne,lt,Pe,t.id,ne.vertexBuffer,ne.indexBuffer,ne.segments,t.paint,c.transform.zoom,void 0,Ce)}}if(r.children)for(const ne of r.children)Ho(c,t,ne,d,_,b,E)}const hg=[1,-1,1];function Pg(c,t,r,d){if(!r.modelManager)return!0;const _=r.modelManager;if(!r.shadowRenderer)return!0;const b=r.shadowRenderer,E=t.aabb;let D=!0,U=c.maxHeight;if(U===0){let ie=0;for(const de in c.instancesPerModel){const ne=_.getModel(de,d);ne?ie=Math.max(ie,Math.max(Math.max(ne.aabb.max[0],ne.aabb.max[1]),ne.aabb.max[2])):D=!1}U=c.maxScale*ie*1.41+c.maxVerticalOffset,D&&(c.maxHeight=U)}E.max[2]=U,E.min[2]+=c.terrainElevationMin,E.max[2]+=c.terrainElevationMax,a.ad(E.min,E.min,t.tileMatrix),a.ad(E.max,E.max,t.tileMatrix);const Z=E.intersects(b.getCurrentCascadeFrustum());return r.currentShadowCascade===0&&(c.isInsideFirstShadowMapFrustum=Z===2),Z===0}function Fl(c,t){const r=c.uniformValues.u_cutoff_params[0],d=c.uniformValues.u_cutoff_params[1],_=c.uniformValues.u_cutoff_params[2],b=c.uniformValues.u_cutoff_params[3];return d===r||b===_?1:a.ay(((t-r)/(d-r)-_)/(b-_),0,1)}function ip(c,t,r,d){if(t.pitch<20)return 1;const _=t.getWorldToCameraMatrix();a.az(_,_,c);const b=a.ej(r.min[0],r.min[1],r.min[2],1);let E=a.aA(a.ek(),b,_),D=E,U=E;b[1]=r.max[1],E=a.aA(a.ek(),b,_),D=E[1]<D[1]?E:D,U=E[1]>U[1]?E:U,b[0]=r.max[0],E=a.aA(a.ek(),b,_),D=E[1]<D[1]?E:D,U=E[1]>U[1]?E:U,b[1]=r.min[1],E=a.aA(a.ek(),b,_),D=E[1]<D[1]?E:D,U=E[1]>U[1]?E:U;const Z=a.ay(d[0],0,1),ie=100*t.pixelsPerMeter*a.ay(d[1],0,1),de=a.ay(d[2],0,1),ne=a.el(a.ek(),D,U,Z),me=Math.tan(.5*t.fovX),Ce=-ne[2]*me;if(ie===0)return ne[1]<-Math.abs(Ce)?de:1;const Me=(-Math.abs(Ce)-ne[1])/ie,Pe=(He,lt,ut)=>(1-ut)*He+ut*lt,Ne=a.ay(Pe(1,de,Me),de,1);return Pe(1,Ne,a.ay((t.pitch-20)/20,0,1))}class Ml{}class ny{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,r,d){{const de=this._storage.get(r.id);if(de)return de.lastUsedFrameIdx=t,de.buf}const _=d.gl,b=_.getBufferParameter(_.ELEMENT_ARRAY_BUFFER,_.BUFFER_SIZE),E=new ArrayBuffer(b),D=new Int16Array(E);_.getBufferSubData(_.ELEMENT_ARRAY_BUFFER,0,new Int16Array(E));const U=new a.en;for(let de=0;de<b/2;de+=3){const ne=D[de],me=D[de+1],Ce=D[de+2];U.emplaceBack(ne,me),U.emplaceBack(me,Ce),U.emplaceBack(Ce,ne)}const Z=d.bindVertexArrayOES.current,ie=new Ml;return ie.buf=new cd(d,U),ie.lastUsedFrameIdx=t,this._storage.set(r.id,ie),d.bindVertexArrayOES.set(Z),ie.buf}update(t){for(const[r,d]of this._storage)t-d.lastUsedFrameIdx>30&&(d.buf.destroy(),this._storage.delete(r))}destroy(){for(const[t,r]of this._storage)r.buf.destroy(),this._storage.delete(t)}}class xa{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Fu=a.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class el{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class tl{constructor(t,r){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...r,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...r,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const cg=a.d_([{type:"Float32",name:"a_pos_2f",components:2}]);class ia{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,r){const d=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const E=new a.eo,D=new a.a_;E.emplaceBack(-1,-1),E.emplaceBack(1,-1),E.emplaceBack(1,1),E.emplaceBack(-1,1),D.emplaceBack(0,1,2),D.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(E,cg.members),this.vignetteIdx=t.context.createIndexBuffer(D)}const _=a.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,d);const E={u_vignetteShape:(b={vignetteShape:[r.start,r.range,Math.pow(10,r.fadePower)],vignetteColor:[r.color.r,r.color.g,r.color.b,r.color.a*r.strength]}).vignetteShape,u_vignetteColor:b.vignetteColor};d.draw(t,t.context.gl.TRIANGLES,cs.disabled,hr.disabled,Fr.alphaBlended,Zs.disabled,E,"vignette",this.vignetteVx,this.vignetteIdx,_)}var b}}class Dh{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,r){const d=t.getFreeCameraOptions().position,_=d.toAltitude(),b=d.toLngLat(),E=a.al(b.lng),D=a.al(b.lat),U=t.pixelsPerMeter/r,Z=E*a.eq,ie=a.eq*Math.log(Math.tan(Math.PI/4+D/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const de=-this._offsetYPrev+ie,ne=-this._elevationPrev+_;this._accumulatedOffsetX+=(-this._offsetXPrev+Z)*U,this._accumulatedOffsetY+=de*U,this._accumulatedElevation+=ne*U,this._offsetXPrev=Z,this._offsetYPrev=ie,this._elevationPrev=_}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function hu(c,t){return[-(c[0]-Math.floor(c[0]/t)*t),-(c[1]-Math.floor(c[1]/t)*t),-(c[2]-Math.floor(c[2]/t)*t)]}function Nl(c){const t=a.e7(1323123451230),r=[];for(let d=0;d<c;++d){const _=2*t()-1,b=2*t()-1,E=2*t()-1;r.push(a.cS(_,b,E))}return r}function _a(c,t,r,d,_){const b=a.ay((_-r)/(d-r),0,1);return(1-b)*c+b*t}class th{constructor(t){this._movement=new Dh,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new ia,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,r){const d=t.transform;this._movement.update(d,this._ppmScaleFactor);const _=d.starsProjMatrix,b=a.b_([]);a.c0(b,b,a.al(90)-d._pitch),a.b$(b,b,-d.angle);const E=a.c3(new Float32Array(16),b),D=a.ep(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),U=a.ee([],D),Z=a.az([],U,E),ie=Date.now()/1e3;return this._accumulatedTimeFromStart+=(ie-this._prevTime)*r,this._prevTime=ie,{projectionMatrix:_,modelviewMatrix:Z}}}class Rm extends th{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new tl(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const r=t.context;if(!this.particlesVx){const d=Nl(this.particlesCount),_=new a.er,b=new a.a_;let E=0;const D=a.e7(1323123451230);for(let U=0;U<d.length;++U){const Z=d[U],ie=[2*D()-1,D(),D(),D()];_.emplaceBack(Z[0],Z[1],Z[2],-1,-1,...ie),_.emplaceBack(Z[0],Z[1],Z[2],1,-1,...ie),_.emplaceBack(Z[0],Z[1],Z[2],1,1,...ie),_.emplaceBack(Z[0],Z[1],Z[2],-1,1,...ie),b.emplaceBack(E+0,E+1,E+2),b.emplaceBack(E+0,E+2,E+3),E+=4}this.particlesVx=r.createVertexBuffer(_,Fu.members),this.particlesIdx=r.createIndexBuffer(b)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const r=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},d=t.transform.zoom;if(r.revealStart>d)return;const _=_a(0,1,r.revealStart,r.revealStart+r.revealRange,d);if(!this.particlesVx||!this.particlesIdx)return;const b=structuredClone(this._params);let E=[-b.direction.x,b.direction.y,-100];a.au(E,E);const D=structuredClone(this._vignetteParams);D.strength*=_,b.overrideStyleParameters||(b.intensity=t.style.rain.state.density,b.timeFactor=t.style.rain.state.intensity,b.color=structuredClone(t.style.rain.state.color),E=structuredClone(t.style.rain.state.direction),b.screenThinning.intensity=t.style.rain.state.centerThinning,b.dropletSizeX=t.style.rain.state.dropletSize[0],b.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],b.distortionStrength=100*t.style.rain.state.distortionStrength,D.strength=1,D.color=structuredClone(t.style.rain.state.vignetteColor));const U=this.updateOnRender(t,b.timeFactor),Z=t.context,ie=Z.gl,de=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new a.T(Z,{width:t.width,height:t.height,data:null},ie.RGBA8)),b.distortionStrength>0&&(Z.activeTexture.set(ie.TEXTURE0),this.screenTexture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE),ie.copyTexSubImage2D(ie.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const ne=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(Z,ne),Z.activeTexture.set(ie.TEXTURE0),this.screenTexture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);const me=[b.color.r,b.color.g,b.color.b,b.color.a],Ce=(Me,Pe)=>{const Ne=hu(this._movement.getPosition(),Me),He=b.dropletSizeX,lt=b.dropletSizeX*b.dropletSizeYScale,ut=t.width/2,kt=t.height/2,wt=_a(0,b.screenThinning.start,0,1,b.screenThinning.intensity),xt=_a(.001,b.screenThinning.range,0,1,b.screenThinning.intensity),pt=_a(0,b.screenThinning.particleOffset,0,1,b.screenThinning.intensity),At=(Ct={modelview:U.modelviewMatrix,projection:U.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Ne,velocityConeAperture:b.velocityConeAperture,velocity:b.velocity,boxSize:Me,rainDropletSize:[He,lt],distortionStrength:b.distortionStrength,rainDirection:E,color:me,screenSize:[de.width,de.height],thinningCenterPos:[ut,kt],thinningShape:[wt,xt,Math.pow(10,b.screenThinning.fadePower)],thinningAffectedRatio:b.screenThinning.affectedRatio,thinningParticleOffset:pt,shapeDirectionalPower:b.shapeDirPower,shapeNormalPower:b.shapeNormalPower,mode:Pe?0:1},{u_modelview:Float32Array.from(Ct.modelview),u_projection:Float32Array.from(Ct.projection),u_time:Ct.time,u_cam_pos:Ct.camPos,u_texScreen:0,u_velocityConeAperture:Ct.velocityConeAperture,u_velocity:Ct.velocity,u_boxSize:Ct.boxSize,u_rainDropletSize:Ct.rainDropletSize,u_distortionStrength:Ct.distortionStrength,u_rainDirection:Ct.rainDirection,u_color:Ct.color,u_screenSize:Ct.screenSize,u_thinningCenterPos:Ct.thinningCenterPos,u_thinningShape:Ct.thinningShape,u_thinningAffectedRatio:Ct.thinningAffectedRatio,u_thinningParticleOffset:Ct.thinningParticleOffset,u_shapeDirectionalPower:Ct.shapeDirectionalPower,u_shapeNormalPower:Ct.shapeNormalPower,u_mode:Ct.mode});var Ct;const ti=Math.round(b.intensity*this.particlesCount),si=a.bd.simpleSegment(0,0,4*ti,2*ti);ne.draw(t,ie.TRIANGLES,cs.disabled,hr.disabled,Fr.alphaBlended,Zs.disabled,At,"rain_particles",this.particlesVx,this.particlesIdx,si)};b.distortionStrength>0&&Ce(b.boxSize,!0),Ce(b.boxSize,!1),this._vignette.draw(t,D)}}const On=a.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Vo extends th{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new tl(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const r=t.context;if(!this.particlesVx){const d=Nl(this.particlesCount),_=new a.es,b=new a.a_;let E=0;const D=a.e7(1323123451230);for(let U=0;U<d.length;++U){const Z=d[U],ie=D(),de=D(),ne=D(),me=[U/d.length,ie,de,ne],Ce=[D(),D()];_.emplaceBack(Z[0],Z[1],Z[2],-1,-1,...me,...Ce),_.emplaceBack(Z[0],Z[1],Z[2],1,-1,...me,...Ce),_.emplaceBack(Z[0],Z[1],Z[2],1,1,...me,...Ce),_.emplaceBack(Z[0],Z[1],Z[2],-1,1,...me,...Ce),b.emplaceBack(E+0,E+1,E+2),b.emplaceBack(E+0,E+2,E+3),E+=4}this.particlesVx=r.createVertexBuffer(_,On.members),this.particlesIdx=r.createIndexBuffer(b)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const r=structuredClone(this._params);let d=[-r.direction.x,r.direction.y,-100];a.au(d,d);const _=structuredClone(this._vignetteParams),b=r.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},E=t.transform.zoom;if(b.revealStart>E)return;const D=_a(0,1,b.revealStart,b.revealStart+b.revealRange,E);_.strength*=D,r.overrideStyleParameters||(r.intensity=t.style.snow.state.density,r.timeFactor=t.style.snow.state.intensity,r.color=structuredClone(t.style.snow.state.color),d=structuredClone(t.style.snow.state.direction),r.screenThinning.intensity=t.style.snow.state.centerThinning,r.billboardSize=2.79*t.style.snow.state.flakeSize,_.strength=1,_.color=structuredClone(t.style.snow.state.vignetteColor));const U=this.updateOnRender(t,r.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const Z=t.context,ie=Z.gl,de=t.transform,ne=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(Z,ne),((me,Ce,Me)=>{const Pe=hu(this._movement.getPosition(),me),Ne=de.width/2,He=de.height/2,lt=_a(0,Me.screenThinning.start,0,1,Me.screenThinning.intensity),ut=_a(.001,Me.screenThinning.range,0,1,Me.screenThinning.intensity),kt=_a(0,Me.screenThinning.particleOffset,0,1,Me.screenThinning.intensity),wt=(xt={modelview:U.modelviewMatrix,projection:U.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Pe,velocityConeAperture:Me.velocityConeAperture,velocity:Me.velocity,horizontalOscillationRadius:Me.horizontalOscillationRadius,horizontalOscillationRate:Me.horizontalOscillationRate,boxSize:me,billboardSize:1*Me.billboardSize,simpleShapeParameters:[Me.shapeFadeStart,Me.shapeFadePower],screenSize:[de.width,de.height],thinningCenterPos:[Ne,He],thinningShape:[lt,ut,Math.pow(10,Me.screenThinning.fadePower)],thinningAffectedRatio:Me.screenThinning.affectedRatio,thinningParticleOffset:kt,color:[Me.color.r,Me.color.g,Me.color.b,Me.color.a],direction:d},{u_modelview:Float32Array.from(xt.modelview),u_projection:Float32Array.from(xt.projection),u_time:xt.time,u_cam_pos:xt.camPos,u_velocityConeAperture:xt.velocityConeAperture,u_velocity:xt.velocity,u_horizontalOscillationRadius:xt.horizontalOscillationRadius,u_horizontalOscillationRate:xt.horizontalOscillationRate,u_boxSize:xt.boxSize,u_billboardSize:xt.billboardSize,u_simpleShapeParameters:xt.simpleShapeParameters,u_screenSize:xt.screenSize,u_thinningCenterPos:xt.thinningCenterPos,u_thinningShape:xt.thinningShape,u_thinningAffectedRatio:xt.thinningAffectedRatio,u_thinningParticleOffset:xt.thinningParticleOffset,u_particleColor:xt.color,u_direction:xt.direction});var xt;const pt=Math.round(Me.intensity*this.particlesCount),At=a.bd.simpleSegment(0,0,4*pt,2*pt);this.particlesVx&&this.particlesIdx&&ne.draw(t,ie.TRIANGLES,cs.disabled,hr.disabled,Fr.alphaBlended,Zs.disabled,wt,"snow_particles",this.particlesVx,this.particlesIdx,At)})(r.boxSize,0,r),this._vignette.draw(t,_)}}const bo={symbol:function(c,t,r,d,_){if(c.renderPass!=="translucent")return;const b=hr.disabled,E=c.colorModeForRenderPass(),D=r.layout.get("text-variable-anchor"),U=r.layout.get("text-size-scale-range"),Z=a.ay(c.scaleFactor,U[0],U[1]);D&&function(ne,me,Ce,Me,Pe,Ne,He,lt){const ut=me.transform,kt=Pe==="map",wt=Ne==="map";for(const xt of ne){const pt=Me.getTile(xt),At=pt.getBucket(Ce);if(!At||!At.text||!At.text.segments.get().length)continue;const Ct=a.bH(At.textSizeData,ut.zoom,lt),ti=Np(xt,At.getProjection(),ut),si=ut.calculatePixelsToTileUnitsMatrix(pt),wi=fs(ti,pt.tileID.canonical,wt,kt,ut,At.getProjection(),si),_i=At.hasIconTextFit()&&At.hasIconData();Ct&&Ie(At,kt,wt,He,ut,wi,xt,Math.pow(2,ut.zoom-pt.tileID.overscaledZ),Ct,_i)}}(d,c,r,t,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),_,Z);const ie=r.paint.get("icon-opacity").constantOr(1)!==0,de=r.paint.get("text-opacity").constantOr(1)!==0;r.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(ie||de)?je(c,t,r,d,b,E):(ie&&je(c,t,r,d,b,E,{onlyIcons:!0}),de&&je(c,t,r,d,b,E,{onlyText:!0})),t.map.showCollisionBoxes&&(Ge(c,t,r,d,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),Ge(c,t,r,d,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))},circle:function(c,t,r,d){if(c.renderPass!=="translucent")return;const _=r.paint.get("circle-opacity"),b=r.paint.get("circle-stroke-width"),E=r.paint.get("circle-stroke-opacity"),D=r.layout.get("circle-sort-key").constantOr(1)!==void 0,U=r.paint.get("circle-emissive-strength");if(_.constantOr(1)===0&&(b.constantOr(1)===0||E.constantOr(1)===0))return;const Z=c.context,ie=Z.gl,de=c.transform,ne=!(!c.terrain||!c.terrain.enabled),me=r.layout.get("circle-elevation-reference"),Ce=c.depthModeForSublayer(0,cs.ReadOnly),Me=new cs(c.context.gl.LEQUAL,cs.ReadOnly,c.depthRangeFor3D),Pe=me==="none"||ne?Ce:Me,Ne=hr.disabled,He=c.colorModeForDrapableLayerRenderPass(U),lt=de.projection.name==="globe",ut=[a.aD(de.center.lng),a.aH(de.center.lat)],kt=[];for(let xt=0;xt<d.length;xt++){const pt=d[xt],At=t.getTile(pt),Ct=At.getBucket(r);if(!Ct||Ct.projection.name!==de.projection.name)continue;const ti=Ct.programConfigurations.get(r.id),si=Ct.layoutVertexBuffer,wi=Ct.globeExtVertexBuffer,_i=Ct.indexBuffer,Bi=a.dK(r),Kt=[wi],ui=c.isTileAffectedByFog(pt);lt&&Bi.push("PROJECTION_GLOBE_VIEW"),Bi.push("DEPTH_D24"),c.terrain&&de.depthOcclusionForSymbolsAndCircles&&Bi.push("DEPTH_OCCLUSION"),Ct.hasElevation&&(Bi.push("ELEVATED_ROADS"),Kt.push(Ct.elevatedLayoutVertexBuffer));const Ft=c.getOrCreateProgram("circle",{config:ti,defines:Bi,overrideFog:ui}),Ai=de.projection.createInversionMatrix(de,pt.canonical),ai={programConfiguration:ti,program:Ft,layoutVertexBuffer:si,dynamicBuffers:Kt,indexBuffer:_i,uniformValues:a.dL(c,pt,At,Ai,ut,r),tile:At};if(D){const Di=Ct.segments.get();for(const Yi of Di)kt.push({segments:new a.bd([Yi]),sortKey:Yi.sortKey,state:ai})}else kt.push({segments:Ct.segments,sortKey:0,state:ai})}D&&kt.sort((xt,pt)=>xt.sortKey-pt.sortKey);const wt={useDepthForOcclusion:de.depthOcclusionForSymbolsAndCircles};for(const xt of kt){const{programConfiguration:pt,program:At,layoutVertexBuffer:Ct,dynamicBuffers:ti,indexBuffer:si,uniformValues:wi,tile:_i}=xt.state,Bi=xt.segments;c.terrain&&c.terrain.setupElevationDraw(_i,At,wt),c.uploadCommonUniforms(Z,At,_i.tileID.toUnwrapped()),At.draw(c,ie.TRIANGLES,Pe,Ne,He,Zs.disabled,wi,r.id,Ct,si,Bi,r.paint,de.zoom,pt,ti)}},heatmap:function(c,t,r,d){if(r.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){const _=c.context,b=_.gl,E=hr.disabled,D=new Fr([b.ONE,b.ONE,b.ONE,b.ONE],a.am.transparent,[!0,!0,!0,!0]);(function(me,Ce,Me,Pe){const Ne=me.gl,He=Ce.width*Pe,lt=Ce.height*Pe;me.activeTexture.set(Ne.TEXTURE1),me.viewport.set([0,0,He,lt]);let ut=Me.heatmapFbo;if(!ut||ut&&(ut.width!==He||ut.height!==lt)){ut&&ut.destroy();const kt=Ne.createTexture();Ne.bindTexture(Ne.TEXTURE_2D,kt),Ne.texParameteri(Ne.TEXTURE_2D,Ne.TEXTURE_WRAP_S,Ne.CLAMP_TO_EDGE),Ne.texParameteri(Ne.TEXTURE_2D,Ne.TEXTURE_WRAP_T,Ne.CLAMP_TO_EDGE),Ne.texParameteri(Ne.TEXTURE_2D,Ne.TEXTURE_MIN_FILTER,Ne.LINEAR),Ne.texParameteri(Ne.TEXTURE_2D,Ne.TEXTURE_MAG_FILTER,Ne.LINEAR),ut=Me.heatmapFbo=me.createFramebuffer(He,lt,!0,null),function(wt,xt,pt,At,Ct,ti){const si=wt.gl;si.texImage2D(si.TEXTURE_2D,0,wt.extRenderToTextureHalfFloat?si.RGBA16F:si.RGBA,Ct,ti,0,si.RGBA,wt.extRenderToTextureHalfFloat?si.HALF_FLOAT:si.UNSIGNED_BYTE,null),At.colorAttachment.set(pt)}(me,0,kt,ut,He,lt)}else Ne.bindTexture(Ne.TEXTURE_2D,ut.colorAttachment.get()),me.bindFramebuffer.set(ut.framebuffer)})(_,c,r,c.transform.projection.name==="globe"?.5:.25),_.clear({color:a.am.transparent});const U=c.transform,Z=U.projection.name==="globe",ie=Z?["PROJECTION_GLOBE_VIEW"]:[],de=Z?Zs.frontCCW:Zs.disabled,ne=[a.aD(U.center.lng),a.aH(U.center.lat)];for(let me=0;me<d.length;me++){const Ce=d[me];if(t.hasRenderableParent(Ce))continue;const Me=t.getTile(Ce),Pe=Me.getBucket(r);if(!Pe||Pe.projection.name!==U.projection.name)continue;const Ne=c.isTileAffectedByFog(Ce),He=Pe.programConfigurations.get(r.id),lt=c.getOrCreateProgram("heatmap",{config:He,defines:ie,overrideFog:Ne}),{zoom:ut}=c.transform;c.terrain&&c.terrain.setupElevationDraw(Me,lt),c.uploadCommonUniforms(_,lt,Ce.toUnwrapped());const kt=U.projection.createInversionMatrix(U,Ce.canonical);lt.draw(c,b.TRIANGLES,cs.disabled,E,D,de,_f(c,Ce,Me,kt,ne,ut,r.paint.get("heatmap-intensity")),r.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Pe.segments,r.paint,c.transform.zoom,He,Z?[Pe.globeExtVertexBuffer]:null)}_.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(_,b){const E=_.context,D=E.gl,U=b.heatmapFbo;if(!U)return;E.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,U.colorAttachment.get()),E.activeTexture.set(D.TEXTURE1);let Z=b.colorRampTexture;Z||(Z=b.colorRampTexture=new a.T(E,b.colorRamp,D.RGBA8)),Z.bind(D.LINEAR,D.CLAMP_TO_EDGE),_.getOrCreateProgram("heatmapTexture").draw(_,D.TRIANGLES,cs.disabled,hr.disabled,_.colorModeForRenderPass(),Zs.disabled,((ie,de,ne,me)=>({u_image:0,u_color_ramp:1,u_opacity:de.paint.get("heatmap-opacity")}))(0,b),b.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,b.paint,_.transform.zoom)}(c,r))},line:function(c,t,r,d){if(c.renderPass!=="translucent")return;const _=r.paint.get("line-opacity"),b=r.paint.get("line-width");if(_.constantOr(1)===0||b.constantOr(1)===0)return;const E=r.paint.get("line-emissive-strength"),D=r.paint.get("line-occlusion-opacity"),U=r.layout.get("line-elevation-reference"),Z=r.layout.get("line-width-unit")==="meters",ie=U==="sea",de=!(!c.terrain||!c.terrain.enabled),ne=c.context,me=ne.gl;if(r.hasElevatedBuckets&&c.transform.projection.name==="globe")return;const Ce=r.layout.get("line-cross-slope"),Me=Ce!==void 0,Pe=Ce<1,Ne=c.colorModeForDrapableLayerRenderPass(E),He=c.terrain&&c.terrain.renderingToTexture,lt=He?1:a.q.devicePixelRatio,ut=r.paint.get("line-dasharray"),kt=ut.constantOr(1),wt=r.layout.get("line-cap"),xt=ut.constantOr(null),pt=wt.constantOr(null),At=r.paint.get("line-pattern"),Ct=At.constantOr(1),ti=r.paint.get("line-pattern-cross-fade"),si=At.constantOr(null),wi=r.paint.get("line-opacity").constantOr(1);let _i=!Ct&&wi!==1||c.depthOcclusion&&D>0&&D<1;const Bi=r.paint.get("line-gradient"),Kt=Ct?"linePattern":"line",ui=a.dM(r);let Ft;if(He&&c.terrain&&c.terrain.clipOrMaskOverlapStencilType()&&(_i=!1),D!==0&&c.depthOcclusion){const Yi=r.paint._values["line-opacity"];Yi&&Yi.value&&Yi.value.kind==="constant"?Ft=Yi.value:a.w(`Occlusion opacity for layer ${r.id} is supported only when line-opacity isn't data-driven.`)}b.value.kind!=="constant"&&b.value.isLineProgressConstant===!1&&ui.push("VARIABLE_LINE_WIDTH");const Ai=(Yi,Mi,qi,_s,Ts,us)=>{for(const Os of Yi){const Rs=t.getTile(Os);if(Ct&&!Rs.patternsLoaded())continue;const Js=Rs.getBucket(r);if(!Js||Js.elevationType!=="none"&&!Ts||Js.elevationType==="none"&&Ts)continue;c.prepareDrawTile();const ur=[...Mi],Pr=c.shadowRenderer,Bo=Js.elevationType==="road"&&!!Pr&&Pr.enabled;let Tn=[0,0,0];if(Bo){const Xr=c.style.directionalLight,$n=c.style.ambientLight;Xr&&$n&&(Tn=kd(c.style,Xr,$n)),ur.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const xo=Js.programConfigurations.get(r.id);let Yo=!1;if(si&&Rs.imageAtlas){const Xr=a.dN.from(si),$n=Xr.getPrimary().scaleSelf(lt).toString(),hn=Rs.imageAtlas.patternPositions.get($n),cn=Xr.getSecondary(),dn=cn?Rs.imageAtlas.patternPositions.get(cn.scaleSelf(lt).toString()):null;Yo=!!hn&&!!dn,hn&&xo.setConstantPatternPositions(hn,dn)}ti>0&&(Yo||xo.getPatternTransitionVertexBuffer("line-pattern"))&&ur.push("LINE_PATTERN_TRANSITION");const Nn=c.isTileAffectedByFog(Os),Er=c.getOrCreateProgram(Kt,{config:xo,defines:ur,overrideFog:Nn,overrideRtt:!Ts&&void 0});if(!Ct&&xt&&pt&&Rs.lineAtlas){const Xr=Rs.lineAtlas.getDash(xt,pt);Xr&&xo.setConstantPatternPositions(Xr)}Bo&&Pr.setupShadows(Rs.tileID.toUnwrapped(),Er,"vector-tile",Rs.tileID.overscaledZ);let[br,zr]=r.paint.get("line-trim-offset");(pt==="round"||pt==="square")&&br!==zr&&(br===0&&(br-=1),zr===1&&(zr+=1));const _n=He?Os.projMatrix:null,Xa=Z?1/Js.tileToMeter/a.aw(Rs,1,c.transform.zoom):1,Mo=Z?1/Js.tileToMeter/a.aw(Rs,1,Math.floor(c.transform.zoom)):1,jo=Ct?a.dO(c,Rs,r,_n,lt,Xa,Mo,[br,zr],Tn,ti):a.dP(c,Rs,r,_n,Js.lineClipsArray.length,lt,Xa,Mo,[br,zr],Tn);if(Bi){const Xr=Js.gradients[r.id];let $n=Xr.texture;if(r.gradientVersion!==Xr.version){let hn=256;if(r.stepInterpolant){const cn=t.getSource().maxzoom,dn=Os.canonical.z===cn?Math.ceil(1<<c.transform.maxZoom-Os.canonical.z):1;hn=a.ay(a.dQ(Js.maxLineLength/a.aj*1024*dn),256,ne.maxTextureSize)}Xr.gradient=a.dR({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:hn,image:Xr.gradient||void 0,clips:Js.lineClipsArray}),Xr.texture?Xr.texture.update(Xr.gradient):Xr.texture=new a.T(ne,Xr.gradient,me.RGBA8),Xr.version=r.gradientVersion,$n=Xr.texture}ne.activeTexture.set(me.TEXTURE1),$n.bind(r.stepInterpolant?me.NEAREST:me.LINEAR,me.CLAMP_TO_EDGE)}kt&&(ne.activeTexture.set(me.TEXTURE0),Rs.lineAtlasTexture&&Rs.lineAtlasTexture.bind(me.LINEAR,me.REPEAT),xo.updatePaintBuffers()),Ct&&(ne.activeTexture.set(me.TEXTURE0),Rs.imageAtlasTexture&&Rs.imageAtlasTexture.bind(me.LINEAR,me.CLAMP_TO_EDGE),xo.updatePaintBuffers()),Ts&&!ie&&c.terrain.setupElevationDraw(Rs,Er),c.uploadCommonUniforms(ne,Er,Os.toUnwrapped());const Yn=Xr=>{Ft!=null&&(Ft.value=wi*D),Er.draw(c,me.TRIANGLES,qi,Xr,Ne,Zs.disabled,jo,r.id,Js.layoutVertexBuffer,Js.indexBuffer,Js.segments,r.paint,c.transform.zoom,xo,[Js.layoutVertexBuffer2,Js.patternVertexBuffer,Js.zOffsetVertexBuffer]),Ft!=null&&(Ft.value=wi)};if(_i&&!Ts){const Xr=c.stencilModeForClipping(Os).ref;Xr===0&&He&&ne.clear({stencil:0});const $n={func:me.EQUAL,mask:255};jo.u_alpha_discard_threshold=.8,Yn(new hr($n,Xr,255,me.KEEP,me.KEEP,me.INVERT)),jo.u_alpha_discard_threshold=0,Yn(new hr($n,Xr,255,me.KEEP,me.KEEP,me.KEEP))}else jo.u_alpha_discard_threshold=_i&&Ts&&us?.8:0,Yn(Ts?_s:c.stencilModeForClipping(Os))}};let ai=c.depthModeForSublayer(0,cs.ReadOnly);const Di=new cs(c.depthOcclusion?me.GREATER:me.LEQUAL,cs.ReadOnly,c.depthRangeFor3D);if(r.hasNonElevatedBuckets){const Yi=!He&&c.terrain;D!==0&&Yi?a.w(`Occlusion opacity for layer ${r.id} is supported on terrain only if the layer has line-z-offset enabled.`):Yi?a.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${r.id}.`):Ai(d,ui,ai,hr.disabled,!1,!0)}if(r.hasElevatedBuckets){U==="hd-road-markup"?de||(ai=Di,ui.push("ELEVATED_ROADS")):(ui.push("ELEVATED"),ai=Di,Me&&ui.push(Pe?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),ie&&ui.push("ELEVATION_REFERENCE_SEA"));const Yi=_i?c.stencilModeFor3D():hr.disabled;c.forceTerrainMode=!0,Ai(d,ui,ai,Yi,!0,!0),_i&&Ai(d,ui,ai,Yi,!0,!1),c.forceTerrainMode=!1}_i&&(c.resetStencilClippingMasks(),He&&ne.clear({stencil:0})),D===0||c.depthOcclusion||He||c.layersWithOcclusionOpacity.push(c.currentLayer)},fill:function(c,t,r,d){const _=r.paint.get("fill-color"),b=r.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const E=r.paint.get("fill-emissive-strength"),D=c.colorModeForDrapableLayerRenderPass(E),U=r.paint.get("fill-pattern"),Z=c.opaquePassEnabledForLayer()&&!U.constantOr(1)&&_.constantOr(a.am.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";let ie="none";r.layout.get("fill-elevation-reference")!=="none"?ie="road":r.paint.get("fill-z-offset").constantOr(1)!==0&&(ie="offset");const de=!(!c.terrain||!c.terrain.enabled),ne={painter:c,sourceCache:t,layer:r,coords:d,colorMode:D,elevationType:ie,terrainEnabled:de,pass:Z};if(c.renderPass!=="shadow")if(ie!=="offset"){if(Bt(ne,!1),ie==="road"){const me=!de&&c.renderPass==="translucent";me&&bt(c,t,r,d,"geometry"),Bt(ne,!0,hr.disabled),me&&function(Ce){const{painter:Me,sourceCache:Pe,layer:Ne,coords:He,colorMode:lt}=Ce,ut=Me.context.gl,kt=Ce.painter.shadowRenderer,wt=!!kt&&kt.enabled,xt=new cs(Me.context.gl.LEQUAL,cs.ReadOnly,Me.depthRangeFor3D);let pt=[0,0,0];if(wt){const Ct=Me.style.directionalLight,ti=Me.style.ambientLight;Ct&&ti&&(pt=kd(Me.style,Ct,ti))}const At=Ct=>{for(const ti of He){const si=Pe.getTile(ti),wi=si.getBucket(Ne);if(!wi)continue;const _i=wi.elevatedStructures;if(!_i)continue;let Bi,Kt;if(Ct?(Bi=_i.renderableBridgeSegments,Kt=_i.bridgeProgramConfigurations.get(Ne.id)):(Bi=_i.renderableTunnelSegments,Kt=_i.tunnelProgramConfigurations.get(Ne.id)),!Bi||Bi.segments[0].primitiveLength===0)continue;Kt.updatePaintBuffers(),Me.prepareDrawTile();const ui=Me.isTileAffectedByFog(ti),Ft=[];wt&&Ft.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Ai=Me.getOrCreateProgram("elevatedStructures",{config:Kt,overrideFog:ui,defines:Ft}),ai=Me.translatePosMatrix(ti.projMatrix,si,Ne.paint.get("fill-translate"),Ne.paint.get("fill-translate-anchor"));wt&&kt.setupShadows(si.tileID.toUnwrapped(),Ai,"vector-tile",si.tileID.overscaledZ);const Di=Yp(ai,pt);Me.uploadCommonUniforms(Me.context,Ai,ti.toUnwrapped()),Ai.draw(Me,ut.TRIANGLES,xt,hr.disabled,lt,Zs.backCCW,Di,Ne.id,_i.vertexBuffer,_i.indexBuffer,Bi,Ne.paint,Me.transform.zoom,Kt,[_i.vertexBufferNormal])}};At(!0),At(!1)}(ne)}}else Bt(ne,!1,c.stencilModeFor3D());else c.shadowRenderer&&ie==="road"&&!de&&function(me){const{painter:Ce,sourceCache:Me,layer:Pe,coords:Ne}=me,He=Ce.context.gl,lt=me.painter.shadowRenderer;for(const ut of Ne){const kt=Me.getTile(ut),wt=kt.getBucket(Pe);if(!wt)continue;const xt=wt.elevatedStructures;if(!xt||!xt.shadowCasterSegments||xt.shadowCasterSegments.segments[0].primitiveLength===0)continue;Ce.prepareDrawTile();const pt=wt.bufferData.programConfigurations.get(Pe.id),At=Ce.isTileAffectedByFog(ut),Ct=Ce.getOrCreateProgram("elevatedStructuresDepth",{config:pt,overrideFog:At}),ti=lt.calculateShadowPassMatrixFromTile(kt.tileID.toUnwrapped());Ce.uploadCommonUniforms(Ce.context,Ct,ut.toUnwrapped());const si={u_matrix:ti,u_depth_bias:.001};Ct.draw(Ce,He.TRIANGLES,lt.getShadowPassDepthMode(),hr.disabled,lt.getShadowPassColorMode(),Zs.disabled,si,Pe.id,xt.vertexBuffer,xt.indexBuffer,xt.shadowCasterSegments,Pe.paint,Ce.transform.zoom,pt)}}(ne)},"fill-extrusion":function(c,t,r,d){const _=r.paint.get("fill-extrusion-opacity"),b=c.context,E=b.gl,D=c.terrain,U=D&&D.renderingToTexture;if(_===0)return;const Z=c.conflationActive&&c.style.isLayerClipped(r,t.getSource()),ie=c.style.order.indexOf(r.fqid);if(Z&&function(de,ne,me,Ce,Me){for(const Pe of Ce){const Ne=ne.getTile(Pe).getBucket(me);Ne&&(Ne.updateReplacement(Pe,de.replacementSource,Me),Ne.uploadCentroid(de.context))}}(c,t,r,d,ie),D||Z)for(const de of d){const ne=t.getTile(de).getBucket(r);ne&&qe(c.context,t,de,ne,r,D,Z)}if(c.renderPass==="shadow"&&c.shadowRenderer){const de=c.shadowRenderer;if(D&&_<.65&&r._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof a.ab)return;const ne=de.getShadowPassDepthMode(),me=de.getShadowPassColorMode();gt(c,t,r,d,ne,hr.disabled,me,Z)}else if(c.renderPass==="translucent"){const de=!r.paint.get("fill-extrusion-pattern").constantOr(1),ne=r.paint.get("fill-extrusion-color").constantOr(a.am.white);if(!U&&ne.a!==0){const me=new cs(c.context.gl.LEQUAL,cs.ReadWrite,c.depthRangeFor3D);_===1&&de?gt(c,t,r,d,me,hr.disabled,Fr.unblended,Z):(gt(c,t,r,d,me,hr.disabled,Fr.disabled,Z),gt(c,t,r,d,me,c.stencilModeFor3D(),c.colorModeForRenderPass(),Z),c.resetStencilClippingMasks())}if(c.style.enable3dLights()&&de&&(!D&&c.transform.projection.name!=="globe"||U)){const me=r.paint.get("fill-extrusion-opacity"),Ce=r.paint.get("fill-extrusion-ambient-occlusion-intensity"),Me=r.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),Pe=r.paint.get("fill-extrusion-flood-light-intensity"),Ne=r.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",He=r.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Ne?null:r.lut).toArray01().slice(0,3),lt=Ce>0&&Me>0,ut=Pe>0,kt=(xt,pt,At)=>(1-At)*xt+At*pt,wt=xt=>{const pt=c.depthModeForSublayer(1,cs.ReadOnly,E.LEQUAL,!0),At=r.paint.get(xt?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ct=kt(.1,3,At),ti=c._showOverdrawInspector;if(!ti){const si=new hr({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),wi=new Fr([E.ONE,E.ONE,E.ONE,E.ONE],a.am.transparent,[!1,!1,!1,!0],E.MIN);Lt(c,t,r,d,pt,si,wi,Zs.disabled,xt,"sdf",me,Ce,Me,Pe,He,Ct,Z,!1)}{const si=ti?hr.disabled:new hr({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),wi=ti?c.colorModeForRenderPass():new Fr([E.ONE_MINUS_DST_ALPHA,E.DST_ALPHA,E.ONE,E.ONE],a.am.transparent,[!0,!0,!0,!0]);Lt(c,t,r,d,pt,si,wi,Zs.disabled,xt,"color",me,Ce,Me,Pe,He,Ct,Z,!1)}};if(U){const xt=(pt,At,Ct)=>{const ti=c.depthModeForSublayer(1,cs.ReadOnly,E.LEQUAL,!1),si=r.paint.get(pt?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),wi=kt(.1,3,si);{const _i=new Fr([E.ONE,E.ONE,E.ONE,E.ONE],a.am.transparent,[!1,!1,!1,!0]);Lt(c,t,r,d,ti,hr.disabled,_i,Zs.disabled,pt,"clear",me,Ce,Me,Pe,He,wi,Z,At)}{const _i=new hr({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),Bi=new Fr([E.ONE,E.ONE,E.ONE,E.ONE],a.am.transparent,[!1,!1,!1,!0],E.MIN);Lt(c,t,r,d,ti,_i,Bi,Zs.disabled,pt,"sdf",me,Ce,Me,Pe,He,wi,Z,At)}{const _i=pt?E.ZERO:E.ONE_MINUS_DST_ALPHA,Bi=new hr({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),Kt=new Fr([_i,E.DST_ALPHA,E.ONE_MINUS_DST_ALPHA,E.ZERO],a.am.transparent,[!0,!0,!0,!0]);Lt(c,t,r,d,ti,Bi,Kt,Zs.disabled,pt,"color",me,Ce,Me,Pe,He,wi,Z,At)}{const _i=new Fr([E.ONE,E.ONE,E.ONE,pt?E.ZERO:E.ONE],a.am.transparent,[!1,!1,!1,!0],pt?E.FUNC_ADD:E.MAX);Lt(c,t,r,d,ti,hr.disabled,_i,Zs.disabled,pt,"clear",me,Ce,Me,Pe,He,wi,Z,At,Ct)}};if(lt||ut){let pt;if(c.prepareDrawTile(),D){const At=D.drapeBufferSize[0],Ct=D.drapeBufferSize[1];pt=D.framebufferCopyTexture,pt&&(!pt||pt.size[0]===At&&pt.size[1]===Ct)||(pt&&pt.destroy(),pt=D.framebufferCopyTexture=new a.T(b,new a.r({width:At,height:Ct}),E.RGBA8)),pt.bind(E.LINEAR,E.CLAMP_TO_EDGE),E.copyTexSubImage2D(E.TEXTURE_2D,0,0,0,0,0,At,Ct)}lt&&xt(!0,!1,pt),ut&&xt(!1,!0,pt)}}else lt&&wt(!0),ut&&wt(!1),(lt||ut)&&c.resetStencilClippingMasks()}}},building:function(c,t,r,d){},hillshade:function(c,t,r,d){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent"||c.style.disableElevatedTerrain)return;const _=c.context,b=c.terrain&&c.terrain.renderingToTexture,[E,D]=c.renderPass!=="translucent"||b?[{},d]:c.stencilConfigForOverlap(d);for(const U of D){const Z=t.getTile(U);if(Z.needsHillshadePrepare&&c.renderPass==="offscreen")ad(c,Z,r);else if(c.renderPass==="translucent"){const ie=c.depthModeForSublayer(0,cs.ReadOnly),de=r.paint.get("hillshade-emissive-strength"),ne=c.colorModeForDrapableLayerRenderPass(de),me=b&&c.terrain?c.terrain.stencilModeForRTTOverlap(U):E[U.overscaledZ];ff(c,U,Z,r,ie,me,ne)}}_.viewport.set([0,0,c.width,c.height]),c.resetStencilClippingMasks()},raster:function(c,t,r,d,_,b){if(c.renderPass!=="translucent"||r.paint.get("raster-opacity")===0)return;const E=c.transform.projection.name==="globe",D=r.paint.get("raster-elevation")!==0,U=D&&E;if(c.renderElevatedRasterBackface&&!U)return;const Z=c.context,ie=Z.gl,de=t.getSource(),ne=function(wt,xt,pt,At){const Ct=xt.paint.get("raster-color"),ti=wt.type==="raster-array",si=[],wi=xt.paint.get("raster-resampling"),_i=xt.paint.get("raster-color-mix");let Bi=xt.paint.get("raster-color-range");const Kt=[_i[0],_i[1],_i[2],0],ui=_i[3];let Ft=wi==="nearest"?At.NEAREST:At.LINEAR;if(ti&&(si.push("RASTER_ARRAY"),Ct||si.push("RASTER_COLOR"),wi==="linear"&&si.push("RASTER_ARRAY_LINEAR"),Ft=At.NEAREST,!Bi&&wt.rasterLayers)){const Ai=wt.rasterLayers.find(({id:ai})=>ai===xt.sourceLayer);Ai&&Ai.fields&&Ai.fields.range&&(Bi=Ai.fields.range)}if(Bi=Bi||[0,1],Ct){si.push("RASTER_COLOR"),pt.activeTexture.set(At.TEXTURE2),xt.updateColorRamp(Bi);let Ai=xt.colorRampTexture;Ai||(Ai=xt.colorRampTexture=new a.T(pt,xt.colorRamp,At.RGBA8)),Ai.bind(At.LINEAR,At.CLAMP_TO_EDGE)}return{mix:Kt,range:Bi,offset:ui,defines:si,resampling:Ft}}(de,r,Z,ie);if(de instanceof a.aP&&!d.length&&!E)return;const me=r.paint.get("raster-emissive-strength"),Ce=c.colorModeForDrapableLayerRenderPass(me),Me=c.terrain&&c.terrain.renderingToTexture,Pe=!c.options.moving,Ne=r.paint.get("raster-resampling")==="nearest"?ie.NEAREST:ie.LINEAR;if(de instanceof a.aP&&!d.length&&(de.onNorthPole||de.onSouthPole)){const wt=D?c.stencilModeFor3D():hr.disabled;return void ji(!!de.onNorthPole,null,c,t,r,me,ne,Zs.disabled,wt)}if(!d.length)return;const[He,lt]=de instanceof a.aP||Me?[{},d]:c.stencilConfigForOverlap(d),ut=lt[lt.length-1].overscaledZ;U&&ne.defines.push("PROJECTION_GLOBE_VIEW"),D&&ne.defines.push("RENDER_CUTOFF");const kt=(wt,xt,pt)=>{for(const At of wt){const Ct=At.toUnwrapped(),ti=t.getTile(At);if(Me&&(!ti||!ti.hasData()))continue;Z.activeTexture.set(ie.TEXTURE0);const si=zi(ti,de,r,ne);if(!si||!si.texture)continue;const{texture:wi,mix:_i,offset:Bi,tileSize:Kt,buffer:ui}=si;let Ft,Ai;Me?(Ft=cs.disabled,Ai=At.projMatrix):D?(Ft=new cs(ie.LEQUAL,cs.ReadWrite,c.depthRangeFor3D),Ai=E?Float32Array.from(c.transform.expandedFarZProjMatrix):c.transform.calculateProjMatrix(Ct,Pe)):(Ft=c.depthModeForSublayer(At.overscaledZ-ut,r.paint.get("raster-opacity")===1?cs.ReadWrite:cs.ReadOnly,ie.LESS),Ai=c.transform.calculateProjMatrix(Ct,Pe));const ai=c.terrain&&Me?c.terrain.stencilModeForRTTOverlap(At):He[At.overscaledZ],Di=b?0:r.paint.get("raster-fade-duration");ti.registerFadeDuration(Di);const Yi=t.findLoadedParent(At,0),Mi=Bl(ti,Yi,t,c.transform,Di);let qi,_s;c.terrain&&c.terrain.prepareDrawTile(),Z.activeTexture.set(ie.TEXTURE0),wi.bind(Ne,ie.CLAMP_TO_EDGE),Z.activeTexture.set(ie.TEXTURE1),Yi?(Yi.texture&&Yi.texture.bind(Ne,ie.CLAMP_TO_EDGE),qi=Math.pow(2,Yi.tileID.overscaledZ-ti.tileID.overscaledZ),_s=[ti.tileID.canonical.x*qi%1,ti.tileID.canonical.y*qi%1]):wi.bind(Ne,ie.CLAMP_TO_EDGE),"useMipmap"in wi&&Z.extTextureFilterAnisotropic&&c.transform.pitch>20&&ie.texParameterf(ie.TEXTURE_2D,Z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Z.extTextureFilterAnisotropicMax);const Ts=c.transform;let us;const Os=D?Ms(Ts):[0,0,0,0];let Rs,Js,ur,Pr,Bo,Tn=0;if(U&&de instanceof a.aP&&de.coordinates.length>3)Rs=Float32Array.from(a.bh(a.dr(new a.cp(0,0,0)))),Js=Float32Array.from(Ts.globeMatrix),ur=Float32Array.from(a.dm(Ts)),Pr=[a.aD(Ts.center.lng),a.aH(Ts.center.lat)],us=de.elevatedGlobePerspectiveTransform,Bo=de.elevatedGlobeGridMatrix||new Float32Array(9);else if(U){const Er=a.dn(At.canonical);Tn=a.dp(Er.getCenter().lat),Rs=Float32Array.from(a.bh(a.dr(At.canonical))),Js=Float32Array.from(Ts.globeMatrix),ur=Float32Array.from(a.dm(Ts)),Pr=[a.aD(Ts.center.lng),a.aH(Ts.center.lat)],us=[0,0],Bo=Float32Array.from(a.dq(At.canonical,Er,Tn,Ts.worldSize/Ts._pixelsPerMercatorPixel))}else us=de instanceof a.aP?de.perspectiveTransform:[0,0],Rs=new Float32Array(16),Js=new Float32Array(9),ur=new Float32Array(16),Pr=[0,0],Bo=new Float32Array(9);const xo=Ru(Ai,Rs,Js,ur,Bo,_s||[0,0],a.ah(c.transform.zoom),Pr,Os,qi||1,Mi,r,us,D?r.paint.get("raster-elevation"):0,2,_i,Bi,ne.range,Kt,ui,me),Yo=c.isTileAffectedByFog(At),Nn=c.getOrCreateProgram("raster",{defines:ne.defines,overrideFog:Yo});if(c.uploadCommonUniforms(Z,Nn,Ct),de instanceof a.aP){const Er=de.elevatedGlobeVertexBuffer,br=de.elevatedGlobeIndexBuffer;if(Me||!E)de.boundsBuffer&&de.boundsSegments&&Nn.draw(c,ie.TRIANGLES,Ft,hr.disabled,Ce,Zs.disabled,xo,r.id,de.boundsBuffer,c.quadTriangleIndexBuffer,de.boundsSegments);else if(Er&&br){const zr=Ts.zoom<=a.cL?de.elevatedGlobeSegments:de.getSegmentsForLongitude(Ts.center.lng);zr&&Nn.draw(c,ie.TRIANGLES,Ft,hr.disabled,Ce,xt,xo,r.id,Er,br,zr)}}else if(U){Ft=new cs(ie.LEQUAL,cs.ReadOnly,c.depthRangeFor3D);const Er=c.globeSharedBuffers;if(Er){const[br,zr,_n]=Er.getGridBuffers(Tn,!1);Nn.draw(c,ie.TRIANGLES,Ft,pt||ai,c.colorModeForRenderPass(),xt,xo,r.id,br,zr,_n)}}else{const{tileBoundsBuffer:Er,tileBoundsIndexBuffer:br,tileBoundsSegments:zr}=c.getTileBoundsBuffers(ti);Nn.draw(c,ie.TRIANGLES,Ft,ai,Ce,Zs.disabled,xo,r.id,Er,br,zr)}}if(!(de instanceof a.aP)&&U)for(const At of wt){const Ct=At.canonical.y===(1<<At.canonical.z)-1;At.canonical.y===0&&ji(!0,At,c,t,r,me,ne,xt,pt||hr.disabled),Ct&&ji(!1,At,c,t,r,me,ne,xt===Zs.frontCW?Zs.backCW:Zs.frontCW,pt||hr.disabled)}};U?kt(lt,c.renderElevatedRasterBackface?Zs.backCW:Zs.frontCW,c.stencilModeFor3D()):kt(lt,Zs.disabled,void 0),c.resetStencilClippingMasks()},"raster-particle":function(c,t,r,d,_,b){c.renderPass==="offscreen"&&function(E,D,U,Z){if(!Z.length)return;const ie=E.context,de=ie.gl,ne=D.getSource();if(!(ne instanceof Xh))return;const me=Math.ceil(Math.sqrt(U.paint.get("raster-particle-count")));let Ce=U.particlePositionRGBAImage;if(!Ce||Ce.width!==me){const lt=function(ut){const kt=ut*ut,wt=new Uint8Array(4*kt),xt=function(At){return At|=0,At=Math.imul(2747636419^At,2654435769),At=Math.imul(At^At>>>16,2654435769),((At=Math.imul(At^At>>>16,2654435769))>>>0)/4294967296},pt=1/1.1;for(let At=0;At<kt;At++){const Ct=pt*(xt(2*At+0)+lu),ti=pt*(xt(2*At+1)+lu),si=255*Ct%1,wi=255*ti%1,_i=si,Bi=ti-wi/255,Kt=wi;wt[4*At+0]=255*(Ct-si/255),wt[4*At+1]=255*_i,wt[4*At+2]=255*Bi,wt[4*At+3]=255*Kt}return wt}(me);Ce=U.particlePositionRGBAImage=new a.r({width:me,height:me},lt)}let Me=U.particleFramebuffer;Me?Me.width!==me&&(Me.destroy(),Me=U.particleFramebuffer=ie.createFramebuffer(me,me,!0,null)):Me=U.particleFramebuffer=ie.createFramebuffer(me,me,!0,null);const Pe=[];for(const lt of Z){const ut=D.getTile(lt);if(!(ut instanceof fa))continue;const kt=Xi(ut,ne,U);if(!kt)continue;const wt=[ut.tileSize,ut.tileSize];let xt=U.tileFramebuffer;xt||(xt=U.tileFramebuffer=ie.createFramebuffer(wt[0],wt[1],!0,null));let pt=ut.rasterParticleState;pt||(pt=ut.rasterParticleState=new Fs(ie,lt,wt,Ce));const At=pt.update(U.lastInvalidatedAt);pt.particleTextureDimension!==me&&pt.updateParticleTexture(lt,Ce);const Ct=pt.targetColorTexture;pt.targetColorTexture=pt.backgroundColorTexture,pt.backgroundColorTexture=Ct;const ti=pt.particleTexture0;pt.particleTexture0=pt.particleTexture1,pt.particleTexture1=ti,Pe.push([lt,kt,pt,At])}if(Pe.length===0)return;const Ne=a.q.now(),He=U.previousDrawTimestamp?.001*(Ne-U.previousDrawTimestamp):.0167;if(U.previousDrawTimestamp=Ne,U.hasColorMap()){ie.activeTexture.set(de.TEXTURE0+2);let lt=U.colorRampTexture;lt||(lt=U.colorRampTexture=new a.T(ie,U.colorRamp,de.RGBA8)),lt.bind(de.LINEAR,de.CLAMP_TO_EDGE)}ie.bindFramebuffer.set(U.tileFramebuffer.framebuffer),function(lt,ut,kt){const wt=lt.context,xt=wt.gl,pt=ut.tileFramebuffer;wt.activeTexture.set(xt.TEXTURE0);const At={u_texture:0,u_opacity:1.05*(ti=ut.paint.get("raster-particle-fade-opacity-factor"))/(ti+.05)},Ct=lt.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ti;for(const si of kt){const[,,wi,_i]=si;pt.colorAttachment.set(wi.targetColorTexture.texture),wt.viewport.set([0,0,pt.width,pt.height]),wt.clear({color:a.am.transparent}),_i&&(wi.backgroundColorTexture.bind(xt.NEAREST,xt.CLAMP_TO_EDGE),Ct.draw(lt,xt.TRIANGLES,cs.disabled,hr.disabled,Fr.alphaBlended,Zs.disabled,At,ut.id,lt.viewportBuffer,lt.quadTriangleIndexBuffer,lt.viewportSegments))}}(E,U,Pe),function(lt,ut,kt,wt){const xt=lt.context,pt=xt.gl,At=kt.tileFramebuffer,Ct=lt.transform.projection.name==="globe",ti=kt.paint.get("raster-particle-max-speed");for(const si of wt){const[wi,_i,Bi]=si;xt.activeTexture.set(pt.TEXTURE0+0),_i.texture.bind(pt.LINEAR,pt.CLAMP_TO_EDGE),At.colorAttachment.set(Bi.targetColorTexture.texture);const Kt=lt.getOrCreateProgram("rasterParticleDraw",{defines:_i.defines,overrideFog:!1});xt.activeTexture.set(pt.TEXTURE0+1);const ui=_i.scalarData?[]:[0,1,2,3].map(ai=>a.dT[ai](wi));ui.push(wi);const Ft=wi.canonical.x,Ai=wi.canonical.y;for(const ai of ui){const Di=ut.getTile(Ct?ai.wrapped():ai);if(!Di)continue;const Yi=Di.rasterParticleState;if(!Yi)continue;const Mi=ai.canonical.x+(1<<ai.canonical.z)*(ai.wrap-wi.wrap),qi=ai.canonical.y;Yi.particleTexture0.bind(pt.NEAREST,pt.CLAMP_TO_EDGE);const _s=qp(1,Yi.particleTexture0.size[0],[Mi-Ft,qi-Ai],0,_i.texture.size,2,ti,_i.textureOffset,_i.scale,_i.offset);Kt.draw(lt,pt.POINTS,cs.disabled,hr.disabled,Fr.alphaBlended,Zs.disabled,_s,kt.id,Yi.particleIndexBuffer,void 0,Yi.particleSegment)}}}(E,D,U,Pe),ie.bindFramebuffer.set(U.particleFramebuffer.framebuffer),function(lt,ut,kt,wt){const xt=lt.context,pt=xt.gl,At=ut.paint.get("raster-particle-max-speed"),Ct=wt*ut.paint.get("raster-particle-speed-factor")*.15,ti=function(wi){return Math.pow(wi,6)}(.01+1*ut.paint.get("raster-particle-reset-rate-factor")),si=ut.particleFramebuffer;xt.viewport.set([0,0,si.width,si.height]);for(const wi of kt){const[,_i,Bi]=wi;xt.activeTexture.set(pt.TEXTURE0+0),_i.texture.bind(pt.LINEAR,pt.CLAMP_TO_EDGE),xt.activeTexture.set(pt.TEXTURE0+1);const Kt=Bi.particleTexture0;Kt.bind(pt.NEAREST,pt.CLAMP_TO_EDGE);const ui=lc(1,Kt.size[0],0,_i.texture.size,At,Ct,ti,_i.textureOffset,_i.scale,_i.offset);si.colorAttachment.set(Bi.particleTexture1.texture),xt.clear({color:a.am.transparent}),lt.getOrCreateProgram("rasterParticleUpdate",{defines:_i.defines}).draw(lt,pt.TRIANGLES,cs.disabled,hr.disabled,Fr.unblended,Zs.disabled,ui,ut.id,lt.viewportBuffer,lt.quadTriangleIndexBuffer,lt.viewportSegments)}}(E,U,Pe,He)}(c,t,r,d),c.renderPass==="translucent"&&(function(E,D,U,Z,ie){const de=E.context,ne=de.gl,me=D.getSource().tileSize,Ce=5*(1-a.af(a.cx,a.cx+1,E.transform.zoom))*me+U.paint.get("raster-particle-elevation"),Me=!E.options.moving,Pe=E.transform.projection.name==="globe";if(!Z.length)return;const[Ne,He]=E.stencilConfigForOverlap(Z),lt=[];Pe&&lt.push("PROJECTION_GLOBE_VIEW");const ut=E.stencilModeFor3D();for(const kt of He){const wt=kt.toUnwrapped(),xt=D.getTile(kt);if(!xt.rasterParticleState)continue;const pt=xt.rasterParticleState,At=100;xt.registerFadeDuration(At);const Ct=D.findLoadedParent(kt,0),ti=Bl(xt,Ct,D,E.transform,At);let si,wi;E.terrain&&E.terrain.prepareDrawTile(),de.activeTexture.set(ne.TEXTURE0),pt.targetColorTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),de.activeTexture.set(ne.TEXTURE1),Ct&&Ct.rasterParticleState?(Ct.rasterParticleState.targetColorTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),si=Math.pow(2,Ct.tileID.overscaledZ-xt.tileID.overscaledZ),wi=[xt.tileID.canonical.x*si%1,xt.tileID.canonical.y*si%1]):pt.targetColorTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);const _i=Pe?Float32Array.from(E.transform.expandedFarZProjMatrix):E.transform.calculateProjMatrix(wt,Me),Bi=E.transform,Kt=Es(Bi),ui=a.dn(kt.canonical),Ft=a.dp(ui.getCenter().lat);let Ai,ai,Di,Yi,Mi;Pe?(Ai=Float32Array.from(a.bh(a.dr(kt.canonical))),ai=Float32Array.from(Bi.globeMatrix),Di=Float32Array.from(a.dm(Bi)),Yi=[a.aD(Bi.center.lng),a.aH(Bi.center.lat)],Mi=Float32Array.from(a.dq(kt.canonical,ui,Ft,Bi.worldSize/Bi._pixelsPerMercatorPixel))):(Ai=new Float32Array(16),ai=new Float32Array(9),Di=new Float32Array(16),Yi=[0,0],Mi=new Float32Array(9));const qi=ac(_i,Ai,ai,Di,Mi,wi||[0,0],a.ah(E.transform.zoom),Yi,Kt,si||1,ti,Ce),_s=E.isTileAffectedByFog(kt),Ts=E.getOrCreateProgram("rasterParticle",{defines:lt,overrideFog:_s});if(E.uploadCommonUniforms(de,Ts,wt),Pe){const us=new cs(ne.LEQUAL,cs.ReadOnly,E.depthRangeFor3D),Os=0,Rs=E.globeSharedBuffers;if(Rs){const[Js,ur,Pr]=Rs.getGridBuffers(Ft,Os!==0);Ts.draw(E,ne.TRIANGLES,us,ut,Fr.alphaBlended,E.renderElevatedRasterBackface?Zs.frontCCW:Zs.backCCW,qi,U.id,Js,ur,Pr)}}else{const us=E.depthModeForSublayer(0,cs.ReadOnly),Os=Ne[kt.overscaledZ],{tileBoundsBuffer:Rs,tileBoundsIndexBuffer:Js,tileBoundsSegments:ur}=E.getTileBoundsBuffers(xt);Ts.draw(E,ne.TRIANGLES,us,Os,Fr.alphaBlended,Zs.disabled,qi,U.id,Rs,Js,ur)}}E.resetStencilClippingMasks()}(c,t,r,d),c.style.map.triggerRepaint())},background:function(c,t,r,d){const _=r.paint.get("background-color"),b=r.paint.get("background-color-use-theme").constantOr("default")==="none",E=r.paint.get("background-opacity"),D=r.paint.get("background-emissive-strength"),U=r.paint.get("background-pitch-alignment")==="viewport";if(E===0)return;const Z=c.context,ie=Z.gl,de=c.transform,ne=de.tileSize,me=r.paint.get("background-pattern");let Ce;if(me!==void 0&&(me===null||(Ce=c.imageManager.getPattern(a.I.from(me.toString()),r.scope,c.style.getLut(r.scope)),!Ce)))return;const Me=!me&&_.a===1&&E===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==Me)return;const Pe=hr.disabled,Ne=c.depthModeForSublayer(0,Me==="opaque"?cs.ReadWrite:cs.ReadOnly),He=c.colorModeForDrapableLayerRenderPass(D),lt=me?"backgroundPattern":"background";let ut,kt=d;if(kt||(ut=c.getBackgroundTiles(),kt=Object.values(ut).map(wt=>wt.tileID)),me&&(Z.activeTexture.set(ie.TEXTURE0),c.imageManager.bind(c.context,r.scope)),U){const wt=c.getOrCreateProgram(lt,{overrideFog:!1,overrideRtt:!0}),xt=new Float32Array(a.bx([])),pt=new a.aM(0,0,0,0,0),At=me?Om(xt,D,E,c,0,r.scope,Ce,U,{tileID:pt,tileSize:ne}):nm(xt,D,E,_.toPremultipliedRenderColor(b?null:r.lut));wt.draw(c,ie.TRIANGLES,Ne,Pe,He,Zs.disabled,At,r.id,c.viewportBuffer,c.quadTriangleIndexBuffer,c.viewportSegments)}else for(const wt of kt){const xt=c.isTileAffectedByFog(wt),pt=c.getOrCreateProgram(lt,{overrideFog:xt}),At=wt.toUnwrapped(),Ct=d?wt.projMatrix:c.transform.calculateProjMatrix(At);c.prepareDrawTile();const ti=t?t.getTile(wt):ut?ut[wt.key]:new Zh(wt,ne,de.zoom,c),si=me?Om(Ct,D,E,c,0,r.scope,Ce,U,{tileID:wt,tileSize:ne}):nm(Ct,D,E,_.toPremultipliedRenderColor(b?null:r.lut));c.uploadCommonUniforms(Z,pt,At);const{tileBoundsBuffer:wi,tileBoundsIndexBuffer:_i,tileBoundsSegments:Bi}=c.getTileBoundsBuffers(ti);pt.draw(c,ie.TRIANGLES,Ne,Pe,He,Zs.disabled,si,r.id,wi,_i,Bi)}},sky:function(c,t,r){const d=c._atmosphere?a.ah(c.transform.zoom):1,_=r.paint.get("sky-opacity")*d;if(_===0)return;const b=c.context,E=r.paint.get("sky-type"),D=new cs(b.gl.LEQUAL,cs.ReadOnly,[0,1]),U=c.frameCounter/1e3%1;E==="atmosphere"?c.renderPass==="offscreen"?r.needsSkyboxCapture(c)&&(function(Z,ie,de,ne){const me=Z.context,Ce=me.gl;let Me=ie.skyboxFbo;if(!Me){Me=ie.skyboxFbo=me.createFramebuffer(32,32,!0,null),ie.skyboxGeometry=new Sl(me),ie.skyboxTexture=me.gl.createTexture(),Ce.bindTexture(Ce.TEXTURE_CUBE_MAP,ie.skyboxTexture),Ce.texParameteri(Ce.TEXTURE_CUBE_MAP,Ce.TEXTURE_WRAP_S,Ce.CLAMP_TO_EDGE),Ce.texParameteri(Ce.TEXTURE_CUBE_MAP,Ce.TEXTURE_WRAP_T,Ce.CLAMP_TO_EDGE),Ce.texParameteri(Ce.TEXTURE_CUBE_MAP,Ce.TEXTURE_MIN_FILTER,Ce.LINEAR),Ce.texParameteri(Ce.TEXTURE_CUBE_MAP,Ce.TEXTURE_MAG_FILTER,Ce.LINEAR);for(let lt=0;lt<6;++lt)Ce.texImage2D(Ce.TEXTURE_CUBE_MAP_POSITIVE_X+lt,0,Ce.RGBA,32,32,0,Ce.RGBA,Ce.UNSIGNED_BYTE,null)}me.bindFramebuffer.set(Me.framebuffer),me.viewport.set([0,0,32,32]);const Pe=ie.getCenter(Z,!0),Ne=Z.getOrCreateProgram("skyboxCapture"),He=new Float64Array(16);a.bx(He),a.e3(He,He,.5*-Math.PI),oo(Z,ie,Ne,He,Pe,0),a.bx(He),a.e3(He,He,.5*Math.PI),oo(Z,ie,Ne,He,Pe,1),a.bx(He),a.cG(He,He,.5*-Math.PI),oo(Z,ie,Ne,He,Pe,2),a.bx(He),a.cG(He,He,.5*Math.PI),oo(Z,ie,Ne,He,Pe,3),a.bx(He),oo(Z,ie,Ne,He,Pe,4),a.bx(He),a.e3(He,He,Math.PI),oo(Z,ie,Ne,He,Pe,5),me.viewport.set([0,0,Z.width,Z.height])}(c,r),r.markSkyboxValid(c)):c.renderPass==="sky"&&function(Z,ie,de,ne,me){const Ce=Z.context,Me=Ce.gl,Pe=Z.transform,Ne=Z.getOrCreateProgram("skybox");Ce.activeTexture.set(Me.TEXTURE0),Me.bindTexture(Me.TEXTURE_CUBE_MAP,ie.skyboxTexture);const He=((lt,ut,kt,wt,xt)=>({u_matrix:lt,u_sun_direction:ut,u_cubemap:0,u_opacity:wt,u_temporal_offset:xt}))(Pe.skyboxMatrix,ie.getCenter(Z,!1),0,ne,me);Z.uploadCommonUniforms(Ce,Ne),Ne.draw(Z,Me.TRIANGLES,de,hr.disabled,Z.colorModeForRenderPass(),Zs.backCW,He,"skybox",ie.skyboxGeometry.vertexBuffer,ie.skyboxGeometry.indexBuffer,ie.skyboxGeometry.segment)}(c,r,D,_,U):E==="gradient"&&c.renderPass==="sky"&&function(Z,ie,de,ne,me){const Ce=Z.context,Me=Ce.gl,Pe=Z.transform,Ne=Z.getOrCreateProgram("skyboxGradient");ie.skyboxGeometry||(ie.skyboxGeometry=new Sl(Ce)),Ce.activeTexture.set(Me.TEXTURE0);let He=ie.colorRampTexture;He||(He=ie.colorRampTexture=new a.T(Ce,ie.colorRamp,Me.RGBA8)),He.bind(Me.LINEAR,Me.CLAMP_TO_EDGE);const lt=((ut,kt,wt,xt,pt)=>({u_matrix:ut,u_color_ramp:0,u_center_direction:kt,u_radius:a.al(wt),u_opacity:xt,u_temporal_offset:pt}))(Pe.skyboxMatrix,ie.getCenter(Z,!1),ie.paint.get("sky-gradient-radius"),ne,me);Z.uploadCommonUniforms(Ce,Ne),Ne.draw(Z,Me.TRIANGLES,de,hr.disabled,Z.colorModeForRenderPass(),Zs.backCW,lt,"skyboxGradient",ie.skyboxGeometry.vertexBuffer,ie.skyboxGeometry.indexBuffer,ie.skyboxGeometry.segment)}(c,r,D,_,U)},custom:function(c,t,r,d){const _=c.context,b=r.implementation;if(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes("custom")||c.terrain&&(c.terrain.renderingToTexture||c.renderPass==="offscreen")&&r.isDraped(t)){if(c.renderPass==="offscreen"){const E=b.prerender;if(E){if(c.setCustomLayerDefaults(),_.setColorMode(c.colorModeForRenderPass()),c.transform.projection.name==="globe"){const D=c.transform.pointMerc;E.call(b,_.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),a.ah(c.transform.zoom),[D.x,D.y],c.transform.pixelsPerMeterRatio)}else E.call(b,_.gl,c.transform.customLayerMatrix());_.setDirty(),c.setBaseState()}}else if(c.renderPass==="translucent"){if(c.terrain&&c.terrain.renderingToTexture){const D=b.renderToTile;if(D){const U=d[0].canonical,Z={x:U.x+d[0].wrap*(b.wrapTileId?0:1<<U.z),y:U.y,z:U.z};_.setDepthMode(cs.disabled),_.setStencilMode(hr.disabled),_.setColorMode(c.colorModeForRenderPass()),c.setCustomLayerDefaults(),D.call(b,_.gl,Z),_.setDirty(),c.setBaseState()}return}c.setCustomLayerDefaults(),_.setColorMode(c.colorModeForRenderPass()),_.setStencilMode(hr.disabled);const E=b.renderingMode==="3d"?new cs(c.context.gl.LEQUAL,cs.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,cs.ReadOnly);if(_.setDepthMode(E),c.transform.projection.name==="globe"){const D=c.transform.pointMerc;b.render(_.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),a.ah(c.transform.zoom),[D.x,D.y],c.transform.pixelsPerMeterRatio)}else b.render(_.gl,c.transform.customLayerMatrix());_.setDirty(),c.setBaseState(),_.bindFramebuffer.set(null)}}else a.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(c,t,r,d){if(c.renderPass==="opaque")return;const _=r.paint.get("model-opacity").constantOr(1);if(_===0)return;const b=r.paint.get("model-cast-shadows");if(c.renderPass==="shadow"&&(!b||c.terrain&&_<.65&&r._transitionablePaint._values["model-opacity"].value.expression instanceof a.ab))return;const E=c.shadowRenderer,D=r.paint.get("model-receive-shadows");E&&(E.useNormalOffset=!0,D||(E.enabled=!1));const U=()=>{E&&(E.useNormalOffset=!0,D||(E.enabled=!0))},Z=t.getSource();if(c.renderPass==="light-beam"&&Z.type!=="batched-model")return;if(Z.type==="vector"||Z.type==="geojson")return function(Ne,He,lt,ut,kt){const wt=Ne.transform;if(wt.projection.name!=="mercator")return void a.w(`Drawing 3D models for ${wt.projection.name} projection is not yet implemented`);const xt=wt.getFreeCameraOptions().position;if(!Ne.modelManager)return;const pt=Ne.modelManager;lt.modelManager=pt;const At=Ne.shadowRenderer;if(!lt._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ct=lt._unevaluatedLayout._values["model-id"],ti=Object.assign({},lt.layout.get("model-id").parameters),si=Ne.style.order.indexOf(lt.fqid);for(const wi of ut){const _i=He.getTile(wi).getBucket(lt);if(!_i||_i.projection.name!==wt.projection.name)continue;const Bi=_i.getModelUris();Bi&&!_i.modelsRequested&&(pt.addModelsFromBucket(Bi,kt),_i.modelsRequested=!0);const Kt=zm(wi,wt);ti.zoom=Kt;const ui=Ct.possiblyEvaluate(ti);if(Zt(Ne,_i,wi),vh.shadowUniformsInitialized=!1,vh.useSingleShadowCascade=!!At&&At.getMaxCascadeForTile(wi.toUnwrapped())===0,Ne.renderPass==="shadow"&&At){if(Ne.currentShadowCascade===1&&_i.isInsideFirstShadowMapFrustum)continue;const ai=wt.calculatePosMatrix(wi.toUnwrapped(),wt.worldSize);if(vh.tileMatrix.set(ai),vh.shadowTileMatrix=Float32Array.from(At.calculateShadowPassMatrixFromMatrix(ai)),vh.aabb.min.fill(0),vh.aabb.max[0]=vh.aabb.max[1]=a.aj,vh.aabb.max[2]=0,Pg(_i,vh,Ne,lt.scope))continue}const Ft=1<<wi.canonical.z,Ai=[((xt.x-wi.wrap)*Ft-wi.canonical.x)*a.aj,(xt.y*Ft-wi.canonical.y)*a.aj,xt.z*Ft*a.aj];Ne.conflationActive&&Object.keys(_i.instancesPerModel).length>0&&Ne.style.isLayerClipped(lt,He.getSource())&&_i.updateReplacement(wi,Ne.replacementSource,si,kt)&&(_i.uploaded=!1,_i.upload(Ne.context));for(let ai in _i.instancesPerModel){const Di=_i.instancesPerModel[ai];Di.features.length>0&&(ai=ui.evaluate(Di.features[0].feature,{}));const Yi=pt.getModel(ai,kt);if(Yi||pt.hasURLBeenRequested(ai)||_i.modelUris.includes(ai)||(_i.modelUris.push(ai),_i.modelsRequested=!1),Yi&&Yi.uploaded)for(const Mi of Yi.nodes)Ho(Ne,lt,Mi,Di,Ai,wi,vh)}}}(c,t,r,d,Z.type==="vector"?r.scope:""),void U();if(!Z.loaded())return;if(Z.type==="batched-model")return function(Ne,He,lt,ut){lt.resetLayerRenderingStats(Ne);const kt=Ne.context,wt=Ne.transform,xt=Ne.style.fog,pt=Ne.shadowRenderer;if(wt.projection.name!=="mercator")return void a.w(`Drawing 3D landmark models for ${wt.projection.name} projection is not yet implemented`);const At=Ne.transform.getFreeCameraOptions().position,Ct=a.bY([],[At.x,At.y,At.z],Ne.transform.worldSize),ti=a.eb([],Ct),si=a.bx([]),wi=a.ec(wt.center.lat,wt.zoom),_i=a.bn([],[1,1,1/wi]);a.bo(si,si,ti);const Bi=lt.paint.get("model-opacity").constantOr(1),Kt=new cs(kt.gl.LEQUAL,cs.ReadWrite,Ne.depthRangeFor3D),ui=new cs(kt.gl.LEQUAL,cs.ReadOnly,Ne.depthRangeFor3D),Ft=new a.cW([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Ai=Ne.renderPass==="shadow",ai=Ai&&pt?pt.getCurrentCascadeFrustum():wt.getFrustum(wt.scaleZoom(wt.worldSize)),Di=lt.paint.get("model-front-cutoff"),Yi=Di[2]<1,Mi=eh(Ne,lt.paint.get("model-cutoff-fade-range")),qi=lt.getLayerRenderingStats();(function(_s,Ts,us,Os){const Rs=_s.terrain?_s.terrain.exaggeration():0,Js=_s.transform.zoom;for(const ur of Os){const Pr=Ts.getTile(ur).getBucket(us);Pr&&(Pr.setFilter(us.filter),_s.conflationActive&&Pr.updateReplacement(ur,_s.replacementSource),Pr.evaluateTransform(_s,us),_s.terrain&&Rs>0&&Pr.elevationUpdate(_s.terrain,Rs,ur,us.source),Pr.needsReEvaluation(_s,Js,us)&&Pr.evaluate(us))}})(Ne,He,lt,ut),function(){let _s,Ts,us;Yi?(_s=ut.length-1,Ts=-1,us=-1):(_s=0,Ts=ut.length,us=1);const Os=new Float64Array(16),Rs=a.ef(),Js=new a.P(0,0);for(let ur=_s;ur!==Ts;ur+=us){const Pr=ut[ur],Bo=He.getTile(Pr).getBucket(lt);if(!Bo||!Bo.uploaded)continue;let Tn=!1;pt&&(Tn=pt.getMaxCascadeForTile(Pr.toUnwrapped())===0);const xo=wt.calculatePosMatrix(Pr.toUnwrapped(),wt.worldSize),Yo=Bo.modelTraits;!Ai&&Yi&&(a.bi(Os,xo),a.ad(Rs,Ct,Os),Js.x=Rs[0],Js.y=Rs[1]);const Nn=[];Bo.setFilter(lt.filter);for(const Er of Bo.getNodesInfo()){if(Er.hiddenByReplacement||!Er.node.meshes)continue;const br=Er.node;let zr=0;Ne.terrain&&br.elevation&&(zr=br.elevation*Ne.terrain.exaggeration());const _n=(()=>{const qn=Er.aabb;return Ft.min=[...qn.min],Ft.max=[...qn.max],Ft.min[2]+=zr,Ft.max[2]+=zr,a.ad(Ft.min,Ft.min,xo),a.ad(Ft.max,Ft.max,xo),Ft})(),Xa=Er.evaluatedScale;if(Xa[0]<=1&&Xa[1]<=1&&Xa[2]<=1&&_n.intersects(ai)===0)continue;if(!Ai&&Yi){const qn=.16666666666666666;Er.cameraCollisionOpacity=Ct[0]>_n.min[0]&&Ct[0]<_n.max[0]&&Ct[1]>_n.min[1]&&Ct[1]<_n.max[1]&&Ct[2]*wi<_n.max[2]&&br.footprint&&a.bS(Js,br.footprint)?Math.max(Er.cameraCollisionOpacity-qn,0):Math.min(1,Er.cameraCollisionOpacity+qn)}const Mo=[...xo],jo=1/a.cU(Pr.canonical),Yn=br.anchor?br.anchor[0]:0,Xr=br.anchor?br.anchor[1]:0;a.bo(Mo,Mo,[Yn*(Xa[0]-1)+Er.evaluatedTranslation[0]*jo,Xr*(Xa[1]-1)+Er.evaluatedTranslation[1]*jo,zr+Er.evaluatedTranslation[2]]),a.ci(Xa,a.eg)||a.cE(Mo,Mo,Xa);const $n=a.az([],Mo,br.matrix),hn=a.az([],wt.expandedFarZProjMatrix,$n),cn=a.az([],wt.expandedFarZProjMatrix,Mo),dn=a.aA([],[Yn,Xr,zr,1],hn)[2];br.hidden=!1;let _o=Bi;Ai||(Yi&&(_o*=Er.cameraCollisionOpacity,_o*=ip(Mo,wt,Er.aabb,Di)),_o*=Fl(Mi,dn)),_o!==0?Nn.push({nodeInfo:Er,depth:dn,opacity:_o,wvpForNode:hn,wvpForTile:cn,nodeModelMatrix:$n,tileModelMatrix:Mo}):br.hidden=!0}Ai||Nn.sort((Er,br)=>!Yi||Er.opacity===1&&br.opacity===1?Er.depth<br.depth?-1:1:Er.opacity===1?-1:br.opacity===1?1:Er.depth>br.depth?-1:1);for(const Er of Nn){const br=Er.nodeInfo,zr=br.node;let _n=a.az([],_i,Er.tileModelMatrix);a.az(_n,si,_n);const Xa=a.bi([],_n);a.ee(Xa,Xa),a.cE(Xa,Xa,hg),_n=a.az(_n,_n,zr.matrix);const Mo=Ne.renderPass==="light-beam",jo=lt.paint.get("model-color-use-theme").constantOr("default")==="none",Yn=Yo&a.em.HasMapboxMeshFeatures,Xr=Yn?0:br.evaluatedRMEA[0][2];for(let $n=0;$n<zr.meshes.length;++$n){const hn=zr.meshes[$n],cn=$n===zr.lightMeshIndex;let dn=Er.wvpForNode;if(cn){if(!Mo&&!Ne.terrain&&Ne.shadowRenderer){Ne.currentLayer<Ne.firstLightBeamLayer&&(Ne.firstLightBeamLayer=Ne.currentLayer);continue}dn=Er.wvpForTile}else if(Mo)continue;const _o={defines:[]},qn=[];if(!Ai&&pt&&(pt.useNormalOffset=!!hn.normalBuffer),Oi(_o.defines,qn,hn,Ne,jo?null:lt.lut),Yn||_o.defines.push("DIFFUSE_SHADED"),Tn&&_o.defines.push("SHADOWS_SINGLE_CASCADE"),qi&&(Ai?qi.numRenderedVerticesInShadowPass+=hn.vertexArray.length:qi.numRenderedVerticesInTransparentPass+=hn.vertexArray.length),Ai){kn(hn,Er.nodeModelMatrix,Ne,lt);continue}let uh=null;if(xt){const gu=tp(Er.nodeModelMatrix,Ne.transform);if(uh=new Float32Array(gu),wt.projection.name!=="globe"){const qc=hn.aabb.min,kc=hn.aabb.max,[hp,Fd]=xt.getOpacityForBounds(gu,qc[0],qc[1],kc[0],kc[1]);_o.overrideFog=hp>=li||Fd>=li}}const sn=hn.material;let Go;sn.occlusionTexture&&sn.occlusionTexture.offsetScale&&(Go=sn.occlusionTexture.offsetScale,_o.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const hc=Ne.getOrCreateProgram("model",_o);!Ai&&pt&&pt.setupShadowsFromMatrix(Er.tileModelMatrix,hc,pt.useNormalOffset),Ne.uploadCommonUniforms(kt,hc,null,uh);const Rh=sn.pbrMetallicRoughness;Rh.metallicFactor=.9,Rh.roughnessFactor=.5;const Bd=Bu(new Float32Array(dn),new Float32Array(_n),new Float32Array(Xa),new Float32Array(zr.matrix),Ne,Er.opacity,Rh.baseColorFactor,sn.emissiveFactor,Rh.metallicFactor,Rh.roughnessFactor,sn,Xr,lt,[0,0,0],Go);!cn&&(br.hasTranslucentParts||Er.opacity<1)&&hc.draw(Ne,kt.gl.TRIANGLES,Kt,hr.disabled,Fr.disabled,Zs.backCCW,Bd,lt.id,hn.vertexBuffer,hn.indexBuffer,hn.segments,lt.paint,Ne.transform.zoom,void 0,qn),hc.draw(Ne,kt.gl.TRIANGLES,cn?ui:Kt,hr.disabled,cn||Er.opacity<1||br.hasTranslucentParts?Fr.alphaBlended:Fr.unblended,Zs.backCCW,Bd,lt.id,hn.vertexBuffer,hn.indexBuffer,hn.segments,lt.paint,Ne.transform.zoom,void 0,qn)}}}}()}(c,t,r,d),void U();if(Z.type!=="model")return;const ie=Z.getModels(),de=[],ne=c.transform.getFreeCameraOptions().position,me=a.bY([],[ne.x,ne.y,ne.z],c.transform.worldSize);a.eb(me,me);const Ce=[],Me=[];let Pe=0;for(const Ne of ie){const He=r.paint.get("model-rotation").constantOr(null),lt=r.paint.get("model-scale").constantOr(null),ut=r.paint.get("model-translation").constantOr(null);Ne.computeModelMatrix(c,He,lt,ut,!0,!0,!1);const kt=a.bx([]),wt=a.ec(Ne.position.lat,c.transform.zoom),xt=a.bn([],[1,1,1/wt]);a.bo(kt,kt,me),de.push({zScaleMatrix:xt,negCameraPosMatrix:kt});for(const pt of Ne.nodes)Tp(c.transform,pt,Ne.matrix,c.transform.expandedFarZProjMatrix,Pe,Ce,Me);Pe++}if(Ce.sort((Ne,He)=>He.depth-Ne.depth),c.renderPass!=="shadow"){if(_===1)for(const Ne of Me)ms(Ne,c,r,de[Ne.modelIndex],hr.disabled,c.colorModeForRenderPass());else{for(const Ne of Me)ms(Ne,c,r,de[Ne.modelIndex],hr.disabled,Fr.disabled);for(const Ne of Me)ms(Ne,c,r,de[Ne.modelIndex],c.stencilModeFor3D(),c.colorModeForRenderPass());c.resetStencilClippingMasks()}for(const Ne of Ce)ms(Ne,c,r,de[Ne.modelIndex],hr.disabled,c.colorModeForRenderPass());U()}else{for(const Ne of Me)kn(Ne.mesh,Ne.nodeModelMatrix,c,r);for(const Ne of Ce)kn(Ne.mesh,Ne.nodeModelMatrix,c,r);U()}}},Dd={line:function(c,t,r){if(c.hasElevatedBuckets=!1,c.hasNonElevatedBuckets=!1,c._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||c._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const d=t.getVisibleCoordinates();for(const _ of d){const b=t.getTile(_).getBucket(c);if(b&&(b.elevationType!=="none"?c.hasElevatedBuckets=!0:c.hasNonElevatedBuckets=!0,c.hasElevatedBuckets&&c.hasNonElevatedBuckets))break}}}else c.hasNonElevatedBuckets=!0},model:function(c,t,r){const d=t.getSource();if(!d.loaded())return;if(d.type==="vector"||d.type==="geojson")return void(r.modelManager&&r.modelManager.upload(r,d.type==="vector"?c.scope:""));if(d.type==="batched-model"||d.type!=="model")return;const _=d.getModels();for(const b of _)b.upload(r.context)},raster:function(c,t,r){const d=t.getSource();if(!(d instanceof Xh&&d.loaded()))return;const _=c.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!_)return;const b=c.paint.get("raster-array-band")||d.getInitialBand(_);if(b==null)return;const E=t.getIds().map(D=>t.getTileByID(D));for(const D of E)D.updateNeeded(_,b)&&d.prepareTile(D,_,b)},"raster-particle":function(c,t,r){const d=t.getSource();if(!(d instanceof Xh&&d.loaded()))return;const _=c.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!_)return;const b=c.paint.get("raster-particle-array-band")||d.getInitialBand(_);if(b==null)return;const E=t.getIds().map(D=>t.getTileByID(D));for(const D of E)D.updateNeeded(_,b)&&d.prepareTile(D,_,b)}},Vl={fill:bt},Tf={fill:function(c,t,r,d){if(!r.layout||r.layout.get("fill-elevation-reference")==="none")return;const _=c.context.gl,b=new cs(_.LEQUAL,cs.ReadOnly,c.depthRangeFor3D),E=new hr({func:_.ALWAYS,mask:255},255,255,_.KEEP,_.KEEP,_.REPLACE),D=c.transform.getFreeCameraOptions().position,U=c.getOrCreateProgram("elevatedStructuresDepthReconstruct",{defines:["DEPTH_RECONSTRUCTION"]});for(const Z of d){const ie=t.getTile(Z),de=ie.getBucket(r);if(!de)continue;const ne=de.elevatedStructures;if(!ne||ne.maskSegments.segments[0].primitiveLength===0)continue;const me=mt(Z.toUnwrapped(),D),Ce=c.translatePosMatrix(Z.projMatrix,ie,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor")),Me=Lh(Ce,me,0,0,0);U.draw(c,_.TRIANGLES,b,E,Fr.disabled,Zs.disabled,Me,r.id,ne.vertexBuffer,ne.indexBuffer,ne.maskSegments,r.paint,c.transform.zoom)}}};class Sf{constructor(t,r,d,_,b,E){this.context=new bn(t,r),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=b,this._timeStamp=a.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const D=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const Z of D)this._debugParams.enabledLayers[Z]=!0;b.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),b.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),b.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),b.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const Z of D)b.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],Z);this.occlusionParams=new xa(b),this.setup(),this.numSublayers=Ll.maxUnderzooming+Ll.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new a.et,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Qd(this),this._wireframeDebugCache=new ny,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const U=new a.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new a.T(this.context,U,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=_,this.worldview=E}updateTerrain(t,r){const d=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ju(this,t));const _=this._terrain;this.transform.elevation=d?_:null,_.update(t,this.transform,r),this.transform.elevation&&!_.enabled&&(this.transform.elevation=null)}_updateFog(t){const r=t.fog;if(!r||this.transform.projection.name==="globe"||r.getOpacity(this.transform.pitch)<1||r.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[d,_]=r.getFovAdjustedRange(this.transform._fov);if(d>_)return void(this.transform.fogCullDistSq=null);const b=d+.78*(_-d);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Ju(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,r){if(this.width=t*a.q.devicePixelRatio,this.height=r*a.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style.order)this.style._mergedLayers[d].resize()}setup(){const t=this.context,r=new a.ba;r.emplaceBack(0,0),r.emplaceBack(a.aj,0),r.emplaceBack(0,a.aj),r.emplaceBack(a.aj,a.aj),this.tileExtentBuffer=t.createVertexBuffer(r,a.bc.members),this.tileExtentSegments=a.bd.simpleSegment(0,0,4,2);const d=new a.ba;d.emplaceBack(0,0),d.emplaceBack(a.aj,0),d.emplaceBack(0,a.aj),d.emplaceBack(a.aj,a.aj),this.debugBuffer=t.createVertexBuffer(d,a.bc.members),this.debugSegments=a.bd.simpleSegment(0,0,4,5);const _=new a.ba;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(_,a.bc.members),this.viewportSegments=a.bd.simpleSegment(0,0,4,2);const b=new a.aZ;b.emplaceBack(0,0,0,0),b.emplaceBack(a.aj,0,a.aj,0),b.emplaceBack(0,a.aj,0,a.aj),b.emplaceBack(a.aj,a.aj,a.aj,a.aj),this.mercatorBoundsBuffer=t.createVertexBuffer(b,a.bf.members),this.mercatorBoundsSegments=a.bd.simpleSegment(0,0,4,2);const E=new a.a_;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(E);const D=new a.bb;for(const Z of[0,1,3,2,0])D.emplaceBack(Z);this.debugIndexBuffer=t.createIndexBuffer(D),this.emptyTexture=new a.T(t,new a.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=a.bz();const U=this.context.gl;this.stencilClearMode=new hr({func:U.ALWAYS,mask:0},0,255,U.ZERO,U.ZERO,U.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,cs.disabled,this.stencilClearMode,Fr.disabled,Zs.disabled,Du(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,r,d){if(!r||this.currentStencilSource===r.id||!t.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let D=!1;for(const U of d)if(this._tileClippingMaskIDs[U.key]===void 0){D=!0;break}if(!D)return}this.currentStencilSource=r.id;const _=this.context,b=_.gl;this.nextStencilID+d.length>256&&this.clearStencil(),_.setColorMode(Fr.disabled),_.setDepthMode(cs.disabled);const E=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const D of d){const U=r.getTile(D),Z=this._tileClippingMaskIDs[D.key]=this.nextStencilID++,{tileBoundsBuffer:ie,tileBoundsIndexBuffer:de,tileBoundsSegments:ne}=this.getTileBoundsBuffers(U);E.draw(this,b.TRIANGLES,cs.disabled,new hr({func:b.ALWAYS,mask:0},Z,255,b.KEEP,b.KEEP,b.REPLACE),Fr.disabled,Zs.disabled,Du(D.projMatrix),"$clipping",ie,de,ne)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,r=this.context.gl;return new hr({func:r.NOTEQUAL,mask:255},t,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const r=this.context.gl;return new hr({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,r.KEEP,r.KEEP,r.REPLACE)}stencilConfigForOverlap(t){const r=this.context.gl,d=t.sort((E,D)=>D.overscaledZ-E.overscaledZ),_=d[d.length-1].overscaledZ,b=d[0].overscaledZ-_+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const E={};for(let D=0;D<b;D++)E[D+_]=new hr({func:r.GEQUAL,mask:255},D+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=b,[E,d]}return[{[_]:hr.disabled},d]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Fr([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new a.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Fr.unblended:Fr.alphaBlended}colorModeForDrapableLayerRenderPass(t){const r=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Fr([r.ONE,r.ONE_MINUS_SRC_ALPHA,r.CONSTANT_ALPHA,r.ONE_MINUS_SRC_ALPHA],new a.am(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,r,d,_=!1){if(this.depthOcclusion)return new cs(this.context.gl.GREATER,cs.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!_)return cs.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new cs(d||this.context.gl.LEQUAL,r,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,r=Math.ceil(this.width),d=Math.ceil(this.height),_=this.context.bindFramebuffer.get(),b=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===r&&this.depthFBO.height===d||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),r!==0&&d!==0&&(this.depthFBO=new _h(this.context,r,d,!1,"texture"),this.depthTexture=new a.T(this.context,{width:r,height:d,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(_),t.bindTexture(t.TEXTURE_2D,b),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,r,d,0,0,r,d,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,r)=>t+r/this._fpsHistory.length,0))}render(t,r){const d=a.q.now();this._dt=d-this._timeStamp,this._timeStamp=d,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=r;const _=this.style._mergedLayers,b=!(!this.terrain||!this.terrain.enabled),E=()=>this.style._getOrder(b).filter(Kt=>{const ui=_[Kt];return!(ui.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[ui.type]});let D=E(),U=!1,Z=!1;for(const Kt of D){const ui=_[Kt];ui.type==="circle"&&(U=!0),ui.type==="symbol"&&(ui.hasInitialOcclusionOpacityProperties?Z=!0:U=!0)}let ie=D.map(Kt=>_[Kt]);const de=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(a.q.now()),this.imageManager.beginFrame();let ne=0,me=!1;for(const Kt in de){const ui=de[Kt];ui.used&&(ui.prepare(this.context),ui.getSource().usedInConflation&&++ne)}let Ce=!1;for(const Kt of ie)Kt.isHidden(this.transform.zoom)||(Kt.type==="clip"&&(Ce=!0),this.prepareLayer(Kt));const Me={},Pe={},Ne={},He={},lt={};for(const Kt in de){const ui=de[Kt];Me[Kt]=ui.getVisibleCoordinates(),Pe[Kt]=Me[Kt].slice().reverse(),Ne[Kt]=ui.getVisibleCoordinates(!0).reverse(),He[Kt]=ui.getShadowCasterCoordinates(),lt[Kt]=ui.sortCoordinatesByDistance(Me[Kt])}const ut=Kt=>{const ui=this.style.getLayerSourceCache(Kt);return ui&&ui.used?ui.getSource():null};if(ne||Ce||this._clippingActiveLastFrame){const Kt=[],ui=[];let Ft=0;for(const Ai of ie)this.isSourceForClippingOrConflation(Ai,ut(Ai))&&(Kt.push(Ai),ui.push(Ft)),Ft++;if(Kt&&(Ce||Kt.length>1)||this._clippingActiveLastFrame){Ce=!1;const Ai=[];for(let ai=0;ai<Kt.length;ai++){const Di=Kt[ai],Yi=ui[ai],Mi=this.style.getLayerSourceCache(Di);if(!Mi||!Mi.used||!Mi.getSource().usedInConflation&&Di.type!=="clip")continue;let qi=a.eu,_s=a.bQ.None;const Ts=[];let us=!0;if(Di.type==="clip"){qi=Yi;for(const Os of Di.layout.get("clip-layer-types"))_s|=Os==="model"?a.bQ.Model:Os==="symbol"?a.bQ.Symbol:a.bQ.FillExtrusion;for(const Os of Di.layout.get("clip-layer-scope"))Ts.push(Os);Di.isHidden(this.transform.zoom)?us=!1:Ce=!0}us&&Ai.push({layer:Di.fqid,cache:Mi,order:qi,clipMask:_s,clipScope:Ts})}this.replacementSource.setSources(Ai),me=!0}}this._clippingActiveLastFrame=Ce,me||this.replacementSource.clear(),this.conflationActive=me,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Kt=0;Kt<ie.length;Kt++){const ui=ie[Kt],Ft=ui.cutoffRange();if(this.longestCutoffRange=Math.max(Ft,this.longestCutoffRange),Ft>0){const Ai=ut(ui);Ai&&(this.minCutoffZoom=Math.max(Ai.minzoom,this.minCutoffZoom)),ui.minzoom&&(this.minCutoffZoom=Math.max(ui.minzoom,this.minCutoffZoom))}ui.is3D(b)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Kt),this._lastOcclusionLayer=Kt)}const kt=this.style&&this.style.fog;kt?(this._fogVisible=kt.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=kt.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Ne),this.opaquePassCutoff=0,D=E(),ie=D.map(Kt=>_[Kt]));const wt=this._shadowRenderer;if(wt){wt.updateShadowParameters(this.transform,this.style.directionalLight);for(const Kt in de)for(const ui of Me[Kt]){let Ft={min:0,max:0};this.terrain&&(Ft=this.terrain.getMinMaxForTile(ui)||Ft),wt.addShadowReceiver(ui.toUnwrapped(),Ft.min,Ft.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.ev(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new wf(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const xt=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),pt=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(xt&&!this._snow&&(this._snow=new Vo(this)),!xt&&this._snow&&(this._snow.destroy(),delete this._snow),pt&&!this._rain&&(this._rain=new Rm(this)),!pt&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!Sh.has(this.context.gl))return;this.renderPass="offscreen";for(const Kt of ie){const ui=t.getLayerSourceCache(Kt);if(!Kt.hasOffscreenPass()||Kt.isHidden(this.transform.zoom))continue;const Ft=ui?Pe[ui.id]:void 0;(Kt.type==="custom"||Kt.type==="raster"||Kt.type==="raster-particle"||Kt.isSky()||Ft&&Ft.length)&&this.renderLayer(this,ui,Kt,Ft)}this.depthRangeFor3D=[0,1-(ie.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,He)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const At=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ct=(()=>{if(r.showOverdrawInspector)return a.am.black;const Kt=this.style.fog;if(Kt&&this.transform.projection.supportsFog){const ui=this.style.getLut(Kt.scope);if(!At){const Ft=Kt.properties.get("color-use-theme")==="none",Ai=Kt.properties.get("color").toNonPremultipliedRenderColor(Ft?null:ui).toArray01();return new a.am(...Ai)}if(At){const Ft=Kt.properties.get("space-color-use-theme")==="none",Ai=Kt.properties.get("space-color").toNonPremultipliedRenderColor(Ft?null:ui).toArray01();return new a.am(...Ai)}}return a.am.transparent})();if(this.context.clear({color:Ct,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&At&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=D.length-1;this.currentLayer>=0;this.currentLayer--){const Kt=ie[this.currentLayer],ui=t.getLayerSourceCache(Kt);if(Kt.isSky())continue;const Ft=ui?(Kt.is3D(b)?lt:Pe)[ui.id]:void 0;this._renderTileClippingMasks(Kt,ui,Ft),this.renderLayer(this,ui,Kt,Ft)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&At&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||a.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<D.length;this.currentLayer++){const Kt=ie[this.currentLayer],ui=t.getLayerSourceCache(Kt);Kt.isSky()&&this.renderLayer(this,ui,Kt,ui?Pe[ui.id]:void 0)}function ti(Kt,ui){let Ft;return ui&&(Ft=(Kt.type==="symbol"?Ne:Kt.is3D(b)?lt:Pe)[ui.id]),Ft}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<D.length;){const Kt=ie[this.currentLayer];if(Kt.type==="raster"||Kt.type==="raster-particle"){const ui=t.getLayerSourceCache(Kt);this.renderLayer(this,ui,Kt,ti(Kt,ui))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let si=0;wt&&(si=wt.getShadowCastingLayerCount());let wi=!1,_i=-1;for(let Kt=0;Kt<D.length;++Kt){const ui=ie[Kt];ui.isHidden(this.transform.zoom)||ui.is3D(b)&&(_i=Kt)}Z&&_i===-1&&(U=!0);let Bi=!1;for(;this.currentLayer<D.length;){const Kt=ie[this.currentLayer],ui=t.getLayerSourceCache(Kt);if(Kt.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Kt)){if(Kt.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Bi&&Kt.is3D(b)&&!b){const Ft=this.currentLayer,Ai=ai=>{for(this.currentLayer=0;this.currentLayer<ie.length;this.currentLayer++){const Di=ie[this.currentLayer];if(Vl[Di.type]){const Yi=this.style.getLayerSourceCache(Di);Vl[Di.type](this,Yi,Di,ti(Di,Yi),ai)}}};Ai("initialize"),Ai("reset"),this.currentLayer=Ft,Bi=!0}if(U&&!wi&&this.terrain&&!this.transform.isOrthographic&&(wi=!0,this.blitDepth()),Z&&_i!==-1&&this.currentLayer===_i+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Kt,ui,ui?Me[ui.id]:void 0),this.renderLayer(this,ui,Kt,ti(Kt,ui)),!this.terrain&&wt&&si>0&&Kt.hasShadowPass()&&--si==0){{this.clearStencil();const Ft=this.currentLayer;for(this.currentLayer=0;this.currentLayer<ie.length;this.currentLayer++){const Ai=ie[this.currentLayer];if(Tf[Ai.type]){const ai=this.style.getLayerSourceCache(Ai);Tf[Ai.type](this,ai,Ai,ti(Ai,ai))}}this.currentLayer=Ft}if(wt.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const Ft=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ft;this.currentLayer++){const Ai=ie[this.currentLayer];if(!Ai.hasLightBeamPass())continue;const ai=t.getLayerSourceCache(Ai);this.renderLayer(this,ai,Ai,ai?Pe[ai.id]:void 0)}this.currentLayer=Ft,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Ft=this.currentLayer;this.depthOcclusion=!0;for(const Ai of this.layersWithOcclusionOpacity){this.currentLayer=Ai;const ai=ie[this.currentLayer],Di=t.getLayerSourceCache(ai),Yi=Di?Pe[Di.id]:void 0;this.terrain||this._renderTileClippingMasks(ai,Di,Di?Me[Di.id]:void 0),this.renderLayer(this,Di,ai,Yi)}this.depthOcclusion=!1,this.currentLayer=Ft,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Kt=null;ie.forEach(ui=>{const Ft=t.getLayerSourceCache(ui);Ft&&!ui.isHidden(this.transform.zoom)&&Ft.getVisibleCoordinates().length&&(!Kt||Kt.getSource().maxzoom<Ft.getSource().maxzoom)&&(Kt=Ft)}),Kt&&this.options.showTileBoundaries&&Jo(this,Kt,Kt.getVisibleCoordinates(),a.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Jo(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new a.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Kt){const ui=Kt.transform.padding;eo(Kt,Kt.transform.height-(ui.top||0),3,Ns),eo(Kt,ui.bottom||0,3,rr),ya(Kt,ui.left||0,3,bs),ya(Kt,Kt.transform.width-(ui.right||0),3,Ks);const Ft=Kt.transform.centerPoint;(function(Ai,ai,Di,Yi){ta(Ai,ai-1,Di-10,2,20,Yi),ta(Ai,ai-10,Di-1,20,2,Yi)})(Kt,Ft.x,Kt.transform.height-Ft.y,or)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),me||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:r}=this.transform.projection,d=!r||!r.includes(t.type);if(Dd[t.type]&&(d||this.terrain&&t.type==="custom")){const _=this.style.getLayerSourceCache(t);Dd[t.type](t,_,this)}this.gpuTimingEnd()}renderLayer(t,r,d,_){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||d.type==="model"||d.type==="raster"||d.type==="raster-particle"||_&&_.length)&&(this.id=d.id,this.gpuTimingStart(d),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(d.type)&&(!t.terrain||d.type!=="custom")||d.type==="clip"||bo[d.type](t,r,d,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery,d=this.context.gl;let _=this.gpuTimers[t.id];_||(_=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:d.createQuery()}),_.calls++,d.beginQuery(r.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,r=this.context.gl,d=r.createQuery();this.deferredRenderGpuTimeQueries.push(d),r.beginQuery(t.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const r={};for(const d in t){const _=t[d],b=this.context.extTimerQuery,E=b.getQueryParameter(_.query,this.context.gl.QUERY_RESULT)/1e6;b.deleteQueryEXT(_.query),r[d]=E}return r}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const r=this.context.gl;let d=0;for(const _ of t)d+=r.getQueryParameter(_,r.QUERY_RESULT)/1e6,r.deleteQuery(_);return d}translatePosMatrix(t,r,d,_,b){if(!d[0]&&!d[1])return t;const E=b?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(E){const Z=Math.sin(E),ie=Math.cos(E);d=[d[0]*ie-d[1]*Z,d[0]*Z+d[1]*ie]}const D=[b?d[0]:a.aw(r,d[0],this.transform.zoom),b?d[1]:a.aw(r,d[1],this.transform.zoom),0],U=new Float32Array(16);return a.bo(U,t,D),U}saveTileTexture(t){const r=t.size[0],d=this._tileTextures[r];d?d.push(t):this._tileTextures[r]=[t]}getTileTexture(t){const r=this._tileTextures[t];return r&&r.length>0?r.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,r,d){const _=d===void 0?this.terrain&&this.terrain.renderingToTexture:d,b=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(b.push("LIGHTING_3D_MODE"),b.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):_||b.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||b.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(b.push("TERRAIN"),this.linearFloatFilteringSupported()&&b.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&b.push("GLOBE"),!this._fogVisible||_||r!==void 0&&!r||b.push("FOG","FOG_DITHERING"),_&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}getOrCreateProgram(t,r){this.cache=this.cache||{};const d=r&&r.defines||[],_=r&&r.config,b=this.currentGlobalDefines(t,r&&r.overrideFog,r&&r.overrideRtt).concat(d),E=im.cacheKey(bc[t],t,b,_);return this.cache[E]||(this.cache[E]=new im(this.context,t,bc[t],_,Wc[t],b)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,r){if(this.style.enable3dLights()){const d=this.style.directionalLight,_=this.style.ambientLight;if(d&&_){const b=((E,D,U)=>{const Z=E.properties.get("direction"),ie=E.properties.get("color-use-theme")==="none",de=E.properties.get("color").toNonPremultipliedRenderColor(ie?null:U.getLut(E.scope)).toArray01(),ne=E.properties.get("intensity"),me=D.properties.get("color-use-theme")==="none",Ce=D.properties.get("color").toNonPremultipliedRenderColor(me?null:U.getLut(D.scope)).toArray01(),Me=D.properties.get("intensity"),Pe=[Z.x,Z.y,Z.z],Ne=a.dw(Ce,Me),He=a.dw(de,ne);return{u_lighting_ambient_color:Ne,u_lighting_directional_dir:Pe,u_lighting_directional_color:He,u_ground_radiance:Hp(Pe,He,Ne)}})(d,_,this.style);r.setLightsUniformValues(t,b)}}}uploadCommonUniforms(t,r,d,_,b){if(this.uploadCommonLightUniforms(t,r),this.terrain&&this.terrain.renderingToTexture)return;const E=this.style.fog;if(E){const D=E.getOpacity(this.transform.pitch),U=((Z,ie,de,ne,me,Ce,Me,Pe,Ne,He,lt,ut)=>{const kt=Z.transform,wt=ie.properties.get("color-use-theme")==="none",xt=ie.properties.get("color").toNonPremultipliedRenderColor(wt?null:Z.style.getLut(ie.scope)).toArray01();xt[3]=ne;const pt=Z.frameCounter/1e3%1,[At,Ct]=ie.properties.get("vertical-range");return{u_fog_matrix:de?kt.calculateFogTileMatrix(de):ut||Z.identityMat,u_fog_range:ie.getFovAdjustedRange(kt._fov),u_fog_color:xt,u_fog_horizon_blend:ie.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(At,Ct),Ct],u_fog_temporal_offset:pt,u_frustum_tl:me,u_frustum_tr:Ce,u_frustum_br:Me,u_frustum_bl:Pe,u_globe_pos:Ne,u_globe_radius:He,u_viewport:lt,u_globe_transition:a.ah(kt.zoom),u_is_globe:+(kt.projection.name==="globe")}})(this,E,d,D,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.q.devicePixelRatio,this.transform.height*a.q.devicePixelRatio],_);r.setFogUniformValues(t,U)}b&&r.setCutoffUniformValues(t,b.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),r}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,r=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(const _ of d)r[_.key]=t[_.key]||new Zh(_,512,this.transform.tileZoom,this,void 0,this.worldview);return r}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,r){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!r||r.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let r=this._cachedTileFogOpacities[t.key];return r||(this._cachedTileFogOpacities[t.key]=r=this.style.fog.getOpacityForTile(t)),r[0]>=li||r[1]>=li}setupDepthForOcclusion(t,r,d){const _=this.context,b=_.gl,E=!!d;var D;d||(d={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),_.activeTexture.set(b.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),d.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],d.u_depth_range_unpack=[2/((D=this.depthRangeFor3D)[1]-D[0]),-1-2*D[0]/(D[1]-D[0])],d.u_occluder_half_size=.5*this.occlusionParams.occluderSize,d.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),_.activeTexture.set(b.TEXTURE0),E||r.setTerrainUniformValues(_,d)}}function Sp(c,t){let r=!1,d=null;const _=()=>{d=null,r&&(c(),d=setTimeout(_,t),r=!1)};return()=>(r=!0,d||_(),d)}class Nu{constructor(t){this._hashName=t&&encodeURIComponent(t),a.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Sp(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const r=Mp(t);if(this._hashName){const d=this._hashName;let _=!1;const b=location.hash.slice(1).split("&").map(E=>{const D=E.split("=")[0];return D===d?(_=!0,`${D}=${r}`):E}).filter(E=>E);return _||b.push(`${d}=${r}`),`#${b.join("&")}`}return`#${r}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let r;return t.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(r=d)}),(r&&r[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const r=this._getCurrentHash();if(r.length>=3&&!r.some(d=>isNaN(Number(d)))){const d=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(r[3]||0):t.getBearing();return t.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:d,pitch:+(r[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Mp(c,t){const r=c.getCenter(),d=Math.round(100*c.getZoom())/100,_=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,_),E=Math.round(r.lng*b)/b,D=Math.round(r.lat*b)/b,U=c.getBearing(),Z=c.getPitch();let ie=t?`/${E}/${D}/${d}`:`${d}/${D}/${E}`;return(U||Z)&&(ie+="/"+Math.round(10*U)/10),Z&&(ie+=`/${Math.round(Z)}`),ie}const cu={linearity:.3,easing:a.ew(0,0,.3,1)},dd=a.h({deceleration:2500,maxSpeed:1400},cu),Xc=a.h({deceleration:20,maxSpeed:1400},cu),Kp=a.h({deceleration:1e3,maxSpeed:360},cu),Bm=a.h({deceleration:1e3,maxSpeed:90},cu);class ud{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=a.q.now();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const r={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)r.zoom+=b.zoomDelta||0,r.bearing+=b.bearingDelta||0,r.pitch+=b.pitchDelta||0,b.panDelta&&r.pan._add(b.panDelta),b.around&&(r.around=b.around),b.pinchAround&&(r.pinchAround=b.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(r.pan.mag()){const b=zd(r.pan.mag(),d,a.h({},dd,t||{}));_.offset=r.pan.mult(b.amount/r.pan.mag()),_.center=this._map.transform.center,Ap(_,b)}if(r.zoom){const b=zd(r.zoom,d,Xc);_.zoom=this._map.transform.zoom+b.amount,Ap(_,b)}if(r.bearing){const b=zd(r.bearing,d,Kp);_.bearing=this._map.transform.bearing+a.ay(b.amount,-179,179),Ap(_,b)}if(r.pitch){const b=zd(r.pitch,d,Bm);_.pitch=this._map.transform.pitch+b.amount,Ap(_,b)}if(_.zoom||_.bearing){const b=r.pinchAround===void 0?r.around:r.pinchAround;_.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function Ap(c,t){(!c.duration||c.duration<t.duration)&&(c.duration=t.duration,c.easing=t.easing)}function zd(c,t,r){const{maxSpeed:d,linearity:_,deceleration:b}=r,E=a.ay(c*_/(t/1e3),-d,d),D=Math.abs(E)/(b*_);return{easing:r.easing,duration:1e3*D,amount:E*(D/2)}}class wn extends a.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,d,_={}){const b=Pi(r.getCanvasContainer(),d),E=r.unproject(b);super(t,a.h({point:b,lngLat:E,originalEvent:d},_)),this._defaultPrevented=!1,this.target=r}}class Mf extends a.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,d){const _=t==="touchend"?d.changedTouches:d.touches,b=fo(r.getCanvasContainer(),_),E=b.map(U=>r.unproject(U)),D=b.reduce((U,Z,ie,de)=>U.add(Z.div(de.length)),new a.P(0,0));super(t,{points:b,point:D,lngLats:E,lngLat:r.unproject(D),originalEvent:d}),this._defaultPrevented=!1}}class wc extends a.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r){super("wheel",{originalEvent:r}),this._defaultPrevented=!1}}class Tc{constructor(t,r){this._map=t,this._clickTolerance=r.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new wc(this._map,t))}mousedown(t,r){return this._mousedownPos=r,this._firePreventable(new wn(t.type,this._map,t))}mouseup(t){this._map.fire(new wn(t.type,this._map,t))}preclick(t){const r=a.h({},t);r.type="preclick",this._map.fire(new wn(r.type,this._map,r))}click(t,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||(this.preclick(t),this._map.fire(new wn(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new wn(t.type,this._map,t))}mouseover(t){this._map.fire(new wn(t.type,this._map,t))}mouseout(t){this._map.fire(new wn(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Mf(t.type,this._map,t))}touchmove(t){this._map.fire(new Mf(t.type,this._map,t))}touchend(t){this._map.fire(new Mf(t.type,this._map,t))}touchcancel(t){this._map.fire(new Mf(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class dg{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new wn(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new wn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new wn(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class lm{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,r){this.isEnabled()&&t.shiftKey&&t.button===0&&(ir(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(t,r){if(!this._active)return;const d=r,_=this._startPos,b=this._lastPos;if(!_||!b||b.equals(d)||!this._box&&d.dist(_)<this._clickTolerance)return;this._lastPos=d,this._box||(this._box=hs("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const E=Math.min(_.x,d.x),D=Math.max(_.x,d.x),U=Math.min(_.y,d.y),Z=Math.max(_.y,d.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${E}px,${U}px)`,this._box.style.width=D-E+"px",this._box.style.height=Z-U+"px")})}mouseupWindow(t,r){if(!this._active)return;const d=this._startPos,_=r;if(d&&t.button===0){if(this.reset(),rn(),d.x!==_.x||d.y!==_.y)return this._map.fire(new a.A("boxzoomend",{originalEvent:t})),{cameraAnimation:b=>b.fitScreenCoordinates(d,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),fr(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new a.A(t,{originalEvent:r}))}}function du(c,t){const r={};for(let d=0;d<c.length;d++)r[c[d].identifier]=t[d];return r}class ml{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,r,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),d.length===this.numTouches&&(this.centroid=function(_){const b=new a.P(0,0);for(const E of _)b._add(E);return b.div(_.length)}(r),this.touches=du(d,r)))}touchmove(t,r,d){if(this.aborted||!this.centroid)return;const _=du(d,r);for(const b in this.touches){const E=_[b];(!E||E.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(t,r,d){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Jp{constructor(t){this.singleTap=new ml(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,r,d){this.singleTap.touchstart(t,r,d)}touchmove(t,r,d){this.singleTap.touchmove(t,r,d)}touchend(t,r,d){const _=this.singleTap.touchend(t,r,d);if(_){const b=t.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(_)<30;if(b&&E||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class hm{constructor(){this._zoomIn=new Jp({numTouches:1,numTaps:2}),this._zoomOut=new Jp({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,r,d){this._zoomIn.touchstart(t,r,d),this._zoomOut.touchstart(t,r,d)}touchmove(t,r,d){this._zoomIn.touchmove(t,r,d),this._zoomOut.touchmove(t,r,d)}touchend(t,r,d){const _=this._zoomIn.touchend(t,r,d),b=this._zoomOut.touchend(t,r,d);return _?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(_)},{originalEvent:t})}):b?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(b)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Qp={0:1,2:2},sp={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class rp{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,r){return!1}_move(t,r){return{}}mousedown(t,r){if(this._lastPoint)return;const d=pl(t);this._correctButton(t,d)&&(this._lastPoint=r,this._eventButton=d)}mousemoveWindow(t,r){const d=this._lastPoint;if(d){if(t.preventDefault(),this._eventButton!=null&&function(_,b){const E=Qp[b];return _.buttons===void 0||(_.buttons&E)!==E}(t,this._eventButton))this.reset();else if(this._moved||!(r.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=r,this._move(d,r)}}mouseupWindow(t){this._lastPoint&&pl(t)===this._eventButton&&(this._moved&&rn(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uu extends rp{mousedown(t,r){super.mousedown(t,r),this._lastPoint&&(this._active=!0)}_correctButton(t,r){return r===0&&!t.ctrlKey}_move(t,r){return{around:r,panDelta:r.sub(t)}}}class op extends rp{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?sp[t.pitchRotateKey]:void 0}_correctButton(t,r){return this._pitchRotateKey?r===0&&t[this._pitchRotateKey]:r===0&&t.ctrlKey||r===2}_move(t,r){const d=.8*(r.x-t.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class bh extends rp{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?sp[t.pitchRotateKey]:void 0}_correctButton(t,r){return this._pitchRotateKey?r===0&&t[this._pitchRotateKey]:r===0&&t.ctrlKey||r===2}_move(t,r){const d=-.5*(r.y-t.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Sc{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=r.clickTolerance||1,this.reset(),a.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}touchstart(t,r,d){return this._calculateTransform(t,r,d)}touchmove(t,r,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1&&!a.ex())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,r,d)}}touchend(t,r,d){this._calculateTransform(t,r,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,d){d.length>0&&(this._active=!0);const _=du(d,r),b=new a.P(0,0),E=new a.P(0,0);let D=0;for(const Z in _){const ie=_[Z],de=this._touches[Z];de&&(b._add(ie),E._add(ie.sub(de)),D++,_[Z]=ie)}if(this._touches=_,D<this._minTouches||!E.mag())return;const U=E.div(D);return this._sum._add(U),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(D),panDelta:U}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=hs("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Vu{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,r,d){return{}}touchstart(t,r,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([r[0],r[1]]))}touchmove(t,r,d){const _=this._firstTwoTouches;if(!_)return;t.preventDefault();const[b,E]=_,D=kp(d,r,b),U=kp(d,r,E);if(!D||!U)return;const Z=this._aroundCenter?null:D.add(U).div(2);return this._move([D,U],Z,t)}touchend(t,r,d){if(!this._firstTwoTouches)return;const[_,b]=this._firstTwoTouches,E=kp(d,r,_),D=kp(d,r,b);E&&D||(this._active&&rn(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function kp(c,t,r){for(let d=0;d<c.length;d++)if(c[d].identifier===r)return t[d]}function Af(c,t){return Math.log(c/t)/Math.LN2}class kf extends Vu{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,r){const d=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Af(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Af(this._distance,d),pinchAround:r}}}function Yc(c,t){return 180*c.angleWith(t)/Math.PI}class Mc extends Vu{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,r){const d=this._vector;if(this._vector=t[0].sub(t[1]),d&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Yc(this._vector,d),pinchAround:r}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const r=25/(Math.PI*this._minDiameter)*360,d=this._startVector;if(!d)return!1;const _=Yc(t,d);return Math.abs(_)<r}}function Xo(c){return Math.abs(c.y)>Math.abs(c.x)}class Fm extends Vu{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Xo(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,r,d){const _=this._lastPoints;if(!_)return;const b=t[0].sub(_[0]),E=t[1].sub(_[1]);return this._map._cooperativeGestures&&!a.ex()&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(b,E,d.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(b.y+E.y)/2*-.5})}gestureBeginsVertically(t,r,d){if(this._valid!==void 0)return this._valid;const _=t.mag()>=2,b=r.mag()>=2;if(!_&&!b)return;if(!_||!b)return this._firstMove==null&&(this._firstMove=d),d-this._firstMove<100&&void 0;const E=t.y>0==r.y>0;return Xo(t)&&Xo(r)&&E}}const pd={panStep:100,bearingStep:15,pitchStep:10};class Ep{constructor(){const t=pd;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let r=0,d=0,_=0,b=0,E=0;switch(t.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:t.shiftKey?d=-1:(t.preventDefault(),b=-1);break;case 39:t.shiftKey?d=1:(t.preventDefault(),b=1);break;case 38:t.shiftKey?_=1:(t.preventDefault(),E=-1);break;case 40:t.shiftKey?_=-1:(t.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(d=0,_=0),{cameraAnimation:D=>{const U=D.getZoom();D.easeTo({duration:300,easeId:"keyboardHandler",easing:np,zoom:r?Math.round(U)+r*(t.shiftKey?2:1):U,bearing:D.getBearing()+d*this._bearingStep,pitch:D.getPitch()+_*this._pitchStep,offset:[-b*this._panStep,-E*this._panStep],center:D.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function np(c){return c*(2-c)}const ap=4.000244140625,Ef=1/450;class Uo{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._handler=r,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Ef,a.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||a.ex()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let r=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const d=a.q.now(),_=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,r!==0&&r%ap==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=r,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(_*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=Pi(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:r,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const r=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const Z=this._type==="wheel"&&Math.abs(this._delta)>ap?this._wheelZoomRate:this._defaultZoomRate;let ie=2/(1+Math.exp(-Math.abs(this._delta*Z)));this._delta<0&&ie!==0&&(ie=1/ie);const de=r(),ne=Math.pow(2,de),me=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):ne;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(me*ie))),this._type==="wheel"&&(this._startZoom=de,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:r(),_=this._startZoom,b=this._easing;let E,D=!1;if(this._type==="wheel"&&_&&b){const Z=Math.min((a.q.now()-this._lastWheelEventTime)/200,1),ie=b(Z);E=a.ai(_,d,ie),Z<1?this._frameId||(this._frameId=!0):D=!0}else E=d,D=!0;this._active=!0,D&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let U=E-r();return U*this._lastDelta<0&&(U=0),{noInertia:!0,needsRenderFrame:!D,zoomDelta:U,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=a.ey;if(this._prevEase){const d=this._prevEase,_=(a.q.now()-d.start)/d.duration,b=d.easing(_+.01)-d.easing(_),E=.27/Math.sqrt(b*b+1e-4)*.01,D=Math.sqrt(.0729-E*E);r=a.ew(E,D,.25,1)}return this._prevEase={start:a.q.now(),duration:t,easing:r},r}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=hs("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Uu{constructor(t,r){this._clickZoom=t,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class $l{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,r){return t.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(t.shiftKey?-1:1),around:d.unproject(r)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fn{constructor(){this._tap=new Jp({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,r,d){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=r[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(t,r,d))}touchmove(t,r,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const _=r[0],b=_.y-this._swipePoint.y;return this._swipePoint=_,t.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(t,r,d)}touchend(t,r,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(t,r,d)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ef{constructor(t,r,d){this._el=t,this._mousePan=r,this._touchPan=d}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ug{constructor(t,r,d){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=r,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Cf{constructor(t,r,d,_){this._el=t,this._touchZoom=r,this._touchRotate=d,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const zh=c=>c.zoom||c.drag||c.pitch||c.rotate;class sa extends a.A{}class Ha{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,r){const d=a.at([],r,t);this.radius=a.ae(d[2]<0?a.eA([],d,this.constants):[d[0],d[1],0])}projectRay(t){a.eA(t,t,this.constants),a.au(t,t),a.eB(t,t,this.constants);const r=a.bY([],t,this.radius);if(r[2]>0){const d=a.bY([],[0,0,1],a.bG(r,[0,0,1])),_=a.bY([],a.au([],[r[0],r[1],0]),this.radius),b=a.cV([],r,a.bY([],a.at([],a.cV([],_,d),r),2));r[0]=b[0],r[1]=b[1]}return r}}function Rd(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class cm{constructor(t,r){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ud(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ha,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(r),a.aV(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,b,E]of this._listeners){const D=_===document?this.handleWindowEvent:this.handleEvent;_.addEventListener(b,D,E)}}destroy(){for(const[t,r,d]of this._listeners){const _=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(r,_,d)}}_addDefaultHandlers(t){const r=this._map,d=r.getCanvasContainer();this._add("mapEvent",new Tc(r,t));const _=r.boxZoom=new lm(r,t);this._add("boxZoom",_);const b=new hm,E=new $l;r.doubleClickZoom=new Uu(E,b),this._add("tapZoom",b),this._add("clickZoom",E);const D=new Fn;this._add("tapDragZoom",D);const U=r.touchPitch=new Fm(r);this._add("touchPitch",U);const Z=new op(t),ie=new bh(t);r.dragRotate=new ug(t,Z,ie),this._add("mouseRotate",Z,["mousePitch"]),this._add("mousePitch",ie,["mouseRotate"]);const de=new uu(t),ne=new Sc(r,t);r.dragPan=new ef(d,de,ne),this._add("mousePan",de),this._add("touchPan",ne,["touchZoom","touchRotate"]);const me=new Mc,Ce=new kf;r.touchZoomRotate=new Cf(d,Ce,me,D),this._add("touchRotate",me,["touchPan","touchZoom"]),this._add("touchZoom",Ce,["touchPan","touchRotate"]),this._add("blockableMapEvent",new dg(r));const Me=r.scrollZoom=new Uo(r,this);this._add("scrollZoom",Me,["mousePan"]);const Pe=r.keyboard=new Ep;this._add("keyboard",Pe);for(const Ne of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[Ne]&&r[Ne].enable(t[Ne])}_add(t,r,d){this._handlers.push({handlerName:t,handler:r,allowed:d}),this._handlersById[t]=r}stop(t){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!zh(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,r,d){for(const _ in t)if(_!==d&&(!r||r.indexOf(_)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const r=[];for(const d of t)this._el.contains(d.target)&&r.push(d);return r}handleEvent(t,r){this._updatingCamera=!0;const d=t.type==="renderFrame",_=d?void 0:t,b={needsRenderFrame:!1},E={},D={},U=t.touches?this._getMapTouches(t.touches):void 0,Z=U?fo(this._el,U):d?void 0:Pi(this._el,t);for(const{handlerName:ne,handler:me,allowed:Ce}of this._handlers){if(!me.isEnabled())continue;let Me;this._blockedByActive(D,Ce,ne)?me.reset():me[r||t.type]&&(Me=me[r||t.type](t,Z,U),this.mergeHandlerResult(b,E,Me,ne,_),Me&&Me.needsRenderFrame&&this._triggerRenderFrame()),(Me||me.isActive())&&(D[ne]=me)}const ie={};for(const ne in this._previousActiveHandlers)D[ne]||(ie[ne]=_);this._previousActiveHandlers=D,(Object.keys(ie).length||Rd(b))&&(this._changes.push([b,E,ie]),this._triggerRenderFrame()),(Object.keys(D).length||Rd(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:de}=b;de&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],de(this._map))}mergeHandlerResult(t,r,d,_,b){if(!d)return;a.h(t,d);const E={handlerName:_,originalEvent:d.originalEvent||b};d.zoomDelta!==void 0&&(r.zoom=E),d.panDelta!==void 0&&(r.drag=E),d.pitchDelta!==void 0&&(r.pitch=E),d.bearingDelta!==void 0&&(r.rotate=E)}_applyChanges(){const t={},r={},d={};for(const[_,b,E]of this._changes)_.panDelta&&(t.panDelta=(t.panDelta||new a.P(0,0))._add(_.panDelta)),_.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(t.around=_.around),_.aroundCoord!==void 0&&(t.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(t.pinchAround=_.pinchAround),_.noInertia&&(t.noInertia=_.noInertia),a.h(r,b),a.h(d,E);this._updateMapTransform(t,r,d),this._changes=[]}_updateMapTransform(t,r,d){const _=this._map,b=_.transform,E=He=>[He.x,He.y,He.z];if((He=>{const lt=this._eventsInProgress.drag;return lt&&!this._handlersById[lt.handlerName].isActive()})()&&!Rd(t)){const He=b.zoom;b.cameraElevationReference="sea",this._originalZoom!=null&&b._orthographicProjectionAtLowPitch&&b.projection.name!=="globe"&&b.pitch===0?(b.cameraElevationReference="ground",b.zoom=this._originalZoom):(b.recenterOnTerrain(),b.cameraElevationReference="ground"),He!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&_._stop(!0),!Rd(t))return void this._fireEvents(r,d,!0);let{panDelta:D,zoomDelta:U,bearingDelta:Z,pitchDelta:ie,around:de,aroundCoord:ne,pinchAround:me}=t;b._isCameraConstrained&&(U>0&&(U=0),b._isCameraConstrained=!1),me!==void 0&&(de=me),(U||(He=>r[He]&&!this._eventsInProgress[He])("drag"))&&de&&(this._dragOrigin=E(b.pointCoordinate3D(de)),this._originalZoom=b.zoom,this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",_._stop(!0),de=de||_.transform.centerPoint,Z&&(b.bearing+=Z),ie&&(b.pitch+=ie),b._updateCameraState();const Ce=[0,0,0];if(D)if(b.projection.name==="mercator"){const He=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(de).dir),lt=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(de.sub(D)).dir);Ce[0]=lt[0]-He[0],Ce[1]=lt[1]-He[1]}else{const He=b.pointCoordinate(de);if(b.projection.name==="globe"){D=D.rotate(-b.angle);const lt=b._pixelsPerMercatorPixel/b.worldSize;Ce[0]=-D.x*a.ez(a.aY(He.y))*lt,Ce[1]=-D.y*a.ez(b.center.lat)*lt}else{const lt=b.pointCoordinate(de.sub(D));He&&lt&&(Ce[0]=lt.x-He.x,Ce[1]=lt.y-He.y)}}const Me=b.zoom,Pe=[0,0,0];if(U){const He=E(ne||b.pointCoordinate3D(de)),lt={dir:a.au([],a.at([],He,b._camera.position))};if(lt.dir[2]<0){const ut=b.zoomDeltaToMovement(He,U);a.bY(Pe,lt.dir,ut)}}const Ne=a.cV(Ce,Ce,Pe);b._translateCameraConstrained(Ne),U&&Math.abs(b.zoom-Me)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,d,!0)}_fireEvents(t,r,d){const _=zh(this._eventsInProgress),b=zh(t),E={};for(const ie in t){const{originalEvent:de}=t[ie];this._eventsInProgress[ie]||(E[`${ie}start`]=de),this._eventsInProgress[ie]=t[ie]}!_&&b&&this._fireEvent("movestart",b.originalEvent);for(const ie in E)this._fireEvent(ie,E[ie]);b&&this._fireEvent("move",b.originalEvent);for(const ie in t){const{originalEvent:de}=t[ie];this._fireEvent(ie,de)}const D={};let U;for(const ie in this._eventsInProgress){const{handlerName:de,originalEvent:ne}=this._eventsInProgress[ie];this._handlersById[de].isActive()||(delete this._eventsInProgress[ie],U=r[de]||ne,D[`${ie}end`]=U)}for(const ie in D)this._fireEvent(ie,D[ie]);const Z=zh(this._eventsInProgress);if(d&&(_||b)&&!Z){this._updatingCamera=!0;const ie=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),de=ne=>ne!==0&&-this._bearingSnap<ne&&ne<this._bearingSnap;ie?(de(ie.bearing||this._map.getBearing())&&(ie.bearing=0),this._map.easeTo(ie,{originalEvent:U})):(this._map.fire(new a.A("moveend",{originalEvent:U})),de(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new a.A(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new sa("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const dl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ju extends a.E{constructor(t,r){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=r.bearingSnap,this._respectPrefersReducedMotion=r.respectPrefersReducedMotion!==!1,a.aV(["_renderFrameCallback"],this)}getCenter(){return new a.cd(this.transform.center.lng,this.transform.center.lat)}setCenter(t,r){return this.jumpTo({center:t},r)}panBy(t,r,d){return t=a.P.convert(t).mult(-1),this.panTo(this.transform.center,a.h({offset:t},r),d)}panTo(t,r,d){return this.easeTo(a.h({center:t},r),d)}getZoom(){return this.transform.zoom}setZoom(t,r){return this.jumpTo({zoom:t},r),this}zoomTo(t,r,d){return this.easeTo(a.h({zoom:t},r),d)}zoomIn(t,r){return this.zoomTo(this.getZoom()+1,t,r),this}zoomOut(t,r){return this.zoomTo(this.getZoom()-1,t,r),this}getBearing(){return this.transform.bearing}setBearing(t,r){return this.jumpTo({bearing:t},r),this}getPadding(){return this.transform.padding}setPadding(t,r){return this.jumpTo({padding:t},r),this}rotateTo(t,r,d){return this.easeTo(a.h({bearing:t},r),d)}resetNorth(t,r){return this.rotateTo(0,a.h({duration:1e3},t),r),this}resetNorthPitch(t,r){return this.easeTo(a.h({bearing:0,pitch:0,duration:1e3},t),r),this}snapToNorth(t,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,r):this}getPitch(){return this.transform.pitch}setPitch(t,r){return this.jumpTo({pitch:t},r),this}cameraForBounds(t,r){t=a.aG.convert(t);const d=r&&r.bearing||0,_=r&&r.pitch||0,b=t.getNorthWest(),E=t.getSouthEast();return this._cameraForBounds(this.transform,b,E,d,_,r)}_extendPadding(t){const r={top:0,right:0,bottom:0,left:0};return t==null?a.h({},r,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:a.h({},r,t)}_extendCameraOptions(t){return(t=a.h({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,r){const d=r.max[0]-r.min[0],_=r.max[1]-r.min[1];return d/_>t.aspect?d/(2*Math.tan(.5*t.fovX)*t.aspect):_/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,r,d,_,b,E){const D=t.clone(),U=this._extendCameraOptions(E);D.bearing=_,D.pitch=b;const Z=a.cd.convert(r),ie=a.cd.convert(d),de=.5*(Z.lat+ie.lat),ne=.5*(Z.lng+ie.lng),me=a.eC(de,ne),Ce=a.au([],me),Me=a.au([],a.bF([],Ce,[0,1,0])),Pe=a.bF([],Me,Ce),Ne=[Me[0],Me[1],Me[2],0,Pe[0],Pe[1],Pe[2],0,Ce[0],Ce[1],Ce[2],0,0,0,0,1],He=[me,a.eC(Z.lat,Z.lng),a.eC(ie.lat,Z.lng),a.eC(ie.lat,ie.lng),a.eC(Z.lat,ie.lng),a.eC(de,Z.lng),a.eC(de,ie.lng),a.eC(Z.lat,ne),a.eC(ie.lat,ne)];let lt=a.cW.fromPoints(He.map(ai=>[a.bG(Me,ai),a.bG(Pe,ai),a.bG(Ce,ai)]));const ut=a.ad([],lt.center,Ne);a.eD(ut)===0&&a.eE(ut,0,0,1),a.au(ut,ut),a.bY(ut,ut,a.aB),D.center=a.eF(ut);const kt=D.getWorldToCameraMatrix(),wt=a.bi(new Float64Array(16),kt);lt=a.cW.applyTransform(lt,a.az([],kt,Ne));const xt=this._extendAABB(lt,D,U,_);if(!xt)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");lt=xt,a.ad(ut,ut,kt);const pt=.5*(lt.max[2]-lt.min[2]),At=this._minimumAABBFrustumDistance(D,lt),Ct=a.bY([],[0,0,1],pt),ti=a.cV(Ct,ut,Ct),si=At+(D.pitch===0?0:a.bD(ut,ti)),wi=D.globeCenterInViewSpace,_i=a.at([],ut,[wi[0],wi[1],wi[2]]);a.au(_i,_i),a.bY(_i,_i,si);const Bi=a.cV([],ut,_i);a.ad(Bi,Bi,wt);const Kt=a.eq/a.aB,ui=a.ae(Bi),Ft=a.c6(Math.max(ui*Kt-a.eq,Number.EPSILON),0),Ai=Math.min(D.zoomFromMercatorZAdjusted(Ft),U.maxZoom);return Ai>.5*(a.cL+a.cx)?(D.setProjection({name:"mercator"}),D.zoom=Ai,this._cameraForBounds(D,r,d,_,b,E)):{center:D.center,zoom:Ai,bearing:_,pitch:b}}_extendAABB(t,r,d,_){const b=.5*((d.padding.left||0)+(d.padding.right||0)),E=.5*((d.padding.top||0)+(d.padding.bottom||0)),D=E,U=b,Z=b,ie=E,de=r.width-(U+Z),ne=r.height-(D+ie),me=a.at([],t.max,t.min),Ce=Math.min(de/me[0],ne/me[1]),Me=Math.min(r.scaleZoom(r.scale*Ce),d.maxZoom);if(isNaN(Me))return null;const Pe=r.scale/r.zoomScale(Me),Ne=new a.cW([t.min[0]-U*Pe,t.min[1]-ie*Pe,t.min[2]],[t.max[0]+Z*Pe,t.max[1]+D*Pe,t.max[2]]),He=(typeof d.offset.x=="number"&&typeof d.offset.y=="number"?new a.P(d.offset.x,d.offset.y):a.P.convert(d.offset)).rotate(-a.al(_));return Ne.center[0]-=He.x*Pe,Ne.center[1]+=He.y*Pe,Ne}queryTerrainElevation(t,r){const d=this.transform.elevation;return d?(r=a.h({},{exaggerated:!0},r),d.getAtPoint(a.ac.fromLngLat(t),null,r.exaggerated)):null}_cameraForBounds(t,r,d,_,b,E){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,r,d,_,b,E);const D=t.clone(),U=this._extendCameraOptions(E);D.bearing=_,D.pitch=b;const Z=a.cd.convert(r),ie=a.cd.convert(d),de=new a.cd(Z.lng,ie.lat),ne=new a.cd(ie.lng,Z.lat),me=D.project(Z),Ce=D.project(ie),Me=this.queryTerrainElevation(Z),Pe=this.queryTerrainElevation(ie),Ne=this.queryTerrainElevation(de),He=this.queryTerrainElevation(ne),lt=[[me.x,me.y,Math.min(Me||0,Pe||0,Ne||0,He||0)],[Ce.x,Ce.y,Math.max(Me||0,Pe||0,Ne||0,He||0)]];let ut=a.cW.fromPoints(lt);const kt=D.getWorldToCameraMatrix(),wt=a.bi(new Float64Array(16),kt);ut=a.cW.applyTransform(ut,kt);const xt=this._extendAABB(ut,D,U,_);if(!xt)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ut=xt;const pt=.5*a.at([],ut.max,ut.min)[2],At=this._minimumAABBFrustumDistance(D,ut),Ct=[0,0,1,0];a.aA(Ct,Ct,kt),a.eG(Ct,Ct);const ti=a.bY([],Ct,At+pt),si=a.cV([],ut.center,ti);a.ad(ut.center,ut.center,wt),a.ad(si,si,wt);const wi=D.unproject(new a.P(ut.center[0],ut.center[1])),_i=a.eH(D.projection,wi),Bi=Math.pow(2,_i),Kt=Math.min(D._zoomFromMercatorZ(si[2]*D.pixelsPerMeter*Bi/D.worldSize),U.maxZoom);return D.mercatorFromTransition&&Kt<.5*(a.cL+a.cx)?(D.setProjection({name:"globe"}),D.zoom=Kt,this._cameraForBounds(D,r,d,_,b,E)):{center:wi,zoom:Kt,bearing:_,pitch:b}}fitBounds(t,r,d){const _=this.cameraForBounds(t,r);return this._fitInternal(_,r,d)}fitScreenCoordinates(t,r,d,_,b){const E=a.P.convert(t),D=a.P.convert(r),U=new a.P(Math.min(E.x,D.x),Math.min(E.y,D.y)),Z=new a.P(Math.max(E.x,D.x),Math.max(E.y,D.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(E,D))return this;const ie=this.transform.pointLocation3D(U),de=this.transform.pointLocation3D(Z),ne=this.transform.pointLocation3D(new a.P(U.x,Z.y)),me=this.transform.pointLocation3D(new a.P(Z.x,U.y)),Ce=[Math.min(ie.lng,de.lng,ne.lng,me.lng),Math.min(ie.lat,de.lat,ne.lat,me.lat)],Me=[Math.max(ie.lng,de.lng,ne.lng,me.lng),Math.max(ie.lat,de.lat,ne.lat,me.lat)],Pe=_&&_.pitch?_.pitch:this.getPitch(),Ne=this._cameraForBounds(this.transform,Ce,Me,d,Pe,_);return this._fitInternal(Ne,_,b)}_fitInternal(t,r,d){return t?(r=a.h(t,r)).linear?this.easeTo(r,d):this.flyTo(r,d):this}jumpTo(t,r){this.stop();const d=t.preloadOnly?this.transform.clone():this.transform;let _=!1,b=!1,E=!1;"zoom"in t&&d.zoom!==+t.zoom&&(_=!0,d.zoom=+t.zoom),t.center!==void 0&&(d.center=a.cd.convert(t.center)),"bearing"in t&&d.bearing!==+t.bearing&&(b=!0,d.bearing=+t.bearing),"pitch"in t&&d.pitch!==+t.pitch&&(E=!0,d.pitch=+t.pitch);const D=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!d.isPaddingEqual(D))if(t.retainPadding===!1){const U=d.clone();U.padding=D,d.setLocationAtPoint(d.center,U.centerPoint)}else d.padding=D;return t.preloadOnly?(this._preloadTiles(d),this):(this.fire(new a.A("movestart",r)).fire(new a.A("move",r)),_&&this.fire(new a.A("zoomstart",r)).fire(new a.A("zoom",r)).fire(new a.A("zoomend",r)),b&&this.fire(new a.A("rotatestart",r)).fire(new a.A("rotate",r)).fire(new a.A("rotateend",r)),E&&this.fire(new a.A("pitchstart",r)).fire(new a.A("pitch",r)).fire(new a.A("pitchend",r)),this.fire(new a.A("moveend",r)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.w(dl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,r){const d=this.transform;if(!d.projection.supportsFreeCamera)return a.w(dl),this;this.stop();const _=d.zoom,b=d.pitch,E=d.bearing;d.setFreeCameraOptions(t);const D=_!==d.zoom,U=b!==d.pitch,Z=E!==d.bearing;return this.fire(new a.A("movestart",r)).fire(new a.A("move",r)),D&&this.fire(new a.A("zoomstart",r)).fire(new a.A("zoom",r)).fire(new a.A("zoomend",r)),Z&&this.fire(new a.A("rotatestart",r)).fire(new a.A("rotate",r)).fire(new a.A("rotateend",r)),U&&this.fire(new a.A("pitchstart",r)).fire(new a.A("pitch",r)).fire(new a.A("pitchend",r)),this.fire(new a.A("moveend",r)),this}easeTo(t,r){this._stop(!1,t.easeId),((t=a.h({offset:[0,0],duration:500,easing:a.ey},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const d=this.transform,_=this.getZoom(),b=this.getBearing(),E=this.getPitch(),D=this.getPadding(),U="zoom"in t?+t.zoom:_,Z="bearing"in t?this._normalizeBearing(t.bearing,b):b,ie="pitch"in t?+t.pitch:E,de=this._extendPadding(t.padding),ne=a.P.convert(t.offset);let me,Ce,Me;if(d.projection.name==="globe"){const Ct=a.ac.fromLngLat(d.center),ti=ne.rotate(-d.angle);Ct.x+=ti.x/d.worldSize,Ct.y+=ti.y/d.worldSize;const si=Ct.toLngLat(),wi=a.cd.convert(t.center||si);this._normalizeCenter(wi),me=d.centerPoint.add(ti),Ce=new a.P(Ct.x,Ct.y).mult(d.worldSize),Me=new a.P(a.aD(wi.lng),a.aH(wi.lat)).mult(d.worldSize).sub(Ce)}else{me=d.centerPoint.add(ne);const Ct=d.pointLocation(me),ti=a.cd.convert(t.center||Ct);this._normalizeCenter(ti),Ce=d.project(Ct),Me=d.project(ti).sub(Ce)}const Pe=d.zoomScale(U-_);let Ne,He;t.around&&(Ne=a.cd.convert(t.around),He=d.locationPoint(Ne));const lt=this._zooming||U!==_,ut=this._rotating||b!==Z,kt=this._pitching||ie!==E,wt=!d.isPaddingEqual(de),xt=t.retainPadding===!1?d.clone():d,pt=Ct=>ti=>{if(lt&&(Ct.zoom=a.ai(_,U,ti)),ut&&(Ct.bearing=a.ai(b,Z,ti)),kt&&(Ct.pitch=a.ai(E,ie,ti)),wt&&(xt.interpolatePadding(D,de,ti),me=xt.centerPoint.add(ne)),Ne)Ct.setLocationAtPoint(Ne,He);else{const si=Ct.zoomScale(Ct.zoom-_),wi=U>_?Math.min(2,Pe):Math.max(.5,Pe),_i=Math.pow(wi,1-ti),Bi=Ct.unproject(Ce.add(Me.mult(ti*_i)).mult(si));Ct.setLocationAtPoint(Ct.renderWorldCopies?Bi.wrap():Bi,me)}return t.preloadOnly||this._fireMoveEvents(r),Ct};if(t.preloadOnly){const Ct=this._emulate(pt,t.duration,d);return this._preloadTiles(Ct),this}const At={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=lt,this._rotating=ut,this._pitching=kt,this._padding=wt,this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,At),this._ease(pt(d),Ct=>{d.cameraElevationReference==="sea"&&d.recenterOnTerrain(),this._afterEase(r,Ct)},t),this}_prepareEase(t,r,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),r||d.moving||this.fire(new a.A("movestart",t)),this._zooming&&!d.zooming&&this.fire(new a.A("zoomstart",t)),this._rotating&&!d.rotating&&this.fire(new a.A("rotatestart",t)),this._pitching&&!d.pitching&&this.fire(new a.A("pitchstart",t))}_fireMoveEvents(t){this.fire(new a.A("move",t)),this._zooming&&this.fire(new a.A("zoom",t)),this._rotating&&this.fire(new a.A("rotate",t)),this._pitching&&this.fire(new a.A("pitch",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const d=this._zooming,_=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new a.A("zoomend",t)),_&&this.fire(new a.A("rotateend",t)),b&&this.fire(new a.A("pitchend",t)),this.fire(new a.A("moveend",t))}flyTo(t,r){if(this._prefersReducedMotion(t)){const ai=a.aF(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(ai,r)}this.stop(),t=a.h({offset:[0,0],speed:1.2,curve:1.42,easing:a.ey},t);const d=this.transform,_=this.getZoom(),b=this.getBearing(),E=this.getPitch(),D=this.getPadding(),U="zoom"in t?a.ay(+t.zoom,d.minZoom,d.maxZoom):_,Z="bearing"in t?this._normalizeBearing(t.bearing,b):b,ie="pitch"in t?+t.pitch:E,de=this._extendPadding(t.padding),ne=d.zoomScale(U-_),me=a.P.convert(t.offset);let Ce=d.centerPoint.add(me);const Me=d.pointLocation(Ce),Pe=a.cd.convert(t.center||Me);this._normalizeCenter(Pe);const Ne=d.project(Me),He=d.project(Pe).sub(Ne);let lt=t.curve;const ut=Math.max(d.width,d.height),kt=ut/ne,wt=He.mag();if("minZoom"in t){const ai=a.ay(Math.min(t.minZoom,_,U),d.minZoom,d.maxZoom),Di=ut/d.zoomScale(ai-_);lt=Math.sqrt(Di/wt*2)}const xt=lt*lt;function pt(ai){const Di=(kt*kt-ut*ut+(ai?-1:1)*xt*xt*wt*wt)/(2*(ai?kt:ut)*xt*wt);return Math.log(Math.sqrt(Di*Di+1)-Di)}function At(ai){return(Math.exp(ai)-Math.exp(-ai))/2}function Ct(ai){return(Math.exp(ai)+Math.exp(-ai))/2}const ti=pt(0);let si=function(ai){return Ct(ti)/Ct(ti+lt*ai)},wi=function(ai){return ut*((Ct(ti)*(At(Di=ti+lt*ai)/Ct(Di))-At(ti))/xt)/wt;var Di},_i=(pt(1)-ti)/lt;if(Math.abs(wt)<1e-6||!isFinite(_i)){if(Math.abs(ut-kt)<1e-6)return this.easeTo(t,r);const ai=kt<ut?-1:1;_i=Math.abs(Math.log(kt/ut))/lt,wi=function(){return 0},si=function(Di){return Math.exp(ai*lt*Di)}}t.duration="duration"in t?+t.duration:1e3*_i/("screenSpeed"in t?+t.screenSpeed/lt:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const Bi=b!==Z,Kt=ie!==E,ui=!d.isPaddingEqual(de),Ft=t.retainPadding===!1?d.clone():d,Ai=ai=>Di=>{const Yi=Di*_i,Mi=1/si(Yi);ai.zoom=Di===1?U:_+ai.scaleZoom(Mi),Bi&&(ai.bearing=a.ai(b,Z,Di)),Kt&&(ai.pitch=a.ai(E,ie,Di)),ui&&(Ft.interpolatePadding(D,de,Di),Ce=Ft.centerPoint.add(me));const qi=Di===1?Pe:ai.unproject(Ne.add(He.mult(wi(Yi))).mult(Mi));return ai.setLocationAtPoint(ai.renderWorldCopies?qi.wrap():qi,Ce),ai._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(r),ai};if(t.preloadOnly){const ai=this._emulate(Ai,t.duration,d);return this._preloadTiles(ai),this}return this._zooming=!0,this._rotating=Bi,this._pitching=Kt,this._padding=ui,this._prepareEase(r,!1),this._ease(Ai(d),()=>this._afterEase(r),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,r){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,r)}if(!t){const d=this.handlers;d&&d.stop(!1)}return this}_ease(t,r,d){d.animate===!1||d.duration===0?(t(1),r()):(this._easeStart=a.q.now(),this._easeOptions=d,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((a.q.now()-this._easeStart)/this._easeOptions.duration,1),r=this._onEaseFrame;r&&r(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,r){t=a.bX(t,-180,180);const d=Math.abs(t-r);return Math.abs(t-360-r)<d&&(t-=360),Math.abs(t+360-r)<d&&(t+=360),t}_normalizeCenter(t){const r=this.transform;if(r.maxBounds||r.projection.name!=="globe"&&!r.renderWorldCopies)return;const d=t.lng-r.center.lng;t.lng+=d>180?-360:d<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&a.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,r,d){const _=Math.ceil(15*r/1e3),b=[],E=t(d.clone());for(let D=0;D<=_;D++){const U=E(D/_);b.push(U.clone())}return b}_preloadTiles(t,r){}}class dm{constructor(t={}){this.options=t,a.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const r=this.options&&this.options.compact,d=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=hs("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=hs("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",d);const _=hs("span","mapboxgl-ctrl-icon",this._compactButton);return _.setAttribute("aria-hidden","true"),_.setAttribute("title",d),this._innerContainer=hs("div","mapboxgl-ctrl-attrib-inner",this._container),r&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),r===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const r=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.e.ACCESS_TOKEN}];if(t){const d=r.reduce((_,b,E)=>(b.value&&(_+=`${b.key}=${b.value}${E<r.length-1?"&":""}`),_),"?");t.href=`${a.e.FEEDBACK_URL}/${d}#${Mp(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const r=this._map.style._mergedSourceCaches;for(const _ in r){const b=r[_];if(b.used){const E=b.getSource();E.attribution&&t.indexOf(E.attribution)<0&&t.push(E.attribution)}}t.sort((_,b)=>_.length-b.length),t=t.filter((_,b)=>{for(let E=b+1;E<t.length;E++)if(t[E].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const d=t.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,t.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Pf{constructor(){a.aV(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=hs("div","mapboxgl-ctrl");const r=hs("a","mapboxgl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://www.mapbox.com/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const r in t){const d=t[r].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const r=t[0];this._map.getCanvasContainer().offsetWidth<250?r.classList.add("mapboxgl-compact"):r.classList.remove("mapboxgl-compact")}}}class fd{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const r=++this._id;return this._queue.push({callback:t,id:r,cancelled:!1}),r}remove(t){const r=this._currentlyRunning,d=r?this._queue.concat(r):this._queue;for(const _ of d)if(_.id===t)return void(_.cancelled=!0)}run(t=0){const r=this._currentlyRunning=this._queue;this._queue=[];for(const d of r)if(!d.cancelled&&(d.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class pu{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const r=a.dk((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-r)+this._end*r}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,r,d){this._start=this.getValue(r),this._end=t,this._startTime=r,this._endTime=r+d}}const Nm={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class ra extends a.A{constructor(t,r,d,_){const{point:b,lngLat:E,originalEvent:D,target:U}=t;super(t.type,{point:b,lngLat:E,originalEvent:D,target:U}),this.preventDefault=()=>{t.preventDefault()},this.id=r,this.interaction=d,this.feature=_}}class ih{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,r){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const d=r.filter;let _=r.type;d&&this.filters.set(t,a.b3(d)),_==="mouseover"&&(_="mouseenter"),_==="mouseout"&&(_="mouseleave");const b=this.interactionsByType.get(_)||new Map;_==="mouseenter"||_==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,r)):b.size===0&&this.map.on(_,this.handleType),b.size===0&&this.interactionsByType.set(_,b),b.set(t,r),this.typeById.set(t,_)}get(t){const r=this.typeById.get(t);if(!r)return;const d=this.interactionsByType.get(r);return d?d.get(t):void 0}remove(t){const r=this.typeById.get(t);if(!r)return;this.typeById.delete(t),this.filters.delete(t);const d=this.interactionsByType.get(r);d&&(d.delete(t),r==="mouseenter"||r==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):d.size===0&&this.map.off(r,this.handleType))}queryTargets(t,r){const d=[];for(const[_,b]of r)b.target&&d.push({targetId:_,target:b.target,filter:this.filters.get(_)});return this.map.style.queryRenderedTargets(t,d,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const r=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());r.length&&(t.type="mouseenter",this.handleType(t,r));const d=new Map;for(const[_,{feature:b}]of this.prevHoveredFeatures)this.hoveredFeatures.has(_)||d.set(b.id,b);d.size&&(t.type="mouseleave",this.handleType(t,Array.from(d.values())))}handleOut(t){const r=Array.from(this.hoveredFeatures.values()).map(({feature:d})=>d);r.length&&(t.type="mouseleave",this.handleType(t,r)),this.hoveredFeatures.clear()}handleType(t,r){const d=t.type==="mouseenter";if(d&&!this.interactionsByType.has(t.type))return void a.w("mouseenter interaction required for mouseleave to work.");const _=Array.from(this.interactionsByType.get(t.type)).reverse(),b=!!r;r=r||this.queryTargets(t.point,_);let E=!1;const D=new Set;for(const U of r){for(const[Z,ie]of _){if(!ie.target)continue;const de=U.variants?U.variants[Z]:null;if(de){for(const ne of de){if(Sd(ne,U,D,Z))continue;const me=new a.de(U,ne),Ce=Yh(ne,U,Z);b&&(me.state=this.map.getFeatureState(me));const Me=d?this.prevHoveredFeatures.get(Ce):null,Pe=new ra(t,Z,ie,me),Ne=Me?Me.stop:ie.handler(Pe);if(d&&this.hoveredFeatures.set(Ce,{feature:U,stop:Ne}),Ne!==!1){E=!0;break}}if(E)break}}if(E)break}if(!E)for(const[U,Z]of _){const{handler:ie,target:de}=Z;if(!de&&ie(new ra(t,U,Z,null))!==!1)break}}}function fu(c,t){if(Array.isArray(c)&&Array.isArray(t)){const r=new Set(c),d=new Set(t);return r.size===d.size&&c.every(_=>d.has(_))}return a.bv(c,t)}const um={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Gu={showCompass:!0,showZoom:!0,visualizePitch:!1};class pg{constructor(t,r,d=!1){this._clickTolerance=10,this.element=r,this.mouseRotate=new op({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,d&&(this.mousePitch=new bh({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),a.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),r.addEventListener("mousedown",this.mousedown),r.addEventListener("touchstart",this.touchstart,{passive:!1}),r.addEventListener("touchmove",this.touchmove),r.addEventListener("touchend",this.touchend),r.addEventListener("touchcancel",this.reset)}down(t,r){this.mouseRotate.mousedown(t,r),this.mousePitch&&this.mousePitch.mousedown(t,r),ir()}move(t,r){const d=this.map,_=this.mouseRotate.mousemoveWindow(t,r),b=_&&_.bearingDelta;if(b&&d.setBearing(d.getBearing()+b),this.mousePitch){const E=this.mousePitch.mousemoveWindow(t,r),D=E&&E.pitchDelta;D&&d.setPitch(d.getPitch()+D)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){fr(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(a.h({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Pi(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Pi(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=fo(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=fo(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function lp(c,t,r){if(c=new a.cd(c.lng,c.lat),t){const d=new a.cd(c.lng-360,c.lat),_=new a.cd(c.lng+360,c.lat),b=360*Math.ceil(Math.abs(c.lng-r.center.lng)/360),E=r.locationPoint3D(c).distSqr(t),D=t.x<0||t.y<0||t.x>r.width||t.y>r.height;r.locationPoint3D(d).distSqr(t)<E&&(D||Math.abs(d.lng-r.center.lng)<b)?c=d:r.locationPoint3D(_).distSqr(t)<E&&(D||Math.abs(_.lng-r.center.lng)<b)&&(c=_)}for(;Math.abs(c.lng-r.center.lng)>180;){const d=r.locationPoint3D(c);if(d.x>=0&&d.y>=0&&d.x<=r.width&&d.y<=r.height)break;c.lng>r.center.lng?c.lng-=360:c.lng+=360}return c}const tf={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},mu={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Wu extends a.E{constructor(t,r){super(),(t instanceof HTMLElement||r)&&(t=a.h({element:t},r)),a.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:d="center",color:_="#3FB1CE",scale:b=1,draggable:E=!1,clickTolerance:D=0,rotation:U=mu.rotation,rotationAlignment:Z=mu.rotationAlignment,pitchAlignment:ie=mu.pitchAlignment,occludedOpacity:de=mu.occludedOpacity,altitude:ne=mu.altitude}=t||{};this._anchor=d,this._color=_,this._scale=b,this._draggable=E,this._clickTolerance=D,this._rotation=U,this._rotationAlignment=Z,this._pitchAlignment=ie,this._occludedOpacity=de,this._altitude=ne,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=a.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=a.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",Me=>{Me.preventDefault()}),this._element.addEventListener("mousedown",Me=>{Me.preventDefault()});const me=this._element.classList;for(const Me in tf)me.remove(`mapboxgl-marker-anchor-${Me}`);me.add(`mapboxgl-marker-anchor-${this._anchor}`);const Ce=t&&t.className?t.className.trim().split(/\s+/):[];me.add(...Ce),this._popup=null}_createDefaultMarker(){const t=hs("div"),r=_r("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const d=_r("radialGradient",{id:"shadowGradient"},_r("defs",{},r));_r("stop",{offset:"10%","stop-opacity":.4},d),_r("stop",{offset:"100%","stop-opacity":.05},d),_r("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},r)}return _r("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},r),_r("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},r),_r("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},r),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=a.cd.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||mu.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const r=t.code,d=t.charCode||t.keyCode;r!=="Space"&&r!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(t){const r=t.originalEvent.target,d=this._element;this._popup&&(r===d||d.contains(r))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,r=this._pos;if(!t||!r)return!1;const d=t.unproject(r,this._altitude),_=t.getFreeCameraOptions();if(!_.position)return!1;const b=_.position.toLngLat();return b.distanceTo(d)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const r=this._pos;if(!r||r.x<0||r.x>t.transform.width||r.y<0||r.y>t.transform.height)return void this._clearFadeTimer();const d=t.unproject(r,this._altitude);let _;t._showingGlobe()&&a.eK(t.transform,this._lngLat)?_=0:(_=1-t._queryFogOpacity(d),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const r=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${tf[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${r.x}px,${r.y}px)
        `}_calculateXYTransform(){const t=this._pos,r=this._map,d=this.getPitchAlignment();if(!r||!t||d!=="map")return"";if(!r._showingGlobe()){const U=r.getPitch();return U?`rotateX(${U}deg)`:""}const _=a.cJ(a.eL(r.transform,this._lngLat)),b=t.sub(a.eM(r.transform)),E=Math.abs(b.x)+Math.abs(b.y);if(E===0)return"";const D=_/E;return`rotateX(${-b.y*D}deg) rotateY(${b.x*D}deg)`}_calculateZTransform(){const t=this._pos,r=this._map;if(!r||!t)return"";let d=0;const _=this.getRotationAlignment();if(_==="map")if(r._showingGlobe()){const b=r.project(new a.cd(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),E=r.project(new a.cd(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(b);d=a.cJ(Math.atan2(E.y,E.x))-90}else d=-r.getBearing();else if(_==="horizon"){const b=a.af(4,6,r.getZoom()),E=a.eM(r.transform);E.y+=b*r.transform.height;const D=t.sub(E),U=a.cJ(Math.atan2(D.y,D.x));d=(U>90?U-270:U+90)*(1-b)}return d+=this._rotation,d?`rotateZ(${d}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const r=this._map;r&&(r.transform.renderWorldCopies&&(this._lngLat=lp(this._lngLat,this._pos,r.transform)),this._pos=r.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),r._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(r._showingGlobe()||r.getTerrain()||r.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=a.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const r=this._map;if(!r)return;const d=this._pointerdownPos,_=this._positionDelta;if(d&&_){if(!this._isDragging){const b=this._clickTolerance||r._clickTolerance;if(t.point.dist(d)<b)return;this._isDragging=!0}this._pos=t.point.sub(_),this._lngLat=r.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.A("dragstart"))),this.fire(new a.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new a.A("dragend")),this._state="inactive"}_addDragHandler(t){const r=this._map,d=this._pos;r&&d&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(d),this._pointerdownPos=t.point,this._state="pending",r.on("mousemove",this._onMove),r.on("touchmove",this._onMove),r.once("mouseup",this._onUp),r.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const r=this._map;return r&&(t?(r.on("mousedown",this._addDragHandler),r.on("touchstart",this._addDragHandler)):(r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||mu.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||mu.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||mu.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||mu.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Cp={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Vm={maxWidth:100,unit:"metric"},If={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},md={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Ac=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function $c(c=new a.P(0,0),t="bottom"){if(typeof c=="number"){const r=Math.round(Math.sqrt(.5*Math.pow(c,2)));switch(t){case"top":return new a.P(0,c);case"top-left":return new a.P(r,r);case"top-right":return new a.P(-r,r);case"bottom":return new a.P(0,-c);case"bottom-left":return new a.P(r,-r);case"bottom-right":return new a.P(-r,-r);case"left":return new a.P(c,0);case"right":return new a.P(-c,0)}return new a.P(0,0)}return c instanceof a.P||Array.isArray(c)?a.P.convert(c):a.P.convert(c[t]||[0,0])}return{version:Ni,supported:zs.supported,setRTLTextPlugin:a.eQ,getRTLTextPluginStatus:a.eP,Map:class extends ju{constructor(c){is.mark(Ui.create);const t=c;if((c=a.h({},um,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(c.antialias&&a.eI(window)&&(c.antialias=!1,a.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new df(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies,null,null),c),this._repaint=!!c.repaint,this._interactive=c.interactive,this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=c.crossSourceCollisions,this._collectResourceTiming=c.collectResourceTiming,this._language=this._parseLanguage(c.language),this._worldview=c.worldview,this._renderTaskQueue=new fd,this._domRenderTaskQueue=new fd,this._controls=[],this._markers=[],this._popups=[],this._mapId=a.a$(),this._locale=a.h({},Nm,c.locale),this._clickTolerance=c.clickTolerance,this._cooperativeGestures=c.cooperativeGestures,this._performanceMetricsCollection=c.performanceMetricsCollection,this._tessellationStep=c.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=c.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new pu(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=c.scaleFactor,this._requestManager=new pi(c.transformRequest,c.accessToken,c.testMode),this._silenceAuthErrors=!!c.testMode,this._contextCreateOptions=c.contextCreateOptions?Object.assign({},c.contextCreateOptions):{},typeof c.container=="string"){const r=document.getElementById(c.container);if(!r)throw new Error(`Container '${c.container.toString()}' not found.`);this._container=r}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(this._container.childNodes.length>0&&a.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),c.maxBounds&&this.setMaxBounds(c.maxBounds),this._spriteFormat=c.spriteFormat,a.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new el),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new cm(this,c),this._localFontFamily=c.localFontFamily,this._localIdeographFontFamily=c.localIdeographFontFamily,(c.style||!c.testMode)&&this.setStyle(c.style||a.e.DEFAULT_STYLE,{config:c.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),c.projection&&this.setProjection(c.projection),this.indoor=new Eu(this),c.hash&&(this._hash=new Nu(typeof c.hash=="string"&&c.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch});const r=c.bounds;r&&(this.resize(),this.fitBounds(r,a.h({},c.fitBoundsOptions,{duration:0})))}this.resize(),c.attributionControl&&this.addControl(new dm({customAttribution:c.customAttribution})),this._logoControl=new Pf,this.addControl(this._logoControl,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new a.A(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new a.A(`${r.dataType}dataloading`,r))}),this._interactions=new ih(this)}_getMapId(){return this._mapId}addControl(c,t){if(t===void 0&&(t=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new a.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=c.onAdd(this);this._controls.push(c);const d=this._controlPositions[t];return t.indexOf("bottom")!==-1?d.insertBefore(r,d.firstChild):d.appendChild(r),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new a.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(c);return t>-1&&this._controls.splice(t,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(c){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new a.A("movestart",c)).fire(new a.A("move",c)),this.fire(new a.A("resize",c)),t&&this.fire(new a.A("moveend",c)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(c){return this.transform.setMaxBounds(a.aG.convert(c)),this._update()}setMinZoom(c){if((c=c??-2)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c?this.setZoom(c):this.fire(new a.A("zoomstart")).fire(new a.A("zoom")).fire(new a.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c??22)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c?this.setZoom(c):this.fire(new a.A("zoomstart")).fire(new a.A("zoom")).fire(new a.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c?this.setPitch(c):this.fire(new a.A("pitchstart")).fire(new a.A("pitch")).fire(new a.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c?this.setPitch(c):this.fire(new a.A("pitchstart")).fire(new a.A("pitch")).fire(new a.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(c){return this._scaleFactor=c,this.painter.scaleFactor=c,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(c){return c==="auto"?navigator.language:Array.isArray(c)?c.length===0?void 0:c.map(t=>t==="auto"?navigator.language:t):c}setLanguage(c){const t=this._parseLanguage(c);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const r of this._controls)r._setLanguage&&r._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(c){return this.style&&c!==this._worldview?(this._worldview=c,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(c){return this._lazyInitEmptyStyle(),c?typeof c=="string"&&(c={name:c}):c=null,this._useExplicitProjection=!!c,this._prioritizeAndUpdateProjection(c,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const c=this.transform,t=c.projection.name;let r;t==="globe"&&c.zoom>=a.cx?(c.setMercatorFromTransition(),r=!0):t==="mercator"&&c.zoom<a.cx&&(c.setProjection({name:"globe"}),r=!0),r&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(c,t){return this._updateProjection(c||t||{name:"mercator"})}_updateProjection(c){let t;return t=c.name==="globe"&&this.transform.zoom>=a.cx?this.transform.setMercatorFromTransition():this.transform.setProjection(c),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(c,t){return this.transform.locationPoint3D(a.cd.convert(c),t)}unproject(c,t){return this.transform.pointLocation3D(a.P.convert(c),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(c,t,r){const d=_=>{let b=[];if(Array.isArray(t)){const E=t.filter(D=>this.getLayer(D));b=E.length?this.queryRenderedFeatures(_,{layers:E}):[]}else b=this.queryRenderedFeatures(_,{target:t});return b};if(c==="mouseenter"||c==="mouseover"){let _=!1;return{listener:r,targets:t,delegates:{mousemove:E=>{const D=d(E.point);D.length?_||(_=!0,r.call(this,new wn(c,this,E.originalEvent,{features:D}))):_=!1},mouseout:()=>{_=!1}}}}if(c==="mouseleave"||c==="mouseout"){let _=!1;return{listener:r,targets:t,delegates:{mousemove:D=>{d(D.point).length?_=!0:_&&(_=!1,r.call(this,new wn(c,this,D.originalEvent)))},mouseout:D=>{_&&(_=!1,r.call(this,new wn(c,this,D.originalEvent)))}}}}{const _=b=>{const E=d(b.point);E.length&&(b.features=E,r.call(this,b),delete b.features)};return{listener:r,targets:t,delegates:{[c]:_}}}}on(c,t,r){if(typeof t=="function"||r===void 0)return super.on(c,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._createDelegatedListener(c,t,r);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(d);for(const _ in d.delegates)this.on(_,d.delegates[_]);return this}once(c,t,r){if(typeof t=="function"||r===void 0)return super.once(c,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._createDelegatedListener(c,t,r);for(const _ in d.delegates)this.once(_,d.delegates[_]);return this}off(c,t,r){if(typeof t=="function"||r===void 0)return super.off(c,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._delegatedListeners?this._delegatedListeners[c]:void 0;return d&&(_=>{for(let b=0;b<_.length;b++){const E=_[b];if(E.listener===r&&fu(E.targets,t)){for(const D in E.delegates)this.off(D,E.delegates[D]);return _.splice(b,1),this}}})(d),this}queryRenderedFeatures(c,t){if(!this.style)return[];if(c===void 0||c instanceof a.P||Array.isArray(c)||t!==void 0||(t=c,c=void 0),c=c||[[0,0],[this.transform.width,this.transform.height]],!t){const b=this.style.queryRenderedFeatures(c,void 0,this.transform),E=this.style.queryRenderedFeatureset(c,void 0,this.transform);return b.concat(E)}let r=!0;if(t.target&&(r=this._isTargetValid(t.target),r&&!t.layers))return this.style.queryRenderedFeatureset(c,t,this.transform);let d=!0;if(t.layers&&Array.isArray(t.layers)){for(const b of t.layers)if(!this._isValidId(b)){d=!1;break}if(d&&!t.target)return this.style.queryRenderedFeatures(c,t,this.transform)}let _=[];return d&&(_=_.concat(this.style.queryRenderedFeatures(c,t,this.transform))),r&&(_=_.concat(this.style.queryRenderedFeatureset(c,t,this.transform))),_}querySourceFeatures(c,t){return!c||typeof c=="string"&&!this._isValidId(c)?[]:this.style.querySourceFeatures(c,t)}isPointOnSurface(c){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&a.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(a.P.convert(c))}addInteraction(c,t){return this._interactions.add(c,t),this}removeInteraction(c){return this._interactions.remove(c),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(c){return this._cooperativeGestures=c,this}setStyle(c,t){return t=a.h({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&c&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(c,(r,d)=>{if(r){const _=typeof r=="string"?r:r instanceof Error?r.message:r.error;a.w(`Unable to perform style diff: ${_}. Rebuilding the style from scratch.`),this._updateStyle(c,t)}else d&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(c,t))}_getUIString(c){const t=this._locale[c];if(t==null)throw new Error(`Missing UI string '${c}'`);return t}_updateStyle(c,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),c){const r=a.h({},t);t&&t.config&&(r.initialConfig=t.config,delete r.config),this.style=new Yl(this,r).load(c),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Yl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.w("There is no style added to the map."),!1)}_isValidId(c){return c==null?(this.fire(new a.z(new Error("IDs can't be empty."))),!1):!a.d8(c)||(this.fire(new a.z(new Error(`IDs can't contain special symbols: "${c}".`))),!1)}_isTargetValid(c){return"featuresetId"in c?this._isValidId("importId"in c?c.importId:c.featuresetId):"layerId"in c&&this._isValidId(c.layerId)}_areTargetsValid(c){if(Array.isArray(c)){for(const t of c)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(c)}addSource(c,t){return this._isValidId(c)?(this._lazyInitEmptyStyle(),this.style.addSource(c,t),this._update(!0)):this}isSourceLoaded(c){return!!this._isValidId(c)&&!!this.style&&this.style._isSourceCacheLoaded(c)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(c,t,r){this._lazyInitEmptyStyle(),this.style.addSourceType(c,t,r)}removeSource(c){return this._isValidId(c)?(this.style.removeSource(c),this._updateTerrain(),this._update(!0)):this}getSource(c){return this._isValidId(c)?this.style.getOwnSource(c):null}addImage(c,t,{pixelRatio:r=1,sdf:d=!1,stretchX:_,stretchY:b,content:E}={}){this._lazyInitEmptyStyle();const D=a.I.from(c);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:U,height:Z,data:ie}=a.q.getImageData(t);this.style.addImage(D,{data:new a.r({width:U,height:Z},ie),pixelRatio:r,stretchX:_,stretchY:b,content:E,sdf:d,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new a.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:U,height:Z}=t,ie=t;this.style.addImage(D,{data:new a.r({width:U,height:Z},new Uint8Array(ie.data)),pixelRatio:r,stretchX:_,stretchY:b,content:E,sdf:d,usvg:!1,version:0,userImage:ie}),ie.onAdd&&ie.onAdd(this,c)}}updateImage(c,t){this._lazyInitEmptyStyle();const r=a.I.from(c),d=this.style.getImage(r);if(!d)return void this.fire(new a.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?a.q.getImageData(t):t,{width:b,height:E,data:D}=_;if(b===void 0||E===void 0)return void this.fire(new a.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==(d.usvg?d.icon.usvg_tree.width:d.data.width)||E!==(d.usvg?d.icon.usvg_tree.height:d.data.height))return void this.fire(new a.z(new Error(`The width and height of the updated image (${b}, ${E})
                must be that same as the previous version of the image
                (${d.data.width}, ${d.data.height})`)));const U=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let Z=!1;d.usvg?(d.data=new a.r({width:b,height:E},new Uint8Array(D)),d.usvg=!1,d.icon=void 0,Z=!0):d.data.replace(D,U),this.style.updateImage(r,d,Z)}hasImage(c){return c?!!this.style&&!!this.style.getImage(a.I.from(c)):(this.fire(new a.z(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(a.I.from(c))}loadImage(c,t){a.o(this._requestManager.transformRequest(c,a.R.Image),(r,d)=>{t(r,d instanceof HTMLImageElement?a.q.getImageData(d):d)})}listImages(){return this.style.listImages().map(c=>c.name)}addModel(c,t){this._lazyInitEmptyStyle(),this.style.addModel(c,t)}hasModel(c){return c?this.style.hasModel(c):(this.fire(new a.z(new Error("Missing required model id"))),!1)}removeModel(c){this.style.removeModel(c)}listModels(){return this.style.listModels()}addLayer(c,t){return this._isValidId(c.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(c,t),this._update(!0)):this}getSlot(c){const t=this.getLayer(c);return t&&t.slot||null}setSlot(c,t){return this.style.setSlot(c,t),this.style.mergeLayers(),this._update(!0)}addImport(c,t){return this.style.addImport(c,t).catch(r=>this.fire(new a.z(new Error("Failed to add import",r)))),this}updateImport(c,t){return typeof t!="string"&&t.id!==c?(this.removeImport(c),this.addImport(t)):(this.style.updateImport(c,t),this._update(!0))}removeImport(c){return this.style.removeImport(c),this}moveImport(c,t){return this.style.moveImport(c,t),this._update(!0)}moveLayer(c,t){return this._isValidId(c)?(this.style.moveLayer(c,t),this._update(!0)):this}removeLayer(c){return this._isValidId(c)?(this.style.removeLayer(c),this._update(!0)):this}getLayer(c){if(!this._isValidId(c))return null;const t=this.style.getOwnLayer(c);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(c,t,r){return this._isValidId(c)?(this.style.setLayerZoomRange(c,t,r),this._update(!0)):this}setFilter(c,t,r={}){return this._isValidId(c)?(this.style.setFilter(c,t,r),this._update(!0)):this}getFilter(c){return this._isValidId(c)?this.style.getFilter(c):null}setPaintProperty(c,t,r,d={}){return this._isValidId(c)?(this.style.setPaintProperty(c,t,r,d),this._update(!0)):this}getPaintProperty(c,t){return this._isValidId(c)?this.style.getPaintProperty(c,t):null}setLayoutProperty(c,t,r,d={}){return this._isValidId(c)?(this.style.setLayoutProperty(c,t,r,d),this._update(!0)):this}getLayoutProperty(c,t){return this._isValidId(c)?this.style.getLayoutProperty(c,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(c){return this.style.setGlyphsUrl(c),this._update(!0)}getSchema(c){return this.style.getSchema(c)}setSchema(c,t){return this.style.setSchema(c,t),this._update(!0)}getConfig(c){return this.style.getConfig(c)}setConfig(c,t){return this.style.setConfig(c,t),this._update(!0)}getConfigProperty(c,t){return this.style.getConfigProperty(c,t)}setConfigProperty(c,t,r){return this.style.setConfigProperty(c,t,r),this._update(!0)}getFeaturesetDescriptors(c){return this.style.getFeaturesetDescriptors(c)}setLights(c){if(this._lazyInitEmptyStyle(),c&&c.length===1&&c[0].type==="flat"){const t=c[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(c),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const c=this.style.getLights()||[];return c.length===0&&c.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),c}setLight(c,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:c}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(c){return this._lazyInitEmptyStyle(),!c&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(c),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(c){return this._lazyInitEmptyStyle(),this.style.setFog(c),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(c){return this._lazyInitEmptyStyle(),this.style.setSnow(c),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(c){return this._lazyInitEmptyStyle(),this.style.setRain(c),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(c){return this._lazyInitEmptyStyle(),this.style.setColorTheme(c),this._update(!0)}setImportColorTheme(c,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(c,t),this._update(!0)}setCamera(c){return this.style.setCamera(c),this._triggerCameraUpdate(c)}_triggerCameraUpdate(c){return this._update(this.transform.setOrthographicProjectionAtLowPitch(c["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(c){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.cd.convert(c),this.transform):0}setFeatureState(c,t){return c.source&&!this._isValidId(c.source)?this:(this.style.setFeatureState(c,t),this._update())}removeFeatureState(c,t){return c.source&&!this._isValidId(c.source)?this:(this.style.removeFeatureState(c,t),this._update())}getFeatureState(c){return c.source&&!this._isValidId(c.source)?null:this.style.getFeatureState(c)}_updateContainerDimensions(){if(!this._container)return;const c=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let r,d,_,b=this._container;for(;b&&(!d||!_);){const E=window.getComputedStyle(b).transform;E&&E!=="none"&&(r=E.match(/matrix.*\((.+)\)/)[1].split(", "),r[0]&&r[0]!=="0"&&r[0]!=="1"&&(d=r[0]),r[3]&&r[3]!=="0"&&r[3]!=="1"&&(_=r[3])),b=b.parentElement}this._containerWidth=d?Math.abs(c/d):c,this._containerHeight=_?Math.abs(t/_):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const c=this._container;c.classList.add("mapboxgl-map"),(this._missingCSSCanary=hs("div","mapboxgl-canary",c)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=hs("div","mapboxgl-canvas-container",c);this._canvas=hs("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const r=this._controlContainer=hs("div","mapboxgl-control-container",c),d=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(_=>{d[_]=hs("div",`mapboxgl-ctrl-${_}`,r)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,t){const r=a.q.devicePixelRatio||1;this._canvas.width=r*Math.ceil(c),this._canvas.height=r*Math.ceil(t),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${t}px`}_addMarker(c){this._markers.push(c)}_removeMarker(c){const t=this._markers.indexOf(c);t!==-1&&this._markers.splice(t,1)}_addPopup(c){this._popups.push(c)}_removePopup(c){const t=this._popups.indexOf(c);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const c=a.h({},zs.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",c);t?(Wh(t,!0),this.painter=new Sf(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",r=>{r.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.l.testSupport(t)):this.fire(new a.z(new Error("Failed to initialize WebGL")))}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.A("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new a.A("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(c){return this.style?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_requestDomTask(c){!this.loaded()||this.loaded()&&!this.isMoving()?c():this._domRenderTaskQueue.add(c)}_render(c){let t;this.fire(new a.A("renderstart")),++this._frameId;const r=this.painter.context.extTimerQuery,d=a.q.now(),_=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=_.createQuery(),_.beginQuery(r.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(c),this._domRenderTaskQueue.run(c),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const Z=this.transform.zoom,ie=this.transform.pitch,de=a.q.now(),ne=new a.aa(Z,{now:de,fadeDuration:b,pitch:ie,transition:this.style.transition,worldview:this._worldview});this.style.update(ne)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(d),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(d);const D=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),D&&(this._placementDirty=D.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,is.mark(Ui.load),this.fire(new a.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const Z=a.q.now()-d;_.endQuery(r.TIME_ELAPSED_EXT),setTimeout(()=>{const ie=_.getQueryParameter(t,_.QUERY_RESULT)/1e6;_.deleteQuery(t),this.fire(new a.A("gpu-timing-frame",{cpuTime:Z,gpuTime:ie}))},50)}if(this.listens("gpu-timing-layer")){const Z=this.painter.collectGpuTimers();setTimeout(()=>{const ie=this.painter.queryGpuTimers(Z);this.fire(new a.A("gpu-timing-layer",{layerTimes:ie}))},50)}if(this.listens("gpu-timing-deferred-render")){const Z=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const ie=this.painter.queryGpuTimeDeferredRender(Z);this.fire(new a.A("gpu-timing-deferred-render",{gpuTime:ie}))},50)}const U=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(U||this._repaint)this.triggerRepaint();else{const Z=this.idle();if(Z&&(E=this._updateAverageElevation(d,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),Z&&(this.fire(new a.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const ie=this._calculateSpeedIndex();this.fire(new a.A("speedindexcompleted",{speedIndex:ie})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||U||(this._fullyLoaded=!0,is.mark(Ui.fullLoad),this._performanceMetricsCollection&&Ul(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(c){for(const t of this._markers)c&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!c||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(c,t=!1){const r=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&r(0);const d=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(d||(t||c-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(c)){const _=this.transform.averageElevation;let b=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=c;const E=Math.abs(_-b);if(E>1){if(this._isInitialLoad||d)return this._averageElevation.jumpTo(b),r(b);this._averageElevation.easeTo(b,c,300)}else if(E>1e-4)return this._averageElevation.jumpTo(b),r(b)}return!!this._averageElevation.isEasing(c)&&r(this._averageElevation.getValue(c))}_authenticate(){ql(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,c=>{if(c&&(c.message===No||c.status===401)){const t=this.painter.context.gl;Wh(t,!1),this._logoControl instanceof Pf&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Pl(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Zo(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const c=this._isDragging();this.painter.updateTerrain(this.style,c)}_calculateSpeedIndex(){const c=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const r=this.painter.context.gl,d=r.createFramebuffer();function _(b){r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,b,0);const E=new Uint8Array(r.drawingBufferWidth*r.drawingBufferHeight*4);return r.readPixels(0,0,r.drawingBufferWidth,r.drawingBufferHeight,r.RGBA,r.UNSIGNED_BYTE,E),E}return r.bindFramebuffer(r.FRAMEBUFFER,d),this._canvasPixelComparison(_(c),t.canvasCopies.map(_),t.timeStamps)}_canvasPixelComparison(c,t,r){let d=r[1]-r[0];const _=c.length/4;for(let b=0;b<t.length;b++){const E=t[b];let D=0;for(let U=0;U<E.length;U+=4)E[U]===c[U]&&E[U+1]===c[U+1]&&E[U+2]===c[U+2]&&E[U+3]===c[U+3]&&(D+=1);d+=(r[b+2]-r[b+1])*(1-D/_)}return d}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Sh.delete(this.painter.context.gl),mo.remove(),Na.remove(),this._removed=!0,this.fire(new a.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(c){this._renderNextFrame=this._renderNextFrame||c,this.style&&!this._frame&&(this._frame=a.q.frame(t=>{const r=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,r&&this._render(t)}))}_preloadTiles(c){const t=this.style?this.style.getSourceCaches():[];return a.bt(t,(r,d)=>r._preloadTiles(c,d),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(c){this._trackResize&&this.resize({originalEvent:c})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(c){this._showParseStatus!==c&&(this._showParseStatus=c,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(c){this._showTerrainWireframe!==c&&(this._showTerrainWireframe=c,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(c){this._showLayers2DWireframe!==c&&(this._showLayers2DWireframe=c,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(c){this._showLayers3DWireframe!==c&&(this._showLayers3DWireframe=c,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(c){this._speedIndexTiming!==c&&(this._speedIndexTiming=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,this._tp.refreshUI(),c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(c){this._showTileAABBs!==c&&(this._showTileAABBs=c,this._tp.refreshUI(),c&&this._update())}_setCacheLimits(c,t){a.eJ(c,t)}get version(){return Ni}},NavigationControl:class{constructor(c={}){this.options=a.h({},Gu,c),this._container=hs("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(a.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),hs("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),hs("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const r=this._map;r&&(this.options.visualizePitch?r.resetNorthPitch({},{originalEvent:t}):r.resetNorth({},{originalEvent:t}))}),this._compassIcon=hs("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const c=this._map;if(!c)return;const t=c.getZoom(),r=t===c.getMaxZoom(),d=t===c.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const c=this._map;if(!c)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(c.transform.pitch*(Math.PI/180)),.5)}) rotateX(${c.transform.pitch}deg) rotateZ(${c.transform.angle*(180/Math.PI)}deg)`:`rotate(${c.transform.angle*(180/Math.PI)}deg)`;c._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),c.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&c.on("pitch",this._rotateCompassArrow),c.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new pg(c,this._compass,this.options.visualizePitch)),this._container}onRemove(){const c=this._map;c&&(this._container.remove(),this.options.showZoom&&c.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&c.off("pitch",this._rotateCompassArrow),c.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(c,t){const r=hs("button",c,this._container);return r.type="button",r.addEventListener("click",t),r}_setButtonTitle(c,t){if(!this._map)return;const r=this._map._getUIString(`NavigationControl.${t}`);c.setAttribute("aria-label",r),c.firstElementChild&&c.firstElementChild.setAttribute("title",r)}},GeolocateControl:class extends a.E{constructor(c={}){super();const t=navigator.geolocation;this.options=a.h({geolocation:t},Cp,c),a.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Sp(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(c){return this._map=c,this._container=hs("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(c){const t=(r=!!this.options.geolocation)=>{this._supportsGeolocation=r,c(r)};this._supportsGeolocation!==void 0?c(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(r=>t(r.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(c){const t=this._map.getMaxBounds(),r=c.coords;return!!t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new a.A("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.A("geolocate",c)),this._finish()}}_updateCamera(c){const t=new a.cd(c.coords.longitude,c.coords.latitude),r=c.coords.accuracy,d=this._map.getBearing(),_=a.h({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(r),_,{geolocateSource:!0})}_updateMarker(c){if(c){const t=new a.cd(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const c=this._map.transform,t=a.c6(1,c._center.lat)*c.worldSize,r=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.A("error",c)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(c){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=hs("button","mapboxgl-ctrl-geolocate",this._container),hs("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=hs("div","mapboxgl-user-location"),this._dotElement.appendChild(hs("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(hs("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Wu({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=hs("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Wu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.A("trackuserlocationend")))})}}_onDeviceOrientation(c){this._userLocationDotMarker&&(c.webkitCompassHeading?this._heading=c.webkitCompassHeading:c.absolute===!0&&(this._heading=-1*c.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(c={maximumAge:6e5,timeout:0},this._noTimeout=!0):(c=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,c),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const c=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&c()}).catch(console.error):c()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:dm,ScaleControl:class{constructor(c={}){this.options=a.h({},Vm,c),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),a.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const c=this.options.maxWidth||100,t=this._map,r=t._containerHeight/2,d=t._containerWidth/2-c/2,_=t.unproject([d,r]),b=t.unproject([d+c,r]),E=_.distanceTo(b);if(this.options.unit==="imperial"){const D=3.2808*E;D>5280?this._setScale(c,D/5280,"mile"):this._setScale(c,D,"foot")}else this.options.unit==="nautical"?this._setScale(c,E/1852,"nautical-mile"):E>=1e3?this._setScale(c,E/1e3,"kilometer"):this._setScale(c,E,"meter")}_setScale(c,t,r){this._map._requestDomTask(()=>{const d=function(b){const E=Math.pow(10,`${Math.floor(b)}`.length-1);let D=b/E;return D=D>=10?10:D>=5?5:D>=3?3:D>=2?2:D>=1?1:function(U){const Z=Math.pow(10,Math.ceil(-Math.log(U)/Math.LN10));return Math.round(U*Z)/Z}(D),E*D}(t),_=d/t;this._container.innerHTML=this._isNumberFormatSupported&&r!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:r}).format(d):`${d}&nbsp;${If[r]}`,this._container.style.width=c*_+"px"})}onAdd(c){return this._map=c,this._language=c.getLanguage(),this._container=hs("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(c){this._language=c,this._update()}setUnit(c){this.options.unit=c,this._update()}},FullscreenControl:class{constructor(c={}){this._fullscreen=!1,c&&c.container&&(c.container instanceof HTMLElement?this._container=c.container:a.w("Full screen control 'container' must be a DOM element.")),a.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=hs("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const c=this._fullscreenButton=hs("button","mapboxgl-ctrl-fullscreen",this._controlContainer);hs("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",c)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.E{constructor(c){super(),this.options=a.h(Object.create(md),c),this._altitude=this.options.altitude,a.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(c&&c.className?c.className.trim().split(/\s+/):[])}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&c.on("preclick",this._onClose),this.options.closeOnMove&&c.on("move",this._onClose),c.on("remove",this.remove),this._update(),c._addPopup(this),this._focusFirstElement(),this._trackPointer?(c.on("mousemove",this._onMouseEvent),c.on("mouseup",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")):c.on("move",this._update),this.fire(new a.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const c=this._map;return c&&(c.off("move",this._update),c.off("move",this._onClose),c.off("preclick",this._onClose),c.off("click",this._onClose),c.off("remove",this.remove),c.off("mousemove",this._onMouseEvent),c.off("mouseup",this._onMouseEvent),c.off("drag",this._onMouseEvent),c._canvasContainer&&c._canvasContainer.classList.remove("mapboxgl-track-pointer"),c._removePopup(this),this._map=void 0),this.fire(new a.A("close")),this}getLngLat(){return this._lngLat}setLngLat(c){this._lngLat=a.cd.convert(c),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(c){return this._altitude=c,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const c=this._map;return c&&(c.off("move",this._update),c.on("mousemove",this._onMouseEvent),c.on("drag",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(document.createTextNode(c))}setHTML(c){const t=document.createDocumentFragment(),r=document.createElement("body");let d;for(r.innerHTML=c;d=r.firstChild,d;)t.appendChild(d);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=hs("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(c),this.options.closeButton){const r=this._closeButton=hs("button","mapboxgl-popup-close-button",t);r.type="button",r.setAttribute("aria-label","Close popup"),r.innerHTML='<span aria-hidden="true">&#215;</span>',r.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(c){return this._classList.add(c),this._updateClassList(),this}removeClassName(c){return this._classList.delete(c),this._updateClassList(),this}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){let t;return this._classList.delete(c)?t=!1:(this._classList.add(c),t=!0),this._updateClassList(),t}_onMouseEvent(c){this._update(c.point)}_getAnchor(c){if(this.options.anchor)return this.options.anchor;const t=this._map,r=this._container,d=this._pos;if(!t||!r||!d)return"bottom";const _=r.offsetWidth,b=r.offsetHeight,E=d.x<_/2,D=d.x>t.transform.width-_/2;if(d.y+c<b)return E?"top-left":D?"top-right":"top";if(d.y>t.transform.height-b){if(E)return"bottom-left";if(D)return"bottom-right"}return E?"left":D?"right":"bottom"}_updateClassList(){const c=this._container;if(!c)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),c.className=t.join(" ")}_update(c){const t=this._map,r=this._content;if(!t||!this._lngLat&&!this._trackPointer||!r)return;let d=this._container;if(d||(d=this._container=hs("div","mapboxgl-popup",t.getContainer()),this._tip=hs("div","mapboxgl-popup-tip",d),d.appendChild(r)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=lp(this._lngLat,this._pos,t.transform)),!this._trackPointer||c){const _=this._pos=this._trackPointer&&c instanceof a.P?c:t.project(this._lngLat,this._altitude),b=$c(this.options.offset),E=this._anchor=this._getAnchor(b.y),D=$c(this.options.offset,E),U=_.add(D).round();t._requestDomTask(()=>{this._container&&E&&(this._container.style.transform=`${tf[E]} translate(${U.x}px,${U.y}px)`)})}if(!this._marker&&t._showingGlobe()){const _=a.eK(t.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(Ac);c&&c.focus()}_onClose(){this.remove()}_setOpacity(c){this._container&&(this._container.style.opacity=`${c}`),this._content&&(this._content.style.pointerEvents=c?"auto":"none")}},Marker:Wu,Style:Yl,LngLat:a.cd,LngLatBounds:a.aG,Point:a.P,MercatorCoordinate:a.ac,FreeCameraOptions:Rc,Evented:a.E,config:a.e,prewarm:a.eO,clearPrewarmedResources:a.eN,get accessToken(){return a.e.ACCESS_TOKEN},set accessToken(c){a.e.ACCESS_TOKEN=c},get baseApiUrl(){return a.e.API_URL},set baseApiUrl(c){a.e.API_URL=c},get workerCount(){return a.eX.workerCount},set workerCount(c){a.eX.workerCount=c},get maxParallelImageRequests(){return a.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){a.e.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage(c){a.eW(c)},get workerUrl(){return a.eV.workerUrl},set workerUrl(c){a.eV.workerUrl=c},get workerClass(){return a.eV.workerClass},set workerClass(c){a.eV.workerClass=c},get workerParams(){return a.eV.workerParams},set workerParams(c){a.eV.workerParams=c},get dracoUrl(){return a.eU()},set dracoUrl(c){a.eT(c)},get meshoptUrl(){return a.eS()},set meshoptUrl(c){a.eR(c)},setNow:a.q.setNow,restoreNow:a.q.restoreNow}});var Vi=Qt;return Vi})}(Av)),Av.exports}var hA=lA();const cA=Jb(hA);var Sb=eA(()=>cA),dA=ua('<div id="map" class="svelte-66imvr"></div>');function uA(ze,Je){fx(Je,!1);let ot=eg(Je,"zoomTarget",8),Ht=jh(),Qt=jh(!1);Sb(Sb().accessToken="pk.eyJ1Ijoic2l5YWdvc3dhbWkiLCJhIjoiY21kNmRoM3loMDd3aTJrcTJldWs0cWN4eCJ9.8jt8P9tkvth7tnssIhiDrg"),gx(()=>{Jn(Ht,new(Sb()).Map({container:"map",style:"mapbox://styles/mapbox/light-v11",center:ot().center,zoom:ot().zoom})),Sr(Ht).on("load",()=>{Jn(Qt,!0)})}),Jw(()=>(Sr(Ht),Sr(Qt),Q0(ot())),()=>{var Vi,a;Sr(Ht)&&Sr(Qt)&&((Vi=ot())!=null&&Vi.center)&&((a=ot())==null?void 0:a.zoom)!==void 0&&(console.log("flying to: ",ot()),Sr(Ht).flyTo({center:ot().center,zoom:ot().zoom,speed:.8,curve:1.4,essential:!0}))}),Qw(),o_();var ni=dA();da(ze,ni),mx()}var pA=ua('<div><div class="sticky svelte-iojxlp"><!></div> <div class="scrolly svelte-iojxlp"><!></div></div>');function Z0(ze,Je){var ot=pA(),Ht=ah(ot),Qt=ah(Ht);Ob(Qt,()=>Je.sticky);var ni=yl(Ht,2),Vi=ah(ni);Ob(Vi,()=>Je.scrolly),k0(()=>tv(ot,1,`wrapper ${Je.layout??""}`,"svelte-iojxlp")),da(ze,ot)}var fA=ua('<div class="article-text svelte-15t0dbl"><p><!></p></div>');function P_(ze,Je){var ot=fA(),Ht=ah(ot),Qt=ah(Ht);Ob(Qt,()=>Je.children),da(ze,ot)}var mA=ua(`<h1 style="font-family: Libre Baskerville, serif; font-style: italic; text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.4);">1 state. 2 different counties. 2 vastly different realities.</h1> <p style="font-family: Libre Baskerville, serif; font-style: italic; font-size: 1rem; padding: 0.5rem; line-height: 1.4;">Now comes the question of... why? 
                Why are these counties, separated geographically only by a mere 50 miles and 2 inter-state routes, 
                so vastly different in practically every single aspect? How can there be such vast inequality in the span of a one-hour drive?</p>`,1),gA=ua(`But doesn't wealth-related inequality exist everywhere? It is a virtually inescapable part of life, 
                and you will find socioeconomic division no matter where you go. <br/><br/> <strong>In other words... what makes these two counties so special?</strong>`,1),yA=ua("Well, that is true. Unfortunately, many people have no choice but to grapple with the consequences of wealth-related inequality reflected in their own lives. <br/><br/> What makes these two counties so special, however, is the fact that they clearly show <strong>what the disparities are based on.</strong>",1),xA=ua(`But hold off on any final guesses. The picture might look a little fuzzy right now, 
                but there are a couple of more things that must be understood. <br/><br/> To understand the why and the what, we need to look at the <i>how</i>. <strong>And that requires turning some pages back in history.</strong>`,1),_A=ua("<!> <!> <!>",1),vA=ua("<div><!></div>");function bA(ze){var Je=vA(),ot=ah(Je);Z0(ot,{layout:"right",sticky:ni=>{var Vi=mA();da(ni,Vi)},scrolly:ni=>{var Vi=_A(),a=$v(Vi);P_(a,{children:(is,Xs)=>{var Qi=gA();da(is,Qi)}});var Ni=yl(a,2);P_(Ni,{children:(is,Xs)=>{var Qi=yA();da(is,Qi)}});var Ui=yl(Ni,2);P_(Ui,{children:(is,Xs)=>{var Qi=xA();da(is,Qi)}}),da(ni,Vi)}}),da(ze,Je)}var wA=ua('<div class="image-container svelte-b6lwro"><img class="svelte-b6lwro"/></div>');function TA(ze,Je){fx(Je,!1);let ot=eg(Je,"imageUrl",8,""),Ht=eg(Je,"altText",8,"");eg(Je,"transitionDuration",8,"3s"),eg(Je,"height",8,"100vh");let Qt=jh(),ni=jh(!1);gx(()=>{const Ni=new IntersectionObserver(Ui=>{Ui.forEach(is=>{is.isIntersecting&&(Jn(ni,!0),Ni.unobserve(is.target))})},{threshold:.6});return Sr(Qt)&&Ni.observe(Sr(Qt)),()=>Ni.disconnect()}),o_();var Vi=wA(),a=ah(Vi);Gf(Vi,Ni=>Jn(Qt,Ni),()=>Sr(Qt)),k0(()=>{Db(a,"src",ot()),Db(a,"alt",Ht()),Kb(a,`--blur: ${Sr(ni)?"0px":"8px"}`)}),da(ze,Vi),mx()}function SA(ze){TA(ze,{imageUrl:"https://scholarship.shu.edu/context/acealagna/article/3052/type/native/viewcontent",altText:"Newark, NJ",transitionDuration:"2.5s"})}var MA=ua('<img alt=""/>'),AA=ua('<div class="sticky-container svelte-qcqiew"></div>');function kA(ze,Je){let ot=eg(Je,"currentStep",8,0),Ht=eg(Je,"images",24,()=>[]);var Qt=AA();Zb(Qt,5,Ht,qb,(ni,Vi,a)=>{var Ni=MA();k0(()=>{Db(Ni,"src",Sr(Vi)),tv(Ni,1,`image ${ot()===a?"visible":"hidden"}`,"svelte-qcqiew")}),da(ni,Ni)}),da(ze,Qt)}var EA=ua('<section class="svelte-kvirlq"><!></section>');function Tv(ze,Je){fx(Je,!1);let ot=jh();const Ht=rA();gx(()=>{const Vi=new IntersectionObserver(([a])=>{a.isIntersecting&&Ht("enter")},{threshold:.5});return Sr(ot)&&Vi.observe(Sr(ot)),()=>Vi.disconnect()}),o_();var Qt=EA(),ni=ah(Qt);GM(ni,Je,"default",{}),Gf(Qt,Vi=>Jn(ot,Vi),()=>Sr(ot)),da(ze,Qt),mx()}var CA=ua(`<p style="line-height: 1.2; text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.3);">The photo above is an aerial view of Newark, New Jersey during the 1960s-1970s. 
                As the largest municipality in Essex County, it serves as a blueprint for understanding
                the area's massive inequality and discrimination. <br/><br/> Essex County is one of the foremost examples of New Jersey's slave history. 
                From street names to historical structures, there are remnants of the
                atrocities are omnipresent.
                Bloomfield, a township in the county, was home to Lieutenent Colonel Thomas Cadmus. 
                Although he is primarily remembered as an officer in the American Revolutionary War, his former residence is a 
                stark reminder that he was a slave-owner. <strong>He enslaved almost 4,700 Black people 
                in the mid-eighteenth century.</strong> <br/><br/> Cadmus was not the only slave-owner in the area. New Jersey was 
                actually even referred to as the "slave state of the North" because 
                it enslaved <strong>more than two-thirds of all slaves in the North by the 1830s.</strong></p>`),PA=ua(`<p style="line-height: 1.2; text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.3);">Almost a century after slavery was outlawed, the federal government 
                continued to engage in discriminatory practices—especially in regards to housing. 
                Known more generally as red-lining, the Federal Housing Administration (FHA)
                drew red lines around Black neighborhoods and considered those areas 
                as investment risks. <strong>As a result, Black households were denied mortgages and bank services, 
                stunting any potential socioeconomic mobility.</strong> <br/><br/> Some neighborhoods in Newark were explicitly called slum sections and designated specifically for lower-income people. 
                Discriminatory attitudes by predominantly white bankers almost immediately 
                cast away those areas as <strong>'deteriorating' and 'of no use'</strong> due to the increasing number 
                of Black families. On this 1939 map, Newark and Bloomfield were labeled
                red and 'Fourth Grade,' whereas predominantly white areas such as Maplewood and Upper
                Montclair were green and 'First Grade.'<strong>All investments ultimately prioritized and/or went to 'First Grade' communities.</strong> <br/><br/> And, almost a century after that, racial discrimination in housing persists. 
                In 2022, New Jersey's Lakeland Bank was fined $13 million because it was accused 
                of avoiding giving mortgages to and opening branches in Black and Latinx communities. <strong>And, according to the New Jersey Institute for Social Justice,
                Black and Latinx households in the county are three times more likely to be impoverished 
                and half as likely to own property or a home compared to white households.</strong></p>`),IA=ua(`<p style="line-height: 1.2; text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.3);">The inequality unfortunately does not stop there. According to the New Jersey Department of Health, 
                Black individuals are also less likely to have health insurance.
                This is a significant challenge because
                they are also more vulnerable to environmental factors and stressors like mold, toxins from 
                sanitary landfills, and air pollutants from waste facilities. This exposure can ultimately lead 
                to <strong>preventable death.</strong> <br/><br/> Furthermore, predominantly Black low-income communities were shown to have faced 
                neglect from federal assistance programs after Hurricane Sandy, the most
                destructive hurricane to ever be experienced by the state, in 2015. <br/><br/> Education also remains heavily segregated. Newark has some of the most highly-segregated
                schools in the country, ranking first in economic segregation and second in racial segregation.
                For context, 75% of students in the Glen Ridge school district of the county are white, 
                yet in the East Orange school district, white students make up a stark 1%. <br/><br/> <strong>And the distance between the two districts? Just 3 miles.</strong></p>`),LA=ua(`<p style="line-height: 1.2; text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.3);">All of these factors combined lead to what is known as <strong>social vulnerability.</strong> <br/><br/> Social vulnerability describes demographic and socioeconomic stressors like poverty, lack of 
                access to transportation, and crowded housing, and their capacity to <strong>negatively affect</strong> communities 
                during hazardous or threatening periods. These hazards can either be natural disasters, human-caused disasters, 
                or disease outbreaks. <br/><br/> The Social Vulnerability Index (SVI) is a metric that assesses <strong>a community's capacity and ability to overcome these challenges through its socioeconomic aspects.</strong> Assessed on a scale of 0 to 1, a <strong>higher score indicates greater social vulnerability.</strong> For example, a low-income neighborhood with crowded housing would likely spread a contagious disease 
                more rapidly, yet its inhabitants may not have health insurance for the vaccination. Or, a neighborhood with 
                weak infrastructure and a lack of access to transportation may suffer disproportionately from a tornado 
                because the structural integrity of each home is heavily compromised and its residents do not have the 
                ability to evacuate. Thus, social vulnerability points to a <strong>clear relationship</strong> between socioeconomic factors 
                and the extent of suffering caused by an event. <br/><br/> Social vulnerability and the SVI are of the utmost importance to consider as we grapple with the facts 
                of an ever-evolving world. Climate change is happening right before us. Air and water pollution remain 
                prevalent threats to a healthy and sustainable world. And the gap between the wealthy and the poor is only rising. <br/><br/> Let's take a look at some data to put all these words into context.</p>`),OA=ua('<div class="scrolly-container svelte-duhf8j"><div class="text-column svelte-duhf8j"><!> <!> <!> <!></div> <!></div>');function DA(ze){let Je=jh(0);const ot=["https://jerseybee.org/wp-content/uploads/2024/06/FeaturedImage_SegregationIntro_June2024-1-2048x1152.jpg","https://jerseybee.org/wp-content/uploads/2024/06/Map_Redlining1939_June2024-1844x2048.jpg","https://www.njspotlightnews.org/wp-content/uploads/sites/123/2022/03/Attendees-at-school-desegregation-rally-Trenton-March-31-2022.jpg","https://whyy.org/wp-content/uploads/2021/01/camden_NJ_illegal_dumping_011121_01-768x588.jpg"];var Ht=OA(),Qt=ah(Ht),ni=ah(Qt);Tv(ni,{$$events:{enter:()=>Jn(Je,0)},children:(is,Xs)=>{var Qi=CA();da(is,Qi)},$$slots:{default:!0}});var Vi=yl(ni,2);Tv(Vi,{$$events:{enter:()=>Jn(Je,1)},children:(is,Xs)=>{var Qi=PA();da(is,Qi)},$$slots:{default:!0}});var a=yl(Vi,2);Tv(a,{$$events:{enter:()=>Jn(Je,2)},children:(is,Xs)=>{var Qi=IA();da(is,Qi)},$$slots:{default:!0}});var Ni=yl(a,2);Tv(Ni,{$$events:{enter:()=>Jn(Je,3)},children:(is,Xs)=>{var Qi=LA();da(is,Qi)},$$slots:{default:!0}});var Ui=yl(Qt,2);kA(Ui,{get images(){return ot},get currentStep(){return Sr(Je)}}),da(ze,Ht)}function zA(ze){const Je=ze-1;return Je*Je*Je+1}function Ew(ze){const Je=typeof ze=="string"&&ze.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return Je?[parseFloat(Je[1]),Je[2]||"px"]:[ze,"px"]}function Cw(ze,{delay:Je=0,duration:ot=400,easing:Ht=zA,x:Qt=0,y:ni=0,opacity:Vi=0}={}){const a=getComputedStyle(ze),Ni=+a.opacity,Ui=a.transform==="none"?"":a.transform,is=Ni*(1-Vi),[Xs,Qi]=Ew(Qt),[xs,zs]=Ew(ni);return{delay:Je,duration:ot,easing:Ht,css:(hs,_r)=>`
			transform: ${Ui} translate(${(1-hs)*Xs}${Qi}, ${(1-hs)*xs}${zs});
			opacity: ${Ni-is*_r}`}}var RA=ua("<span> </span>"),BA=ua('<div class="spacer svelte-tlz4pm"></div> <div class="word-container svelte-tlz4pm"><!></div>',1),FA=ua('<section class="falling-words-container svelte-tlz4pm"></section>');function NA(ze,Je){fx(Je,!1);const ot=["social","vulnerability","cannot","be","separated","from","race"];let Ht=jh([]),Qt=jh(Array(ot.length).fill(!1)),ni=jh([]);gx(()=>{Jn(ni,ot.map(()=>Math.random()*30-10)),Sr(Ht).forEach((a,Ni)=>{const Ui=new IntersectionObserver(([is])=>{is.isIntersecting&&(Lv(Qt,Sr(Qt)[Ni]=!0),Ui.unobserve(is.target))},{threshold:.5});Ui.observe(a)})}),o_();var Vi=FA();Zb(Vi,5,()=>ot,qb,(a,Ni,Ui)=>{var is=BA(),Xs=yl($v(is),2),Qi=ah(Xs);{var xs=zs=>{var hs=RA(),_r=ah(hs);k0(()=>{Kb(hs,`display: inline-block; transform: rotate(${Sr(ni)[Ui]??""}deg);`),Lb(_r,Sr(Ni))}),Sw(1,hs,()=>Cw,()=>({y:-50,duration:500})),Sw(2,hs,()=>Cw,()=>({y:-50,duration:400})),da(zs,hs)};By(Qi,zs=>{Sr(Qt)[Ui]&&zs(xs)})}Gf(Xs,(zs,hs)=>Lv(Ht,Sr(Ht)[hs]=zs),zs=>{var hs;return(hs=Sr(Ht))==null?void 0:hs[zs]},()=>[Ui]),da(a,is)}),da(ze,Vi),mx()}var kv={exports:{}},VA=kv.exports,Pw;function UA(){return Pw||(Pw=1,function(ze,Je){(function(ot,Ht){ot._Highcharts=Ht(),ze.exports=ot._Highcharts})(typeof window>"u"?VA:window,()=>(()=>{var Gg;let ot,Ht;var Qt,ni,Vi,a,Ni,Ui,is,Xs,Qi,xs,zs,hs,_r,ar,Nr,Or,ir,fr,wo={};wo.d=(he,u)=>{for(var v in u)wo.o(u,v)&&!wo.o(he,v)&&Object.defineProperty(he,v,{enumerable:!0,get:u[v]})},wo.o=(he,u)=>Object.prototype.hasOwnProperty.call(he,u);var rn={};wo.d(rn,{default:()=>Ax}),function(he){var u,v,M,z,F,V,G;he.SVG_NS="http://www.w3.org/2000/svg",he.product="Highcharts",he.version="12.3.0",he.win=typeof window<"u"?window:{},he.doc=he.win.document,he.svg=!!((M=(v=(u=he.doc)==null?void 0:u.createElementNS)==null?void 0:v.call(u,he.SVG_NS,"svg"))!=null&&M.createSVGRect),he.pageLang=(V=(F=(z=he.doc)==null?void 0:z.documentElement)==null?void 0:F.closest("[lang]"))==null?void 0:V.lang,he.userAgent=((G=he.win.navigator)==null?void 0:G.userAgent)||"",he.isChrome=he.win.chrome,he.isFirefox=he.userAgent.indexOf("Firefox")!==-1,he.isMS=/(edge|msie|trident)/i.test(he.userAgent)&&!he.win.opera,he.isSafari=!he.isChrome&&he.userAgent.indexOf("Safari")!==-1,he.isTouchDevice=/(Mobile|Android|Windows Phone)/.test(he.userAgent),he.isWebKit=he.userAgent.indexOf("AppleWebKit")!==-1,he.deg2rad=2*Math.PI/360,he.marginNames=["plotTop","marginRight","marginBottom","plotLeft"],he.noop=function(){},he.supportsPassiveEvents=function(){let Q=!1;if(!he.isMS){let le=Object.defineProperty({},"passive",{get:function(){Q=!0}});he.win.addEventListener&&he.win.removeEventListener&&(he.win.addEventListener("testPassive",he.noop,le),he.win.removeEventListener("testPassive",he.noop,le))}return Q}(),he.charts=[],he.composed=[],he.dateFormats={},he.seriesTypes={},he.symbolSizes={},he.chartCount=0}(Qt||(Qt={}));let Pi=Qt,{charts:fo,doc:pl,win:Cs}=Pi;function Da(he,u,v,M){let z=u?"Highcharts error":"Highcharts warning";he===32&&(he=`${z}: Deprecated member`);let F=xl(he),V=F?`${z} #${he}: www.highcharts.com/errors/${he}/`:he.toString();if(M!==void 0){let G="";F&&(V+="?"),mo(M,function(Q,le){G+=`
 - ${le}: ${Q}`,F&&(V+=encodeURI(le)+"="+encodeURI(Q))}),V+=G}Sh(Pi,"displayError",{chart:v,code:he,message:V,params:M},function(){if(u)throw Error(V);Cs.console&&Da.messages.indexOf(V)===-1&&console.warn(V)}),Da.messages.push(V)}function No(he,u){return parseInt(he,u||10)}function pi(he){return typeof he=="string"}function on(he){let u=Object.prototype.toString.call(he);return u==="[object Array]"||u==="[object Array Iterator]"}function Io(he,u){return!!he&&typeof he=="object"&&(!u||!on(he))}function Qn(he){return Io(he)&&typeof he.nodeType=="number"}function fi(he){let u=he==null?void 0:he.constructor;return!!(Io(he,!0)&&!Qn(he)&&(u!=null&&u.name)&&u.name!=="Object")}function xl(he){return typeof he=="number"&&!isNaN(he)&&he<1/0&&he>-1/0}function gr(he){return he!=null}function Kn(he,u,v){let M,z=pi(u)&&!gr(v),F=(V,G)=>{gr(V)?he.setAttribute(G,V):z?(M=he.getAttribute(G))||G!=="class"||(M=he.getAttribute(G+"Name")):he.removeAttribute(G)};return pi(u)?F(v,u):mo(u,F),M}function za(he){return on(he)?he:[he]}function Na(he,u){let v;for(v in he||(he={}),u)he[v]=u[v];return he}function Pl(){let he=arguments,u=he.length;for(let v=0;v<u;v++){let M=he[v];if(M!=null)return M}}function Lo(he,u){Na(he.style,u)}function Zo(he){return Math.pow(10,Math.floor(Math.log(he)/Math.LN10))}function pa(he,u){return he>1e14?he:parseFloat(he.toPrecision(u||14))}(Da||(Da={})).messages=[],Math.easeInOutSine=function(he){return-.5*(Math.cos(Math.PI*he)-1)};let Ul=Array.prototype.find?function(he,u){return he.find(u)}:function(he,u){let v,M=he.length;for(v=0;v<M;v++)if(u(he[v],v))return he[v]};function mo(he,u,v){for(let M in he)Object.hasOwnProperty.call(he,M)&&u.call(v||he[M],he[M],M,he)}function ql(he,u,v){function M(V,G){let Q=he.removeEventListener;Q&&Q.call(he,V,G,!1)}function z(V){let G,Q;he.nodeName&&(u?(G={})[u]=!0:G=V,mo(G,function(le,ye){if(V[ye])for(Q=V[ye].length;Q--;)M(ye,V[ye][Q].fn)}))}let F=typeof he=="function"&&he.prototype||he;if(Object.hasOwnProperty.call(F,"hcEvents")){let V=F.hcEvents;if(u){let G=V[u]||[];v?(V[u]=G.filter(function(Q){return v!==Q.fn}),M(u,v)):(z(V),V[u]=[])}else z(V),delete F.hcEvents}}function Sh(he,u,v,M){if(v=v||{},(pl==null?void 0:pl.createEvent)&&(he.dispatchEvent||he.fireEvent&&he!==Pi)){let z=pl.createEvent("Events");z.initEvent(u,!0,!0),v=Na(z,v),he.dispatchEvent?he.dispatchEvent(v):he.fireEvent(u,v)}else if(he.hcEvents){v.target||Na(v,{preventDefault:function(){v.defaultPrevented=!0},target:he,type:u});let z=[],F=he,V=!1;for(;F.hcEvents;)Object.hasOwnProperty.call(F,"hcEvents")&&F.hcEvents[u]&&(z.length&&(V=!0),z.unshift.apply(z,F.hcEvents[u])),F=Object.getPrototypeOf(F);V&&z.sort((G,Q)=>G.order-Q.order),z.forEach(G=>{G.fn.call(he,v)===!1&&v.preventDefault()})}M&&!v.defaultPrevented&&M.call(he,v)}let Wh=function(){let he=Math.random().toString(36).substring(2,9)+"-",u=0;return function(){return"highcharts-"+(ot?"":he)+u++}}();Cs.jQuery&&(Cs.jQuery.fn.highcharts=function(){let he=[].slice.call(arguments);if(this[0])return he[0]?(new Pi[pi(he[0])?he.shift():"Chart"](this[0],he[0],he[1]),this):fo[Kn(this[0],"data-highcharts-chart")]});let Qs={addEvent:function(he,u,v,M={}){let z=typeof he=="function"&&he.prototype||he;Object.hasOwnProperty.call(z,"hcEvents")||(z.hcEvents={});let F=z.hcEvents;Pi.Point&&he instanceof Pi.Point&&he.series&&he.series.chart&&(he.series.chart.runTrackerClick=!0);let V=he.addEventListener;V&&V.call(he,u,v,!!Pi.supportsPassiveEvents&&{passive:M.passive===void 0?u.indexOf("touch")!==-1:M.passive,capture:!1}),F[u]||(F[u]=[]);let G={fn:v,order:typeof M.order=="number"?M.order:1/0};return F[u].push(G),F[u].sort((Q,le)=>Q.order-le.order),function(){ql(he,u,v)}},arrayMax:function(he){let u=he.length,v=he[0];for(;u--;)he[u]>v&&(v=he[u]);return v},arrayMin:function(he){let u=he.length,v=he[0];for(;u--;)he[u]<v&&(v=he[u]);return v},attr:Kn,clamp:function(he,u,v){return he>u?he<v?he:v:u},clearTimeout:function(he){gr(he)&&clearTimeout(he)},correctFloat:pa,createElement:function(he,u,v,M,z){let F=pl.createElement(he);return u&&Na(F,u),z&&Lo(F,{padding:"0",border:"none",margin:"0"}),v&&Lo(F,v),M&&M.appendChild(F),F},crisp:function(he,u=0,v){let M=u%2/2,z=v?-1:1;return(Math.round(he*z-M)+M)*z},css:Lo,defined:gr,destroyObjectProperties:function(he,u,v){mo(he,function(M,z){M!==u&&(M!=null&&M.destroy)&&M.destroy(),(M!=null&&M.destroy||!v)&&delete he[z]})},diffObjects:function(he,u,v,M){let z={};return function F(V,G,Q,le){let ye=v?G:V;mo(V,function(ce,we){if(!le&&M&&M.indexOf(we)>-1&&G[we]){ce=za(ce),Q[we]=[];for(let Le=0;Le<Math.max(ce.length,G[we].length);Le++)G[we][Le]&&(ce[Le]===void 0?Q[we][Le]=G[we][Le]:(Q[we][Le]={},F(ce[Le],G[we][Le],Q[we][Le],le+1)))}else Io(ce,!0)&&!ce.nodeType?(Q[we]=on(ce)?[]:{},F(ce,G[we]||{},Q[we],le+1),Object.keys(Q[we]).length===0&&(we!=="colorAxis"||le!==0)&&delete Q[we]):(V[we]!==G[we]||we in V&&!(we in G))&&we!=="__proto__"&&we!=="constructor"&&(Q[we]=ye[we])})}(he,u,z,0),z},discardElement:function(he){var u;(u=he==null?void 0:he.parentElement)==null||u.removeChild(he)},erase:function(he,u){let v=he.length;for(;v--;)if(he[v]===u){he.splice(v,1);break}},error:Da,extend:Na,extendClass:function(he,u){let v=function(){};return v.prototype=new he,Na(v.prototype,u),v},find:Ul,fireEvent:Sh,getAlignFactor:(he="")=>({center:.5,right:1,middle:.5,bottom:1})[he]||0,getClosestDistance:function(he,u){let v,M,z,F=!u;return he.forEach(V=>{if(V.length>1)for(z=V.length-1;z>0;z--)(M=V[z]-V[z-1])<0&&!F?(u==null||u(),u=void 0):M&&(v===void 0||M<v)&&(v=M)}),v},getMagnitude:Zo,getNestedProperty:function(he,u){let v=he.split(".");for(;v.length&&gr(u);){let M=v.shift();if(M===void 0||M==="__proto__")return;if(M==="this"){let F;return Io(u)&&(F=u["@this"]),F??u}let z=u[M.replace(/[\\'"]/g,"")];if(!gr(z)||typeof z=="function"||typeof z.nodeType=="number"||z===Cs)return;u=z}return u},getStyle:function he(u,v,M){var V;let z;if(v==="width"){let G=Math.min(u.offsetWidth,u.scrollWidth),Q=(V=u.getBoundingClientRect)==null?void 0:V.call(u).width;return Q<G&&Q>=G-1&&(G=Math.floor(Q)),Math.max(0,G-(he(u,"padding-left",!0)||0)-(he(u,"padding-right",!0)||0))}if(v==="height")return Math.max(0,Math.min(u.offsetHeight,u.scrollHeight)-(he(u,"padding-top",!0)||0)-(he(u,"padding-bottom",!0)||0));let F=Cs.getComputedStyle(u,void 0);return F&&(z=F.getPropertyValue(v),Pl(M,v!=="opacity")&&(z=No(z))),z},insertItem:function(he,u){let v,M=he.options.index,z=u.length;for(v=he.options.isInternal?z:0;v<z+1;v++)if(!u[v]||xl(M)&&M<Pl(u[v].options.index,u[v]._i)||u[v].options.isInternal){u.splice(v,0,he);break}return v},isArray:on,isClass:fi,isDOMElement:Qn,isFunction:function(he){return typeof he=="function"},isNumber:xl,isObject:Io,isString:pi,merge:function(he,...u){let v,M=[he,...u],z={},F=function(G,Q){return typeof G!="object"&&(G={}),mo(Q,function(le,ye){ye!=="__proto__"&&ye!=="constructor"&&(!Io(le,!0)||fi(le)||Qn(le)?G[ye]=Q[ye]:G[ye]=F(G[ye]||{},le))}),G};he===!0&&(z=M[1],M=Array.prototype.slice.call(M,2));let V=M.length;for(v=0;v<V;v++)z=F(z,M[v]);return z},normalizeTickInterval:function(he,u,v,M,z){let F,V=he;v=Pl(v,Zo(he));let G=he/v;for(!u&&(u=z?[1,1.2,1.5,2,2.5,3,4,5,6,8,10]:[1,2,2.5,5,10],M===!1&&(v===1?u=u.filter(function(Q){return Q%1==0}):v<=.1&&(u=[1/v]))),F=0;F<u.length&&(V=u[F],(!z||!(V*v>=he))&&(z||!(G<=(u[F]+(u[F+1]||u[F]))/2)));F++);return pa(V*v,-Math.round(Math.log(.001)/Math.LN10))},objectEach:mo,offset:function(he){let u=pl.documentElement,v=he.parentElement||he.parentNode?he.getBoundingClientRect():{top:0,left:0,width:0,height:0};return{top:v.top+(Cs.pageYOffset||u.scrollTop)-(u.clientTop||0),left:v.left+(Cs.pageXOffset||u.scrollLeft)-(u.clientLeft||0),width:v.width,height:v.height}},pad:function(he,u,v){return Array((u||2)+1-String(he).replace("-","").length).join(v||"0")+he},pick:Pl,pInt:No,pushUnique:function(he,u){return 0>he.indexOf(u)&&!!he.push(u)},relativeLength:function(he,u,v){return/%$/.test(he)?u*parseFloat(he)/100+(v||0):parseFloat(he)},removeEvent:ql,replaceNested:function(he,...u){let v,M;do for(M of(v=he,u))he=he.replace(M[0],M[1]);while(he!==v);return he},splat:za,stableSort:function(he,u){let v,M,z=he.length;for(M=0;M<z;M++)he[M].safeI=M;for(he.sort(function(F,V){return(v=u(F,V))===0?F.safeI-V.safeI:v}),M=0;M<z;M++)delete he[M].safeI},syncTimeout:function(he,u,v){return u>0?setTimeout(he,u,v):(he.call(0,v),-1)},timeUnits:{millisecond:1,second:1e3,minute:6e4,hour:36e5,day:864e5,week:6048e5,month:24192e5,year:314496e5},ucfirst:function(he){return pi(he)?he.substring(0,1).toUpperCase()+he.substring(1):String(he)},uniqueKey:Wh,useSerialIds:function(he){return ot=Pl(he,ot)},wrap:function(he,u,v){let M=he[u];he[u]=function(){let z=arguments,F=this;return v.apply(this,[function(){return M.apply(F,arguments.length?arguments:z)}].concat([].slice.call(arguments)))}}},{pageLang:Ic,win:_l}=Pi,{defined:qa,error:Lc,extend:wd,isNumber:Ps,isObject:nl,isString:jl,merge:Kc,objectEach:Gs,pad:zn,splat:Gl,timeUnits:fc,ucfirst:al}=Qs,Gd=Pi.isSafari&&_l.Intl&&!_l.Intl.DateTimeFormat.prototype.formatRange,Oc=he=>he.main===void 0,mh=class{constructor(he,u){this.options={timezone:"UTC"},this.variableTimezone=!1,this.Date=_l.Date,this.update(he),this.lang=u}update(he={}){this.dTLCache={},this.options=he=Kc(!0,this.options,he);let{timezoneOffset:u,useUTC:v,locale:M}=he;this.Date=he.Date||_l.Date||Date;let z=he.timezone;qa(v)&&(z=v?"UTC":void 0),u&&u%60==0&&(z="Etc/GMT"+(u>0?"+":"")+u/60),this.variableTimezone=z!=="UTC"&&(z==null?void 0:z.indexOf("Etc/GMT"))!==0,this.timezone=z,this.lang&&M&&(this.lang.locale=M),["months","shortMonths","weekdays","shortWeekdays"].forEach(F=>{let V=/months/i.test(F),G=/short/.test(F),Q={timeZone:"UTC"};Q[V?"month":"weekday"]=G?"short":"long",this[F]=(V?[0,1,2,3,4,5,6,7,8,9,10,11]:[3,4,5,6,7,8,9]).map(le=>this.dateFormat(Q,(V?31:1)*24*36e5*le))})}toParts(he){let[u,v,M,z,F,V,G]=this.dateTimeFormat({weekday:"narrow",day:"numeric",month:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},he,"es").split(/(?:, | |\/|:)/g);return[z,M-1,v,F,V,G,Math.floor(Number(he)||0)%1e3,"DLMXJVS".indexOf(u)].map(Number)}dateTimeFormat(he,u,v=this.options.locale||Ic){let M=JSON.stringify(he)+v;jl(he)&&(he=this.str2dtf(he));let z=this.dTLCache[M];if(!z){he.timeZone??(he.timeZone=this.timezone);try{z=new Intl.DateTimeFormat(v,he)}catch(F){/Invalid time zone/i.test(F.message)?(Lc(34),he.timeZone="UTC",z=new Intl.DateTimeFormat(v,he)):Lc(F.message,!1)}}return this.dTLCache[M]=z,(z==null?void 0:z.format(u))||""}str2dtf(he,u={}){let v={L:{fractionalSecondDigits:3},S:{second:"2-digit"},M:{minute:"numeric"},H:{hour:"2-digit"},k:{hour:"numeric"},E:{weekday:"narrow"},a:{weekday:"short"},A:{weekday:"long"},d:{day:"2-digit"},e:{day:"numeric"},b:{month:"short"},B:{month:"long"},m:{month:"2-digit"},o:{month:"numeric"},y:{year:"2-digit"},Y:{year:"numeric"}};return Object.keys(v).forEach(M=>{he.indexOf(M)!==-1&&wd(u,v[M])}),u}makeTime(he,u,v=1,M=0,z,F,V){let G=this.Date.UTC(he,u,v,M,z||0,F||0,V||0);if(this.timezone!=="UTC"){let Q=this.getTimezoneOffset(G);if(G+=Q,[2,3,8,9,10,11].indexOf(u)!==-1&&(M<5||M>20)){let le=this.getTimezoneOffset(G);Q!==le?G+=le-Q:Q-36e5!==this.getTimezoneOffset(G-36e5)||Gd||(G-=36e5)}}return G}parse(he){if(!jl(he))return he??void 0;let u=(he=he.replace(/\//g,"-").replace(/(GMT|UTC)/,"")).indexOf("Z")>-1||/([+-][0-9]{2}):?[0-9]{2}$/.test(he),v=/^[0-9]{4}-[0-9]{2}(-[0-9]{2}|)$/.test(he);u||v||(he+="Z");let M=Date.parse(he);if(Ps(M))return M+(!u||v?this.getTimezoneOffset(M):0)}getTimezoneOffset(he){if(this.timezone!=="UTC"){let[u,v,M,z,F=0]=this.dateTimeFormat({timeZoneName:"shortOffset"},he,"en").split(/(GMT|:)/).map(Number),V=-(60*(M+F/60)*6e4);if(Ps(V))return V}return 0}dateFormat(he,u,v){let M=this.lang;if(!qa(u)||isNaN(u))return(M==null?void 0:M.invalidDate)||"";if(jl(he=he??"%Y-%m-%d %H:%M:%S")){let z,F=/%\[([a-zA-Z]+)\]/g;for(;z=F.exec(he);)he=he.replace(z[0],this.dateTimeFormat(z[1],u,M==null?void 0:M.locale))}if(jl(he)&&he.indexOf("%")!==-1){let z=this,[F,V,G,Q,le,ye,ce,we]=this.toParts(u),Le=(M==null?void 0:M.weekdays)||this.weekdays,Ue=(M==null?void 0:M.shortWeekdays)||this.shortWeekdays,et=(M==null?void 0:M.months)||this.months,tt=(M==null?void 0:M.shortMonths)||this.shortMonths;Gs(wd({a:Ue?Ue[we]:Le[we].substr(0,3),A:Le[we],d:zn(G),e:zn(G,2," "),w:we,v:(M==null?void 0:M.weekFrom)??"",b:tt[V],B:et[V],m:zn(V+1),o:V+1,y:F.toString().substr(2,2),Y:F,H:zn(Q),k:Q,I:zn(Q%12||12),l:Q%12||12,M:zn(le),p:Q<12?"AM":"PM",P:Q<12?"am":"pm",S:zn(ye),L:zn(ce,3)},Pi.dateFormats),function($e,ht){if(jl(he))for(;he.indexOf("%"+ht)!==-1;)he=he.replace("%"+ht,typeof $e=="function"?$e.call(z,u):$e)})}else if(nl(he)){let z=(this.getTimezoneOffset(u)||0)/36e5,F=this.timezone||"Etc/GMT"+(z>=0?"+":"")+z,{prefix:V="",suffix:G=""}=he;he=V+this.dateTimeFormat(wd({timeZone:F},he),u)+G}return v?al(he):he}resolveDTLFormat(he){return nl(he,!0)?nl(he,!0)&&Oc(he)?{main:he}:he:{main:(he=Gl(he))[0],from:he[1],to:he[2]}}getDateFormat(he,u,v,M){let z=this.dateFormat("%m-%d %H:%M:%S.%L",u),F="01-01 00:00:00.000",V={millisecond:15,second:12,minute:9,hour:6,day:3},G="millisecond",Q=G;for(G in fc){if(he&&he===fc.week&&+this.dateFormat("%w",u)===v&&z.substr(6)===F.substr(6)){G="week";break}if(he&&fc[G]>he){G=Q;break}if(V[G]&&z.substr(V[G])!==F.substr(V[G]))break;G!=="week"&&(Q=G)}return this.resolveDTLFormat(M[G]).main}},{defined:ll,extend:Mh,timeUnits:Sa}=Qs,Wl=class extends mh{getTimeTicks(he,u,v,M){let z=this,F=[],V={},{count:G=1,unitRange:Q}=he,[le,ye,ce,we,Le,Ue]=z.toParts(u),et=(u||0)%1e3,tt;if(M??(M=1),ll(u)){if(et=Q>=Sa.second?0:G*Math.floor(et/G),Q>=Sa.second&&(Ue=Q>=Sa.minute?0:G*Math.floor(Ue/G)),Q>=Sa.minute&&(Le=Q>=Sa.hour?0:G*Math.floor(Le/G)),Q>=Sa.hour&&(we=Q>=Sa.day?0:G*Math.floor(we/G)),Q>=Sa.day&&(ce=Q>=Sa.month?1:Math.max(1,G*Math.floor(ce/G))),Q>=Sa.month&&(ye=Q>=Sa.year?0:G*Math.floor(ye/G)),Q>=Sa.year&&(le-=le%G),Q===Sa.week){G&&(u=z.makeTime(le,ye,ce,we,Le,Ue,et));let yt=this.dateTimeFormat({timeZone:this.timezone,weekday:"narrow"},u,"es"),ci="DLMXJVS".indexOf(yt);ce+=-ci+M+(ci<M?-7:0)}u=z.makeTime(le,ye,ce,we,Le,Ue,et),z.variableTimezone&&ll(v)&&(tt=v-u>4*Sa.month||z.getTimezoneOffset(u)!==z.getTimezoneOffset(v));let $e=u,ht=1;for(;$e<v;)F.push($e),Q===Sa.year?$e=z.makeTime(le+ht*G,0):Q===Sa.month?$e=z.makeTime(le,ye+ht*G):tt&&(Q===Sa.day||Q===Sa.week)?$e=z.makeTime(le,ye,ce+ht*G*(Q===Sa.day?1:7)):tt&&Q===Sa.hour&&G>1?$e=z.makeTime(le,ye,ce,we+ht*G):$e+=Q*G,ht++;F.push($e),Q<=Sa.hour&&F.length<1e4&&F.forEach(yt=>{yt%18e5==0&&z.dateFormat("%H%M%S%L",yt)==="000000000"&&(V[yt]="day")})}return F.info=Mh(he,{higherRanks:V,totalRange:Q*G}),F}},{isTouchDevice:Tu}=Pi,{fireEvent:Jc,merge:Td}=Qs,To={colors:["#2caffe","#544fc5","#00e272","#fe6a35","#6b8abc","#d568fb","#2ee0ca","#fa4b42","#feb56a","#91e8e1"],symbols:["circle","diamond","square","triangle","triangle-down"],lang:{weekFrom:"week from",chartTitle:"Chart title",locale:void 0,loading:"Loading...",months:void 0,seriesName:"Series {add index 1}",shortMonths:void 0,weekdays:void 0,numericSymbols:["k","M","G","T","P","E"],pieSliceName:"Slice",resetZoom:"Reset zoom",yAxisTitle:"Values",resetZoomTitle:"Reset zoom level 1:1"},global:{buttonTheme:{fill:"#f7f7f7",padding:8,r:2,stroke:"#cccccc","stroke-width":1,style:{color:"#333333",cursor:"pointer",fontSize:"0.8em",fontWeight:"normal"},states:{hover:{fill:"#e6e6e6"},select:{fill:"#e6e9ff",style:{color:"#000000",fontWeight:"bold"}},disabled:{style:{color:"#cccccc"}}}}},time:{Date:void 0,timezone:"UTC",timezoneOffset:0,useUTC:void 0},chart:{alignThresholds:!1,panning:{enabled:!1,type:"x"},styledMode:!1,borderRadius:0,colorCount:10,allowMutatingData:!0,ignoreHiddenSeries:!0,spacing:[10,10,15,10],resetZoomButton:{theme:{},position:{}},reflow:!0,type:"line",zooming:{singleTouch:!1,resetButton:{theme:{zIndex:6},position:{align:"right",x:-10,y:10}}},width:null,height:null,borderColor:"#334eff",backgroundColor:"#ffffff",plotBorderColor:"#cccccc"},title:{style:{color:"#333333",fontWeight:"bold"},text:"Chart title",margin:15,minScale:.67},subtitle:{style:{color:"#666666",fontSize:"0.8em"},text:""},caption:{margin:15,style:{color:"#666666",fontSize:"0.8em"},text:"",align:"left",verticalAlign:"bottom"},plotOptions:{},legend:{enabled:!0,align:"center",alignColumns:!0,className:"highcharts-no-tooltip",events:{},layout:"horizontal",itemMarginBottom:2,itemMarginTop:2,labelFormatter:function(){return this.name},borderColor:"#999999",borderRadius:0,navigation:{style:{fontSize:"0.8em"},activeColor:"#0022ff",inactiveColor:"#cccccc"},itemStyle:{color:"#333333",cursor:"pointer",fontSize:"0.8em",textDecoration:"none",textOverflow:"ellipsis"},itemHoverStyle:{color:"#000000"},itemHiddenStyle:{color:"#666666",textDecoration:"line-through"},shadow:!1,itemCheckboxStyle:{position:"absolute",width:"13px",height:"13px"},squareSymbol:!0,symbolPadding:5,verticalAlign:"bottom",x:0,y:0,title:{style:{color:"#333333",fontSize:"0.8em",fontWeight:"bold"}}},loading:{labelStyle:{fontWeight:"bold",position:"relative",top:"45%"},style:{position:"absolute",backgroundColor:"#ffffff",opacity:.5,textAlign:"center"}},tooltip:{enabled:!0,animation:{duration:300,easing:he=>Math.sqrt(1-Math.pow(he-1,2))},borderRadius:3,dateTimeLabelFormats:{millisecond:"%[AebHMSL]",second:"%[AebHMS]",minute:"%[AebHM]",hour:"%[AebHM]",day:"%[AebY]",week:"%v %[AebY]",month:"%[BY]",year:"%Y"},footerFormat:"",headerShape:"callout",hideDelay:500,padding:8,position:{x:0,y:3},shared:!1,snap:Tu?25:10,headerFormat:'<span style="font-size: 0.8em">{ucfirst point.key}</span><br/>',pointFormat:'<span style="color:{point.color}">●</span> {series.name}: <b>{point.y}</b><br/>',backgroundColor:"#ffffff",borderWidth:void 0,stickOnContact:!1,style:{color:"#333333",cursor:"default",fontSize:"0.8em"},useHTML:!1},credits:{enabled:!0,href:"https://www.highcharts.com?credits",position:{align:"right",x:-10,verticalAlign:"bottom",y:-5},style:{cursor:"pointer",color:"#999999",fontSize:"0.6em"},text:"Highcharts.com"}},Rn=new Wl(To.time,To.lang),Za={defaultOptions:To,defaultTime:Rn,getOptions:function(){return To},setOptions:function(he){var u;return Jc(Pi,"setOptions",{options:he}),Td(!0,To,he),he.time&&Rn.update(To.time),he.lang&&"locale"in he.lang&&Rn.update({locale:he.lang.locale}),(u=he.lang)!=null&&u.chartTitle&&(To.title={...To.title,text:he.lang.chartTitle}),To}},{win:Hl}=Pi,{isNumber:mc,isString:Va,merge:Zl,pInt:Wi,defined:Ra}=Qs,pp=(he,u,v)=>`color-mix(in srgb,${he},${u} ${100*v}%)`,vl=he=>Va(he)&&!!he&&he!=="none";class lr{static parse(u){return u?new lr(u):lr.None}constructor(u){let v,M,z,F;this.rgba=[NaN,NaN,NaN,NaN],this.input=u;let V=Pi.Color;if(V&&V!==lr)return new V(u);if(typeof u=="object"&&u.stops!==void 0)this.stops=u.stops.map(G=>new lr(G[1]));else if(typeof u=="string")for(this.input=u=lr.names[u.toLowerCase()]||u,z=lr.parsers.length;z--&&!M;)(v=(F=lr.parsers[z]).regex.exec(u))&&(M=F.parse(v));M&&(this.rgba=M)}get(u){let v=this.input,M=this.rgba;if(this.output)return this.output;if(typeof v=="object"&&this.stops!==void 0){let z=Zl(v);return z.stops=[].slice.call(z.stops),this.stops.forEach((F,V)=>{z.stops[V]=[z.stops[V][0],F.get(u)]}),z}return M&&mc(M[0])?u!=="rgb"&&(u||M[3]!==1)?u==="a"?`${M[3]}`:"rgba("+M.join(",")+")":"rgb("+M[0]+","+M[1]+","+M[2]+")":v}brighten(u){let v=this.rgba;if(this.stops)this.stops.forEach(function(M){M.brighten(u)});else if(mc(u)&&u!==0)if(mc(v[0]))for(let M=0;M<3;M++)v[M]+=Wi(255*u),v[M]<0&&(v[M]=0),v[M]>255&&(v[M]=255);else lr.useColorMix&&vl(this.input)&&(this.output=pp(this.input,u>0?"white":"black",Math.abs(u)));return this}setOpacity(u){return this.rgba[3]=u,this}tweenTo(u,v){let M=this.rgba,z=u.rgba;if(!mc(M[0])||!mc(z[0]))return lr.useColorMix&&vl(this.input)&&vl(u.input)&&v<.99?pp(this.input,u.input,v):u.input||"none";let F=z[3]!==1||M[3]!==1,V=(Q,le)=>Q+(M[le]-Q)*(1-v),G=z.slice(0,3).map(V).map(Math.round);return F&&G.push(V(z[3],3)),(F?"rgba(":"rgb(")+G.join(",")+")"}}lr.names={white:"#ffffff",black:"#000000"},lr.parsers=[{regex:/rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d?(?:\.\d+)?)\s*\)/,parse:function(he){return[Wi(he[1]),Wi(he[2]),Wi(he[3]),parseFloat(he[4],10)]}},{regex:/rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/,parse:function(he){return[Wi(he[1]),Wi(he[2]),Wi(he[3]),1]}},{regex:/^#([a-f0-9])([a-f0-9])([a-f0-9])([a-f0-9])?$/i,parse:function(he){return[Wi(he[1]+he[1],16),Wi(he[2]+he[2],16),Wi(he[3]+he[3],16),Ra(he[4])?Wi(he[4]+he[4],16)/255:1]}},{regex:/^#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})?$/i,parse:function(he){return[Wi(he[1],16),Wi(he[2],16),Wi(he[3],16),Ra(he[4])?Wi(he[4],16)/255:1]}}],lr.useColorMix=(Gg=Hl.CSS)==null?void 0:Gg.supports("color","color-mix(in srgb,red,blue 9%)"),lr.None=new lr("");let{parse:ei}=lr,{win:Oe}=Pi,{isNumber:We,objectEach:ct}=Qs;class Et{constructor(u,v,M){this.pos=NaN,this.options=v,this.elem=u,this.prop=M}dSetter(){let u=this.paths,v=u==null?void 0:u[0],M=u==null?void 0:u[1],z=this.now||0,F=[];if(z!==1&&v&&M)if(v.length===M.length&&z<1)for(let V=0;V<M.length;V++){let G=v[V],Q=M[V],le=[];for(let ye=0;ye<Q.length;ye++){let ce=G[ye],we=Q[ye];We(ce)&&We(we)&&(Q[0]!=="A"||ye!==4&&ye!==5)?le[ye]=ce+z*(we-ce):le[ye]=we}F.push(le)}else F=M;else F=this.toD||[];this.elem.attr("d",F,void 0,!0)}update(){let u=this.elem,v=this.prop,M=this.now,z=this.options.step;this[v+"Setter"]?this[v+"Setter"]():u.attr?u.element&&u.attr(v,M,null,!0):u.style[v]=M+this.unit,z&&z.call(u,M,this)}run(u,v,M){let z=this,F=z.options,V=function(le){return!V.stopped&&z.step(le)},G=Oe.requestAnimationFrame||function(le){setTimeout(le,13)},Q=function(){for(let le=0;le<Et.timers.length;le++)Et.timers[le]()||Et.timers.splice(le--,1);Et.timers.length&&G(Q)};u!==v||this.elem["forceAnimate:"+this.prop]?(this.startTime=+new Date,this.start=u,this.end=v,this.unit=M,this.now=this.start,this.pos=0,V.elem=this.elem,V.prop=this.prop,V()&&Et.timers.push(V)===1&&G(Q)):(delete F.curAnim[this.prop],F.complete&&Object.keys(F.curAnim).length===0&&F.complete.call(this.elem))}step(u){let v,M,z=+new Date,F=this.options,V=this.elem,G=F.complete,Q=F.duration,le=F.curAnim;return V.attr&&!V.element?v=!1:u||z>=Q+this.startTime?(this.now=this.end,this.pos=1,this.update(),le[this.prop]=!0,M=!0,ct(le,function(ye){ye!==!0&&(M=!1)}),M&&G&&G.call(V),v=!1):(this.pos=F.easing((z-this.startTime)/Q),this.now=this.start+(this.end-this.start)*this.pos,this.update(),v=!0),v}initPath(u,v,M){let z=u.startX,F=u.endX,V=M.slice(),G=u.isArea,Q=G?2:1,le=v&&M.length>v.length&&M.hasStackedCliffs,ye,ce,we,Le,Ue=v==null?void 0:v.slice();if(!Ue||le)return[V,V];function et($e,ht){for(;$e.length<ce;){let yt=$e[0],ci=ht[ce-$e.length];if(ci&&yt[0]==="M"&&(ci[0]==="C"?$e[0]=["C",yt[1],yt[2],yt[1],yt[2],yt[1],yt[2]]:$e[0]=["L",yt[1],yt[2]]),$e.unshift(yt),G){let ii=$e.pop();$e.push($e[$e.length-1],ii)}}}function tt($e){for(;$e.length<ce;){let ht=$e[Math.floor($e.length/Q)-1].slice();if(ht[0]==="C"&&(ht[1]=ht[5],ht[2]=ht[6]),G){let yt=$e[Math.floor($e.length/Q)].slice();$e.splice($e.length/2,0,ht,yt)}else $e.push(ht)}}if(z&&F&&F.length){for(we=0;we<z.length;we++)if(z[we]===F[0]){ye=we;break}else if(z[0]===F[F.length-z.length+we]){ye=we,Le=!0;break}else if(z[z.length-1]===F[F.length-z.length+we]){ye=z.length-we;break}ye===void 0&&(Ue=[])}return Ue.length&&We(ye)&&(ce=V.length+ye*Q,Le?(et(Ue,V),tt(V)):(et(V,Ue),tt(Ue))),[Ue,V]}fillSetter(){Et.prototype.strokeSetter.apply(this,arguments)}strokeSetter(){this.elem.attr(this.prop,ei(this.start).tweenTo(ei(this.end),this.pos),void 0,!0)}}Et.timers=[];let{defined:at,getStyle:zt,isArray:oi,isNumber:jt,isObject:qt,merge:gi,objectEach:li,pick:Zi}=Qs;function Ss(he){return qt(he)?gi({duration:500,defer:0},he):{duration:500*!!he,defer:0}}function ds(he,u){let v=Et.timers.length;for(;v--;)Et.timers[v].elem!==he||u&&u!==Et.timers[v].prop||(Et.timers[v].stopped=!0)}let Ws={animate:function(he,u,v){let M,z="",F,V,G;qt(v)||(G=arguments,v={duration:G[2],easing:G[3],complete:G[4]}),jt(v.duration)||(v.duration=400),v.easing=typeof v.easing=="function"?v.easing:Math[v.easing]||Math.easeInOutSine,v.curAnim=gi(u),li(u,function(Q,le){ds(he,le),V=new Et(he,v,le),F=void 0,le==="d"&&oi(u.d)?(V.paths=V.initPath(he,he.pathArray,u.d),V.toD=u.d,M=0,F=1):he.attr?M=he.attr(le):(M=parseFloat(zt(he,le))||0,le!=="opacity"&&(z="px")),F||(F=Q),typeof F=="string"&&F.match("px")&&(F=F.replace(/px/g,"")),V.run(M,F,z)})},animObject:Ss,getDeferredAnimation:function(he,u,v){let M=Ss(u),z=v?[v]:he.series,F=0,V=0;return z.forEach(G=>{let Q=Ss(G.options.animation);F=qt(u)&&at(u.defer)?M.defer:Math.max(F,Q.duration+Q.defer),V=Math.min(M.duration,Q.duration)}),he.renderer.forExport&&(F=0),{defer:Math.max(0,F-V),duration:Math.min(F,V)}},setAnimation:function(he,u){u.renderer.globalAnimation=Zi(he,u.options.chart.animation,!0)},stop:ds},{SVG_NS:mr,win:vr}=Pi,{attr:Rr,createElement:Ar,css:Ko,error:to,isFunction:nn,isString:ao,objectEach:lo,splat:Oo}=Qs,{trustedTypes:fn}=vr,un=fn&&nn(fn.createPolicy)&&fn.createPolicy("highcharts",{createHTML:he=>he}),Ka=un?un.createHTML(""):"";class an{static filterUserAttributes(u){return lo(u,(v,M)=>{let z=!0;an.allowedAttributes.indexOf(M)===-1&&(z=!1),["background","dynsrc","href","lowsrc","src"].indexOf(M)!==-1&&(z=ao(v)&&an.allowedReferences.some(F=>v.indexOf(F)===0)),z||(to(33,!1,void 0,{"Invalid attribute in config":`${M}`}),delete u[M]),ao(v)&&u[M]&&(u[M]=v.replace(/</g,"&lt;"))}),u}static parseStyle(u){return u.split(";").reduce((v,M)=>{let z=M.split(":").map(V=>V.trim()),F=z.shift();return F&&z.length&&(v[F.replace(/-([a-z])/g,V=>V[1].toUpperCase())]=z.join(":")),v},{})}static setElementHTML(u,v){u.innerHTML=an.emptyHTML,v&&new an(v).addToDOM(u)}constructor(u){this.nodes=typeof u=="string"?this.parseMarkup(u):u}addToDOM(u){return function v(M,z){let F;return Oo(M).forEach(function(V){let G,Q=V.tagName,le=V.textContent?Pi.doc.createTextNode(V.textContent):void 0,ye=an.bypassHTMLFiltering;if(Q)if(Q==="#text")G=le;else if(an.allowedTags.indexOf(Q)!==-1||ye){let ce=Q==="svg"?mr:z.namespaceURI||mr,we=Pi.doc.createElementNS(ce,Q),Le=V.attributes||{};lo(V,function(Ue,et){et!=="tagName"&&et!=="attributes"&&et!=="children"&&et!=="style"&&et!=="textContent"&&(Le[et]=Ue)}),Rr(we,ye?Le:an.filterUserAttributes(Le)),V.style&&Ko(we,V.style),le&&we.appendChild(le),v(V.children||[],we),G=we}else to(33,!1,void 0,{"Invalid tagName in config":Q});G&&z.appendChild(G),F=G}),F}(this.nodes,u)}parseMarkup(u){let v,M=[];u=u.trim().replace(/ style=(["'])/g," data-style=$1");try{v=new DOMParser().parseFromString(un?un.createHTML(u):u,"text/html")}catch{}if(!v){let F=Ar("div");F.innerHTML=u,v={body:F}}let z=(F,V)=>{let G=F.nodeName.toLowerCase(),Q={tagName:G};G==="#text"&&(Q.textContent=F.textContent||"");let le=F.attributes;if(le){let ye={};[].forEach.call(le,ce=>{ce.name==="data-style"?Q.style=an.parseStyle(ce.value):ye[ce.name]=ce.value}),Q.attributes=ye}if(F.childNodes.length){let ye=[];[].forEach.call(F.childNodes,ce=>{z(ce,ye)}),ye.length&&(Q.children=ye)}V.push(Q)};return[].forEach.call(v.body.childNodes,F=>z(F,M)),M}}an.allowedAttributes=["alt","aria-controls","aria-describedby","aria-expanded","aria-haspopup","aria-hidden","aria-label","aria-labelledby","aria-live","aria-pressed","aria-readonly","aria-roledescription","aria-selected","class","clip-path","color","colspan","cx","cy","d","disabled","dx","dy","fill","filterUnits","flood-color","flood-opacity","height","href","id","in","in2","markerHeight","markerWidth","offset","opacity","operator","orient","padding","paddingLeft","paddingRight","patternUnits","r","radius","refX","refY","result","role","rowspan","scope","slope","src","startOffset","stdDeviation","stroke-linecap","stroke-width","stroke","style","summary","tabindex","tableValues","target","text-align","text-anchor","textAnchor","textLength","title","type","valign","width","x","x1","x2","xlink:href","y","y1","y2","zIndex"],an.allowedReferences=["https://","http://","mailto:","/","../","./","#"],an.allowedTags=["#text","a","abbr","b","br","button","caption","circle","clipPath","code","dd","defs","div","dl","dt","em","feComponentTransfer","feComposite","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feMerge","feMergeNode","feMorphology","feOffset","filter","h1","h2","h3","h4","h5","h6","hr","i","img","li","linearGradient","marker","ol","p","path","pattern","pre","rect","small","span","stop","strong","style","sub","sup","svg","table","tbody","td","text","textPath","th","thead","title","tr","tspan","u","ul"],an.emptyHTML=Ka,an.bypassHTMLFiltering=!1;let{defaultOptions:Il,defaultTime:Hh}=Za,{pageLang:Ua}=Pi,{extend:Xh,getNestedProperty:fp,isArray:Gn,isNumber:Yh,isObject:Sd,isString:Wd,pick:Wn,ucfirst:$u}=Qs,Ah={add:(he,u)=>he+u,divide:(he,u)=>u!==0?he/u:"",eq:(he,u)=>he==u,each:function(he){let u=arguments[arguments.length-1];return!!Gn(he)&&he.map((v,M)=>Kl(u.body,Xh(Sd(v)?v:{"@this":v},{"@index":M,"@first":M===0,"@last":M===he.length-1}))).join("")},ge:(he,u)=>he>=u,gt:(he,u)=>he>u,if:he=>!!he,le:(he,u)=>he<=u,lt:(he,u)=>he<u,multiply:(he,u)=>he*u,ne:(he,u)=>he!=u,subtract:(he,u)=>he-u,ucfirst:$u,unless:he=>!he},$h={},gh=he=>/^["'].+["']$/.test(he);function Kl(he="",u,v){var tt;let M=/\{([a-zA-Z\u00C0-\u017F\d:\.,;\-\/<>\[\]%_@+"'’= #\(\)]+)\}/g,z=/\(([a-zA-Z\u00C0-\u017F\d:\.,;\-\/<>\[\]%_@+"'= ]+)\)/g,F=[],V=/f$/,G=/\.(\d)/,Q=((tt=v==null?void 0:v.options)==null?void 0:tt.lang)||Il.lang,le=(v==null?void 0:v.time)||Hh,ye=(v==null?void 0:v.numberFormatter)||Qc.bind(v),ce=($e="")=>{let ht;return $e==="true"||$e!=="false"&&((ht=Number($e)).toString()===$e?ht:gh($e)?$e.slice(1,-1):fp($e,u))},we,Le,Ue=0,et;for(;(we=M.exec(he))!==null;){let $e=we,ht=z.exec(we[1]);ht&&(we=ht,et=!0),Le!=null&&Le.isBlock||(Le={ctx:u,expression:we[1],find:we[0],isBlock:we[1].charAt(0)==="#",start:we.index,startInner:we.index+we[0].length,length:we[0].length});let yt=(Le.isBlock?$e:we)[1].split(" ")[0].replace("#","");Ah[yt]&&(Le.isBlock&&yt===Le.fn&&Ue++,Le.fn||(Le.fn=yt));let ci=we[1]==="else";if(Le.isBlock&&Le.fn&&(we[1]===`/${Le.fn}`||ci))if(Ue)!ci&&Ue--;else{let ii=Le.startInner,ri=he.substr(ii,we.index-ii);Le.body===void 0?(Le.body=ri,Le.startInner=we.index+we[0].length):Le.elseBody=ri,Le.find+=ri+we[0],ci||(F.push(Le),Le=void 0)}else Le.isBlock||F.push(Le);if(ht&&!(Le!=null&&Le.isBlock))break}return F.forEach($e=>{let ht,yt,{body:ci,elseBody:ii,expression:ri,fn:Ri}=$e;if(Ri){let ki=[$e],Li=[],ls=ri.length,vs=0,Ys;for(yt=0;yt<=ls;yt++){let ks=ri.charAt(yt);Ys||ks!=='"'&&ks!=="'"?Ys===ks&&(Ys=""):Ys=ks,Ys||ks!==" "&&yt!==ls||(Li.push(ri.substr(vs,yt-vs)),vs=yt+1)}for(yt=Ah[Ri].length;yt--;)ki.unshift(ce(Li[yt+1]));ht=Ah[Ri].apply(u,ki),$e.isBlock&&typeof ht=="boolean"&&(ht=Kl(ht?ci:ii,u,v))}else{let ki=gh(ri)?[ri]:ri.split(":"),Li=(ht=ce(ki.shift()||""))%1!=0;if(typeof ht=="number"&&(ki.length||Li)){let ls=ki.join(":");if(V.test(ls)||Li){let vs=parseInt((ls.match(G)||["","-1"])[1],10);ht!==null&&(ht=ye(ht,vs,Q.decimalPoint,ls.indexOf(",")>-1?Q.thousandsSep:""))}else ht=le.dateFormat(ls,ht)}z.lastIndex=0,z.test($e.find)&&Wd(ht)&&(ht=`"${ht}"`)}he=he.replace($e.find,Wn(ht,""))}),et?Kl(he,u,v):he}function Qc(he,u,v,M){var et;u*=1;let z,F,[V,G]=(he=+he||0).toString().split("e").map(Number),Q=((et=this==null?void 0:this.options)==null?void 0:et.lang)||Il.lang,le=(he.toString().split(".")[1]||"").split("e")[0].length,ye=u,ce={};v??(v=Q.decimalPoint),M??(M=Q.thousandsSep),u===-1?u=Math.min(le,20):Yh(u)?u&&G<0&&((F=u+G)>=0?(V=+V.toExponential(F).split("e")[0],u=F):(V=Math.floor(V),he=u<20?+(V*Math.pow(10,G)).toFixed(u):0,G=0)):u=2,G&&(u??(u=2),he=V),Yh(u)&&u>=0&&(ce.minimumFractionDigits=u,ce.maximumFractionDigits=u),M===""&&(ce.useGrouping=!1);let we=M||v,Le=we?"en":(this==null?void 0:this.locale)||Q.locale||Ua,Ue=JSON.stringify(ce)+Le;return z=($h[Ue]??($h[Ue]=new Intl.NumberFormat(Le,ce))).format(he),we&&(z=z.replace(/([,\.])/g,"_$1").replace(/_\,/g,M??",").replace("_.",v??".")),(u||+z!=0)&&(!(G<0)||ye)||(z="0"),G&&+z!=0&&(z+="e"+(G<0?"":"+")+G),z}let Ma={dateFormat:function(he,u,v){return Hh.dateFormat(he,u,v)},format:Kl,helpers:Ah,numberFormat:Qc};(function(he){let u;he.rendererTypes={},he.getRendererType=function(v=u){return he.rendererTypes[v]||he.rendererTypes[u]},he.registerRendererType=function(v,M,z){he.rendererTypes[v]=M,(!u||z)&&(u=v,Pi.Renderer=M)}})(ni||(ni={}));let yn=ni,{clamp:Hd,pick:bl,pushUnique:qh,stableSort:Zh}=Qs;(Vi||(Vi={})).distribute=function he(u,v,M){let z=u,F=z.reducedLen||v,V=(yt,ci)=>yt.target-ci.target,G=[],Q=u.length,le=[],ye=G.push,ce,we,Le,Ue=!0,et,tt,$e=0,ht;for(ce=Q;ce--;)$e+=u[ce].size;if($e>F){for(Zh(u,(yt,ci)=>(ci.rank||0)-(yt.rank||0)),Le=(ht=u[0].rank===u[u.length-1].rank)?Q/2:-1,we=ht?Le:Q-1;Le&&$e>F;)et=u[ce=Math.floor(we)],qh(le,ce)&&($e-=et.size),we+=Le,ht&&we>=u.length&&(Le/=2,we=Le);le.sort((yt,ci)=>ci-yt).forEach(yt=>ye.apply(G,u.splice(yt,1)))}for(Zh(u,V),u=u.map(yt=>({size:yt.size,targets:[yt.target],align:bl(yt.align,.5)}));Ue;){for(ce=u.length;ce--;)et=u[ce],tt=(Math.min.apply(0,et.targets)+Math.max.apply(0,et.targets))/2,et.pos=Hd(tt-et.size*et.align,0,v-et.size);for(ce=u.length,Ue=!1;ce--;)ce>0&&u[ce-1].pos+u[ce-1].size>u[ce].pos&&(u[ce-1].size+=u[ce].size,u[ce-1].targets=u[ce-1].targets.concat(u[ce].targets),u[ce-1].align=.5,u[ce-1].pos+u[ce-1].size>v&&(u[ce-1].pos=v-u[ce-1].size),u.splice(ce,1),Ue=!0)}return ye.apply(z,G),ce=0,u.some(yt=>{let ci=0;return(yt.targets||[]).some(()=>(z[ce].pos=yt.pos+ci,M!==void 0&&Math.abs(z[ce].pos-z[ce].target)>M?(z.slice(0,ce+1).forEach(ii=>delete ii.pos),z.reducedLen=(z.reducedLen||v)-.1*v,z.reducedLen>.1*v&&he(z,v,M),!0):(ci+=z[ce].size,ce++,!1)))}),Zh(z,V),z};let fa=Vi,{animate:Xd,animObject:qu,stop:Ll}=Ws,{deg2rad:ja,doc:Bn,svg:kh,SVG_NS:Xl,win:mp,isFirefox:Dc}=Pi,{addEvent:Gr,attr:Eh,createElement:Su,crisp:Ch,css:cf,defined:ma,erase:Mu,extend:wl,fireEvent:ed,getAlignFactor:Yd,isArray:It,isFunction:Fi,isNumber:fs,isObject:Ir,isString:Ga,merge:xn,objectEach:Ol,pick:Ln,pInt:td,pushUnique:id,replaceNested:Au,syncTimeout:zc,uniqueKey:fl}=Qs;class Hn{_defaultGetter(u){let v=Ln(this[u+"Value"],this[u],this.element?this.element.getAttribute(u):null,0);return/^-?[\d\.]+$/.test(v)&&(v=parseFloat(v)),v}_defaultSetter(u,v,M){M.setAttribute(v,u)}add(u){let v,M=this.renderer,z=this.element;return u&&(this.parentGroup=u),this.textStr!==void 0&&this.element.nodeName==="text"&&M.buildText(this),this.added=!0,(!u||u.handleZ||this.zIndex)&&(v=this.zIndexSetter()),v||(u?u.element:M.box).appendChild(z),this.onAdd&&this.onAdd(),this}addClass(u,v){let M=v?"":this.attr("class")||"";return(u=(u||"").split(/ /g).reduce(function(z,F){return M.indexOf(F)===-1&&z.push(F),z},M?[M]:[]).join(" "))!==M&&this.attr("class",u),this}afterSetters(){this.doTransform&&(this.updateTransform(),this.doTransform=!1)}align(u,v,M,z=!0){let F=this.renderer,V=F.alignedObjects,G=!!u;u?(this.alignOptions=u,this.alignByTranslate=v,this.alignTo=M):(u=this.alignOptions||{},v=this.alignByTranslate,M=this.alignTo);let Q=!M||Ga(M)?M||"renderer":void 0;Q&&(G&&id(V,this),M=void 0);let le=Ln(M,F[Q],F),ye=(le.x||0)+(u.x||0)+((le.width||0)-(u.width||0))*Yd(u.align),ce=(le.y||0)+(u.y||0)+((le.height||0)-(u.height||0))*Yd(u.verticalAlign),we={"text-align":u==null?void 0:u.align};return we[v?"translateX":"x"]=Math.round(ye),we[v?"translateY":"y"]=Math.round(ce),z&&(this[this.placed?"animate":"attr"](we),this.placed=!0),this.alignAttr=we,this}alignSetter(u){let v={left:"start",center:"middle",right:"end"};v[u]&&(this.alignValue=u,this.element.setAttribute("text-anchor",v[u]))}animate(u,v,M){let z=qu(Ln(v,this.renderer.globalAnimation,!0)),F=z.defer;return Bn.hidden&&(z.duration=0),z.duration!==0?(M&&(z.complete=M),zc(()=>{this.element&&Xd(this,u,z)},F)):(this.attr(u,void 0,M||z.complete),Ol(u,function(V,G){z.step&&z.step.call(this,V,{prop:G,pos:1,elem:this})},this)),this}applyTextOutline(u){let v=this.element;u.indexOf("contrast")!==-1&&(u=u.replace(/contrast/g,this.renderer.getContrast(v.style.fill)));let M=u.indexOf(" "),z=u.substring(M+1),F=u.substring(0,M);if(F&&F!=="none"&&Pi.svg){this.fakeTS=!0,F=F.replace(/(^[\d\.]+)(.*?)$/g,function(ye,ce,we){return 2*Number(ce)+we}),this.removeTextOutline();let V=Bn.createElementNS(Xl,"tspan");Eh(V,{class:"highcharts-text-outline",fill:z,stroke:z,"stroke-width":F,"stroke-linejoin":"round"});let G=v.querySelector("textPath")||v;[].forEach.call(G.childNodes,ye=>{let ce=ye.cloneNode(!0);ce.removeAttribute&&["fill","stroke","stroke-width","stroke"].forEach(we=>ce.removeAttribute(we)),V.appendChild(ce)});let Q=0;[].forEach.call(G.querySelectorAll("text tspan"),ye=>{Q+=Number(ye.getAttribute("dy"))});let le=Bn.createElementNS(Xl,"tspan");le.textContent="​",Eh(le,{x:Number(v.getAttribute("x")),dy:-Q}),V.appendChild(le),G.insertBefore(V,G.firstChild)}}attr(u,v,M,z){let{element:F}=this,V=Hn.symbolCustomAttribs,G,Q,le=this,ye;return typeof u=="string"&&v!==void 0&&(G=u,(u={})[G]=v),typeof u=="string"?le=(this[u+"Getter"]||this._defaultGetter).call(this,u,F):(Ol(u,function(ce,we){ye=!1,z||Ll(this,we),this.symbolName&&V.indexOf(we)!==-1&&(Q||(this.symbolAttr(u),Q=!0),ye=!0),this.rotation&&(we==="x"||we==="y")&&(this.doTransform=!0),ye||(this[we+"Setter"]||this._defaultSetter).call(this,ce,we,F)},this),this.afterSetters()),M&&M.call(this),le}clip(u){if(u&&!u.clipPath){let v=fl()+"-",M=this.renderer.createElement("clipPath").attr({id:v}).add(this.renderer.defs);wl(u,{clipPath:M,id:v,count:0}),u.add(M)}return this.attr("clip-path",u?`url(${this.renderer.url}#${u.id})`:"none")}crisp(u,v){v=Math.round(v||u.strokeWidth||0);let M=u.x||this.x||0,z=u.y||this.y||0,F=(u.width||this.width||0)+M,V=(u.height||this.height||0)+z,G=Ch(M,v),Q=Ch(z,v);return wl(u,{x:G,y:Q,width:Ch(F,v)-G,height:Ch(V,v)-Q}),ma(u.strokeWidth)&&(u.strokeWidth=v),u}complexColor(u,v,M){let z=this.renderer,F,V,G,Q,le,ye,ce,we,Le,Ue,et=[],tt;ed(this.renderer,"complexColor",{args:arguments},function(){if(u.radialGradient?V="radialGradient":u.linearGradient&&(V="linearGradient"),V){if(G=u[V],le=z.gradients,ye=u.stops,Le=M.radialReference,It(G)&&(u[V]=G={x1:G[0],y1:G[1],x2:G[2],y2:G[3],gradientUnits:"userSpaceOnUse"}),V==="radialGradient"&&Le&&!ma(G.gradientUnits)&&(Q=G,G=xn(G,z.getRadialAttr(Le,Q),{gradientUnits:"userSpaceOnUse"})),Ol(G,function($e,ht){ht!=="id"&&et.push(ht,$e)}),Ol(ye,function($e){et.push($e)}),le[et=et.join(",")])Ue=le[et].attr("id");else{G.id=Ue=fl();let $e=le[et]=z.createElement(V).attr(G).add(z.defs);$e.radAttr=Q,$e.stops=[],ye.forEach(function(ht){ht[1].indexOf("rgba")===0?(ce=(F=lr.parse(ht[1])).get("rgb"),we=F.get("a")):(ce=ht[1],we=1);let yt=z.createElement("stop").attr({offset:ht[0],"stop-color":ce,"stop-opacity":we}).add($e);$e.stops.push(yt)})}tt="url("+z.url+"#"+Ue+")",M.setAttribute(v,tt),M.gradient=et,u.toString=function(){return tt}}})}css(u){let v=this.styles,M={},z=this.element,F,V=!v;if(v&&Ol(u,function(G,Q){v&&v[Q]!==G&&(M[Q]=G,V=!0)}),V){v&&(u=wl(v,M)),u.width===null||u.width==="auto"?delete this.textWidth:z.nodeName.toLowerCase()==="text"&&u.width&&(F=this.textWidth=td(u.width)),wl(this.styles,u),F&&!kh&&this.renderer.forExport&&delete u.width;let G=Dc&&u.fontSize||null;G&&(fs(G)||/^\d+$/.test(G))&&(u.fontSize+="px");let Q=xn(u);z.namespaceURI===this.SVG_NS&&(["textOutline","textOverflow","whiteSpace","width"].forEach(le=>Q&&delete Q[le]),Q.color&&(Q.fill=Q.color,delete Q.color)),cf(z,Q)}return this.added&&(this.element.nodeName==="text"&&this.renderer.buildText(this),u.textOutline&&this.applyTextOutline(u.textOutline)),this}dashstyleSetter(u){let v,M=this["stroke-width"];if(M==="inherit"&&(M=1),u){let z=(u=u.toLowerCase()).replace("shortdashdotdot","3,1,1,1,1,1,").replace("shortdashdot","3,1,1,1").replace("shortdot","1,1,").replace("shortdash","3,1,").replace("longdash","8,3,").replace(/dot/g,"1,3,").replace("dash","4,3,").replace(/,$/,"").split(",");for(v=z.length;v--;)z[v]=""+td(z[v])*Ln(M,NaN);u=z.join(",").replace(/NaN/g,"none"),this.element.setAttribute("stroke-dasharray",u)}}destroy(){let u=this,v=u.element||{},M=u.renderer,z=v.ownerSVGElement,F=v.nodeName==="SPAN"&&u.parentGroup||void 0,V,G;if(v.onclick=v.onmouseout=v.onmouseover=v.onmousemove=v.point=null,Ll(u),u.clipPath&&z){let Q=u.clipPath;[].forEach.call(z.querySelectorAll("[clip-path],[CLIP-PATH]"),function(le){le.getAttribute("clip-path").indexOf(Q.element.id)>-1&&le.removeAttribute("clip-path")}),u.clipPath=Q.destroy()}if(u.stops){for(G=0;G<u.stops.length;G++)u.stops[G].destroy();u.stops.length=0,u.stops=void 0}for(u.safeRemoveChild(v);F!=null&&F.div&&F.div.childNodes.length===0;)V=F.parentGroup,u.safeRemoveChild(F.div),delete F.div,F=V;u.alignOptions&&Mu(M.alignedObjects,u),Ol(u,(Q,le)=>{var ye,ce,we;(((ye=u[le])==null?void 0:ye.parentGroup)===u||["connector","foreignObject"].indexOf(le)!==-1)&&((we=(ce=u[le])==null?void 0:ce.destroy)==null||we.call(ce)),delete u[le]})}dSetter(u,v,M){It(u)&&(typeof u[0]=="string"&&(u=this.renderer.pathToSegments(u)),this.pathArray=u,u=u.reduce((z,F,V)=>F!=null&&F.join?(V?z+" ":"")+F.join(" "):(F||"").toString(),"")),/(NaN| {2}|^$)/.test(u)&&(u="M 0 0"),this[v]!==u&&(M.setAttribute(v,u),this[v]=u)}fillSetter(u,v,M){typeof u=="string"?M.setAttribute(v,u):u&&this.complexColor(u,v,M)}hrefSetter(u,v,M){M.setAttributeNS("http://www.w3.org/1999/xlink",v,u)}getBBox(u,v){let M,z,F,V,{alignValue:G,element:Q,renderer:le,styles:ye,textStr:ce}=this,{cache:we,cacheKeys:Le}=le,Ue=Q.namespaceURI===this.SVG_NS,et=Ln(v,this.rotation,0),tt=le.styledMode?Q&&Hn.prototype.getStyle.call(Q,"font-size"):ye.fontSize;if(ma(ce)&&((V=ce.toString()).indexOf("<")===-1&&(V=V.replace(/\d/g,"0")),V+=["",le.rootFontSize,tt,et,this.textWidth,G,ye.lineClamp,ye.textOverflow,ye.fontWeight].join(",")),V&&!u&&(M=we[V]),!M||M.polygon){if(Ue||le.forExport){try{F=this.fakeTS&&function(ht){let yt=Q.querySelector(".highcharts-text-outline");yt&&cf(yt,{display:ht})},Fi(F)&&F("none"),M=Q.getBBox?wl({},Q.getBBox()):{width:Q.offsetWidth,height:Q.offsetHeight,x:0,y:0},Fi(F)&&F("")}catch{}(!M||M.width<0)&&(M={x:0,y:0,width:0,height:0})}else M=this.htmlGetBBox();z=M.height,Ue&&(M.height=z={"11px,17":14,"13px,20":16}[`${tt||""},${Math.round(z)}`]||z),et&&(M=this.getRotatedBox(M,et));let $e={bBox:M};ed(this,"afterGetBBox",$e),M=$e.bBox}if(V&&(ce===""||M.height>0)){for(;Le.length>250;)delete we[Le.shift()];we[V]||Le.push(V),we[V]=M}return M}getRotatedBox(u,v){let{x:M,y:z,width:F,height:V}=u,{alignValue:G,translateY:Q,rotationOriginX:le=0,rotationOriginY:ye=0}=this,ce=Yd(G),we=Number(this.element.getAttribute("y")||0)-(Q?0:z),Le=v*ja,Ue=(v-90)*ja,et=Math.cos(Le),tt=Math.sin(Le),$e=F*et,ht=F*tt,yt=Math.cos(Ue),ci=Math.sin(Ue),[[ii,ri],[Ri,ki]]=[le,ye].map(Mn=>[Mn-Mn*et,Mn*tt]),Li=M+ce*(F-$e)+ii+ki+we*yt,ls=Li+$e,vs=ls-V*yt,Ys=vs-$e,ks=z+we-ce*ht-ri+Ri+we*ci,Lr=ks+ht,Cr=Lr-V*ci,Ur=Cr-ht,nr=Math.min(Li,ls,vs,Ys),Yr=Math.min(ks,Lr,Cr,Ur),En=Math.max(Li,ls,vs,Ys)-nr,Sn=Math.max(ks,Lr,Cr,Ur)-Yr;return{x:nr,y:Yr,width:En,height:Sn,polygon:[[Li,ks],[ls,Lr],[vs,Cr],[Ys,Ur]]}}getStyle(u){return mp.getComputedStyle(this.element||this,"").getPropertyValue(u)}hasClass(u){return(""+this.attr("class")).split(" ").indexOf(u)!==-1}hide(){return this.attr({visibility:"hidden"})}htmlGetBBox(){return{height:0,width:0,x:0,y:0}}constructor(u,v){this.onEvents={},this.opacity=1,this.SVG_NS=Xl,this.element=v==="span"||v==="body"?Su(v):Bn.createElementNS(this.SVG_NS,v),this.renderer=u,this.styles={},ed(this,"afterInit")}on(u,v){let{onEvents:M}=this;return M[u]&&M[u](),M[u]=Gr(this.element,u,v),this}opacitySetter(u,v,M){let z=Number(Number(u).toFixed(3));this.opacity=z,M.setAttribute(v,z)}reAlign(){var u;(u=this.alignOptions)!=null&&u.width&&this.alignOptions.align!=="left"&&(this.alignOptions.width=this.getBBox().width,this.placed=!1,this.align())}removeClass(u){return this.attr("class",(""+this.attr("class")).replace(Ga(u)?RegExp(`(^| )${u}( |$)`):u," ").replace(/ +/g," ").trim())}removeTextOutline(){let u=this.element.querySelector("tspan.highcharts-text-outline");u&&this.safeRemoveChild(u)}safeRemoveChild(u){let v=u.parentNode;v&&v.removeChild(u)}setRadialReference(u){let v=this.element.gradient&&this.renderer.gradients[this.element.gradient]||void 0;return this.element.radialReference=u,v!=null&&v.radAttr&&v.animate(this.renderer.getRadialAttr(u,v.radAttr)),this}shadow(u){var F;let{renderer:v}=this,M=xn(((F=this.parentGroup)==null?void 0:F.rotation)===90?{offsetX:-1,offsetY:-1}:{},Ir(u)?u:{}),z=v.shadowDefinition(M);return this.attr({filter:u?`url(${v.url}#${z})`:"none"})}show(u=!0){return this.attr({visibility:u?"inherit":"visible"})}"stroke-widthSetter"(u,v,M){this[v]=u,M.setAttribute(v,u)}strokeWidth(){if(!this.renderer.styledMode)return this["stroke-width"]||0;let u=this.getStyle("stroke-width"),v=0,M;return/px$/.test(u)?v=td(u):u!==""&&(Eh(M=Bn.createElementNS(Xl,"rect"),{width:u,"stroke-width":0}),this.element.parentNode.appendChild(M),v=M.getBBox().width,M.parentNode.removeChild(M)),v}symbolAttr(u){let v=this;Hn.symbolCustomAttribs.forEach(function(M){v[M]=Ln(u[M],v[M])}),v.attr({d:v.renderer.symbols[v.symbolName](v.x,v.y,v.width,v.height,v)})}textSetter(u){u!==this.textStr&&(delete this.textPxLength,this.textStr=u,this.added&&this.renderer.buildText(this),this.reAlign())}titleSetter(u){let v=this.element,M=v.getElementsByTagName("title")[0]||Bn.createElementNS(this.SVG_NS,"title");v.insertBefore?v.insertBefore(M,v.firstChild):v.appendChild(M),M.textContent=Au(Ln(u,""),[/<[^>]*>/g,""]).replace(/&lt;/g,"<").replace(/&gt;/g,">")}toFront(){let u=this.element;return u.parentNode.appendChild(u),this}translate(u,v){return this.attr({translateX:u,translateY:v})}updateTransform(u="transform"){let{element:v,foreignObject:M,matrix:z,padding:F,rotation:V=0,rotationOriginX:G,rotationOriginY:Q,scaleX:le,scaleY:ye,text:ce,translateX:we=0,translateY:Le=0}=this,Ue=["translate("+we+","+Le+")"];ma(z)&&Ue.push("matrix("+z.join(",")+")"),V&&(Ue.push("rotate("+V+" "+(G??v.getAttribute("x")??this.x??0)+" "+(Q??v.getAttribute("y")??this.y??0)+")"),(ce==null?void 0:ce.element.tagName)!=="SPAN"||ce!=null&&ce.foreignObject||ce.attr({rotation:V,rotationOriginX:(G||0)-F,rotationOriginY:(Q||0)-F})),(ma(le)||ma(ye))&&Ue.push("scale("+Ln(le,1)+" "+Ln(ye,1)+")"),Ue.length&&!(ce||this).textPath&&((M==null?void 0:M.element)||v).setAttribute(u,Ue.join(" "))}visibilitySetter(u,v,M){u==="inherit"?M.removeAttribute(v):this[v]!==u&&M.setAttribute(v,u),this[v]=u}xGetter(u){return this.element.nodeName==="circle"&&(u==="x"?u="cx":u==="y"&&(u="cy")),this._defaultGetter(u)}zIndexSetter(u,v){let M=this.renderer,z=this.parentGroup,F=(z||M).element||M.box,V=this.element,G=F===M.box,Q,le,ye,ce=!1,we,Le=this.added,Ue;if(ma(u)?(V.setAttribute("data-z-index",u),u*=1,this[v]===u&&(Le=!1)):ma(this[v])&&V.removeAttribute("data-z-index"),this[v]=u,Le){for((u=this.zIndex)&&z&&(z.handleZ=!0),Ue=(Q=F.childNodes).length-1;Ue>=0&&!ce;Ue--)we=!ma(ye=(le=Q[Ue]).getAttribute("data-z-index")),le!==V&&(u<0&&we&&!G&&!Ue?(F.insertBefore(V,Q[Ue]),ce=!0):(td(ye)<=u||we&&(!ma(u)||u>=0))&&(F.insertBefore(V,Q[Ue+1]),ce=!0));ce||(F.insertBefore(V,Q[3*!!G]),ce=!0)}return ce}}Hn.symbolCustomAttribs=["anchorX","anchorY","clockwise","end","height","innerR","r","start","width","x","y"],Hn.prototype.strokeSetter=Hn.prototype.fillSetter,Hn.prototype.yGetter=Hn.prototype.xGetter,Hn.prototype.matrixSetter=Hn.prototype.rotationOriginXSetter=Hn.prototype.rotationOriginYSetter=Hn.prototype.rotationSetter=Hn.prototype.scaleXSetter=Hn.prototype.scaleYSetter=Hn.prototype.translateXSetter=Hn.prototype.translateYSetter=Hn.prototype.verticalAlignSetter=function(he,u){this[u]=he,this.doTransform=!0};let hl=Hn,{defined:$d,extend:So,getAlignFactor:Dl,isNumber:Md,merge:Ja,pick:js,removeEvent:Np}=Qs;class lh extends hl{constructor(u,v,M,z,F,V,G,Q,le,ye){let ce;super(u,"g"),this.paddingLeftSetter=this.paddingSetter,this.paddingRightSetter=this.paddingSetter,this.doUpdate=!1,this.textStr=v,this.x=M,this.y=z,this.anchorX=V,this.anchorY=G,this.baseline=le,this.className=ye,this.addClass(ye==="button"?"highcharts-no-tooltip":"highcharts-label"),ye&&this.addClass("highcharts-"+ye),this.text=u.text(void 0,0,0,Q).attr({zIndex:1}),typeof F=="string"&&((ce=/^url\((.*?)\)$/.test(F))||this.renderer.symbols[F])&&(this.symbolKey=F),this.bBox=lh.emptyBBox,this.padding=3,this.baselineOffset=0,this.needsBox=u.styledMode||ce,this.deferredAttr={},this.alignFactor=0}alignSetter(u){let v=Dl(u);this.textAlign=u,v!==this.alignFactor&&(this.alignFactor=v,this.bBox&&Md(this.xSetting)&&this.attr({x:this.xSetting}))}anchorXSetter(u,v){this.anchorX=u,this.boxAttr(v,Math.round(u)-this.getCrispAdjust()-this.xSetting)}anchorYSetter(u,v){this.anchorY=u,this.boxAttr(v,u-this.ySetting)}boxAttr(u,v){this.box?this.box.attr(u,v):this.deferredAttr[u]=v}css(u){if(u){let v={};u=Ja(u),lh.textProps.forEach(M=>{u[M]!==void 0&&(v[M]=u[M],delete u[M])}),this.text.css(v),"fontSize"in v||"fontWeight"in v?this.updateTextPadding():("width"in v||"textOverflow"in v)&&this.updateBoxSize()}return hl.prototype.css.call(this,u)}destroy(){Np(this.element,"mouseenter"),Np(this.element,"mouseleave"),this.text&&this.text.destroy(),this.box&&(this.box=this.box.destroy()),hl.prototype.destroy.call(this)}fillSetter(u,v){u&&(this.needsBox=!0),this.fill=u,this.boxAttr(v,u)}getBBox(u,v){this.textStr&&this.bBox.width===0&&this.bBox.height===0&&this.updateBoxSize();let{padding:M,height:z=0,translateX:F=0,translateY:V=0,width:G=0}=this,Q=js(this.paddingLeft,M),le=v??(this.rotation||0),ye={width:G,height:z,x:F+this.bBox.x-Q,y:V+this.bBox.y-M+this.baselineOffset};return le&&(ye=this.getRotatedBox(ye,le)),ye}getCrispAdjust(){return(this.renderer.styledMode&&this.box?this.box.strokeWidth():this["stroke-width"]?parseInt(this["stroke-width"],10):0)%2/2}heightSetter(u){this.heightSetting=u,this.doUpdate=!0}afterSetters(){super.afterSetters(),this.doUpdate&&(this.updateBoxSize(),this.doUpdate=!1)}onAdd(){this.text.add(this),this.attr({text:js(this.textStr,""),x:this.x||0,y:this.y||0}),this.box&&$d(this.anchorX)&&this.attr({anchorX:this.anchorX,anchorY:this.anchorY})}paddingSetter(u,v){Md(u)?u!==this[v]&&(this[v]=u,this.updateTextPadding()):this[v]=void 0}rSetter(u,v){this.boxAttr(v,u)}strokeSetter(u,v){this.stroke=u,this.boxAttr(v,u)}"stroke-widthSetter"(u,v){u&&(this.needsBox=!0),this["stroke-width"]=u,this.boxAttr(v,u)}"text-alignSetter"(u){this.textAlign=this["text-align"]=u,this.updateTextPadding()}textSetter(u){u!==void 0&&this.text.attr({text:u}),this.updateTextPadding(),this.reAlign()}updateBoxSize(){let u,v=this.text,M={},z=this.padding,F=this.bBox=(!Md(this.widthSetting)||!Md(this.heightSetting)||this.textAlign)&&$d(v.textStr)?v.getBBox(void 0,0):lh.emptyBBox;this.width=this.getPaddedWidth(),this.height=(this.heightSetting||F.height||0)+2*z;let V=this.renderer.fontMetrics(v);if(this.baselineOffset=z+Math.min((this.text.firstLineMetrics||V).b,F.height||1/0),this.heightSetting&&(this.baselineOffset+=(this.heightSetting-V.h)/2),this.needsBox&&!v.textPath){if(!this.box){let G=this.box=this.symbolKey?this.renderer.symbol(this.symbolKey):this.renderer.rect();G.addClass((this.className==="button"?"":"highcharts-label-box")+(this.className?" highcharts-"+this.className+"-box":"")),G.add(this)}M.x=u=this.getCrispAdjust(),M.y=(this.baseline?-this.baselineOffset:0)+u,M.width=Math.round(this.width),M.height=Math.round(this.height),this.box.attr(So(M,this.deferredAttr)),this.deferredAttr={}}}updateTextPadding(){let u=this.text,v=u.styles.textAlign||this.textAlign;if(!u.textPath){this.updateBoxSize();let M=this.baseline?0:this.baselineOffset,z=(this.paddingLeft??this.padding)+Dl(v)*(this.widthSetting??this.bBox.width);(z!==u.x||M!==u.y)&&(u.attr({align:v,x:z}),M!==void 0&&u.attr("y",M)),u.x=z,u.y=M}}widthSetter(u){this.widthSetting=Md(u)?u:void 0,this.doUpdate=!0}getPaddedWidth(){let u=this.padding,v=js(this.paddingLeft,u),M=js(this.paddingRight,u);return(this.widthSetting||this.bBox.width||0)+v+M}xSetter(u){this.x=u,this.alignFactor&&(u-=this.alignFactor*this.getPaddedWidth(),this["forceAnimate:x"]=!0),this.xSetting=Math.round(u),this.attr("translateX",this.xSetting)}ySetter(u){this.ySetting=this.y=Math.round(u),this.attr("translateY",this.ySetting)}}lh.emptyBBox={width:0,height:0,x:0,y:0},lh.textProps=["color","direction","fontFamily","fontSize","fontStyle","fontWeight","lineClamp","lineHeight","textAlign","textDecoration","textOutline","textOverflow","whiteSpace","width"];let{defined:ga,isNumber:La,pick:yh}=Qs;function qd(he,u,v,M,z){let F=[];if(z){let V=z.start||0,G=z.end||0,Q=yh(z.r,v),le=yh(z.r,M||v),ye=2e-4/(z.borderRadius?1:Math.max(Q,1)),ce=Math.abs(G-V-2*Math.PI)<ye;ce&&(V=Math.PI/2,G=2.5*Math.PI-ye);let we=z.innerR,Le=yh(z.open,ce),Ue=Math.cos(V),et=Math.sin(V),tt=Math.cos(G),$e=Math.sin(G),ht=yh(z.longArc,G-V-Math.PI<ye?0:1),yt=["A",Q,le,0,ht,yh(z.clockwise,1),he+Q*tt,u+le*$e];yt.params={start:V,end:G,cx:he,cy:u},F.push(["M",he+Q*Ue,u+le*et],yt),ga(we)&&((yt=["A",we,we,0,ht,ga(z.clockwise)?1-z.clockwise:0,he+we*Ue,u+we*et]).params={start:G,end:V,cx:he,cy:u},F.push(Le?["M",he+we*tt,u+we*$e]:["L",he+we*tt,u+we*$e],yt)),Le||F.push(["Z"])}return F}function Ls(he,u,v,M,z){return z!=null&&z.r?Qr(he,u,v,M,z):[["M",he,u],["L",he+v,u],["L",he+v,u+M],["L",he,u+M],["Z"]]}function Qr(he,u,v,M,z){let F=(z==null?void 0:z.r)||0;return[["M",he+F,u],["L",he+v-F,u],["A",F,F,0,0,1,he+v,u+F],["L",he+v,u+M-F],["A",F,F,0,0,1,he+v-F,u+M],["L",he+F,u+M],["A",F,F,0,0,1,he,u+M-F],["L",he,u+F],["A",F,F,0,0,1,he+F,u],["Z"]]}let zo={arc:qd,callout:function(he,u,v,M,z){let F=Math.min((z==null?void 0:z.r)||0,v,M),V=F+6,G=z==null?void 0:z.anchorX,Q=(z==null?void 0:z.anchorY)||0,le=Qr(he,u,v,M,{r:F});if(!La(G)||G<v&&G>0&&Q<M&&Q>0)return le;if(he+G>v-V)if(Q>u+V&&Q<u+M-V)le.splice(3,1,["L",he+v,Q-6],["L",he+v+6,Q],["L",he+v,Q+6],["L",he+v,u+M-F]);else if(G<v){let ye=Q<u+V,ce=ye?u:u+M;le.splice(ye?2:5,0,["L",G,Q],["L",he+v-F,ce])}else le.splice(3,1,["L",he+v,M/2],["L",G,Q],["L",he+v,M/2],["L",he+v,u+M-F]);else if(he+G<V)if(Q>u+V&&Q<u+M-V)le.splice(7,1,["L",he,Q+6],["L",he-6,Q],["L",he,Q-6],["L",he,u+F]);else if(G>0){let ye=Q<u+V,ce=ye?u:u+M;le.splice(ye?1:6,0,["L",G,Q],["L",he+F,ce])}else le.splice(7,1,["L",he,M/2],["L",G,Q],["L",he,M/2],["L",he,u+F]);else Q>M&&G<v-V?le.splice(5,1,["L",G+6,u+M],["L",G,u+M+6],["L",G-6,u+M],["L",he+F,u+M]):Q<0&&G>V&&le.splice(1,1,["L",G-6,u],["L",G,u-6],["L",G+6,u],["L",v-F,u]);return le},circle:function(he,u,v,M){return qd(he+v/2,u+M/2,v/2,M/2,{start:.5*Math.PI,end:2.5*Math.PI,open:!1})},diamond:function(he,u,v,M){return[["M",he+v/2,u],["L",he+v,u+M/2],["L",he+v/2,u+M],["L",he,u+M/2],["Z"]]},rect:Ls,roundedRect:Qr,square:Ls,triangle:function(he,u,v,M){return[["M",he+v/2,u],["L",he+v,u+M],["L",he,u+M],["Z"]]},"triangle-down":function(he,u,v,M){return[["M",he,u],["L",he+v,u],["L",he+v/2,u+M],["Z"]]}},{doc:Jl,SVG_NS:Kh,win:ro}=Pi,{attr:ku,extend:Ph,fireEvent:gc,isString:Ba,objectEach:Xn,pick:Hf}=Qs,sd=(he,u)=>he.substring(0,u)+"…",Zd=class{constructor(he){let u=he.styles;this.renderer=he.renderer,this.svgElement=he,this.width=he.textWidth,this.textLineHeight=u==null?void 0:u.lineHeight,this.textOutline=u==null?void 0:u.textOutline,this.ellipsis=(u==null?void 0:u.textOverflow)==="ellipsis",this.lineClamp=u==null?void 0:u.lineClamp,this.noWrap=(u==null?void 0:u.whiteSpace)==="nowrap"}buildSVG(){let he=this.svgElement,u=he.element,v=he.renderer,M=Hf(he.textStr,"").toString(),z=M.indexOf("<")!==-1,F=u.childNodes,V=!he.added&&v.box,G=[M,this.ellipsis,this.noWrap,this.textLineHeight,this.textOutline,he.getStyle("font-size"),he.styles.lineClamp,this.width].join(",");if(G!==he.textCache){he.textCache=G,delete he.actualWidth;for(let Q=F.length;Q--;)u.removeChild(F[Q]);if(z||this.ellipsis||this.width||he.textPath||M.indexOf(" ")!==-1&&(!this.noWrap||/<br.*?>/g.test(M))){if(M!==""){V&&V.appendChild(u);let Q=new an(M);this.modifyTree(Q.nodes),Q.addToDOM(u),this.modifyDOM(),this.ellipsis&&(u.textContent||"").indexOf("…")!==-1&&he.attr("title",this.unescapeEntities(he.textStr||"",["&lt;","&gt;"])),V&&V.removeChild(u)}}else u.appendChild(Jl.createTextNode(this.unescapeEntities(M)));Ba(this.textOutline)&&he.applyTextOutline&&he.applyTextOutline(this.textOutline)}}modifyDOM(){let he,u=this.svgElement,v=ku(u.element,"x");for(u.firstLineMetrics=void 0;(he=u.element.firstChild)&&/^[\s\u200B]*$/.test(he.textContent||" ");)u.element.removeChild(he);[].forEach.call(u.element.querySelectorAll("tspan.highcharts-br"),(V,G)=>{V.nextSibling&&V.previousSibling&&(G===0&&V.previousSibling.nodeType===1&&(u.firstLineMetrics=u.renderer.fontMetrics(V.previousSibling)),ku(V,{dy:this.getLineHeight(V.nextSibling),x:v}))});let M=this.width||0;if(!M)return;let z=(V,G)=>{var et;let Q=V.textContent||"",le=Q.replace(/([^\^])-/g,"$1- ").split(" "),ye=!this.noWrap&&(le.length>1||u.element.childNodes.length>1),ce=this.getLineHeight(G),we=Math.max(0,M-.8*ce),Le=0,Ue=u.actualWidth;if(ye){let tt=[],$e=[];for(;G.firstChild&&G.firstChild!==V;)$e.push(G.firstChild),G.removeChild(G.firstChild);for(;le.length;)if(le.length&&!this.noWrap&&Le>0&&(tt.push(V.textContent||""),V.textContent=le.join(" ").replace(/- /g,"-")),this.truncate(V,void 0,le,Le===0&&Ue||0,M,we,(ht,yt)=>le.slice(0,yt).join(" ").replace(/- /g,"-")),Ue=u.actualWidth,Le++,this.lineClamp&&Le>=this.lineClamp){le.length&&(this.truncate(V,V.textContent||"",void 0,0,M,we,sd),V.textContent=((et=V.textContent)==null?void 0:et.replace("…",""))+"…");break}$e.forEach(ht=>{G.insertBefore(ht,V)}),tt.forEach(ht=>{G.insertBefore(Jl.createTextNode(ht),V);let yt=Jl.createElementNS(Kh,"tspan");yt.textContent="​",ku(yt,{dy:ce,x:v}),G.insertBefore(yt,V)})}else this.ellipsis&&Q&&this.truncate(V,Q,void 0,0,M,we,sd)},F=V=>{[].slice.call(V.childNodes).forEach(G=>{G.nodeType===ro.Node.TEXT_NODE?z(G,V):(G.className.baseVal.indexOf("highcharts-br")!==-1&&(u.actualWidth=0),F(G))})};F(u.element)}getLineHeight(he){let u=he.nodeType===ro.Node.TEXT_NODE?he.parentElement:he;return this.textLineHeight?parseInt(this.textLineHeight.toString(),10):this.renderer.fontMetrics(u||this.svgElement.element).h}modifyTree(he){let u=(v,M)=>{let{attributes:z={},children:F,style:V={},tagName:G}=v,Q=this.renderer.styledMode;if(G==="b"||G==="strong"?Q?z.class="highcharts-strong":V.fontWeight="bold":(G==="i"||G==="em")&&(Q?z.class="highcharts-emphasized":V.fontStyle="italic"),V!=null&&V.color&&(V.fill=V.color),G==="br"){z.class="highcharts-br",v.textContent="​";let le=he[M+1];le!=null&&le.textContent&&(le.textContent=le.textContent.replace(/^ +/gm,""))}else G==="a"&&F&&F.some(le=>le.tagName==="#text")&&(v.children=[{children:F,tagName:"tspan"}]);G!=="#text"&&G!=="a"&&(v.tagName="tspan"),Ph(v,{attributes:z,style:V}),F&&F.filter(le=>le.tagName!=="#text").forEach(u)};he.forEach(u),gc(this.svgElement,"afterModifyTree",{nodes:he})}truncate(he,u,v,M,z,F,V){let G,Q,le=this.svgElement,{rotation:ye}=le,ce=[],we=v&&!M?1:0,Le=(u||v||"").length,Ue=Le;v||(z=F);let et=function(tt,$e){let ht=$e||tt,yt=he.parentNode;if(yt&&ce[ht]===void 0&&yt.getSubStringLength)try{ce[ht]=M+yt.getSubStringLength(0,v?ht+1:ht)}catch{}return ce[ht]};if(le.rotation=0,M+(Q=et(he.textContent.length))>z){for(;we<=Le;)Ue=Math.ceil((we+Le)/2),v&&(G=V(v,Ue)),Q=et(Ue,G&&G.length-1),we===Le?we=Le+1:Q>z?Le=Ue-1:we=Ue;Le===0?he.textContent="":u&&Le===u.length-1||(he.textContent=G||V(u||v,Ue)),this.ellipsis&&Q>z&&this.truncate(he,he.textContent||"",void 0,0,z,F,sd)}v&&v.splice(0,Ue),le.actualWidth=Q,le.rotation=ye}unescapeEntities(he,u){return Xn(this.renderer.escapes,function(v,M){u&&u.indexOf(v)!==-1||(he=he.toString().replace(RegExp(v,"g"),M))}),he}},{defaultOptions:Vp}=Za,{charts:Kd,deg2rad:Tl,doc:Ad,isFirefox:Wa,isMS:Jd,isWebKit:cl,noop:gp,SVG_NS:Fr,symbolSizes:cs,win:Jh}=Pi,{addEvent:hr,attr:An,createElement:Qh,crisp:Zs,css:ec,defined:Ql,destroyObjectProperties:rd,extend:Rc,isArray:tc,isNumber:Qa,isObject:ic,isString:Aa,merge:df,pick:eh,pInt:zl,replaceNested:hh,uniqueKey:uf}=Qs;class Qd{constructor(u,v,M,z,F,V,G){let Q,le;this.x=0,this.y=0;let ye=this.createElement("svg").attr({version:"1.1",class:"highcharts-root"}),ce=ye.element;G||ye.css(this.getStyle(z||{})),u.appendChild(ce),An(u,"dir","ltr"),u.innerHTML.indexOf("xmlns")===-1&&An(ce,"xmlns",this.SVG_NS),this.box=ce,this.boxWrapper=ye,this.alignedObjects=[],this.url=this.getReferenceURL(),this.createElement("desc").add().element.appendChild(Ad.createTextNode("Created with Highcharts 12.3.0")),this.defs=this.createElement("defs").add(),this.allowHTML=V,this.forExport=F,this.styledMode=G,this.gradients={},this.cache={},this.cacheKeys=[],this.imgCount=0,this.rootFontSize=ye.getStyle("font-size"),this.setSize(v,M,!1),Wa&&u.getBoundingClientRect&&((Q=function(){ec(u,{left:0,top:0}),le=u.getBoundingClientRect(),ec(u,{left:Math.ceil(le.left)-le.left+"px",top:Math.ceil(le.top)-le.top+"px"})})(),this.unSubPixelFix=hr(Jh,"resize",Q))}definition(u){return new an([u]).addToDOM(this.defs.element)}getReferenceURL(){if((Wa||cl)&&Ad.getElementsByTagName("base").length){if(!Ql(Ht)){let u=uf(),v=new an([{tagName:"svg",attributes:{width:8,height:8},children:[{tagName:"defs",children:[{tagName:"clipPath",attributes:{id:u},children:[{tagName:"rect",attributes:{width:4,height:4}}]}]},{tagName:"rect",attributes:{id:"hitme",width:8,height:8,"clip-path":`url(#${u})`,fill:"rgba(0,0,0,0.001)"}}]}]).addToDOM(Ad.body);ec(v,{position:"fixed",top:0,left:0,zIndex:9e5});let M=Ad.elementFromPoint(6,6);Ht=(M==null?void 0:M.id)==="hitme",Ad.body.removeChild(v)}if(Ht)return hh(Jh.location.href.split("#")[0],[/<[^>]*>/g,""],[/([\('\)])/g,"\\$1"],[/ /g,"%20"])}return""}getStyle(u){return this.style=Rc({fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif',fontSize:"1rem"},u),this.style}setStyle(u){this.boxWrapper.css(this.getStyle(u))}isHidden(){return!this.boxWrapper.getBBox().width}destroy(){let u=this.defs;return this.box=null,this.boxWrapper=this.boxWrapper.destroy(),rd(this.gradients||{}),this.gradients=null,this.defs=u.destroy(),this.unSubPixelFix&&this.unSubPixelFix(),this.alignedObjects=null,null}createElement(u){return new this.Element(this,u)}getRadialAttr(u,v){return{cx:u[0]-u[2]/2+(v.cx||0)*u[2],cy:u[1]-u[2]/2+(v.cy||0)*u[2],r:(v.r||0)*u[2]}}shadowDefinition(u){let v=[`highcharts-drop-shadow-${this.chartIndex}`,...Object.keys(u).map(z=>`${z}-${u[z]}`)].join("-").toLowerCase().replace(/[^a-z\d\-]/g,""),M=df({color:"#000000",offsetX:1,offsetY:1,opacity:.15,width:5},u);return this.defs.element.querySelector(`#${v}`)||this.definition({tagName:"filter",attributes:{id:v,filterUnits:M.filterUnits},children:this.getShadowFilterContent(M)}),v}getShadowFilterContent(u){return[{tagName:"feDropShadow",attributes:{dx:u.offsetX,dy:u.offsetY,"flood-color":u.color,"flood-opacity":Math.min(5*u.opacity,1),stdDeviation:u.width/2}}]}buildText(u){new Zd(u).buildSVG()}getContrast(u){if(u==="transparent")return"#000000";let v=lr.parse(u).rgba,M=" clamp(0,calc(9e9*(0.5 - (0.2126*r + 0.7152*g + 0.0722*b))),1)";if(Qa(v[0])||!lr.useColorMix){let z=v.map(V=>{let G=V/255;return G<=.04?G/12.92:Math.pow((G+.055)/1.055,2.4)}),F=.2126*z[0]+.7152*z[1]+.0722*z[2];return 1.05/(F+.05)>(F+.05)/.05?"#FFFFFF":"#000000"}return"color(from "+u+" srgb"+M+M+M+")"}button(u,v,M,z,F={},V,G,Q,le,ye){let ce=this.label(u,v,M,le,void 0,void 0,ye,void 0,"button"),we=this.styledMode,Le=arguments,Ue=0;F=df(Vp.global.buttonTheme,F),we&&(delete F.fill,delete F.stroke,delete F["stroke-width"]);let et=F.states||{},tt=F.style||{};delete F.states,delete F.style;let $e=[an.filterUserAttributes(F)],ht=[tt];return we||["hover","select","disabled"].forEach((yt,ci)=>{$e.push(df($e[0],an.filterUserAttributes(Le[ci+5]||et[yt]||{}))),ht.push($e[ci+1].style),delete $e[ci+1].style}),hr(ce.element,Jd?"mouseover":"mouseenter",function(){Ue!==3&&ce.setState(1)}),hr(ce.element,Jd?"mouseout":"mouseleave",function(){Ue!==3&&ce.setState(Ue)}),ce.setState=(yt=0)=>{if(yt!==1&&(ce.state=Ue=yt),ce.removeClass(/highcharts-button-(normal|hover|pressed|disabled)/).addClass("highcharts-button-"+["normal","hover","pressed","disabled"][yt]),!we){ce.attr($e[yt]);let ci=ht[yt];ic(ci)&&ce.css(ci)}},ce.attr($e[0]),!we&&(ce.css(Rc({cursor:"default"},tt)),ye&&ce.text.css({pointerEvents:"none"})),ce.on("touchstart",yt=>yt.stopPropagation()).on("click",function(yt){Ue!==3&&(z==null||z.call(ce,yt))})}crispLine(u,v){let[M,z]=u;return Ql(M[1])&&M[1]===z[1]&&(M[1]=z[1]=Zs(M[1],v)),Ql(M[2])&&M[2]===z[2]&&(M[2]=z[2]=Zs(M[2],v)),u}path(u){let v=this.styledMode?{}:{fill:"none"};return tc(u)?v.d=u:ic(u)&&Rc(v,u),this.createElement("path").attr(v)}circle(u,v,M){let z=ic(u)?u:u===void 0?{}:{x:u,y:v,r:M},F=this.createElement("circle");return F.xSetter=F.ySetter=function(V,G,Q){Q.setAttribute("c"+G,V)},F.attr(z)}arc(u,v,M,z,F,V){let G;ic(u)?(v=(G=u).y,M=G.r,z=G.innerR,F=G.start,V=G.end,u=G.x):G={innerR:z,start:F,end:V};let Q=this.symbol("arc",u,v,M,M,G);return Q.r=M,Q}rect(u,v,M,z,F,V){let G=ic(u)?u:u===void 0?{}:{x:u,y:v,r:F,width:Math.max(M||0,0),height:Math.max(z||0,0)},Q=this.createElement("rect");return this.styledMode||(V!==void 0&&(G["stroke-width"]=V,Rc(G,Q.crisp(G))),G.fill="none"),Q.rSetter=function(le,ye,ce){Q.r=le,An(ce,{rx:le,ry:le})},Q.rGetter=function(){return Q.r||0},Q.attr(G)}roundedRect(u){return this.symbol("roundedRect").attr(u)}setSize(u,v,M){this.width=u,this.height=v,this.boxWrapper.animate({width:u,height:v},{step:function(){this.attr({viewBox:"0 0 "+this.attr("width")+" "+this.attr("height")})},duration:eh(M,!0)?void 0:0}),this.alignElements()}g(u){let v=this.createElement("g");return u?v.attr({class:"highcharts-"+u}):v}image(u,v,M,z,F,V){let G={preserveAspectRatio:"none"};Qa(v)&&(G.x=v),Qa(M)&&(G.y=M),Qa(z)&&(G.width=z),Qa(F)&&(G.height=F);let Q=this.createElement("image").attr(G),le=function(ye){Q.attr({href:u}),V.call(Q,ye)};if(V){Q.attr({href:"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="});let ye=new Jh.Image;hr(ye,"load",le),ye.src=u,ye.complete&&le({})}else Q.attr({href:u});return Q}symbol(u,v,M,z,F,V){var tt,$e;let G,Q,le,ye,ce=this,we=/^url\((.*?)\)$/,Le=we.test(u),Ue=!Le&&(this.symbols[u]?u:"circle"),et=Ue&&this.symbols[Ue];if(et)typeof v=="number"&&(Q=et.call(this.symbols,v||0,M||0,z||0,F||0,V)),G=this.path(Q),ce.styledMode||G.attr("fill","none"),Rc(G,{symbolName:Ue||void 0,x:v,y:M,width:z,height:F}),V&&Rc(G,V);else if(Le){le=u.match(we)[1];let ht=G=this.image(le);ht.imgwidth=eh(V==null?void 0:V.width,(tt=cs[le])==null?void 0:tt.width),ht.imgheight=eh(V==null?void 0:V.height,($e=cs[le])==null?void 0:$e.height),ye=yt=>yt.attr({width:yt.width,height:yt.height}),["width","height"].forEach(yt=>{ht[`${yt}Setter`]=function(ci,ii){this[ii]=ci;let{alignByTranslate:ri,element:Ri,width:ki,height:Li,imgwidth:ls,imgheight:vs}=this,Ys=ii==="width"?ls:vs,ks=1;V&&V.backgroundSize==="within"&&ki&&Li&&ls&&vs?(ks=Math.min(ki/ls,Li/vs),An(Ri,{width:Math.round(ls*ks),height:Math.round(vs*ks)})):Ri&&Ys&&Ri.setAttribute(ii,Ys),!ri&&ls&&vs&&this.translate(((ki||0)-ls*ks)/2,((Li||0)-vs*ks)/2)}}),Ql(v)&&ht.attr({x:v,y:M}),ht.isImg=!0,ht.symbolUrl=u,Ql(ht.imgwidth)&&Ql(ht.imgheight)?ye(ht):(ht.attr({width:0,height:0}),Qh("img",{onload:function(){let yt=Kd[ce.chartIndex];this.width===0&&(ec(this,{position:"absolute",top:"-999em"}),Ad.body.appendChild(this)),cs[le]={width:this.width,height:this.height},ht.imgwidth=this.width,ht.imgheight=this.height,ht.element&&ye(ht),this.parentNode&&this.parentNode.removeChild(this),ce.imgCount--,ce.imgCount||!yt||yt.hasLoaded||yt.onload()},src:le}),this.imgCount++)}return G}clipRect(u,v,M,z){return this.rect(u,v,M,z,0)}text(u,v,M,z){let F={};if(z&&(this.allowHTML||!this.forExport))return this.html(u,v,M);F.x=Math.round(v||0),M&&(F.y=Math.round(M)),Ql(u)&&(F.text=u);let V=this.createElement("text").attr(F);return z&&(!this.forExport||this.allowHTML)||(V.xSetter=function(G,Q,le){let ye=le.getElementsByTagName("tspan"),ce=le.getAttribute(Q);for(let we=0,Le;we<ye.length;we++)(Le=ye[we]).getAttribute(Q)===ce&&Le.setAttribute(Q,G);le.setAttribute(Q,G)}),V}fontMetrics(u){let v=zl(hl.prototype.getStyle.call(u,"font-size")||0),M=v<24?v+3:Math.round(1.2*v),z=Math.round(.8*M);return{h:M,b:z,f:v}}rotCorr(u,v,M){let z=u;return v&&M&&(z=Math.max(z*Math.cos(v*Tl),4)),{x:-u/3*Math.sin(v*Tl),y:z}}pathToSegments(u){let v=[],M=[],z={A:8,C:7,H:2,L:3,M:3,Q:5,S:5,T:3,V:2};for(let F=0;F<u.length;F++)Aa(M[0])&&Qa(u[F])&&M.length===z[M[0].toUpperCase()]&&u.splice(F,0,M[0].replace("M","L").replace("m","l")),typeof u[F]=="string"&&(M.length&&v.push(M.slice(0)),M.length=0),M.push(u[F]);return v.push(M.slice(0)),v}label(u,v,M,z,F,V,G,Q,le){return new lh(this,u,v,M,z,F,V,G,Q,le)}alignElements(){this.alignedObjects.forEach(u=>u.align())}}Rc(Qd.prototype,{Element:hl,SVG_NS:Fr,escapes:{"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},symbols:zo,draw:gp}),yn.registerRendererType("svg",Qd,!0);let{composed:eu,isFirefox:yc}=Pi,{attr:kd,css:xc,createElement:Xf,defined:Bc,extend:Am,getAlignFactor:Fc,isNumber:Eu,pInt:Nc,pushUnique:rg}=Qs;function Yf(he,u,v){var z;let M=(z=this.div)==null?void 0:z.style;hl.prototype[`${u}Setter`].call(this,he,u,v),M&&(v.style[u]=M[u]=he)}let yp=(he,u)=>{var v;if(!he.div){let M=kd(he.element,"class"),z=he.css,F=Xf("div",M?{className:M}:void 0,{position:"absolute",left:`${he.translateX||0}px`,top:`${he.translateY||0}px`,...he.styles,display:he.display,opacity:he.opacity,visibility:he.visibility},((v=he.parentGroup)==null?void 0:v.div)||u);he.classSetter=(V,G,Q)=>{Q.setAttribute("class",V),F.className=V},he.translateXSetter=he.translateYSetter=(V,G)=>{he[G]=V,F.style[G==="translateX"?"left":"top"]=`${V}px`,he.doTransform=!0},he.scaleXSetter=he.scaleYSetter=(V,G)=>{he[G]=V,he.doTransform=!0},he.opacitySetter=he.visibilitySetter=Yf,he.css=V=>(z.call(he,V),V.cursor&&(F.style.cursor=V.cursor),V.pointerEvents&&(F.style.pointerEvents=V.pointerEvents),he),he.on=function(){return hl.prototype.on.apply({element:F,onEvents:he.onEvents},arguments),he},he.div=F}return he.div};class sc extends hl{static compose(u){rg(eu,this.compose)&&(u.prototype.html=function(v,M,z){return new sc(this,"span").attr({text:v,x:Math.round(M),y:Math.round(z)})})}constructor(u,v){super(u,v),sc.useForeignObject?this.foreignObject=u.createElement("foreignObject").attr({zIndex:2}):this.css({position:"absolute",...u.styledMode?{}:{fontFamily:u.style.fontFamily,fontSize:u.style.fontSize}}),this.element.style.whiteSpace="nowrap"}getSpanCorrection(u,v,M){this.xCorr=-u*M,this.yCorr=-v}css(u){let v,{element:M}=this,z=M.tagName==="SPAN"&&u&&"width"in u,F=z&&u.width;return z&&(delete u.width,this.textWidth=Nc(F)||void 0,v=!0),(u==null?void 0:u.textOverflow)==="ellipsis"&&(u.overflow="hidden",u.whiteSpace="nowrap"),u!=null&&u.lineClamp&&(u.display="-webkit-box",u.WebkitLineClamp=u.lineClamp,u.WebkitBoxOrient="vertical",u.overflow="hidden"),Eu(Number(u==null?void 0:u.fontSize))&&(u.fontSize+="px"),Am(this.styles,u),xc(M,u),v&&this.updateTransform(),this}htmlGetBBox(){let{element:u}=this;return{x:u.offsetLeft,y:u.offsetTop,width:u.offsetWidth,height:u.offsetHeight}}updateTransform(){var ht;if(!this.added){this.alignOnAdd=!0;return}let{element:u,foreignObject:v,oldTextWidth:M,renderer:z,rotation:F,rotationOriginX:V,rotationOriginY:G,scaleX:Q,scaleY:le,styles:{display:ye="inline-block",whiteSpace:ce},textAlign:we="left",textWidth:Le,translateX:Ue=0,translateY:et=0,x:tt=0,y:$e=0}=this;if(v||xc(u,{marginLeft:`${Ue}px`,marginTop:`${et}px`}),u.tagName==="SPAN"){let yt,ci=[F,we,u.innerHTML,Le,this.textAlign].join(","),ii=-(((ht=this.parentGroup)==null?void 0:ht.padding)*1)||0;if(Le!==M){let Li=this.textPxLength?this.textPxLength:(xc(u,{width:"",whiteSpace:ce||"nowrap"}),u.offsetWidth),ls=Le||0,vs=u.style.textOverflow===""&&u.style.webkitLineClamp;(ls>M||Li>ls||vs)&&(/[\-\s\u00AD]/.test(u.textContent||u.innerText)||u.style.textOverflow==="ellipsis")&&(xc(u,{width:(F||Q||Li>ls||vs)&&Eu(Le)?Le+"px":"auto",display:ye,whiteSpace:ce||"normal"}),this.oldTextWidth=Le)}v&&(xc(u,{display:"inline-block",verticalAlign:"top"}),v.attr({width:z.width,height:z.height})),ci!==this.cTT&&(yt=z.fontMetrics(u).b,Bc(F)&&!v&&(F!==(this.oldRotation||0)||we!==this.oldAlign)&&xc(u,{transform:`rotate(${F}deg)`,transformOrigin:`${ii}% ${ii}px`}),this.getSpanCorrection(!Bc(F)&&!this.textWidth&&this.textPxLength||u.offsetWidth,yt,Fc(we)));let{xCorr:ri=0,yCorr:Ri=0}=this,ki={left:`${tt+ri}px`,top:`${$e+Ri}px`,textAlign:we,transformOrigin:`${(V??tt)-ri-tt-ii}px ${(G??$e)-Ri-$e-ii}px`};(Q||le)&&(ki.transform=`scale(${Q??1},${le??1})`),v?(super.updateTransform(),Eu(tt)&&Eu($e)?(v.attr({x:tt+ri,y:$e+Ri,width:u.offsetWidth+3,height:u.offsetHeight,"transform-origin":u.getAttribute("transform-origin")||"0 0"}),xc(u,{display:ye,textAlign:we})):yc&&v.attr({width:0,height:0})):xc(u,ki),this.cTT=ci,this.oldRotation=F,this.oldAlign=we}}add(u){let{foreignObject:v,renderer:M}=this,z=M.box.parentNode,F=[];if(v)v.add(u),super.add(M.createElement("body").attr({xmlns:"http://www.w3.org/1999/xhtml"}).css({background:"transparent",margin:"0 3px 0 0"}).add(v));else{let V;if(this.parentGroup=u,u&&!(V=u.div)){let G=u;for(;G;)F.push(G),G=G.parentGroup;for(let Q of F.reverse())V=yp(Q,z)}(V||z).appendChild(this.element)}return this.added=!0,this.alignOnAdd&&this.updateTransform(),this}textSetter(u){u!==this.textStr&&(delete this.bBox,delete this.oldTextWidth,an.setElementHTML(this.element,u??""),this.textStr=u,this.doTransform=!0)}alignSetter(u){this.alignValue=this.textAlign=u,this.doTransform=!0}xSetter(u,v){this[v]=u,this.doTransform=!0}}let Ed=sc.prototype;Ed.visibilitySetter=Ed.opacitySetter=Yf,Ed.ySetter=Ed.rotationSetter=Ed.rotationOriginXSetter=Ed.rotationOriginYSetter=Ed.xSetter,function(he){he.xAxis={alignTicks:!0,allowDecimals:void 0,panningEnabled:!0,zIndex:2,zoomEnabled:!0,dateTimeLabelFormats:{millisecond:{main:"%[HMSL]",range:!1},second:{main:"%[HMS]",range:!1},minute:{main:"%[HM]",range:!1},hour:{main:"%[HM]",range:!1},day:{main:"%[eb]"},week:{main:"%[eb]"},month:{main:"%[bY]"},year:{main:"%Y"}},endOnTick:!1,gridLineDashStyle:"Solid",gridZIndex:1,labels:{autoRotationLimit:80,distance:15,enabled:!0,indentation:10,overflow:"justify",reserveSpace:void 0,rotation:void 0,staggerLines:0,step:0,useHTML:!1,zIndex:7,style:{color:"#333333",cursor:"default",fontSize:"0.8em",textOverflow:"ellipsis"}},maxPadding:.01,minorGridLineDashStyle:"Solid",minorTickLength:2,minorTickPosition:"outside",minorTicksPerMajor:5,minPadding:.01,offset:void 0,reversed:void 0,reversedStacks:!1,showEmpty:!0,showFirstLabel:!0,showLastLabel:!0,startOfWeek:1,startOnTick:!1,tickLength:10,tickPixelInterval:100,tickmarkPlacement:"between",tickPosition:"outside",title:{align:"middle",useHTML:!1,x:0,y:0,style:{color:"#666666",fontSize:"0.8em"}},visible:!0,minorGridLineColor:"#f2f2f2",minorGridLineWidth:1,minorTickColor:"#999999",lineColor:"#333333",lineWidth:1,gridLineColor:"#e6e6e6",gridLineWidth:void 0,tickColor:"#333333"},he.yAxis={reversedStacks:!0,endOnTick:!0,maxPadding:.05,minPadding:.05,tickPixelInterval:72,showLastLabel:!0,labels:{x:void 0},startOnTick:!0,title:{},stackLabels:{animation:{},allowOverlap:!1,enabled:!1,crop:!0,overflow:"justify",formatter:function(){let{numberFormatter:u}=this.axis.chart;return u(this.total||0,-1)},style:{color:"#000000",fontSize:"0.7em",fontWeight:"bold",textOutline:"1px contrast"}},gridLineWidth:1,lineWidth:0}}(a||(a={}));let Up=a,{addEvent:$f,isFunction:qf,objectEach:Yl,removeEvent:tu}=Qs;(Ni||(Ni={})).registerEventOptions=function(he,u){he.eventOptions=he.eventOptions||{},Yl(u.events,function(v,M){he.eventOptions[M]!==v&&(he.eventOptions[M]&&(tu(he,M,he.eventOptions[M]),delete he.eventOptions[M]),qf(v)&&(he.eventOptions[M]=v,$f(he,M,v,{order:0})))})};let od=Ni,{deg2rad:jp}=Pi,{clamp:Cu,correctFloat:_c,defined:nd,destroyObjectProperties:pf,extend:ch,fireEvent:iu,getAlignFactor:ns,isNumber:Cd,merge:Pd,objectEach:Zu,pick:Ih}=Qs,Rl=class{constructor(he,u,v,M,z){this.isNew=!0,this.isNewLabel=!0,this.axis=he,this.pos=u,this.type=v||"",this.parameters=z||{},this.tickmarkOffset=this.parameters.tickmarkOffset,this.options=this.parameters.options,iu(this,"init"),v||M||this.addLabel()}addLabel(){var Ri,ki;let he=this,u=he.axis,v=u.options,M=u.chart,z=u.categories,F=u.logarithmic,V=u.names,G=he.pos,Q=Ih((Ri=he.options)==null?void 0:Ri.labels,v.labels),le=u.tickPositions,ye=G===le[0],ce=G===le[le.length-1],we=(!Q.step||Q.step===1)&&u.tickInterval===1,Le=le.info,Ue=he.label,et,tt,$e,ht=this.parameters.category||(z?Ih(z[G],V[G],G):G);F&&Cd(ht)&&(ht=_c(F.lin2log(ht))),u.dateTime&&(Le?et=(tt=M.time.resolveDTLFormat(v.dateTimeLabelFormats[!((ki=v.grid)!=null&&ki.enabled)&&Le.higherRanks[G]||Le.unitName])).main:Cd(ht)&&(et=u.dateTime.getXDateFormat(ht,v.dateTimeLabelFormats||{}))),he.isFirst=ye,he.isLast=ce;let yt={axis:u,chart:M,dateTimeLabelFormat:et,isFirst:ye,isLast:ce,pos:G,tick:he,tickPositionInfo:Le,value:ht};iu(this,"labelFormat",yt);let ci=Li=>Q.formatter?Q.formatter.call(Li,Li):Q.format?(Li.text=u.defaultLabelFormatter.call(Li),Ma.format(Q.format,Li,M)):u.defaultLabelFormatter.call(Li),ii=ci.call(yt,yt),ri=tt==null?void 0:tt.list;ri?he.shortenLabel=function(){for($e=0;$e<ri.length;$e++)if(ch(yt,{dateTimeLabelFormat:ri[$e]}),Ue.attr({text:ci.call(yt,yt)}),Ue.getBBox().width<u.getSlotWidth(he)-2*(Q.padding||0))return;Ue.attr({text:""})}:he.shortenLabel=void 0,we&&u._addedPlotLB&&he.moveLabel(ii,Q),nd(Ue)||he.movedLabel?Ue&&Ue.textStr!==ii&&!we&&(!Ue.textWidth||Q.style.width||Ue.styles.width||Ue.css({width:null}),Ue.attr({text:ii}),Ue.textPxLength=Ue.getBBox().width):(he.label=Ue=he.createLabel(ii,Q),he.rotation=0)}createLabel(he,u,v){let M=this.axis,{renderer:z,styledMode:F}=M.chart,V=u.style.whiteSpace,G=nd(he)&&u.enabled?z.text(he,v==null?void 0:v.x,v==null?void 0:v.y,u.useHTML).add(M.labelGroup):void 0;return G&&(F||G.css(Pd(u.style)),G.textPxLength=G.getBBox().width,!F&&V&&G.css({whiteSpace:V})),G}destroy(){pf(this,this.axis)}getPosition(he,u,v,M){let z=this.axis,F=z.chart,V=M&&F.oldChartHeight||F.chartHeight,G={x:he?_c(z.translate(u+v,void 0,void 0,M)+z.transB):z.left+z.offset+(z.opposite?(M&&F.oldChartWidth||F.chartWidth)-z.right-z.left:0),y:he?V-z.bottom+z.offset-(z.opposite?z.height:0):_c(V-z.translate(u+v,void 0,void 0,M)-z.transB)};return G.y=Cu(G.y,-1e9,1e9),iu(this,"afterGetPosition",{pos:G}),G}getLabelPosition(he,u,v,M,z,F,V,G){let Q,le,ye=this.axis,ce=ye.transA,we=ye.isLinked&&ye.linkedParent?ye.linkedParent.reversed:ye.reversed,Le=ye.staggerLines,Ue=ye.tickRotCorr||{x:0,y:0},et=M||ye.reserveSpaceDefault?0:-ye.labelOffset*(ye.labelAlign==="center"?.5:1),tt=z.distance,$e={};return Q=ye.side===0?v.rotation?-tt:-v.getBBox().height:ye.side===2?Ue.y+tt:Math.cos(v.rotation*jp)*(Ue.y-v.getBBox(!1,0).height/2),nd(z.y)&&(Q=ye.side===0&&ye.horiz?z.y+Q:z.y),he=he+Ih(z.x,[0,1,0,-1][ye.side]*tt)+et+Ue.x-(F&&M?F*ce*(we?-1:1):0),u=u+Q-(F&&!M?F*ce*(we?1:-1):0),Le&&(le=V/(G||1)%Le,ye.opposite&&(le=Le-le-1),u+=le*(ye.labelOffset/Le)),$e.x=he,$e.y=Math.round(u),iu(this,"afterGetLabelPosition",{pos:$e,tickmarkOffset:F,index:V}),$e}getLabelSize(){return this.label?this.label.getBBox()[this.axis.horiz?"height":"width"]:0}getMarkPath(he,u,v,M,z=!1,F){return F.crispLine([["M",he,u],["L",he+(z?0:-v),u+(z?v:0)]],M)}handleOverflow(he){var tt;let u=this.axis,v=u.options.labels,M=he.x,z=u.chart.chartWidth,F=u.chart.spacing,V=Ih(u.labelLeft,Math.min(u.pos,F[3])),G=Ih(u.labelRight,Math.max(u.isRadial?0:u.pos+u.len,z-F[1])),Q=this.label,le=this.rotation,ye=ns(u.labelAlign||Q.attr("align")),ce=Q.getBBox().width,we=u.getSlotWidth(this),Le=we,Ue=1,et;le||v.overflow!=="justify"?le<0&&M-ye*ce<V?et=Math.round(M/Math.cos(le*jp)-V):le>0&&M+ye*ce>G&&(et=Math.round((z-M)/Math.cos(le*jp))):(M-ye*ce<V?Le=he.x+Le*(1-ye)-V:M+(1-ye)*ce>G&&(Le=G-he.x+Le*ye,Ue=-1),(Le=Math.min(we,Le))<we&&u.labelAlign==="center"&&(he.x+=Ue*(we-Le-ye*(we-Math.min(ce,Le)))),(ce>Le||u.autoRotation&&((tt=Q==null?void 0:Q.styles)!=null&&tt.width))&&(et=Le)),et&&Q&&(this.shortenLabel?this.shortenLabel():Q.css(ch({},{width:Math.floor(et)+"px",lineClamp:+!u.isRadial})))}moveLabel(he,u){let v=this,M=v.label,z=v.axis,F=!1,V;M&&M.textStr===he?(v.movedLabel=M,F=!0,delete v.label):Zu(z.ticks,function(G){F||G.isNew||G===v||!G.label||G.label.textStr!==he||(v.movedLabel=G.label,F=!0,G.labelPos=v.movedLabel.xy,delete G.label)}),!F&&(v.labelPos||M)&&(V=v.labelPos||M.xy,v.movedLabel=v.createLabel(he,u,V),v.movedLabel&&v.movedLabel.attr({opacity:0}))}render(he,u,v){var Ue;let M=this.axis,z=M.horiz,F=this.pos,V=Ih(this.tickmarkOffset,M.tickmarkOffset),G=this.getPosition(z,F,V,u),Q=G.x,le=G.y,ye=M.pos,ce=ye+M.len,we=z?Q:le,Le=Ih(v,(Ue=this.label)==null?void 0:Ue.newOpacity,1);!M.chart.polar&&(_c(we)<ye||we>ce)&&(v=0),v??(v=1),this.isActive=!0,this.renderGridLine(u,v),this.renderMark(G,v),this.renderLabel(G,u,Le,he),this.isNew=!1,iu(this,"afterRender")}renderGridLine(he,u){let v=this.axis,M=v.options,z={},F=this.pos,V=this.type,G=Ih(this.tickmarkOffset,v.tickmarkOffset),Q=v.chart.renderer,le=this.gridLine,ye,ce=M.gridLineWidth,we=M.gridLineColor,Le=M.gridLineDashStyle;this.type==="minor"&&(ce=M.minorGridLineWidth,we=M.minorGridLineColor,Le=M.minorGridLineDashStyle),le||(v.chart.styledMode||(z.stroke=we,z["stroke-width"]=ce||0,z.dashstyle=Le),V||(z.zIndex=1),he&&(u=0),this.gridLine=le=Q.path().attr(z).addClass("highcharts-"+(V?V+"-":"")+"grid-line").add(v.gridGroup)),le&&(ye=v.getPlotLinePath({value:F+G,lineWidth:le.strokeWidth(),force:"pass",old:he,acrossPanes:!1}))&&le[he||this.isNew?"attr":"animate"]({d:ye,opacity:u})}renderMark(he,u){let v=this.axis,M=v.options,z=v.chart.renderer,F=this.type,V=v.tickSize(F?F+"Tick":"tick"),G=he.x,Q=he.y,le=Ih(M[F!=="minor"?"tickWidth":"minorTickWidth"],!F&&v.isXAxis?1:0),ye=M[F!=="minor"?"tickColor":"minorTickColor"],ce=this.mark,we=!ce;V&&(v.opposite&&(V[0]=-V[0]),!ce&&(this.mark=ce=z.path().addClass("highcharts-"+(F?F+"-":"")+"tick").add(v.axisGroup),v.chart.styledMode||ce.attr({stroke:ye,"stroke-width":le})),ce[we?"attr":"animate"]({d:this.getMarkPath(G,Q,V[0],ce.strokeWidth(),v.horiz,z),opacity:u}))}renderLabel(he,u,v,M){let z=this.axis,F=z.horiz,V=z.options,G=this.label,Q=V.labels,le=Q.step,ye=Ih(this.tickmarkOffset,z.tickmarkOffset),ce=he.x,we=he.y,Le=!0;G&&Cd(ce)&&(G.xy=he=this.getLabelPosition(ce,we,G,F,Q,ye,M,le),(!this.isFirst||this.isLast||V.showFirstLabel)&&(!this.isLast||this.isFirst||V.showLastLabel)?!F||Q.step||Q.rotation||u||v===0||this.handleOverflow(he):Le=!1,le&&M%le&&(Le=!1),Le&&Cd(he.y)?(he.opacity=v,G[this.isNewLabel?"attr":"animate"](he).show(!0),this.isNewLabel=!1):(G.hide(),this.isNewLabel=!0))}replaceMovedLabel(){let he=this.label,u=this.axis;he&&!this.isNew&&(he.animate({opacity:0},void 0,he.destroy),delete this.label),u.isDirty=!0,this.label=this.movedLabel,delete this.movedLabel}},{animObject:vc}=Ws,{xAxis:bc,yAxis:xh}=Up,{defaultOptions:jr}=Za,{registerEventOptions:rc}=od,{deg2rad:Pu}=Pi,{arrayMax:ff,arrayMin:mf,clamp:ad,correctFloat:ho,defined:ka,destroyObjectProperties:Zf,erase:km,error:su,extend:Gp,fireEvent:vn,getClosestDistance:ea,insertItem:Vc,isArray:Uc,isNumber:Dr,isString:Un,merge:ln,normalizeTickInterval:oc,objectEach:Iu,pick:yo,relativeLength:sr,removeEvent:nc,splat:Id,syncTimeout:ru}=Qs,Hr=(he,u)=>oc(u,void 0,void 0,yo(he.options.allowDecimals,u<.5||he.tickAmount!==void 0),!!he.tickAmount);Gp(jr,{xAxis:bc,yAxis:ln(bc,xh)});class vo{constructor(u,v,M){this.init(u,v,M)}init(u,v,M=this.coll){let z=M==="xAxis",F=this.isZAxis||(u.inverted?!z:z);this.chart=u,this.horiz=F,this.isXAxis=z,this.coll=M,vn(this,"init",{userOptions:v}),this.opposite=yo(v.opposite,this.opposite),this.side=yo(v.side,this.side,F?2*!this.opposite:this.opposite?1:3),this.setOptions(v);let V=this.options,G=V.labels;this.type??(this.type=V.type||"linear"),this.uniqueNames??(this.uniqueNames=V.uniqueNames??!0),vn(this,"afterSetType"),this.userOptions=v,this.minPixelPadding=0,this.reversed=yo(V.reversed,this.reversed),this.visible=V.visible,this.zoomEnabled=V.zoomEnabled,this.hasNames=this.type==="category"||V.categories===!0,this.categories=Uc(V.categories)&&V.categories||(this.hasNames?[]:void 0),this.names||(this.names=[],this.names.keys={}),this.plotLinesAndBandsGroups={},this.positiveValuesOnly=!!this.logarithmic,this.isLinked=ka(V.linkedTo),this.ticks={},this.labelEdge=[],this.minorTicks={},this.plotLinesAndBands=[],this.alternateBands={},this.len??(this.len=0),this.minRange=this.userMinRange=V.minRange||V.maxZoom,this.range=V.range,this.offset=V.offset||0,this.max=void 0,this.min=void 0;let Q=yo(V.crosshair,Id(u.options.tooltip.crosshairs)[+!z]);this.crosshair=Q===!0?{}:Q,u.axes.indexOf(this)===-1&&(z?u.axes.splice(u.xAxis.length,0,this):u.axes.push(this),Vc(this,u[this.coll])),u.orderItems(this.coll),this.series=this.series||[],u.inverted&&!this.isZAxis&&z&&!ka(this.reversed)&&(this.reversed=!0),this.labelRotation=Dr(G.rotation)?G.rotation:void 0,rc(this,V),vn(this,"afterInit")}setOptions(u){let v=this.horiz?{labels:{autoRotation:[-45],padding:3},margin:15}:{labels:{padding:1},title:{rotation:90*this.side}};this.options=ln(v,this.coll==="yAxis"?{title:{text:this.chart.options.lang.yAxisTitle}}:{},jr[this.coll],u),vn(this,"afterSetOptions",{userOptions:u})}defaultLabelFormatter(){let u=this.axis,{numberFormatter:v}=this.chart,M=Dr(this.value)?this.value:NaN,z=u.chart.time,F=u.categories,V=this.dateTimeLabelFormat,G=jr.lang,Q=G.numericSymbols,le=G.numericSymbolMagnitude||1e3,ye=u.logarithmic?Math.abs(M):u.tickInterval,ce=Q==null?void 0:Q.length,we,Le;if(F)Le=`${this.value}`;else if(V)Le=z.dateFormat(V,M,!0);else if(ce&&Q&&ye>=1e3)for(;ce--&&Le===void 0;)ye>=(we=Math.pow(le,ce+1))&&10*M%we==0&&Q[ce]!==null&&M!==0&&(Le=v(M/we,-1)+Q[ce]);return Le===void 0&&(Le=Math.abs(M)>=1e4?v(M,-1):v(M,-1,void 0,"")),Le}getSeriesExtremes(){let u,v=this;vn(this,"getSeriesExtremes",null,function(){v.hasVisibleSeries=!1,v.dataMin=v.dataMax=v.threshold=void 0,v.softThreshold=!v.isXAxis,v.series.forEach(M=>{if(M.reserveSpace()){let z=M.options,F,V=z.threshold,G,Q;if(v.hasVisibleSeries=!0,v.positiveValuesOnly&&0>=(V||0)&&(V=void 0),v.isXAxis)(F=M.getColumn("x")).length&&(F=v.logarithmic?F.filter(le=>le>0):F,G=(u=M.getXExtremes(F)).min,Q=u.max,Dr(G)||G instanceof Date||(F=F.filter(Dr),G=(u=M.getXExtremes(F)).min,Q=u.max),F.length&&(v.dataMin=Math.min(yo(v.dataMin,G),G),v.dataMax=Math.max(yo(v.dataMax,Q),Q)));else{let le=M.applyExtremes();Dr(le.dataMin)&&(G=le.dataMin,v.dataMin=Math.min(yo(v.dataMin,G),G)),Dr(le.dataMax)&&(Q=le.dataMax,v.dataMax=Math.max(yo(v.dataMax,Q),Q)),ka(V)&&(v.threshold=V),(!z.softThreshold||v.positiveValuesOnly)&&(v.softThreshold=!1)}}})}),vn(this,"afterGetSeriesExtremes")}translate(u,v,M,z,F,V){var et;let G=this.linkedParent||this,Q=z&&G.old?G.old.min:G.min;if(!Dr(Q))return NaN;let le=G.minPixelPadding,ye=(G.isOrdinal||((et=G.brokenAxis)==null?void 0:et.hasBreaks)||G.logarithmic&&F)&&G.lin2val,ce=1,we=0,Le=z&&G.old?G.old.transA:G.transA,Ue=0;return Le||(Le=G.transA),M&&(ce*=-1,we=G.len),G.reversed&&(ce*=-1,we-=ce*(G.sector||G.len)),v?(Ue=(u=u*ce+we-le)/Le+Q,ye&&(Ue=G.lin2val(Ue))):(ye&&(u=G.val2lin(u)),Ue=ce*(u-Q)*Le+we+ce*le+(Dr(V)?Le*V:0),G.isRadial||(Ue=ho(Ue))),Ue}toPixels(u,v){var M;return this.translate(((M=this.chart)==null?void 0:M.time.parse(u))??NaN,!1,!this.horiz,void 0,!0)+(v?0:this.pos)}toValue(u,v){return this.translate(u-(v?0:this.pos),!0,!this.horiz,void 0,!0)}getPlotLinePath(u){let v=this,M=v.chart,z=v.left,F=v.top,V=u.old,G=u.value,Q=u.lineWidth,le=V&&M.oldChartHeight||M.chartHeight,ye=V&&M.oldChartWidth||M.chartWidth,ce=v.transB,we=u.translatedValue,Le=u.force,Ue,et,tt,$e,ht;function yt(ii,ri,Ri){return Le!=="pass"&&(ii<ri||ii>Ri)&&(Le?ii=ad(ii,ri,Ri):ht=!0),ii}let ci={value:G,lineWidth:Q,old:V,force:Le,acrossPanes:u.acrossPanes,translatedValue:we};return vn(this,"getPlotLinePath",ci,function(ii){Ue=tt=(we=ad(we=yo(we,v.translate(G,void 0,void 0,V)),-1e9,1e9))+ce,et=$e=le-we-ce,Dr(we)?v.horiz?(et=F,$e=le-v.bottom+(v.options.isInternal?0:M.scrollablePixelsY||0),Ue=tt=yt(Ue,z,z+v.width)):(Ue=z,tt=ye-v.right+(M.scrollablePixelsX||0),et=$e=yt(et,F,F+v.height)):(ht=!0,Le=!1),ii.path=ht&&!Le?void 0:M.renderer.crispLine([["M",Ue,et],["L",tt,$e]],Q||1)}),ci.path}getLinearTickPositions(u,v,M){let z,F,V,G=ho(Math.floor(v/u)*u),Q=ho(Math.ceil(M/u)*u),le=[];if(ho(G+u)===G&&(V=20),this.single)return[v];for(z=G;z<=Q&&(le.push(z),(z=ho(z+u,V))!==F);)F=z;return le}getMinorTickInterval(){let{minorTicks:u,minorTickInterval:v}=this.options;return u===!0?yo(v,"auto"):u!==!1?v:void 0}getMinorTickPositions(){var ye;let u=this.options,v=this.tickPositions,M=this.minorTickInterval,z=this.pointRangePadding||0,F=(this.min||0)-z,V=(this.max||0)+z,G=(ye=this.brokenAxis)!=null&&ye.hasBreaks?this.brokenAxis.unitLength:V-F,Q=[],le;if(G&&G/M<this.len/3){let ce=this.logarithmic;if(ce)this.paddedTicks.forEach(function(we,Le,Ue){Le&&Q.push.apply(Q,ce.getLogTickPositions(M,Ue[Le-1],Ue[Le],!0))});else if(this.dateTime&&this.getMinorTickInterval()==="auto")Q=Q.concat(this.getTimeTicks(this.dateTime.normalizeTimeTickInterval(M),F,V,u.startOfWeek));else for(le=F+(v[0]-F)%M;le<=V&&le!==Q[0];le+=M)Q.push(le)}return Q.length!==0&&this.trimTicks(Q),Q}adjustForMinRange(){let u=this.options,v=this.logarithmic,M=this.chart.time,{max:z,min:F,minRange:V}=this,G,Q,le,ye;this.isXAxis&&V===void 0&&!v&&(V=ka(u.min)||ka(u.max)||ka(u.floor)||ka(u.ceiling)?null:Math.min(5*(ea(this.series.map(ce=>{let we=ce.getColumn("x");return ce.xIncrement?we.slice(0,2):we}))||0),this.dataMax-this.dataMin)),Dr(z)&&Dr(F)&&Dr(V)&&z-F<V&&(Q=this.dataMax-this.dataMin>=V,G=(V-z+F)/2,le=[F-G,M.parse(u.min)??F-G],Q&&(le[2]=v?v.log2lin(this.dataMin):this.dataMin),ye=[(F=ff(le))+V,M.parse(u.max)??F+V],Q&&(ye[2]=v?v.log2lin(this.dataMax):this.dataMax),(z=mf(ye))-F<V&&(le[0]=z-V,le[1]=M.parse(u.min)??z-V,F=ff(le))),this.minRange=V,this.min=F,this.max=z}getClosest(){let u,v;if(this.categories)v=1;else{let M=[];this.series.forEach(function(z){let F=z.closestPointRange,V=z.getColumn("x");V.length===1?M.push(V[0]):z.sorted&&ka(F)&&z.reserveSpace()&&(v=ka(v)?Math.min(v,F):F)}),M.length&&(M.sort((z,F)=>z-F),u=ea([M]))}return u&&v?Math.min(u,v):u||v}nameToX(u){let v=Uc(this.options.categories),M=v?this.categories:this.names,z=u.options.x,F;return u.series.requireSorting=!1,ka(z)||(z=this.uniqueNames&&M?v?M.indexOf(u.name):yo(M.keys[u.name],-1):u.series.autoIncrement()),z===-1?!v&&M&&(F=M.length):Dr(z)&&(F=z),F!==void 0?(this.names[F]=u.name,this.names.keys[u.name]=F):u.x&&(F=u.x),F}updateNames(){let u=this,v=this.names;v.length>0&&(Object.keys(v.keys).forEach(function(M){delete v.keys[M]}),v.length=0,this.minRange=this.userMinRange,(this.series||[]).forEach(M=>{M.xIncrement=null,(!M.points||M.isDirtyData)&&(u.max=Math.max(u.max||0,M.dataTable.rowCount-1),M.processData(),M.generatePoints());let z=M.getColumn("x").slice();M.data.forEach((F,V)=>{let G=z[V];F!=null&&F.options&&F.name!==void 0&&(G=u.nameToX(F))!==void 0&&G!==F.x&&(z[V]=F.x=G)}),M.dataTable.setColumn("x",z)}))}setAxisTranslation(){var we;let u=this,v=u.max-u.min,M=u.linkedParent,z=!!u.categories,F=u.isXAxis,V=u.axisPointRange||0,G,Q=0,le=0,ye,ce=u.transA;(F||z||V)&&(G=u.getClosest(),M?(Q=M.minPointOffset,le=M.pointRangePadding):u.series.forEach(function(Le){let Ue=z?1:F?yo(Le.options.pointRange,G,0):u.axisPointRange||0,et=Le.options.pointPlacement;if(V=Math.max(V,Ue),!u.single||z){let tt=Le.is("xrange")?!F:F;Q=Math.max(Q,tt&&Un(et)?0:Ue/2),le=Math.max(le,tt&&et==="on"?0:Ue)}}),ye=(we=u.ordinal)!=null&&we.slope&&G?u.ordinal.slope/G:1,u.minPointOffset=Q*=ye,u.pointRangePadding=le*=ye,u.pointRange=Math.min(V,u.single&&z?1:v),F&&(u.closestPointRange=G)),u.translationSlope=u.transA=ce=u.staticScale||u.len/(v+le||1),u.transB=u.horiz?u.left:u.bottom,u.minPixelPadding=ce*Q,vn(this,"afterSetAxisTranslation")}minFromRange(){let{max:u,min:v}=this;return Dr(u)&&Dr(v)&&u-v||void 0}setTickInterval(u){var Cr,Ur,nr,Yr;let{categories:v,chart:M,dataMax:z,dataMin:F,dateTime:V,isXAxis:G,logarithmic:Q,options:le,softThreshold:ye}=this,ce=M.time,we=Dr(this.threshold)?this.threshold:void 0,Le=this.minRange||0,{ceiling:Ue,floor:et,linkedTo:tt,softMax:$e,softMin:ht}=le,yt=Dr(tt)&&((Cr=M[this.coll])==null?void 0:Cr[tt]),ci=le.tickPixelInterval,ii=le.maxPadding,ri=le.minPadding,Ri=0,ki,Li=Dr(le.tickInterval)&&le.tickInterval>=0?le.tickInterval:void 0,ls,vs,Ys,ks;if(V||v||yt||this.getTickAmount(),Ys=yo(this.userMin,ce.parse(le.min)),ks=yo(this.userMax,ce.parse(le.max)),yt?(this.linkedParent=yt,ki=yt.getExtremes(),this.min=yo(ki.min,ki.dataMin),this.max=yo(ki.max,ki.dataMax),this.type!==yt.type&&su(11,!0,M)):(ye&&ka(we)&&Dr(z)&&Dr(F)&&(F>=we?(ls=we,ri=0):z<=we&&(vs=we,ii=0)),this.min=yo(Ys,ls,F),this.max=yo(ks,vs,z)),Dr(this.max)&&Dr(this.min)&&(Q&&(this.positiveValuesOnly&&!u&&0>=Math.min(this.min,yo(F,this.min))&&su(10,!0,M),this.min=ho(Q.log2lin(this.min),16),this.max=ho(Q.log2lin(this.max),16)),this.range&&Dr(F)&&(this.userMin=this.min=Ys=Math.max(F,this.minFromRange()||0),this.userMax=ks=this.max,this.range=void 0)),vn(this,"foundExtremes"),this.adjustForMinRange(),Dr(this.min)&&Dr(this.max)){if(!Dr(this.userMin)&&Dr(ht)&&ht<this.min&&(this.min=Ys=ht),!Dr(this.userMax)&&Dr($e)&&$e>this.max&&(this.max=ks=$e),v||this.axisPointRange||(Ur=this.stacking)!=null&&Ur.usePercentage||yt||(Ri=this.max-this.min)&&(!ka(Ys)&&ri&&(this.min-=Ri*ri),!ka(ks)&&ii&&(this.max+=Ri*ii)),!Dr(this.userMin)&&Dr(et)&&(this.min=Math.max(this.min,et)),!Dr(this.userMax)&&Dr(Ue)&&(this.max=Math.min(this.max,Ue)),ye&&Dr(F)&&Dr(z)){let En=we||0;!ka(Ys)&&this.min<En&&F>=En?this.min=le.minRange?Math.min(En,this.max-Le):En:!ka(ks)&&this.max>En&&z<=En&&(this.max=le.minRange?Math.max(En,this.min+Le):En)}!M.polar&&this.min>this.max&&(ka(le.min)?this.max=this.min:ka(le.max)&&(this.min=this.max)),Ri=this.max-this.min}if(this.min!==this.max&&Dr(this.min)&&Dr(this.max)?yt&&!Li&&ci===yt.options.tickPixelInterval?this.tickInterval=Li=yt.tickInterval:this.tickInterval=yo(Li,this.tickAmount?Ri/Math.max(this.tickAmount-1,1):void 0,v?1:Ri*ci/Math.max(this.len,ci)):this.tickInterval=1,G&&!u){let En=this.min!==((nr=this.old)==null?void 0:nr.min)||this.max!==((Yr=this.old)==null?void 0:Yr.max);this.series.forEach(function(Sn){var Mn;Sn.forceCrop=(Mn=Sn.forceCropping)==null?void 0:Mn.call(Sn),Sn.processData(En)}),vn(this,"postProcessData",{hasExtremesChanged:En})}this.setAxisTranslation(),vn(this,"initialAxisTranslation"),this.pointRange&&!Li&&(this.tickInterval=Math.max(this.pointRange,this.tickInterval));let Lr=yo(le.minTickInterval,V&&!this.series.some(En=>!En.sorted)?this.closestPointRange:0);!Li&&Lr&&this.tickInterval<Lr&&(this.tickInterval=Lr),V||Q||Li||(this.tickInterval=Hr(this,this.tickInterval)),this.tickAmount||(this.tickInterval=this.unsquish()),this.setTickPositions()}setTickPositions(){var ye,ce;let u=this.options,v=u.tickPositions,M=u.tickPositioner,z=this.getMinorTickInterval(),F=!this.isPanning,V=F&&u.startOnTick,G=F&&u.endOnTick,Q=[],le;if(this.tickmarkOffset=this.categories&&u.tickmarkPlacement==="between"&&this.tickInterval===1?.5:0,this.single=this.min===this.max&&ka(this.min)&&!this.tickAmount&&(this.min%1==0||u.allowDecimals!==!1),v)Q=v.slice();else if(Dr(this.min)&&Dr(this.max)){if(!((ye=this.ordinal)!=null&&ye.positions)&&(this.max-this.min)/this.tickInterval>Math.max(2*this.len,200))Q=[this.min,this.max],su(19,!1,this.chart);else if(this.dateTime)Q=this.getTimeTicks(this.dateTime.normalizeTimeTickInterval(this.tickInterval,u.units),this.min,this.max,u.startOfWeek,(ce=this.ordinal)==null?void 0:ce.positions,this.closestPointRange,!0);else if(this.logarithmic)Q=this.logarithmic.getLogTickPositions(this.tickInterval,this.min,this.max);else{let we=this.tickInterval,Le=we;for(;Le<=2*we&&(Q=this.getLinearTickPositions(this.tickInterval,this.min,this.max),this.tickAmount&&Q.length>this.tickAmount);)this.tickInterval=Hr(this,Le*=1.1)}Q.length>this.len&&(Q=[Q[0],Q[Q.length-1]])[0]===Q[1]&&(Q.length=1),M&&(this.tickPositions=Q,(le=M.apply(this,[this.min,this.max]))&&(Q=le))}this.tickPositions=Q,this.minorTickInterval=z==="auto"&&this.tickInterval?this.tickInterval/u.minorTicksPerMajor:z,this.paddedTicks=Q.slice(0),this.trimTicks(Q,V,G),!this.isLinked&&Dr(this.min)&&Dr(this.max)&&(this.single&&Q.length<2&&!this.categories&&!this.series.some(we=>we.is("heatmap")&&we.options.pointPlacement==="between")&&(this.min-=.5,this.max+=.5),v||le||this.adjustTickAmount()),vn(this,"afterSetTickPositions")}trimTicks(u,v,M){let z=u[0],F=u[u.length-1],V=!this.isOrdinal&&this.minPointOffset||0;if(vn(this,"trimTicks"),!this.isLinked||!this.grid){if(v&&z!==-1/0)this.min=z;else for(;this.min-V>u[0];)u.shift();if(M)this.max=F;else for(;this.max+V<u[u.length-1];)u.pop();u.length===0&&ka(z)&&!this.options.tickPositions&&u.push((F+z)/2)}}alignToOthers(){let u,v=this,M=v.chart,z=[this],F=v.options,V=M.options.chart,G=this.coll==="yAxis"&&V.alignThresholds,Q=[];if(v.thresholdAlignment=void 0,(V.alignTicks!==!1&&F.alignTicks||G)&&F.startOnTick!==!1&&F.endOnTick!==!1&&!v.logarithmic){let le=ce=>{let{horiz:we,options:Le}=ce;return[we?Le.left:Le.top,Le.width,Le.height,Le.pane].join(",")},ye=le(this);M[this.coll].forEach(function(ce){let{series:we}=ce;we.length&&we.some(Le=>Le.visible)&&ce!==v&&le(ce)===ye&&(u=!0,z.push(ce))})}if(u&&G){z.forEach(ye=>{let ce=ye.getThresholdAlignment(v);Dr(ce)&&Q.push(ce)});let le=Q.length>1?Q.reduce((ye,ce)=>ye+=ce,0)/Q.length:void 0;z.forEach(ye=>{ye.thresholdAlignment=le})}return u}getThresholdAlignment(u){if((!Dr(this.dataMin)||this!==u&&this.series.some(v=>v.isDirty||v.isDirtyData))&&this.getSeriesExtremes(),Dr(this.threshold)){let v=ad((this.threshold-(this.dataMin||0))/((this.dataMax||0)-(this.dataMin||0)),0,1);return this.options.reversed&&(v=1-v),v}}getTickAmount(){let u=this.options,v=u.tickPixelInterval,M=u.tickAmount;ka(u.tickInterval)||M||!(this.len<v)||this.isRadial||this.logarithmic||!u.startOnTick||!u.endOnTick||(M=2),!M&&this.alignToOthers()&&(M=Math.ceil(this.len/v)+1),M<4&&(this.finalTickAmt=M,M=5),this.tickAmount=M}adjustTickAmount(){let u=this,{finalTickAmt:v,max:M,min:z,options:F,tickPositions:V,tickAmount:G,thresholdAlignment:Q}=u,le=V==null?void 0:V.length,ye=yo(u.threshold,u.softThreshold?0:null),ce,we,Le=u.tickInterval,Ue,et=()=>V.push(ho(V[V.length-1]+Le)),tt=()=>V.unshift(ho(V[0]-Le));if(Dr(Q)&&(Ue=Q<.5?Math.ceil(Q*(G-1)):Math.floor(Q*(G-1)),F.reversed&&(Ue=G-1-Ue)),u.hasData()&&Dr(z)&&Dr(M)){let $e=()=>{u.transA*=(le-1)/(G-1),u.min=F.startOnTick?V[0]:Math.min(z,V[0]),u.max=F.endOnTick?V[V.length-1]:Math.max(M,V[V.length-1])};if(Dr(Ue)&&Dr(u.threshold)){for(;V[Ue]!==ye||V.length!==G||V[0]>z||V[V.length-1]<M;){for(V.length=0,V.push(u.threshold);V.length<G;)V[Ue]===void 0||V[Ue]>u.threshold?tt():et();if(Le>8*u.tickInterval)break;Le*=2}$e()}else if(le<G){for(;V.length<G;)V.length%2||z===ye?et():tt();$e()}if(ka(v)){for(we=ce=V.length;we--;)(v===3&&we%2==1||v<=2&&we>0&&we<ce-1)&&V.splice(we,1);u.finalTickAmt=void 0}}}setScale(){var V,G,Q,le,ye;let{coll:u,stacking:v}=this,M=!1,z=!1;this.series.forEach(ce=>{var we;M=M||ce.isDirtyData||ce.isDirty,z=z||((we=ce.xAxis)==null?void 0:we.isDirty)||!1}),this.setAxisSize();let F=this.len!==((V=this.old)==null?void 0:V.len);F||M||z||this.isLinked||this.forceRedraw||this.userMin!==((G=this.old)==null?void 0:G.userMin)||this.userMax!==((Q=this.old)==null?void 0:Q.userMax)||this.alignToOthers()?(v&&u==="yAxis"&&v.buildStacks(),this.forceRedraw=!1,this.userMinRange||(this.minRange=void 0),this.getSeriesExtremes(),this.setTickInterval(),v&&u==="xAxis"&&v.buildStacks(),this.isDirty||(this.isDirty=F||this.min!==((le=this.old)==null?void 0:le.min)||this.max!==((ye=this.old)==null?void 0:ye.max))):v&&v.cleanStacks(),M&&delete this.allExtremes,vn(this,"afterSetScale")}setExtremes(u,v,M=!0,z,F){let V=this.chart;this.series.forEach(G=>{delete G.kdTree}),u=V.time.parse(u),v=V.time.parse(v),vn(this,"setExtremes",F=Gp(F,{min:u,max:v}),G=>{this.userMin=G.min,this.userMax=G.max,this.eventArgs=G,M&&V.redraw(z)})}setAxisSize(){let u=this.chart,v=this.options,M=v.offsets||[0,0,0,0],z=this.horiz,F=this.width=Math.round(sr(yo(v.width,u.plotWidth-M[3]+M[1]),u.plotWidth)),V=this.height=Math.round(sr(yo(v.height,u.plotHeight-M[0]+M[2]),u.plotHeight)),G=this.top=Math.round(sr(yo(v.top,u.plotTop+M[0]),u.plotHeight,u.plotTop)),Q=this.left=Math.round(sr(yo(v.left,u.plotLeft+M[3]),u.plotWidth,u.plotLeft));this.bottom=u.chartHeight-V-G,this.right=u.chartWidth-F-Q,this.len=Math.max(z?F:V,0),this.pos=z?Q:G}getExtremes(){let u=this.logarithmic;return{min:u?ho(u.lin2log(this.min)):this.min,max:u?ho(u.lin2log(this.max)):this.max,dataMin:this.dataMin,dataMax:this.dataMax,userMin:this.userMin,userMax:this.userMax}}getThreshold(u){let v=this.logarithmic,M=v?v.lin2log(this.min):this.min,z=v?v.lin2log(this.max):this.max;return u===null||u===-1/0?u=M:u===1/0?u=z:M>u?u=M:z<u&&(u=z),this.translate(u,0,1,0,1)}autoLabelAlign(u){let v=(yo(u,0)-90*this.side+720)%360,M={align:"center"};return vn(this,"autoLabelAlign",M,function(z){v>15&&v<165?z.align="right":v>195&&v<345&&(z.align="left")}),M.align}tickSize(u){let v=this.options,M=yo(v[u==="tick"?"tickWidth":"minorTickWidth"],u==="tick"&&this.isXAxis&&!this.categories?1:0),z=v[u==="tick"?"tickLength":"minorTickLength"],F;M&&z&&(v[u+"Position"]==="inside"&&(z=-z),F=[z,M]);let V={tickSize:F};return vn(this,"afterTickSize",V),V.tickSize}labelMetrics(){let u=this.chart.renderer,v=this.ticks,M=v[Object.keys(v)[0]]||{};return this.chart.renderer.fontMetrics(M.label||M.movedLabel||u.box)}unsquish(){let u=this.options.labels,v=u.padding||0,M=this.horiz,z=this.tickInterval,F=this.len/((+!!this.categories+this.max-this.min)/z),V=u.rotation,G=ho(.8*this.labelMetrics().h),Q=Math.max(this.max-this.min,0),le=function(Ue){let et=(Ue+2*v)/(F||1);return(et=et>1?Math.ceil(et):1)*z>Q&&Ue!==1/0&&F!==1/0&&Q&&(et=Math.ceil(Q/z)),ho(et*z)},ye=z,ce,we=Number.MAX_VALUE,Le;if(M){if(!u.staggerLines&&(Dr(V)?Le=[V]:F<u.autoRotationLimit&&(Le=u.autoRotation)),Le){let Ue,et;for(let tt of Le)(tt===V||tt&&tt>=-90&&tt<=90)&&(et=(Ue=le(Math.abs(G/Math.sin(Pu*tt))))+Math.abs(tt/360))<we&&(we=et,ce=tt,ye=Ue)}}else ye=le(.75*G);return this.autoRotation=Le,this.labelRotation=yo(ce,Dr(V)?V:0),u.step?z:ye}getSlotWidth(u){let v=this.chart,M=this.horiz,z=this.options.labels,F=Math.max(this.tickPositions.length-!this.categories,1),V=v.margin[3];if(u&&Dr(u.slotWidth))return u.slotWidth;if(M&&z.step<2&&!this.isRadial)return z.rotation?0:(this.staggerLines||1)*this.len/F;if(!M){let G=z.style.width;if(G!==void 0)return parseInt(String(G),10);if(V)return V-v.spacing[3]}return .33*v.chartWidth}renderUnsquish(){let u=this.chart,v=u.renderer,M=this.tickPositions,z=this.ticks,F=this.options.labels,V=F.style,G=this.horiz,Q=this.getSlotWidth(),le=Math.max(1,Math.round(Q-(G?2*(F.padding||0):F.distance||0))),ye={},ce=this.labelMetrics(),we=V.lineClamp,Le,Ue=we??(Math.floor(this.len/(M.length*ce.h))||1),et=0;Un(F.rotation)||(ye.rotation=F.rotation||0),M.forEach(function(tt){var yt;let $e=z[tt];$e.movedLabel&&$e.replaceMovedLabel();let ht=((yt=$e.label)==null?void 0:yt.textPxLength)||0;ht>et&&(et=ht)}),this.maxLabelLength=et,this.autoRotation?et>le&&et>ce.h?ye.rotation=this.labelRotation:this.labelRotation=0:Q&&(Le=le),ye.rotation&&(Le=et>.5*u.chartHeight?.33*u.chartHeight:et,we||(Ue=1)),this.labelAlign=F.align||this.autoLabelAlign(this.labelRotation),this.labelAlign&&(ye.align=this.labelAlign),M.forEach(function(tt){let $e=z[tt],ht=$e==null?void 0:$e.label,yt=V.width,ci={};ht&&(ht.attr(ye),$e.shortenLabel?$e.shortenLabel():Le&&!yt&&V.whiteSpace!=="nowrap"&&(Le<(ht.textPxLength||0)||ht.element.tagName==="SPAN")?ht.css(Gp(ci,{width:`${Le}px`,lineClamp:Ue})):!ht.styles.width||ci.width||yt||ht.css({width:"auto"}),$e.rotation=ye.rotation)},this),this.tickRotCorr=v.rotCorr(ce.b,this.labelRotation||0,this.side!==0)}hasData(){return this.series.some(function(u){return u.hasData()})||this.options.showEmpty&&ka(this.min)&&ka(this.max)}addTitle(u){let v,M=this.chart.renderer,z=this.horiz,F=this.opposite,V=this.options.title,G=this.chart.styledMode;this.axisTitle||((v=V.textAlign)||(v=(z?{low:"left",middle:"center",high:"right"}:{low:F?"right":"left",middle:"center",high:F?"left":"right"})[V.align]),this.axisTitle=M.text(V.text||"",0,0,V.useHTML).attr({zIndex:7,rotation:V.rotation||0,align:v}).addClass("highcharts-axis-title"),G||this.axisTitle.css(ln(V.style)),this.axisTitle.add(this.axisGroup),this.axisTitle.isNew=!0),G||V.style.width||this.isRadial||this.axisTitle.css({width:this.len+"px"}),this.axisTitle[u?"show":"hide"](u)}generateTick(u){let v=this.ticks;v[u]?v[u].addLabel():v[u]=new Rl(this,u)}createGroups(){let{axisParent:u,chart:v,coll:M,options:z}=this,F=v.renderer,V=(G,Q,le)=>F.g(G).attr({zIndex:le}).addClass(`highcharts-${M.toLowerCase()}${Q} `+(this.isRadial?`highcharts-radial-axis${Q} `:"")+(z.className||"")).add(u);this.axisGroup||(this.gridGroup=V("grid","-grid",z.gridZIndex),this.axisGroup=V("axis","",z.zIndex),this.labelGroup=V("axis-labels","-labels",z.labels.zIndex))}getOffset(){let u=this,{chart:v,horiz:M,options:z,side:F,ticks:V,tickPositions:G,coll:Q}=u,le=v.inverted&&!u.isZAxis?[1,0,3,2][F]:F,ye=u.hasData(),ce=z.title,we=z.labels,Le=Dr(z.crossing),Ue=v.axisOffset,et=v.clipOffset,tt=[-1,1,1,-1][F],$e,ht=0,yt,ci=0,ii=0,ri,Ri;if(u.showAxis=$e=ye||z.showEmpty,u.staggerLines=u.horiz&&we.staggerLines||void 0,u.createGroups(),ye||u.isLinked?(G.forEach(function(ki){u.generateTick(ki)}),u.renderUnsquish(),u.reserveSpaceDefault=F===0||F===2||{1:"left",3:"right"}[F]===u.labelAlign,yo(we.reserveSpace,!Le&&null,u.labelAlign==="center"||null,u.reserveSpaceDefault)&&G.forEach(function(ki){ii=Math.max(V[ki].getLabelSize(),ii)}),u.staggerLines&&(ii*=u.staggerLines),u.labelOffset=ii*(u.opposite?-1:1)):Iu(V,function(ki,Li){ki.destroy(),delete V[Li]}),ce!=null&&ce.text&&ce.enabled!==!1&&(u.addTitle($e),$e&&!Le&&ce.reserveSpace!==!1&&(u.titleOffset=ht=u.axisTitle.getBBox()[M?"height":"width"],ci=ka(yt=ce.offset)?0:yo(ce.margin,M?5:10))),u.renderLine(),u.offset=tt*yo(z.offset,Ue[F]?Ue[F]+(z.margin||0):0),u.tickRotCorr=u.tickRotCorr||{x:0,y:0},Ri=F===0?-u.labelMetrics().h:F===2?u.tickRotCorr.y:0,ri=Math.abs(ii)+ci,ii&&(ri-=Ri,ri+=tt*(M?yo(we.y,u.tickRotCorr.y+tt*we.distance):yo(we.x,tt*we.distance))),u.axisTitleMargin=yo(yt,ri),u.getMaxLabelDimensions&&(u.maxLabelDimensions=u.getMaxLabelDimensions(V,G)),Q!=="colorAxis"&&et){let ki=this.tickSize("tick");Ue[F]=Math.max(Ue[F],(u.axisTitleMargin||0)+ht+tt*u.offset,ri,G!=null&&G.length&&ki?ki[0]+tt*u.offset:0);let Li=!u.axisLine||z.offset?0:u.axisLine.strokeWidth()/2;et[le]=Math.max(et[le],Li)}vn(this,"afterGetOffset")}getLinePath(u){let v=this.chart,M=this.opposite,z=this.offset,F=this.horiz,V=this.left+(M?this.width:0)+z,G=v.chartHeight-this.bottom-(M?this.height:0)+z;return M&&(u*=-1),v.renderer.crispLine([["M",F?this.left:V,F?G:this.top],["L",F?v.chartWidth-this.right:V,F?G:v.chartHeight-this.bottom]],u)}renderLine(){!this.axisLine&&(this.axisLine=this.chart.renderer.path().addClass("highcharts-axis-line").add(this.axisGroup),this.chart.styledMode||this.axisLine.attr({stroke:this.options.lineColor,"stroke-width":this.options.lineWidth,zIndex:7}))}getTitlePosition(u){let v=this.horiz,M=this.left,z=this.top,F=this.len,V=this.options.title,G=v?M:z,Q=this.opposite,le=this.offset,ye=V.x,ce=V.y,we=this.chart.renderer.fontMetrics(u),Le=u?Math.max(u.getBBox(!1,0).height-we.h-1,0):0,Ue={low:G+(v?0:F),middle:G+F/2,high:G+(v?F:0)}[V.align],et=(v?z+this.height:M)+(v?1:-1)*(Q?-1:1)*(this.axisTitleMargin||0)+[-Le,Le,we.f,-Le][this.side],tt={x:v?Ue+ye:et+(Q?this.width:0)+le+ye,y:v?et+ce-(Q?this.height:0)+le:Ue+ce};return vn(this,"afterGetTitlePosition",{titlePosition:tt}),tt}renderMinorTick(u,v){let M=this.minorTicks;M[u]||(M[u]=new Rl(this,u,"minor")),v&&M[u].isNew&&M[u].render(null,!0),M[u].render(null,!1,1)}renderTick(u,v,M){var V;let z=this.isLinked,F=this.ticks;(!z||u>=this.min&&u<=this.max||(V=this.grid)!=null&&V.isColumn)&&(F[u]||(F[u]=new Rl(this,u)),M&&F[u].isNew&&F[u].render(v,!0,-1),F[u].render(v))}render(){let u,v,M=this,z=M.chart,F=M.logarithmic,V=z.renderer,G=M.options,Q=M.isLinked,le=M.tickPositions,ye=M.axisTitle,ce=M.ticks,we=M.minorTicks,Le=M.alternateBands,Ue=G.stackLabels,et=G.alternateGridColor,tt=G.crossing,$e=M.tickmarkOffset,ht=M.axisLine,yt=M.showAxis,ci=vc(V.globalAnimation);if(M.labelEdge.length=0,M.overlap=!1,[ce,we,Le].forEach(function(ii){Iu(ii,function(ri){ri.isActive=!1})}),Dr(tt)){let ii=this.isXAxis?z.yAxis[0]:z.xAxis[0],ri=[1,-1,-1,1][this.side];if(ii){let Ri=ii.toPixels(tt,!0);M.horiz&&(Ri=ii.len-Ri),M.offset=ri*Ri}}if(M.hasData()||Q){let ii=M.chart.hasRendered&&M.old&&Dr(M.old.min);M.minorTickInterval&&!M.categories&&M.getMinorTickPositions().forEach(function(ri){M.renderMinorTick(ri,ii)}),le.length&&(le.forEach(function(ri,Ri){M.renderTick(ri,Ri,ii)}),$e&&(M.min===0||M.single)&&(ce[-1]||(ce[-1]=new Rl(M,-1,null,!0)),ce[-1].render(-1))),et&&le.forEach(function(ri,Ri){v=le[Ri+1]!==void 0?le[Ri+1]+$e:M.max-$e,Ri%2==0&&ri<M.max&&v<=M.max+(z.polar?-$e:$e)&&(Le[ri]||(Le[ri]=new Pi.PlotLineOrBand(M,{})),u=ri+$e,Le[ri].options={from:F?F.lin2log(u):u,to:F?F.lin2log(v):v,color:et,className:"highcharts-alternate-grid"},Le[ri].render(),Le[ri].isActive=!0)}),M._addedPlotLB||(M._addedPlotLB=!0,(G.plotLines||[]).concat(G.plotBands||[]).forEach(function(ri){M.addPlotBandOrLine(ri)}))}[ce,we,Le].forEach(function(ii){let ri=[],Ri=ci.duration;Iu(ii,function(ki,Li){ki.isActive||(ki.render(Li,!1,0),ki.isActive=!1,ri.push(Li))}),ru(function(){let ki=ri.length;for(;ki--;)ii[ri[ki]]&&!ii[ri[ki]].isActive&&(ii[ri[ki]].destroy(),delete ii[ri[ki]])},ii!==Le&&z.hasRendered&&Ri?Ri:0)}),ht&&(ht[ht.isPlaced?"animate":"attr"]({d:this.getLinePath(ht.strokeWidth())}),ht.isPlaced=!0,ht[yt?"show":"hide"](yt)),ye&&yt&&(ye[ye.isNew?"attr":"animate"](M.getTitlePosition(ye)),ye.isNew=!1),Ue!=null&&Ue.enabled&&M.stacking&&M.stacking.renderStackTotals(),M.old={len:M.len,max:M.max,min:M.min,transA:M.transA,userMax:M.userMax,userMin:M.userMin},M.isDirty=!1,vn(this,"afterRender")}redraw(){this.visible&&(this.render(),this.plotLinesAndBands.forEach(function(u){u.render()})),this.series.forEach(function(u){u.isDirty=!0})}getKeepProps(){return this.keepProps||vo.keepProps}destroy(u){let v=this,M=v.plotLinesAndBands,z=this.eventOptions;if(vn(this,"destroy",{keepEvents:u}),u||nc(v),[v.ticks,v.minorTicks,v.alternateBands].forEach(function(F){Zf(F)}),M){let F=M.length;for(;F--;)M[F].destroy()}for(let F in["axisLine","axisTitle","axisGroup","gridGroup","labelGroup","cross","scrollbar"].forEach(function(V){v[V]&&(v[V]=v[V].destroy())}),v.plotLinesAndBandsGroups)v.plotLinesAndBandsGroups[F]=v.plotLinesAndBandsGroups[F].destroy();Iu(v,function(F,V){v.getKeepProps().indexOf(V)===-1&&delete v[V]}),this.eventOptions=z}drawCrosshair(u,v){var ce;let M=this.crosshair,z=(M==null?void 0:M.snap)??!0,F=this.chart,V,G,Q,le=this.cross,ye;if(vn(this,"drawCrosshair",{e:u,point:v}),u||(u=(ce=this.cross)==null?void 0:ce.e),M&&(ka(v)||!z)!==!1){if(z?ka(v)&&(G=yo(this.coll!=="colorAxis"?v.crosshairPos:null,this.isXAxis?v.plotX:this.len-v.plotY)):G=u&&(this.horiz?u.chartX-this.pos:this.len-u.chartY+this.pos),ka(G)&&(ye={value:v&&(this.isXAxis?v.x:yo(v.stackY,v.y)),translatedValue:G},F.polar&&Gp(ye,{isCrosshair:!0,chartX:u==null?void 0:u.chartX,chartY:u==null?void 0:u.chartY,point:v}),V=this.getPlotLinePath(ye)||null),!ka(V))return void this.hideCrosshair();Q=this.categories&&!this.isRadial,le||(this.cross=le=F.renderer.path().addClass("highcharts-crosshair highcharts-crosshair-"+(Q?"category ":"thin ")+(M.className||"")).attr({zIndex:yo(M.zIndex,2)}).add(),!F.styledMode&&(le.attr({stroke:M.color||(Q?lr.parse("#ccd3ff").setOpacity(.25).get():"#cccccc"),"stroke-width":yo(M.width,1)}).css({"pointer-events":"none"}),M.dashStyle&&le.attr({dashstyle:M.dashStyle}))),le.show().attr({d:V}),Q&&!M.width&&le.attr({"stroke-width":this.transA}),this.cross.e=u}else this.hideCrosshair();vn(this,"afterDrawCrosshair",{e:u,point:v})}hideCrosshair(){this.cross&&this.cross.hide(),vn(this,"afterHideCrosshair")}update(u,v){let M=this.chart;u=ln(this.userOptions,u),this.destroy(!0),this.init(M,u),M.isDirtyBox=!0,yo(v,!0)&&M.redraw()}remove(u){let v=this.chart,M=this.coll,z=this.series,F=z.length;for(;F--;)z[F]&&z[F].remove(!1);km(v.axes,this),km(v[M]||[],this),v.orderItems(M),this.destroy(),v.isDirtyBox=!0,yo(u,!0)&&v.redraw()}setTitle(u,v){this.update({title:u},v)}setCategories(u,v){this.update({categories:u},v)}}vo.keepProps=["coll","extKey","hcEvents","len","names","series","userMax","userMin"];let{addEvent:ou,getMagnitude:Wp,normalizeTickInterval:xp,timeUnits:Ro}=Qs;(function(he){function u(){return this.chart.time.getTimeTicks.apply(this.chart.time,arguments)}function v(){if(this.type!=="datetime"){this.dateTime=void 0;return}this.dateTime||(this.dateTime=new M(this))}he.compose=function(z){return z.keepProps.includes("dateTime")||(z.keepProps.push("dateTime"),z.prototype.getTimeTicks=u,ou(z,"afterSetType",v)),z};class M{constructor(F){this.axis=F}normalizeTimeTickInterval(F,V){let G=V||[["millisecond",[1,2,5,10,20,25,50,100,200,500]],["second",[1,2,5,10,15,30]],["minute",[1,2,5,10,15,30]],["hour",[1,2,3,4,6,8,12]],["day",[1,2]],["week",[1,2]],["month",[1,2,3,4,6]],["year",null]],Q=G[G.length-1],le=Ro[Q[0]],ye=Q[1],ce;for(ce=0;ce<G.length&&(le=Ro[(Q=G[ce])[0]],ye=Q[1],!G[ce+1]||!(F<=(le*ye[ye.length-1]+Ro[G[ce+1][0]])/2));ce++);le===Ro.year&&F<5*le&&(ye=[1,2,5]);let we=xp(F/le,ye,Q[0]==="year"?Math.max(Wp(F/le),1):1);return{unitRange:le,count:we,unitName:Q[0]}}getXDateFormat(F,V){let{axis:G}=this,Q=G.chart.time;return G.closestPointRange?Q.getDateFormat(G.closestPointRange,F,G.options.startOfWeek,V)||Q.resolveDTLFormat(V.year).main:Q.resolveDTLFormat(V.day).main}}he.Additions=M})(Ui||(Ui={}));let _p=Ui,{addEvent:Ku,normalizeTickInterval:Lu,pick:og}=Qs;(function(he){function u(){this.type!=="logarithmic"?this.logarithmic=void 0:this.logarithmic??(this.logarithmic=new M(this))}function v(){let z=this.logarithmic;z&&(this.lin2val=function(F){return z.lin2log(F)},this.val2lin=function(F){return z.log2lin(F)})}he.compose=function(z){return z.keepProps.includes("logarithmic")||(z.keepProps.push("logarithmic"),Ku(z,"afterSetType",u),Ku(z,"afterInit",v)),z};class M{constructor(F){this.axis=F}getLogTickPositions(F,V,G,Q){let le=this.axis,ye=le.len,ce=le.options,we=[];if(Q||(this.minorAutoInterval=void 0),F>=.5)F=Math.round(F),we=le.getLinearTickPositions(F,V,G);else if(F>=.08){let Le,Ue,et,tt,$e,ht,yt,ci=Math.floor(V);for(Le=F>.3?[1,2,4]:F>.15?[1,2,4,6,8]:[1,2,3,4,5,6,7,8,9],Ue=ci;Ue<G+1&&!yt;Ue++)for(et=0,tt=Le.length;et<tt&&!yt;et++)($e=this.log2lin(this.lin2log(Ue)*Le[et]))>V&&(!Q||ht<=G)&&ht!==void 0&&we.push(ht),ht>G&&(yt=!0),ht=$e}else{let Le=this.lin2log(V),Ue=this.lin2log(G),et=Q?le.getMinorTickInterval():ce.tickInterval,tt=ce.tickPixelInterval/(Q?5:1),$e=Q?ye/le.tickPositions.length:ye;F=Lu(F=og(et==="auto"?null:et,this.minorAutoInterval,(Ue-Le)*tt/($e||1))),we=le.getLinearTickPositions(F,Le,Ue).map(this.log2lin),Q||(this.minorAutoInterval=F/5)}return Q||(le.tickInterval=F),we}lin2log(F){return Math.pow(10,F)}log2lin(F){return Math.log(F)/Math.LN10}}he.Additions=M})(is||(is={}));let Em=is,{erase:nu,extend:Ld,isNumber:Cm}=Qs;(function(he){let u;function v(le){return this.addPlotBandOrLine(le,"plotBands")}function M(le,ye){let ce=this.userOptions,we=new u(this,le);if(this.visible&&(we=we.render()),we){if(this._addedPlotLB||(this._addedPlotLB=!0,(ce.plotLines||[]).concat(ce.plotBands||[]).forEach(Le=>{this.addPlotBandOrLine(Le)})),ye){let Le=ce[ye]||[];Le.push(le),ce[ye]=Le}this.plotLinesAndBands.push(we)}return we}function z(le){return this.addPlotBandOrLine(le,"plotLines")}function F(le,ye,ce){ce=ce||this.options;let we=this.getPlotLinePath({value:ye,force:!0,acrossPanes:ce.acrossPanes}),Le=[],Ue=this.horiz,et=!Cm(this.min)||!Cm(this.max)||le<this.min&&ye<this.min||le>this.max&&ye>this.max,tt=this.getPlotLinePath({value:le,force:!0,acrossPanes:ce.acrossPanes}),$e,ht=1,yt;if(tt&&we)for(et&&(yt=tt.toString()===we.toString(),ht=0),$e=0;$e<tt.length;$e+=2){let ci=tt[$e],ii=tt[$e+1],ri=we[$e],Ri=we[$e+1];(ci[0]==="M"||ci[0]==="L")&&(ii[0]==="M"||ii[0]==="L")&&(ri[0]==="M"||ri[0]==="L")&&(Ri[0]==="M"||Ri[0]==="L")&&(Ue&&ri[1]===ci[1]?(ri[1]+=ht,Ri[1]+=ht):Ue||ri[2]!==ci[2]||(ri[2]+=ht,Ri[2]+=ht),Le.push(["M",ci[1],ci[2]],["L",ii[1],ii[2]],["L",Ri[1],Ri[2]],["L",ri[1],ri[2]],["Z"])),Le.isFlat=yt}return Le}function V(le){this.removePlotBandOrLine(le)}function G(le){let ye=this.plotLinesAndBands,ce=this.options,we=this.userOptions;if(ye){let Le=ye.length;for(;Le--;)ye[Le].id===le&&ye[Le].destroy();[ce.plotLines||[],we.plotLines||[],ce.plotBands||[],we.plotBands||[]].forEach(function(Ue){var et;for(Le=Ue.length;Le--;)((et=Ue[Le])==null?void 0:et.id)===le&&nu(Ue,Ue[Le])})}}function Q(le){this.removePlotBandOrLine(le)}he.compose=function(le,ye){let ce=ye.prototype;return ce.addPlotBand||(u=le,Ld(ce,{addPlotBand:v,addPlotLine:z,addPlotBandOrLine:M,getPlotBandPath:F,removePlotBand:V,removePlotLine:Q,removePlotBandOrLine:G})),ye}})(Xs||(Xs={}));let Pm=Xs,{addEvent:Kf,arrayMax:Im,arrayMin:gf,defined:jc,destroyObjectProperties:Jf,erase:Ou,fireEvent:Lm,merge:Qf,objectEach:em,pick:Du}=Qs;class Bl{static compose(u,v){return Kf(u,"afterInit",function(){this.labelCollectors.push(()=>{var z;let M=[];for(let F of this.axes)for(let{label:V,options:G}of F.plotLinesAndBands)V&&!((z=G==null?void 0:G.label)!=null&&z.allowOverlap)&&M.push(V);return M})}),Pm.compose(Bl,v)}constructor(u,v){this.axis=u,this.options=v,this.id=v.id}render(){Lm(this,"render");let{axis:u,options:v}=this,{horiz:M,logarithmic:z}=u,{color:F,events:V,zIndex:G=0}=v,{renderer:Q,time:le}=u.chart,ye={},ce=le.parse(v.to),we=le.parse(v.from),Le=le.parse(v.value),Ue=v.borderWidth,et=v.label,{label:tt,svgElem:$e}=this,ht=[],yt,ci=jc(we)&&jc(ce),ii=jc(Le),ri=!$e,Ri={class:"highcharts-plot-"+(ci?"band ":"line ")+(v.className||"")},ki=ci?"bands":"lines";if(!u.chart.styledMode&&(ii?(Ri.stroke=F||"#999999",Ri["stroke-width"]=Du(v.width,1),v.dashStyle&&(Ri.dashstyle=v.dashStyle)):ci&&(Ri.fill=F||"#e6e9ff",Ue&&(Ri.stroke=v.borderColor,Ri["stroke-width"]=Ue))),ye.zIndex=G,ki+="-"+G,(yt=u.plotLinesAndBandsGroups[ki])||(u.plotLinesAndBandsGroups[ki]=yt=Q.g("plot-"+ki).attr(ye).add()),$e||(this.svgElem=$e=Q.path().attr(Ri).add(yt)),jc(Le))ht=u.getPlotLinePath({value:(z==null?void 0:z.log2lin(Le))??Le,lineWidth:$e.strokeWidth(),acrossPanes:v.acrossPanes});else{if(!(jc(we)&&jc(ce)))return;ht=u.getPlotBandPath((z==null?void 0:z.log2lin(we))??we,(z==null?void 0:z.log2lin(ce))??ce,v)}return!this.eventsAdded&&V&&(em(V,(Li,ls)=>{$e==null||$e.on(ls,vs=>{V[ls].apply(this,[vs])})}),this.eventsAdded=!0),(ri||!$e.d)&&(ht!=null&&ht.length)?$e.attr({d:ht}):$e&&(ht?($e.show(),$e.animate({d:ht})):$e.d&&($e.hide(),tt&&(this.label=tt=tt.destroy()))),et&&(jc(et.text)||jc(et.formatter))&&(ht!=null&&ht.length)&&u.width>0&&u.height>0&&!ht.isFlat?(et=Qf({align:M&&ci?"center":void 0,x:M?!ci&&4:10,verticalAlign:!M&&ci?"middle":void 0,y:M?ci?16:10:ci?6:-4,rotation:M&&!ci?90:0,...ci?{inside:!0}:{}},et),this.renderLabel(et,ht,ci,G)):tt&&tt.hide(),this}renderLabel(u,v,M,z){var Ue,et;let F=this.axis,V=F.chart.renderer,G=u.inside,Q=this.label;Q||(this.label=Q=V.text(this.getLabelText(u),0,0,u.useHTML).attr({align:u.textAlign||u.align,rotation:u.rotation,class:"highcharts-plot-"+(M?"band":"line")+"-label "+(u.className||""),zIndex:z}),F.chart.styledMode||Q.css(Qf({color:(Ue=F.chart.options.title)==null?void 0:Ue.style.color,fontSize:"0.8em",textOverflow:M&&!G?"":"ellipsis"},u.style)),Q.add());let le=v.xBounds||[v[0][1],v[1][1],M?v[2][1]:v[0][1]],ye=v.yBounds||[v[0][2],v[1][2],M?v[2][2]:v[0][2]],ce=gf(le),we=gf(ye),Le=Im(le)-ce;Q.align(u,!1,{x:ce,y:we,width:Le,height:Im(ye)-we}),Q.alignAttr.y-=V.fontMetrics(Q).b,(!Q.alignValue||Q.alignValue==="left"||jc(G))&&Q.css({width:(((et=u.style)==null?void 0:et.width)||(M&&G?Le:Q.rotation===90?F.height-(Q.alignAttr.y-F.top):(u.clip?F.width:F.chart.chartWidth)-(Q.alignAttr.x-F.left)))+"px"}),Q.show(!0)}getLabelText(u){return jc(u.formatter)?u.formatter.call(this):u.text}destroy(){Ou(this.axis.plotLinesAndBands,this),delete this.axis,Jf(this)}}let{animObject:tm}=Ws,{format:dh}=Ma,{composed:Gc,dateFormats:Ju,doc:Hp,isSafari:Qu}=Pi,{distribute:ep}=fa,{addEvent:im,clamp:Od,css:au,discardElement:sm,extend:Xp,fireEvent:rm,getAlignFactor:yf,isArray:ld,isNumber:zu,isObject:ng,isString:ag,merge:Yp,pick:Lh,pushUnique:lg,splat:$p,syncTimeout:xf}=Qs;class _f{constructor(u,v,M){this.allowShared=!0,this.crosshairs=[],this.distance=0,this.isHidden=!0,this.isSticky=!1,this.options={},this.outside=!1,this.chart=u,this.init(u,v),this.pointer=M}bodyFormatter(u){return u.map(v=>{let M=v.series.tooltipOptions,z=v.formatPrefix||"point";return(M[z+"Formatter"]||v.tooltipFormatter).call(v,M[z+"Format"]||"")})}cleanSplit(u){this.chart.series.forEach(function(v){let M=v==null?void 0:v.tt;M&&(!M.isActive||u?v.tt=M.destroy():M.isActive=!1)})}defaultFormatter(u){let v,M=this.points||$p(this);return(v=(v=[u.headerFooterFormatter(M[0])]).concat(u.bodyFormatter(M))).push(u.headerFooterFormatter(M[0],!0)),v}destroy(){this.label&&(this.label=this.label.destroy()),this.split&&(this.cleanSplit(!0),this.tt&&(this.tt=this.tt.destroy())),this.renderer&&(this.renderer=this.renderer.destroy(),sm(this.container)),Qs.clearTimeout(this.hideTimer)}getAnchor(u,v){var ye;let M,{chart:z,pointer:F}=this,V=z.inverted,G=z.plotTop,Q=z.plotLeft;if(u=$p(u),(ye=u[0].series)!=null&&ye.yAxis&&!u[0].series.yAxis.options.reversedStacks&&(u=u.slice().reverse()),this.followPointer&&v)v.chartX===void 0&&(v=F.normalize(v)),M=[v.chartX-Q,v.chartY-G];else if(u[0].tooltipPos)M=u[0].tooltipPos;else{let ce=0,we=0;u.forEach(function(Le){let Ue=Le.pos(!0);Ue&&(ce+=Ue[0],we+=Ue[1])}),ce/=u.length,we/=u.length,this.shared&&u.length>1&&v&&(V?ce=v.chartX:we=v.chartY),M=[ce-Q,we-G]}let le={point:u[0],ret:M};return rm(this,"getAnchor",le),le.ret.map(Math.round)}getClassName(u,v,M){let z=this.options,F=u.series,V=F.options;return[z.className,"highcharts-label",M&&"highcharts-tooltip-header",v?"highcharts-tooltip-box":"highcharts-tooltip",!M&&"highcharts-color-"+Lh(u.colorIndex,F.colorIndex),V==null?void 0:V.className].filter(ag).join(" ")}getLabel({anchorX:u,anchorY:v}={anchorX:0,anchorY:0}){let M=this,z=this.chart.styledMode,F=this.options,V=this.split&&this.allowShared,G=this.container,Q=this.chart.renderer;if(this.label){let le=!this.label.hasClass("highcharts-label");(!V&&le||V&&!le)&&this.destroy()}if(!this.label){if(this.outside){let le=this.chart,ye=le.options.chart.style,ce=yn.getRendererType();this.container=G=Pi.doc.createElement("div"),G.className="highcharts-tooltip-container "+(le.renderTo.className.match(/(highcharts[a-zA-Z0-9-]+)\s?/gm)||""),au(G,{position:"absolute",top:"1px",pointerEvents:"none",zIndex:Math.max(this.options.style.zIndex||0,((ye==null?void 0:ye.zIndex)||0)+3)}),this.renderer=Q=new ce(G,0,0,ye,void 0,void 0,Q.styledMode)}if(V?this.label=Q.g("tooltip"):(this.label=Q.label("",u,v,F.shape||"callout",void 0,void 0,F.useHTML,void 0,"tooltip").attr({padding:F.padding,r:F.borderRadius}),z||this.label.attr({fill:F.backgroundColor,"stroke-width":F.borderWidth||0}).css(F.style).css({pointerEvents:F.style.pointerEvents||(this.shouldStickOnContact()?"auto":"none")})),M.outside){let le=this.label;[le.xSetter,le.ySetter].forEach((ye,ce)=>{le[ce?"ySetter":"xSetter"]=we=>{ye.call(le,M.distance),le[ce?"y":"x"]=we,G&&(G.style[ce?"top":"left"]=`${we}px`)}})}this.label.attr({zIndex:8}).shadow(F.shadow??!F.fixed).add()}return G&&!G.parentElement&&Pi.doc.body.appendChild(G),this.label}getPlayingField(){let{body:u,documentElement:v}=Hp,{chart:M,distance:z,outside:F}=this;return{width:F?Math.max(u.scrollWidth,v.scrollWidth,u.offsetWidth,v.offsetWidth,v.clientWidth)-2*z-2:M.chartWidth,height:F?Math.max(u.scrollHeight,v.scrollHeight,u.offsetHeight,v.offsetHeight,v.clientHeight):M.chartHeight}}getPosition(u,v,M){var Cr,Ur;let{distance:z,chart:F,outside:V,pointer:G}=this,{inverted:Q,plotLeft:le,plotTop:ye,polar:ce}=F,{plotX:we=0,plotY:Le=0}=M,Ue={},et=Q&&M.h||0,{height:tt,width:$e}=this.getPlayingField(),ht=G.getChartPosition(),yt=nr=>nr*ht.scaleX,ci=nr=>nr*ht.scaleY,ii=nr=>{let Yr=nr==="x";return[nr,Yr?$e:tt,Yr?u:v].concat(V?[Yr?yt(u):ci(v),Yr?ht.left-z+yt(we+le):ht.top-z+ci(Le+ye),0,Yr?$e:tt]:[Yr?u:v,Yr?we+le:Le+ye,Yr?le:ye,Yr?le+F.plotWidth:ye+F.plotHeight])},ri=ii("y"),Ri=ii("x"),ki,Li=!!M.negative;!ce&&((Ur=(Cr=F.hoverSeries)==null?void 0:Cr.yAxis)!=null&&Ur.reversed)&&(Li=!Li);let ls=!this.followPointer&&Lh(M.ttBelow,!ce&&!Q===Li),vs=function(nr,Yr,En,Sn,Mn,Bh,$o){let Ca=V?nr==="y"?ci(z):yt(z):z,Do=(En-Sn)/2,go=Sn<Mn-z,Al=Mn+z+Sn<Yr,oa=Mn-Ca-En+Do,na=Mn+Ca-Do;if(ls&&Al)Ue[nr]=na;else if(!ls&&go)Ue[nr]=oa;else if(go)Ue[nr]=Math.min($o-Sn,oa-et<0?oa:oa-et);else{if(!Al)return Ue[nr]=0,!1;Ue[nr]=Math.max(Bh,na+et+En>Yr?na:na+et)}},Ys=function(nr,Yr,En,Sn,Mn){if(Mn<z||Mn>Yr-z)return!1;Mn<En/2?Ue[nr]=1:Mn>Yr-Sn/2?Ue[nr]=Yr-Sn-2:Ue[nr]=Mn-En/2},ks=function(nr){[ri,Ri]=[Ri,ri],ki=nr},Lr=()=>{vs.apply(0,ri)!==!1?Ys.apply(0,Ri)!==!1||ki||(ks(!0),Lr()):ki?Ue.x=Ue.y=0:(ks(!0),Lr())};return(Q&&!ce||this.len>1)&&ks(),Lr(),Ue}getFixedPosition(u,v,M){var we;let z=M.series,{chart:F,options:V,split:G}=this,Q=V.position,le=Q.relativeTo,ye=V.shared||(we=z==null?void 0:z.yAxis)!=null&&we.isRadial&&(le==="pane"||!le)?"plotBox":le,ce=ye==="chart"?F.renderer:F[ye]||F.getClipBox(z,!0);return{x:ce.x+(ce.width-u)*yf(Q.align)+Q.x,y:ce.y+(ce.height-v)*yf(Q.verticalAlign)+(!G&&Q.y||0)}}hide(u){let v=this;Qs.clearTimeout(this.hideTimer),u=Lh(u,this.options.hideDelay),this.isHidden||(this.hideTimer=xf(function(){let M=v.getLabel();v.getLabel().animate({opacity:0},{duration:u&&150,complete:()=>{M.hide(),v.container&&v.container.remove()}}),v.isHidden=!0},u))}init(u,v){this.chart=u,this.options=v,this.crosshairs=[],this.isHidden=!0,this.split=v.split&&!u.inverted&&!u.polar,this.shared=v.shared||this.split,this.outside=Lh(v.outside,!!(u.scrollablePixelsX||u.scrollablePixelsY))}shouldStickOnContact(u){return!!(!this.followPointer&&this.options.stickOnContact&&(!u||this.pointer.inClass(u.target,"highcharts-tooltip")))}move(u,v,M,z){let{followPointer:F,options:V}=this,G=tm(!F&&!this.isHidden&&!V.fixed&&V.animation),Q=F||(this.len||0)>1,le={x:u,y:v};Q?le.anchorX=le.anchorY=NaN:(le.anchorX=M,le.anchorY=z),G.step=()=>this.drawTracker(),this.getLabel().animate(le,G)}refresh(u,v){let{chart:M,options:z,pointer:F,shared:V}=this,G=$p(u),Q=G[0],le=z.format,ye=z.formatter||this.defaultFormatter,ce=M.styledMode,we=this.allowShared;if(!z.enabled||!Q.series)return;Qs.clearTimeout(this.hideTimer),this.allowShared=!(!ld(u)&&u.series&&u.series.noSharedTooltip),we=we&&!this.allowShared,this.followPointer=!this.split&&Q.series.tooltipOptions.followPointer;let Le=this.getAnchor(u,v),Ue=Le[0],et=Le[1];V&&this.allowShared&&(F.applyInactiveState(G),G.forEach(ht=>ht.setState("hover")),Q.points=G),this.len=G.length;let tt=ag(le)?dh(le,Q,M):ye.call(Q,this);Q.points=void 0;let $e=Q.series;if(this.distance=Lh($e.tooltipOptions.distance,16),tt===!1)this.hide();else{if(this.split&&this.allowShared)this.renderSplit(tt,G);else{let ht=Ue,yt=et;if(v&&F.isDirectTouch&&(ht=v.chartX-M.plotLeft,yt=v.chartY-M.plotTop),!(M.polar||$e.options.clip===!1||G.some(ci=>F.isDirectTouch||ci.series.shouldShowTooltip(ht,yt))))return void this.hide();{let ci=this.getLabel(we&&this.tt||{});(!z.style.width||ce)&&ci.css({width:(this.outside?this.getPlayingField():M.spacingBox).width+"px"}),ci.attr({class:this.getClassName(Q),text:tt&&tt.join?tt.join(""):tt}),this.outside&&ci.attr({x:Od(ci.x||0,0,this.getPlayingField().width-(ci.width||0)-1)}),ce||ci.attr({stroke:z.borderColor||Q.color||$e.color||"#666666"}),this.updatePosition({plotX:Ue,plotY:et,negative:Q.negative,ttBelow:Q.ttBelow,series:$e,h:Le[2]||0})}}this.isHidden&&this.label&&this.label.attr({opacity:1}).show(),this.isHidden=!1}rm(this,"refresh")}renderSplit(u,v){var Mn,Bh;let M=this,{chart:z,chart:{chartWidth:F,chartHeight:V,plotHeight:G,plotLeft:Q,plotTop:le,scrollablePixelsY:ye=0,scrollablePixelsX:ce,styledMode:we},distance:Le,options:Ue,options:{fixed:et,position:tt,positioner:$e},pointer:ht}=M,{scrollLeft:yt=0,scrollTop:ci=0}=((Mn=z.scrollablePlotArea)==null?void 0:Mn.scrollingContainer)||{},ii=M.outside&&typeof ce!="number"?Hp.documentElement.getBoundingClientRect():{left:yt,right:yt+F},ri=M.getLabel(),Ri=this.renderer||z.renderer,ki=!!((Bh=z.xAxis[0])!=null&&Bh.opposite),{left:Li,top:ls}=ht.getChartPosition(),vs=$e||et,Ys=le+ci,ks=0,Lr=G-ye,Cr=function($o,Ca,Do,go=[0,0],Al=!0){let oa,na;if(Do.isHeader)na=ki?0:Lr,oa=Od(go[0]-$o/2,ii.left,ii.right-$o-(M.outside?Li:0));else if(et&&Do){let ph=M.getFixedPosition($o,Ca,Do);oa=ph.x,na=ph.y-Ys}else na=go[1]-Ys,oa=Od(oa=Al?go[0]-$o-Le:go[0]+Le,Al?oa:ii.left,ii.right);return{x:oa,y:na}};ag(u)&&(u=[!1,u]);let Ur=u.slice(0,v.length+1).reduce(function($o,Ca,Do){if(Ca!==!1&&Ca!==""){let go=v[Do-1]||{isHeader:!0,plotX:v[0].plotX,plotY:G,series:{}},Al=go.isHeader,oa=Al?M:go.series,na=oa.tt=function(aa,il,zf){let ym=aa,{isHeader:Op,series:xm}=il,yd=xm.tooltipOptions||Ue;if(!ym){let Rf={padding:yd.padding,r:yd.borderRadius};we||(Rf.fill=yd.backgroundColor,Rf["stroke-width"]=yd.borderWidth??(et&&!Op?0:1)),ym=Ri.label("",0,0,yd[Op?"headerShape":"shape"]||(et&&!Op?"rect":"callout"),void 0,void 0,yd.useHTML).addClass(M.getClassName(il,!0,Op)).attr(Rf).add(ri)}return ym.isActive=!0,ym.attr({text:zf}),we||ym.css(yd.style).attr({stroke:yd.borderColor||il.color||xm.color||"#333333"}),ym}(oa.tt,go,Ca.toString()),ph=na.getBBox(),sh=ph.width+na.strokeWidth();Al&&(ks=ph.height,Lr+=ks,ki&&(Ys-=ks));let{anchorX:_u,anchorY:Ec}=function(aa){let il,zf,{isHeader:ym,plotX:Op=0,plotY:xm=0,series:yd}=aa;if(ym)il=Math.max(Q+Op,Q),zf=le+G/2;else{let{xAxis:Rf,yAxis:Yy}=yd;il=Rf.pos+Od(Op,-Le,Rf.len+Le),yd.shouldShowTooltip(0,Yy.pos-le+xm,{ignoreX:!0})&&(zf=Yy.pos+xm)}return{anchorX:il=Od(il,ii.left-Le,ii.right+Le),anchorY:zf}}(go);if(typeof Ec=="number"){let aa=ph.height+1,il=($e||Cr).call(M,sh,aa,go,[_u,Ec]);$o.push({align:vs?0:void 0,anchorX:_u,anchorY:Ec,boxWidth:sh,point:go,rank:Lh(il.rank,+!!Al),size:aa,target:il.y,tt:na,x:il.x})}else na.isActive=!1}return $o},[]);!vs&&Ur.some($o=>{let{outside:Ca}=M,Do=(Ca?Li:0)+$o.anchorX;return Do<ii.left&&Do+$o.boxWidth<ii.right||Do<Li-ii.left+$o.boxWidth&&ii.right-Do>Do})&&(Ur=Ur.map($o=>{let{x:Ca,y:Do}=Cr.call(this,$o.boxWidth,$o.size,$o.point,[$o.anchorX,$o.anchorY],!1);return Xp($o,{target:Do,x:Ca})})),M.cleanSplit(),ep(Ur,Lr);let nr={left:Li,right:Li};Ur.forEach(function($o){let{x:Ca,boxWidth:Do,isHeader:go}=$o;!go&&(M.outside&&Li+Ca<nr.left&&(nr.left=Li+Ca),!go&&M.outside&&nr.left+Do>nr.right&&(nr.right=Li+Ca))}),Ur.forEach(function($o){let{x:Ca,anchorX:Do,anchorY:go,pos:Al,point:{isHeader:oa}}=$o,na={visibility:Al===void 0?"hidden":"inherit",x:Ca,y:(Al||0)+Ys+(et&&tt.y||0),anchorX:Do,anchorY:go};if(M.outside&&Ca<Do){let ph=Li-nr.left;ph>0&&(oa||(na.x=Ca+ph,na.anchorX=Do+ph),oa&&(na.x=(nr.right-nr.left)/2,na.anchorX=Do+ph))}$o.tt.attr(na)});let{container:Yr,outside:En,renderer:Sn}=M;if(En&&Yr&&Sn){let{width:$o,height:Ca,x:Do,y:go}=ri.getBBox();Sn.setSize($o+Do,Ca+go,!1),Yr.style.left=nr.left+"px",Yr.style.top=ls+"px"}Qu&&ri.attr({opacity:ri.opacity===1?.999:1})}drawTracker(){if(!this.shouldStickOnContact()){this.tracker&&(this.tracker=this.tracker.destroy());return}let u=this.chart,v=this.label,M=this.shared?u.hoverPoints:u.hoverPoint;if(!v||!M)return;let z={x:0,y:0,width:0,height:0},F=this.getAnchor(M),V=v.getBBox();F[0]+=u.plotLeft-(v.translateX||0),F[1]+=u.plotTop-(v.translateY||0),z.x=Math.min(0,F[0]),z.y=Math.min(0,F[1]),z.width=F[0]<0?Math.max(Math.abs(F[0]),V.width-F[0]):Math.max(Math.abs(F[0]),V.width),z.height=F[1]<0?Math.max(Math.abs(F[1]),V.height-Math.abs(F[1])):Math.max(Math.abs(F[1]),V.height),this.tracker?this.tracker.attr(z):(this.tracker=v.renderer.rect(z).addClass("highcharts-tracker").add(v),u.styledMode||this.tracker.attr({fill:"rgba(0,0,0,0)"}))}styledModeFormat(u){return u.replace('style="font-size: 0.8em"','class="highcharts-header"').replace(/style="color:{(point|series)\.color}"/g,'class="highcharts-color-{$1.colorIndex} {series.options.className} {point.options.className}"')}headerFooterFormatter(u,v){let M=u.series,z=M.tooltipOptions,F=M.xAxis,V=F==null?void 0:F.dateTime,G={isFooter:v,point:u},Q=z.xDateFormat||"",le=z[v?"footerFormat":"headerFormat"];return rm(this,"headerFormatter",G,function(ye){if(V&&!Q&&zu(u.key)&&(Q=V.getXDateFormat(u.key,z.dateTimeLabelFormats)),V&&Q){if(ng(Q)){let ce=Q;Ju[0]=we=>M.chart.time.dateFormat(ce,we),Q="%0"}(u.tooltipDateKeys||["key"]).forEach(ce=>{le=le.replace(RegExp("point\\."+ce+"([ \\)}])"),`(point.${ce}:${Q})$1`)})}M.chart.styledMode&&(le=this.styledModeFormat(le)),ye.text=dh(le,u,this.chart)}),G.text||""}update(u){this.destroy(),this.init(this.chart,Yp(!0,this.options,u))}updatePosition(u){var ii;let{chart:v,container:M,distance:z,options:F,pointer:V,renderer:G}=this,{height:Q=0,width:le=0}=this.getLabel(),{fixed:ye,positioner:ce}=F,{left:we,top:Le,scaleX:Ue,scaleY:et}=V.getChartPosition(),tt=(ce||ye&&this.getFixedPosition||this.getPosition).call(this,le,Q,u),$e=Pi.doc,ht=(u.plotX||0)+v.plotLeft,yt=(u.plotY||0)+v.plotTop,ci;if(G&&M){if(ce||ye){let{scrollLeft:ri=0,scrollTop:Ri=0}=((ii=v.scrollablePlotArea)==null?void 0:ii.scrollingContainer)||{};tt.x+=ri+we-z,tt.y+=Ri+Le-z}ci=(F.borderWidth||0)+2*z+2,G.setSize(Od(le+ci,0,$e.documentElement.clientWidth)-1,Q+ci,!1),(Ue!==1||et!==1)&&(au(M,{transform:`scale(${Ue}, ${et})`}),ht*=Ue,yt*=et),ht+=we-tt.x,yt+=Le-tt.y}this.move(Math.round(tt.x),Math.round(tt.y||0),ht,yt)}}(function(he){he.compose=function(u){lg(Gc,"Core.Tooltip")&&im(u,"afterInit",function(){let v=this.chart;v.options.tooltip&&(v.tooltip=new he(v,v.options.tooltip,this))})}})(_f||(_f={}));let Oh=_f,{animObject:om}=Ws,{defaultOptions:Ru}=Za,{format:vf}=Ma,{addEvent:lu,crisp:ac,erase:qp,extend:lc,fireEvent:vp,getNestedProperty:bp,isArray:nm,isFunction:Om,isNumber:hd,isObject:Bu,merge:Zp,pick:Wc,syncTimeout:cd,removeEvent:bf,uniqueKey:Dm}=Qs;class _h{animateBeforeDestroy(){let u=this,v={x:u.startXPos,opacity:0},M=u.getGraphicalProps();M.singular.forEach(function(z){u[z]=u[z].animate(z==="dataLabel"?{x:u[z].startXPos,y:u[z].startYPos,opacity:0}:v)}),M.plural.forEach(function(z){u[z].forEach(function(F){F.element&&F.animate(lc({x:u.startXPos},F.startYPos?{x:F.startXPos,y:F.startYPos}:{}))})})}applyOptions(u,v){let M=this.series,z=M.options.pointValKey||M.pointValKey;return lc(this,u=_h.prototype.optionsToObject.call(this,u)),this.options=this.options?lc(this.options,u):u,u.group&&delete this.group,u.dataLabels&&delete this.dataLabels,z&&(this.y=_h.prototype.getNestedProperty.call(this,z)),this.selected&&(this.state="select"),"name"in this&&v===void 0&&M.xAxis&&M.xAxis.hasNames&&(this.x=M.xAxis.nameToX(this)),this.x===void 0&&M?this.x=v??M.autoIncrement():hd(u.x)&&M.options.relativeXValue?this.x=M.autoIncrement(u.x):typeof this.x=="string"&&(v??(v=M.chart.time.parse(this.x)),hd(v)&&(this.x=v)),this.isNull=this.isValid&&!this.isValid(),this.formatPrefix=this.isNull?"null":"point",this}destroy(){if(!this.destroyed){let u=this,v=u.series,M=v.chart,z=v.options.dataSorting,F=M.hoverPoints,V=om(u.series.chart.renderer.globalAnimation),G=()=>{for(let Q in(u.graphic||u.graphics||u.dataLabel||u.dataLabels)&&(bf(u),u.destroyElements()),u)delete u[Q]};u.legendItem&&M.legend.destroyItem(u),F&&(u.setState(),qp(F,u),F.length||(M.hoverPoints=null)),u===M.hoverPoint&&u.onMouseOut(),z!=null&&z.enabled?(this.animateBeforeDestroy(),cd(G,V.duration)):G(),M.pointCount--}this.destroyed=!0}destroyElements(u){let v=this,M=v.getGraphicalProps(u);M.singular.forEach(function(z){v[z]=v[z].destroy()}),M.plural.forEach(function(z){v[z].forEach(function(F){F!=null&&F.element&&F.destroy()}),delete v[z]})}firePointEvent(u,v,M){let z=this,F=this.series.options;z.manageEvent(u),u==="click"&&F.allowPointSelect&&(M=function(V){!z.destroyed&&z.select&&z.select(null,V.ctrlKey||V.metaKey||V.shiftKey)}),vp(z,u,v,M)}getClassName(){var u;return"highcharts-point"+(this.selected?" highcharts-point-select":"")+(this.negative?" highcharts-negative":"")+(this.isNull?" highcharts-null-point":"")+(this.colorIndex!==void 0?" highcharts-color-"+this.colorIndex:"")+(this.options.className?" "+this.options.className:"")+((u=this.zone)!=null&&u.className?" "+this.zone.className.replace("highcharts-negative",""):"")}getGraphicalProps(u){let v,M,z=this,F=[],V={singular:[],plural:[]};for((u=u||{graphic:1,dataLabel:1}).graphic&&F.push("graphic","connector"),u.dataLabel&&F.push("dataLabel","dataLabelPath","dataLabelUpper"),M=F.length;M--;)z[v=F[M]]&&V.singular.push(v);return["graphic","dataLabel"].forEach(function(G){let Q=G+"s";u[G]&&z[Q]&&V.plural.push(Q)}),V}getNestedProperty(u){if(u)return u.indexOf("custom.")===0?bp(u,this.options):this[u]}getZone(){let u=this.series,v=u.zones,M=u.zoneAxis||"y",z,F=0;for(z=v[0];this[M]>=z.value;)z=v[++F];return this.nonZonedColor||(this.nonZonedColor=this.color),z!=null&&z.color&&!this.options.color?this.color=z.color:this.color=this.nonZonedColor,z}hasNewShapeType(){return(this.graphic&&(this.graphic.symbolName||this.graphic.element.nodeName))!==this.shapeType}constructor(u,v,M){this.formatPrefix="point",this.visible=!0,this.point=this,this.series=u,this.applyOptions(v,M),this.id??(this.id=Dm()),this.resolveColor(),this.dataLabelOnNull??(this.dataLabelOnNull=u.options.nullInteraction),u.chart.pointCount++,vp(this,"afterInit")}isValid(){return(hd(this.x)||this.x instanceof Date)&&hd(this.y)}optionsToObject(u){var ye;let v=this.series,M=v.options.keys,z=M||v.pointArrayMap||["y"],F=z.length,V={},G,Q=0,le=0;if(hd(u)||u===null)V[z[0]]=u;else if(nm(u))for(!M&&u.length>F&&((G=typeof u[0])=="string"?(ye=v.xAxis)!=null&&ye.dateTime?V.x=v.chart.time.parse(u[0]):V.name=u[0]:G==="number"&&(V.x=u[0]),Q++);le<F;)M&&u[Q]===void 0||(z[le].indexOf(".")>0?_h.prototype.setNestedProperty(V,u[Q],z[le]):V[z[le]]=u[Q]),Q++,le++;else typeof u=="object"&&(V=u,u.dataLabels&&(v.hasDataLabels=()=>!0),u.marker&&(v._hasPointMarkers=!0));return V}pos(u,v=this.plotY){if(!this.destroyed){let{plotX:M,series:z}=this,{chart:F,xAxis:V,yAxis:G}=z,Q=0,le=0;if(hd(M)&&hd(v))return u&&(Q=V?V.pos:F.plotLeft,le=G?G.pos:F.plotTop),F.inverted&&V&&G?[G.len-v+le,V.len-M+Q]:[M+Q,v+le]}}resolveColor(){let u=this.series,v=u.chart.options.chart,M=u.chart.styledMode,z,F,V=v.colorCount,G;delete this.nonZonedColor,u.options.colorByPoint?(M||(z=(F=u.options.colors||u.chart.options.colors)[u.colorCounter],V=F.length),G=u.colorCounter,u.colorCounter++,u.colorCounter===V&&(u.colorCounter=0)):(M||(z=u.color),G=u.colorIndex),this.colorIndex=Wc(this.options.colorIndex,G),this.color=Wc(this.options.color,z)}setNestedProperty(u,v,M){return M.split(".").reduce(function(z,F,V,G){let Q=G.length-1===V;return z[F]=Q?v:Bu(z[F],!0)?z[F]:{},z[F]},u),u}shouldDraw(){return!this.isNull}tooltipFormatter(u){var Q;let{chart:v,pointArrayMap:M=["y"],tooltipOptions:z}=this.series,{valueDecimals:F="",valuePrefix:V="",valueSuffix:G=""}=z;return v.styledMode&&(u=((Q=v.tooltip)==null?void 0:Q.styledModeFormat(u))||u),M.forEach(le=>{le="{point."+le,(V||G)&&(u=u.replace(RegExp(le+"}","g"),V+le+"}"+G)),u=u.replace(RegExp(le+"}","g"),le+":,."+F+"f}")}),vf(u,this,v)}update(u,v,M,z){let F,V=this,G=V.series,Q=V.graphic,le=G.chart,ye=G.options;function ce(){V.applyOptions(u);let we=Q&&V.hasMockGraphic,Le=V.y===null?!we:we;Q&&Le&&(V.graphic=Q.destroy(),delete V.hasMockGraphic),Bu(u,!0)&&(Q!=null&&Q.element&&u&&u.marker&&u.marker.symbol!==void 0&&(V.graphic=Q.destroy()),u!=null&&u.dataLabels&&V.dataLabel&&(V.dataLabel=V.dataLabel.destroy())),F=V.index;let Ue={};for(let et of G.dataColumnKeys())Ue[et]=V[et];G.dataTable.setRow(Ue,F),ye.data[F]=Bu(ye.data[F],!0)||Bu(u,!0)?V.options:Wc(u,ye.data[F]),G.isDirty=G.isDirtyData=!0,!G.fixedBox&&G.hasCartesianSeries&&(le.isDirtyBox=!0),ye.legendType==="point"&&(le.isDirtyLegend=!0),v&&le.redraw(M)}v=Wc(v,!0),z===!1?ce():V.firePointEvent("update",{options:u},ce)}remove(u,v){this.series.removePoint(this.series.data.indexOf(this),u,v)}select(u,v){let M=this,z=M.series,F=z.chart;u=Wc(u,!M.selected),this.selectedStaging=u,M.firePointEvent(u?"select":"unselect",{accumulate:v},function(){M.selected=M.options.selected=u,z.options.data[z.data.indexOf(M)]=M.options,M.setState(u&&"select"),v||F.getSelectedPoints().forEach(function(V){let G=V.series;V.selected&&V!==M&&(V.selected=V.options.selected=!1,G.options.data[G.data.indexOf(V)]=V.options,V.setState(F.hoverPoints&&G.options.inactiveOtherPoints?"inactive":""),V.firePointEvent("unselect"))})}),delete this.selectedStaging}onMouseOver(u){let{inverted:v,pointer:M}=this.series.chart;M&&(u=u?M.normalize(u):M.getChartCoordinatesFromPoint(this,v),M.runPointActions(u,this))}onMouseOut(){let u=this.series.chart;this.firePointEvent("mouseOut"),this.series.options.inactiveOtherPoints||(u.hoverPoints||[]).forEach(function(v){v.setState()}),u.hoverPoints=u.hoverPoint=null}manageEvent(u){var z,F,V,G,Q,le,ye;let v=Zp(this.series.options.point,this.options),M=(z=v.events)==null?void 0:z[u];Om(M)&&(!((F=this.hcEvents)!=null&&F[u])||((G=(V=this.hcEvents)==null?void 0:V[u])==null?void 0:G.map(ce=>ce.fn).indexOf(M))===-1)?((Q=this.importedUserEvent)==null||Q.call(this),this.importedUserEvent=lu(this,u,M),this.hcEvents&&(this.hcEvents[u].userEvent=!0)):this.importedUserEvent&&!M&&((le=this.hcEvents)!=null&&le[u])&&((ye=this.hcEvents)!=null&&ye[u].userEvent)&&(bf(this,u),delete this.hcEvents[u],Object.keys(this.hcEvents)||delete this.importedUserEvent)}setState(u,v){var ri,Ri;let M=this.series,z=this.state,F=M.options.states[u||"normal"]||{},V=Ru.plotOptions[M.type].marker&&M.options.marker,G=V&&V.enabled===!1,Q=((ri=V==null?void 0:V.states)==null?void 0:ri[u||"normal"])||{},le=Q.enabled===!1,ye=this.marker||{},ce=M.chart,we=V&&M.markerAttribs,Le=M.halo,Ue,et,tt,$e=M.stateMarkerGraphic,ht;if((u=u||"")===this.state&&!v||this.selected&&u!=="select"||F.enabled===!1||u&&(le||G&&Q.enabled===!1)||u&&ye.states&&ye.states[u]&&ye.states[u].enabled===!1)return;if(this.state=u,we&&(Ue=M.markerAttribs(this,u)),this.graphic&&!this.hasMockGraphic){if(z&&this.graphic.removeClass("highcharts-point-"+z),u&&this.graphic.addClass("highcharts-point-"+u),!ce.styledMode){et=M.pointAttribs(this,u),tt=Wc(ce.options.chart.animation,F.animation);let ki=et.opacity;M.options.inactiveOtherPoints&&hd(ki)&&(this.dataLabels||[]).forEach(function(Li){Li&&!Li.hasClass("highcharts-data-label-hidden")&&(Li.animate({opacity:ki},tt),Li.connector&&Li.connector.animate({opacity:ki},tt))}),this.graphic.animate(et,tt)}Ue&&this.graphic.animate(Ue,Wc(ce.options.chart.animation,Q.animation,V.animation)),$e&&$e.hide()}else u&&Q&&(ht=ye.symbol||M.symbol,$e&&$e.currentSymbol!==ht&&($e=$e.destroy()),Ue&&($e?$e[v?"animate":"attr"]({x:Ue.x,y:Ue.y}):ht&&(M.stateMarkerGraphic=$e=ce.renderer.symbol(ht,Ue.x,Ue.y,Ue.width,Ue.height,Zp(V,Q)).add(M.markerGroup),$e.currentSymbol=ht)),!ce.styledMode&&$e&&this.state!=="inactive"&&$e.attr(M.pointAttribs(this,u))),$e&&($e[u&&this.isInside?"show":"hide"](),$e.element.point=this,$e.addClass(this.getClassName(),!0));let yt=F.halo,ci=this.graphic||$e,ii=(ci==null?void 0:ci.visibility)||"inherit";yt!=null&&yt.size&&ci&&ii!=="hidden"&&!this.isCluster?(Le||(M.halo=Le=ce.renderer.path().add(ci.parentGroup)),Le.show()[v?"animate":"attr"]({d:this.haloPath(yt.size)}),Le.attr({class:"highcharts-halo highcharts-color-"+Wc(this.colorIndex,M.colorIndex)+(this.className?" "+this.className:""),visibility:ii,zIndex:-1}),Le.point=this,ce.styledMode||Le.attr(lc({fill:this.color||M.color,"fill-opacity":yt.opacity},an.filterUserAttributes(yt.attributes||{})))):(Ri=Le==null?void 0:Le.point)!=null&&Ri.haloPath&&!Le.point.destroyed&&Le.animate({d:Le.point.haloPath(0)},null,Le.hide),vp(this,"afterSetState",{state:u})}haloPath(u){let v=this.pos();return v?this.series.chart.renderer.symbols.circle(ac(v[0],1)-u,v[1]-u,2*u,2*u):[]}}let bn=_h,{parse:wp}=lr,{charts:Ge,composed:J,isTouchDevice:ge}=Pi,{addEvent:xe,attr:Ie,css:je,extend:Ye,find:mt,fireEvent:bt,isNumber:Bt,isObject:gt,objectEach:Lt,offset:qe,pick:vt,pushUnique:_t,splat:Wt}=Qs;class Gt{applyInactiveState(u=[]){let v=[];u.forEach(M=>{let z=M.series;v.push(z),z.linkedParent&&v.push(z.linkedParent),z.linkedSeries&&v.push.apply(v,z.linkedSeries),z.navigatorSeries&&v.push(z.navigatorSeries),z.boosted&&z.markerGroup&&v.push.apply(v,this.chart.series.filter(F=>F.markerGroup===z.markerGroup))}),this.chart.series.forEach(M=>{v.indexOf(M)===-1?M.setState("inactive",!0):M.options.inactiveOtherPoints&&M.setAllPointsToState("inactive")})}destroy(){let u=this;this.eventsToUnbind.forEach(v=>v()),this.eventsToUnbind=[],!Pi.chartCount&&(Gt.unbindDocumentMouseUp.forEach(v=>v.unbind()),Gt.unbindDocumentMouseUp.length=0,Gt.unbindDocumentTouchEnd&&(Gt.unbindDocumentTouchEnd=Gt.unbindDocumentTouchEnd())),clearInterval(u.tooltipTimeout),Lt(u,function(v,M){u[M]=void 0})}getSelectionMarkerAttrs(u,v){let M={args:{chartX:u,chartY:v},attrs:{},shapeType:"rect"};return bt(this,"getSelectionMarkerAttrs",M,z=>{let F,{chart:V,zoomHor:G,zoomVert:Q}=this,{mouseDownX:le=0,mouseDownY:ye=0}=V,ce=z.attrs;ce.x=V.plotLeft,ce.y=V.plotTop,ce.width=G?1:V.plotWidth,ce.height=Q?1:V.plotHeight,G&&(ce.width=Math.max(1,Math.abs(F=u-le)),ce.x=(F>0?0:F)+le),Q&&(ce.height=Math.max(1,Math.abs(F=v-ye)),ce.y=(F>0?0:F)+ye)}),M}drag(u){let{chart:v}=this,{mouseDownX:M=0,mouseDownY:z=0}=v,{panning:F,panKey:V,selectionMarkerFill:G}=v.options.chart,Q=v.plotLeft,le=v.plotTop,ye=v.plotWidth,ce=v.plotHeight,we=gt(F)?F.enabled:F,Le=V&&u[`${V}Key`],Ue=u.chartX,et=u.chartY,tt,$e=this.selectionMarker;if((!$e||!$e.touch)&&(Ue<Q?Ue=Q:Ue>Q+ye&&(Ue=Q+ye),et<le?et=le:et>le+ce&&(et=le+ce),this.hasDragged=Math.sqrt(Math.pow(M-Ue,2)+Math.pow(z-et,2)),this.hasDragged>10)){tt=v.isInsidePlot(M-Q,z-le,{visiblePlotOnly:!0});let{shapeType:ht,attrs:yt}=this.getSelectionMarkerAttrs(Ue,et);this.hasZoom&&tt&&!Le&&!$e&&(this.selectionMarker=$e=v.renderer[ht](),$e.attr({class:"highcharts-selection-marker",zIndex:7}).add(),v.styledMode||$e.attr({fill:G||wp("#334eff").setOpacity(.25).get()})),$e&&$e.attr(yt),tt&&!$e&&we&&v.pan(u,F)}}dragStart(u){let v=this.chart;v.mouseIsDown=u.type,v.cancelClick=!1,v.mouseDownX=u.chartX,v.mouseDownY=u.chartY}getSelectionBox(u){let v={args:{marker:u},result:u.getBBox()};return bt(this,"getSelectionBox",v),v.result}drop(u){let v,{chart:M,selectionMarker:z}=this;for(let F of M.axes)F.isPanning&&(F.isPanning=!1,(F.options.startOnTick||F.options.endOnTick||F.series.some(V=>V.boosted))&&(F.forceRedraw=!0,F.setExtremes(F.userMin,F.userMax,!1),v=!0));if(v&&M.redraw(),z&&u){if(this.hasDragged){let F=this.getSelectionBox(z);M.transform({axes:M.axes.filter(V=>V.zoomEnabled&&(V.coll==="xAxis"&&this.zoomX||V.coll==="yAxis"&&this.zoomY)),selection:{originalEvent:u,xAxis:[],yAxis:[],...F},from:F})}Bt(M.index)&&(this.selectionMarker=z.destroy())}M&&Bt(M.index)&&(je(M.container,{cursor:M._cursor}),M.cancelClick=this.hasDragged>10,M.mouseIsDown=!1,this.hasDragged=0,this.pinchDown=[])}findNearestKDPoint(u,v,M){let z;return u.forEach(function(F){let V=!(F.noSharedTooltip&&v)&&0>F.options.findNearestPointBy.indexOf("y"),G=F.searchPoint(M,V);gt(G,!0)&&G.series&&(!gt(z,!0)||function(Q,le){var Le,Ue;let ye=Q.distX-le.distX,ce=Q.dist-le.dist,we=((Le=le.series.group)==null?void 0:Le.zIndex)-((Ue=Q.series.group)==null?void 0:Ue.zIndex);return ye!==0&&v?ye:ce!==0?ce:we!==0?we:Q.series.index>le.series.index?-1:1}(z,G)>0)&&(z=G)}),z}getChartCoordinatesFromPoint(u,v){let{xAxis:M,yAxis:z}=u.series,F=u.shapeArgs;if(M&&z){let V=u.clientX??u.plotX??0,G=u.plotY||0;return u.isNode&&F&&Bt(F.x)&&Bt(F.y)&&(V=F.x,G=F.y),v?{chartX:z.len+z.pos-G,chartY:M.len+M.pos-V}:{chartX:V+M.pos,chartY:G+z.pos}}if(F!=null&&F.x&&F.y)return{chartX:F.x,chartY:F.y}}getChartPosition(){if(this.chartPosition)return this.chartPosition;let{container:u}=this.chart,v=qe(u);this.chartPosition={left:v.left,top:v.top,scaleX:1,scaleY:1};let{offsetHeight:M,offsetWidth:z}=u;return z>2&&M>2&&(this.chartPosition.scaleX=v.width/z,this.chartPosition.scaleY=v.height/M),this.chartPosition}getCoordinates(u){let v={xAxis:[],yAxis:[]};for(let M of this.chart.axes)v[M.isXAxis?"xAxis":"yAxis"].push({axis:M,value:M.toValue(u[M.horiz?"chartX":"chartY"])});return v}getHoverData(u,v,M,z,F,V){let G=[],Q=function(Le){return Le.visible&&!(!F&&Le.directTouch)&&vt(Le.options.enableMouseTracking,!0)},le=v,ye,ce={chartX:V?V.chartX:void 0,chartY:V?V.chartY:void 0,shared:F};bt(this,"beforeGetHoverData",ce),ye=le&&!le.stickyTracking?[le]:M.filter(Le=>Le.stickyTracking&&(ce.filter||Q)(Le));let we=z&&u||!V?u:this.findNearestKDPoint(ye,F,V);return le=we==null?void 0:we.series,we&&(F&&!le.noSharedTooltip?(ye=M.filter(function(Le){return ce.filter?ce.filter(Le):Q(Le)&&!Le.noSharedTooltip})).forEach(function(Le){var tt;let Ue=(tt=Le.options)==null?void 0:tt.nullInteraction,et=mt(Le.points,function($e){return $e.x===we.x&&(!$e.isNull||!!Ue)});gt(et)&&(Le.boosted&&Le.boost&&(et=Le.boost.getPoint(et)),G.push(et))}):G.push(we)),bt(this,"afterGetHoverData",ce={hoverPoint:we}),{hoverPoint:ce.hoverPoint,hoverSeries:le,hoverPoints:G}}getPointFromEvent(u){let v=u.target,M;for(;v&&!M;)M=v.point,v=v.parentNode;return M}onTrackerMouseOut(u){let v=this.chart,M=u.relatedTarget,z=v.hoverSeries;this.isDirectTouch=!1,!z||!M||z.stickyTracking||this.inClass(M,"highcharts-tooltip")||this.inClass(M,"highcharts-series-"+z.index)&&this.inClass(M,"highcharts-tracker")||z.onMouseOut()}inClass(u,v){let M=u,z;for(;M;){if(z=Ie(M,"class")){if(z.indexOf(v)!==-1)return!0;if(z.indexOf("highcharts-container")!==-1)return!1}M=M.parentElement}}constructor(u,v){var M;this.hasDragged=0,this.pointerCaptureEventsToUnbind=[],this.eventsToUnbind=[],this.options=v,this.chart=u,this.runChartClick=!!((M=v.chart.events)!=null&&M.click),this.pinchDown=[],this.setDOMEvents(),bt(this,"afterInit")}normalize(u,v){let M=u.touches,z=M?M.length?M.item(0):vt(M.changedTouches,u.changedTouches)[0]:u;v||(v=this.getChartPosition());let F=z.pageX-v.left,V=z.pageY-v.top;return Ye(u,{chartX:Math.round(F/=v.scaleX),chartY:Math.round(V/=v.scaleY)})}onContainerClick(u){let v=this.chart,M=v.hoverPoint,z=this.normalize(u),F=v.plotLeft,V=v.plotTop;!v.cancelClick&&(M&&this.inClass(z.target,"highcharts-tracker")?(bt(M.series,"click",Ye(z,{point:M})),v.hoverPoint&&M.firePointEvent("click",z)):(Ye(z,this.getCoordinates(z)),v.isInsidePlot(z.chartX-F,z.chartY-V,{visiblePlotOnly:!0})&&bt(v,"click",z)))}onContainerMouseDown(u){var M;let v=(1&(u.buttons||u.button))==1;u=this.normalize(u),Pi.isFirefox&&u.button!==0&&this.onContainerMouseMove(u),(u.button===void 0||v)&&(this.zoomOption(u),v&&((M=u.preventDefault)==null||M.call(u)),this.dragStart(u))}onContainerMouseLeave(u){let{pointer:v}=Ge[vt(Gt.hoverChartIndex,-1)]||{};u=this.normalize(u),this.onContainerMouseMove(u),v&&!this.inClass(u.relatedTarget,"highcharts-tooltip")&&(v.reset(),v.chartPosition=void 0)}onContainerMouseEnter(){delete this.chartPosition}onContainerMouseMove(u){var F;let v=this.chart,M=v.tooltip,z=this.normalize(u);this.setHoverChartIndex(u),(v.mouseIsDown==="mousedown"||this.touchSelect(z))&&this.drag(z),!((F=v.exporting)!=null&&F.openMenu)&&(this.inClass(z.target,"highcharts-tracker")||v.isInsidePlot(z.chartX-v.plotLeft,z.chartY-v.plotTop,{visiblePlotOnly:!0}))&&!(M!=null&&M.shouldStickOnContact(z))&&(this.inClass(z.target,"highcharts-no-tooltip")?this.reset(!1,0):this.runPointActions(z))}onDocumentTouchEnd(u){this.onDocumentMouseUp(u)}onContainerTouchMove(u){this.touchSelect(u)?this.onContainerMouseMove(u):this.touch(u)}onContainerTouchStart(u){this.touchSelect(u)?this.onContainerMouseDown(u):(this.zoomOption(u),this.touch(u,!0))}onDocumentMouseMove(u){let v=this.chart,M=v.tooltip,z=this.chartPosition,F=this.normalize(u,z);!z||v.isInsidePlot(F.chartX-v.plotLeft,F.chartY-v.plotTop,{visiblePlotOnly:!0})||M!=null&&M.shouldStickOnContact(F)||F.target!==v.container.ownerDocument&&this.inClass(F.target,"highcharts-tracker")||this.reset()}onDocumentMouseUp(u){var v,M;(M=(v=Ge[vt(Gt.hoverChartIndex,-1)])==null?void 0:v.pointer)==null||M.drop(u)}pinch(u){let v=this,{chart:M,hasZoom:z,lastTouches:F}=v,V=[].map.call(u.touches||[],ce=>v.normalize(ce)),G=V.length,Q=G===1&&(v.inClass(u.target,"highcharts-tracker")&&M.runTrackerClick||v.runChartClick),le=M.tooltip,ye=G===1&&vt(le==null?void 0:le.options.followTouchMove,!0);G>1?v.initiated=!0:ye&&(v.initiated=!1),z&&v.initiated&&!Q&&u.cancelable!==!1&&u.preventDefault(),u.type==="touchstart"?(v.pinchDown=V,v.res=!0,M.mouseDownX=u.chartX):ye?this.runPointActions(v.normalize(u)):F&&(bt(M,"touchpan",{originalEvent:u,touches:V},()=>{let ce=we=>{let Le=we[0],Ue=we[1]||Le;return{x:Le.chartX,y:Le.chartY,width:Ue.chartX-Le.chartX,height:Ue.chartY-Le.chartY}};M.transform({axes:M.axes.filter(we=>we.zoomEnabled&&(this.zoomHor&&we.horiz||this.zoomVert&&!we.horiz)),to:ce(V),from:ce(F),trigger:u.type})}),v.res&&(v.res=!1,this.reset(!1,0))),v.lastTouches=V}reset(u,v){let M=this.chart,z=M.hoverSeries,F=M.hoverPoint,V=M.hoverPoints,G=M.tooltip,Q=G!=null&&G.shared?V:F;u&&Q&&Wt(Q).forEach(function(le){le.series.isCartesian&&le.plotX===void 0&&(u=!1)}),u?G&&Q&&Wt(Q).length&&(G.refresh(Q),G.shared&&V?V.forEach(function(le){le.setState(le.state,!0),le.series.isCartesian&&(le.series.xAxis.crosshair&&le.series.xAxis.drawCrosshair(null,le),le.series.yAxis.crosshair&&le.series.yAxis.drawCrosshair(null,le))}):F&&(F.setState(F.state,!0),M.axes.forEach(function(le){le.crosshair&&F.series[le.coll]===le&&le.drawCrosshair(null,F)}))):(F&&F.onMouseOut(),V&&V.forEach(function(le){le.setState()}),z&&z.onMouseOut(),G&&G.hide(v),this.unDocMouseMove&&(this.unDocMouseMove=this.unDocMouseMove()),M.axes.forEach(function(le){le.hideCrosshair()}),M.hoverPoints=M.hoverPoint=void 0)}runPointActions(u,v,M){var et;let z=this.chart,F=z.series,V=(et=z.tooltip)!=null&&et.options.enabled?z.tooltip:void 0,G=!!V&&V.shared,Q=v||z.hoverPoint,le=(Q==null?void 0:Q.series)||z.hoverSeries,ye=(!u||u.type!=="touchmove")&&(!!v||(le==null?void 0:le.directTouch)&&this.isDirectTouch),ce=this.getHoverData(Q,le,F,ye,G,u);Q=ce.hoverPoint,le=ce.hoverSeries;let we=ce.hoverPoints,Le=(le==null?void 0:le.tooltipOptions.followPointer)&&!le.tooltipOptions.split,Ue=G&&le&&!le.noSharedTooltip;if(Q&&(M||Q!==z.hoverPoint||V!=null&&V.isHidden)){if((z.hoverPoints||[]).forEach(function(tt){we.indexOf(tt)===-1&&tt.setState()}),z.hoverSeries!==le&&le.onMouseOver(),this.applyInactiveState(we),(we||[]).forEach(function(tt){tt.setState("hover")}),z.hoverPoint&&z.hoverPoint.firePointEvent("mouseOut"),!Q.series)return;z.hoverPoints=we,z.hoverPoint=Q,Q.firePointEvent("mouseOver",void 0,()=>{V&&Q&&V.refresh(Ue?we:Q,u)})}else if(Le&&V&&!V.isHidden){let tt=V.getAnchor([{}],u);z.isInsidePlot(tt[0],tt[1],{visiblePlotOnly:!0})&&V.updatePosition({plotX:tt[0],plotY:tt[1]})}this.unDocMouseMove||(this.unDocMouseMove=xe(z.container.ownerDocument,"mousemove",tt=>{var $e,ht;return(ht=($e=Ge[Gt.hoverChartIndex??-1])==null?void 0:$e.pointer)==null?void 0:ht.onDocumentMouseMove(tt)}),this.eventsToUnbind.push(this.unDocMouseMove)),z.axes.forEach(function(tt){var yt;let $e,ht=((yt=tt.crosshair)==null?void 0:yt.snap)??!0;ht&&(($e=z.hoverPoint)&&$e.series[tt.coll]===tt||($e=mt(we,ci=>{var ii;return((ii=ci.series)==null?void 0:ii[tt.coll])===tt}))),$e||!ht?tt.drawCrosshair(u,$e):tt.hideCrosshair()})}setDOMEvents(){let u=this.chart.container,v=u.ownerDocument;u.onmousedown=this.onContainerMouseDown.bind(this),u.onmousemove=this.onContainerMouseMove.bind(this),u.onclick=this.onContainerClick.bind(this),this.eventsToUnbind.push(xe(u,"mouseenter",this.onContainerMouseEnter.bind(this)),xe(u,"mouseleave",this.onContainerMouseLeave.bind(this))),Gt.unbindDocumentMouseUp.some(z=>z.doc===v)||Gt.unbindDocumentMouseUp.push({doc:v,unbind:xe(v,"mouseup",this.onDocumentMouseUp.bind(this))});let M=this.chart.renderTo.parentElement;for(;M&&M.tagName!=="BODY";)this.eventsToUnbind.push(xe(M,"scroll",()=>{delete this.chartPosition})),M=M.parentElement;this.eventsToUnbind.push(xe(u,"touchstart",this.onContainerTouchStart.bind(this),{passive:!1}),xe(u,"touchmove",this.onContainerTouchMove.bind(this),{passive:!1})),Gt.unbindDocumentTouchEnd||(Gt.unbindDocumentTouchEnd=xe(v,"touchend",this.onDocumentTouchEnd.bind(this),{passive:!1})),this.setPointerCapture(),xe(this.chart,"redraw",this.setPointerCapture.bind(this))}setPointerCapture(){var F,V;if(!ge)return;let u=this.pointerCaptureEventsToUnbind,v=this.chart,M=v.container,z=vt((F=v.options.tooltip)==null?void 0:F.followTouchMove,!0)&&v.series.some(G=>G.options.findNearestPointBy.indexOf("y")>-1);!this.hasPointerCapture&&z?(u.push(xe(M,"pointerdown",G=>{var Q,le;(Q=G.target)!=null&&Q.hasPointerCapture(G.pointerId)&&((le=G.target)==null||le.releasePointerCapture(G.pointerId))}),xe(M,"pointermove",G=>{var Q,le;(le=(Q=v.pointer)==null?void 0:Q.getPointFromEvent(G))==null||le.onMouseOver(G)})),v.styledMode||je(M,{"touch-action":"none"}),M.className+=" highcharts-no-touch-action",this.hasPointerCapture=!0):this.hasPointerCapture&&!z&&(u.forEach(G=>G()),u.length=0,v.styledMode||je(M,{"touch-action":vt((V=v.options.chart.style)==null?void 0:V["touch-action"],"manipulation")}),M.className=M.className.replace(" highcharts-no-touch-action",""),this.hasPointerCapture=!1)}setHoverChartIndex(u){var z;let v=this.chart,M=Pi.charts[vt(Gt.hoverChartIndex,-1)];if(M&&M!==v){let F={relatedTarget:v.container};u&&!(u!=null&&u.relatedTarget)&&Object.assign({},u,F),(z=M.pointer)==null||z.onContainerMouseLeave(u||F)}M!=null&&M.mouseIsDown||(Gt.hoverChartIndex=v.index)}touch(u,v){var V;let M,{chart:z,pinchDown:F=[]}=this;this.setHoverChartIndex(),(u=this.normalize(u)).touches.length===1?z.isInsidePlot(u.chartX-z.plotLeft,u.chartY-z.plotTop,{visiblePlotOnly:!0})&&!((V=z.exporting)!=null&&V.openMenu)?(v&&this.runPointActions(u),u.type==="touchmove"&&(M=!!F[0]&&Math.pow(F[0].chartX-u.chartX,2)+Math.pow(F[0].chartY-u.chartY,2)>=16),vt(M,!0)&&this.pinch(u)):v&&this.reset():u.touches.length===2&&this.pinch(u)}touchSelect(u){return!!(this.chart.zooming.singleTouch&&u.touches&&u.touches.length===1)}zoomOption(u){let v=this.chart,M=v.inverted,z=v.zooming.type||"",F,V;/touch/.test(u.type)&&(z=vt(v.zooming.pinchType,z)),this.zoomX=F=/x/.test(z),this.zoomY=V=/y/.test(z),this.zoomHor=F&&!M||V&&M,this.zoomVert=V&&!M||F&&M,this.hasZoom=F||V}}Gt.unbindDocumentMouseUp=[],function(he){he.compose=function(u){_t(J,"Core.Pointer")&&xe(u,"beforeRender",function(){this.pointer=new he(this,this.options)})}}(Gt||(Gt={}));let Vt=Gt;(function(he){he.setLength=function(u,v,M){return Array.isArray(u)?(u.length=v,u):u[M?"subarray":"slice"](0,v)},he.splice=function(u,v,M,z,F=[]){if(Array.isArray(u))return Array.isArray(F)||(F=Array.from(F)),{removed:u.splice(v,M,...F),array:u};let V=Object.getPrototypeOf(u).constructor,G=u[z?"subarray":"slice"](v,v+M),Q=new V(u.length-M+F.length);return Q.set(u.subarray(0,v),0),Q.set(F,v),Q.set(u.subarray(v+M),v+F.length),{removed:G,array:Q}}})(Qi||(Qi={}));let{setLength:ji,splice:Ms}=Qi,{fireEvent:zi,objectEach:os,uniqueKey:Fs}=Qs,Xi=class{constructor(he={}){this.autoId=!he.id,this.columns={},this.id=he.id||Fs(),this.modified=this,this.rowCount=0,this.versionTag=Fs();let u=0;os(he.columns||{},(v,M)=>{this.columns[M]=v.slice(),u=Math.max(u,v.length)}),this.applyRowCount(u)}applyRowCount(he){this.rowCount=he,os(this.columns,(u,v)=>{u.length!==he&&(this.columns[v]=ji(u,he))})}deleteRows(he,u=1){if(u>0&&he<this.rowCount){let v=0;os(this.columns,(M,z)=>{this.columns[z]=Ms(M,he,u).array,v=M.length}),this.rowCount=v}zi(this,"afterDeleteRows",{rowIndex:he,rowCount:u}),this.versionTag=Fs()}getColumn(he,u){return this.columns[he]}getColumns(he,u){return(he||Object.keys(this.columns)).reduce((v,M)=>(v[M]=this.columns[M],v),{})}getRow(he,u){return(u||Object.keys(this.columns)).map(v=>{var M;return(M=this.columns[v])==null?void 0:M[he]})}setColumn(he,u=[],v=0,M){this.setColumns({[he]:u},v,M)}setColumns(he,u,v){let M=this.rowCount;os(he,(z,F)=>{this.columns[F]=z.slice(),M=z.length}),this.applyRowCount(M),v!=null&&v.silent||(zi(this,"afterSetColumns"),this.versionTag=Fs())}setRow(he,u=this.rowCount,v,M){let{columns:z}=this,F=v?this.rowCount+1:u+1;os(he,(V,G)=>{let Q=z[G]||(M==null?void 0:M.addColumns)!==!1&&Array(F);Q&&(v?Q=Ms(Q,u,0,!0,[V]).array:Q[u]=V,z[G]=Q)}),F>this.rowCount&&this.applyRowCount(F),M!=null&&M.silent||(zi(this,"afterSetRows"),this.versionTag=Fs())}},{extend:Es,merge:Ns,pick:rr}=Qs;(function(he){function u(v,M,z){var ci,ii;let F=this.legendItem=this.legendItem||{},{chart:V,options:G}=this,{baseline:Q=0,symbolWidth:le,symbolHeight:ye}=v,ce=this.symbol||"circle",we=ye/2,Le=V.renderer,Ue=F.group,et=Q-Math.round((((ci=v.fontMetrics)==null?void 0:ci.b)||ye)*(z?.4:.3)),tt={},$e,ht=G.marker,yt=0;if(V.styledMode||(tt["stroke-width"]=Math.min(G.lineWidth||0,24),G.dashStyle?tt.dashstyle=G.dashStyle:G.linecap!=="square"&&(tt["stroke-linecap"]="round")),F.line=Le.path().addClass("highcharts-graph").attr(tt).add(Ue),z&&(F.area=Le.path().addClass("highcharts-area").add(Ue)),tt["stroke-linecap"]&&(yt=Math.min(F.line.strokeWidth(),le)/2),le){let ri=[["M",yt,et],["L",le-yt,et]];F.line.attr({d:ri}),(ii=F.area)==null||ii.attr({d:[...ri,["L",le-yt,Q],["L",yt,Q]]})}if(ht&&ht.enabled!==!1&&le){let ri=Math.min(rr(ht.radius,we),we);ce.indexOf("url")===0&&(ht=Ns(ht,{width:ye,height:ye}),ri=0),F.symbol=$e=Le.symbol(ce,le/2-ri,et-ri,2*ri,2*ri,Es({context:"legend"},ht)).addClass("highcharts-point").add(Ue),$e.isMarker=!0}}he.areaMarker=function(v,M){u.call(this,v,M,!0)},he.lineMarker=u,he.rectangle=function(v,M){let z=M.legendItem||{},F=v.options,V=v.symbolHeight,G=F.squareSymbol,Q=G?V:v.symbolWidth;z.symbol=this.chart.renderer.rect(G?(v.symbolWidth-V)/2:0,v.baseline-V+1,Q,V,rr(v.options.symbolRadius,V/2)).addClass("highcharts-point").attr({zIndex:3}).add(z.group)}})(xs||(xs={}));let bs=xs,{defaultOptions:Ks}=Za,{extend:or,extendClass:Jo,merge:co}=Qs;(function(he){function u(v,M){let z=Ks.plotOptions||{},F=M.defaultOptions,V=M.prototype;return V.type=v,V.pointClass||(V.pointClass=bn),!he.seriesTypes[v]&&(F&&(z[v]=F),he.seriesTypes[v]=M,!0)}he.seriesTypes=Pi.seriesTypes,he.registerSeriesType=u,he.seriesType=function(v,M,z,F,V){let G=Ks.plotOptions||{};if(M=M||"",G[v]=co(G[M],z),delete he.seriesTypes[v],u(v,Jo(he.seriesTypes[M]||function(){},F)),he.seriesTypes[v].prototype.type=v,V){class Q extends bn{}or(Q.prototype,V),he.seriesTypes[v].prototype.pointClass=Q}return he.seriesTypes[v]}})(zs||(zs={}));let eo=zs,{animObject:ya,setAnimation:ta}=Ws,{defaultOptions:Ea}=Za,{registerEventOptions:mn}=od,{svg:qr,win:Sl}=Pi,{seriesTypes:oo}=eo,{format:Hc}=Ma,{arrayMax:am,arrayMin:pn,clamp:Cg,correctFloat:wf,crisp:tp,defined:Oi,destroyObjectProperties:ms,diffObjects:Tp,erase:kn,error:Zt,extend:vh,find:zm,fireEvent:Ho,getClosestDistance:hg,getNestedProperty:Pg,insertItem:Fl,isArray:ip,isNumber:Ml,isString:ny,merge:xa,objectEach:Fu,pick:el,removeEvent:tl,syncTimeout:cg}=Qs;class ia{constructor(){this.zoneAxis="y"}init(u,v){var Q,le,ye;let M;Ho(this,"init",{options:v}),this.dataTable??(this.dataTable=new Xi);let z=u.series;this.eventsToUnbind=[],this.chart=u,this.options=this.setOptions(v);let F=this.options,V=F.visible!==!1;this.linkedSeries=[],this.bindAxes(),vh(this,{name:F.name,state:"",visible:V,selected:F.selected===!0}),mn(this,F);let G=F.events;(G!=null&&G.click||(le=(Q=F.point)==null?void 0:Q.events)!=null&&le.click||F.allowPointSelect)&&(u.runTrackerClick=!0),this.getColor(),this.getSymbol(),this.isCartesian&&(u.hasCartesianSeries=!0),z.length&&(M=z[z.length-1]),this._i=el(M==null?void 0:M._i,-1)+1,this.opacity=this.options.opacity,u.orderItems("series",Fl(this,z)),(ye=F.dataSorting)!=null&&ye.enabled?this.setDataSortingOptions():this.points||this.data||this.setData(F.data,!1),Ho(this,"afterInit")}is(u){return oo[u]&&this instanceof oo[u]}bindAxes(){let u,v=this,M=v.options,z=v.chart;Ho(this,"bindAxes",null,function(){(v.axisTypes||[]).forEach(function(F){(z[F]||[]).forEach(function(V){u=V.options,(el(M[F],0)===V.index||M[F]!==void 0&&M[F]===u.id)&&(Fl(v,V.series),v[F]=V,V.isDirty=!0)}),v[F]||v.optionalAxis===F||Zt(18,!0,z)})}),Ho(this,"afterBindAxes")}hasData(){return this.visible&&this.dataMax!==void 0&&this.dataMin!==void 0||this.visible&&this.dataTable.rowCount>0}hasMarkerChanged(u,v){let M=u.marker,z=v.marker||{};return M&&(z.enabled&&!M.enabled||z.symbol!==M.symbol||z.height!==M.height||z.width!==M.width)}autoIncrement(u){let v,M=this.options,{pointIntervalUnit:z,relativeXValue:F}=this.options,V=this.chart.time,G=this.xIncrement??V.parse(M.pointStart)??0;if(this.pointInterval=v=el(this.pointInterval,M.pointInterval,1),F&&Ml(u)&&(v*=u),z){let Q=V.toParts(G);z==="day"?Q[2]+=v:z==="month"?Q[1]+=v:z==="year"&&(Q[0]+=v),v=V.makeTime.apply(V,Q)-G}return F&&Ml(u)?G+v:(this.xIncrement=G+v,G)}setDataSortingOptions(){let u=this.options;vh(this,{requireSorting:!1,sorted:!1,enabledDataSorting:!0,allowDG:!1}),Oi(u.pointRange)||(u.pointRange=1)}setOptions(u){var tt,$e;let v,M=this.chart,z=M.options.plotOptions,F=M.userOptions||{},V=xa(u),G=M.styledMode,Q={plotOptions:z,userOptions:V};Ho(this,"setOptions",Q);let le=Q.plotOptions[this.type],ye=F.plotOptions||{},ce=ye.series||{},we=Ea.plotOptions[this.type]||{},Le=ye[this.type]||{};le.dataLabels=this.mergeArrays(we.dataLabels,le.dataLabels),this.userOptions=Q.userOptions;let Ue=xa(le,z.series,Le,V);this.tooltipOptions=xa(Ea.tooltip,(tt=Ea.plotOptions.series)==null?void 0:tt.tooltip,we==null?void 0:we.tooltip,M.userOptions.tooltip,($e=ye.series)==null?void 0:$e.tooltip,Le.tooltip,V.tooltip),this.stickyTracking=el(V.stickyTracking,Le.stickyTracking,ce.stickyTracking,!!this.tooltipOptions.shared&&!this.noSharedTooltip||Ue.stickyTracking),le.marker===null&&delete Ue.marker,this.zoneAxis=Ue.zoneAxis||"y";let et=this.zones=(Ue.zones||[]).map(ht=>({...ht}));return(Ue.negativeColor||Ue.negativeFillColor)&&!Ue.zones&&(v={value:Ue[this.zoneAxis+"Threshold"]||Ue.threshold||0,className:"highcharts-negative"},G||(v.color=Ue.negativeColor,v.fillColor=Ue.negativeFillColor),et.push(v)),et.length&&Oi(et[et.length-1].value)&&et.push(G?{}:{color:this.color,fillColor:this.fillColor}),Ho(this,"afterSetOptions",{options:Ue}),Ue}getName(){return this.options.name??Hc(this.chart.options.lang.seriesName,this,this.chart)}getCyclic(u,v,M){let z,F,V=this.chart,G=`${u}Index`,Q=`${u}Counter`,le=(M==null?void 0:M.length)||V.options.chart.colorCount;!v&&(Oi(F=el(u==="color"?this.options.colorIndex:void 0,this[G]))?z=F:(V.series.length||(V[Q]=0),z=V[Q]%le,V[Q]+=1),M&&(v=M[z])),z!==void 0&&(this[G]=z),this[u]=v}getColor(){this.chart.styledMode?this.getCyclic("color"):this.options.colorByPoint?this.color="#cccccc":this.getCyclic("color",this.options.color||Ea.plotOptions[this.type].color,this.chart.options.colors)}getPointsCollection(){return(this.hasGroupedData?this.points:this.data)||[]}getSymbol(){let u=this.options.marker;this.getCyclic("symbol",u.symbol,this.chart.options.symbols)}getColumn(u,v){return(v?this.dataTable.modified:this.dataTable).getColumn(u,!0)||[]}findPointIndex(u,v){var ce;let M,z,F,{id:V,x:G}=u,Q=this.points,le=this.options.dataSorting,ye=this.cropStart||0;if(V){let we=this.chart.get(V);we instanceof bn&&(M=we)}else if(this.linkedParent||this.enabledDataSorting||this.options.relativeXValue){let we=Le=>!Le.touched&&Le.index===u.index;if(le!=null&&le.matchByName?we=Le=>!Le.touched&&Le.name===u.name:this.options.relativeXValue&&(we=Le=>!Le.touched&&Le.options.x===u.x),!(M=zm(Q,we)))return}return M&&(F=M==null?void 0:M.index)!==void 0&&(z=!0),F===void 0&&Ml(G)&&(F=this.getColumn("x").indexOf(G,v)),F!==-1&&F!==void 0&&this.cropped&&(F=F>=ye?F-ye:F),!z&&Ml(F)&&((ce=Q[F])!=null&&ce.touched)&&(F=void 0),F}updateData(u,v){var et;let{options:M,requireSorting:z}=this,F=M.dataSorting,V=this.points,G=[],Q=u.length===V.length,le,ye,ce,we,Le=!0;if(this.xIncrement=null,u.forEach((tt,$e)=>{var ri;let ht,yt=Oi(tt)&&this.pointClass.prototype.optionsToObject.call({series:this},tt)||{},{id:ci,x:ii}=yt;ci||Ml(ii)?((ht=this.findPointIndex(yt,we))===-1||ht===void 0?G.push(tt):V[ht]&&tt!==((ri=M.data)==null?void 0:ri[ht])?(V[ht].update(tt,!1,void 0,!1),V[ht].touched=!0,z&&(we=ht+1)):V[ht]&&(V[ht].touched=!0),(!Q||$e!==ht||F!=null&&F.enabled||this.hasDerivedData)&&(le=!0)):G.push(tt)},this),le)for(ye=V.length;ye--;)(ce=V[ye])&&!ce.touched&&((et=ce.remove)==null||et.call(ce,!1,v));else Q&&!(F!=null&&F.enabled)?(u.forEach((tt,$e)=>{tt===V[$e].y||V[$e].destroyed||V[$e].update(tt,!1,void 0,!1)}),G.length=0):Le=!1;if(V.forEach(tt=>{tt&&(tt.touched=!1)}),!Le)return!1;G.forEach(tt=>{this.addPoint(tt,!1,void 0,void 0,!1)},this);let Ue=this.getColumn("x");return this.xIncrement===null&&Ue.length&&(this.xIncrement=am(Ue),this.autoIncrement()),!0}dataColumnKeys(){return["x",...this.pointArrayMap||["y"]]}setData(u,v=!0,M,z){var Ri,ki;let F=this.points,V=(F==null?void 0:F.length)||0,G=this.options,Q=this.chart,le=G.dataSorting,ye=this.xAxis,ce=G.turboThreshold,we=this.dataTable,Le=this.dataColumnKeys(),Ue=this.pointValKey||"y",et=(this.pointArrayMap||[]).length,tt=G.keys,$e,ht,yt=0,ci=1,ii;Q.options.chart.allowMutatingData||(G.data&&delete this.options.data,this.userOptions.data&&delete this.userOptions.data,ii=xa(!0,u));let ri=(u=ii||u||[]).length;if(le!=null&&le.enabled&&(u=this.sortData(u)),Q.options.chart.allowMutatingData&&z!==!1&&ri&&V&&!this.cropped&&!this.hasGroupedData&&this.visible&&!this.boosted&&(ht=this.updateData(u,M)),!ht){this.xIncrement=null,this.colorCounter=0;let Li=ce&&!G.relativeXValue&&ri>ce;if(Li){let ls=this.getFirstValidPoint(u),vs=this.getFirstValidPoint(u,ri-1,-1),Ys=ks=>!!(ip(ks)&&(tt||Ml(ks[0])));if(Ml(ls)&&Ml(vs)){let ks=[],Lr=[];for(let Cr of u)ks.push(this.autoIncrement()),Lr.push(Cr);we.setColumns({x:ks,[Ue]:Lr})}else if(Ys(ls)&&Ys(vs))if(et){let ks=+(ls.length===et),Lr=Array(Le.length).fill(0).map(()=>[]);for(let Cr of u){ks&&Lr[0].push(this.autoIncrement());for(let Ur=ks;Ur<=et;Ur++)(Ri=Lr[Ur])==null||Ri.push(Cr[Ur-ks])}we.setColumns(Le.reduce((Cr,Ur,nr)=>(Cr[Ur]=Lr[nr],Cr),{}))}else{tt&&(yt=tt.indexOf("x"),ci=tt.indexOf("y"),yt=yt>=0?yt:0,ci=ci>=0?ci:1),ls.length===1&&(ci=0);let ks=[],Lr=[];if(yt===ci)for(let Cr of u)ks.push(this.autoIncrement()),Lr.push(Cr[ci]);else for(let Cr of u)ks.push(Cr[yt]),Lr.push(Cr[ci]);we.setColumns({x:ks,[Ue]:Lr})}else Li=!1}if(!Li){let ls=Le.reduce((vs,Ys)=>(vs[Ys]=[],vs),{});for($e=0;$e<ri;$e++){let vs=this.pointClass.prototype.applyOptions.apply({series:this},[u[$e]]);for(let Ys of Le)ls[Ys][$e]=vs[Ys]}we.setColumns(ls)}for(ny(this.getColumn("y")[0])&&Zt(14,!0,Q),this.data=[],this.options.data=this.userOptions.data=u,$e=V;$e--;)(ki=F[$e])==null||ki.destroy();ye&&(ye.minRange=ye.userMinRange),this.isDirty=Q.isDirtyBox=!0,this.isDirtyData=!!F,M=!1}G.legendType==="point"&&(this.processData(),this.generatePoints()),v&&Q.redraw(M)}sortData(u){let v=this,M=v.options.dataSorting.sortKey||"y",z=function(F,V){return Oi(V)&&F.pointClass.prototype.optionsToObject.call({series:F},V)||{}};return u.forEach(function(F,V){u[V]=z(v,F),u[V].index=V},this),u.concat().sort((F,V)=>{let G=Pg(M,F),Q=Pg(M,V);return Q<G?-1:+(Q>G)}).forEach(function(F,V){F.x=V},this),v.linkedSeries&&v.linkedSeries.forEach(function(F){var Q;let V=F.options,G=V.data;!((Q=V.dataSorting)!=null&&Q.enabled)&&G&&(G.forEach(function(le,ye){G[ye]=z(F,le),u[ye]&&(G[ye].x=u[ye].x,G[ye].index=ye)}),F.setData(G,!1))}),u}getProcessedData(u){let v=this,{dataTable:M,isCartesian:z,options:F,xAxis:V}=v,G=F.cropThreshold,Q=u||v.getExtremesFromAll,le=V==null?void 0:V.logarithmic,ye=M.rowCount,ce,we,Le=0,Ue,et,tt,$e=v.getColumn("x"),ht=M,yt=!1;return V&&(et=(Ue=V.getExtremes()).min,tt=Ue.max,yt=!!(V.categories&&!V.names.length),z&&v.sorted&&!Q&&(!G||ye>G||v.forceCrop)&&($e[ye-1]<et||$e[0]>tt?ht=new Xi:v.getColumn(v.pointValKey||"y").length&&($e[0]<et||$e[ye-1]>tt)&&(ht=(ce=this.cropData(M,et,tt)).modified,Le=ce.start,we=!0))),$e=ht.getColumn("x")||[],{modified:ht,cropped:we,cropStart:Le,closestPointRange:hg([le?$e.map(le.log2lin):$e],()=>v.requireSorting&&!yt&&Zt(15,!1,v.chart))}}processData(u){let v=this.xAxis,M=this.dataTable;if(this.isCartesian&&!this.isDirty&&!v.isDirty&&!this.yAxis.isDirty&&!u)return!1;let z=this.getProcessedData();M.modified=z.modified,this.cropped=z.cropped,this.cropStart=z.cropStart,this.closestPointRange=this.basePointRange=z.closestPointRange,Ho(this,"afterProcessData")}cropData(u,v,M){let z=u.getColumn("x",!0)||[],F=z.length,V={},G,Q,le=0,ye=F;for(G=0;G<F;G++)if(z[G]>=v){le=Math.max(0,G-1);break}for(Q=G;Q<F;Q++)if(z[Q]>M){ye=Q+1;break}for(let ce of this.dataColumnKeys()){let we=u.getColumn(ce,!0);we&&(V[ce]=we.slice(le,ye))}return{modified:new Xi({columns:V}),start:le,end:ye}}generatePoints(){var ii,ri,Ri;let u=this.options,v=this.processedData||u.data,M=this.dataTable.modified,z=this.getColumn("x",!0),F=this.pointClass,V=M.rowCount,G=this.cropStart||0,Q=this.hasGroupedData,le=u.keys,ye=[],ce=(ii=u.dataGrouping)!=null&&ii.groupAll?G:0,we=(ri=this.xAxis)==null?void 0:ri.categories,Le=this.pointArrayMap||["y"],Ue=this.dataColumnKeys(),et,tt,$e,ht,yt=this.data,ci;if(!yt&&!Q){let ki=[];ki.length=(v==null?void 0:v.length)||0,yt=this.data=ki}for(le&&Q&&(this.options.keys=!1),ht=0;ht<V;ht++)tt=G+ht,Q?(($e=new F(this,M.getRow(ht,Ue)||[])).dataGroup=this.groupMap[ce+ht],(Ri=$e.dataGroup)!=null&&Ri.options&&($e.options=$e.dataGroup.options,vh($e,$e.dataGroup.options),delete $e.dataLabels)):($e=yt[tt],ci=v?v[tt]:M.getRow(ht,Le),$e||ci===void 0||(yt[tt]=$e=new F(this,ci,z[ht]))),$e&&($e.index=Q?ce+ht:tt,ye[ht]=$e,$e.category=(we==null?void 0:we[$e.x])??$e.x,$e.key=$e.name??$e.category);if(this.options.keys=le,yt&&(V!==(et=yt.length)||Q))for(ht=0;ht<et;ht++)ht!==G||Q||(ht+=V),yt[ht]&&(yt[ht].destroyElements(),yt[ht].plotX=void 0);this.data=yt,this.points=ye,Ho(this,"afterGeneratePoints")}getXExtremes(u){return{min:pn(u),max:am(u)}}getExtremes(u,v){var ii;let{xAxis:M,yAxis:z}=this,F=v||this.getExtremesFromAll||this.options.getExtremesFromAll,V=F&&this.cropped?this.dataTable:this.dataTable.modified,G=V.rowCount,Q=u||this.stackedYData,le=Q?[Q]:((ii=this.keysAffectYAxis||this.pointArrayMap||["y"])==null?void 0:ii.map(ri=>V.getColumn(ri,!0)||[]))||[],ye=this.getColumn("x",!0),ce=[],we=this.requireSorting&&!this.is("column")?1:0,Le=!!z&&z.positiveValuesOnly,Ue=F||this.cropped||!M,et,tt,$e,ht=0,yt=0;for(M&&(ht=(et=M.getExtremes()).min,yt=et.max),$e=0;$e<G;$e++)if(tt=ye[$e],Ue||(ye[$e+we]||tt)>=ht&&(ye[$e-we]||tt)<=yt)for(let ri of le){let Ri=ri[$e];Ml(Ri)&&(Ri>0||!Le)&&ce.push(Ri)}let ci={activeYData:ce,dataMin:pn(ce),dataMax:am(ce)};return Ho(this,"afterGetExtremes",{dataExtremes:ci}),ci}applyExtremes(){let u=this.getExtremes();return this.dataMin=u.dataMin,this.dataMax=u.dataMax,u}getFirstValidPoint(u,v=0,M=1){let z=u.length,F=v;for(;F>=0&&F<z;){if(Oi(u[F]))return u[F];F+=M}}translate(){var yt;this.generatePoints();let u=this.options,v=u.stacking,M=this.xAxis,z=this.enabledDataSorting,F=this.yAxis,V=this.points,G=V.length,Q=this.pointPlacementToXValue(),le=!!Q,ye=u.threshold,ce=u.startFromThreshold?ye:0,we=(u==null?void 0:u.nullInteraction)&&F.len,Le,Ue,et,tt,$e=Number.MAX_VALUE;function ht(ci){return Cg(ci,-1e9,1e9)}for(Le=0;Le<G;Le++){let ci,ii=V[Le],ri=ii.x,Ri,ki,Li=ii.y,ls=ii.low,vs=v&&((yt=F.stacking)==null?void 0:yt.stacks[(this.negStacks&&Li<(ce?0:ye)?"-":"")+this.stackKey]);ii.plotX=Ml(Ue=M.translate(ri,!1,!1,!1,!0,Q))?wf(ht(Ue)):void 0,v&&this.visible&&vs&&vs[ri]&&(tt=this.getStackIndicator(tt,ri,this.index),!ii.isNull&&tt.key&&(ki=(Ri=vs[ri]).points[tt.key]),Ri&&ip(ki)&&(ls=ki[0],Li=ki[1],ls===ce&&tt.key===vs[ri].base&&(ls=el(Ml(ye)?ye:F.min)),F.positiveValuesOnly&&Oi(ls)&&ls<=0&&(ls=void 0),ii.total=ii.stackTotal=el(Ri.total),ii.percentage=Oi(ii.y)&&Ri.total?ii.y/Ri.total*100:void 0,ii.stackY=Li,this.irregularWidths||Ri.setOffset(this.pointXOffset||0,this.barW||0,void 0,void 0,void 0,this.xAxis))),ii.yBottom=Oi(ls)?ht(F.translate(ls,!1,!0,!1,!0)):void 0,this.dataModify&&(Li=this.dataModify.modifyValue(Li,Le)),Ml(Li)&&ii.plotX!==void 0?ci=Ml(ci=F.translate(Li,!1,!0,!1,!0))?ht(ci):void 0:!Ml(Li)&&we&&(ci=we),ii.plotY=ci,ii.isInside=this.isPointInside(ii),ii.clientX=le?wf(M.translate(ri,!1,!1,!1,!0,Q)):Ue,ii.negative=(ii.y||0)<(ye||0),ii.isNull||ii.visible===!1||(et!==void 0&&($e=Math.min($e,Math.abs(Ue-et))),et=Ue),ii.zone=this.zones.length?ii.getZone():void 0,!ii.graphic&&this.group&&z&&(ii.isNew=!0)}this.closestPointRangePx=$e,Ho(this,"afterTranslate")}getValidPoints(u,v,M){let z=this.chart;return(u||this.points||[]).filter(function(F){let{plotX:V,plotY:G}=F;return(!!M||!F.isNull&&!!Ml(G))&&(!v||!!z.isInsidePlot(V,G,{inverted:z.inverted}))&&F.visible!==!1})}getSharedClipKey(){return this.sharedClipKey=(this.options.xAxis||0)+","+(this.options.yAxis||0),this.sharedClipKey}setClip(){let{chart:u,group:v,markerGroup:M}=this,z=u.sharedClips,F=u.renderer,V=u.getClipBox(this),G=this.getSharedClipKey(),Q=z[G];Q?Q.animate(V):z[G]=Q=F.clipRect(V),v&&v.clip(this.options.clip===!1?void 0:Q),M&&M.clip()}animate(u){let{chart:v,group:M,markerGroup:z}=this,F=v.inverted,V=ya(this.options.animation),G=[this.getSharedClipKey(),V.duration,V.easing,V.defer].join(","),Q=v.sharedClips[G],le=v.sharedClips[G+"m"];if(u&&M){let ye=v.getClipBox(this);if(Q)Q.attr("height",ye.height);else{ye.width=0,F&&(ye.x=v.plotHeight),Q=v.renderer.clipRect(ye),v.sharedClips[G]=Q;let ce={x:-99,y:-99,width:F?v.plotWidth+199:99,height:F?99:v.plotHeight+199};le=v.renderer.clipRect(ce),v.sharedClips[G+"m"]=le}M.clip(Q),z==null||z.clip(le)}else if(Q&&!Q.hasClass("highcharts-animating")){let ye=v.getClipBox(this),ce=V.step;(z!=null&&z.element.childNodes.length||v.series.length>1)&&(V.step=function(we,Le){ce&&ce.apply(Le,arguments),Le.prop==="width"&&(le!=null&&le.element)&&le.attr(F?"height":"width",we+99)}),Q.addClass("highcharts-animating").animate(ye,V)}}afterAnimate(){this.setClip(),Fu(this.chart.sharedClips,(u,v,M)=>{u&&!this.chart.container.querySelector(`[clip-path="url(#${u.id})"]`)&&(u.destroy(),delete M[v])}),this.finishedAnimating=!0,Ho(this,"afterAnimate")}drawPoints(u=this.points){let v,M,z,F,V,G,Q,le=this.chart,ye=le.styledMode,{colorAxis:ce,options:we}=this,Le=we.marker,Ue=we.nullInteraction,et=this[this.specialGroup||"markerGroup"],tt=this.xAxis,$e=el(Le.enabled,!tt||!!tt.isRadial||null,this.closestPointRangePx>=Le.enabledThreshold*Le.radius);if(Le.enabled!==!1||this._hasPointMarkers)for(v=0;v<u.length;v++){F=(z=(M=u[v]).graphic)?"animate":"attr",V=M.marker||{},G=!!M.marker;let ht=M.isNull;if(($e&&!Oi(V.enabled)||V.enabled)&&(!ht||Ue)&&M.visible!==!1){let yt=el(V.symbol,this.symbol,"rect");Q=this.markerAttribs(M,M.selected&&"select"),this.enabledDataSorting&&(M.startXPos=tt.reversed?-(Q.width||0):tt.width);let ci=M.isInside!==!1;if(!z&&ci&&((Q.width||0)>0||M.hasImage)&&(M.graphic=z=le.renderer.symbol(yt,Q.x,Q.y,Q.width,Q.height,G?V:Le).add(et),this.enabledDataSorting&&le.hasRendered&&(z.attr({x:M.startXPos}),F="animate")),z&&F==="animate"&&z[ci?"show":"hide"](ci).animate(Q),z){let ii=this.pointAttribs(M,ye||!M.selected?void 0:"select");ye?ce&&z.css({fill:ii.fill}):z[F](ii)}z&&z.addClass(M.getClassName(),!0)}else z&&(M.graphic=z.destroy())}}markerAttribs(u,v){let M=this.options,z=M.marker,F=u.marker||{},V=F.symbol||z.symbol,G={},Q,le,ye=el(F.radius,z==null?void 0:z.radius);v&&(Q=z.states[v],le=F.states&&F.states[v],ye=el(le==null?void 0:le.radius,Q==null?void 0:Q.radius,ye&&ye+((Q==null?void 0:Q.radiusPlus)||0))),u.hasImage=V&&V.indexOf("url")===0,u.hasImage&&(ye=0);let ce=u.pos();return Ml(ye)&&ce&&(M.crisp&&(ce[0]=tp(ce[0],u.hasImage?0:V==="rect"?(z==null?void 0:z.lineWidth)||0:1)),G.x=ce[0]-ye,G.y=ce[1]-ye),ye&&(G.width=G.height=2*ye),G}pointAttribs(u,v){var $e;let M=this.options,z=M.marker,F=u==null?void 0:u.options,V=(F==null?void 0:F.marker)||{},G=F==null?void 0:F.color,Q=u==null?void 0:u.color,le=($e=u==null?void 0:u.zone)==null?void 0:$e.color,ye,ce,we=this.color,Le,Ue,et=el(V.lineWidth,z.lineWidth),tt=u!=null&&u.isNull&&M.nullInteraction?0:1;return we=G||le||Q||we,Le=V.fillColor||z.fillColor||we,Ue=V.lineColor||z.lineColor||we,v=v||"normal",ye=z.states[v]||{},et=el((ce=V.states&&V.states[v]||{}).lineWidth,ye.lineWidth,et+el(ce.lineWidthPlus,ye.lineWidthPlus,0)),Le=ce.fillColor||ye.fillColor||Le,Ue=ce.lineColor||ye.lineColor||Ue,{stroke:Ue,"stroke-width":et,fill:Le,opacity:tt=el(ce.opacity,ye.opacity,tt)}}destroy(u){var Q,le;let v,M,z=this,F=z.chart,V=/AppleWebKit\/533/.test(Sl.navigator.userAgent),G=z.data||[];for(Ho(z,"destroy",{keepEventsForUpdate:u}),this.removeEvents(u),(z.axisTypes||[]).forEach(function(ye){M=z[ye],M!=null&&M.series&&(kn(M.series,z),M.isDirty=M.forceRedraw=!0)}),z.legendItem&&z.chart.legend.destroyItem(z),v=G.length;v--;)(le=(Q=G[v])==null?void 0:Q.destroy)==null||le.call(Q);for(let ye of z.zones)ms(ye,void 0,!0);Qs.clearTimeout(z.animationTimeout),Fu(z,function(ye,ce){ye instanceof hl&&!ye.survive&&ye[V&&ce==="group"?"hide":"destroy"]()}),F.hoverSeries===z&&(F.hoverSeries=void 0),kn(F.series,z),F.orderItems("series"),Fu(z,function(ye,ce){u&&ce==="hcEvents"||delete z[ce]})}applyZones(){let{area:u,chart:v,graph:M,zones:z,points:F,xAxis:V,yAxis:G,zoneAxis:Q}=this,{inverted:le,renderer:ye}=v,ce=this[`${Q}Axis`],{isXAxis:we,len:Le=0,minPointOffset:Ue=0}=ce||{},et=((M==null?void 0:M.strokeWidth())||0)/2+1,tt=($e,ht=0,yt=0)=>{le&&(yt=Le-yt);let{translated:ci=0,lineClip:ii}=$e,ri=yt-ci;ii==null||ii.push(["L",ht,Math.abs(ri)<et?yt-et*(ri<=0?-1:1):ci])};if(z.length&&(M||u)&&ce&&Ml(ce.min)){let $e=ce.getExtremes().max+Ue,ht=ii=>{ii.forEach((ri,Ri)=>{(ri[0]==="M"||ri[0]==="L")&&(ii[Ri]=[ri[0],we?Le-ri[1]:ri[1],we?ri[2]:Le-ri[2]])})};if(z.forEach(ii=>{ii.lineClip=[],ii.translated=Cg(ce.toPixels(el(ii.value,$e),!0)||0,0,Le)}),M&&!this.showLine&&M.hide(),u&&u.hide(),Q==="y"&&F.length<V.len)for(let ii of F){let{plotX:ri,plotY:Ri,zone:ki}=ii,Li=ki&&z[z.indexOf(ki)-1];ki&&tt(ki,ri,Ri),Li&&tt(Li,ri,Ri)}let yt=[],ci=ce.toPixels(ce.getExtremes().min-Ue,!0);z.forEach(ii=>{var Ur,nr;let ri=ii.lineClip||[],Ri=Math.round(ii.translated||0);V.reversed&&ri.reverse();let{clip:ki,simpleClip:Li}=ii,ls=0,vs=0,Ys=V.len,ks=G.len;we?(ls=Ri,Ys=ci):(vs=Ri,ks=ci);let Lr=[["M",ls,vs],["L",Ys,vs],["L",Ys,ks],["L",ls,ks],["Z"]],Cr=[Lr[0],...ri,Lr[1],Lr[2],...yt,Lr[3],Lr[4]];yt=ri.reverse(),ci=Ri,le&&(ht(Cr),u&&ht(Lr)),ki?(ki.animate({d:Cr}),Li==null||Li.animate({d:Lr})):(ki=ii.clip=ye.path(Cr),u&&(Li=ii.simpleClip=ye.path(Lr))),M&&((Ur=ii.graph)==null||Ur.clip(ki)),u&&((nr=ii.area)==null||nr.clip(Li))})}else this.visible&&(M&&M.show(),u&&u.show())}plotGroup(u,v,M,z,F){let V=this[u],G=!V,Q={visibility:M,zIndex:z||.1};return Oi(this.opacity)&&!this.chart.styledMode&&this.state!=="inactive"&&(Q.opacity=this.opacity),V||(this[u]=V=this.chart.renderer.g().add(F)),V.addClass("highcharts-"+v+" highcharts-series-"+this.index+" highcharts-"+this.type+"-series "+(Oi(this.colorIndex)?"highcharts-color-"+this.colorIndex+" ":"")+(this.options.className||"")+(V.hasClass("highcharts-tracker")?" highcharts-tracker":""),!0),V.attr(Q)[G?"attr":"animate"](this.getPlotBox(v)),V}getPlotBox(u){let v=this.xAxis,M=this.yAxis,z=this.chart,F=z.inverted&&!z.polar&&v&&this.invertible&&u==="series";z.inverted&&(v=M,M=this.xAxis);let V={scale:1,translateX:v?v.left:z.plotLeft,translateY:M?M.top:z.plotTop,name:u};Ho(this,"getPlotBox",V);let{scale:G,translateX:Q,translateY:le}=V;return{translateX:Q,translateY:le,rotation:90*!!F,rotationOriginX:F?G*(v.len-M.len)/2:0,rotationOriginY:F?G*(v.len+M.len)/2:0,scaleX:F?-G:G,scaleY:G}}removeEvents(u){let{eventsToUnbind:v}=this;u||tl(this),v.length&&(v.forEach(M=>{M()}),v.length=0)}render(){var ye,ce,we,Le,Ue;let u=this,{chart:v,options:M,hasRendered:z}=u,F=ya(M.animation),V=u.visible?"inherit":"hidden",G=M.zIndex,Q=v.seriesGroup,le=u.finishedAnimating?0:F.duration;Ho(this,"render"),u.plotGroup("group","series",V,G,Q),u.markerGroup=u.plotGroup("markerGroup","markers",V,G,Q),M.clip!==!1&&u.setClip(),le&&((ye=u.animate)==null||ye.call(u,!0)),u.drawGraph&&(u.drawGraph(),u.applyZones()),u.visible&&u.drawPoints(),(ce=u.drawDataLabels)==null||ce.call(u),(we=u.redrawPoints)==null||we.call(u),M.enableMouseTracking&&((Le=u.drawTracker)==null||Le.call(u)),le&&((Ue=u.animate)==null||Ue.call(u)),z||(le&&F.defer&&(le+=F.defer),u.animationTimeout=cg(()=>{u.afterAnimate()},le||0)),u.isDirty=!1,u.hasRendered=!0,Ho(u,"afterRender")}redraw(){let u=this.isDirty||this.isDirtyData;this.translate(),this.render(),u&&delete this.kdTree}reserveSpace(){return this.visible||!this.chart.options.chart.ignoreHiddenSeries}searchPoint(u,v){let{xAxis:M,yAxis:z}=this,F=this.chart.inverted;return this.searchKDTree({clientX:F?M.len-u.chartY+M.pos:u.chartX-M.pos,plotY:F?z.len-u.chartX+z.pos:u.chartY-z.pos},v,u)}buildKDTree(u){this.buildingKdTree=!0;let v=this,M=v.options,z=M.findNearestPointBy.indexOf("y")>-1?2:1;delete v.kdTree,cg(function(){v.kdTree=function F(V,G,Q){let le,ye,ce=V==null?void 0:V.length;if(ce)return le=v.kdAxisArray[G%Q],V.sort((we,Le)=>(we[le]||0)-(Le[le]||0)),{point:V[ye=Math.floor(ce/2)],left:F(V.slice(0,ye),G+1,Q),right:F(V.slice(ye+1),G+1,Q)}}(v.getValidPoints(void 0,!v.directTouch,M==null?void 0:M.nullInteraction),z,z),v.buildingKdTree=!1},M.kdNow||(u==null?void 0:u.type)==="touchstart"?0:1)}searchKDTree(u,v,M,z,F){let V=this,[G,Q]=this.kdAxisArray,le=v?"distX":"dist",ye=(V.options.findNearestPointBy||"").indexOf("y")>-1?2:1,ce=!!V.isBubble,we=z||((Ue,et,tt)=>{let $e=Ue[tt]||0,ht=et[tt]||0;return[$e===ht&&Ue.index>et.index||$e<ht?Ue:et,!1]}),Le=F||((Ue,et)=>Ue<et);if(this.kdTree||this.buildingKdTree||this.buildKDTree(M),this.kdTree)return function Ue(et,tt,$e,ht){var ls;let yt=tt.point,ci=V.kdAxisArray[$e%ht],ii=yt,ri=!1;(function(vs,Ys){var Sn;let ks=vs[G],Lr=Ys[G],Cr=Oi(ks)&&Oi(Lr)?ks-Lr:null,Ur=vs[Q],nr=Ys[Q],Yr=Oi(Ur)&&Oi(nr)?Ur-nr:0,En=ce&&((Sn=Ys.marker)==null?void 0:Sn.radius)||0;Ys.dist=Math.sqrt((Cr&&Cr*Cr||0)+Yr*Yr)-En,Ys.distX=Oi(Cr)?Math.abs(Cr)-En:Number.MAX_VALUE})(et,yt);let Ri=(et[ci]||0)-(yt[ci]||0)+(ce&&((ls=yt.marker)==null?void 0:ls.radius)||0),ki=Ri<0?"left":"right",Li=Ri<0?"right":"left";return tt[ki]&&([ii,ri]=we(yt,Ue(et,tt[ki],$e+1,ht),le)),tt[Li]&&Le(Math.sqrt(Ri*Ri),ii[le],ri)&&(ii=we(ii,Ue(et,tt[Li],$e+1,ht),le)[0]),ii}(u,this.kdTree,ye,ye)}pointPlacementToXValue(){let{options:u,xAxis:v}=this,M=u.pointPlacement;return M==="between"&&(M=v.reversed?-.5:.5),Ml(M)?M*(u.pointRange||v.pointRange):0}isPointInside(u){let{chart:v,xAxis:M,yAxis:z}=this,{plotX:F=-1,plotY:V=-1}=u;return V>=0&&V<=(z?z.len:v.plotHeight)&&F>=0&&F<=(M?M.len:v.plotWidth)}drawTracker(){var we;let u=this,v=u.options,M=v.trackByArea,z=[].concat((M?u.areaPath:u.graphPath)||[]),F=u.chart,V=F.pointer,G=F.renderer,Q=((we=F.options.tooltip)==null?void 0:we.snap)||0,le=()=>{v.enableMouseTracking&&F.hoverSeries!==u&&u.onMouseOver()},ye="rgba(192,192,192,"+(qr?1e-4:.002)+")",ce=u.tracker;ce?ce.attr({d:z}):u.graph&&(u.tracker=ce=G.path(z).attr({visibility:u.visible?"inherit":"hidden",zIndex:2}).addClass(M?"highcharts-tracker-area":"highcharts-tracker-line").add(u.group),F.styledMode||ce.attr({"stroke-linecap":"round","stroke-linejoin":"round",stroke:ye,fill:M?ye:"none","stroke-width":u.graph.strokeWidth()+(M?0:2*Q)}),[u.tracker,u.markerGroup,u.dataLabelsGroup].forEach(Le=>{Le&&(Le.addClass("highcharts-tracker").on("mouseover",le).on("mouseout",Ue=>{V==null||V.onTrackerMouseOut(Ue)}),v.cursor&&!F.styledMode&&Le.css({cursor:v.cursor}),Le.on("touchstart",le))})),Ho(this,"afterDrawTracker")}addPoint(u,v,M,z,F){let V,G,Q=this.options,{chart:le,data:ye,dataTable:ce,xAxis:we}=this,Le=(we==null?void 0:we.hasNames)&&we.names,Ue=Q.data,et=this.getColumn("x");v=el(v,!0);let tt={series:this};this.pointClass.prototype.applyOptions.apply(tt,[u]);let $e=tt.x;if(G=et.length,this.requireSorting&&$e<et[G-1])for(V=!0;G&&et[G-1]>$e;)G--;ce.setRow(tt,G,!0,{addColumns:!1}),Le&&tt.name&&(Le[$e]=tt.name),Ue==null||Ue.splice(G,0,u),(V||this.processedData)&&(this.data.splice(G,0,null),this.processData()),Q.legendType==="point"&&this.generatePoints(),M&&(ye[0]&&ye[0].remove?ye[0].remove(!1):([ye,Ue].filter(Oi).forEach(ht=>{ht.shift()}),ce.deleteRows(0))),F!==!1&&Ho(this,"addPoint",{point:tt}),this.isDirty=!0,this.isDirtyData=!0,v&&le.redraw(z)}removePoint(u,v,M){let z=this,{chart:F,data:V,points:G,dataTable:Q}=z,le=V[u],ye=function(){[(G==null?void 0:G.length)===V.length?G:void 0,V,z.options.data].filter(Oi).forEach(ce=>{ce.splice(u,1)}),Q.deleteRows(u),le==null||le.destroy(),z.isDirty=!0,z.isDirtyData=!0,v&&F.redraw()};ta(M,F),v=el(v,!0),le?le.firePointEvent("remove",null,ye):ye()}remove(u,v,M,z){let F=this,V=F.chart;function G(){F.destroy(z),V.isDirtyLegend=V.isDirtyBox=!0,V.linkSeries(z),el(u,!0)&&V.redraw(v)}M!==!1?Ho(F,"remove",null,G):G()}update(u,v){var $e,ht;Ho(this,"update",{options:u=Tp(u,this.userOptions)});let M=this,z=M.chart,F=M.userOptions,V=M.initialType||M.type,G=z.options.plotOptions,Q=oo[V].prototype,le=M.finishedAnimating&&{animation:!1},ye={},ce,we,Le=ia.keepProps.slice(),Ue=u.type||F.type||z.options.chart.type,et=!(this.hasDerivedData||Ue&&Ue!==this.type||u.keys!==void 0||u.pointStart!==void 0||u.pointInterval!==void 0||u.relativeXValue!==void 0||u.joinBy||u.mapData||["dataGrouping","pointStart","pointInterval","pointIntervalUnit","keys"].some(yt=>M.hasOptionChanged(yt)));Ue=Ue||V,et?(Le.push.apply(Le,ia.keepPropsForPoints),u.visible!==!1&&Le.push("area","graph"),M.parallelArrays.forEach(function(yt){Le.push(yt+"Data")}),u.data&&(u.dataSorting&&vh(M.options.dataSorting,u.dataSorting),this.setData(u.data,!1))):this.dataTable.modified=this.dataTable,u=xa(F,{index:F.index===void 0?M.index:F.index,pointStart:(($e=G==null?void 0:G.series)==null?void 0:$e.pointStart)??F.pointStart??M.getColumn("x")[0]},!et&&{data:M.options.data},u,le),et&&u.data&&(u.data=M.options.data),(Le=["group","markerGroup","dataLabelsGroup","transformGroup"].concat(Le)).forEach(function(yt){Le[yt]=M[yt],delete M[yt]});let tt=!1;if(oo[Ue]){if(tt=Ue!==M.type,M.remove(!1,!1,!1,!0),tt)if(z.propFromSeries(),Object.setPrototypeOf)Object.setPrototypeOf(M,oo[Ue].prototype);else{let yt=Object.hasOwnProperty.call(M,"hcEvents")&&M.hcEvents;for(we in Q)M[we]=void 0;vh(M,oo[Ue].prototype),yt?M.hcEvents=yt:delete M.hcEvents}}else Zt(17,!0,z,{missingModuleFor:Ue});if(Le.forEach(function(yt){M[yt]=Le[yt]}),M.init(z,u),et&&this.points)for(let yt of((ce=M.options).visible===!1?(ye.graphic=1,ye.dataLabel=1):(this.hasMarkerChanged(ce,F)&&(ye.graphic=1),(ht=M.hasDataLabels)!=null&&ht.call(M)||(ye.dataLabel=1)),this.points))yt!=null&&yt.series&&(yt.resolveColor(),Object.keys(ye).length&&yt.destroyElements(ye),ce.showInLegend===!1&&yt.legendItem&&z.legend.destroyItem(yt));M.initialType=V,z.linkSeries(),z.setSortedData(),tt&&M.linkedSeries.length&&(M.isDirtyData=!0),Ho(this,"afterUpdate"),el(v,!0)&&z.redraw(!!et&&void 0)}setName(u){this.name=this.options.name=this.userOptions.name=u,this.chart.isDirtyLegend=!0}hasOptionChanged(u){var G,Q;let v=this.chart,M=this.options[u],z=v.options.plotOptions,F=this.userOptions[u],V=el((G=z==null?void 0:z[this.type])==null?void 0:G[u],(Q=z==null?void 0:z.series)==null?void 0:Q[u]);return F&&!Oi(V)?M!==F:M!==el(V,M)}onMouseOver(){let u=this.chart,v=u.hoverSeries,M=u.pointer;M==null||M.setHoverChartIndex(),v&&v!==this&&v.onMouseOut(),this.options.events.mouseOver&&Ho(this,"mouseOver"),this.setState("hover"),u.hoverSeries=this}onMouseOut(){let u=this.options,v=this.chart,M=v.tooltip,z=v.hoverPoint;v.hoverSeries=null,z&&z.onMouseOut(),this&&u.events.mouseOut&&Ho(this,"mouseOut"),M&&!this.stickyTracking&&(!M.shared||this.noSharedTooltip)&&M.hide(),v.series.forEach(function(F){F.setState("",!0)})}setState(u,v){let M=this,z=M.options,F=M.graph,V=z.inactiveOtherPoints,G=z.states,Q=el(G[u||"normal"]&&G[u||"normal"].animation,M.chart.options.chart.animation),le=z.lineWidth,ye=z.opacity;if(u=u||"",M.state!==u&&([M.group,M.markerGroup,M.dataLabelsGroup].forEach(function(ce){ce&&(M.state&&ce.removeClass("highcharts-series-"+M.state),u&&ce.addClass("highcharts-series-"+u))}),M.state=u,!M.chart.styledMode)){if(G[u]&&G[u].enabled===!1)return;if(u&&(le=G[u].lineWidth||le+(G[u].lineWidthPlus||0),ye=el(G[u].opacity,ye)),F&&!F.dashstyle&&Ml(le))for(let ce of[F,...this.zones.map(we=>we.graph)])ce==null||ce.animate({"stroke-width":le},Q);V||[M.group,M.markerGroup,M.dataLabelsGroup,M.labelBySeries].forEach(function(ce){ce&&ce.animate({opacity:ye},Q)})}v&&V&&M.points&&M.setAllPointsToState(u||void 0)}setAllPointsToState(u){this.points.forEach(function(v){v.setState&&v.setState(u)})}setVisible(u,v){var Q;let M=this,z=M.chart,F=z.options.chart.ignoreHiddenSeries,V=M.visible;M.visible=u=M.options.visible=M.userOptions.visible=u===void 0?!V:u;let G=u?"show":"hide";["group","dataLabelsGroup","markerGroup","tracker","tt"].forEach(le=>{var ye;(ye=M[le])==null||ye[G]()}),(z.hoverSeries===M||((Q=z.hoverPoint)==null?void 0:Q.series)===M)&&M.onMouseOut(),M.legendItem&&z.legend.colorizeItem(M,u),M.isDirty=!0,M.options.stacking&&z.series.forEach(le=>{le.options.stacking&&le.visible&&(le.isDirty=!0)}),M.linkedSeries.forEach(le=>{le.setVisible(u,!1)}),F&&(z.isDirtyBox=!0),Ho(M,G),v!==!1&&z.redraw()}show(){this.setVisible(!0)}hide(){this.setVisible(!1)}select(u){this.selected=u=this.options.selected=u===void 0?!this.selected:u,this.checkbox&&(this.checkbox.checked=u),Ho(this,u?"select":"unselect")}shouldShowTooltip(u,v,M={}){return M.series=this,M.visiblePlotOnly=!0,this.chart.isInsidePlot(u,v,M)}drawLegendSymbol(u,v){var M;(M=bs[this.options.legendSymbol||"rectangle"])==null||M.call(this,u,v)}}ia.defaultOptions={lineWidth:2,allowPointSelect:!1,crisp:!0,showCheckbox:!1,animation:{duration:1e3},enableMouseTracking:!0,events:{},marker:{enabledThreshold:2,lineColor:"#ffffff",lineWidth:0,radius:4,states:{normal:{animation:!0},hover:{animation:{duration:150},enabled:!0,radiusPlus:2,lineWidthPlus:1},select:{fillColor:"#cccccc",lineColor:"#000000",lineWidth:2}}},point:{events:{}},dataLabels:{animation:{},align:"center",borderWidth:0,defer:!0,formatter:function(){let{numberFormatter:he}=this.series.chart;return typeof this.y!="number"?"":he(this.y,-1)},padding:5,style:{fontSize:"0.7em",fontWeight:"bold",color:"contrast",textOutline:"1px contrast"},verticalAlign:"bottom",x:0,y:0},cropThreshold:300,opacity:1,pointRange:0,softThreshold:!0,states:{normal:{animation:!0},hover:{animation:{duration:150},lineWidthPlus:1,marker:{},halo:{size:10,opacity:.25}},select:{animation:{duration:0}},inactive:{animation:{duration:150},opacity:.2}},stickyTracking:!0,turboThreshold:1e3,findNearestPointBy:"x"},ia.types=eo.seriesTypes,ia.registerType=eo.registerSeriesType,ia.keepProps=["colorIndex","eventOptions","navigatorSeries","symbolIndex","baseSeries"],ia.keepPropsForPoints=["data","isDirtyData","isDirtyCanvas","points","dataTable","processedData","xIncrement","cropped","_hasPointMarkers","hasDataLabels","nodes","layout","level","mapMap","mapData","minY","maxY","minX","maxX","transformGroups"],vh(ia.prototype,{axisTypes:["xAxis","yAxis"],coll:"series",colorCounter:0,directTouch:!1,invertible:!0,isCartesian:!0,kdAxisArray:["clientX","plotY"],parallelArrays:["x","y"],pointClass:bn,requireSorting:!0,sorted:!0}),eo.series=ia;let Dh=ia,{animObject:hu,setAnimation:Nl}=Ws,{registerEventOptions:_a}=od,{composed:th,marginNames:Rm}=Pi,{distribute:On}=fa,{format:Vo}=Ma,{addEvent:bo,createElement:Dd,css:Vl,defined:Tf,discardElement:Sf,find:Sp,fireEvent:Nu,isNumber:Mp,merge:cu,pick:dd,pushUnique:Xc,relativeLength:Kp,stableSort:Bm,syncTimeout:ud}=Qs;class Ap{constructor(u,v){this.allItems=[],this.initialItemY=0,this.itemHeight=0,this.itemMarginBottom=0,this.itemMarginTop=0,this.itemX=0,this.itemY=0,this.lastItemY=0,this.lastLineHeight=0,this.legendHeight=0,this.legendWidth=0,this.maxItemWidth=0,this.maxLegendWidth=0,this.offsetWidth=0,this.padding=0,this.pages=[],this.symbolHeight=0,this.symbolWidth=0,this.titleHeight=0,this.totalItemWidth=0,this.widthOption=0,this.chart=u,this.setOptions(v),v.enabled&&(this.render(),_a(this,v),bo(this.chart,"endResize",function(){this.legend.positionCheckboxes()})),bo(this.chart,"render",()=>{this.options.enabled&&this.proximate&&(this.proximatePositions(),this.positionItems())})}setOptions(u){let v=dd(u.padding,8);this.options=u,this.chart.styledMode||(this.itemStyle=u.itemStyle,this.itemHiddenStyle=cu(this.itemStyle,u.itemHiddenStyle)),this.itemMarginTop=u.itemMarginTop,this.itemMarginBottom=u.itemMarginBottom,this.padding=v,this.initialItemY=v-5,this.symbolWidth=dd(u.symbolWidth,16),this.pages=[],this.proximate=u.layout==="proximate"&&!this.chart.inverted,this.baseline=void 0}update(u,v){let M=this.chart;this.setOptions(cu(!0,this.options,u)),"events"in this.options&&_a(this,this.options),this.destroy(),M.isDirtyLegend=M.isDirtyBox=!0,dd(v,!0)&&M.redraw(),Nu(this,"afterUpdate",{redraw:v})}colorizeItem(u,v){var le;let M=u.color,{area:z,group:F,label:V,line:G,symbol:Q}=u.legendItem||{};if((u instanceof Dh||u instanceof bn)&&(u.color=((le=u.options)==null?void 0:le.legendSymbolColor)||M),F==null||F[v?"removeClass":"addClass"]("highcharts-legend-item-hidden"),!this.chart.styledMode){let{itemHiddenStyle:ye={}}=this,ce=ye.color,{fillColor:we,fillOpacity:Le,lineColor:Ue,marker:et}=u.options,tt=$e=>(!v&&($e.fill&&($e.fill=ce),$e.stroke&&($e.stroke=ce)),$e);V==null||V.css(cu(v?this.itemStyle:ye)),G==null||G.attr(tt({stroke:Ue||u.color})),Q&&Q.attr(tt(et&&Q.isMarker?u.pointAttribs():{fill:u.color})),z==null||z.attr(tt({fill:we||u.color,"fill-opacity":we?1:Le??.75}))}u.color=M,Nu(this,"afterColorizeItem",{item:u,visible:v})}positionItems(){this.allItems.forEach(this.positionItem,this),this.chart.isResizing||this.positionCheckboxes()}positionItem(u){let{group:v,x:M=0,y:z=0}=u.legendItem||{},F=this.options,V=F.symbolPadding,G=!F.rtl,Q=u.checkbox;if(v!=null&&v.element){let le={translateX:G?M:this.legendWidth-M-2*V-4,translateY:z};v[Tf(v.translateY)?"animate":"attr"](le,void 0,()=>{Nu(this,"afterPositionItem",{item:u})})}Q&&(Q.x=M,Q.y=z)}destroyItem(u){let v=u.checkbox,M=u.legendItem||{};for(let z of["group","label","line","symbol"])M[z]&&(M[z]=M[z].destroy());v&&Sf(v),u.legendItem=void 0}destroy(){for(let u of this.getAllItems())this.destroyItem(u);for(let u of["clipRect","up","down","pager","nav","box","title","group"])this[u]&&(this[u]=this[u].destroy());this.display=null}positionCheckboxes(){var F;let u,v=(F=this.group)==null?void 0:F.alignAttr,M=this.clipHeight||this.legendHeight,z=this.titleHeight;v&&(u=v.translateY,this.allItems.forEach(function(V){let G,Q=V.checkbox;Q&&(G=u+z+Q.y+(this.scrollOffset||0)+3,Vl(Q,{left:v.translateX+V.checkboxOffset+Q.x-20+"px",top:G+"px",display:this.proximate||G>u-6&&G<u+M-6?"":"none"}))},this))}renderTitle(){let u=this.options,v=this.padding,M=u.title,z,F=0;M.text&&(this.title||(this.title=this.chart.renderer.label(M.text,v-3,v-4,void 0,void 0,void 0,u.useHTML,void 0,"legend-title").attr({zIndex:1}),this.chart.styledMode||this.title.css(M.style),this.title.add(this.group)),M.width||this.title.css({width:this.maxLegendWidth+"px"}),F=(z=this.title.getBBox()).height,this.offsetWidth=z.width,this.contentGroup.attr({translateY:F})),this.titleHeight=F}setText(u){let v=this.options;u.legendItem.label.attr({text:v.labelFormat?Vo(v.labelFormat,u,this.chart):v.labelFormatter.call(u)})}renderItem(u){var Ri;let v=u.legendItem=u.legendItem||{},M=this.chart,z=M.renderer,F=this.options,V=F.layout==="horizontal",G=this.symbolWidth,Q=F.symbolPadding||0,le=this.itemStyle,ye=this.itemHiddenStyle,ce=V?dd(F.itemDistance,20):0,we=!F.rtl,Le=!u.series,Ue=!Le&&u.series.drawLegendSymbol?u.series:u,et=Ue.options,tt=!!this.createCheckboxForItem&&et&&et.showCheckbox,$e=F.useHTML,ht=u.options.className,yt=v.label,ci=G+Q+ce+20*!!tt;!yt&&(v.group=z.g("legend-item").addClass("highcharts-"+Ue.type+"-series highcharts-color-"+u.colorIndex+(ht?" "+ht:"")+(Le?" highcharts-series-"+u.index:"")).attr({zIndex:1}).add(this.scrollGroup),v.label=yt=z.text("",we?G+Q:-Q,this.baseline||0,$e),M.styledMode||yt.css(cu(u.visible?le:ye)),yt.attr({align:we?"left":"right",zIndex:2}).add(v.group),!this.baseline&&(this.fontMetrics=z.fontMetrics(yt),this.baseline=this.fontMetrics.f+3+this.itemMarginTop,yt.attr("y",this.baseline),this.symbolHeight=dd(F.symbolHeight,this.fontMetrics.f),F.squareSymbol&&(this.symbolWidth=dd(F.symbolWidth,Math.max(this.symbolHeight,16)),ci=this.symbolWidth+Q+ce+20*!!tt,we&&yt.attr("x",this.symbolWidth+Q))),Ue.drawLegendSymbol(this,u),this.setItemEvents&&this.setItemEvents(u,yt,$e)),tt&&!u.checkbox&&this.createCheckboxForItem&&this.createCheckboxForItem(u),this.colorizeItem(u,u.visible),(M.styledMode||!le.width)&&yt.css({width:(F.itemWidth||this.widthOption||M.spacingBox.width)-ci+"px"}),this.setText(u);let ii=yt.getBBox(),ri=((Ri=this.fontMetrics)==null?void 0:Ri.h)||0;u.itemWidth=u.checkboxOffset=F.itemWidth||v.labelWidth||ii.width+ci,this.maxItemWidth=Math.max(this.maxItemWidth,u.itemWidth),this.totalItemWidth+=u.itemWidth,this.itemHeight=u.itemHeight=Math.round(v.labelHeight||(ii.height>1.5*ri?ii.height:ri))}layoutItem(u){let v=this.options,M=this.padding,z=v.layout==="horizontal",F=u.itemHeight,V=this.itemMarginBottom,G=this.itemMarginTop,Q=z?dd(v.itemDistance,20):0,le=this.maxLegendWidth,ye=v.alignColumns&&this.totalItemWidth>le?this.maxItemWidth:u.itemWidth,ce=u.legendItem||{};z&&this.itemX-M+ye>le&&(this.itemX=M,this.lastLineHeight&&(this.itemY+=G+this.lastLineHeight+V),this.lastLineHeight=0),this.lastItemY=G+this.itemY+V,this.lastLineHeight=Math.max(F,this.lastLineHeight),ce.x=this.itemX,ce.y=this.itemY,z?this.itemX+=ye:(this.itemY+=G+F+V,this.lastLineHeight=F),this.offsetWidth=this.widthOption||Math.max((z?this.itemX-M-(u.checkbox?0:Q):ye)+M,this.offsetWidth)}getAllItems(){let u=[];return this.chart.series.forEach(function(v){var z;let M=v==null?void 0:v.options;v&&dd(M.showInLegend,!Tf(M.linkedTo)&&void 0,!0)&&(u=u.concat(((z=v.legendItem)==null?void 0:z.labels)||(M.legendType==="point"?v.data:v)))}),Nu(this,"afterGetAllItems",{allItems:u}),u}getAlignment(){let u=this.options;return this.proximate?u.align.charAt(0)+"tv":u.floating?"":u.align.charAt(0)+u.verticalAlign.charAt(0)+u.layout.charAt(0)}adjustMargins(u,v){let M=this.chart,z=this.options,F=this.getAlignment();F&&[/(lth|ct|rth)/,/(rtv|rm|rbv)/,/(rbh|cb|lbh)/,/(lbv|lm|ltv)/].forEach(function(V,G){V.test(F)&&!Tf(u[G])&&(M[Rm[G]]=Math.max(M[Rm[G]],M.legend[(G+1)%2?"legendHeight":"legendWidth"]+[1,-1,-1,1][G]*z[G%2?"x":"y"]+dd(z.margin,12)+v[G]+(M.titleOffset[G]||0)))})}proximatePositions(){let u,v=this.chart,M=[],z=this.options.align==="left";for(let F of(this.allItems.forEach(function(V){let G,Q,le=z,ye,ce;V.yAxis&&(V.xAxis.options.reversed&&(le=!le),V.points&&(G=Sp(le?V.points:V.points.slice(0).reverse(),function(we){return Mp(we.plotY)})),Q=this.itemMarginTop+V.legendItem.label.getBBox().height+this.itemMarginBottom,ce=V.yAxis.top-v.plotTop,ye=V.visible?(G?G.plotY:V.yAxis.height)+(ce-.3*Q):ce+V.yAxis.height,M.push({target:ye,size:Q,item:V}))},this),On(M,v.plotHeight)))u=F.item.legendItem||{},Mp(F.pos)&&(u.y=v.plotTop-v.spacing[0]+F.pos)}render(){let u=this.chart,v=u.renderer,M=this.options,z=this.padding,F=this.getAllItems(),V,G,Q,le=this.group,ye,ce=this.box;this.itemX=z,this.itemY=this.initialItemY,this.offsetWidth=0,this.lastItemY=0,this.widthOption=Kp(M.width,u.spacingBox.width-z),ye=u.spacingBox.width-2*z-M.x,["rm","lm"].indexOf(this.getAlignment().substring(0,2))>-1&&(ye/=2),this.maxLegendWidth=this.widthOption||ye,le||(this.group=le=v.g("legend").addClass(M.className||"").attr({zIndex:7}).add(),this.contentGroup=v.g().attr({zIndex:1}).add(le),this.scrollGroup=v.g().add(this.contentGroup)),this.renderTitle(),Bm(F,(we,Le)=>{var Ue,et;return(((Ue=we.options)==null?void 0:Ue.legendIndex)||0)-(((et=Le.options)==null?void 0:et.legendIndex)||0)}),M.reversed&&F.reverse(),this.allItems=F,this.display=V=!!F.length,this.lastLineHeight=0,this.maxItemWidth=0,this.totalItemWidth=0,this.itemHeight=0,F.forEach(this.renderItem,this),F.forEach(this.layoutItem,this),G=(this.widthOption||this.offsetWidth)+z,Q=this.lastItemY+this.lastLineHeight+this.titleHeight,Q=this.handleOverflow(Q)+z,ce||(this.box=ce=v.rect().addClass("highcharts-legend-box").attr({r:M.borderRadius}).add(le)),u.styledMode||ce.attr({stroke:M.borderColor,"stroke-width":M.borderWidth||0,fill:M.backgroundColor||"none"}).shadow(M.shadow),G>0&&Q>0&&ce[ce.placed?"animate":"attr"](ce.crisp.call({},{x:0,y:0,width:G,height:Q},ce.strokeWidth())),le[V?"show":"hide"](),u.styledMode&&le.getStyle("display")==="none"&&(G=Q=0),this.legendWidth=G,this.legendHeight=Q,V&&this.align(),this.proximate||this.positionItems(),Nu(this,"afterRender")}align(u=this.chart.spacingBox){let v=this.chart,M=this.options,z=u.y;/(lth|ct|rth)/.test(this.getAlignment())&&v.titleOffset[0]>0?z+=v.titleOffset[0]:/(lbh|cb|rbh)/.test(this.getAlignment())&&v.titleOffset[2]>0&&(z-=v.titleOffset[2]),z!==u.y&&(u=cu(u,{y:z})),v.hasRendered||(this.group.placed=!1),this.group.align(cu(M,{width:this.legendWidth,height:this.legendHeight,verticalAlign:this.proximate?"top":M.verticalAlign}),!0,u)}handleOverflow(u){let v=this,M=this.chart,z=M.renderer,F=this.options,V=F.y,G=F.verticalAlign==="top",Q=this.padding,le=F.maxHeight,ye=F.navigation,ce=dd(ye.animation,!0),we=ye.arrowSize||12,Le=this.pages,Ue=this.allItems,et=function(ki){typeof ki=="number"?Ri.attr({height:ki}):Ri&&(v.clipRect=Ri.destroy(),v.contentGroup.clip()),v.contentGroup.div&&(v.contentGroup.div.style.clip=ki?"rect("+Q+"px,9999px,"+(Q+ki)+"px,0)":"auto")},tt=function(ki){return v[ki]=z.circle(0,0,1.3*we).translate(we/2,we/2).add(ri),M.styledMode||v[ki].attr("fill","rgba(0,0,0,0.0001)"),v[ki]},$e,ht,yt,ci,ii=M.spacingBox.height+(G?-V:V)-Q,ri=this.nav,Ri=this.clipRect;return F.layout!=="horizontal"||F.verticalAlign==="middle"||F.floating||(ii/=2),le&&(ii=Math.min(ii,le)),Le.length=0,u&&ii>0&&u>ii&&ye.enabled!==!1?(this.clipHeight=$e=Math.max(ii-20-this.titleHeight-Q,0),this.currentPage=dd(this.currentPage,1),this.fullHeight=u,Ue.forEach((ki,Li)=>{let ls=(yt=ki.legendItem||{}).y||0,vs=Math.round(yt.label.getBBox().height),Ys=Le.length;(!Ys||ls-Le[Ys-1]>$e&&(ht||ls)!==Le[Ys-1])&&(Le.push(ht||ls),Ys++),yt.pageIx=Ys-1,ht&&ci&&(ci.pageIx=Ys-1),Li===Ue.length-1&&ls+vs-Le[Ys-1]>$e&&ls>Le[Ys-1]&&(Le.push(ls),yt.pageIx=Ys),ls!==ht&&(ht=ls),ci=yt}),Ri||(Ri=v.clipRect=z.clipRect(0,Q-2,9999,0),v.contentGroup.clip(Ri)),et($e),ri||(this.nav=ri=z.g().attr({zIndex:1}).add(this.group),this.up=z.symbol("triangle",0,0,we,we).add(ri),tt("upTracker").on("click",function(){v.scroll(-1,ce)}),this.pager=z.text("",15,10).addClass("highcharts-legend-navigation"),!M.styledMode&&ye.style&&this.pager.css(ye.style),this.pager.add(ri),this.down=z.symbol("triangle-down",0,0,we,we).add(ri),tt("downTracker").on("click",function(){v.scroll(1,ce)})),v.scroll(0),u=ii):ri&&(et(),this.nav=ri.destroy(),this.scrollGroup.attr({translateY:1}),this.clipHeight=0),u}scroll(u,v){let M=this.chart,z=this.pages,F=z.length,V=this.clipHeight,G=this.options.navigation,Q=this.pager,le=this.padding,ye=this.currentPage+u;ye>F&&(ye=F),ye>0&&(v!==void 0&&Nl(v,M),this.nav.attr({translateX:le,translateY:V+this.padding+7+this.titleHeight,visibility:"inherit"}),[this.up,this.upTracker].forEach(function(ce){ce.attr({class:ye===1?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"})}),Q.attr({text:ye+"/"+F}),[this.down,this.downTracker].forEach(function(ce){ce.attr({x:18+this.pager.getBBox().width,class:ye===F?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"})},this),M.styledMode||(this.up.attr({fill:ye===1?G.inactiveColor:G.activeColor}),this.upTracker.css({cursor:ye===1?"default":"pointer"}),this.down.attr({fill:ye===F?G.inactiveColor:G.activeColor}),this.downTracker.css({cursor:ye===F?"default":"pointer"})),this.scrollOffset=-z[ye-1]+this.initialItemY,this.scrollGroup.animate({translateY:this.scrollOffset}),this.currentPage=ye,this.positionCheckboxes(),ud(()=>{Nu(this,"afterScroll",{currentPage:ye})},hu(dd(v,M.renderer.globalAnimation,!0)).duration))}setItemEvents(u,v,M){let z=this,F=u.legendItem||{},V=z.chart.renderer.boxWrapper,G=u instanceof bn,Q=u instanceof Dh,le="highcharts-legend-"+(G?"point":"series")+"-active",ye=z.chart.styledMode,ce=M?[v,F.symbol]:[F.group],we=Le=>{z.allItems.forEach(Ue=>{u!==Ue&&[Ue].concat(Ue.linkedSeries||[]).forEach(et=>{et.setState(Le,!G)})})};for(let Le of ce)Le&&Le.on("mouseover",function(){u.visible&&we("inactive"),u.setState("hover"),u.visible&&V.addClass(le),ye||v.css(z.options.itemHoverStyle)}).on("mouseout",function(){z.chart.styledMode||v.css(cu(u.visible?z.itemStyle:z.itemHiddenStyle)),we(""),V.removeClass(le),u.setState()}).on("click",function(Ue){let et=function(){u.setVisible&&u.setVisible(),we(u.visible?"inactive":"")};V.removeClass(le),Nu(z,"itemClick",{browserEvent:Ue,legendItem:u},et),G?u.firePointEvent("legendItemClick",{browserEvent:Ue}):Q&&Nu(u,"legendItemClick",{browserEvent:Ue})})}createCheckboxForItem(u){u.checkbox=Dd("input",{type:"checkbox",className:"highcharts-legend-checkbox",checked:u.selected,defaultChecked:u.selected},this.options.itemCheckboxStyle,this.chart.container),bo(u.checkbox,"click",function(v){let M=v.target;Nu(u.series||u,"checkboxClick",{checked:M.checked,item:u},function(){u.select()})})}}(function(he){he.compose=function(u){Xc(th,"Core.Legend")&&bo(u,"beforeMargins",function(){this.legend=new he(this,this.options.legend)})}})(Ap||(Ap={}));let zd=Ap,{animate:wn,animObject:Mf,setAnimation:wc}=Ws,{defaultOptions:Tc}=Za,{numberFormat:dg}=Ma,{registerEventOptions:lm}=od,{charts:du,doc:ml,marginNames:Jp,svg:hm,win:Qp}=Pi,{seriesTypes:sp}=eo,{addEvent:rp,attr:uu,createElement:op,css:bh,defined:Sc,diffObjects:Vu,discardElement:kp,erase:Af,error:kf,extend:Yc,find:Mc,fireEvent:Xo,getAlignFactor:Fm,getStyle:pd,isArray:Ep,isNumber:np,isObject:ap,isString:Ef,merge:Uo,objectEach:Uu,pick:$l,pInt:Fn,relativeLength:ef,removeEvent:ug,splat:Cf,syncTimeout:zh,uniqueKey:sa}=Qs;class Ha{static chart(u,v,M){return new Ha(u,v,M)}constructor(u,v,M){this.sharedClips={};let z=[...arguments];(Ef(u)||u.nodeName)&&(this.renderTo=z.shift()),this.init(z[0],z[1])}setZoomOptions(){let u=this.options.chart,v=u.zooming;this.zooming={...v,type:$l(u.zoomType,v.type),key:$l(u.zoomKey,v.key),pinchType:$l(u.pinchType,v.pinchType),singleTouch:$l(u.zoomBySingleTouch,v.singleTouch,!1),resetButton:Uo(v.resetButton,u.resetZoomButton)}}init(u,v){Xo(this,"init",{args:arguments},function(){var V;let M=Uo(Tc,u),z=M.chart,F=this.renderTo||z.renderTo;this.userOptions=Yc({},u),(this.renderTo=Ef(F)?ml.getElementById(F):F)||kf(13,!0,this),this.margin=[],this.spacing=[],this.labelCollectors=[],this.callback=v,this.isResizing=0,this.options=M,this.axes=[],this.series=[],this.locale=M.lang.locale??((V=this.renderTo.closest("[lang]"))==null?void 0:V.lang),this.time=new Wl(Yc(M.time||{},{locale:this.locale}),M.lang),M.time=this.time.options,this.numberFormatter=(z.numberFormatter||dg).bind(this),this.styledMode=z.styledMode,this.hasCartesianSeries=z.showAxes,this.index=du.length,du.push(this),Pi.chartCount++,lm(this,z),this.xAxis=[],this.yAxis=[],this.pointCount=this.colorCounter=this.symbolCounter=0,this.setZoomOptions(),Xo(this,"afterInit"),this.firstRender()})}initSeries(u){let v=this.options.chart,M=u.type||v.type,z=sp[M];z||kf(17,!0,this,{missingModuleFor:M});let F=new z;return typeof F.init=="function"&&F.init(this,u),F}setSortedData(){this.getSeriesOrderByLinks().forEach(function(u){u.points||u.data||!u.enabledDataSorting||u.setData(u.options.data,!1)})}getSeriesOrderByLinks(){return this.series.concat().sort(function(u,v){return u.linkedSeries.length||v.linkedSeries.length?v.linkedSeries.length-u.linkedSeries.length:0})}orderItems(u,v=0){let M=this[u],z=this.options[u]=Cf(this.options[u]).slice(),F=this.userOptions[u]=this.userOptions[u]?Cf(this.userOptions[u]).slice():[];if(this.hasRendered&&(z.splice(v),F.splice(v)),M)for(let V=v,G=M.length;V<G;++V){let Q=M[V];Q&&(Q.index=V,Q instanceof Dh&&(Q.name=Q.getName()),Q.options.isInternal||(z[V]=Q.options,F[V]=Q.userOptions))}}getClipBox(u,v){var ye,ce;let M=this.inverted,{xAxis:z,yAxis:F}=u||{},{x:V,y:G,width:Q,height:le}=Uo(this.clipBox);return u&&(z&&z.len!==this.plotSizeX&&(Q=z.len),F&&F.len!==this.plotSizeY&&(le=F.len),M&&!u.invertible&&([Q,le]=[le,Q])),v&&(V+=((ye=M?F:z)==null?void 0:ye.pos)??this.plotLeft,G+=((ce=M?z:F)==null?void 0:ce.pos)??this.plotTop),{x:V,y:G,width:Q,height:le}}isInsidePlot(u,v,M={}){var tt;let{inverted:z,plotBox:F,plotLeft:V,plotTop:G,scrollablePlotBox:Q}=this,{scrollLeft:le=0,scrollTop:ye=0}=M.visiblePlotOnly&&((tt=this.scrollablePlotArea)==null?void 0:tt.scrollingContainer)||{},ce=M.series,we=M.visiblePlotOnly&&Q||F,Le=M.inverted?v:u,Ue=M.inverted?u:v,et={x:Le,y:Ue,isInsidePlot:!0,options:M};if(!M.ignoreX){let $e=ce&&(z&&!this.polar?ce.yAxis:ce.xAxis)||{pos:V,len:1/0},ht=M.paneCoordinates?$e.pos+Le:V+Le;ht>=Math.max(le+V,$e.pos)&&ht<=Math.min(le+V+we.width,$e.pos+$e.len)||(et.isInsidePlot=!1)}if(!M.ignoreY&&et.isInsidePlot){let $e=!z&&M.axis&&!M.axis.isXAxis&&M.axis||ce&&(z?ce.xAxis:ce.yAxis)||{pos:G,len:1/0},ht=M.paneCoordinates?$e.pos+Ue:G+Ue;ht>=Math.max(ye+G,$e.pos)&&ht<=Math.min(ye+G+we.height,$e.pos+$e.len)||(et.isInsidePlot=!1)}return Xo(this,"afterIsInsidePlot",et),et.isInsidePlot}redraw(u){Xo(this,"beforeRedraw");let v=this.hasCartesianSeries?this.axes:this.colorAxis||[],M=this.series,z=this.pointer,F=this.legend,V=this.userOptions.legend,G=this.renderer,Q=G.isHidden(),le=[],ye,ce,we,Le=this.isDirtyBox,Ue=this.isDirtyLegend,et;for(G.rootFontSize=G.boxWrapper.getStyle("font-size"),this.setResponsive&&this.setResponsive(!1),wc(!!this.hasRendered&&u,this),Q&&this.temporaryDisplay(),this.layOutTitles(!1),we=M.length;we--;)if(((et=M[we]).options.stacking||et.options.centerInCategory)&&(ce=!0,et.isDirty)){ye=!0;break}if(ye)for(we=M.length;we--;)(et=M[we]).options.stacking&&(et.isDirty=!0);M.forEach(function(tt){tt.isDirty&&(tt.options.legendType==="point"?(typeof tt.updateTotals=="function"&&tt.updateTotals(),Ue=!0):V&&(V.labelFormatter||V.labelFormat)&&(Ue=!0)),tt.isDirtyData&&Xo(tt,"updatedData")}),Ue&&F&&F.options.enabled&&(F.render(),this.isDirtyLegend=!1),ce&&this.getStacks(),v.forEach(function(tt){tt.updateNames(),tt.setScale()}),this.getMargins(),v.forEach(function(tt){tt.isDirty&&(Le=!0)}),v.forEach(function(tt){let $e=tt.min+","+tt.max;tt.extKey!==$e&&(tt.extKey=$e,le.push(function(){Xo(tt,"afterSetExtremes",Yc(tt.eventArgs,tt.getExtremes())),delete tt.eventArgs})),(Le||ce)&&tt.redraw()}),Le&&this.drawChartBox(),Xo(this,"predraw"),M.forEach(function(tt){(Le||tt.isDirty)&&tt.visible&&tt.redraw(),tt.isDirtyData=!1}),z&&z.reset(!0),G.draw(),Xo(this,"redraw"),Xo(this,"render"),Q&&this.temporaryDisplay(!0),le.forEach(function(tt){tt.call()})}get(u){let v=this.series;function M(F){return F.id===u||F.options&&F.options.id===u}let z=Mc(this.axes,M)||Mc(this.series,M);for(let F=0;!z&&F<v.length;F++)z=Mc(v[F].points||[],M);return z}createAxes(){let u=this.userOptions;for(let v of(Xo(this,"createAxes"),["xAxis","yAxis"]))for(let M of u[v]=Cf(u[v]||{}))new vo(this,M,v);Xo(this,"afterCreateAxes")}getSelectedPoints(){return this.series.reduce((u,v)=>(v.getPointsCollection().forEach(M=>{$l(M.selectedStaging,M.selected)&&u.push(M)}),u),[])}getSelectedSeries(){return this.series.filter(u=>u.selected)}setTitle(u,v,M){this.applyDescription("title",u),this.applyDescription("subtitle",v),this.applyDescription("caption",void 0),this.layOutTitles(M)}applyDescription(u,v){var V;let M=this,z=this.options[u]=Uo(this.options[u],v),F=this[u];F&&v&&(this[u]=F=F.destroy()),z&&!F&&((F=this.renderer.text(z.text,0,0,z.useHTML).attr({align:z.align,class:"highcharts-"+u,zIndex:z.zIndex||4}).css({textOverflow:"ellipsis",whiteSpace:"nowrap"}).add()).update=function(G,Q){M.applyDescription(u,G),M.layOutTitles(Q)},this.styledMode||F.css(Yc(u==="title"?{fontSize:this.options.isStock?"1em":"1.2em"}:{},z.style)),F.textPxLength=F.getBBox().width,F.css({whiteSpace:(V=z.style)==null?void 0:V.whiteSpace}),this[u]=F)}layOutTitles(u=!0){var G,Q,le,ye;let v=[0,0,0],{options:M,renderer:z,spacingBox:F}=this;["title","subtitle","caption"].forEach(ce=>{var tt;let we=this[ce],Le=this.options[ce],Ue=Uo(F),et=(we==null?void 0:we.textPxLength)||0;if(we&&Le){Xo(this,"layOutTitle",{alignTo:Ue,key:ce,textPxLength:et});let $e=z.fontMetrics(we),ht=$e.b,yt=$e.h,ci=Le.verticalAlign||"top",ii=ci==="top",ri=ii&&Le.minScale||1,Ri=ce==="title"?ii?-3:0:ii?v[0]+2:0,ki=Math.min(Ue.width/et,1),Li=Math.max(ri,ki),ls=Uo({y:ci==="bottom"?ht:Ri+ht},{align:ce==="title"?ki<ri?"left":"center":(tt=this.title)==null?void 0:tt.alignValue},Le),vs=(Le.width||(ki>ri?this.chartWidth:Ue.width)/Li)+"px";we.alignValue!==ls.align&&(we.placed=!1);let Ys=Math.round(we.css({width:vs}).getBBox(Le.useHTML).height);if(ls.height=Ys,we.align(ls,!1,Ue).attr({align:ls.align,scaleX:Li,scaleY:Li,"transform-origin":`${Ue.x+et*Li*Fm(ls.align)} ${yt}`}),!Le.floating){let ks=Ys*(Ys<1.2*yt?1:Li);ci==="top"?v[0]=Math.ceil(v[0]+ks):ci==="bottom"&&(v[2]=Math.ceil(v[2]+ks))}}},this),v[0]&&(((G=M.title)==null?void 0:G.verticalAlign)||"top")==="top"&&(v[0]+=((Q=M.title)==null?void 0:Q.margin)||0),v[2]&&((le=M.caption)==null?void 0:le.verticalAlign)==="bottom"&&(v[2]+=((ye=M.caption)==null?void 0:ye.margin)||0);let V=!this.titleOffset||this.titleOffset.join(",")!==v.join(",");this.titleOffset=v,Xo(this,"afterLayOutTitles"),!this.isDirtyBox&&V&&(this.isDirtyBox=this.isDirtyLegend=V,this.hasRendered&&u&&this.isDirtyBox&&this.redraw())}getContainerBox(){let u=[].map.call(this.renderTo.children,M=>{if(M!==this.container){let z=M.style.display;return M.style.display="none",[M,z]}}),v={width:pd(this.renderTo,"width",!0)||0,height:pd(this.renderTo,"height",!0)||0};return u.filter(Boolean).forEach(([M,z])=>{M.style.display=z}),v}getChartSize(){var V;let u=this.options.chart,v=u.width,M=u.height,z=this.getContainerBox(),F=z.height<=1||!((V=this.renderTo.parentElement)!=null&&V.style.height)&&this.renderTo.style.height==="100%";this.chartWidth=Math.max(0,v||z.width||600),this.chartHeight=Math.max(0,ef(M,this.chartWidth)||(F?400:z.height)),this.containerBox=z}temporaryDisplay(u){let v=this.renderTo,M;if(u)for(;v!=null&&v.style;)v.hcOrigStyle&&(bh(v,v.hcOrigStyle),delete v.hcOrigStyle),v.hcOrigDetached&&(ml.body.removeChild(v),v.hcOrigDetached=!1),v=v.parentNode;else for(;v!=null&&v.style&&(ml.body.contains(v)||v.parentNode||(v.hcOrigDetached=!0,ml.body.appendChild(v)),(pd(v,"display",!1)==="none"||v.hcOricDetached)&&(v.hcOrigStyle={display:v.style.display,height:v.style.height,overflow:v.style.overflow},M={display:"block",overflow:"hidden"},v!==this.renderTo&&(M.height=0),bh(v,M),v.offsetWidth||v.style.setProperty("display","block","important")),(v=v.parentNode)!==ml.body););}setClassName(u){this.container.className="highcharts-container "+(u||"")}getContainer(){var we,Le;let u,v=this.options,M=v.chart,z="data-highcharts-chart",F=sa(),V=this.renderTo,G=Fn(uu(V,z));np(G)&&du[G]&&du[G].hasRendered&&du[G].destroy(),uu(V,z,this.index),V.innerHTML=an.emptyHTML,M.skipClone||V.offsetWidth||this.temporaryDisplay(),this.getChartSize();let Q=this.chartHeight,le=this.chartWidth;bh(V,{overflow:"hidden"}),this.styledMode||(u=Yc({position:"relative",overflow:"hidden",width:le+"px",height:Q+"px",textAlign:"left",lineHeight:"normal",zIndex:0,"-webkit-tap-highlight-color":"rgba(0,0,0,0)",userSelect:"none","touch-action":"manipulation",outline:"none",padding:"0px"},M.style||{}));let ye=op("div",{id:F},u,V);this.container=ye,this.getChartSize(),le!==this.chartWidth&&(le=this.chartWidth,this.styledMode||bh(ye,{width:$l((we=M.style)==null?void 0:we.width,le+"px")})),this.containerBox=this.getContainerBox(),this._cursor=ye.style.cursor;let ce=M.renderer||!hm?yn.getRendererType(M.renderer):Qd;if(this.renderer=new ce(ye,le,Q,void 0,M.forExport,(Le=v.exporting)==null?void 0:Le.allowHTML,this.styledMode),wc(void 0,this),this.setClassName(M.className),this.styledMode)for(let Ue in v.defs)this.renderer.definition(v.defs[Ue]);else this.renderer.setStyle(M.style);this.renderer.chartIndex=this.index,Xo(this,"afterGetContainer")}getMargins(u){var F;let{spacing:v,margin:M,titleOffset:z}=this;this.resetMargins(),z[0]&&!Sc(M[0])&&(this.plotTop=Math.max(this.plotTop,z[0]+v[0])),z[2]&&!Sc(M[2])&&(this.marginBottom=Math.max(this.marginBottom,z[2]+v[2])),(F=this.legend)!=null&&F.display&&this.legend.adjustMargins(M,v),Xo(this,"getMargins"),u||this.getAxisMargins()}getAxisMargins(){let u=this,v=u.axisOffset=[0,0,0,0],M=u.colorAxis,z=u.margin,F=function(V){V.forEach(function(G){G.visible&&G.getOffset()})};u.hasCartesianSeries?F(u.axes):M!=null&&M.length&&F(M),Jp.forEach(function(V,G){Sc(z[G])||(u[V]+=v[G])}),u.setChartSize()}getOptions(){return Vu(this.userOptions,Tc)}reflow(u){var F,V;let v=this,M=v.containerBox,z=v.getContainerBox();(F=v.pointer)==null||delete F.chartPosition,!((V=v.exporting)!=null&&V.isPrinting)&&!v.isResizing&&M&&z.width&&((z.width!==M.width||z.height!==M.height)&&(Qs.clearTimeout(v.reflowTimeout),v.reflowTimeout=zh(function(){v.container&&v.setSize(void 0,void 0,!1)},100*!!u)),v.containerBox=z)}setReflow(){let u=this,v=M=>{var z;(z=u.options)!=null&&z.chart.reflow&&u.hasLoaded&&u.reflow(M)};if(typeof ResizeObserver=="function")new ResizeObserver(v).observe(u.renderTo);else{let M=rp(Qp,"resize",v);rp(this,"destroy",M)}}setSize(u,v,M){let z=this,F=z.renderer;z.isResizing+=1,wc(M,z);let V=F.globalAnimation;z.oldChartHeight=z.chartHeight,z.oldChartWidth=z.chartWidth,u!==void 0&&(z.options.chart.width=u),v!==void 0&&(z.options.chart.height=v),z.getChartSize();let{chartWidth:G,chartHeight:Q,scrollablePixelsX:le=0,scrollablePixelsY:ye=0}=z;(z.isDirtyBox||G!==z.oldChartWidth||Q!==z.oldChartHeight)&&(z.styledMode||(V?wn:bh)(z.container,{width:`${G+le}px`,height:`${Q+ye}px`},V),z.setChartSize(!0),F.setSize(G,Q,V),z.axes.forEach(function(ce){ce.isDirty=!0,ce.setScale()}),z.isDirtyLegend=!0,z.isDirtyBox=!0,z.layOutTitles(),z.getMargins(),z.redraw(V),z.oldChartHeight=void 0,Xo(z,"resize"),setTimeout(()=>{z&&Xo(z,"endResize")},Mf(V).duration)),z.isResizing-=1}setChartSize(u){let v,M,z,F,{chartHeight:V,chartWidth:G,inverted:Q,spacing:le,renderer:ye}=this,ce=this.clipOffset,we=Math[Q?"floor":"round"];this.plotLeft=v=Math.round(this.plotLeft),this.plotTop=M=Math.round(this.plotTop),this.plotWidth=z=Math.max(0,Math.round(G-v-(this.marginRight??0))),this.plotHeight=F=Math.max(0,Math.round(V-M-(this.marginBottom??0))),this.plotSizeX=Q?F:z,this.plotSizeY=Q?z:F,this.spacingBox=ye.spacingBox={x:le[3],y:le[0],width:G-le[3]-le[1],height:V-le[0]-le[2]},this.plotBox=ye.plotBox={x:v,y:M,width:z,height:F},ce&&(this.clipBox={x:we(ce[3]),y:we(ce[0]),width:we(this.plotSizeX-ce[1]-ce[3]),height:we(this.plotSizeY-ce[0]-ce[2])}),u||(this.axes.forEach(function(Le){Le.setAxisSize(),Le.setAxisTranslation()}),ye.alignElements()),Xo(this,"afterSetChartSize",{skipAxes:u})}resetMargins(){Xo(this,"resetMargins");let u=this,v=u.options.chart,M=v.plotBorderWidth||0,z=Math.round(M)/2;["margin","spacing"].forEach(function(F){let V=v[F],G=ap(V)?V:[V,V,V,V];["Top","Right","Bottom","Left"].forEach(function(Q,le){u[F][le]=$l(v[F+Q],G[le])})}),Jp.forEach(function(F,V){u[F]=$l(u.margin[V],u.spacing[V])}),u.axisOffset=[0,0,0,0],u.clipOffset=[z,z,z,z],u.plotBorderWidth=M}drawChartBox(){let u=this.options.chart,v=this.renderer,M=this.chartWidth,z=this.chartHeight,F=this.styledMode,V=this.plotBGImage,G=u.backgroundColor,Q=u.plotBackgroundColor,le=u.plotBackgroundImage,ye=this.plotLeft,ce=this.plotTop,we=this.plotWidth,Le=this.plotHeight,Ue=this.plotBox,et=this.clipRect,tt=this.clipBox,$e=this.chartBackground,ht=this.plotBackground,yt=this.plotBorder,ci,ii,ri,Ri="animate";$e||(this.chartBackground=$e=v.rect().addClass("highcharts-background").add(),Ri="attr"),F?ci=ii=$e.strokeWidth():(ii=(ci=u.borderWidth||0)+8*!!u.shadow,ri={fill:G||"none"},(ci||$e["stroke-width"])&&(ri.stroke=u.borderColor,ri["stroke-width"]=ci),$e.attr(ri).shadow(u.shadow)),$e[Ri]({x:ii/2,y:ii/2,width:M-ii-ci%2,height:z-ii-ci%2,r:u.borderRadius}),Ri="animate",ht||(Ri="attr",this.plotBackground=ht=v.rect().addClass("highcharts-plot-background").add()),ht[Ri](Ue),!F&&(ht.attr({fill:Q||"none"}).shadow(u.plotShadow),le&&(V?(le!==V.attr("href")&&V.attr("href",le),V.animate(Ue)):this.plotBGImage=v.image(le,ye,ce,we,Le).add())),et?et.animate({width:tt.width,height:tt.height}):this.clipRect=v.clipRect(tt),Ri="animate",yt||(Ri="attr",this.plotBorder=yt=v.rect().addClass("highcharts-plot-border").attr({zIndex:1}).add()),F||yt.attr({stroke:u.plotBorderColor,"stroke-width":u.plotBorderWidth||0,fill:"none"}),yt[Ri](yt.crisp(Ue,-yt.strokeWidth())),this.isDirtyBox=!1,Xo(this,"afterDrawChartBox")}propFromSeries(){let u,v,M,z=this,F=z.options.chart,V=z.options.series;["inverted","angular","polar"].forEach(function(G){for(v=sp[F.type],M=F[G]||v&&v.prototype[G],u=V==null?void 0:V.length;!M&&u--;)(v=sp[V[u].type])&&v.prototype[G]&&(M=!0);z[G]=M})}linkSeries(u){let v=this,M=v.series;M.forEach(function(z){z.linkedSeries.length=0}),M.forEach(function(z){let{linkedTo:F}=z.options;if(Ef(F)){let V;(V=F===":previous"?v.series[z.index-1]:v.get(F))&&V.linkedParent!==z&&(V.linkedSeries.push(z),z.linkedParent=V,V.enabledDataSorting&&z.setDataSortingOptions(),z.visible=$l(z.options.visible,V.options.visible,z.visible))}}),Xo(this,"afterLinkSeries",{isUpdating:u})}renderSeries(){this.series.forEach(function(u){u.translate(),u.render()})}render(){var ye;let u=this.axes,v=this.colorAxis,M=this.renderer,z=this.options.chart.axisLayoutRuns||2,F=ce=>{ce.forEach(we=>{we.visible&&we.render()})},V=0,G=!0,Q,le=0;for(let ce of(this.setTitle(),Xo(this,"beforeMargins"),(ye=this.getStacks)==null||ye.call(this),this.getMargins(!0),this.setChartSize(),u)){let{options:we}=ce,{labels:Le}=we;if(this.hasCartesianSeries&&ce.horiz&&ce.visible&&Le.enabled&&ce.series.length&&ce.coll!=="colorAxis"&&!this.polar){V=we.tickLength,ce.createGroups();let Ue=new Rl(ce,0,"",!0),et=Ue.createLabel("x",Le);if(Ue.destroy(),et&&$l(Le.reserveSpace,!np(we.crossing))&&(V=et.getBBox().height+Le.distance+Math.max(we.offset||0,0)),V){et==null||et.destroy();break}}}for(this.plotHeight=Math.max(this.plotHeight-V,0);(G||Q||z>1)&&le<z;){let ce=this.plotWidth,we=this.plotHeight;for(let Le of u)le===0?Le.setScale():(Le.horiz&&G||!Le.horiz&&Q)&&Le.setTickInterval(!0);le===0?this.getAxisMargins():this.getMargins(),G=ce/this.plotWidth>(le?1:1.1),Q=we/this.plotHeight>(le?1:1.05),le++}this.drawChartBox(),this.hasCartesianSeries?F(u):v!=null&&v.length&&F(v),this.seriesGroup||(this.seriesGroup=M.g("series-group").attr({zIndex:3}).shadow(this.options.chart.seriesGroupShadow).add()),this.dataLabelsGroup||(this.dataLabelsGroup=M.g("datalabels-group").attr({zIndex:6}).add()),this.renderSeries(),this.addCredits(),this.setResponsive&&this.setResponsive(),this.hasRendered=!0}addCredits(u){let v=this,M=Uo(!0,this.options.credits,u);M.enabled&&!this.credits&&(this.credits=this.renderer.text(M.text+(this.mapCredits||""),0,0).addClass("highcharts-credits").on("click",function(){M.href&&(Qp.location.href=M.href)}).attr({align:M.position.align,zIndex:8}),v.styledMode||this.credits.css(M.style),this.credits.add().align(M.position),this.credits.update=function(z){v.credits=v.credits.destroy(),v.addCredits(z)})}destroy(){var G,Q;let u,v=this,M=v.axes,z=v.series,F=v.container,V=F==null?void 0:F.parentNode;for(Xo(v,"destroy"),v.renderer.forExport?Af(du,v):du[v.index]=void 0,Pi.chartCount--,v.renderTo.removeAttribute("data-highcharts-chart"),ug(v),u=M.length;u--;)M[u]=M[u].destroy();for((Q=(G=this.scroller)==null?void 0:G.destroy)==null||Q.call(G),u=z.length;u--;)z[u]=z[u].destroy();["title","subtitle","chartBackground","plotBackground","plotBGImage","plotBorder","seriesGroup","clipRect","credits","pointer","rangeSelector","legend","resetZoomButton","tooltip","renderer"].forEach(le=>{var ye,ce;v[le]=(ce=(ye=v[le])==null?void 0:ye.destroy)==null?void 0:ce.call(ye)}),F&&(F.innerHTML=an.emptyHTML,ug(F),V&&kp(F)),Uu(v,function(le,ye){delete v[ye]})}firstRender(){var z;let u=this,v=u.options;u.getContainer(),u.resetMargins(),u.setChartSize(),u.propFromSeries(),u.createAxes();let M=Ep(v.series)?v.series:[];v.series=[],M.forEach(function(F){u.initSeries(F)}),u.linkSeries(),u.setSortedData(),Xo(u,"beforeRender"),u.render(),(z=u.pointer)==null||z.getChartPosition(),u.renderer.imgCount||u.hasLoaded||u.onload(),u.temporaryDisplay(!0)}onload(){this.callbacks.concat([this.callback]).forEach(function(u){u&&this.index!==void 0&&u.apply(this,[this])},this),Xo(this,"load"),Xo(this,"render"),Sc(this.index)&&this.setReflow(),this.warnIfA11yModuleNotLoaded(),this.hasLoaded=!0}warnIfA11yModuleNotLoaded(){let{options:u,title:v}=this;u&&!this.accessibility&&(this.renderer.boxWrapper.attr({role:"img","aria-label":((v==null?void 0:v.element.textContent)||"").replace(/</g,"&lt;")}),u.accessibility&&u.accessibility.enabled===!1||kf('Highcharts warning: Consider including the "accessibility.js" module to make your chart more usable for people with disabilities. Set the "accessibility.enabled" option to false to remove this warning. See https://www.highcharts.com/docs/accessibility/accessibility-module.',!1,this))}addSeries(u,v,M){let z,F=this;return u&&(v=$l(v,!0),Xo(F,"addSeries",{options:u},function(){z=F.initSeries(u),F.isDirtyLegend=!0,F.linkSeries(),z.enabledDataSorting&&z.setData(u.data,!1),Xo(F,"afterAddSeries",{series:z}),v&&F.redraw(M)})),z}addAxis(u,v,M,z){return this.createAxis(v?"xAxis":"yAxis",{axis:u,redraw:M,animation:z})}addColorAxis(u,v,M){return this.createAxis("colorAxis",{axis:u,redraw:v,animation:M})}createAxis(u,v){let M=new vo(this,v.axis,u);return $l(v.redraw,!0)&&this.redraw(v.animation),M}showLoading(u){let v=this,M=v.options,z=M.loading,F=function(){V&&bh(V,{left:v.plotLeft+"px",top:v.plotTop+"px",width:v.plotWidth+"px",height:v.plotHeight+"px"})},V=v.loadingDiv,G=v.loadingSpan;V||(v.loadingDiv=V=op("div",{className:"highcharts-loading highcharts-loading-hidden"},null,v.container)),G||(v.loadingSpan=G=op("span",{className:"highcharts-loading-inner"},null,V),rp(v,"redraw",F)),V.className="highcharts-loading",an.setElementHTML(G,$l(u,M.lang.loading,"")),!v.styledMode&&(bh(V,Yc(z.style,{zIndex:10})),bh(G,z.labelStyle),v.loadingShown||(bh(V,{opacity:0,display:""}),wn(V,{opacity:z.style.opacity||.5},{duration:z.showDuration||0}))),v.loadingShown=!0,F()}hideLoading(){let u=this.options,v=this.loadingDiv;v&&(v.className="highcharts-loading highcharts-loading-hidden",this.styledMode||wn(v,{opacity:0},{duration:u.loading.hideDuration||100,complete:function(){bh(v,{display:"none"})}})),this.loadingShown=!1}update(u,v,M,z){let F,V,G,Q=this,le={credits:"addCredits",title:"setTitle",subtitle:"setSubtitle",caption:"setCaption"},ye=u.isResponsiveOptions,ce=[];Xo(Q,"update",{options:u}),ye||Q.setResponsive(!1,!0),u=Vu(u,Q.options),Q.userOptions=Uo(Q.userOptions,u);let we=u.chart;we&&(Uo(!0,Q.options.chart,we),this.setZoomOptions(),"className"in we&&Q.setClassName(we.className),("inverted"in we||"polar"in we||"type"in we)&&(Q.propFromSeries(),F=!0),"alignTicks"in we&&(F=!0),"events"in we&&lm(this,we),Uu(we,function(et,tt){Q.propsRequireUpdateSeries.indexOf("chart."+tt)!==-1&&(V=!0),Q.propsRequireDirtyBox.indexOf(tt)!==-1&&(Q.isDirtyBox=!0),Q.propsRequireReflow.indexOf(tt)!==-1&&(Q.isDirtyBox=!0,ye||(G=!0))}),!Q.styledMode&&we.style&&Q.renderer.setStyle(Q.options.chart.style||{})),!Q.styledMode&&u.colors&&(this.options.colors=u.colors),Uu(u,function(et,tt){Q[tt]&&typeof Q[tt].update=="function"?Q[tt].update(et,!1):typeof Q[le[tt]]=="function"?Q[le[tt]](et):tt!=="colors"&&Q.collectionsWithUpdate.indexOf(tt)===-1&&Uo(!0,Q.options[tt],u[tt]),tt!=="chart"&&Q.propsRequireUpdateSeries.indexOf(tt)!==-1&&(V=!0)}),this.collectionsWithUpdate.forEach(function(et){u[et]&&(Cf(u[et]).forEach(function(tt,$e){let ht,yt=Sc(tt.id);yt&&(ht=Q.get(tt.id)),!ht&&Q[et]&&(ht=Q[et][$l(tt.index,$e)])&&(yt&&Sc(ht.options.id)||ht.options.isInternal)&&(ht=void 0),ht&&ht.coll===et&&(ht.update(tt,!1),M&&(ht.touched=!0)),!ht&&M&&Q.collectionsWithInit[et]&&(Q.collectionsWithInit[et][0].apply(Q,[tt].concat(Q.collectionsWithInit[et][1]||[]).concat([!1])).touched=!0)}),M&&Q[et].forEach(function(tt){tt.touched||tt.options.isInternal?delete tt.touched:ce.push(tt)}))}),ce.forEach(function(et){et.chart&&et.remove&&et.remove(!1)}),F&&Q.axes.forEach(function(et){et.update({},!1)}),V&&Q.getSeriesOrderByLinks().forEach(function(et){et.chart&&et.update({},!1)},this);let Le=we==null?void 0:we.width,Ue=we&&(Ef(we.height)?ef(we.height,Le||Q.chartWidth):we.height);G||np(Le)&&Le!==Q.chartWidth||np(Ue)&&Ue!==Q.chartHeight?Q.setSize(Le,Ue,z):$l(v,!0)&&Q.redraw(z),Xo(Q,"afterUpdate",{options:u,redraw:v,animation:z})}setSubtitle(u,v){this.applyDescription("subtitle",u),this.layOutTitles(v)}setCaption(u,v){this.applyDescription("caption",u),this.layOutTitles(v)}showResetZoom(){let u=this,v=Tc.lang,M=u.zooming.resetButton,z=M.theme,F=M.relativeTo==="chart"||M.relativeTo==="spacingBox"?null:"plotBox";function V(){u.zoomOut()}Xo(this,"beforeShowResetZoom",null,function(){u.resetZoomButton=u.renderer.button(v.resetZoom,null,null,V,z).attr({align:M.position.align,title:v.resetZoomTitle}).addClass("highcharts-reset-zoom").add().align(M.position,!1,F)}),Xo(this,"afterShowResetZoom")}zoomOut(){Xo(this,"selection",{resetSelection:!0},()=>this.transform({reset:!0,trigger:"zoom"}))}pan(u,v){let M=this,z=typeof v=="object"?v:{enabled:v,type:"x"},F=z.type,V=F&&M[{x:"xAxis",xy:"axes",y:"yAxis"}[F]].filter(Q=>Q.options.panningEnabled&&!Q.options.isInternal),G=M.options.chart;G!=null&&G.panning&&(G.panning=z),Xo(this,"pan",{originalEvent:u},()=>{M.transform({axes:V,event:u,to:{x:u.chartX-(M.mouseDownX||0),y:u.chartY-(M.mouseDownY||0)},trigger:"pan"}),bh(M.container,{cursor:"move"})})}transform(u){var Ue;let{axes:v=this.axes,event:M,from:z={},reset:F,selection:V,to:G={},trigger:Q}=u,{inverted:le,time:ye}=this;(Ue=this.hoverPoints)==null||Ue.forEach(et=>et.setState()),Xo(this,"transform",u);let ce=u.hasZoomed||!1,we,Le;for(let et of v){let{horiz:tt,len:$e,minPointOffset:ht=0,options:yt,reversed:ci}=et,ii=tt?"width":"height",ri=tt?"x":"y",Ri=$l(G[ii],et.len),ki=$l(z[ii],et.len),Li=10>Math.abs(Ri)?1:Ri/ki,ls=(z[ri]||0)+ki/2-et.pos,vs=ls-((G[ri]??et.pos)+Ri/2-et.pos)/Li,Ys=ci&&!le||!ci&&le?-1:1;if(!F&&(ls<0||ls>et.len))continue;let ks=et.chart.polar||et.isOrdinal?0:ht*Ys||0,Lr=et.toValue(vs,!0),Cr=et.toValue(vs+$e/Li,!0),Ur=Lr+ks,nr=Cr-ks,Yr=et.allExtremes;if(V&&V[et.coll].push({axis:et,min:Math.min(Lr,Cr),max:Math.max(Lr,Cr)}),Ur>nr&&([Ur,nr]=[nr,Ur]),Li===1&&!F&&et.coll==="yAxis"&&!Yr){for(let aa of et.series){let il=aa.getExtremes(aa.getProcessedData(!0).modified.getColumn("y")||[],!0);Yr??(Yr={dataMin:Number.MAX_VALUE,dataMax:-Number.MAX_VALUE}),np(il.dataMin)&&np(il.dataMax)&&(Yr.dataMin=Math.min(il.dataMin,Yr.dataMin),Yr.dataMax=Math.max(il.dataMax,Yr.dataMax))}et.allExtremes=Yr}let{dataMin:En,dataMax:Sn,min:Mn,max:Bh}=Yc(et.getExtremes(),Yr||{}),$o=ye.parse(yt.min),Ca=ye.parse(yt.max),Do=En??$o,go=Sn??Ca,Al=nr-Ur,oa=et.categories?0:Math.min(Al,go-Do),na=Do-oa*(Sc($o)?0:yt.minPadding),ph=go+oa*(Sc(Ca)?0:yt.maxPadding),sh=et.allowZoomOutside||Li===1||Q!=="zoom"&&Li>1,_u=Math.min($o??na,na,sh?Mn:na),Ec=Math.max(Ca??ph,ph,sh?Bh:ph);(!et.isOrdinal||Li!==1||F)&&(Ur<_u&&(Ur=_u,Li>=1&&(nr=Ur+Al)),nr>Ec&&(nr=Ec,Li>=1&&(Ur=nr-Al)),(F||et.series.length&&(Ur!==Mn||nr!==Bh)&&Ur>=_u&&nr<=Ec)&&(V?V[et.coll].push({axis:et,min:Ur,max:nr}):(et.isPanning=Q!=="zoom",et.isPanning&&(Le=!0),et.setExtremes(F?void 0:Ur,F?void 0:nr,!1,!1,{move:vs,trigger:Q,scale:Li}),!F&&(Ur>_u||nr<Ec)&&Q!=="mousewheel"&&(we=!0)),ce=!0),this.hasCartesianSeries||F||Q==="mousewheel"||(we=!0),M&&(this[tt?"mouseDownX":"mouseDownY"]=M[tt?"chartX":"chartY"]))}return ce&&(V?Xo(this,"selection",V,()=>{delete u.selection,u.trigger="zoom",this.transform(u)}):(!we||Le||this.resetZoomButton?!we&&this.resetZoomButton&&(this.resetZoomButton=this.resetZoomButton.destroy()):this.showResetZoom(),this.redraw(Q==="zoom"&&(this.options.chart.animation??this.pointCount<100)))),ce}}Yc(Ha.prototype,{callbacks:[],collectionsWithInit:{xAxis:[Ha.prototype.addAxis,[!0]],yAxis:[Ha.prototype.addAxis,[!1]],series:[Ha.prototype.addSeries]},collectionsWithUpdate:["xAxis","yAxis","series"],propsRequireDirtyBox:["backgroundColor","borderColor","borderWidth","borderRadius","plotBackgroundColor","plotBackgroundImage","plotBorderColor","plotBorderWidth","plotShadow","shadow"],propsRequireReflow:["margin","marginTop","marginRight","marginBottom","marginLeft","spacing","spacingTop","spacingRight","spacingBottom","spacingLeft"],propsRequireUpdateSeries:["chart.inverted","chart.polar","chart.ignoreHiddenSeries","chart.type","colors","plotOptions","time","tooltip"]});let{stop:Rd}=Ws,{composed:cm}=Pi,{addEvent:dl,createElement:ju,css:dm,defined:Pf,erase:fd,merge:pu,pushUnique:Nm}=Qs;function ra(){let he=this.scrollablePlotArea;(this.scrollablePixelsX||this.scrollablePixelsY)&&!he&&(this.scrollablePlotArea=he=new fu(this)),he==null||he.applyFixed()}function ih(){this.chart.scrollablePlotArea&&(this.chart.scrollablePlotArea.isDirty=!0)}class fu{static compose(u,v,M){Nm(cm,this.compose)&&(dl(u,"afterInit",ih),dl(v,"afterSetChartSize",z=>this.afterSetSize(z.target,z)),dl(v,"render",ra),dl(M,"show",ih))}static afterSetSize(u,v){let M,z,F,{minWidth:V,minHeight:G}=u.options.chart.scrollablePlotArea||{},{clipBox:Q,plotBox:le,inverted:ye,renderer:ce}=u;if(!ce.forExport&&(V?(u.scrollablePixelsX=M=Math.max(0,V-u.chartWidth),M&&(u.scrollablePlotBox=pu(u.plotBox),le.width=u.plotWidth+=M,Q[ye?"height":"width"]+=M,F=!0)):G&&(u.scrollablePixelsY=z=Math.max(0,G-u.chartHeight),Pf(z)&&(u.scrollablePlotBox=pu(u.plotBox),le.height=u.plotHeight+=z,Q[ye?"width":"height"]+=z,F=!1)),Pf(F)&&!v.skipAxes))for(let we of u.axes)(we.horiz===F||u.hasParallelCoordinates&&we.coll==="yAxis")&&(we.setAxisSize(),we.setAxisTranslation())}constructor(u){var Le;let v,M=u.options.chart,z=yn.getRendererType(),F=M.scrollablePlotArea||{},V=this.moveFixedElements.bind(this),G={WebkitOverflowScrolling:"touch",overflowX:"hidden",overflowY:"hidden"};u.scrollablePixelsX&&(G.overflowX="auto"),u.scrollablePixelsY&&(G.overflowY="auto"),this.chart=u;let Q=this.parentDiv=ju("div",{className:"highcharts-scrolling-parent"},{position:"relative"},u.renderTo),le=this.scrollingContainer=ju("div",{className:"highcharts-scrolling"},G,Q),ye=this.innerContainer=ju("div",{className:"highcharts-inner-container"},void 0,le),ce=this.fixedDiv=ju("div",{className:"highcharts-fixed"},{position:"absolute",overflow:"hidden",pointerEvents:"none",zIndex:(((Le=M.style)==null?void 0:Le.zIndex)||0)+2,top:0},void 0,!0),we=this.fixedRenderer=new z(ce,u.chartWidth,u.chartHeight,M.style);this.mask=we.path().attr({fill:M.backgroundColor||"#fff","fill-opacity":F.opacity??.85,zIndex:-1}).addClass("highcharts-scrollable-mask").add(),le.parentNode.insertBefore(ce,le),dm(u.renderTo,{overflow:"visible"}),dl(u,"afterShowResetZoom",V),dl(u,"afterApplyDrilldown",V),dl(u,"afterLayOutTitles",V),dl(le,"scroll",()=>{let{pointer:Ue,hoverPoint:et}=u;Ue&&(delete Ue.chartPosition,et&&(v=et),Ue.runPointActions(void 0,v,!0))}),ye.appendChild(u.container)}applyFixed(){var ls;let{chart:u,fixedRenderer:v,isDirty:M,scrollingContainer:z}=this,{axisOffset:F,chartWidth:V,chartHeight:G,container:Q,plotHeight:le,plotLeft:ye,plotTop:ce,plotWidth:we,scrollablePixelsX:Le=0,scrollablePixelsY:Ue=0}=u,{scrollPositionX:et=0,scrollPositionY:tt=0}=u.options.chart.scrollablePlotArea||{},$e=V+Le,ht=G+Ue;v.setSize(V,G),(M??!0)&&(this.isDirty=!1,this.moveFixedElements()),Rd(u.container),dm(Q,{width:`${$e}px`,height:`${ht}px`}),u.renderer.boxWrapper.attr({width:$e,height:ht,viewBox:[0,0,$e,ht].join(" ")}),(ls=u.chartBackground)==null||ls.attr({width:$e,height:ht}),dm(z,{width:`${V}px`,height:`${G}px`}),Pf(M)||(z.scrollLeft=Le*et,z.scrollTop=Ue*tt);let yt=ce-F[0]-1,ci=ye-F[3]-1,ii=ce+le+F[2]+1,ri=ye+we+F[1]+1,Ri=ye+we-Le,ki=ce+le-Ue,Li=[["M",0,0]];Le?Li=[["M",0,yt],["L",ye-1,yt],["L",ye-1,ii],["L",0,ii],["Z"],["M",Ri,yt],["L",V,yt],["L",V,ii],["L",Ri,ii],["Z"]]:Ue&&(Li=[["M",ci,0],["L",ci,ce-1],["L",ri,ce-1],["L",ri,0],["Z"],["M",ci,ki],["L",ci,G],["L",ri,G],["L",ri,ki],["Z"]]),u.redrawTrigger!=="adjustHeight"&&this.mask.attr({d:Li})}moveFixedElements(){let u,{container:v,inverted:M,scrollablePixelsX:z,scrollablePixelsY:F}=this.chart,V=this.fixedRenderer,G=fu.fixedSelectors;if(z&&!M?u=".highcharts-yaxis":z&&M||F&&!M?u=".highcharts-xaxis":F&&M&&(u=".highcharts-yaxis"),u&&!(this.chart.hasParallelCoordinates&&u===".highcharts-yaxis"))for(let Q of[`${u}:not(.highcharts-radial-axis)`,`${u}-labels:not(.highcharts-radial-axis-labels)`])Nm(G,Q);else for(let Q of[".highcharts-xaxis",".highcharts-yaxis"])for(let le of[`${Q}:not(.highcharts-radial-axis)`,`${Q}-labels:not(.highcharts-radial-axis-labels)`])fd(G,le);for(let Q of G)[].forEach.call(v.querySelectorAll(Q),le=>{(le.namespaceURI===V.SVG_NS?V.box:V.box.parentNode).appendChild(le),le.style.pointerEvents="auto"})}}fu.fixedSelectors=[".highcharts-breadcrumbs-group",".highcharts-contextbutton",".highcharts-caption",".highcharts-credits",".highcharts-drillup-button",".highcharts-legend",".highcharts-legend-checkbox",".highcharts-navigator-series",".highcharts-navigator-xaxis",".highcharts-navigator-yaxis",".highcharts-navigator",".highcharts-range-selector-group",".highcharts-reset-zoom",".highcharts-scrollbar",".highcharts-subtitle",".highcharts-title"];let{format:um}=Ma,{series:Gu}=eo,{destroyObjectProperties:pg,fireEvent:lp,getAlignFactor:tf,isNumber:mu,pick:Wu}=Qs,Cp=class{constructor(he,u,v,M,z){let F=he.chart.inverted,V=he.reversed;this.axis=he;let G=this.isNegative=!!v!=!!V;this.options=u=u||{},this.x=M,this.total=null,this.cumulative=null,this.points={},this.hasValidPoints=!1,this.stack=z,this.leftCliff=0,this.rightCliff=0,this.alignOptions={align:u.align||(F?G?"left":"right":"center"),verticalAlign:u.verticalAlign||(F?"middle":G?"bottom":"top"),y:u.y,x:u.x},this.textAlign=u.textAlign||(F?G?"right":"left":"center")}destroy(){pg(this,this.axis)}render(he){let u=this.axis.chart,v=this.options,M=v.format,z=M?um(M,this,u):v.formatter.call(this);if(this.label)this.label.attr({text:z,visibility:"hidden"});else{this.label=u.renderer.label(z,null,void 0,v.shape,void 0,void 0,v.useHTML,!1,"stack-labels");let F={r:v.borderRadius||0,text:z,padding:Wu(v.padding,5),visibility:"hidden"};u.styledMode||(F.fill=v.backgroundColor,F.stroke=v.borderColor,F["stroke-width"]=v.borderWidth,this.label.css(v.style||{})),this.label.attr(F),this.label.added||this.label.add(he)}this.label.labelrank=u.plotSizeY,lp(this,"afterRender")}setOffset(he,u,v,M,z,F){let{alignOptions:V,axis:G,label:Q,options:le,textAlign:ye}=this,ce=G.chart,we=this.getStackBox({xOffset:he,width:u,boxBottom:v,boxTop:M,defaultX:z,xAxis:F}),{verticalAlign:Le}=V;if(Q&&we){let Ue=Q.getBBox(void 0,0),et=Q.padding,tt=Wu(le.overflow,"justify")==="justify",$e;V.x=le.x||0,V.y=le.y||0;let{x:ht,y:yt}=this.adjustStackPosition({labelBox:Ue,verticalAlign:Le,textAlign:ye});we.x-=ht,we.y-=yt,Q.align(V,!1,we),($e=ce.isInsidePlot(Q.alignAttr.x+V.x+ht,Q.alignAttr.y+V.y+yt))||(tt=!1),tt&&Gu.prototype.justifyDataLabel.call(G,Q,V,Q.alignAttr,Ue,we),Q.attr({x:Q.alignAttr.x,y:Q.alignAttr.y,rotation:le.rotation,rotationOriginX:Ue.width*tf(le.textAlign||"center"),rotationOriginY:Ue.height/2}),Wu(!tt&&le.crop,!0)&&($e=mu(Q.x)&&mu(Q.y)&&ce.isInsidePlot(Q.x-et+(Q.width||0),Q.y)&&ce.isInsidePlot(Q.x+et,Q.y)),Q[$e?"show":"hide"]()}lp(this,"afterSetOffset",{xOffset:he,width:u})}adjustStackPosition({labelBox:he,verticalAlign:u,textAlign:v}){return{x:he.width/2+he.width/2*(2*tf(v)-1),y:he.height/2*2*(1-tf(u))}}getStackBox(he){let u=this.axis,v=u.chart,{boxTop:M,defaultX:z,xOffset:F,width:V,boxBottom:G}=he,Q=u.stacking.usePercentage?100:Wu(M,this.total,0),le=u.toPixels(Q),ye=he.xAxis||v.xAxis[0],ce=Wu(z,ye.translate(this.x))+F,we=Math.abs(le-u.toPixels(G||mu(u.min)&&u.logarithmic&&u.logarithmic.lin2log(u.min)||0)),Le=v.inverted,Ue=this.isNegative;return Le?{x:(Ue?le:le-we)-v.plotLeft,y:ye.height-ce-V+ye.top-v.plotTop,width:we,height:V}:{x:ce+ye.transB-v.plotLeft,y:(Ue?le-we:le)-v.plotTop,width:V,height:we}}},{getDeferredAnimation:Vm}=Ws,{series:{prototype:If}}=eo,{addEvent:md,correctFloat:Ac,defined:$c,destroyObjectProperties:sf,fireEvent:c,isNumber:t,objectEach:r,pick:d}=Qs;function _(){let he=this.inverted;this.axes.forEach(u=>{var v;(v=u.stacking)!=null&&v.stacks&&u.hasVisibleSeries&&(u.stacking.oldStacks=u.stacking.stacks)}),this.series.forEach(u=>{var M;let v=((M=u.xAxis)==null?void 0:M.options)||{};u.options.stacking&&u.reserveSpace()&&(u.stackKey=[u.type,d(u.options.stack,""),he?v.top:v.left,he?v.height:v.width].join(","))})}function b(){var u;let he=this.stacking;if(he){let v=he.stacks;r(v,(M,z)=>{sf(M),delete v[z]}),(u=he.stackTotalGroup)==null||u.destroy()}}function E(){this.stacking||(this.stacking=new ne(this))}function D(he,u,v,M){return!$c(he)||he.x!==u||M&&he.stackKey!==M?he={x:u,index:0,key:M,stackKey:M}:he.index++,he.key=[v,u,he.index].join(","),he}function U(){let he,u=this,v=u.yAxis,M=u.stackKey||"",z=v.stacking.stacks,F=u.getColumn("x",!0),V=u.options.stacking,G=u[V+"Stacker"];G&&[M,"-"+M].forEach(Q=>{var Le;let le=F.length,ye,ce,we;for(;le--;)ye=F[le],he=u.getStackIndicator(he,ye,u.index,Q),ce=(Le=z[Q])==null?void 0:Le[ye],(we=ce==null?void 0:ce.points[he.key||""])&&G.call(u,we,ce,le)})}function Z(he,u,v){let M=u.total?100/u.total:0;he[0]=Ac(he[0]*M),he[1]=Ac(he[1]*M),this.stackedYData[v]=he[1]}function ie(he){(this.is("column")||this.is("columnrange"))&&(this.options.centerInCategory&&this.chart.series.length>1?If.setStackedPoints.call(this,he,"group"):he.stacking.resetStacks())}function de(he,u){var ki,Li;let v,M,z,F,V,G,Q,le=u||this.options.stacking;if(!le||!this.reserveSpace()||({group:"xAxis"}[le]||"yAxis")!==he.coll)return;let ye=this.getColumn("x",!0),ce=this.getColumn(this.pointValKey||"y",!0),we=[],Le=ce.length,Ue=this.options,et=Ue.threshold||0,tt=Ue.startFromThreshold?et:0,$e=Ue.stack,ht=u?`${this.type},${le}`:this.stackKey||"",yt="-"+ht,ci=this.negStacks,ii=he.stacking,ri=ii.stacks,Ri=ii.oldStacks;for(ii.stacksTouched+=1,Q=0;Q<Le;Q++){let ls=ye[Q]||0,vs=ce[Q],Ys=t(vs)&&vs||0;G=(v=this.getStackIndicator(v,ls,this.index)).key||"",ri[V=(M=ci&&Ys<(tt?0:et))?yt:ht]||(ri[V]={}),ri[V][ls]||((ki=Ri[V])!=null&&ki[ls]?(ri[V][ls]=Ri[V][ls],ri[V][ls].total=null):ri[V][ls]=new Cp(he,he.options.stackLabels,!!M,ls,$e)),z=ri[V][ls],vs!==null?(z.points[G]=z.points[this.index]=[d(z.cumulative,tt)],$c(z.cumulative)||(z.base=G),z.touched=ii.stacksTouched,v.index>0&&this.singleStacks===!1&&(z.points[G][0]=z.points[this.index+","+ls+",0"][0])):(delete z.points[G],delete z.points[this.index]);let ks=z.total||0;le==="percent"?(F=M?ht:yt,ks=ci&&((Li=ri[F])!=null&&Li[ls])?(F=ri[F][ls]).total=Math.max(F.total||0,ks)+Math.abs(Ys):Ac(ks+Math.abs(Ys))):le==="group"?t(vs)&&ks++:ks=Ac(ks+Ys),le==="group"?z.cumulative=(ks||1)-1:z.cumulative=Ac(d(z.cumulative,tt)+Ys),z.total=ks,vs!==null&&(z.points[G].push(z.cumulative),we[Q]=z.cumulative,z.hasValidPoints=!0)}le==="percent"&&(ii.usePercentage=!0),le!=="group"&&(this.stackedYData=we),ii.oldStacks={}}class ne{constructor(u){this.oldStacks={},this.stacks={},this.stacksTouched=0,this.axis=u}buildStacks(){let u,v,M=this.axis,z=M.series,F=M.coll==="xAxis",V=M.options.reversedStacks,G=z.length;for(this.resetStacks(),this.usePercentage=!1,v=G;v--;)u=z[V?v:G-v-1],F&&u.setGroupedPoints(M),u.setStackedPoints(M);if(!F)for(v=0;v<G;v++)z[v].modifyStacks();c(M,"afterBuildStacks")}cleanStacks(){this.oldStacks&&(this.stacks=this.oldStacks,r(this.stacks,u=>{r(u,v=>{v.cumulative=v.total})}))}resetStacks(){r(this.stacks,u=>{r(u,(v,M)=>{t(v.touched)&&v.touched<this.stacksTouched?(v.destroy(),delete u[M]):(v.total=null,v.cumulative=null)})})}renderStackTotals(){var G;let u=this.axis,v=u.chart,M=v.renderer,z=this.stacks,F=Vm(v,((G=u.options.stackLabels)==null?void 0:G.animation)||!1),V=this.stackTotalGroup=this.stackTotalGroup||M.g("stack-labels").attr({zIndex:6,opacity:0}).add();V.translate(v.plotLeft,v.plotTop),r(z,Q=>{r(Q,le=>{le.render(V)})}),V.animate({opacity:1},F)}}(hs||(hs={})).compose=function(he,u,v){let M=u.prototype,z=v.prototype;M.getStacks||(md(he,"init",E),md(he,"destroy",b),M.getStacks=_,z.getStackIndicator=D,z.modifyStacks=U,z.percentStacker=Z,z.setGroupedPoints=ie,z.setStackedPoints=de)};let me=hs,{defined:Ce,merge:Me,isObject:Pe}=Qs;class Ne extends Dh{drawGraph(){let u=this.options,v=(this.gappedPath||this.getGraphPath).call(this),M=this.chart.styledMode;[this,...this.zones].forEach((z,F)=>{let V,G=z.graph,Q=G?"animate":"attr",le=z.dashStyle||u.dashStyle;G?(G.endX=this.preventGraphAnimation?null:v.xMap,G.animate({d:v})):v.length&&(z.graph=G=this.chart.renderer.path(v).addClass("highcharts-graph"+(F?` highcharts-zone-graph-${F-1} `:" ")+(F&&z.className||"")).attr({zIndex:1}).add(this.group)),G&&!M&&(V={stroke:!F&&u.lineColor||z.color||this.color||"#cccccc","stroke-width":u.lineWidth||0,fill:this.fillGraph&&this.color||"none"},le?V.dashstyle=le:u.linecap!=="square"&&(V["stroke-linecap"]=V["stroke-linejoin"]="round"),G[Q](V).shadow(u.shadow&&Me({filterUnits:"userSpaceOnUse"},Pe(u.shadow)?u.shadow:{}))),G&&(G.startX=v.xMap,G.isArea=v.isArea)})}getGraphPath(u,v,M){let z=this,F=z.options,V=[],G=[],Q,le=F.step,ye=(u=u||z.points).reversed;return ye&&u.reverse(),(le={right:1,center:2}[le]||le&&3)&&ye&&(le=4-le),(u=this.getValidPoints(u,!1,F.nullInteraction||!(F.connectNulls&&!v&&!M))).forEach(function(ce,we){let Le,Ue=ce.plotX,et=ce.plotY,tt=u[we-1],$e=ce.isNull||typeof et!="number";(ce.leftCliff||tt!=null&&tt.rightCliff)&&!M&&(Q=!0),$e&&!Ce(v)&&we>0?Q=!F.connectNulls:$e&&!v?Q=!0:(we===0||Q?Le=[["M",ce.plotX,ce.plotY]]:z.getPointSpline?Le=[z.getPointSpline(u,ce,we)]:le?(Le=le===1?[["L",tt.plotX,et]]:le===2?[["L",(tt.plotX+Ue)/2,tt.plotY],["L",(tt.plotX+Ue)/2,et]]:[["L",Ue,tt.plotY]]).push(["L",Ue,et]):Le=[["L",Ue,et]],G.push(ce.x),le&&(G.push(ce.x),le===2&&G.push(ce.x)),V.push.apply(V,Le),Q=!1)}),V.xMap=G,z.graphPath=V,V}}Ne.defaultOptions=Me(Dh.defaultOptions,{legendSymbol:"lineMarker"}),eo.registerSeriesType("line",Ne);let{seriesTypes:{line:He}}=eo,{extend:lt,merge:ut,objectEach:kt,pick:wt}=Qs;class xt extends He{drawGraph(){this.areaPath=[],super.drawGraph.apply(this);let{areaPath:u,options:v}=this;[this,...this.zones].forEach((M,z)=>{let F={},V=M.fillColor||v.fillColor,G=M.area,Q=G?"animate":"attr";G?(G.endX=this.preventGraphAnimation?null:u.xMap,G.animate({d:u})):(F.zIndex=0,(G=M.area=this.chart.renderer.path(u).addClass("highcharts-area"+(z?` highcharts-zone-area-${z-1} `:" ")+(z&&M.className||"")).add(this.group)).isArea=!0),this.chart.styledMode||(F.fill=V||M.color||this.color,F["fill-opacity"]=V?1:v.fillOpacity??.75,G.css({pointerEvents:this.stickyTracking?"none":"auto"})),G[Q](F),G.startX=u.xMap,G.shiftUnit=v.step?2:1})}getGraphPath(u){let v,M,z,F=He.prototype.getGraphPath,V=this.options,G=V.stacking,Q=this.yAxis,le=[],ye=[],ce=this.index,we=Q.stacking.stacks[this.stackKey],Le=V.threshold,Ue=Math.round(Q.getThreshold(V.threshold)),et=wt(V.connectNulls,G==="percent"),tt=function(ri,Ri,ki){let Li=u[ri],ls=G&&we[Li.x].points[ce],vs=Li[ki+"Null"]||0,Ys=Li[ki+"Cliff"]||0,ks,Lr,Cr=!0;Ys||vs?(ks=(vs?ls[0]:ls[1])+Ys,Lr=ls[0]+Ys,Cr=!!vs):!G&&u[Ri]&&u[Ri].isNull&&(ks=Lr=Le),ks!==void 0&&(ye.push({plotX:v,plotY:ks===null?Ue:Q.getThreshold(ks),isNull:Cr,isCliff:!0}),le.push({plotX:v,plotY:Lr===null?Ue:Q.getThreshold(Lr),doCurve:!1}))};u=u||this.points,G&&(u=this.getStackPoints(u));for(let ri=0,Ri=u.length;ri<Ri;++ri)G||(u[ri].leftCliff=u[ri].rightCliff=u[ri].leftNull=u[ri].rightNull=void 0),M=u[ri].isNull,v=wt(u[ri].rectPlotX,u[ri].plotX),z=G?wt(u[ri].yBottom,Ue):Ue,(!M||et)&&(et||tt(ri,ri-1,"left"),M&&!G&&et||(ye.push(u[ri]),le.push({x:ri,plotX:v,plotY:z})),et||tt(ri,ri+1,"right"));let $e=F.call(this,ye,!0,!0);le.reversed=!0;let ht=F.call(this,le,!0,!0),yt=ht[0];yt&&yt[0]==="M"&&(ht[0]=["L",yt[1],yt[2]]);let ci=$e.concat(ht);ci.length&&ci.push(["Z"]);let ii=F.call(this,ye,!1,et);return this.chart.series.length>1&&G&&ye.some(ri=>ri.isCliff)&&(ci.hasStackedCliffs=ii.hasStackedCliffs=!0),ci.xMap=$e.xMap,this.areaPath=ci,ii}getStackPoints(u){let v=this,M=[],z=[],F=this.xAxis,V=this.yAxis,G=V.stacking.stacks[this.stackKey],Q={},le=V.series,ye=le.length,ce=V.options.reversedStacks?1:-1,we=le.indexOf(v);if(u=u||this.points,this.options.stacking){for(let Ue=0;Ue<u.length;Ue++)u[Ue].leftNull=u[Ue].rightNull=void 0,Q[u[Ue].x]=u[Ue];kt(G,function(Ue,et){Ue.total!==null&&z.push(et)}),z.sort(function(Ue,et){return Ue-et});let Le=le.map(Ue=>Ue.visible);z.forEach(function(Ue,et){let tt=0,$e,ht;if(Q[Ue]&&!Q[Ue].isNull)M.push(Q[Ue]),[-1,1].forEach(function(yt){let ci=yt===1?"rightNull":"leftNull",ii=G[z[et+yt]],ri=0;if(ii){let Ri=we;for(;Ri>=0&&Ri<ye;){let ki=le[Ri].index;!($e=ii.points[ki])&&(ki===v.index?Q[Ue][ci]=!0:Le[Ri]&&(ht=G[Ue].points[ki])&&(ri-=ht[1]-ht[0])),Ri+=ce}}Q[Ue][yt===1?"rightCliff":"leftCliff"]=ri});else{let yt=we;for(;yt>=0&&yt<ye;){let ci=le[yt].index;if($e=G[Ue].points[ci]){tt=$e[1];break}yt+=ce}tt=wt(tt,0),tt=V.translate(tt,0,1,0,1),M.push({isNull:!0,plotX:F.translate(Ue,0,0,0,1),x:Ue,plotY:tt,yBottom:tt})}})}return M}}xt.defaultOptions=ut(He.defaultOptions,{threshold:0,legendSymbol:"areaMarker"}),lt(xt.prototype,{singleStacks:!1}),eo.registerSeriesType("area",xt);let{line:pt}=eo.seriesTypes,{merge:At,pick:Ct}=Qs;class ti extends pt{getPointSpline(u,v,M){let z,F,V,G,Q=v.plotX||0,le=v.plotY||0,ye=u[M-1],ce=u[M+1];function we(Ue){return Ue&&!Ue.isNull&&Ue.doCurve!==!1&&!v.isCliff}if(we(ye)&&we(ce)){let Ue=ye.plotX||0,et=ye.plotY||0,tt=ce.plotX||0,$e=ce.plotY||0,ht=0;z=(1.5*Q+Ue)/2.5,F=(1.5*le+et)/2.5,V=(1.5*Q+tt)/2.5,G=(1.5*le+$e)/2.5,V!==z&&(ht=(G-F)*(V-Q)/(V-z)+le-G),F+=ht,G+=ht,F>et&&F>le?(F=Math.max(et,le),G=2*le-F):F<et&&F<le&&(F=Math.min(et,le),G=2*le-F),G>$e&&G>le?(G=Math.max($e,le),F=2*le-G):G<$e&&G<le&&(G=Math.min($e,le),F=2*le-G),v.rightContX=V,v.rightContY=G,v.controlPoints={low:[z,F],high:[V,G]}}let Le=["C",Ct(ye.rightContX,ye.plotX,0),Ct(ye.rightContY,ye.plotY,0),Ct(z,Q,0),Ct(F,le,0),Q,le];return ye.rightContX=ye.rightContY=void 0,Le}}ti.defaultOptions=At(pt.defaultOptions),eo.registerSeriesType("spline",ti);let si=ti,{area:wi,area:{prototype:_i}}=eo.seriesTypes,{extend:Bi,merge:Kt}=Qs;class ui extends si{}ui.defaultOptions=Kt(si.defaultOptions,wi.defaultOptions),Bi(ui.prototype,{getGraphPath:_i.getGraphPath,getStackPoints:_i.getStackPoints,drawGraph:_i.drawGraph}),eo.registerSeriesType("areaspline",ui);let{animObject:Ft}=Ws,{parse:Ai}=lr,{noop:ai}=Pi,{clamp:Di,crisp:Yi,defined:Mi,extend:qi,fireEvent:_s,isArray:Ts,isNumber:us,merge:Os,pick:Rs,objectEach:Js}=Qs;class ur extends Dh{animate(u){let v,M,z=this,F=this.yAxis,V=F.pos,G=F.reversed,Q=z.options,{clipOffset:le,inverted:ye}=this.chart,ce={},we=ye?"translateX":"translateY";u&&le?(ce.scaleY=.001,M=Di(F.toPixels(Q.threshold||0),V,V+F.len),ye?ce.translateX=(M+=G?-Math.floor(le[0]):Math.ceil(le[2]))-F.len:ce.translateY=M+=G?Math.ceil(le[0]):-Math.floor(le[2]),z.clipBox&&z.setClip(),z.group.attr(ce)):(v=Number(z.group.attr(we)),z.group.animate({scaleY:1},qi(Ft(z.options.animation),{step:function(Le,Ue){z.group&&(ce[we]=v+Ue.pos*(V-v),z.group.attr(ce))}})))}init(u,v){super.init.apply(this,arguments);let M=this;(u=M.chart).hasRendered&&u.series.forEach(function(z){z.type===M.type&&(z.isDirty=!0)})}getColumnMetrics(){var et,tt;let u=this,v=u.options,M=u.xAxis,z=u.yAxis,F=M.options.reversedStacks,V=M.reversed&&!F||!M.reversed&&F,G={},Q,le=0;v.grouping===!1?le=1:u.chart.series.forEach(function($e){let ht,yt=$e.yAxis,ci=$e.options;$e.type===u.type&&$e.reserveSpace()&&z.len===yt.len&&z.pos===yt.pos&&(ci.stacking&&ci.stacking!=="group"?(G[Q=$e.stackKey]===void 0&&(G[Q]=le++),ht=G[Q]):ci.grouping!==!1&&(ht=le++),$e.columnIndex=ht)});let ye=Math.min(Math.abs(M.transA)*(!((et=M.brokenAxis)!=null&&et.hasBreaks)&&((tt=M.ordinal)==null?void 0:tt.slope)||v.pointRange||M.closestPointRange||M.tickInterval||1),M.len),ce=ye*v.groupPadding,we=(ye-2*ce)/(le||1),Le=Math.min(v.maxPointWidth||M.len,Rs(v.pointWidth,we*(1-2*v.pointPadding))),Ue=(u.columnIndex||0)+ +!!V;return u.columnMetrics={width:Le,offset:(we-Le)/2+(ce+Ue*we-ye/2)*(V?-1:1),paddedWidth:we,columnCount:le},u.columnMetrics}crispCol(u,v,M,z){let F=this.borderWidth,V=this.chart.inverted;return z=Yi(v+z,F,V)-(v=Yi(v,F,V)),this.options.crisp&&(M=Yi(u+M,F)-(u=Yi(u,F))),{x:u,y:v,width:M,height:z}}adjustForMissingColumns(u,v,M,z){var F;if(!M.isNull&&z.columnCount>1){let V=this.xAxis.series.filter(ye=>ye.visible).map(ye=>ye.index),G=0,Q=0;Js((F=this.xAxis.stacking)==null?void 0:F.stacks,ye=>{var Ue;let ce=typeof M.x=="number"?(Ue=ye[M.x.toString()])==null?void 0:Ue.points:void 0,we=ce==null?void 0:ce[this.index],Le={};if(ce&&Ts(we)){let et=this.index,tt=Object.keys(ce).filter($e=>!$e.match(",")&&ce[$e]&&ce[$e].length>1).map(parseFloat).filter($e=>V.indexOf($e)!==-1).filter($e=>{let ht=this.chart.series[$e].options,yt=ht.stacking&&ht.stack;if(Mi(yt)){if(us(Le[yt]))return et===$e&&(et=Le[yt]),!1;Le[yt]=$e}return!0}).sort(($e,ht)=>ht-$e);G=tt.indexOf(et),Q=tt.length}}),G=this.xAxis.reversed?Q-1-G:G;let le=(Q-1)*z.paddedWidth+v;u=(M.plotX||0)+le/2-v-G*z.paddedWidth}return u}translate(){let u=this,v=u.chart,M=u.options,z=u.dense=u.closestPointRange*u.xAxis.transA<2,F=u.borderWidth=Rs(M.borderWidth,+!z),V=u.xAxis,G=u.yAxis,Q=M.threshold,le=Rs(M.minPointLength,5),ye=u.getColumnMetrics(),ce=ye.width,we=u.pointXOffset=ye.offset,Le=u.dataMin,Ue=u.dataMax,et=u.translatedThreshold=G.getThreshold(Q),tt=u.barW=Math.max(ce,1+2*F);M.pointPadding&&M.crisp&&(tt=Math.ceil(tt)),Dh.prototype.translate.apply(u),u.points.forEach(function($e){let ht=Rs($e.yBottom,et),yt=999+Math.abs(ht),ci=$e.plotX||0,ii=Di($e.plotY,-yt,G.len+yt),ri,Ri=Math.min(ii,ht),ki=Math.max(ii,ht)-Ri,Li=ce,ls=ci+we,vs=tt;le&&Math.abs(ki)<le&&(ki=le,ri=!G.reversed&&!$e.negative||G.reversed&&$e.negative,us(Q)&&us(Ue)&&$e.y===Q&&Ue<=Q&&(G.min||0)<Q&&(Le!==Ue||(G.max||0)<=Q)&&(ri=!ri,$e.negative=!$e.negative),Ri=Math.abs(Ri-et)>le?ht-le:et-(ri?le:0)),Mi($e.options.pointWidth)&&(ls-=Math.round(((Li=vs=Math.ceil($e.options.pointWidth))-ce)/2)),M.centerInCategory&&(ls=u.adjustForMissingColumns(ls,Li,$e,ye)),$e.barX=ls,$e.pointWidth=Li,$e.tooltipPos=v.inverted?[Di(G.len+G.pos-v.plotLeft-ii,G.pos-v.plotLeft,G.len+G.pos-v.plotLeft),V.len+V.pos-v.plotTop-ls-vs/2,ki]:[V.left-v.plotLeft+ls+vs/2,Di(ii+G.pos-v.plotTop,G.pos-v.plotTop,G.len+G.pos-v.plotTop),ki],$e.shapeType=u.pointClass.prototype.shapeType||"roundedRect",$e.shapeArgs=u.crispCol(ls,Ri,vs,$e.isNull?0:ki)}),_s(this,"afterColumnTranslate")}drawGraph(){this.group[this.dense?"addClass":"removeClass"]("highcharts-dense-data")}pointAttribs(u,v){let M=this.options,z=this.pointAttrToOptions||{},F=z.stroke||"borderColor",V=z["stroke-width"]||"borderWidth",G,Q,le,ye=u&&u.color||this.color,ce=u&&u[F]||M[F]||ye,we=u&&u.options.dashStyle||M.dashStyle,Le=u&&u[V]||M[V]||this[V]||0,Ue=u!=null&&u.isNull&&M.nullInteraction?0:(u==null?void 0:u.opacity)??M.opacity??1;u&&this.zones.length&&(Q=u.getZone(),ye=u.options.color||Q&&(Q.color||u.nonZonedColor)||this.color,Q&&(ce=Q.borderColor||ce,we=Q.dashStyle||we,Le=Q.borderWidth||Le)),v&&u&&(le=(G=Os(M.states[v],u.options.states&&u.options.states[v]||{})).brightness,ye=G.color||le!==void 0&&Ai(ye).brighten(G.brightness).get()||ye,ce=G[F]||ce,Le=G[V]||Le,we=G.dashStyle||we,Ue=Rs(G.opacity,Ue));let et={fill:ye,stroke:ce,"stroke-width":Le,opacity:Ue};return we&&(et.dashstyle=we),et}drawPoints(u=this.points){let v,M=this,z=this.chart,F=M.options,V=F.nullInteraction,G=z.renderer,Q=F.animationLimit||250;u.forEach(function(le){let ye=le.plotY,ce=le.graphic,we=!!ce,Le=ce&&z.pointCount<Q?"animate":"attr";us(ye)&&(le.y!==null||V)?(v=le.shapeArgs,ce&&le.hasNewShapeType()&&(ce=ce.destroy()),M.enabledDataSorting&&(le.startXPos=M.xAxis.reversed?-(v&&v.width||0):M.xAxis.width),!ce&&(le.graphic=ce=G[le.shapeType](v).add(le.group||M.group),ce&&M.enabledDataSorting&&z.hasRendered&&z.pointCount<Q&&(ce.attr({x:le.startXPos}),we=!0,Le="animate")),ce&&we&&ce[Le](Os(v)),z.styledMode||ce[Le](M.pointAttribs(le,le.selected&&"select")).shadow(le.allowShadow!==!1&&F.shadow),ce&&(ce.addClass(le.getClassName(),!0),ce.attr({visibility:le.visible?"inherit":"hidden"}))):ce&&(le.graphic=ce.destroy())})}drawTracker(u=this.points){let v,M=this,z=M.chart,F=z.pointer,V=function(G){F==null||F.normalize(G);let Q=F==null?void 0:F.getPointFromEvent(G);F&&Q&&M.options.enableMouseTracking&&(z.isInsidePlot(G.chartX-z.plotLeft,G.chartY-z.plotTop,{visiblePlotOnly:!0})||F!=null&&F.inClass(G.target,"highcharts-data-label"))&&(F.isDirectTouch=!0,Q.onMouseOver(G))};u.forEach(function(G){v=Ts(G.dataLabels)?G.dataLabels:G.dataLabel?[G.dataLabel]:[],G.graphic&&(G.graphic.element.point=G),v.forEach(function(Q){(Q.div||Q.element).point=G})}),M._hasTracking||(M.trackerGroups.forEach(function(G){M[G]&&(M[G].addClass("highcharts-tracker").on("mouseover",V).on("mouseout",function(Q){F==null||F.onTrackerMouseOut(Q)}).on("touchstart",V),!z.styledMode&&M.options.cursor&&M[G].css({cursor:M.options.cursor}))}),M._hasTracking=!0),_s(this,"afterDrawTracker")}remove(){let u=this,v=u.chart;v.hasRendered&&v.series.forEach(function(M){M.type===u.type&&(M.isDirty=!0)}),Dh.prototype.remove.apply(u,arguments)}}ur.defaultOptions=Os(Dh.defaultOptions,{borderRadius:3,centerInCategory:!1,groupPadding:.2,marker:null,pointPadding:.1,minPointLength:0,cropThreshold:50,pointRange:null,states:{hover:{halo:!1,brightness:.1},select:{color:"#cccccc",borderColor:"#000000"}},dataLabels:{align:void 0,verticalAlign:void 0,y:void 0},startFromThreshold:!0,stickyTracking:!1,tooltip:{distance:6},threshold:0,borderColor:"#ffffff"}),qi(ur.prototype,{directTouch:!0,getSymbol:ai,negStacks:!0,trackerGroups:["group","dataLabelsGroup"]}),eo.registerSeriesType("column",ur);let Pr=ur,{getDeferredAnimation:Bo}=Ws,{format:Tn}=Ma,{defined:xo,extend:Yo,fireEvent:Nn,getAlignFactor:Er,isArray:br,isString:zr,merge:_n,objectEach:Xa,pick:Mo,pInt:jo,splat:Yn}=Qs;(function(he){function u(){return Q(this).some(ye=>ye==null?void 0:ye.enabled)}function v(ye,ce,we,Le,Ue){var ls;let{chart:et,enabledDataSorting:tt}=this,$e=this.isCartesian&&et.inverted,ht=ye.plotX,yt=ye.plotY,ci=we.rotation||0,ii=xo(ht)&&xo(yt)&&et.isInsidePlot(ht,Math.round(yt),{inverted:$e,paneCoordinates:!0,series:this}),ri=ci===0&&Mo(we.overflow,tt?"none":"justify")==="justify",Ri=this.visible&&ye.visible!==!1&&xo(ht)&&(ye.series.forceDL||tt&&!ri||ii||Mo(we.inside,!!this.options.stacking)&&Le&&et.isInsidePlot(ht,$e?Le.x+1:Le.y+Le.height-1,{inverted:$e,paneCoordinates:!0,series:this})),ki=ye.pos();if(Ri&&ki){var Li;let vs=ce.getBBox(),Ys=ce.getBBox(void 0,0);if(Le=Yo({x:ki[0],y:Math.round(ki[1]),width:0,height:0},Le||{}),we.alignTo==="plotEdges"&&this.isCartesian&&(Le[$e?"x":"y"]=0,Le[$e?"width":"height"]=((ls=this.yAxis)==null?void 0:ls.len)||0),Yo(we,{width:vs.width,height:vs.height}),Li=Le,tt&&this.xAxis&&!ri&&this.setDataLabelStartPos(ye,ce,Ue,ii,Li),ce.align(_n(we,{width:Ys.width,height:Ys.height}),!1,Le,!1),ce.alignAttr.x+=Er(we.align)*(Ys.width-vs.width),ce.alignAttr.y+=Er(we.verticalAlign)*(Ys.height-vs.height),ce[ce.placed?"animate":"attr"]({"text-align":ce.alignAttr["text-align"]||"center",x:ce.alignAttr.x+(vs.width-Ys.width)/2,y:ce.alignAttr.y+(vs.height-Ys.height)/2,rotationOriginX:(ce.width||0)/2,rotationOriginY:(ce.height||0)/2}),ri&&Le.height>=0)this.justifyDataLabel(ce,we,ce.alignAttr,vs,Le,Ue);else if(Mo(we.crop,!0)){let{x:ks,y:Lr}=ce.alignAttr;Ri=et.isInsidePlot(ks,Lr,{paneCoordinates:!0,series:this})&&et.isInsidePlot(ks+vs.width-1,Lr+vs.height-1,{paneCoordinates:!0,series:this})}we.shape&&!ci&&ce[Ue?"attr":"animate"]({anchorX:ki[0],anchorY:ki[1]})}Ue&&tt&&(ce.placed=!1),Ri||tt&&!ri?(ce.show(),ce.placed=!0):(ce.hide(),ce.placed=!1)}function M(){return this.plotGroup("dataLabelsGroup","data-labels",this.hasRendered?"inherit":"hidden",this.options.dataLabels.zIndex||6,this.chart.dataLabelsGroup)}function z(ye){let ce=this.hasRendered||0,we=this.initDataLabelsGroup().attr({opacity:+ce});return!ce&&we&&(this.visible&&we.show(),this.options.animation?we.animate({opacity:1},ye):we.attr({opacity:1})),we}function F(ye){var Ri;let ce;ye=ye||this.points;let we=this,Le=we.chart,Ue=we.options,et=Le.renderer,{backgroundColor:tt,plotBackgroundColor:$e}=Le.options.chart,ht=et.getContrast(zr($e)&&$e||zr(tt)&&tt||"#000000"),yt=Q(we),{animation:ci,defer:ii}=yt[0],ri=ii?Bo(Le,ci,we):{defer:0,duration:0};Nn(this,"drawDataLabels"),(Ri=we.hasDataLabels)!=null&&Ri.call(we)&&(ce=this.initDataLabels(ri),ye.forEach(ki=>{var Ys,ks,Lr;let Li=ki.dataLabels||[],ls=ki.color||we.color;Yn(G(yt,ki.dlOptions||((Ys=ki.options)==null?void 0:Ys.dataLabels))).forEach((Cr,Ur)=>{var na;let nr=Cr.enabled&&(ki.visible||ki.dataLabelOnHidden)&&(!ki.isNull||ki.dataLabelOnNull)&&function(ph,sh){let _u=sh.filter;if(_u){let Ec=_u.operator,aa=ph[_u.property],il=_u.value;return Ec===">"&&aa>il||Ec==="<"&&aa<il||Ec===">="&&aa>=il||Ec==="<="&&aa<=il||Ec==="=="&&aa==il||Ec==="==="&&aa===il||Ec==="!="&&aa!=il||Ec==="!=="&&aa!==il||!1}return!0}(ki,Cr),{backgroundColor:Yr,borderColor:En,distance:Sn,style:Mn={}}=Cr,Bh,$o,Ca,Do={},go=Li[Ur],Al=!go,oa;nr&&($o=xo(Bh=Mo(Cr[ki.formatPrefix+"Format"],Cr.format))?Tn(Bh,ki,Le):(Cr[ki.formatPrefix+"Formatter"]||Cr.formatter).call(ki,Cr),Ca=Cr.rotation,!Le.styledMode&&(Mn.color=Mo(Cr.color,Mn.color,zr(we.color)?we.color:void 0,"#000000"),Mn.color==="contrast"?(Yr!=="none"&&(oa=Yr),ki.contrastColor=et.getContrast(oa!=="auto"&&zr(oa)&&oa||(zr(ls)?ls:"")),Mn.color=oa||!xo(Sn)&&Cr.inside||0>jo(Sn||0)||Ue.stacking?ki.contrastColor:ht):delete ki.contrastColor,Ue.cursor&&(Mn.cursor=Ue.cursor)),Do={r:Cr.borderRadius||0,rotation:Ca,padding:Cr.padding,zIndex:1},Le.styledMode||(Do.fill=Yr==="auto"?ki.color:Yr,Do.stroke=En==="auto"?ki.color:En,Do["stroke-width"]=Cr.borderWidth),Xa(Do,(ph,sh)=>{ph===void 0&&delete Do[sh]})),!go||nr&&xo($o)&&!!(go.div||(na=go.text)!=null&&na.foreignObject)==!!Cr.useHTML&&(go.rotation&&Cr.rotation||go.rotation===Cr.rotation)||(go=void 0,Al=!0),nr&&xo($o)&&$o!==""&&(go?Do.text=$o:(go=et.label($o,0,0,Cr.shape,void 0,void 0,Cr.useHTML,void 0,"data-label")).addClass(" highcharts-data-label-color-"+ki.colorIndex+" "+(Cr.className||"")+(Cr.useHTML?" highcharts-tracker":"")),go&&(go.options=Cr,go.attr(Do),Le.styledMode?Mn.width&&go.css({width:Mn.width,textOverflow:Mn.textOverflow,whiteSpace:Mn.whiteSpace}):go.css(Mn).shadow(Cr.shadow),Nn(go,"beforeAddingDataLabel",{labelOptions:Cr,point:ki}),go.added||go.add(ce),we.alignDataLabel(ki,go,Cr,void 0,Al),go.isActive=!0,Li[Ur]&&Li[Ur]!==go&&Li[Ur].destroy(),Li[Ur]=go))});let vs=Li.length;for(;vs--;)(ks=Li[vs])!=null&&ks.isActive?Li[vs].isActive=!1:((Lr=Li[vs])==null||Lr.destroy(),Li.splice(vs,1));ki.dataLabel=Li[0],ki.dataLabels=Li})),Nn(this,"afterDrawDataLabels")}function V(ye,ce,we,Le,Ue,et){let tt=this.chart,$e=ce.align,ht=ce.verticalAlign,yt=ye.box?0:ye.padding||0,ci=tt.inverted?this.yAxis:this.xAxis,ii=ci?ci.left-tt.plotLeft:0,ri=tt.inverted?this.xAxis:this.yAxis,Ri=ri?ri.top-tt.plotTop:0,{x:ki=0,y:Li=0}=ce,ls,vs;return(ls=(we.x||0)+yt+ii)<0&&($e==="right"&&ki>=0?(ce.align="left",ce.inside=!0):ki-=ls,vs=!0),(ls=(we.x||0)+Le.width-yt+ii)>tt.plotWidth&&($e==="left"&&ki<=0?(ce.align="right",ce.inside=!0):ki+=tt.plotWidth-ls,vs=!0),(ls=we.y+yt+Ri)<0&&(ht==="bottom"&&Li>=0?(ce.verticalAlign="top",ce.inside=!0):Li-=ls,vs=!0),(ls=(we.y||0)+Le.height-yt+Ri)>tt.plotHeight&&(ht==="top"&&Li<=0?(ce.verticalAlign="bottom",ce.inside=!0):Li+=tt.plotHeight-ls,vs=!0),vs&&(ce.x=ki,ce.y=Li,ye.placed=!et,ye.align(ce,void 0,Ue)),vs}function G(ye,ce){let we=[],Le;if(br(ye)&&!br(ce))we=ye.map(function(Ue){return _n(Ue,ce)});else if(br(ce)&&!br(ye))we=ce.map(function(Ue){return _n(ye,Ue)});else if(br(ye)||br(ce)){if(br(ye)&&br(ce))for(Le=Math.max(ye.length,ce.length);Le--;)we[Le]=_n(ye[Le],ce[Le])}else we=_n(ye,ce);return we}function Q(ye){var we,Le;let ce=ye.chart.options.plotOptions;return Yn(G(G((we=ce==null?void 0:ce.series)==null?void 0:we.dataLabels,(Le=ce==null?void 0:ce[ye.type])==null?void 0:Le.dataLabels),ye.options.dataLabels))}function le(ye,ce,we,Le,Ue){let et=this.chart,tt=et.inverted,$e=this.xAxis,ht=$e.reversed,yt=((tt?ce.height:ce.width)||0)/2,ci=ye.pointWidth,ii=ci?ci/2:0;ce.startXPos=tt?Ue.x:ht?-yt-ii:$e.width-yt+ii,ce.startYPos=tt?ht?this.yAxis.height-yt+ii:-yt-ii:Ue.y,Le?ce.visibility==="hidden"&&(ce.show(),ce.attr({opacity:0}).animate({opacity:1})):ce.attr({opacity:1}).animate({opacity:0},void 0,ce.hide),et.hasRendered&&(we&&ce.attr({x:ce.startXPos,y:ce.startYPos}),ce.placed=!0)}he.compose=function(ye){let ce=ye.prototype;ce.initDataLabels||(ce.initDataLabels=z,ce.initDataLabelsGroup=M,ce.alignDataLabel=v,ce.drawDataLabels=F,ce.justifyDataLabel=V,ce.mergeArrays=G,ce.setDataLabelStartPos=le,ce.hasDataLabels=u)}})(_r||(_r={}));let Xr=_r,{composed:$n}=Pi,{series:hn}=eo,{merge:cn,pushUnique:dn}=Qs;(function(he){function u(v,M,z,F,V){var et,tt;let{chart:G,options:Q}=this,le=G.inverted,ye=((et=this.xAxis)==null?void 0:et.len)||G.plotSizeX||0,ce=((tt=this.yAxis)==null?void 0:tt.len)||G.plotSizeY||0,we=v.dlBox||v.shapeArgs,Le=v.below??(v.plotY||0)>(this.translatedThreshold??ce),Ue=z.inside??!!Q.stacking;if(we){if(F=cn(we),z.overflow!=="allow"||z.crop!==!1||Q.clip!==!1){F.y<0&&(F.height+=F.y,F.y=0);let $e=F.y+F.height-ce;$e>0&&$e<F.height-1&&(F.height-=$e)}le&&(F={x:ce-F.y-F.height,y:ye-F.x-F.width,width:F.height,height:F.width}),Ue||(le?(F.x+=Le?0:F.width,F.width=0):(F.y+=Le?F.height:0,F.height=0))}z.align??(z.align=!le||Ue?"center":Le?"right":"left"),z.verticalAlign??(z.verticalAlign=le||Ue?"middle":Le?"top":"bottom"),hn.prototype.alignDataLabel.call(this,v,M,z,F,V),z.inside&&v.contrastColor&&M.css({color:v.contrastColor})}he.compose=function(v){Xr.compose(hn),dn($n,"ColumnDataLabel")&&(v.prototype.alignDataLabel=u)}})(ar||(ar={}));let _o=ar,{extend:qn,merge:uh}=Qs;class sn extends Pr{}sn.defaultOptions=uh(Pr.defaultOptions,{}),qn(sn.prototype,{inverted:!0}),eo.registerSeriesType("bar",sn);let{column:Go,line:hc}=eo.seriesTypes,{addEvent:Rh,extend:Bd,merge:gu}=Qs;class qc extends hc{applyJitter(){let u=this,v=this.options.jitter,M=this.points.length;v&&this.points.forEach(function(z,F){["x","y"].forEach(function(V,G){if(v[V]&&!z.isNull){let Q=`plot${V.toUpperCase()}`,le=u[`${V}Axis`],ye=v[V]*le.transA;if(le&&!le.logarithmic){let ce=Math.max(0,(z[Q]||0)-ye),we=Math.min(le.len,(z[Q]||0)+ye);z[Q]=ce+(we-ce)*function(Le){let Ue=1e4*Math.sin(Le);return Ue-Math.floor(Ue)}(F+G*M),V==="x"&&(z.clientX=z.plotX)}}})})}drawGraph(){this.options.lineWidth?super.drawGraph():this.graph&&(this.graph=this.graph.destroy())}}qc.defaultOptions=gu(hc.defaultOptions,{lineWidth:0,findNearestPointBy:"xy",jitter:{x:0,y:0},marker:{enabled:!0},tooltip:{headerFormat:'<span style="color:{point.color}">●</span> <span style="font-size: 0.8em"> {series.name}</span><br/>',pointFormat:"x: <b>{point.x}</b><br/>y: <b>{point.y}</b><br/>"}}),Bd(qc.prototype,{drawTracker:Go.prototype.drawTracker,sorted:!1,requireSorting:!1,noSharedTooltip:!0,trackerGroups:["group","markerGroup","dataLabelsGroup"]}),Rh(qc,"afterTranslate",function(){this.applyJitter()}),eo.registerSeriesType("scatter",qc);let{deg2rad:kc}=Pi,{fireEvent:hp,isNumber:Fd,pick:yu,relativeLength:Lf}=Qs;(function(he){he.getCenter=function(){let u=this.options,v=this.chart,M=2*(u.slicedOffset||0),z=v.plotWidth-2*M,F=v.plotHeight-2*M,V=u.center,G=Math.min(z,F),Q=u.thickness,le,ye=u.size,ce=u.innerSize||0,we,Le;typeof ye=="string"&&(ye=parseFloat(ye)),typeof ce=="string"&&(ce=parseFloat(ce));let Ue=[yu(V==null?void 0:V[0],"50%"),yu(V==null?void 0:V[1],"50%"),yu(ye&&ye<0?void 0:u.size,"100%"),yu(ce&&ce<0?void 0:u.innerSize||0,"0%")];for(!v.angular||this instanceof Dh||(Ue[3]=0),we=0;we<4;++we)Le=Ue[we],le=we<2||we===2&&/%$/.test(Le),Ue[we]=Lf(Le,[z,F,G,Ue[2]][we])+(le?M:0);return Ue[3]>Ue[2]&&(Ue[3]=Ue[2]),Fd(Q)&&2*Q<Ue[2]&&Q>0&&(Ue[3]=Ue[2]-2*Q),hp(this,"afterGetCenter",{positions:Ue}),Ue},he.getStartAndEndRadians=function(u,v){let M=Fd(u)?u:0,z=Fd(v)&&v>M&&v-M<360?v:M+360;return{start:kc*(M+-90),end:kc*(z+-90)}}})(Nr||(Nr={}));let fg=Nr,{setAnimation:Of}=Ws,{addEvent:Df,defined:pm,extend:mg,isNumber:Pp,pick:gd,relativeLength:fm}=Qs;class xu extends bn{getConnectorPath(u){let v=u.dataLabelPosition,M=u.options||{},z=M.connectorShape,F=this.connectorShapes[z]||z;return v&&F.call(this,{...v.computed,alignment:v.alignment},v.connectorPosition,M)||[]}getTranslate(){return this.sliced&&this.slicedTranslation||{translateX:0,translateY:0}}haloPath(u){let v=this.shapeArgs;return this.sliced||!this.visible?[]:this.series.chart.renderer.symbols.arc(v.x,v.y,v.r+u,v.r+u,{innerR:v.r-1,start:v.start,end:v.end,borderRadius:v.borderRadius})}constructor(u,v,M){super(u,v,M),this.half=0,this.name??(this.name=u.chart.options.lang.pieSliceName);let z=F=>{this.slice(F.type==="select")};Df(this,"select",z),Df(this,"unselect",z)}isValid(){return Pp(this.y)&&this.y>=0}setVisible(u,v=!0){u!==this.visible&&this.update({visible:u??!this.visible},v,void 0,!1)}slice(u,v,M){let z=this.series;Of(M,z.chart),v=gd(v,!0),this.sliced=this.options.sliced=u=pm(u)?u:!this.sliced,z.options.data[z.data.indexOf(this)]=this.options,this.graphic&&this.graphic.animate(this.getTranslate())}}mg(xu.prototype,{connectorShapes:{fixedOffset:function(he,u,v){let M=u.breakAt,z=u.touchingSliceAt,F=v.softConnector?["C",he.x+(he.alignment==="left"?-5:5),he.y,2*M.x-z.x,2*M.y-z.y,M.x,M.y]:["L",M.x,M.y];return[["M",he.x,he.y],F,["L",z.x,z.y]]},straight:function(he,u){let v=u.touchingSliceAt;return[["M",he.x,he.y],["L",v.x,v.y]]},crookedLine:function(he,u,v){let{angle:M=this.angle||0,breakAt:z,touchingSliceAt:F}=u,{series:V}=this,[G,Q,le]=V.center,ye=le/2,{plotLeft:ce,plotWidth:we}=V.chart,Le=he.alignment==="left",{x:Ue,y:et}=he,tt=z.x;if(v.crookDistance){let ht=fm(v.crookDistance,1);tt=Le?G+ye+(we+ce-G-ye)*(1-ht):ce+(G-ye)*ht}else tt=G+(Q-et)*Math.tan(M-Math.PI/2);let $e=[["M",Ue,et]];return(Le?tt<=Ue&&tt>=z.x:tt>=Ue&&tt<=z.x)&&$e.push(["L",tt,et]),$e.push(["L",z.x,z.y],["L",F.x,F.y]),$e}}});let{getStartAndEndRadians:Hu}=fg,{noop:Ig}=Pi,{clamp:Um,extend:ay,fireEvent:ly,merge:hy,pick:yx}=Qs;class Lg extends Dh{animate(u){let v=this,M=v.points,z=v.startAngleRad;u||M.forEach(function(F){let V=F.graphic,G=F.shapeArgs;V&&G&&(V.attr({r:yx(F.startR,v.center&&v.center[3]/2),start:z,end:z}),V.animate({r:G.r,start:G.start,end:G.end},v.options.animation))})}drawEmpty(){let u,v,M=this.startAngleRad,z=this.endAngleRad,F=this.options;this.total===0&&this.center?(u=this.center[0],v=this.center[1],this.graph||(this.graph=this.chart.renderer.arc(u,v,this.center[1]/2,0,M,z).addClass("highcharts-empty-series").add(this.group)),this.graph.attr({d:zo.arc(u,v,this.center[2]/2,0,{start:M,end:z,innerR:this.center[3]/2})}),this.chart.styledMode||this.graph.attr({"stroke-width":F.borderWidth,fill:F.fillColor||"none",stroke:F.color||"#cccccc"})):this.graph&&(this.graph=this.graph.destroy())}drawPoints(){let u=this.chart.renderer;this.points.forEach(function(v){v.graphic&&v.hasNewShapeType()&&(v.graphic=v.graphic.destroy()),v.graphic||(v.graphic=u[v.shapeType](v.shapeArgs).add(v.series.group),v.delayedRendering=!0)})}generatePoints(){super.generatePoints(),this.updateTotals()}getX(u,v,M,z){let F=this.center,V=this.radii?this.radii[M.index]||0:F[2]/2,G=z.dataLabelPosition,Q=(G==null?void 0:G.distance)||0,le=Math.asin(Um((u-F[1])/(V+Q),-1,1));return F[0]+Math.cos(le)*(V+Q)*(v?-1:1)+(Q>0?(v?-1:1)*(z.padding||0):0)}hasData(){return!!this.dataTable.rowCount}redrawPoints(){let u,v,M,z,F=this,V=F.chart;this.drawEmpty(),F.group&&!V.styledMode&&F.group.shadow(F.options.shadow),F.points.forEach(function(G){let Q={};v=G.graphic,!G.isNull&&v?(z=G.shapeArgs,u=G.getTranslate(),V.styledMode||(M=F.pointAttribs(G,G.selected&&"select")),G.delayedRendering?(v.setRadialReference(F.center).attr(z).attr(u),V.styledMode||v.attr(M).attr({"stroke-linejoin":"round"}),G.delayedRendering=!1):(v.setRadialReference(F.center),V.styledMode||hy(!0,Q,M),hy(!0,Q,z,u),v.animate(Q)),v.attr({visibility:G.visible?"inherit":"hidden"}),v.addClass(G.getClassName(),!0)):v&&(G.graphic=v.destroy())})}sortByAngle(u,v){u.sort(function(M,z){return M.angle!==void 0&&(z.angle-M.angle)*v})}translate(u){ly(this,"translate"),this.generatePoints();let v=this.options,M=v.slicedOffset,z=Hu(v.startAngle,v.endAngle),F=this.startAngleRad=z.start,V=(this.endAngleRad=z.end)-F,G=this.points,Q=v.ignoreHiddenPoint,le=G.length,ye,ce,we,Le,Ue,et,tt,$e=0;for(u||(this.center=u=this.getCenter()),et=0;et<le;et++){tt=G[et],ye=F+$e*V,tt.isValid()&&(!Q||tt.visible)&&($e+=tt.percentage/100),ce=F+$e*V;let ht={x:u[0],y:u[1],r:u[2]/2,innerR:u[3]/2,start:Math.round(1e3*ye)/1e3,end:Math.round(1e3*ce)/1e3};tt.shapeType="arc",tt.shapeArgs=ht,(we=(ce+ye)/2)>1.5*Math.PI?we-=2*Math.PI:we<-Math.PI/2&&(we+=2*Math.PI),tt.slicedTranslation={translateX:Math.round(Math.cos(we)*M),translateY:Math.round(Math.sin(we)*M)},Le=Math.cos(we)*u[2]/2,Ue=Math.sin(we)*u[2]/2,tt.tooltipPos=[u[0]+.7*Le,u[1]+.7*Ue],tt.half=+(we<-Math.PI/2||we>Math.PI/2),tt.angle=we}ly(this,"afterTranslate")}updateTotals(){let u=this.points,v=u.length,M=this.options.ignoreHiddenPoint,z,F,V=0;for(z=0;z<v;z++)(F=u[z]).isValid()&&(!M||F.visible)&&(V+=F.y);for(z=0,this.total=V;z<v;z++)(F=u[z]).percentage=V>0&&(F.visible||!M)?F.y/V*100:0,F.total=V}}Lg.defaultOptions=hy(Dh.defaultOptions,{borderRadius:3,center:[null,null],clip:!1,colorByPoint:!0,dataLabels:{connectorPadding:5,connectorShape:"crookedLine",crookDistance:void 0,distance:30,enabled:!0,formatter:function(){return this.isNull?void 0:this.name},softConnector:!0,x:0},fillColor:void 0,ignoreHiddenPoint:!0,inactiveOtherPoints:!0,legendType:"point",marker:null,size:null,showInLegend:!1,slicedOffset:10,stickyTracking:!1,tooltip:{followPointer:!0},borderColor:"#ffffff",borderWidth:1,lineWidth:void 0,states:{hover:{brightness:.1}}}),ay(Lg.prototype,{axisTypes:[],directTouch:!0,drawGraph:void 0,drawTracker:Pr.prototype.drawTracker,getCenter:fg.getCenter,getSymbol:Ig,invertible:!1,isCartesian:!1,noSharedTooltip:!0,pointAttribs:Pr.prototype.pointAttribs,pointClass:xu,requireSorting:!1,searchPoint:Ig,trackerGroups:["group","dataLabelsGroup"]}),eo.registerSeriesType("pie",Lg);let{composed:xx,noop:mm}=Pi,{distribute:Ny}=fa,{series:cc}=eo,{arrayMax:gm,clamp:cy,defined:_x,pick:jm,pushUnique:Vy,relativeLength:Uy}=Qs;(function(he){let u={radialDistributionY:function(V,G){var Q;return(((Q=G.dataLabelPosition)==null?void 0:Q.top)||0)+V.distributeBox.pos},radialDistributionX:function(V,G,Q,le,ye){let ce=ye.dataLabelPosition;return V.getX(Q<((ce==null?void 0:ce.top)||0)+2||Q>((ce==null?void 0:ce.bottom)||0)-2?le:Q,G.half,G,ye)},justify:function(V,G,Q,le){var ye;return le[0]+(V.half?-1:1)*(Q+(((ye=G.dataLabelPosition)==null?void 0:ye.distance)||0))},alignToPlotEdges:function(V,G,Q,le){let ye=V.getBBox().width;return G?ye+le:Q-ye-le},alignToConnectors:function(V,G,Q,le){let ye=0,ce;return V.forEach(function(we){(ce=we.dataLabel.getBBox().width)>ye&&(ye=ce)}),G?ye+le:Q-ye-le}};function v(V,G){let Q=Math.PI/2,{start:le=0,end:ye=0}=V.shapeArgs||{},ce=V.angle||0;G>0&&le<Q&&ye>Q&&ce>Q/2&&ce<1.5*Q&&(ce=ce<=Q?Math.max(Q/2,(le+Q)/2):Math.min(1.5*Q,(Q+ye)/2));let{center:we,options:Le}=this,Ue=we[2]/2,et=Math.cos(ce),tt=Math.sin(ce),$e=we[0]+et*Ue,ht=we[1]+tt*Ue,yt=Math.min((Le.slicedOffset||0)+(Le.borderWidth||0),G/5);return{natural:{x:$e+et*G,y:ht+tt*G},computed:{},alignment:G<0?"center":V.half?"right":"left",connectorPosition:{angle:ce,breakAt:{x:$e+et*yt,y:ht+tt*yt},touchingSliceAt:{x:$e,y:ht}},distance:G}}function M(){var Ri;let V=this,G=V.points,Q=V.chart,le=Q.plotWidth,ye=Q.plotHeight,ce=Q.plotLeft,we=Math.round(Q.chartWidth/3),Le=V.center,Ue=Le[2]/2,et=Le[1],tt=[[],[]],$e=[0,0,0,0],ht=V.dataLabelPositioners,yt,ci,ii,ri=0;V.visible&&((Ri=V.hasDataLabels)!=null&&Ri.call(V))&&(G.forEach(ki=>{(ki.dataLabels||[]).forEach(Li=>{Li.shortened&&(Li.attr({width:"auto"}).css({width:"auto",textOverflow:"clip"}),Li.shortened=!1)})}),cc.prototype.drawDataLabels.apply(V),G.forEach(ki=>{(ki.dataLabels||[]).forEach((Li,ls)=>{var Lr;let vs=Le[2]/2,Ys=Li.options,ks=Uy((Ys==null?void 0:Ys.distance)||0,vs);ls===0&&tt[ki.half].push(ki),!_x((Lr=Ys==null?void 0:Ys.style)==null?void 0:Lr.width)&&Li.getBBox().width>we&&(Li.css({width:Math.round(.7*we)+"px"}),Li.shortened=!0),Li.dataLabelPosition=this.getDataLabelPosition(ki,ks),ri=Math.max(ri,ks)})}),tt.forEach((ki,Li)=>{let ls=ki.length,vs=[],Ys,ks,Lr=0,Cr;ls&&(V.sortByAngle(ki,Li-.5),ri>0&&(Ys=Math.max(0,et-Ue-ri),ks=Math.min(et+Ue+ri,Q.plotHeight),ki.forEach(Ur=>{(Ur.dataLabels||[]).forEach(nr=>{var En;let Yr=nr.dataLabelPosition;Yr&&Yr.distance>0&&(Yr.top=Math.max(0,et-Ue-Yr.distance),Yr.bottom=Math.min(et+Ue+Yr.distance,Q.plotHeight),Lr=nr.getBBox().height||21,nr.lineHeight=Q.renderer.fontMetrics(nr.text||nr).h+2*nr.padding,Ur.distributeBox={target:(((En=nr.dataLabelPosition)==null?void 0:En.natural.y)||0)-Yr.top+nr.lineHeight/2,size:Lr,rank:Ur.y},vs.push(Ur.distributeBox))})}),Ny(vs,Cr=ks+Lr-Ys,Cr/5)),ki.forEach(Ur=>{(Ur.dataLabels||[]).forEach(nr=>{let Yr=nr.options||{},En=Ur.distributeBox,Sn=nr.dataLabelPosition,Mn=(Sn==null?void 0:Sn.natural.y)||0,Bh=Yr.connectorPadding||0,$o=nr.lineHeight||21,Ca=($o-nr.getBBox().height)/2,Do=0,go=Mn,Al="inherit";if(Sn){if(vs&&_x(En)&&Sn.distance>0&&(En.pos===void 0?Al="hidden":(ii=En.size,go=ht.radialDistributionY(Ur,nr))),Yr.justify)Do=ht.justify(Ur,nr,Ue,Le);else switch(Yr.alignTo){case"connectors":Do=ht.alignToConnectors(ki,Li,le,ce);break;case"plotEdges":Do=ht.alignToPlotEdges(nr,Li,le,ce);break;default:Do=ht.radialDistributionX(V,Ur,go-Ca,Mn,nr)}if(Sn.attribs={visibility:Al,align:Sn.alignment},Sn.posAttribs={x:Do+(Yr.x||0)+({left:Bh,right:-Bh}[Sn.alignment]||0),y:go+(Yr.y||0)-$o/2},Sn.computed.x=Do,Sn.computed.y=go-Ca,jm(Yr.crop,!0)){let oa;Do-(ci=nr.getBBox().width)<Bh&&Li===1?(oa=Math.round(ci-Do+Bh),$e[3]=Math.max(oa,$e[3])):Do+ci>le-Bh&&Li===0&&(oa=Math.round(Do+ci-le+Bh),$e[1]=Math.max(oa,$e[1])),go-ii/2<0?$e[0]=Math.max(Math.round(-go+ii/2),$e[0]):go+ii/2>ye&&($e[2]=Math.max(Math.round(go+ii/2-ye),$e[2])),Sn.sideOverflow=oa}}})}))}),(gm($e)===0||this.verifyDataLabelOverflow($e))&&(this.placeDataLabels(),this.points.forEach(ki=>{(ki.dataLabels||[]).forEach(Li=>{var ks;let{connectorColor:ls,connectorWidth:vs=1}=Li.options||{},Ys=Li.dataLabelPosition;if(vs){let Lr;yt=Li.connector,Ys&&Ys.distance>0?(Lr=!yt,yt||(Li.connector=yt=Q.renderer.path().addClass("highcharts-data-label-connector  highcharts-color-"+ki.colorIndex+(ki.className?" "+ki.className:"")).add(V.dataLabelsGroup)),Q.styledMode||yt.attr({"stroke-width":vs,stroke:ls||ki.color||"#666666"}),yt[Lr?"attr":"animate"]({d:ki.getConnectorPath(Li)}),yt.attr({visibility:(ks=Ys.attribs)==null?void 0:ks.visibility})):yt&&(Li.connector=yt.destroy())}})})))}function z(){this.points.forEach(V=>{(V.dataLabels||[]).forEach(G=>{var le,ye;let Q=G.dataLabelPosition;Q?(Q.sideOverflow&&(G.css({width:Math.max(G.getBBox().width-Q.sideOverflow,0)+"px",textOverflow:((ye=(le=G.options)==null?void 0:le.style)==null?void 0:ye.textOverflow)||"ellipsis"}),G.shortened=!0),G.attr(Q.attribs),G[G.moved?"animate":"attr"](Q.posAttribs),G.moved=!0):G&&G.attr({y:-9999})}),delete V.distributeBox},this)}function F(V){let G=this.center,Q=this.options,le=Q.center,ye=Q.minSize||80,ce=ye,we=Q.size!==null;return!we&&(le[0]!==null?ce=Math.max(G[2]-Math.max(V[1],V[3]),ye):(ce=Math.max(G[2]-V[1]-V[3],ye),G[0]+=(V[3]-V[1])/2),le[1]!==null?ce=cy(ce,ye,G[2]-Math.max(V[0],V[2])):(ce=cy(ce,ye,G[2]-V[0]-V[2]),G[1]+=(V[0]-V[2])/2),ce<G[2]?(G[2]=ce,G[3]=Math.min(Q.thickness?Math.max(0,ce-2*Q.thickness):Math.max(0,Uy(Q.innerSize||0,ce)),ce),this.translate(G),this.drawDataLabels&&this.drawDataLabels()):we=!0),we}he.compose=function(V){if(Xr.compose(cc),Vy(xx,"PieDataLabel")){let G=V.prototype;G.dataLabelPositioners=u,G.alignDataLabel=mm,G.drawDataLabels=M,G.getDataLabelPosition=v,G.placeDataLabels=z,G.verifyDataLabelOverflow=F}}})(Or||(Or={}));let gg=Or;(function(he){he.getCenterOfPoints=function(u){let v=u.reduce((M,z)=>(M.x+=z.x,M.y+=z.y,M),{x:0,y:0});return{x:v.x/u.length,y:v.y/u.length}},he.getDistanceBetweenPoints=function(u,v){return Math.sqrt(Math.pow(v.x-u.x,2)+Math.pow(v.y-u.y,2))},he.getAngleBetweenPoints=function(u,v){return Math.atan2(v.x-u.x,v.y-u.y)},he.pointInPolygon=function({x:u,y:v},M){let z=M.length,F,V,G=!1;for(F=0,V=z-1;F<z;V=F++){let[Q,le]=M[F],[ye,ce]=M[V];le>v!=ce>v&&u<(ye-Q)*(v-le)/(ce-le)+Q&&(G=!G)}return G}})(ir||(ir={}));let{pointInPolygon:vx}=ir,{addEvent:bx,getAlignFactor:wx,fireEvent:yg,objectEach:Ip,pick:rf}=Qs;function dy(he){let u=he.length,v=(ye,ce)=>!(ce.x>=ye.x+ye.width||ce.x+ce.width<=ye.x||ce.y>=ye.y+ye.height||ce.y+ce.height<=ye.y),M=(ye,ce)=>{for(let we of ye)if(vx({x:we[0],y:we[1]},ce))return!0;return!1},z,F,V,G,Q,le=!1;for(let ye=0;ye<u;ye++)(z=he[ye])&&(z.oldOpacity=z.opacity,z.newOpacity=1,z.absoluteBox=function(ce){var we,Le;if(ce&&(!ce.alignAttr||ce.placed)){let Ue=ce.box?0:ce.padding||0,et=ce.alignAttr||{x:ce.attr("x"),y:ce.attr("y")},{height:tt,polygon:$e,width:ht}=ce.getBBox(),yt=wx(ce.alignValue)*ht;return ce.width=ht,ce.height=tt,{x:et.x+(((we=ce.parentGroup)==null?void 0:we.translateX)||0)+Ue-yt,y:et.y+(((Le=ce.parentGroup)==null?void 0:Le.translateY)||0)+Ue,width:ht-2*Ue,height:tt-2*Ue,polygon:$e}}}(z));he.sort((ye,ce)=>(ce.labelrank||0)-(ye.labelrank||0));for(let ye=0;ye<u;++ye){G=(F=he[ye])&&F.absoluteBox;let ce=G==null?void 0:G.polygon;for(let we=ye+1;we<u;++we){Q=(V=he[we])&&V.absoluteBox;let Le=!1;if(G&&Q&&F!==V&&F.newOpacity!==0&&V.newOpacity!==0&&F.visibility!=="hidden"&&V.visibility!=="hidden"){let Ue=Q.polygon;if(ce&&Ue&&ce!==Ue?M(ce,Ue)&&(Le=!0):v(G,Q)&&(Le=!0),Le){let et=F.labelrank<V.labelrank?F:V,tt=et.text;et.newOpacity=0,tt!=null&&tt.element.querySelector("textPath")&&tt.hide()}}}}for(let ye of he)jy(ye,this)&&(le=!0);le&&yg(this,"afterHideAllOverlappingLabels")}function jy(he,u){let v,M=!1;return he&&(v=he.newOpacity,he.oldOpacity!==v&&(he.hasClass("highcharts-data-label")?(he[v?"removeClass":"addClass"]("highcharts-data-label-hidden"),M=!0,he[he.isOld?"animate":"attr"]({opacity:v},void 0,function(){u.styledMode||he.css({pointerEvents:v?"auto":"none"})}),yg(u,"afterHideOverlappingLabel")):he.attr({opacity:v})),he.isOld=!0),M}function Og(){var v;let he=this,u=[];for(let M of he.labelCollectors||[])u=u.concat(M());for(let M of he.yAxis||[])M.stacking&&M.options.stackLabels&&!M.options.stackLabels.allowOverlap&&Ip(M.stacking.stacks,z=>{Ip(z,F=>{F.label&&u.push(F.label)})});for(let M of he.series||[])if(M.visible&&((v=M.hasDataLabels)!=null&&v.call(M))){let z=F=>{for(let V of F)V.visible&&(V.dataLabels||[]).forEach(G=>{var le;let Q=G.options||{};G.labelrank=rf(Q.labelrank,V.labelrank,(le=V.shapeArgs)==null?void 0:le.height),Q.allowOverlap??Number(Q.distance)>0?(G.oldOpacity=G.opacity,G.newOpacity=1,jy(G,he)):u.push(G)})};z(M.nodes||[]),z(M.points)}this.hideOverlappingLabels(u)}let Dg={compose:function(he){let u=he.prototype;u.hideOverlappingLabels||(u.hideOverlappingLabels=dy,bx(he,"render",Og))}},{defaultOptions:zg}=Za,{noop:Rg}=Pi,{addEvent:uy,extend:Bg,isObject:Fg,merge:py,relativeLength:Ng}=Qs,Tx={radius:0,scope:"stack",where:void 0},Lp=Rg,Gy=Rg;function Vg(he,u,v,M,z={}){let F=Lp(he,u,v,M,z),{innerR:V=0,r:G=v,start:Q=0,end:le=0}=z;if(z.open||!z.borderRadius)return F;let ye=le-Q,ce=Math.sin(ye/2),we=Math.max(Math.min(Ng(z.borderRadius||0,G-V),(G-V)/2,G*ce/(1+ce)),0),Le=Math.min(we,ye/Math.PI*2*V),Ue=F.length-1;for(;Ue--;)(function(et,tt,$e){let ht,yt,ci,ii=et[tt],ri=et[tt+1];if(ri[0]==="Z"&&(ri=et[0]),(ii[0]==="M"||ii[0]==="L")&&ri[0]==="A"?(ht=ii,yt=ri,ci=!0):ii[0]==="A"&&(ri[0]==="M"||ri[0]==="L")&&(ht=ri,yt=ii),ht&&yt&&yt.params){let Ri=yt[1],ki=yt[5],Li=yt.params,{start:ls,end:vs,cx:Ys,cy:ks}=Li,Lr=ki?Ri-$e:Ri+$e,Cr=Lr?Math.asin($e/Lr):0,Ur=ki?Cr:-Cr,nr=Math.cos(Cr)*Lr;ci?(Li.start=ls+Ur,ht[1]=Ys+nr*Math.cos(ls),ht[2]=ks+nr*Math.sin(ls),et.splice(tt+1,0,["A",$e,$e,0,0,1,Ys+Ri*Math.cos(Li.start),ks+Ri*Math.sin(Li.start)])):(Li.end=vs-Ur,yt[6]=Ys+Ri*Math.cos(Li.end),yt[7]=ks+Ri*Math.sin(Li.end),et.splice(tt+1,0,["A",$e,$e,0,0,1,Ys+nr*Math.cos(vs),ks+nr*Math.sin(vs)])),yt[4]=Math.abs(Li.end-Li.start)<Math.PI?0:1}})(F,Ue,Ue>1?Le:we);return F}function Wy(){var he,u;if(this.options.borderRadius&&!(this.chart.is3d&&this.chart.is3d())){let{options:v,yAxis:M}=this,z=v.stacking==="percent",F=(u=(he=zg.plotOptions)==null?void 0:he[this.type])==null?void 0:u.borderRadius,V=fy(v.borderRadius,Fg(F)?F:{}),G=M.options.reversed;for(let Q of this.points){let{shapeArgs:le}=Q;if(Q.shapeType==="roundedRect"&&le){let{width:ye=0,height:ce=0,y:we=0}=le,Le=we,Ue=ce;if(V.scope==="stack"&&Q.stackTotal){let ht=M.translate(z?100:Q.stackTotal,!1,!0,!1,!0),yt=M.translate(v.threshold||0,!1,!0,!1,!0),ci=this.crispCol(0,Math.min(ht,yt),0,Math.abs(ht-yt));Le=ci.y,Ue=ci.height}let et=(Q.negative?-1:1)*(G?-1:1)==-1,tt=V.where;!tt&&this.is("waterfall")&&Math.abs((Q.yBottom||0)-(this.translatedThreshold||0))>this.borderWidth&&(tt="all"),tt||(tt="end");let $e=Math.min(Ng(V.radius,ye),ye/2,tt==="all"?ce/2:1/0)||0;tt==="end"&&(et&&(Le-=$e),Ue+=$e),Bg(le,{brBoxHeight:Ue,brBoxY:Le,r:$e})}}}}function fy(he,u){return Fg(he)||(he={radius:he||0}),py(Tx,u,he)}function Hy(){let he=fy(this.options.borderRadius);for(let u of this.points){let v=u.shapeArgs;v&&(v.borderRadius=Ng(he.radius,(v.r||0)-(v.innerR||0)))}}function n_(he,u,v,M,z={}){let F=Gy(he,u,v,M,z),{r:V=0,brBoxHeight:G=M,brBoxY:Q=u}=z,le=u-Q,ye=Q+G-(u+M),ce=le-V>-.1?0:V,we=ye-V>-.1?0:V,Le=Math.max(ce&&le,0),Ue=Math.max(we&&ye,0),et=[he+ce,u],tt=[he+v-ce,u],$e=[he+v,u+ce],ht=[he+v,u+M-we],yt=[he+v-we,u+M],ci=[he+we,u+M],ii=[he,u+M-we],ri=[he,u+ce],Ri=(ki,Li)=>Math.sqrt(Math.pow(ki,2)-Math.pow(Li,2));if(Le){let ki=Ri(ce,ce-Le);et[0]-=ki,tt[0]+=ki,$e[1]=ri[1]=u+ce-Le}if(M<ce-Le){let ki=Ri(ce,ce-Le-M);$e[0]=ht[0]=he+v-ce+ki,yt[0]=Math.min($e[0],yt[0]),ci[0]=Math.max(ht[0],ci[0]),ii[0]=ri[0]=he+ce-ki,$e[1]=ri[1]=u+M}if(Ue){let ki=Ri(we,we-Ue);yt[0]+=ki,ci[0]-=ki,ht[1]=ii[1]=u+M-we+Ue}if(M<we-Ue){let ki=Ri(we,we-Ue-M);$e[0]=ht[0]=he+v-we+ki,tt[0]=Math.min($e[0],tt[0]),et[0]=Math.max(ht[0],et[0]),ii[0]=ri[0]=he+we-ki,ht[1]=ii[1]=u}return F.length=0,F.push(["M",...et],["L",...tt],["A",ce,ce,0,0,1,...$e],["L",...ht],["A",we,we,0,0,1,...yt],["L",...ci],["A",we,we,0,0,1,...ii],["L",...ri],["A",ce,ce,0,0,1,...et],["Z"]),F}let{diffObjects:Ug,extend:Sx,find:my,merge:Xy,pick:jg,uniqueKey:Mx}=Qs;(function(he){function u(M,z){let F=M.condition;(F.callback||function(){return this.chartWidth<=jg(F.maxWidth,Number.MAX_VALUE)&&this.chartHeight<=jg(F.maxHeight,Number.MAX_VALUE)&&this.chartWidth>=jg(F.minWidth,0)&&this.chartHeight>=jg(F.minHeight,0)}).call(this)&&z.push(M._id)}function v(M,z){let F=this.options.responsive,V=this.currentResponsive,G=[],Q;!z&&F&&F.rules&&F.rules.forEach(ce=>{ce._id===void 0&&(ce._id=Mx()),this.matchResponsiveRule(ce,G)},this);let le=Xy(...G.map(ce=>my((F==null?void 0:F.rules)||[],we=>we._id===ce)).map(ce=>ce==null?void 0:ce.chartOptions));le.isResponsiveOptions=!0,G=G.toString()||void 0;let ye=V==null?void 0:V.ruleIds;G!==ye&&(V&&(this.currentResponsive=void 0,this.updatingResponsive=!0,this.update(V.undoOptions,M,!0),this.updatingResponsive=!1),G?((Q=Ug(le,this.options,!0,this.collectionsWithUpdate)).isResponsiveOptions=!0,this.currentResponsive={ruleIds:G,mergedOptions:le,undoOptions:Q},this.updatingResponsive||this.update(le,M,!0)):this.currentResponsive=void 0)}he.compose=function(M){let z=M.prototype;return z.matchResponsiveRule||Sx(z,{matchResponsiveRule:u,setResponsive:v}),M}})(fr||(fr={}));let gy=fr;Pi.AST=an,Pi.Axis=vo,Pi.Chart=Ha,Pi.Color=lr,Pi.DataLabel=Xr,Pi.DataTableCore=Xi,Pi.Fx=Et,Pi.HTMLElement=sc,Pi.Legend=zd,Pi.LegendSymbol=bs,Pi.OverlappingDataLabels=Pi.OverlappingDataLabels||Dg,Pi.PlotLineOrBand=Bl,Pi.Point=bn,Pi.Pointer=Vt,Pi.RendererRegistry=yn,Pi.Series=Dh,Pi.SeriesRegistry=eo,Pi.StackItem=Cp,Pi.SVGElement=hl,Pi.SVGRenderer=Qd,Pi.Templating=Ma,Pi.Tick=Rl,Pi.Time=Wl,Pi.Tooltip=Oh,Pi.animate=Ws.animate,Pi.animObject=Ws.animObject,Pi.chart=Ha.chart,Pi.color=lr.parse,Pi.dateFormat=Ma.dateFormat,Pi.defaultOptions=Za.defaultOptions,Pi.distribute=fa.distribute,Pi.format=Ma.format,Pi.getDeferredAnimation=Ws.getDeferredAnimation,Pi.getOptions=Za.getOptions,Pi.numberFormat=Ma.numberFormat,Pi.seriesType=eo.seriesType,Pi.setAnimation=Ws.setAnimation,Pi.setOptions=Za.setOptions,Pi.stop=Ws.stop,Pi.time=Za.defaultTime,Pi.timers=Et.timers,{compose:function(he,u,v){let M=he.types.pie;if(!u.symbolCustomAttribs.includes("borderRadius")){let z=v.prototype.symbols;uy(he,"afterColumnTranslate",Wy,{order:9}),uy(M,"afterTranslate",Hy),u.symbolCustomAttribs.push("borderRadius","brBoxHeight","brBoxY"),Lp=z.arc,Gy=z.roundedRect,z.arc=Vg,z.roundedRect=n_}},optionsToObject:fy}.compose(Pi.Series,Pi.SVGElement,Pi.SVGRenderer),_o.compose(Pi.Series.types.column),Xr.compose(Pi.Series),_p.compose(Pi.Axis),sc.compose(Pi.SVGRenderer),zd.compose(Pi.Chart),Em.compose(Pi.Axis),Dg.compose(Pi.Chart),gg.compose(Pi.Series.types.pie),Bl.compose(Pi.Chart,Pi.Axis),Vt.compose(Pi.Chart),gy.compose(Pi.Chart),fu.compose(Pi.Axis,Pi.Chart,Pi.Series),me.compose(Pi.Axis,Pi.Chart,Pi.Series),Oh.compose(Pi.Pointer),Qs.extend(Pi,Qs);let Ax=Pi;return rn.default})())}(kv)),kv.exports}var pT=UA();const jA=Jb(pT),K0=OS({__proto__:null,default:jA},[pT]);var J0={exports:{}};J0.exports;var Iw;function GA(){return Iw||(Iw=1,function(ze,Je){var ot=200,Ht="__lodash_hash_undefined__",Qt=9007199254740991,ni="[object Arguments]",Vi="[object Array]",a="[object Boolean]",Ni="[object Date]",Ui="[object Error]",is="[object Function]",Xs="[object GeneratorFunction]",Qi="[object Map]",xs="[object Number]",zs="[object Object]",hs="[object Promise]",_r="[object RegExp]",ar="[object Set]",Nr="[object String]",Or="[object Symbol]",ir="[object WeakMap]",fr="[object ArrayBuffer]",wo="[object DataView]",rn="[object Float32Array]",Pi="[object Float64Array]",fo="[object Int8Array]",pl="[object Int16Array]",Cs="[object Int32Array]",Da="[object Uint8Array]",No="[object Uint8ClampedArray]",pi="[object Uint16Array]",on="[object Uint32Array]",Io=/[\\^$.*+?()[\]{}|]/g,Qn=/\w*$/,fi=/^\[object .+?Constructor\]$/,xl=/^(?:0|[1-9]\d*)$/,gr={};gr[ni]=gr[Vi]=gr[fr]=gr[wo]=gr[a]=gr[Ni]=gr[rn]=gr[Pi]=gr[fo]=gr[pl]=gr[Cs]=gr[Qi]=gr[xs]=gr[zs]=gr[_r]=gr[ar]=gr[Nr]=gr[Or]=gr[Da]=gr[No]=gr[pi]=gr[on]=!0,gr[Ui]=gr[is]=gr[ir]=!1;var Kn=typeof wv=="object"&&wv&&wv.Object===Object&&wv,za=typeof self=="object"&&self&&self.Object===Object&&self,Na=Kn||za||Function("return this")(),Pl=Je&&!Je.nodeType&&Je,Lo=Pl&&!0&&ze&&!ze.nodeType&&ze,Zo=Lo&&Lo.exports===Pl;function pa(It,Fi){return It.set(Fi[0],Fi[1]),It}function Ul(It,Fi){return It.add(Fi),It}function mo(It,Fi){for(var fs=-1,Ir=It?It.length:0;++fs<Ir&&Fi(It[fs],fs,It)!==!1;);return It}function ql(It,Fi){for(var fs=-1,Ir=Fi.length,Ga=It.length;++fs<Ir;)It[Ga+fs]=Fi[fs];return It}function Sh(It,Fi,fs,Ir){for(var Ga=-1,xn=It?It.length:0;++Ga<xn;)fs=Fi(fs,It[Ga],Ga,It);return fs}function Wh(It,Fi){for(var fs=-1,Ir=Array(It);++fs<It;)Ir[fs]=Fi(fs);return Ir}function Qs(It,Fi){return It==null?void 0:It[Fi]}function Ic(It){var Fi=!1;if(It!=null&&typeof It.toString!="function")try{Fi=!!(It+"")}catch{}return Fi}function _l(It){var Fi=-1,fs=Array(It.size);return It.forEach(function(Ir,Ga){fs[++Fi]=[Ga,Ir]}),fs}function qa(It,Fi){return function(fs){return It(Fi(fs))}}function Lc(It){var Fi=-1,fs=Array(It.size);return It.forEach(function(Ir){fs[++Fi]=Ir}),fs}var wd=Array.prototype,Ps=Function.prototype,nl=Object.prototype,jl=Na["__core-js_shared__"],Kc=function(){var It=/[^.]+$/.exec(jl&&jl.keys&&jl.keys.IE_PROTO||"");return It?"Symbol(src)_1."+It:""}(),Gs=Ps.toString,zn=nl.hasOwnProperty,Gl=nl.toString,fc=RegExp("^"+Gs.call(zn).replace(Io,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),al=Zo?Na.Buffer:void 0,Gd=Na.Symbol,Oc=Na.Uint8Array,mh=qa(Object.getPrototypeOf,Object),ll=Object.create,Mh=nl.propertyIsEnumerable,Sa=wd.splice,Wl=Object.getOwnPropertySymbols,Tu=al?al.isBuffer:void 0,Jc=qa(Object.keys,Object),Td=yn(Na,"DataView"),To=yn(Na,"Map"),Rn=yn(Na,"Promise"),Za=yn(Na,"Set"),Hl=yn(Na,"WeakMap"),mc=yn(Object,"create"),Va=Bn(Td),Zl=Bn(To),Wi=Bn(Rn),Ra=Bn(Za),pp=Bn(Hl),vl=Gd?Gd.prototype:void 0,lr=vl?vl.valueOf:void 0;function ei(It){var Fi=-1,fs=It?It.length:0;for(this.clear();++Fi<fs;){var Ir=It[Fi];this.set(Ir[0],Ir[1])}}function Oe(){this.__data__=mc?mc(null):{}}function We(It){return this.has(It)&&delete this.__data__[It]}function ct(It){var Fi=this.__data__;if(mc){var fs=Fi[It];return fs===Ht?void 0:fs}return zn.call(Fi,It)?Fi[It]:void 0}function Et(It){var Fi=this.__data__;return mc?Fi[It]!==void 0:zn.call(Fi,It)}function at(It,Fi){var fs=this.__data__;return fs[It]=mc&&Fi===void 0?Ht:Fi,this}ei.prototype.clear=Oe,ei.prototype.delete=We,ei.prototype.get=ct,ei.prototype.has=Et,ei.prototype.set=at;function zt(It){var Fi=-1,fs=It?It.length:0;for(this.clear();++Fi<fs;){var Ir=It[Fi];this.set(Ir[0],Ir[1])}}function oi(){this.__data__=[]}function jt(It){var Fi=this.__data__,fs=fn(Fi,It);if(fs<0)return!1;var Ir=Fi.length-1;return fs==Ir?Fi.pop():Sa.call(Fi,fs,1),!0}function qt(It){var Fi=this.__data__,fs=fn(Fi,It);return fs<0?void 0:Fi[fs][1]}function gi(It){return fn(this.__data__,It)>-1}function li(It,Fi){var fs=this.__data__,Ir=fn(fs,It);return Ir<0?fs.push([It,Fi]):fs[Ir][1]=Fi,this}zt.prototype.clear=oi,zt.prototype.delete=jt,zt.prototype.get=qt,zt.prototype.has=gi,zt.prototype.set=li;function Zi(It){var Fi=-1,fs=It?It.length:0;for(this.clear();++Fi<fs;){var Ir=It[Fi];this.set(Ir[0],Ir[1])}}function Ss(){this.__data__={hash:new ei,map:new(To||zt),string:new ei}}function ds(It){return Ma(this,It).delete(It)}function Ws(It){return Ma(this,It).get(It)}function mr(It){return Ma(this,It).has(It)}function vr(It,Fi){return Ma(this,It).set(It,Fi),this}Zi.prototype.clear=Ss,Zi.prototype.delete=ds,Zi.prototype.get=Ws,Zi.prototype.has=mr,Zi.prototype.set=vr;function Rr(It){this.__data__=new zt(It)}function Ar(){this.__data__=new zt}function Ko(It){return this.__data__.delete(It)}function to(It){return this.__data__.get(It)}function nn(It){return this.__data__.has(It)}function ao(It,Fi){var fs=this.__data__;if(fs instanceof zt){var Ir=fs.__data__;if(!To||Ir.length<ot-1)return Ir.push([It,Fi]),this;fs=this.__data__=new Zi(Ir)}return fs.set(It,Fi),this}Rr.prototype.clear=Ar,Rr.prototype.delete=Ko,Rr.prototype.get=to,Rr.prototype.has=nn,Rr.prototype.set=ao;function lo(It,Fi){var fs=Dc(It)||mp(It)?Wh(It.length,String):[],Ir=fs.length,Ga=!!Ir;for(var xn in It)zn.call(It,xn)&&!(Ga&&(xn=="length"||Xd(xn,Ir)))&&fs.push(xn);return fs}function Oo(It,Fi,fs){var Ir=It[Fi];(!(zn.call(It,Fi)&&Xl(Ir,fs))||fs===void 0&&!(Fi in It))&&(It[Fi]=fs)}function fn(It,Fi){for(var fs=It.length;fs--;)if(Xl(It[fs][0],Fi))return fs;return-1}function un(It,Fi){return It&&gh(Fi,wl(Fi),It)}function Ka(It,Fi,fs,Ir,Ga,xn,Ol){var Ln;if(Ir&&(Ln=xn?Ir(It,Ga,xn,Ol):Ir(It)),Ln!==void 0)return Ln;if(!ma(It))return It;var td=Dc(It);if(td){if(Ln=qh(It),!Fi)return $h(It,Ln)}else{var id=bl(It),Au=id==is||id==Xs;if(Su(It))return fp(It,Fi);if(id==zs||id==ni||Au&&!xn){if(Ic(It))return xn?It:{};if(Ln=Zh(Au?{}:It),!Fi)return Kl(It,un(Ln,It))}else{if(!gr[id])return xn?It:{};Ln=fa(It,id,Ka,Fi)}}Ol||(Ol=new Rr);var zc=Ol.get(It);if(zc)return zc;if(Ol.set(It,Ln),!td)var fl=fs?Qc(It):wl(It);return mo(fl||It,function(Hn,hl){fl&&(hl=Hn,Hn=It[hl]),Oo(Ln,hl,Ka(Hn,Fi,fs,Ir,hl,It,Ol))}),Ln}function an(It){return ma(It)?ll(It):{}}function Il(It,Fi,fs){var Ir=Fi(It);return Dc(It)?Ir:ql(Ir,fs(It))}function Hh(It){return Gl.call(It)}function Ua(It){if(!ma(It)||Ll(It))return!1;var Fi=Ch(It)||Ic(It)?fc:fi;return Fi.test(Bn(It))}function Xh(It){if(!ja(It))return Jc(It);var Fi=[];for(var fs in Object(It))zn.call(It,fs)&&fs!="constructor"&&Fi.push(fs);return Fi}function fp(It,Fi){if(Fi)return It.slice();var fs=new It.constructor(It.length);return It.copy(fs),fs}function Gn(It){var Fi=new It.constructor(It.byteLength);return new Oc(Fi).set(new Oc(It)),Fi}function Yh(It,Fi){var fs=Fi?Gn(It.buffer):It.buffer;return new It.constructor(fs,It.byteOffset,It.byteLength)}function Sd(It,Fi,fs){var Ir=Fi?fs(_l(It),!0):_l(It);return Sh(Ir,pa,new It.constructor)}function Wd(It){var Fi=new It.constructor(It.source,Qn.exec(It));return Fi.lastIndex=It.lastIndex,Fi}function Wn(It,Fi,fs){var Ir=Fi?fs(Lc(It),!0):Lc(It);return Sh(Ir,Ul,new It.constructor)}function $u(It){return lr?Object(lr.call(It)):{}}function Ah(It,Fi){var fs=Fi?Gn(It.buffer):It.buffer;return new It.constructor(fs,It.byteOffset,It.length)}function $h(It,Fi){var fs=-1,Ir=It.length;for(Fi||(Fi=Array(Ir));++fs<Ir;)Fi[fs]=It[fs];return Fi}function gh(It,Fi,fs,Ir){fs||(fs={});for(var Ga=-1,xn=Fi.length;++Ga<xn;){var Ol=Fi[Ga],Ln=void 0;Oo(fs,Ol,Ln===void 0?It[Ol]:Ln)}return fs}function Kl(It,Fi){return gh(It,Hd(It),Fi)}function Qc(It){return Il(It,wl,Hd)}function Ma(It,Fi){var fs=It.__data__;return qu(Fi)?fs[typeof Fi=="string"?"string":"hash"]:fs.map}function yn(It,Fi){var fs=Qs(It,Fi);return Ua(fs)?fs:void 0}var Hd=Wl?qa(Wl,Object):ed,bl=Hh;(Td&&bl(new Td(new ArrayBuffer(1)))!=wo||To&&bl(new To)!=Qi||Rn&&bl(Rn.resolve())!=hs||Za&&bl(new Za)!=ar||Hl&&bl(new Hl)!=ir)&&(bl=function(It){var Fi=Gl.call(It),fs=Fi==zs?It.constructor:void 0,Ir=fs?Bn(fs):void 0;if(Ir)switch(Ir){case Va:return wo;case Zl:return Qi;case Wi:return hs;case Ra:return ar;case pp:return ir}return Fi});function qh(It){var Fi=It.length,fs=It.constructor(Fi);return Fi&&typeof It[0]=="string"&&zn.call(It,"index")&&(fs.index=It.index,fs.input=It.input),fs}function Zh(It){return typeof It.constructor=="function"&&!ja(It)?an(mh(It)):{}}function fa(It,Fi,fs,Ir){var Ga=It.constructor;switch(Fi){case fr:return Gn(It);case a:case Ni:return new Ga(+It);case wo:return Yh(It,Ir);case rn:case Pi:case fo:case pl:case Cs:case Da:case No:case pi:case on:return Ah(It,Ir);case Qi:return Sd(It,Ir,fs);case xs:case Nr:return new Ga(It);case _r:return Wd(It);case ar:return Wn(It,Ir,fs);case Or:return $u(It)}}function Xd(It,Fi){return Fi=Fi??Qt,!!Fi&&(typeof It=="number"||xl.test(It))&&It>-1&&It%1==0&&It<Fi}function qu(It){var Fi=typeof It;return Fi=="string"||Fi=="number"||Fi=="symbol"||Fi=="boolean"?It!=="__proto__":It===null}function Ll(It){return!!Kc&&Kc in It}function ja(It){var Fi=It&&It.constructor,fs=typeof Fi=="function"&&Fi.prototype||nl;return It===fs}function Bn(It){if(It!=null){try{return Gs.call(It)}catch{}try{return It+""}catch{}}return""}function kh(It){return Ka(It,!0,!0)}function Xl(It,Fi){return It===Fi||It!==It&&Fi!==Fi}function mp(It){return Eh(It)&&zn.call(It,"callee")&&(!Mh.call(It,"callee")||Gl.call(It)==ni)}var Dc=Array.isArray;function Gr(It){return It!=null&&cf(It.length)&&!Ch(It)}function Eh(It){return Mu(It)&&Gr(It)}var Su=Tu||Yd;function Ch(It){var Fi=ma(It)?Gl.call(It):"";return Fi==is||Fi==Xs}function cf(It){return typeof It=="number"&&It>-1&&It%1==0&&It<=Qt}function ma(It){var Fi=typeof It;return!!It&&(Fi=="object"||Fi=="function")}function Mu(It){return!!It&&typeof It=="object"}function wl(It){return Gr(It)?lo(It):Xh(It)}function ed(){return[]}function Yd(){return!1}ze.exports=kh}(J0,J0.exports)),J0.exports}var WA=GA();const HA=Jb(WA);var XA=ua("<div></div>");function Sv(ze,Je){fx(Je,!1);let ot=eg(Je,"options",8),Ht=eg(Je,"updateArgs",8,!0),Qt=eg(Je,"highcharts",8,K0),ni=eg(Je,"callback",8,()=>{}),Vi=eg(Je,"chart",12,null),a=jh();gx(()=>{if(!Sr(a)){console.error("[highcharts-svelte] Could not find the chart's container.");return}if(!ot()){console.error("[highcharts-svelte] No options provided to the HighchartsSvelte component.");return}Vi(Qt().chart(Sr(a),ot(),ni()))}),iA(()=>{Vi()&&Vi().destroy()}),Jw(()=>(Q0(Vi()),Q0(ot()),Q0(Ht())),()=>{Vi()&&Vi().update&&ot()&&Vi().update(HA(ot()),!0,!0,Ht())}),Qw(),o_();var Ni=XA();Gf(Ni,Ui=>Jn(a,Ui),()=>Sr(a)),da(ze,Ni),mx()}var Ev={exports:{}},YA=Ev.exports,Lw;function $A(){return Lw||(Lw=1,function(ze,Je){(function(ot,Ht){ot._Highcharts=Ht(),ze.exports=ot._Highcharts})(typeof window>"u"?YA:window,()=>(()=>{var vd;let ot,Ht,Qt,ni,Vi,a;var Ni,Ui,is,Xs,Qi,xs,zs,hs,_r,ar,Nr,Or,ir,fr,wo,rn,Pi,fo,pl,Cs,Da,No,pi,on,Io={};Io.d=(H,n)=>{for(var m in n)Io.o(n,m)&&!Io.o(H,m)&&Object.defineProperty(H,m,{enumerable:!0,get:n[m]})},Io.o=(H,n)=>Object.prototype.hasOwnProperty.call(H,n);var Qn={};Io.d(Qn,{default:()=>Fp}),function(H){var n,m,x,S,k,L,R;H.SVG_NS="http://www.w3.org/2000/svg",H.product="Highcharts",H.version="12.3.0",H.win=typeof window<"u"?window:{},H.doc=H.win.document,H.svg=!!((x=(m=(n=H.doc)==null?void 0:n.createElementNS)==null?void 0:m.call(n,H.SVG_NS,"svg"))!=null&&x.createSVGRect),H.pageLang=(L=(k=(S=H.doc)==null?void 0:S.documentElement)==null?void 0:k.closest("[lang]"))==null?void 0:L.lang,H.userAgent=((R=H.win.navigator)==null?void 0:R.userAgent)||"",H.isChrome=H.win.chrome,H.isFirefox=H.userAgent.indexOf("Firefox")!==-1,H.isMS=/(edge|msie|trident)/i.test(H.userAgent)&&!H.win.opera,H.isSafari=!H.isChrome&&H.userAgent.indexOf("Safari")!==-1,H.isTouchDevice=/(Mobile|Android|Windows Phone)/.test(H.userAgent),H.isWebKit=H.userAgent.indexOf("AppleWebKit")!==-1,H.deg2rad=2*Math.PI/360,H.marginNames=["plotTop","marginRight","marginBottom","plotLeft"],H.noop=function(){},H.supportsPassiveEvents=function(){let N=!1;if(!H.isMS){let Y=Object.defineProperty({},"passive",{get:function(){N=!0}});H.win.addEventListener&&H.win.removeEventListener&&(H.win.addEventListener("testPassive",H.noop,Y),H.win.removeEventListener("testPassive",H.noop,Y))}return N}(),H.charts=[],H.composed=[],H.dateFormats={},H.seriesTypes={},H.symbolSizes={},H.chartCount=0}(Ni||(Ni={}));let fi=Ni,{charts:xl,doc:gr,win:Kn}=fi;function za(H,n,m,x){let S=n?"Highcharts error":"Highcharts warning";H===32&&(H=`${S}: Deprecated member`);let k=mo(H),L=k?`${S} #${H}: www.highcharts.com/errors/${H}/`:H.toString();if(x!==void 0){let R="";k&&(L+="?"),Ps(x,function(N,Y){R+=`
 - ${Y}: ${N}`,k&&(L+=encodeURI(Y)+"="+encodeURI(N))}),L+=R}jl(fi,"displayError",{chart:m,code:H,message:L,params:x},function(){if(n)throw Error(L);Kn.console&&za.messages.indexOf(L)===-1&&console.warn(L)}),za.messages.push(L)}function Na(H,n){return parseInt(H,n||10)}function Pl(H){return typeof H=="string"}function Lo(H){let n=Object.prototype.toString.call(H);return n==="[object Array]"||n==="[object Array Iterator]"}function Zo(H,n){return!!H&&typeof H=="object"&&(!n||!Lo(H))}function pa(H){return Zo(H)&&typeof H.nodeType=="number"}function Ul(H){let n=H==null?void 0:H.constructor;return!!(Zo(H,!0)&&!pa(H)&&(n!=null&&n.name)&&n.name!=="Object")}function mo(H){return typeof H=="number"&&!isNaN(H)&&H<1/0&&H>-1/0}function ql(H){return H!=null}function Sh(H,n,m){let x,S=Pl(n)&&!ql(m),k=(L,R)=>{ql(L)?H.setAttribute(R,L):S?(x=H.getAttribute(R))||R!=="class"||(x=H.getAttribute(R+"Name")):H.removeAttribute(R)};return Pl(n)?k(m,n):Ps(n,k),x}function Wh(H){return Lo(H)?H:[H]}function Qs(H,n){let m;for(m in H||(H={}),n)H[m]=n[m];return H}function Ic(){let H=arguments,n=H.length;for(let m=0;m<n;m++){let x=H[m];if(x!=null)return x}}function _l(H,n){Qs(H.style,n)}function qa(H){return Math.pow(10,Math.floor(Math.log(H)/Math.LN10))}function Lc(H,n){return H>1e14?H:parseFloat(H.toPrecision(n||14))}(za||(za={})).messages=[],Math.easeInOutSine=function(H){return-.5*(Math.cos(Math.PI*H)-1)};let wd=Array.prototype.find?function(H,n){return H.find(n)}:function(H,n){let m,x=H.length;for(m=0;m<x;m++)if(n(H[m],m))return H[m]};function Ps(H,n,m){for(let x in H)Object.hasOwnProperty.call(H,x)&&n.call(m||H[x],H[x],x,H)}function nl(H,n,m){function x(L,R){let N=H.removeEventListener;N&&N.call(H,L,R,!1)}function S(L){let R,N;H.nodeName&&(n?(R={})[n]=!0:R=L,Ps(R,function(Y,se){if(L[se])for(N=L[se].length;N--;)x(se,L[se][N].fn)}))}let k=typeof H=="function"&&H.prototype||H;if(Object.hasOwnProperty.call(k,"hcEvents")){let L=k.hcEvents;if(n){let R=L[n]||[];m?(L[n]=R.filter(function(N){return m!==N.fn}),x(n,m)):(S(L),L[n]=[])}else S(L),delete k.hcEvents}}function jl(H,n,m,x){if(m=m||{},(gr==null?void 0:gr.createEvent)&&(H.dispatchEvent||H.fireEvent&&H!==fi)){let S=gr.createEvent("Events");S.initEvent(n,!0,!0),m=Qs(S,m),H.dispatchEvent?H.dispatchEvent(m):H.fireEvent(n,m)}else if(H.hcEvents){m.target||Qs(m,{preventDefault:function(){m.defaultPrevented=!0},target:H,type:n});let S=[],k=H,L=!1;for(;k.hcEvents;)Object.hasOwnProperty.call(k,"hcEvents")&&k.hcEvents[n]&&(S.length&&(L=!0),S.unshift.apply(S,k.hcEvents[n])),k=Object.getPrototypeOf(k);L&&S.sort((R,N)=>R.order-N.order),S.forEach(R=>{R.fn.call(H,m)===!1&&m.preventDefault()})}x&&!m.defaultPrevented&&x.call(H,m)}let Kc=function(){let H=Math.random().toString(36).substring(2,9)+"-",n=0;return function(){return"highcharts-"+(ot?"":H)+n++}}();Kn.jQuery&&(Kn.jQuery.fn.highcharts=function(){let H=[].slice.call(arguments);if(this[0])return H[0]?(new fi[Pl(H[0])?H.shift():"Chart"](this[0],H[0],H[1]),this):xl[Sh(this[0],"data-highcharts-chart")]});let Gs={addEvent:function(H,n,m,x={}){let S=typeof H=="function"&&H.prototype||H;Object.hasOwnProperty.call(S,"hcEvents")||(S.hcEvents={});let k=S.hcEvents;fi.Point&&H instanceof fi.Point&&H.series&&H.series.chart&&(H.series.chart.runTrackerClick=!0);let L=H.addEventListener;L&&L.call(H,n,m,!!fi.supportsPassiveEvents&&{passive:x.passive===void 0?n.indexOf("touch")!==-1:x.passive,capture:!1}),k[n]||(k[n]=[]);let R={fn:m,order:typeof x.order=="number"?x.order:1/0};return k[n].push(R),k[n].sort((N,Y)=>N.order-Y.order),function(){nl(H,n,m)}},arrayMax:function(H){let n=H.length,m=H[0];for(;n--;)H[n]>m&&(m=H[n]);return m},arrayMin:function(H){let n=H.length,m=H[0];for(;n--;)H[n]<m&&(m=H[n]);return m},attr:Sh,clamp:function(H,n,m){return H>n?H<m?H:m:n},clearTimeout:function(H){ql(H)&&clearTimeout(H)},correctFloat:Lc,createElement:function(H,n,m,x,S){let k=gr.createElement(H);return n&&Qs(k,n),S&&_l(k,{padding:"0",border:"none",margin:"0"}),m&&_l(k,m),x&&x.appendChild(k),k},crisp:function(H,n=0,m){let x=n%2/2,S=m?-1:1;return(Math.round(H*S-x)+x)*S},css:_l,defined:ql,destroyObjectProperties:function(H,n,m){Ps(H,function(x,S){x!==n&&(x!=null&&x.destroy)&&x.destroy(),(x!=null&&x.destroy||!m)&&delete H[S]})},diffObjects:function(H,n,m,x){let S={};return function k(L,R,N,Y){let se=m?R:L;Ps(L,function($,ee){if(!Y&&x&&x.indexOf(ee)>-1&&R[ee]){$=Wh($),N[ee]=[];for(let ae=0;ae<Math.max($.length,R[ee].length);ae++)R[ee][ae]&&($[ae]===void 0?N[ee][ae]=R[ee][ae]:(N[ee][ae]={},k($[ae],R[ee][ae],N[ee][ae],Y+1)))}else Zo($,!0)&&!$.nodeType?(N[ee]=Lo($)?[]:{},k($,R[ee]||{},N[ee],Y+1),Object.keys(N[ee]).length===0&&(ee!=="colorAxis"||Y!==0)&&delete N[ee]):(L[ee]!==R[ee]||ee in L&&!(ee in R))&&ee!=="__proto__"&&ee!=="constructor"&&(N[ee]=se[ee])})}(H,n,S,0),S},discardElement:function(H){var n;(n=H==null?void 0:H.parentElement)==null||n.removeChild(H)},erase:function(H,n){let m=H.length;for(;m--;)if(H[m]===n){H.splice(m,1);break}},error:za,extend:Qs,extendClass:function(H,n){let m=function(){};return m.prototype=new H,Qs(m.prototype,n),m},find:wd,fireEvent:jl,getAlignFactor:(H="")=>({center:.5,right:1,middle:.5,bottom:1})[H]||0,getClosestDistance:function(H,n){let m,x,S,k=!n;return H.forEach(L=>{if(L.length>1)for(S=L.length-1;S>0;S--)(x=L[S]-L[S-1])<0&&!k?(n==null||n(),n=void 0):x&&(m===void 0||x<m)&&(m=x)}),m},getMagnitude:qa,getNestedProperty:function(H,n){let m=H.split(".");for(;m.length&&ql(n);){let x=m.shift();if(x===void 0||x==="__proto__")return;if(x==="this"){let k;return Zo(n)&&(k=n["@this"]),k??n}let S=n[x.replace(/[\\'"]/g,"")];if(!ql(S)||typeof S=="function"||typeof S.nodeType=="number"||S===Kn)return;n=S}return n},getStyle:function H(n,m,x){var L;let S;if(m==="width"){let R=Math.min(n.offsetWidth,n.scrollWidth),N=(L=n.getBoundingClientRect)==null?void 0:L.call(n).width;return N<R&&N>=R-1&&(R=Math.floor(N)),Math.max(0,R-(H(n,"padding-left",!0)||0)-(H(n,"padding-right",!0)||0))}if(m==="height")return Math.max(0,Math.min(n.offsetHeight,n.scrollHeight)-(H(n,"padding-top",!0)||0)-(H(n,"padding-bottom",!0)||0));let k=Kn.getComputedStyle(n,void 0);return k&&(S=k.getPropertyValue(m),Ic(x,m!=="opacity")&&(S=Na(S))),S},insertItem:function(H,n){let m,x=H.options.index,S=n.length;for(m=H.options.isInternal?S:0;m<S+1;m++)if(!n[m]||mo(x)&&x<Ic(n[m].options.index,n[m]._i)||n[m].options.isInternal){n.splice(m,0,H);break}return m},isArray:Lo,isClass:Ul,isDOMElement:pa,isFunction:function(H){return typeof H=="function"},isNumber:mo,isObject:Zo,isString:Pl,merge:function(H,...n){let m,x=[H,...n],S={},k=function(R,N){return typeof R!="object"&&(R={}),Ps(N,function(Y,se){se!=="__proto__"&&se!=="constructor"&&(!Zo(Y,!0)||Ul(Y)||pa(Y)?R[se]=N[se]:R[se]=k(R[se]||{},Y))}),R};H===!0&&(S=x[1],x=Array.prototype.slice.call(x,2));let L=x.length;for(m=0;m<L;m++)S=k(S,x[m]);return S},normalizeTickInterval:function(H,n,m,x,S){let k,L=H;m=Ic(m,qa(H));let R=H/m;for(!n&&(n=S?[1,1.2,1.5,2,2.5,3,4,5,6,8,10]:[1,2,2.5,5,10],x===!1&&(m===1?n=n.filter(function(N){return N%1==0}):m<=.1&&(n=[1/m]))),k=0;k<n.length&&(L=n[k],(!S||!(L*m>=H))&&(S||!(R<=(n[k]+(n[k+1]||n[k]))/2)));k++);return Lc(L*m,-Math.round(Math.log(.001)/Math.LN10))},objectEach:Ps,offset:function(H){let n=gr.documentElement,m=H.parentElement||H.parentNode?H.getBoundingClientRect():{top:0,left:0,width:0,height:0};return{top:m.top+(Kn.pageYOffset||n.scrollTop)-(n.clientTop||0),left:m.left+(Kn.pageXOffset||n.scrollLeft)-(n.clientLeft||0),width:m.width,height:m.height}},pad:function(H,n,m){return Array((n||2)+1-String(H).replace("-","").length).join(m||"0")+H},pick:Ic,pInt:Na,pushUnique:function(H,n){return 0>H.indexOf(n)&&!!H.push(n)},relativeLength:function(H,n,m){return/%$/.test(H)?n*parseFloat(H)/100+(m||0):parseFloat(H)},removeEvent:nl,replaceNested:function(H,...n){let m,x;do for(x of(m=H,n))H=H.replace(x[0],x[1]);while(H!==m);return H},splat:Wh,stableSort:function(H,n){let m,x,S=H.length;for(x=0;x<S;x++)H[x].safeI=x;for(H.sort(function(k,L){return(m=n(k,L))===0?k.safeI-L.safeI:m}),x=0;x<S;x++)delete H[x].safeI},syncTimeout:function(H,n,m){return n>0?setTimeout(H,n,m):(H.call(0,m),-1)},timeUnits:{millisecond:1,second:1e3,minute:6e4,hour:36e5,day:864e5,week:6048e5,month:24192e5,year:314496e5},ucfirst:function(H){return Pl(H)?H.substring(0,1).toUpperCase()+H.substring(1):String(H)},uniqueKey:Kc,useSerialIds:function(H){return ot=Ic(H,ot)},wrap:function(H,n,m){let x=H[n];H[n]=function(){let S=arguments,k=this;return m.apply(this,[function(){return x.apply(k,arguments.length?arguments:S)}].concat([].slice.call(arguments)))}}},{pageLang:zn,win:Gl}=fi,{defined:fc,error:al,extend:Gd,isNumber:Oc,isObject:mh,isString:ll,merge:Mh,objectEach:Sa,pad:Wl,splat:Tu,timeUnits:Jc,ucfirst:Td}=Gs,To=fi.isSafari&&Gl.Intl&&!Gl.Intl.DateTimeFormat.prototype.formatRange,Rn=H=>H.main===void 0,Za=class{constructor(H,n){this.options={timezone:"UTC"},this.variableTimezone=!1,this.Date=Gl.Date,this.update(H),this.lang=n}update(H={}){this.dTLCache={},this.options=H=Mh(!0,this.options,H);let{timezoneOffset:n,useUTC:m,locale:x}=H;this.Date=H.Date||Gl.Date||Date;let S=H.timezone;fc(m)&&(S=m?"UTC":void 0),n&&n%60==0&&(S="Etc/GMT"+(n>0?"+":"")+n/60),this.variableTimezone=S!=="UTC"&&(S==null?void 0:S.indexOf("Etc/GMT"))!==0,this.timezone=S,this.lang&&x&&(this.lang.locale=x),["months","shortMonths","weekdays","shortWeekdays"].forEach(k=>{let L=/months/i.test(k),R=/short/.test(k),N={timeZone:"UTC"};N[L?"month":"weekday"]=R?"short":"long",this[k]=(L?[0,1,2,3,4,5,6,7,8,9,10,11]:[3,4,5,6,7,8,9]).map(Y=>this.dateFormat(N,(L?31:1)*24*36e5*Y))})}toParts(H){let[n,m,x,S,k,L,R]=this.dateTimeFormat({weekday:"narrow",day:"numeric",month:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},H,"es").split(/(?:, | |\/|:)/g);return[S,x-1,m,k,L,R,Math.floor(Number(H)||0)%1e3,"DLMXJVS".indexOf(n)].map(Number)}dateTimeFormat(H,n,m=this.options.locale||zn){let x=JSON.stringify(H)+m;ll(H)&&(H=this.str2dtf(H));let S=this.dTLCache[x];if(!S){H.timeZone??(H.timeZone=this.timezone);try{S=new Intl.DateTimeFormat(m,H)}catch(k){/Invalid time zone/i.test(k.message)?(al(34),H.timeZone="UTC",S=new Intl.DateTimeFormat(m,H)):al(k.message,!1)}}return this.dTLCache[x]=S,(S==null?void 0:S.format(n))||""}str2dtf(H,n={}){let m={L:{fractionalSecondDigits:3},S:{second:"2-digit"},M:{minute:"numeric"},H:{hour:"2-digit"},k:{hour:"numeric"},E:{weekday:"narrow"},a:{weekday:"short"},A:{weekday:"long"},d:{day:"2-digit"},e:{day:"numeric"},b:{month:"short"},B:{month:"long"},m:{month:"2-digit"},o:{month:"numeric"},y:{year:"2-digit"},Y:{year:"numeric"}};return Object.keys(m).forEach(x=>{H.indexOf(x)!==-1&&Gd(n,m[x])}),n}makeTime(H,n,m=1,x=0,S,k,L){let R=this.Date.UTC(H,n,m,x,S||0,k||0,L||0);if(this.timezone!=="UTC"){let N=this.getTimezoneOffset(R);if(R+=N,[2,3,8,9,10,11].indexOf(n)!==-1&&(x<5||x>20)){let Y=this.getTimezoneOffset(R);N!==Y?R+=Y-N:N-36e5!==this.getTimezoneOffset(R-36e5)||To||(R-=36e5)}}return R}parse(H){if(!ll(H))return H??void 0;let n=(H=H.replace(/\//g,"-").replace(/(GMT|UTC)/,"")).indexOf("Z")>-1||/([+-][0-9]{2}):?[0-9]{2}$/.test(H),m=/^[0-9]{4}-[0-9]{2}(-[0-9]{2}|)$/.test(H);n||m||(H+="Z");let x=Date.parse(H);if(Oc(x))return x+(!n||m?this.getTimezoneOffset(x):0)}getTimezoneOffset(H){if(this.timezone!=="UTC"){let[n,m,x,S,k=0]=this.dateTimeFormat({timeZoneName:"shortOffset"},H,"en").split(/(GMT|:)/).map(Number),L=-(60*(x+k/60)*6e4);if(Oc(L))return L}return 0}dateFormat(H,n,m){let x=this.lang;if(!fc(n)||isNaN(n))return(x==null?void 0:x.invalidDate)||"";if(ll(H=H??"%Y-%m-%d %H:%M:%S")){let S,k=/%\[([a-zA-Z]+)\]/g;for(;S=k.exec(H);)H=H.replace(S[0],this.dateTimeFormat(S[1],n,x==null?void 0:x.locale))}if(ll(H)&&H.indexOf("%")!==-1){let S=this,[k,L,R,N,Y,se,$,ee]=this.toParts(n),ae=(x==null?void 0:x.weekdays)||this.weekdays,fe=(x==null?void 0:x.shortWeekdays)||this.shortWeekdays,ve=(x==null?void 0:x.months)||this.months,Te=(x==null?void 0:x.shortMonths)||this.shortMonths;Sa(Gd({a:fe?fe[ee]:ae[ee].substr(0,3),A:ae[ee],d:Wl(R),e:Wl(R,2," "),w:ee,v:(x==null?void 0:x.weekFrom)??"",b:Te[L],B:ve[L],m:Wl(L+1),o:L+1,y:k.toString().substr(2,2),Y:k,H:Wl(N),k:N,I:Wl(N%12||12),l:N%12||12,M:Wl(Y),p:N<12?"AM":"PM",P:N<12?"am":"pm",S:Wl(se),L:Wl($,3)},fi.dateFormats),function(Ae,Ve){if(ll(H))for(;H.indexOf("%"+Ve)!==-1;)H=H.replace("%"+Ve,typeof Ae=="function"?Ae.call(S,n):Ae)})}else if(mh(H)){let S=(this.getTimezoneOffset(n)||0)/36e5,k=this.timezone||"Etc/GMT"+(S>=0?"+":"")+S,{prefix:L="",suffix:R=""}=H;H=L+this.dateTimeFormat(Gd({timeZone:k},H),n)+R}return m?Td(H):H}resolveDTLFormat(H){return mh(H,!0)?mh(H,!0)&&Rn(H)?{main:H}:H:{main:(H=Tu(H))[0],from:H[1],to:H[2]}}getDateFormat(H,n,m,x){let S=this.dateFormat("%m-%d %H:%M:%S.%L",n),k="01-01 00:00:00.000",L={millisecond:15,second:12,minute:9,hour:6,day:3},R="millisecond",N=R;for(R in Jc){if(H&&H===Jc.week&&+this.dateFormat("%w",n)===m&&S.substr(6)===k.substr(6)){R="week";break}if(H&&Jc[R]>H){R=N;break}if(L[R]&&S.substr(L[R])!==k.substr(L[R]))break;R!=="week"&&(N=R)}return this.resolveDTLFormat(x[R]).main}},{defined:Hl,extend:mc,timeUnits:Va}=Gs,Zl=class extends Za{getTimeTicks(H,n,m,x){let S=this,k=[],L={},{count:R=1,unitRange:N}=H,[Y,se,$,ee,ae,fe]=S.toParts(n),ve=(n||0)%1e3,Te;if(x??(x=1),Hl(n)){if(ve=N>=Va.second?0:R*Math.floor(ve/R),N>=Va.second&&(fe=N>=Va.minute?0:R*Math.floor(fe/R)),N>=Va.minute&&(ae=N>=Va.hour?0:R*Math.floor(ae/R)),N>=Va.hour&&(ee=N>=Va.day?0:R*Math.floor(ee/R)),N>=Va.day&&($=N>=Va.month?1:Math.max(1,R*Math.floor($/R))),N>=Va.month&&(se=N>=Va.year?0:R*Math.floor(se/R)),N>=Va.year&&(Y-=Y%R),N===Va.week){R&&(n=S.makeTime(Y,se,$,ee,ae,fe,ve));let Ke=this.dateTimeFormat({timeZone:this.timezone,weekday:"narrow"},n,"es"),Tt="DLMXJVS".indexOf(Ke);$+=-Tt+x+(Tt<x?-7:0)}n=S.makeTime(Y,se,$,ee,ae,fe,ve),S.variableTimezone&&Hl(m)&&(Te=m-n>4*Va.month||S.getTimezoneOffset(n)!==S.getTimezoneOffset(m));let Ae=n,Ve=1;for(;Ae<m;)k.push(Ae),N===Va.year?Ae=S.makeTime(Y+Ve*R,0):N===Va.month?Ae=S.makeTime(Y,se+Ve*R):Te&&(N===Va.day||N===Va.week)?Ae=S.makeTime(Y,se,$+Ve*R*(N===Va.day?1:7)):Te&&N===Va.hour&&R>1?Ae=S.makeTime(Y,se,$,ee+Ve*R):Ae+=N*R,Ve++;k.push(Ae),N<=Va.hour&&k.length<1e4&&k.forEach(Ke=>{Ke%18e5==0&&S.dateFormat("%H%M%S%L",Ke)==="000000000"&&(L[Ke]="day")})}return k.info=mc(H,{higherRanks:L,totalRange:N*R}),k}},{isTouchDevice:Wi}=fi,{fireEvent:Ra,merge:pp}=Gs,vl={colors:["#2caffe","#544fc5","#00e272","#fe6a35","#6b8abc","#d568fb","#2ee0ca","#fa4b42","#feb56a","#91e8e1"],symbols:["circle","diamond","square","triangle","triangle-down"],lang:{weekFrom:"week from",chartTitle:"Chart title",locale:void 0,loading:"Loading...",months:void 0,seriesName:"Series {add index 1}",shortMonths:void 0,weekdays:void 0,numericSymbols:["k","M","G","T","P","E"],pieSliceName:"Slice",resetZoom:"Reset zoom",yAxisTitle:"Values",resetZoomTitle:"Reset zoom level 1:1"},global:{buttonTheme:{fill:"#f7f7f7",padding:8,r:2,stroke:"#cccccc","stroke-width":1,style:{color:"#333333",cursor:"pointer",fontSize:"0.8em",fontWeight:"normal"},states:{hover:{fill:"#e6e6e6"},select:{fill:"#e6e9ff",style:{color:"#000000",fontWeight:"bold"}},disabled:{style:{color:"#cccccc"}}}}},time:{Date:void 0,timezone:"UTC",timezoneOffset:0,useUTC:void 0},chart:{alignThresholds:!1,panning:{enabled:!1,type:"x"},styledMode:!1,borderRadius:0,colorCount:10,allowMutatingData:!0,ignoreHiddenSeries:!0,spacing:[10,10,15,10],resetZoomButton:{theme:{},position:{}},reflow:!0,type:"line",zooming:{singleTouch:!1,resetButton:{theme:{zIndex:6},position:{align:"right",x:-10,y:10}}},width:null,height:null,borderColor:"#334eff",backgroundColor:"#ffffff",plotBorderColor:"#cccccc"},title:{style:{color:"#333333",fontWeight:"bold"},text:"Chart title",margin:15,minScale:.67},subtitle:{style:{color:"#666666",fontSize:"0.8em"},text:""},caption:{margin:15,style:{color:"#666666",fontSize:"0.8em"},text:"",align:"left",verticalAlign:"bottom"},plotOptions:{},legend:{enabled:!0,align:"center",alignColumns:!0,className:"highcharts-no-tooltip",events:{},layout:"horizontal",itemMarginBottom:2,itemMarginTop:2,labelFormatter:function(){return this.name},borderColor:"#999999",borderRadius:0,navigation:{style:{fontSize:"0.8em"},activeColor:"#0022ff",inactiveColor:"#cccccc"},itemStyle:{color:"#333333",cursor:"pointer",fontSize:"0.8em",textDecoration:"none",textOverflow:"ellipsis"},itemHoverStyle:{color:"#000000"},itemHiddenStyle:{color:"#666666",textDecoration:"line-through"},shadow:!1,itemCheckboxStyle:{position:"absolute",width:"13px",height:"13px"},squareSymbol:!0,symbolPadding:5,verticalAlign:"bottom",x:0,y:0,title:{style:{color:"#333333",fontSize:"0.8em",fontWeight:"bold"}}},loading:{labelStyle:{fontWeight:"bold",position:"relative",top:"45%"},style:{position:"absolute",backgroundColor:"#ffffff",opacity:.5,textAlign:"center"}},tooltip:{enabled:!0,animation:{duration:300,easing:H=>Math.sqrt(1-Math.pow(H-1,2))},borderRadius:3,dateTimeLabelFormats:{millisecond:"%[AebHMSL]",second:"%[AebHMS]",minute:"%[AebHM]",hour:"%[AebHM]",day:"%[AebY]",week:"%v %[AebY]",month:"%[BY]",year:"%Y"},footerFormat:"",headerShape:"callout",hideDelay:500,padding:8,position:{x:0,y:3},shared:!1,snap:Wi?25:10,headerFormat:'<span style="font-size: 0.8em">{ucfirst point.key}</span><br/>',pointFormat:'<span style="color:{point.color}">●</span> {series.name}: <b>{point.y}</b><br/>',backgroundColor:"#ffffff",borderWidth:void 0,stickOnContact:!1,style:{color:"#333333",cursor:"default",fontSize:"0.8em"},useHTML:!1},credits:{enabled:!0,href:"https://www.highcharts.com?credits",position:{align:"right",x:-10,verticalAlign:"bottom",y:-5},style:{cursor:"pointer",color:"#999999",fontSize:"0.6em"},text:"Highcharts.com"}},lr=new Zl(vl.time,vl.lang),ei={defaultOptions:vl,defaultTime:lr,getOptions:function(){return vl},setOptions:function(H){var n;return Ra(fi,"setOptions",{options:H}),pp(!0,vl,H),H.time&&lr.update(vl.time),H.lang&&"locale"in H.lang&&lr.update({locale:H.lang.locale}),(n=H.lang)!=null&&n.chartTitle&&(vl.title={...vl.title,text:H.lang.chartTitle}),vl}},{win:Oe}=fi,{isNumber:We,isString:ct,merge:Et,pInt:at,defined:zt}=Gs,oi=(H,n,m)=>`color-mix(in srgb,${H},${n} ${100*m}%)`,jt=H=>ct(H)&&!!H&&H!=="none";class qt{static parse(n){return n?new qt(n):qt.None}constructor(n){let m,x,S,k;this.rgba=[NaN,NaN,NaN,NaN],this.input=n;let L=fi.Color;if(L&&L!==qt)return new L(n);if(typeof n=="object"&&n.stops!==void 0)this.stops=n.stops.map(R=>new qt(R[1]));else if(typeof n=="string")for(this.input=n=qt.names[n.toLowerCase()]||n,S=qt.parsers.length;S--&&!x;)(m=(k=qt.parsers[S]).regex.exec(n))&&(x=k.parse(m));x&&(this.rgba=x)}get(n){let m=this.input,x=this.rgba;if(this.output)return this.output;if(typeof m=="object"&&this.stops!==void 0){let S=Et(m);return S.stops=[].slice.call(S.stops),this.stops.forEach((k,L)=>{S.stops[L]=[S.stops[L][0],k.get(n)]}),S}return x&&We(x[0])?n!=="rgb"&&(n||x[3]!==1)?n==="a"?`${x[3]}`:"rgba("+x.join(",")+")":"rgb("+x[0]+","+x[1]+","+x[2]+")":m}brighten(n){let m=this.rgba;if(this.stops)this.stops.forEach(function(x){x.brighten(n)});else if(We(n)&&n!==0)if(We(m[0]))for(let x=0;x<3;x++)m[x]+=at(255*n),m[x]<0&&(m[x]=0),m[x]>255&&(m[x]=255);else qt.useColorMix&&jt(this.input)&&(this.output=oi(this.input,n>0?"white":"black",Math.abs(n)));return this}setOpacity(n){return this.rgba[3]=n,this}tweenTo(n,m){let x=this.rgba,S=n.rgba;if(!We(x[0])||!We(S[0]))return qt.useColorMix&&jt(this.input)&&jt(n.input)&&m<.99?oi(this.input,n.input,m):n.input||"none";let k=S[3]!==1||x[3]!==1,L=(N,Y)=>N+(x[Y]-N)*(1-m),R=S.slice(0,3).map(L).map(Math.round);return k&&R.push(L(S[3],3)),(k?"rgba(":"rgb(")+R.join(",")+")"}}qt.names={white:"#ffffff",black:"#000000"},qt.parsers=[{regex:/rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d?(?:\.\d+)?)\s*\)/,parse:function(H){return[at(H[1]),at(H[2]),at(H[3]),parseFloat(H[4],10)]}},{regex:/rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/,parse:function(H){return[at(H[1]),at(H[2]),at(H[3]),1]}},{regex:/^#([a-f0-9])([a-f0-9])([a-f0-9])([a-f0-9])?$/i,parse:function(H){return[at(H[1]+H[1],16),at(H[2]+H[2],16),at(H[3]+H[3],16),zt(H[4])?at(H[4]+H[4],16)/255:1]}},{regex:/^#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})?$/i,parse:function(H){return[at(H[1],16),at(H[2],16),at(H[3],16),zt(H[4])?at(H[4],16)/255:1]}}],qt.useColorMix=(vd=Oe.CSS)==null?void 0:vd.supports("color","color-mix(in srgb,red,blue 9%)"),qt.None=new qt("");let{parse:gi}=qt,{win:li}=fi,{isNumber:Zi,objectEach:Ss}=Gs;class ds{constructor(n,m,x){this.pos=NaN,this.options=m,this.elem=n,this.prop=x}dSetter(){let n=this.paths,m=n==null?void 0:n[0],x=n==null?void 0:n[1],S=this.now||0,k=[];if(S!==1&&m&&x)if(m.length===x.length&&S<1)for(let L=0;L<x.length;L++){let R=m[L],N=x[L],Y=[];for(let se=0;se<N.length;se++){let $=R[se],ee=N[se];Zi($)&&Zi(ee)&&(N[0]!=="A"||se!==4&&se!==5)?Y[se]=$+S*(ee-$):Y[se]=ee}k.push(Y)}else k=x;else k=this.toD||[];this.elem.attr("d",k,void 0,!0)}update(){let n=this.elem,m=this.prop,x=this.now,S=this.options.step;this[m+"Setter"]?this[m+"Setter"]():n.attr?n.element&&n.attr(m,x,null,!0):n.style[m]=x+this.unit,S&&S.call(n,x,this)}run(n,m,x){let S=this,k=S.options,L=function(Y){return!L.stopped&&S.step(Y)},R=li.requestAnimationFrame||function(Y){setTimeout(Y,13)},N=function(){for(let Y=0;Y<ds.timers.length;Y++)ds.timers[Y]()||ds.timers.splice(Y--,1);ds.timers.length&&R(N)};n!==m||this.elem["forceAnimate:"+this.prop]?(this.startTime=+new Date,this.start=n,this.end=m,this.unit=x,this.now=this.start,this.pos=0,L.elem=this.elem,L.prop=this.prop,L()&&ds.timers.push(L)===1&&R(N)):(delete k.curAnim[this.prop],k.complete&&Object.keys(k.curAnim).length===0&&k.complete.call(this.elem))}step(n){let m,x,S=+new Date,k=this.options,L=this.elem,R=k.complete,N=k.duration,Y=k.curAnim;return L.attr&&!L.element?m=!1:n||S>=N+this.startTime?(this.now=this.end,this.pos=1,this.update(),Y[this.prop]=!0,x=!0,Ss(Y,function(se){se!==!0&&(x=!1)}),x&&R&&R.call(L),m=!1):(this.pos=k.easing((S-this.startTime)/N),this.now=this.start+(this.end-this.start)*this.pos,this.update(),m=!0),m}initPath(n,m,x){let S=n.startX,k=n.endX,L=x.slice(),R=n.isArea,N=R?2:1,Y=m&&x.length>m.length&&x.hasStackedCliffs,se,$,ee,ae,fe=m==null?void 0:m.slice();if(!fe||Y)return[L,L];function ve(Ae,Ve){for(;Ae.length<$;){let Ke=Ae[0],Tt=Ve[$-Ae.length];if(Tt&&Ke[0]==="M"&&(Tt[0]==="C"?Ae[0]=["C",Ke[1],Ke[2],Ke[1],Ke[2],Ke[1],Ke[2]]:Ae[0]=["L",Ke[1],Ke[2]]),Ae.unshift(Ke),R){let St=Ae.pop();Ae.push(Ae[Ae.length-1],St)}}}function Te(Ae){for(;Ae.length<$;){let Ve=Ae[Math.floor(Ae.length/N)-1].slice();if(Ve[0]==="C"&&(Ve[1]=Ve[5],Ve[2]=Ve[6]),R){let Ke=Ae[Math.floor(Ae.length/N)].slice();Ae.splice(Ae.length/2,0,Ve,Ke)}else Ae.push(Ve)}}if(S&&k&&k.length){for(ee=0;ee<S.length;ee++)if(S[ee]===k[0]){se=ee;break}else if(S[0]===k[k.length-S.length+ee]){se=ee,ae=!0;break}else if(S[S.length-1]===k[k.length-S.length+ee]){se=S.length-ee;break}se===void 0&&(fe=[])}return fe.length&&Zi(se)&&($=L.length+se*N,ae?(ve(fe,L),Te(L)):(ve(L,fe),Te(fe))),[fe,L]}fillSetter(){ds.prototype.strokeSetter.apply(this,arguments)}strokeSetter(){this.elem.attr(this.prop,gi(this.start).tweenTo(gi(this.end),this.pos),void 0,!0)}}ds.timers=[];let{defined:Ws,getStyle:mr,isArray:vr,isNumber:Rr,isObject:Ar,merge:Ko,objectEach:to,pick:nn}=Gs;function ao(H){return Ar(H)?Ko({duration:500,defer:0},H):{duration:500*!!H,defer:0}}function lo(H,n){let m=ds.timers.length;for(;m--;)ds.timers[m].elem!==H||n&&n!==ds.timers[m].prop||(ds.timers[m].stopped=!0)}let Oo={animate:function(H,n,m){let x,S="",k,L,R;Ar(m)||(R=arguments,m={duration:R[2],easing:R[3],complete:R[4]}),Rr(m.duration)||(m.duration=400),m.easing=typeof m.easing=="function"?m.easing:Math[m.easing]||Math.easeInOutSine,m.curAnim=Ko(n),to(n,function(N,Y){lo(H,Y),L=new ds(H,m,Y),k=void 0,Y==="d"&&vr(n.d)?(L.paths=L.initPath(H,H.pathArray,n.d),L.toD=n.d,x=0,k=1):H.attr?x=H.attr(Y):(x=parseFloat(mr(H,Y))||0,Y!=="opacity"&&(S="px")),k||(k=N),typeof k=="string"&&k.match("px")&&(k=k.replace(/px/g,"")),L.run(x,k,S)})},animObject:ao,getDeferredAnimation:function(H,n,m){let x=ao(n),S=m?[m]:H.series,k=0,L=0;return S.forEach(R=>{let N=ao(R.options.animation);k=Ar(n)&&Ws(n.defer)?x.defer:Math.max(k,N.duration+N.defer),L=Math.min(x.duration,N.duration)}),H.renderer.forExport&&(k=0),{defer:Math.max(0,k-L),duration:Math.min(k,L)}},setAnimation:function(H,n){n.renderer.globalAnimation=nn(H,n.options.chart.animation,!0)},stop:lo},{SVG_NS:fn,win:un}=fi,{attr:Ka,createElement:an,css:Il,error:Hh,isFunction:Ua,isString:Xh,objectEach:fp,splat:Gn}=Gs,{trustedTypes:Yh}=un,Sd=Yh&&Ua(Yh.createPolicy)&&Yh.createPolicy("highcharts",{createHTML:H=>H}),Wd=Sd?Sd.createHTML(""):"";class Wn{static filterUserAttributes(n){return fp(n,(m,x)=>{let S=!0;Wn.allowedAttributes.indexOf(x)===-1&&(S=!1),["background","dynsrc","href","lowsrc","src"].indexOf(x)!==-1&&(S=Xh(m)&&Wn.allowedReferences.some(k=>m.indexOf(k)===0)),S||(Hh(33,!1,void 0,{"Invalid attribute in config":`${x}`}),delete n[x]),Xh(m)&&n[x]&&(n[x]=m.replace(/</g,"&lt;"))}),n}static parseStyle(n){return n.split(";").reduce((m,x)=>{let S=x.split(":").map(L=>L.trim()),k=S.shift();return k&&S.length&&(m[k.replace(/-([a-z])/g,L=>L[1].toUpperCase())]=S.join(":")),m},{})}static setElementHTML(n,m){n.innerHTML=Wn.emptyHTML,m&&new Wn(m).addToDOM(n)}constructor(n){this.nodes=typeof n=="string"?this.parseMarkup(n):n}addToDOM(n){return function m(x,S){let k;return Gn(x).forEach(function(L){let R,N=L.tagName,Y=L.textContent?fi.doc.createTextNode(L.textContent):void 0,se=Wn.bypassHTMLFiltering;if(N)if(N==="#text")R=Y;else if(Wn.allowedTags.indexOf(N)!==-1||se){let $=N==="svg"?fn:S.namespaceURI||fn,ee=fi.doc.createElementNS($,N),ae=L.attributes||{};fp(L,function(fe,ve){ve!=="tagName"&&ve!=="attributes"&&ve!=="children"&&ve!=="style"&&ve!=="textContent"&&(ae[ve]=fe)}),Ka(ee,se?ae:Wn.filterUserAttributes(ae)),L.style&&Il(ee,L.style),Y&&ee.appendChild(Y),m(L.children||[],ee),R=ee}else Hh(33,!1,void 0,{"Invalid tagName in config":N});R&&S.appendChild(R),k=R}),k}(this.nodes,n)}parseMarkup(n){let m,x=[];n=n.trim().replace(/ style=(["'])/g," data-style=$1");try{m=new DOMParser().parseFromString(Sd?Sd.createHTML(n):n,"text/html")}catch{}if(!m){let k=an("div");k.innerHTML=n,m={body:k}}let S=(k,L)=>{let R=k.nodeName.toLowerCase(),N={tagName:R};R==="#text"&&(N.textContent=k.textContent||"");let Y=k.attributes;if(Y){let se={};[].forEach.call(Y,$=>{$.name==="data-style"?N.style=Wn.parseStyle($.value):se[$.name]=$.value}),N.attributes=se}if(k.childNodes.length){let se=[];[].forEach.call(k.childNodes,$=>{S($,se)}),se.length&&(N.children=se)}L.push(N)};return[].forEach.call(m.body.childNodes,k=>S(k,x)),x}}Wn.allowedAttributes=["alt","aria-controls","aria-describedby","aria-expanded","aria-haspopup","aria-hidden","aria-label","aria-labelledby","aria-live","aria-pressed","aria-readonly","aria-roledescription","aria-selected","class","clip-path","color","colspan","cx","cy","d","disabled","dx","dy","fill","filterUnits","flood-color","flood-opacity","height","href","id","in","in2","markerHeight","markerWidth","offset","opacity","operator","orient","padding","paddingLeft","paddingRight","patternUnits","r","radius","refX","refY","result","role","rowspan","scope","slope","src","startOffset","stdDeviation","stroke-linecap","stroke-width","stroke","style","summary","tabindex","tableValues","target","text-align","text-anchor","textAnchor","textLength","title","type","valign","width","x","x1","x2","xlink:href","y","y1","y2","zIndex"],Wn.allowedReferences=["https://","http://","mailto:","/","../","./","#"],Wn.allowedTags=["#text","a","abbr","b","br","button","caption","circle","clipPath","code","dd","defs","div","dl","dt","em","feComponentTransfer","feComposite","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feMerge","feMergeNode","feMorphology","feOffset","filter","h1","h2","h3","h4","h5","h6","hr","i","img","li","linearGradient","marker","ol","p","path","pattern","pre","rect","small","span","stop","strong","style","sub","sup","svg","table","tbody","td","text","textPath","th","thead","title","tr","tspan","u","ul"],Wn.emptyHTML=Wd,Wn.bypassHTMLFiltering=!1;let{defaultOptions:$u,defaultTime:Ah}=ei,{pageLang:$h}=fi,{extend:gh,getNestedProperty:Kl,isArray:Qc,isNumber:Ma,isObject:yn,isString:Hd,pick:bl,ucfirst:qh}=Gs,Zh={add:(H,n)=>H+n,divide:(H,n)=>n!==0?H/n:"",eq:(H,n)=>H==n,each:function(H){let n=arguments[arguments.length-1];return!!Qc(H)&&H.map((m,x)=>qu(n.body,gh(yn(m)?m:{"@this":m},{"@index":x,"@first":x===0,"@last":x===H.length-1}))).join("")},ge:(H,n)=>H>=n,gt:(H,n)=>H>n,if:H=>!!H,le:(H,n)=>H<=n,lt:(H,n)=>H<n,multiply:(H,n)=>H*n,ne:(H,n)=>H!=n,subtract:(H,n)=>H-n,ucfirst:qh,unless:H=>!H},fa={},Xd=H=>/^["'].+["']$/.test(H);function qu(H="",n,m){var Te;let x=/\{([a-zA-Z\u00C0-\u017F\d:\.,;\-\/<>\[\]%_@+"'’= #\(\)]+)\}/g,S=/\(([a-zA-Z\u00C0-\u017F\d:\.,;\-\/<>\[\]%_@+"'= ]+)\)/g,k=[],L=/f$/,R=/\.(\d)/,N=((Te=m==null?void 0:m.options)==null?void 0:Te.lang)||$u.lang,Y=(m==null?void 0:m.time)||Ah,se=(m==null?void 0:m.numberFormatter)||Ll.bind(m),$=(Ae="")=>{let Ve;return Ae==="true"||Ae!=="false"&&((Ve=Number(Ae)).toString()===Ae?Ve:Xd(Ae)?Ae.slice(1,-1):Kl(Ae,n))},ee,ae,fe=0,ve;for(;(ee=x.exec(H))!==null;){let Ae=ee,Ve=S.exec(ee[1]);Ve&&(ee=Ve,ve=!0),ae!=null&&ae.isBlock||(ae={ctx:n,expression:ee[1],find:ee[0],isBlock:ee[1].charAt(0)==="#",start:ee.index,startInner:ee.index+ee[0].length,length:ee[0].length});let Ke=(ae.isBlock?Ae:ee)[1].split(" ")[0].replace("#","");Zh[Ke]&&(ae.isBlock&&Ke===ae.fn&&fe++,ae.fn||(ae.fn=Ke));let Tt=ee[1]==="else";if(ae.isBlock&&ae.fn&&(ee[1]===`/${ae.fn}`||Tt))if(fe)!Tt&&fe--;else{let St=ae.startInner,Mt=H.substr(St,ee.index-St);ae.body===void 0?(ae.body=Mt,ae.startInner=ee.index+ee[0].length):ae.elseBody=Mt,ae.find+=Mt+ee[0],Tt||(k.push(ae),ae=void 0)}else ae.isBlock||k.push(ae);if(Ve&&!(ae!=null&&ae.isBlock))break}return k.forEach(Ae=>{let Ve,Ke,{body:Tt,elseBody:St,expression:Mt,fn:Nt}=Ae;if(Nt){let Rt=[Ae],$t=[],Ti=Mt.length,hi=0,Ei;for(Ke=0;Ke<=Ti;Ke++){let Ji=Mt.charAt(Ke);Ei||Ji!=='"'&&Ji!=="'"?Ei===Ji&&(Ei=""):Ei=Ji,Ei||Ji!==" "&&Ke!==Ti||($t.push(Mt.substr(hi,Ke-hi)),hi=Ke+1)}for(Ke=Zh[Nt].length;Ke--;)Rt.unshift($($t[Ke+1]));Ve=Zh[Nt].apply(n,Rt),Ae.isBlock&&typeof Ve=="boolean"&&(Ve=qu(Ve?Tt:St,n,m))}else{let Rt=Xd(Mt)?[Mt]:Mt.split(":"),$t=(Ve=$(Rt.shift()||""))%1!=0;if(typeof Ve=="number"&&(Rt.length||$t)){let Ti=Rt.join(":");if(L.test(Ti)||$t){let hi=parseInt((Ti.match(R)||["","-1"])[1],10);Ve!==null&&(Ve=se(Ve,hi,N.decimalPoint,Ti.indexOf(",")>-1?N.thousandsSep:""))}else Ve=Y.dateFormat(Ti,Ve)}S.lastIndex=0,S.test(Ae.find)&&Hd(Ve)&&(Ve=`"${Ve}"`)}H=H.replace(Ae.find,bl(Ve,""))}),ve?qu(H,n,m):H}function Ll(H,n,m,x){var ve;n*=1;let S,k,[L,R]=(H=+H||0).toString().split("e").map(Number),N=((ve=this==null?void 0:this.options)==null?void 0:ve.lang)||$u.lang,Y=(H.toString().split(".")[1]||"").split("e")[0].length,se=n,$={};m??(m=N.decimalPoint),x??(x=N.thousandsSep),n===-1?n=Math.min(Y,20):Ma(n)?n&&R<0&&((k=n+R)>=0?(L=+L.toExponential(k).split("e")[0],n=k):(L=Math.floor(L),H=n<20?+(L*Math.pow(10,R)).toFixed(n):0,R=0)):n=2,R&&(n??(n=2),H=L),Ma(n)&&n>=0&&($.minimumFractionDigits=n,$.maximumFractionDigits=n),x===""&&($.useGrouping=!1);let ee=x||m,ae=ee?"en":(this==null?void 0:this.locale)||N.locale||$h,fe=JSON.stringify($)+ae;return S=(fa[fe]??(fa[fe]=new Intl.NumberFormat(ae,$))).format(H),ee&&(S=S.replace(/([,\.])/g,"_$1").replace(/_\,/g,x??",").replace("_.",m??".")),(n||+S!=0)&&(!(R<0)||se)||(S="0"),R&&+S!=0&&(S+="e"+(R<0?"":"+")+R),S}let ja={dateFormat:function(H,n,m){return Ah.dateFormat(H,n,m)},format:qu,helpers:Zh,numberFormat:Ll};(function(H){let n;H.rendererTypes={},H.getRendererType=function(m=n){return H.rendererTypes[m]||H.rendererTypes[n]},H.registerRendererType=function(m,x,S){H.rendererTypes[m]=x,(!n||S)&&(n=m,fi.Renderer=x)}})(Ui||(Ui={}));let Bn=Ui,{clamp:kh,pick:Xl,pushUnique:mp,stableSort:Dc}=Gs;(is||(is={})).distribute=function H(n,m,x){let S=n,k=S.reducedLen||m,L=(Ke,Tt)=>Ke.target-Tt.target,R=[],N=n.length,Y=[],se=R.push,$,ee,ae,fe=!0,ve,Te,Ae=0,Ve;for($=N;$--;)Ae+=n[$].size;if(Ae>k){for(Dc(n,(Ke,Tt)=>(Tt.rank||0)-(Ke.rank||0)),ae=(Ve=n[0].rank===n[n.length-1].rank)?N/2:-1,ee=Ve?ae:N-1;ae&&Ae>k;)ve=n[$=Math.floor(ee)],mp(Y,$)&&(Ae-=ve.size),ee+=ae,Ve&&ee>=n.length&&(ae/=2,ee=ae);Y.sort((Ke,Tt)=>Tt-Ke).forEach(Ke=>se.apply(R,n.splice(Ke,1)))}for(Dc(n,L),n=n.map(Ke=>({size:Ke.size,targets:[Ke.target],align:Xl(Ke.align,.5)}));fe;){for($=n.length;$--;)ve=n[$],Te=(Math.min.apply(0,ve.targets)+Math.max.apply(0,ve.targets))/2,ve.pos=kh(Te-ve.size*ve.align,0,m-ve.size);for($=n.length,fe=!1;$--;)$>0&&n[$-1].pos+n[$-1].size>n[$].pos&&(n[$-1].size+=n[$].size,n[$-1].targets=n[$-1].targets.concat(n[$].targets),n[$-1].align=.5,n[$-1].pos+n[$-1].size>m&&(n[$-1].pos=m-n[$-1].size),n.splice($,1),fe=!0)}return se.apply(S,R),$=0,n.some(Ke=>{let Tt=0;return(Ke.targets||[]).some(()=>(S[$].pos=Ke.pos+Tt,x!==void 0&&Math.abs(S[$].pos-S[$].target)>x?(S.slice(0,$+1).forEach(St=>delete St.pos),S.reducedLen=(S.reducedLen||m)-.1*m,S.reducedLen>.1*m&&H(S,m,x),!0):(Tt+=S[$].size,$++,!1)))}),Dc(S,L),S};let Gr=is,{animate:Eh,animObject:Su,stop:Ch}=Oo,{deg2rad:cf,doc:ma,svg:Mu,SVG_NS:wl,win:ed,isFirefox:Yd}=fi,{addEvent:It,attr:Fi,createElement:fs,crisp:Ir,css:Ga,defined:xn,erase:Ol,extend:Ln,fireEvent:td,getAlignFactor:id,isArray:Au,isFunction:zc,isNumber:fl,isObject:Hn,isString:hl,merge:$d,objectEach:So,pick:Dl,pInt:Md,pushUnique:Ja,replaceNested:js,syncTimeout:Np,uniqueKey:lh}=Gs;class ga{_defaultGetter(n){let m=Dl(this[n+"Value"],this[n],this.element?this.element.getAttribute(n):null,0);return/^-?[\d\.]+$/.test(m)&&(m=parseFloat(m)),m}_defaultSetter(n,m,x){x.setAttribute(m,n)}add(n){let m,x=this.renderer,S=this.element;return n&&(this.parentGroup=n),this.textStr!==void 0&&this.element.nodeName==="text"&&x.buildText(this),this.added=!0,(!n||n.handleZ||this.zIndex)&&(m=this.zIndexSetter()),m||(n?n.element:x.box).appendChild(S),this.onAdd&&this.onAdd(),this}addClass(n,m){let x=m?"":this.attr("class")||"";return(n=(n||"").split(/ /g).reduce(function(S,k){return x.indexOf(k)===-1&&S.push(k),S},x?[x]:[]).join(" "))!==x&&this.attr("class",n),this}afterSetters(){this.doTransform&&(this.updateTransform(),this.doTransform=!1)}align(n,m,x,S=!0){let k=this.renderer,L=k.alignedObjects,R=!!n;n?(this.alignOptions=n,this.alignByTranslate=m,this.alignTo=x):(n=this.alignOptions||{},m=this.alignByTranslate,x=this.alignTo);let N=!x||hl(x)?x||"renderer":void 0;N&&(R&&Ja(L,this),x=void 0);let Y=Dl(x,k[N],k),se=(Y.x||0)+(n.x||0)+((Y.width||0)-(n.width||0))*id(n.align),$=(Y.y||0)+(n.y||0)+((Y.height||0)-(n.height||0))*id(n.verticalAlign),ee={"text-align":n==null?void 0:n.align};return ee[m?"translateX":"x"]=Math.round(se),ee[m?"translateY":"y"]=Math.round($),S&&(this[this.placed?"animate":"attr"](ee),this.placed=!0),this.alignAttr=ee,this}alignSetter(n){let m={left:"start",center:"middle",right:"end"};m[n]&&(this.alignValue=n,this.element.setAttribute("text-anchor",m[n]))}animate(n,m,x){let S=Su(Dl(m,this.renderer.globalAnimation,!0)),k=S.defer;return ma.hidden&&(S.duration=0),S.duration!==0?(x&&(S.complete=x),Np(()=>{this.element&&Eh(this,n,S)},k)):(this.attr(n,void 0,x||S.complete),So(n,function(L,R){S.step&&S.step.call(this,L,{prop:R,pos:1,elem:this})},this)),this}applyTextOutline(n){let m=this.element;n.indexOf("contrast")!==-1&&(n=n.replace(/contrast/g,this.renderer.getContrast(m.style.fill)));let x=n.indexOf(" "),S=n.substring(x+1),k=n.substring(0,x);if(k&&k!=="none"&&fi.svg){this.fakeTS=!0,k=k.replace(/(^[\d\.]+)(.*?)$/g,function(se,$,ee){return 2*Number($)+ee}),this.removeTextOutline();let L=ma.createElementNS(wl,"tspan");Fi(L,{class:"highcharts-text-outline",fill:S,stroke:S,"stroke-width":k,"stroke-linejoin":"round"});let R=m.querySelector("textPath")||m;[].forEach.call(R.childNodes,se=>{let $=se.cloneNode(!0);$.removeAttribute&&["fill","stroke","stroke-width","stroke"].forEach(ee=>$.removeAttribute(ee)),L.appendChild($)});let N=0;[].forEach.call(R.querySelectorAll("text tspan"),se=>{N+=Number(se.getAttribute("dy"))});let Y=ma.createElementNS(wl,"tspan");Y.textContent="​",Fi(Y,{x:Number(m.getAttribute("x")),dy:-N}),L.appendChild(Y),R.insertBefore(L,R.firstChild)}}attr(n,m,x,S){let{element:k}=this,L=ga.symbolCustomAttribs,R,N,Y=this,se;return typeof n=="string"&&m!==void 0&&(R=n,(n={})[R]=m),typeof n=="string"?Y=(this[n+"Getter"]||this._defaultGetter).call(this,n,k):(So(n,function($,ee){se=!1,S||Ch(this,ee),this.symbolName&&L.indexOf(ee)!==-1&&(N||(this.symbolAttr(n),N=!0),se=!0),this.rotation&&(ee==="x"||ee==="y")&&(this.doTransform=!0),se||(this[ee+"Setter"]||this._defaultSetter).call(this,$,ee,k)},this),this.afterSetters()),x&&x.call(this),Y}clip(n){if(n&&!n.clipPath){let m=lh()+"-",x=this.renderer.createElement("clipPath").attr({id:m}).add(this.renderer.defs);Ln(n,{clipPath:x,id:m,count:0}),n.add(x)}return this.attr("clip-path",n?`url(${this.renderer.url}#${n.id})`:"none")}crisp(n,m){m=Math.round(m||n.strokeWidth||0);let x=n.x||this.x||0,S=n.y||this.y||0,k=(n.width||this.width||0)+x,L=(n.height||this.height||0)+S,R=Ir(x,m),N=Ir(S,m);return Ln(n,{x:R,y:N,width:Ir(k,m)-R,height:Ir(L,m)-N}),xn(n.strokeWidth)&&(n.strokeWidth=m),n}complexColor(n,m,x){let S=this.renderer,k,L,R,N,Y,se,$,ee,ae,fe,ve=[],Te;td(this.renderer,"complexColor",{args:arguments},function(){if(n.radialGradient?L="radialGradient":n.linearGradient&&(L="linearGradient"),L){if(R=n[L],Y=S.gradients,se=n.stops,ae=x.radialReference,Au(R)&&(n[L]=R={x1:R[0],y1:R[1],x2:R[2],y2:R[3],gradientUnits:"userSpaceOnUse"}),L==="radialGradient"&&ae&&!xn(R.gradientUnits)&&(N=R,R=$d(R,S.getRadialAttr(ae,N),{gradientUnits:"userSpaceOnUse"})),So(R,function(Ae,Ve){Ve!=="id"&&ve.push(Ve,Ae)}),So(se,function(Ae){ve.push(Ae)}),Y[ve=ve.join(",")])fe=Y[ve].attr("id");else{R.id=fe=lh();let Ae=Y[ve]=S.createElement(L).attr(R).add(S.defs);Ae.radAttr=N,Ae.stops=[],se.forEach(function(Ve){Ve[1].indexOf("rgba")===0?($=(k=qt.parse(Ve[1])).get("rgb"),ee=k.get("a")):($=Ve[1],ee=1);let Ke=S.createElement("stop").attr({offset:Ve[0],"stop-color":$,"stop-opacity":ee}).add(Ae);Ae.stops.push(Ke)})}Te="url("+S.url+"#"+fe+")",x.setAttribute(m,Te),x.gradient=ve,n.toString=function(){return Te}}})}css(n){let m=this.styles,x={},S=this.element,k,L=!m;if(m&&So(n,function(R,N){m&&m[N]!==R&&(x[N]=R,L=!0)}),L){m&&(n=Ln(m,x)),n.width===null||n.width==="auto"?delete this.textWidth:S.nodeName.toLowerCase()==="text"&&n.width&&(k=this.textWidth=Md(n.width)),Ln(this.styles,n),k&&!Mu&&this.renderer.forExport&&delete n.width;let R=Yd&&n.fontSize||null;R&&(fl(R)||/^\d+$/.test(R))&&(n.fontSize+="px");let N=$d(n);S.namespaceURI===this.SVG_NS&&(["textOutline","textOverflow","whiteSpace","width"].forEach(Y=>N&&delete N[Y]),N.color&&(N.fill=N.color,delete N.color)),Ga(S,N)}return this.added&&(this.element.nodeName==="text"&&this.renderer.buildText(this),n.textOutline&&this.applyTextOutline(n.textOutline)),this}dashstyleSetter(n){let m,x=this["stroke-width"];if(x==="inherit"&&(x=1),n){let S=(n=n.toLowerCase()).replace("shortdashdotdot","3,1,1,1,1,1,").replace("shortdashdot","3,1,1,1").replace("shortdot","1,1,").replace("shortdash","3,1,").replace("longdash","8,3,").replace(/dot/g,"1,3,").replace("dash","4,3,").replace(/,$/,"").split(",");for(m=S.length;m--;)S[m]=""+Md(S[m])*Dl(x,NaN);n=S.join(",").replace(/NaN/g,"none"),this.element.setAttribute("stroke-dasharray",n)}}destroy(){let n=this,m=n.element||{},x=n.renderer,S=m.ownerSVGElement,k=m.nodeName==="SPAN"&&n.parentGroup||void 0,L,R;if(m.onclick=m.onmouseout=m.onmouseover=m.onmousemove=m.point=null,Ch(n),n.clipPath&&S){let N=n.clipPath;[].forEach.call(S.querySelectorAll("[clip-path],[CLIP-PATH]"),function(Y){Y.getAttribute("clip-path").indexOf(N.element.id)>-1&&Y.removeAttribute("clip-path")}),n.clipPath=N.destroy()}if(n.stops){for(R=0;R<n.stops.length;R++)n.stops[R].destroy();n.stops.length=0,n.stops=void 0}for(n.safeRemoveChild(m);k!=null&&k.div&&k.div.childNodes.length===0;)L=k.parentGroup,n.safeRemoveChild(k.div),delete k.div,k=L;n.alignOptions&&Ol(x.alignedObjects,n),So(n,(N,Y)=>{var se,$,ee;(((se=n[Y])==null?void 0:se.parentGroup)===n||["connector","foreignObject"].indexOf(Y)!==-1)&&((ee=($=n[Y])==null?void 0:$.destroy)==null||ee.call($)),delete n[Y]})}dSetter(n,m,x){Au(n)&&(typeof n[0]=="string"&&(n=this.renderer.pathToSegments(n)),this.pathArray=n,n=n.reduce((S,k,L)=>k!=null&&k.join?(L?S+" ":"")+k.join(" "):(k||"").toString(),"")),/(NaN| {2}|^$)/.test(n)&&(n="M 0 0"),this[m]!==n&&(x.setAttribute(m,n),this[m]=n)}fillSetter(n,m,x){typeof n=="string"?x.setAttribute(m,n):n&&this.complexColor(n,m,x)}hrefSetter(n,m,x){x.setAttributeNS("http://www.w3.org/1999/xlink",m,n)}getBBox(n,m){let x,S,k,L,{alignValue:R,element:N,renderer:Y,styles:se,textStr:$}=this,{cache:ee,cacheKeys:ae}=Y,fe=N.namespaceURI===this.SVG_NS,ve=Dl(m,this.rotation,0),Te=Y.styledMode?N&&ga.prototype.getStyle.call(N,"font-size"):se.fontSize;if(xn($)&&((L=$.toString()).indexOf("<")===-1&&(L=L.replace(/\d/g,"0")),L+=["",Y.rootFontSize,Te,ve,this.textWidth,R,se.lineClamp,se.textOverflow,se.fontWeight].join(",")),L&&!n&&(x=ee[L]),!x||x.polygon){if(fe||Y.forExport){try{k=this.fakeTS&&function(Ve){let Ke=N.querySelector(".highcharts-text-outline");Ke&&Ga(Ke,{display:Ve})},zc(k)&&k("none"),x=N.getBBox?Ln({},N.getBBox()):{width:N.offsetWidth,height:N.offsetHeight,x:0,y:0},zc(k)&&k("")}catch{}(!x||x.width<0)&&(x={x:0,y:0,width:0,height:0})}else x=this.htmlGetBBox();S=x.height,fe&&(x.height=S={"11px,17":14,"13px,20":16}[`${Te||""},${Math.round(S)}`]||S),ve&&(x=this.getRotatedBox(x,ve));let Ae={bBox:x};td(this,"afterGetBBox",Ae),x=Ae.bBox}if(L&&($===""||x.height>0)){for(;ae.length>250;)delete ee[ae.shift()];ee[L]||ae.push(L),ee[L]=x}return x}getRotatedBox(n,m){let{x,y:S,width:k,height:L}=n,{alignValue:R,translateY:N,rotationOriginX:Y=0,rotationOriginY:se=0}=this,$=id(R),ee=Number(this.element.getAttribute("y")||0)-(N?0:S),ae=m*cf,fe=(m-90)*cf,ve=Math.cos(ae),Te=Math.sin(ae),Ae=k*ve,Ve=k*Te,Ke=Math.cos(fe),Tt=Math.sin(fe),[[St,Mt],[Nt,Rt]]=[Y,se].map(io=>[io-io*ve,io*Te]),$t=x+$*(k-Ae)+St+Rt+ee*Ke,Ti=$t+Ae,hi=Ti-L*Ke,Ei=hi-Ae,Ji=S+ee-$*Ve-Mt+Nt+ee*Tt,er=Ji+Ve,Is=er-L*Tt,Hs=Is-Ve,qs=Math.min($t,Ti,hi,Ei),dr=Math.min(Ji,er,Is,Hs),xr=Math.max($t,Ti,hi,Ei)-qs,wr=Math.max(Ji,er,Is,Hs)-dr;return{x:qs,y:dr,width:xr,height:wr,polygon:[[$t,Ji],[Ti,er],[hi,Is],[Ei,Hs]]}}getStyle(n){return ed.getComputedStyle(this.element||this,"").getPropertyValue(n)}hasClass(n){return(""+this.attr("class")).split(" ").indexOf(n)!==-1}hide(){return this.attr({visibility:"hidden"})}htmlGetBBox(){return{height:0,width:0,x:0,y:0}}constructor(n,m){this.onEvents={},this.opacity=1,this.SVG_NS=wl,this.element=m==="span"||m==="body"?fs(m):ma.createElementNS(this.SVG_NS,m),this.renderer=n,this.styles={},td(this,"afterInit")}on(n,m){let{onEvents:x}=this;return x[n]&&x[n](),x[n]=It(this.element,n,m),this}opacitySetter(n,m,x){let S=Number(Number(n).toFixed(3));this.opacity=S,x.setAttribute(m,S)}reAlign(){var n;(n=this.alignOptions)!=null&&n.width&&this.alignOptions.align!=="left"&&(this.alignOptions.width=this.getBBox().width,this.placed=!1,this.align())}removeClass(n){return this.attr("class",(""+this.attr("class")).replace(hl(n)?RegExp(`(^| )${n}( |$)`):n," ").replace(/ +/g," ").trim())}removeTextOutline(){let n=this.element.querySelector("tspan.highcharts-text-outline");n&&this.safeRemoveChild(n)}safeRemoveChild(n){let m=n.parentNode;m&&m.removeChild(n)}setRadialReference(n){let m=this.element.gradient&&this.renderer.gradients[this.element.gradient]||void 0;return this.element.radialReference=n,m!=null&&m.radAttr&&m.animate(this.renderer.getRadialAttr(n,m.radAttr)),this}shadow(n){var k;let{renderer:m}=this,x=$d(((k=this.parentGroup)==null?void 0:k.rotation)===90?{offsetX:-1,offsetY:-1}:{},Hn(n)?n:{}),S=m.shadowDefinition(x);return this.attr({filter:n?`url(${m.url}#${S})`:"none"})}show(n=!0){return this.attr({visibility:n?"inherit":"visible"})}"stroke-widthSetter"(n,m,x){this[m]=n,x.setAttribute(m,n)}strokeWidth(){if(!this.renderer.styledMode)return this["stroke-width"]||0;let n=this.getStyle("stroke-width"),m=0,x;return/px$/.test(n)?m=Md(n):n!==""&&(Fi(x=ma.createElementNS(wl,"rect"),{width:n,"stroke-width":0}),this.element.parentNode.appendChild(x),m=x.getBBox().width,x.parentNode.removeChild(x)),m}symbolAttr(n){let m=this;ga.symbolCustomAttribs.forEach(function(x){m[x]=Dl(n[x],m[x])}),m.attr({d:m.renderer.symbols[m.symbolName](m.x,m.y,m.width,m.height,m)})}textSetter(n){n!==this.textStr&&(delete this.textPxLength,this.textStr=n,this.added&&this.renderer.buildText(this),this.reAlign())}titleSetter(n){let m=this.element,x=m.getElementsByTagName("title")[0]||ma.createElementNS(this.SVG_NS,"title");m.insertBefore?m.insertBefore(x,m.firstChild):m.appendChild(x),x.textContent=js(Dl(n,""),[/<[^>]*>/g,""]).replace(/&lt;/g,"<").replace(/&gt;/g,">")}toFront(){let n=this.element;return n.parentNode.appendChild(n),this}translate(n,m){return this.attr({translateX:n,translateY:m})}updateTransform(n="transform"){let{element:m,foreignObject:x,matrix:S,padding:k,rotation:L=0,rotationOriginX:R,rotationOriginY:N,scaleX:Y,scaleY:se,text:$,translateX:ee=0,translateY:ae=0}=this,fe=["translate("+ee+","+ae+")"];xn(S)&&fe.push("matrix("+S.join(",")+")"),L&&(fe.push("rotate("+L+" "+(R??m.getAttribute("x")??this.x??0)+" "+(N??m.getAttribute("y")??this.y??0)+")"),($==null?void 0:$.element.tagName)!=="SPAN"||$!=null&&$.foreignObject||$.attr({rotation:L,rotationOriginX:(R||0)-k,rotationOriginY:(N||0)-k})),(xn(Y)||xn(se))&&fe.push("scale("+Dl(Y,1)+" "+Dl(se,1)+")"),fe.length&&!($||this).textPath&&((x==null?void 0:x.element)||m).setAttribute(n,fe.join(" "))}visibilitySetter(n,m,x){n==="inherit"?x.removeAttribute(m):this[m]!==n&&x.setAttribute(m,n),this[m]=n}xGetter(n){return this.element.nodeName==="circle"&&(n==="x"?n="cx":n==="y"&&(n="cy")),this._defaultGetter(n)}zIndexSetter(n,m){let x=this.renderer,S=this.parentGroup,k=(S||x).element||x.box,L=this.element,R=k===x.box,N,Y,se,$=!1,ee,ae=this.added,fe;if(xn(n)?(L.setAttribute("data-z-index",n),n*=1,this[m]===n&&(ae=!1)):xn(this[m])&&L.removeAttribute("data-z-index"),this[m]=n,ae){for((n=this.zIndex)&&S&&(S.handleZ=!0),fe=(N=k.childNodes).length-1;fe>=0&&!$;fe--)ee=!xn(se=(Y=N[fe]).getAttribute("data-z-index")),Y!==L&&(n<0&&ee&&!R&&!fe?(k.insertBefore(L,N[fe]),$=!0):(Md(se)<=n||ee&&(!xn(n)||n>=0))&&(k.insertBefore(L,N[fe+1]),$=!0));$||(k.insertBefore(L,N[3*!!R]),$=!0)}return $}}ga.symbolCustomAttribs=["anchorX","anchorY","clockwise","end","height","innerR","r","start","width","x","y"],ga.prototype.strokeSetter=ga.prototype.fillSetter,ga.prototype.yGetter=ga.prototype.xGetter,ga.prototype.matrixSetter=ga.prototype.rotationOriginXSetter=ga.prototype.rotationOriginYSetter=ga.prototype.rotationSetter=ga.prototype.scaleXSetter=ga.prototype.scaleYSetter=ga.prototype.translateXSetter=ga.prototype.translateYSetter=ga.prototype.verticalAlignSetter=function(H,n){this[n]=H,this.doTransform=!0};let La=ga,{defined:yh,extend:qd,getAlignFactor:Ls,isNumber:Qr,merge:zo,pick:Jl,removeEvent:Kh}=Gs;class ro extends La{constructor(n,m,x,S,k,L,R,N,Y,se){let $;super(n,"g"),this.paddingLeftSetter=this.paddingSetter,this.paddingRightSetter=this.paddingSetter,this.doUpdate=!1,this.textStr=m,this.x=x,this.y=S,this.anchorX=L,this.anchorY=R,this.baseline=Y,this.className=se,this.addClass(se==="button"?"highcharts-no-tooltip":"highcharts-label"),se&&this.addClass("highcharts-"+se),this.text=n.text(void 0,0,0,N).attr({zIndex:1}),typeof k=="string"&&(($=/^url\((.*?)\)$/.test(k))||this.renderer.symbols[k])&&(this.symbolKey=k),this.bBox=ro.emptyBBox,this.padding=3,this.baselineOffset=0,this.needsBox=n.styledMode||$,this.deferredAttr={},this.alignFactor=0}alignSetter(n){let m=Ls(n);this.textAlign=n,m!==this.alignFactor&&(this.alignFactor=m,this.bBox&&Qr(this.xSetting)&&this.attr({x:this.xSetting}))}anchorXSetter(n,m){this.anchorX=n,this.boxAttr(m,Math.round(n)-this.getCrispAdjust()-this.xSetting)}anchorYSetter(n,m){this.anchorY=n,this.boxAttr(m,n-this.ySetting)}boxAttr(n,m){this.box?this.box.attr(n,m):this.deferredAttr[n]=m}css(n){if(n){let m={};n=zo(n),ro.textProps.forEach(x=>{n[x]!==void 0&&(m[x]=n[x],delete n[x])}),this.text.css(m),"fontSize"in m||"fontWeight"in m?this.updateTextPadding():("width"in m||"textOverflow"in m)&&this.updateBoxSize()}return La.prototype.css.call(this,n)}destroy(){Kh(this.element,"mouseenter"),Kh(this.element,"mouseleave"),this.text&&this.text.destroy(),this.box&&(this.box=this.box.destroy()),La.prototype.destroy.call(this)}fillSetter(n,m){n&&(this.needsBox=!0),this.fill=n,this.boxAttr(m,n)}getBBox(n,m){this.textStr&&this.bBox.width===0&&this.bBox.height===0&&this.updateBoxSize();let{padding:x,height:S=0,translateX:k=0,translateY:L=0,width:R=0}=this,N=Jl(this.paddingLeft,x),Y=m??(this.rotation||0),se={width:R,height:S,x:k+this.bBox.x-N,y:L+this.bBox.y-x+this.baselineOffset};return Y&&(se=this.getRotatedBox(se,Y)),se}getCrispAdjust(){return(this.renderer.styledMode&&this.box?this.box.strokeWidth():this["stroke-width"]?parseInt(this["stroke-width"],10):0)%2/2}heightSetter(n){this.heightSetting=n,this.doUpdate=!0}afterSetters(){super.afterSetters(),this.doUpdate&&(this.updateBoxSize(),this.doUpdate=!1)}onAdd(){this.text.add(this),this.attr({text:Jl(this.textStr,""),x:this.x||0,y:this.y||0}),this.box&&yh(this.anchorX)&&this.attr({anchorX:this.anchorX,anchorY:this.anchorY})}paddingSetter(n,m){Qr(n)?n!==this[m]&&(this[m]=n,this.updateTextPadding()):this[m]=void 0}rSetter(n,m){this.boxAttr(m,n)}strokeSetter(n,m){this.stroke=n,this.boxAttr(m,n)}"stroke-widthSetter"(n,m){n&&(this.needsBox=!0),this["stroke-width"]=n,this.boxAttr(m,n)}"text-alignSetter"(n){this.textAlign=this["text-align"]=n,this.updateTextPadding()}textSetter(n){n!==void 0&&this.text.attr({text:n}),this.updateTextPadding(),this.reAlign()}updateBoxSize(){let n,m=this.text,x={},S=this.padding,k=this.bBox=(!Qr(this.widthSetting)||!Qr(this.heightSetting)||this.textAlign)&&yh(m.textStr)?m.getBBox(void 0,0):ro.emptyBBox;this.width=this.getPaddedWidth(),this.height=(this.heightSetting||k.height||0)+2*S;let L=this.renderer.fontMetrics(m);if(this.baselineOffset=S+Math.min((this.text.firstLineMetrics||L).b,k.height||1/0),this.heightSetting&&(this.baselineOffset+=(this.heightSetting-L.h)/2),this.needsBox&&!m.textPath){if(!this.box){let R=this.box=this.symbolKey?this.renderer.symbol(this.symbolKey):this.renderer.rect();R.addClass((this.className==="button"?"":"highcharts-label-box")+(this.className?" highcharts-"+this.className+"-box":"")),R.add(this)}x.x=n=this.getCrispAdjust(),x.y=(this.baseline?-this.baselineOffset:0)+n,x.width=Math.round(this.width),x.height=Math.round(this.height),this.box.attr(qd(x,this.deferredAttr)),this.deferredAttr={}}}updateTextPadding(){let n=this.text,m=n.styles.textAlign||this.textAlign;if(!n.textPath){this.updateBoxSize();let x=this.baseline?0:this.baselineOffset,S=(this.paddingLeft??this.padding)+Ls(m)*(this.widthSetting??this.bBox.width);(S!==n.x||x!==n.y)&&(n.attr({align:m,x:S}),x!==void 0&&n.attr("y",x)),n.x=S,n.y=x}}widthSetter(n){this.widthSetting=Qr(n)?n:void 0,this.doUpdate=!0}getPaddedWidth(){let n=this.padding,m=Jl(this.paddingLeft,n),x=Jl(this.paddingRight,n);return(this.widthSetting||this.bBox.width||0)+m+x}xSetter(n){this.x=n,this.alignFactor&&(n-=this.alignFactor*this.getPaddedWidth(),this["forceAnimate:x"]=!0),this.xSetting=Math.round(n),this.attr("translateX",this.xSetting)}ySetter(n){this.ySetting=this.y=Math.round(n),this.attr("translateY",this.ySetting)}}ro.emptyBBox={width:0,height:0,x:0,y:0},ro.textProps=["color","direction","fontFamily","fontSize","fontStyle","fontWeight","lineClamp","lineHeight","textAlign","textDecoration","textOutline","textOverflow","whiteSpace","width"];let{defined:ku,isNumber:Ph,pick:gc}=Gs;function Ba(H,n,m,x,S){let k=[];if(S){let L=S.start||0,R=S.end||0,N=gc(S.r,m),Y=gc(S.r,x||m),se=2e-4/(S.borderRadius?1:Math.max(N,1)),$=Math.abs(R-L-2*Math.PI)<se;$&&(L=Math.PI/2,R=2.5*Math.PI-se);let ee=S.innerR,ae=gc(S.open,$),fe=Math.cos(L),ve=Math.sin(L),Te=Math.cos(R),Ae=Math.sin(R),Ve=gc(S.longArc,R-L-Math.PI<se?0:1),Ke=["A",N,Y,0,Ve,gc(S.clockwise,1),H+N*Te,n+Y*Ae];Ke.params={start:L,end:R,cx:H,cy:n},k.push(["M",H+N*fe,n+Y*ve],Ke),ku(ee)&&((Ke=["A",ee,ee,0,Ve,ku(S.clockwise)?1-S.clockwise:0,H+ee*fe,n+ee*ve]).params={start:R,end:L,cx:H,cy:n},k.push(ae?["M",H+ee*Te,n+ee*Ae]:["L",H+ee*Te,n+ee*Ae],Ke)),ae||k.push(["Z"])}return k}function Xn(H,n,m,x,S){return S!=null&&S.r?Hf(H,n,m,x,S):[["M",H,n],["L",H+m,n],["L",H+m,n+x],["L",H,n+x],["Z"]]}function Hf(H,n,m,x,S){let k=(S==null?void 0:S.r)||0;return[["M",H+k,n],["L",H+m-k,n],["A",k,k,0,0,1,H+m,n+k],["L",H+m,n+x-k],["A",k,k,0,0,1,H+m-k,n+x],["L",H+k,n+x],["A",k,k,0,0,1,H,n+x-k],["L",H,n+k],["A",k,k,0,0,1,H+k,n],["Z"]]}let sd={arc:Ba,callout:function(H,n,m,x,S){let k=Math.min((S==null?void 0:S.r)||0,m,x),L=k+6,R=S==null?void 0:S.anchorX,N=(S==null?void 0:S.anchorY)||0,Y=Hf(H,n,m,x,{r:k});if(!Ph(R)||R<m&&R>0&&N<x&&N>0)return Y;if(H+R>m-L)if(N>n+L&&N<n+x-L)Y.splice(3,1,["L",H+m,N-6],["L",H+m+6,N],["L",H+m,N+6],["L",H+m,n+x-k]);else if(R<m){let se=N<n+L,$=se?n:n+x;Y.splice(se?2:5,0,["L",R,N],["L",H+m-k,$])}else Y.splice(3,1,["L",H+m,x/2],["L",R,N],["L",H+m,x/2],["L",H+m,n+x-k]);else if(H+R<L)if(N>n+L&&N<n+x-L)Y.splice(7,1,["L",H,N+6],["L",H-6,N],["L",H,N-6],["L",H,n+k]);else if(R>0){let se=N<n+L,$=se?n:n+x;Y.splice(se?1:6,0,["L",R,N],["L",H+k,$])}else Y.splice(7,1,["L",H,x/2],["L",R,N],["L",H,x/2],["L",H,n+k]);else N>x&&R<m-L?Y.splice(5,1,["L",R+6,n+x],["L",R,n+x+6],["L",R-6,n+x],["L",H+k,n+x]):N<0&&R>L&&Y.splice(1,1,["L",R-6,n],["L",R,n-6],["L",R+6,n],["L",m-k,n]);return Y},circle:function(H,n,m,x){return Ba(H+m/2,n+x/2,m/2,x/2,{start:.5*Math.PI,end:2.5*Math.PI,open:!1})},diamond:function(H,n,m,x){return[["M",H+m/2,n],["L",H+m,n+x/2],["L",H+m/2,n+x],["L",H,n+x/2],["Z"]]},rect:Xn,roundedRect:Hf,square:Xn,triangle:function(H,n,m,x){return[["M",H+m/2,n],["L",H+m,n+x],["L",H,n+x],["Z"]]},"triangle-down":function(H,n,m,x){return[["M",H,n],["L",H+m,n],["L",H+m/2,n+x],["Z"]]}},{doc:Zd,SVG_NS:Vp,win:Kd}=fi,{attr:Tl,extend:Ad,fireEvent:Wa,isString:Jd,objectEach:cl,pick:gp}=Gs,Fr=(H,n)=>H.substring(0,n)+"…",cs=class{constructor(H){let n=H.styles;this.renderer=H.renderer,this.svgElement=H,this.width=H.textWidth,this.textLineHeight=n==null?void 0:n.lineHeight,this.textOutline=n==null?void 0:n.textOutline,this.ellipsis=(n==null?void 0:n.textOverflow)==="ellipsis",this.lineClamp=n==null?void 0:n.lineClamp,this.noWrap=(n==null?void 0:n.whiteSpace)==="nowrap"}buildSVG(){let H=this.svgElement,n=H.element,m=H.renderer,x=gp(H.textStr,"").toString(),S=x.indexOf("<")!==-1,k=n.childNodes,L=!H.added&&m.box,R=[x,this.ellipsis,this.noWrap,this.textLineHeight,this.textOutline,H.getStyle("font-size"),H.styles.lineClamp,this.width].join(",");if(R!==H.textCache){H.textCache=R,delete H.actualWidth;for(let N=k.length;N--;)n.removeChild(k[N]);if(S||this.ellipsis||this.width||H.textPath||x.indexOf(" ")!==-1&&(!this.noWrap||/<br.*?>/g.test(x))){if(x!==""){L&&L.appendChild(n);let N=new Wn(x);this.modifyTree(N.nodes),N.addToDOM(n),this.modifyDOM(),this.ellipsis&&(n.textContent||"").indexOf("…")!==-1&&H.attr("title",this.unescapeEntities(H.textStr||"",["&lt;","&gt;"])),L&&L.removeChild(n)}}else n.appendChild(Zd.createTextNode(this.unescapeEntities(x)));Jd(this.textOutline)&&H.applyTextOutline&&H.applyTextOutline(this.textOutline)}}modifyDOM(){let H,n=this.svgElement,m=Tl(n.element,"x");for(n.firstLineMetrics=void 0;(H=n.element.firstChild)&&/^[\s\u200B]*$/.test(H.textContent||" ");)n.element.removeChild(H);[].forEach.call(n.element.querySelectorAll("tspan.highcharts-br"),(L,R)=>{L.nextSibling&&L.previousSibling&&(R===0&&L.previousSibling.nodeType===1&&(n.firstLineMetrics=n.renderer.fontMetrics(L.previousSibling)),Tl(L,{dy:this.getLineHeight(L.nextSibling),x:m}))});let x=this.width||0;if(!x)return;let S=(L,R)=>{var ve;let N=L.textContent||"",Y=N.replace(/([^\^])-/g,"$1- ").split(" "),se=!this.noWrap&&(Y.length>1||n.element.childNodes.length>1),$=this.getLineHeight(R),ee=Math.max(0,x-.8*$),ae=0,fe=n.actualWidth;if(se){let Te=[],Ae=[];for(;R.firstChild&&R.firstChild!==L;)Ae.push(R.firstChild),R.removeChild(R.firstChild);for(;Y.length;)if(Y.length&&!this.noWrap&&ae>0&&(Te.push(L.textContent||""),L.textContent=Y.join(" ").replace(/- /g,"-")),this.truncate(L,void 0,Y,ae===0&&fe||0,x,ee,(Ve,Ke)=>Y.slice(0,Ke).join(" ").replace(/- /g,"-")),fe=n.actualWidth,ae++,this.lineClamp&&ae>=this.lineClamp){Y.length&&(this.truncate(L,L.textContent||"",void 0,0,x,ee,Fr),L.textContent=((ve=L.textContent)==null?void 0:ve.replace("…",""))+"…");break}Ae.forEach(Ve=>{R.insertBefore(Ve,L)}),Te.forEach(Ve=>{R.insertBefore(Zd.createTextNode(Ve),L);let Ke=Zd.createElementNS(Vp,"tspan");Ke.textContent="​",Tl(Ke,{dy:$,x:m}),R.insertBefore(Ke,L)})}else this.ellipsis&&N&&this.truncate(L,N,void 0,0,x,ee,Fr)},k=L=>{[].slice.call(L.childNodes).forEach(R=>{R.nodeType===Kd.Node.TEXT_NODE?S(R,L):(R.className.baseVal.indexOf("highcharts-br")!==-1&&(n.actualWidth=0),k(R))})};k(n.element)}getLineHeight(H){let n=H.nodeType===Kd.Node.TEXT_NODE?H.parentElement:H;return this.textLineHeight?parseInt(this.textLineHeight.toString(),10):this.renderer.fontMetrics(n||this.svgElement.element).h}modifyTree(H){let n=(m,x)=>{let{attributes:S={},children:k,style:L={},tagName:R}=m,N=this.renderer.styledMode;if(R==="b"||R==="strong"?N?S.class="highcharts-strong":L.fontWeight="bold":(R==="i"||R==="em")&&(N?S.class="highcharts-emphasized":L.fontStyle="italic"),L!=null&&L.color&&(L.fill=L.color),R==="br"){S.class="highcharts-br",m.textContent="​";let Y=H[x+1];Y!=null&&Y.textContent&&(Y.textContent=Y.textContent.replace(/^ +/gm,""))}else R==="a"&&k&&k.some(Y=>Y.tagName==="#text")&&(m.children=[{children:k,tagName:"tspan"}]);R!=="#text"&&R!=="a"&&(m.tagName="tspan"),Ad(m,{attributes:S,style:L}),k&&k.filter(Y=>Y.tagName!=="#text").forEach(n)};H.forEach(n),Wa(this.svgElement,"afterModifyTree",{nodes:H})}truncate(H,n,m,x,S,k,L){let R,N,Y=this.svgElement,{rotation:se}=Y,$=[],ee=m&&!x?1:0,ae=(n||m||"").length,fe=ae;m||(S=k);let ve=function(Te,Ae){let Ve=Ae||Te,Ke=H.parentNode;if(Ke&&$[Ve]===void 0&&Ke.getSubStringLength)try{$[Ve]=x+Ke.getSubStringLength(0,m?Ve+1:Ve)}catch{}return $[Ve]};if(Y.rotation=0,x+(N=ve(H.textContent.length))>S){for(;ee<=ae;)fe=Math.ceil((ee+ae)/2),m&&(R=L(m,fe)),N=ve(fe,R&&R.length-1),ee===ae?ee=ae+1:N>S?ae=fe-1:ee=fe;ae===0?H.textContent="":n&&ae===n.length-1||(H.textContent=R||L(n||m,fe)),this.ellipsis&&N>S&&this.truncate(H,H.textContent||"",void 0,0,S,k,Fr)}m&&m.splice(0,fe),Y.actualWidth=N,Y.rotation=se}unescapeEntities(H,n){return cl(this.renderer.escapes,function(m,x){n&&n.indexOf(m)!==-1||(H=H.toString().replace(RegExp(m,"g"),x))}),H}},{defaultOptions:Jh}=ei,{charts:hr,deg2rad:An,doc:Qh,isFirefox:Zs,isMS:ec,isWebKit:Ql,noop:rd,SVG_NS:Rc,symbolSizes:tc,win:Qa}=fi,{addEvent:ic,attr:Aa,createElement:df,crisp:eh,css:zl,defined:hh,destroyObjectProperties:uf,extend:Qd,isArray:eu,isNumber:yc,isObject:kd,isString:xc,merge:Xf,pick:Bc,pInt:Am,replaceNested:Fc,uniqueKey:Eu}=Gs;class Nc{constructor(n,m,x,S,k,L,R){let N,Y;this.x=0,this.y=0;let se=this.createElement("svg").attr({version:"1.1",class:"highcharts-root"}),$=se.element;R||se.css(this.getStyle(S||{})),n.appendChild($),Aa(n,"dir","ltr"),n.innerHTML.indexOf("xmlns")===-1&&Aa($,"xmlns",this.SVG_NS),this.box=$,this.boxWrapper=se,this.alignedObjects=[],this.url=this.getReferenceURL(),this.createElement("desc").add().element.appendChild(Qh.createTextNode("Created with Highcharts 12.3.0")),this.defs=this.createElement("defs").add(),this.allowHTML=L,this.forExport=k,this.styledMode=R,this.gradients={},this.cache={},this.cacheKeys=[],this.imgCount=0,this.rootFontSize=se.getStyle("font-size"),this.setSize(m,x,!1),Zs&&n.getBoundingClientRect&&((N=function(){zl(n,{left:0,top:0}),Y=n.getBoundingClientRect(),zl(n,{left:Math.ceil(Y.left)-Y.left+"px",top:Math.ceil(Y.top)-Y.top+"px"})})(),this.unSubPixelFix=ic(Qa,"resize",N))}definition(n){return new Wn([n]).addToDOM(this.defs.element)}getReferenceURL(){if((Zs||Ql)&&Qh.getElementsByTagName("base").length){if(!hh(Ht)){let n=Eu(),m=new Wn([{tagName:"svg",attributes:{width:8,height:8},children:[{tagName:"defs",children:[{tagName:"clipPath",attributes:{id:n},children:[{tagName:"rect",attributes:{width:4,height:4}}]}]},{tagName:"rect",attributes:{id:"hitme",width:8,height:8,"clip-path":`url(#${n})`,fill:"rgba(0,0,0,0.001)"}}]}]).addToDOM(Qh.body);zl(m,{position:"fixed",top:0,left:0,zIndex:9e5});let x=Qh.elementFromPoint(6,6);Ht=(x==null?void 0:x.id)==="hitme",Qh.body.removeChild(m)}if(Ht)return Fc(Qa.location.href.split("#")[0],[/<[^>]*>/g,""],[/([\('\)])/g,"\\$1"],[/ /g,"%20"])}return""}getStyle(n){return this.style=Qd({fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif',fontSize:"1rem"},n),this.style}setStyle(n){this.boxWrapper.css(this.getStyle(n))}isHidden(){return!this.boxWrapper.getBBox().width}destroy(){let n=this.defs;return this.box=null,this.boxWrapper=this.boxWrapper.destroy(),uf(this.gradients||{}),this.gradients=null,this.defs=n.destroy(),this.unSubPixelFix&&this.unSubPixelFix(),this.alignedObjects=null,null}createElement(n){return new this.Element(this,n)}getRadialAttr(n,m){return{cx:n[0]-n[2]/2+(m.cx||0)*n[2],cy:n[1]-n[2]/2+(m.cy||0)*n[2],r:(m.r||0)*n[2]}}shadowDefinition(n){let m=[`highcharts-drop-shadow-${this.chartIndex}`,...Object.keys(n).map(S=>`${S}-${n[S]}`)].join("-").toLowerCase().replace(/[^a-z\d\-]/g,""),x=Xf({color:"#000000",offsetX:1,offsetY:1,opacity:.15,width:5},n);return this.defs.element.querySelector(`#${m}`)||this.definition({tagName:"filter",attributes:{id:m,filterUnits:x.filterUnits},children:this.getShadowFilterContent(x)}),m}getShadowFilterContent(n){return[{tagName:"feDropShadow",attributes:{dx:n.offsetX,dy:n.offsetY,"flood-color":n.color,"flood-opacity":Math.min(5*n.opacity,1),stdDeviation:n.width/2}}]}buildText(n){new cs(n).buildSVG()}getContrast(n){if(n==="transparent")return"#000000";let m=qt.parse(n).rgba,x=" clamp(0,calc(9e9*(0.5 - (0.2126*r + 0.7152*g + 0.0722*b))),1)";if(yc(m[0])||!qt.useColorMix){let S=m.map(L=>{let R=L/255;return R<=.04?R/12.92:Math.pow((R+.055)/1.055,2.4)}),k=.2126*S[0]+.7152*S[1]+.0722*S[2];return 1.05/(k+.05)>(k+.05)/.05?"#FFFFFF":"#000000"}return"color(from "+n+" srgb"+x+x+x+")"}button(n,m,x,S,k={},L,R,N,Y,se){let $=this.label(n,m,x,Y,void 0,void 0,se,void 0,"button"),ee=this.styledMode,ae=arguments,fe=0;k=Xf(Jh.global.buttonTheme,k),ee&&(delete k.fill,delete k.stroke,delete k["stroke-width"]);let ve=k.states||{},Te=k.style||{};delete k.states,delete k.style;let Ae=[Wn.filterUserAttributes(k)],Ve=[Te];return ee||["hover","select","disabled"].forEach((Ke,Tt)=>{Ae.push(Xf(Ae[0],Wn.filterUserAttributes(ae[Tt+5]||ve[Ke]||{}))),Ve.push(Ae[Tt+1].style),delete Ae[Tt+1].style}),ic($.element,ec?"mouseover":"mouseenter",function(){fe!==3&&$.setState(1)}),ic($.element,ec?"mouseout":"mouseleave",function(){fe!==3&&$.setState(fe)}),$.setState=(Ke=0)=>{if(Ke!==1&&($.state=fe=Ke),$.removeClass(/highcharts-button-(normal|hover|pressed|disabled)/).addClass("highcharts-button-"+["normal","hover","pressed","disabled"][Ke]),!ee){$.attr(Ae[Ke]);let Tt=Ve[Ke];kd(Tt)&&$.css(Tt)}},$.attr(Ae[0]),!ee&&($.css(Qd({cursor:"default"},Te)),se&&$.text.css({pointerEvents:"none"})),$.on("touchstart",Ke=>Ke.stopPropagation()).on("click",function(Ke){fe!==3&&(S==null||S.call($,Ke))})}crispLine(n,m){let[x,S]=n;return hh(x[1])&&x[1]===S[1]&&(x[1]=S[1]=eh(x[1],m)),hh(x[2])&&x[2]===S[2]&&(x[2]=S[2]=eh(x[2],m)),n}path(n){let m=this.styledMode?{}:{fill:"none"};return eu(n)?m.d=n:kd(n)&&Qd(m,n),this.createElement("path").attr(m)}circle(n,m,x){let S=kd(n)?n:n===void 0?{}:{x:n,y:m,r:x},k=this.createElement("circle");return k.xSetter=k.ySetter=function(L,R,N){N.setAttribute("c"+R,L)},k.attr(S)}arc(n,m,x,S,k,L){let R;kd(n)?(m=(R=n).y,x=R.r,S=R.innerR,k=R.start,L=R.end,n=R.x):R={innerR:S,start:k,end:L};let N=this.symbol("arc",n,m,x,x,R);return N.r=x,N}rect(n,m,x,S,k,L){let R=kd(n)?n:n===void 0?{}:{x:n,y:m,r:k,width:Math.max(x||0,0),height:Math.max(S||0,0)},N=this.createElement("rect");return this.styledMode||(L!==void 0&&(R["stroke-width"]=L,Qd(R,N.crisp(R))),R.fill="none"),N.rSetter=function(Y,se,$){N.r=Y,Aa($,{rx:Y,ry:Y})},N.rGetter=function(){return N.r||0},N.attr(R)}roundedRect(n){return this.symbol("roundedRect").attr(n)}setSize(n,m,x){this.width=n,this.height=m,this.boxWrapper.animate({width:n,height:m},{step:function(){this.attr({viewBox:"0 0 "+this.attr("width")+" "+this.attr("height")})},duration:Bc(x,!0)?void 0:0}),this.alignElements()}g(n){let m=this.createElement("g");return n?m.attr({class:"highcharts-"+n}):m}image(n,m,x,S,k,L){let R={preserveAspectRatio:"none"};yc(m)&&(R.x=m),yc(x)&&(R.y=x),yc(S)&&(R.width=S),yc(k)&&(R.height=k);let N=this.createElement("image").attr(R),Y=function(se){N.attr({href:n}),L.call(N,se)};if(L){N.attr({href:"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="});let se=new Qa.Image;ic(se,"load",Y),se.src=n,se.complete&&Y({})}else N.attr({href:n});return N}symbol(n,m,x,S,k,L){var Te,Ae;let R,N,Y,se,$=this,ee=/^url\((.*?)\)$/,ae=ee.test(n),fe=!ae&&(this.symbols[n]?n:"circle"),ve=fe&&this.symbols[fe];if(ve)typeof m=="number"&&(N=ve.call(this.symbols,m||0,x||0,S||0,k||0,L)),R=this.path(N),$.styledMode||R.attr("fill","none"),Qd(R,{symbolName:fe||void 0,x:m,y:x,width:S,height:k}),L&&Qd(R,L);else if(ae){Y=n.match(ee)[1];let Ve=R=this.image(Y);Ve.imgwidth=Bc(L==null?void 0:L.width,(Te=tc[Y])==null?void 0:Te.width),Ve.imgheight=Bc(L==null?void 0:L.height,(Ae=tc[Y])==null?void 0:Ae.height),se=Ke=>Ke.attr({width:Ke.width,height:Ke.height}),["width","height"].forEach(Ke=>{Ve[`${Ke}Setter`]=function(Tt,St){this[St]=Tt;let{alignByTranslate:Mt,element:Nt,width:Rt,height:$t,imgwidth:Ti,imgheight:hi}=this,Ei=St==="width"?Ti:hi,Ji=1;L&&L.backgroundSize==="within"&&Rt&&$t&&Ti&&hi?(Ji=Math.min(Rt/Ti,$t/hi),Aa(Nt,{width:Math.round(Ti*Ji),height:Math.round(hi*Ji)})):Nt&&Ei&&Nt.setAttribute(St,Ei),!Mt&&Ti&&hi&&this.translate(((Rt||0)-Ti*Ji)/2,(($t||0)-hi*Ji)/2)}}),hh(m)&&Ve.attr({x:m,y:x}),Ve.isImg=!0,Ve.symbolUrl=n,hh(Ve.imgwidth)&&hh(Ve.imgheight)?se(Ve):(Ve.attr({width:0,height:0}),df("img",{onload:function(){let Ke=hr[$.chartIndex];this.width===0&&(zl(this,{position:"absolute",top:"-999em"}),Qh.body.appendChild(this)),tc[Y]={width:this.width,height:this.height},Ve.imgwidth=this.width,Ve.imgheight=this.height,Ve.element&&se(Ve),this.parentNode&&this.parentNode.removeChild(this),$.imgCount--,$.imgCount||!Ke||Ke.hasLoaded||Ke.onload()},src:Y}),this.imgCount++)}return R}clipRect(n,m,x,S){return this.rect(n,m,x,S,0)}text(n,m,x,S){let k={};if(S&&(this.allowHTML||!this.forExport))return this.html(n,m,x);k.x=Math.round(m||0),x&&(k.y=Math.round(x)),hh(n)&&(k.text=n);let L=this.createElement("text").attr(k);return S&&(!this.forExport||this.allowHTML)||(L.xSetter=function(R,N,Y){let se=Y.getElementsByTagName("tspan"),$=Y.getAttribute(N);for(let ee=0,ae;ee<se.length;ee++)(ae=se[ee]).getAttribute(N)===$&&ae.setAttribute(N,R);Y.setAttribute(N,R)}),L}fontMetrics(n){let m=Am(La.prototype.getStyle.call(n,"font-size")||0),x=m<24?m+3:Math.round(1.2*m),S=Math.round(.8*x);return{h:x,b:S,f:m}}rotCorr(n,m,x){let S=n;return m&&x&&(S=Math.max(S*Math.cos(m*An),4)),{x:-n/3*Math.sin(m*An),y:S}}pathToSegments(n){let m=[],x=[],S={A:8,C:7,H:2,L:3,M:3,Q:5,S:5,T:3,V:2};for(let k=0;k<n.length;k++)xc(x[0])&&yc(n[k])&&x.length===S[x[0].toUpperCase()]&&n.splice(k,0,x[0].replace("M","L").replace("m","l")),typeof n[k]=="string"&&(x.length&&m.push(x.slice(0)),x.length=0),x.push(n[k]);return m.push(x.slice(0)),m}label(n,m,x,S,k,L,R,N,Y){return new ro(this,n,m,x,S,k,L,R,N,Y)}alignElements(){this.alignedObjects.forEach(n=>n.align())}}Qd(Nc.prototype,{Element:La,SVG_NS:Rc,escapes:{"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},symbols:sd,draw:rd}),Bn.registerRendererType("svg",Nc,!0);let{composed:rg,isFirefox:Yf}=fi,{attr:yp,css:sc,createElement:Ed,defined:Up,extend:$f,getAlignFactor:qf,isNumber:Yl,pInt:tu,pushUnique:od}=Gs;function jp(H,n,m){var S;let x=(S=this.div)==null?void 0:S.style;La.prototype[`${n}Setter`].call(this,H,n,m),x&&(m.style[n]=x[n]=H)}let Cu=(H,n)=>{var m;if(!H.div){let x=yp(H.element,"class"),S=H.css,k=Ed("div",x?{className:x}:void 0,{position:"absolute",left:`${H.translateX||0}px`,top:`${H.translateY||0}px`,...H.styles,display:H.display,opacity:H.opacity,visibility:H.visibility},((m=H.parentGroup)==null?void 0:m.div)||n);H.classSetter=(L,R,N)=>{N.setAttribute("class",L),k.className=L},H.translateXSetter=H.translateYSetter=(L,R)=>{H[R]=L,k.style[R==="translateX"?"left":"top"]=`${L}px`,H.doTransform=!0},H.scaleXSetter=H.scaleYSetter=(L,R)=>{H[R]=L,H.doTransform=!0},H.opacitySetter=H.visibilitySetter=jp,H.css=L=>(S.call(H,L),L.cursor&&(k.style.cursor=L.cursor),L.pointerEvents&&(k.style.pointerEvents=L.pointerEvents),H),H.on=function(){return La.prototype.on.apply({element:k,onEvents:H.onEvents},arguments),H},H.div=k}return H.div};class _c extends La{static compose(n){od(rg,this.compose)&&(n.prototype.html=function(m,x,S){return new _c(this,"span").attr({text:m,x:Math.round(x),y:Math.round(S)})})}constructor(n,m){super(n,m),_c.useForeignObject?this.foreignObject=n.createElement("foreignObject").attr({zIndex:2}):this.css({position:"absolute",...n.styledMode?{}:{fontFamily:n.style.fontFamily,fontSize:n.style.fontSize}}),this.element.style.whiteSpace="nowrap"}getSpanCorrection(n,m,x){this.xCorr=-n*x,this.yCorr=-m}css(n){let m,{element:x}=this,S=x.tagName==="SPAN"&&n&&"width"in n,k=S&&n.width;return S&&(delete n.width,this.textWidth=tu(k)||void 0,m=!0),(n==null?void 0:n.textOverflow)==="ellipsis"&&(n.overflow="hidden",n.whiteSpace="nowrap"),n!=null&&n.lineClamp&&(n.display="-webkit-box",n.WebkitLineClamp=n.lineClamp,n.WebkitBoxOrient="vertical",n.overflow="hidden"),Yl(Number(n==null?void 0:n.fontSize))&&(n.fontSize+="px"),$f(this.styles,n),sc(x,n),m&&this.updateTransform(),this}htmlGetBBox(){let{element:n}=this;return{x:n.offsetLeft,y:n.offsetTop,width:n.offsetWidth,height:n.offsetHeight}}updateTransform(){var Ve;if(!this.added){this.alignOnAdd=!0;return}let{element:n,foreignObject:m,oldTextWidth:x,renderer:S,rotation:k,rotationOriginX:L,rotationOriginY:R,scaleX:N,scaleY:Y,styles:{display:se="inline-block",whiteSpace:$},textAlign:ee="left",textWidth:ae,translateX:fe=0,translateY:ve=0,x:Te=0,y:Ae=0}=this;if(m||sc(n,{marginLeft:`${fe}px`,marginTop:`${ve}px`}),n.tagName==="SPAN"){let Ke,Tt=[k,ee,n.innerHTML,ae,this.textAlign].join(","),St=-(((Ve=this.parentGroup)==null?void 0:Ve.padding)*1)||0;if(ae!==x){let $t=this.textPxLength?this.textPxLength:(sc(n,{width:"",whiteSpace:$||"nowrap"}),n.offsetWidth),Ti=ae||0,hi=n.style.textOverflow===""&&n.style.webkitLineClamp;(Ti>x||$t>Ti||hi)&&(/[\-\s\u00AD]/.test(n.textContent||n.innerText)||n.style.textOverflow==="ellipsis")&&(sc(n,{width:(k||N||$t>Ti||hi)&&Yl(ae)?ae+"px":"auto",display:se,whiteSpace:$||"normal"}),this.oldTextWidth=ae)}m&&(sc(n,{display:"inline-block",verticalAlign:"top"}),m.attr({width:S.width,height:S.height})),Tt!==this.cTT&&(Ke=S.fontMetrics(n).b,Up(k)&&!m&&(k!==(this.oldRotation||0)||ee!==this.oldAlign)&&sc(n,{transform:`rotate(${k}deg)`,transformOrigin:`${St}% ${St}px`}),this.getSpanCorrection(!Up(k)&&!this.textWidth&&this.textPxLength||n.offsetWidth,Ke,qf(ee)));let{xCorr:Mt=0,yCorr:Nt=0}=this,Rt={left:`${Te+Mt}px`,top:`${Ae+Nt}px`,textAlign:ee,transformOrigin:`${(L??Te)-Mt-Te-St}px ${(R??Ae)-Nt-Ae-St}px`};(N||Y)&&(Rt.transform=`scale(${N??1},${Y??1})`),m?(super.updateTransform(),Yl(Te)&&Yl(Ae)?(m.attr({x:Te+Mt,y:Ae+Nt,width:n.offsetWidth+3,height:n.offsetHeight,"transform-origin":n.getAttribute("transform-origin")||"0 0"}),sc(n,{display:se,textAlign:ee})):Yf&&m.attr({width:0,height:0})):sc(n,Rt),this.cTT=Tt,this.oldRotation=k,this.oldAlign=ee}}add(n){let{foreignObject:m,renderer:x}=this,S=x.box.parentNode,k=[];if(m)m.add(n),super.add(x.createElement("body").attr({xmlns:"http://www.w3.org/1999/xhtml"}).css({background:"transparent",margin:"0 3px 0 0"}).add(m));else{let L;if(this.parentGroup=n,n&&!(L=n.div)){let R=n;for(;R;)k.push(R),R=R.parentGroup;for(let N of k.reverse())L=Cu(N,S)}(L||S).appendChild(this.element)}return this.added=!0,this.alignOnAdd&&this.updateTransform(),this}textSetter(n){n!==this.textStr&&(delete this.bBox,delete this.oldTextWidth,Wn.setElementHTML(this.element,n??""),this.textStr=n,this.doTransform=!0)}alignSetter(n){this.alignValue=this.textAlign=n,this.doTransform=!0}xSetter(n,m){this[m]=n,this.doTransform=!0}}let nd=_c.prototype;nd.visibilitySetter=nd.opacitySetter=jp,nd.ySetter=nd.rotationSetter=nd.rotationOriginXSetter=nd.rotationOriginYSetter=nd.xSetter,function(H){H.xAxis={alignTicks:!0,allowDecimals:void 0,panningEnabled:!0,zIndex:2,zoomEnabled:!0,dateTimeLabelFormats:{millisecond:{main:"%[HMSL]",range:!1},second:{main:"%[HMS]",range:!1},minute:{main:"%[HM]",range:!1},hour:{main:"%[HM]",range:!1},day:{main:"%[eb]"},week:{main:"%[eb]"},month:{main:"%[bY]"},year:{main:"%Y"}},endOnTick:!1,gridLineDashStyle:"Solid",gridZIndex:1,labels:{autoRotationLimit:80,distance:15,enabled:!0,indentation:10,overflow:"justify",reserveSpace:void 0,rotation:void 0,staggerLines:0,step:0,useHTML:!1,zIndex:7,style:{color:"#333333",cursor:"default",fontSize:"0.8em",textOverflow:"ellipsis"}},maxPadding:.01,minorGridLineDashStyle:"Solid",minorTickLength:2,minorTickPosition:"outside",minorTicksPerMajor:5,minPadding:.01,offset:void 0,reversed:void 0,reversedStacks:!1,showEmpty:!0,showFirstLabel:!0,showLastLabel:!0,startOfWeek:1,startOnTick:!1,tickLength:10,tickPixelInterval:100,tickmarkPlacement:"between",tickPosition:"outside",title:{align:"middle",useHTML:!1,x:0,y:0,style:{color:"#666666",fontSize:"0.8em"}},visible:!0,minorGridLineColor:"#f2f2f2",minorGridLineWidth:1,minorTickColor:"#999999",lineColor:"#333333",lineWidth:1,gridLineColor:"#e6e6e6",gridLineWidth:void 0,tickColor:"#333333"},H.yAxis={reversedStacks:!0,endOnTick:!0,maxPadding:.05,minPadding:.05,tickPixelInterval:72,showLastLabel:!0,labels:{x:void 0},startOnTick:!0,title:{},stackLabels:{animation:{},allowOverlap:!1,enabled:!1,crop:!0,overflow:"justify",formatter:function(){let{numberFormatter:n}=this.axis.chart;return n(this.total||0,-1)},style:{color:"#000000",fontSize:"0.7em",fontWeight:"bold",textOutline:"1px contrast"}},gridLineWidth:1,lineWidth:0}}(Xs||(Xs={}));let pf=Xs,{addEvent:ch,isFunction:iu,objectEach:ns,removeEvent:Cd}=Gs;(Qi||(Qi={})).registerEventOptions=function(H,n){H.eventOptions=H.eventOptions||{},ns(n.events,function(m,x){H.eventOptions[x]!==m&&(H.eventOptions[x]&&(Cd(H,x,H.eventOptions[x]),delete H.eventOptions[x]),iu(m)&&(H.eventOptions[x]=m,ch(H,x,m,{order:0})))})};let Pd=Qi,{deg2rad:Zu}=fi,{clamp:Ih,correctFloat:Rl,defined:vc,destroyObjectProperties:bc,extend:xh,fireEvent:jr,getAlignFactor:rc,isNumber:Pu,merge:ff,objectEach:mf,pick:ad}=Gs,ho=class{constructor(H,n,m,x,S){this.isNew=!0,this.isNewLabel=!0,this.axis=H,this.pos=n,this.type=m||"",this.parameters=S||{},this.tickmarkOffset=this.parameters.tickmarkOffset,this.options=this.parameters.options,jr(this,"init"),m||x||this.addLabel()}addLabel(){var Nt,Rt;let H=this,n=H.axis,m=n.options,x=n.chart,S=n.categories,k=n.logarithmic,L=n.names,R=H.pos,N=ad((Nt=H.options)==null?void 0:Nt.labels,m.labels),Y=n.tickPositions,se=R===Y[0],$=R===Y[Y.length-1],ee=(!N.step||N.step===1)&&n.tickInterval===1,ae=Y.info,fe=H.label,ve,Te,Ae,Ve=this.parameters.category||(S?ad(S[R],L[R],R):R);k&&Pu(Ve)&&(Ve=Rl(k.lin2log(Ve))),n.dateTime&&(ae?ve=(Te=x.time.resolveDTLFormat(m.dateTimeLabelFormats[!((Rt=m.grid)!=null&&Rt.enabled)&&ae.higherRanks[R]||ae.unitName])).main:Pu(Ve)&&(ve=n.dateTime.getXDateFormat(Ve,m.dateTimeLabelFormats||{}))),H.isFirst=se,H.isLast=$;let Ke={axis:n,chart:x,dateTimeLabelFormat:ve,isFirst:se,isLast:$,pos:R,tick:H,tickPositionInfo:ae,value:Ve};jr(this,"labelFormat",Ke);let Tt=$t=>N.formatter?N.formatter.call($t,$t):N.format?($t.text=n.defaultLabelFormatter.call($t),ja.format(N.format,$t,x)):n.defaultLabelFormatter.call($t),St=Tt.call(Ke,Ke),Mt=Te==null?void 0:Te.list;Mt?H.shortenLabel=function(){for(Ae=0;Ae<Mt.length;Ae++)if(xh(Ke,{dateTimeLabelFormat:Mt[Ae]}),fe.attr({text:Tt.call(Ke,Ke)}),fe.getBBox().width<n.getSlotWidth(H)-2*(N.padding||0))return;fe.attr({text:""})}:H.shortenLabel=void 0,ee&&n._addedPlotLB&&H.moveLabel(St,N),vc(fe)||H.movedLabel?fe&&fe.textStr!==St&&!ee&&(!fe.textWidth||N.style.width||fe.styles.width||fe.css({width:null}),fe.attr({text:St}),fe.textPxLength=fe.getBBox().width):(H.label=fe=H.createLabel(St,N),H.rotation=0)}createLabel(H,n,m){let x=this.axis,{renderer:S,styledMode:k}=x.chart,L=n.style.whiteSpace,R=vc(H)&&n.enabled?S.text(H,m==null?void 0:m.x,m==null?void 0:m.y,n.useHTML).add(x.labelGroup):void 0;return R&&(k||R.css(ff(n.style)),R.textPxLength=R.getBBox().width,!k&&L&&R.css({whiteSpace:L})),R}destroy(){bc(this,this.axis)}getPosition(H,n,m,x){let S=this.axis,k=S.chart,L=x&&k.oldChartHeight||k.chartHeight,R={x:H?Rl(S.translate(n+m,void 0,void 0,x)+S.transB):S.left+S.offset+(S.opposite?(x&&k.oldChartWidth||k.chartWidth)-S.right-S.left:0),y:H?L-S.bottom+S.offset-(S.opposite?S.height:0):Rl(L-S.translate(n+m,void 0,void 0,x)-S.transB)};return R.y=Ih(R.y,-1e9,1e9),jr(this,"afterGetPosition",{pos:R}),R}getLabelPosition(H,n,m,x,S,k,L,R){let N,Y,se=this.axis,$=se.transA,ee=se.isLinked&&se.linkedParent?se.linkedParent.reversed:se.reversed,ae=se.staggerLines,fe=se.tickRotCorr||{x:0,y:0},ve=x||se.reserveSpaceDefault?0:-se.labelOffset*(se.labelAlign==="center"?.5:1),Te=S.distance,Ae={};return N=se.side===0?m.rotation?-Te:-m.getBBox().height:se.side===2?fe.y+Te:Math.cos(m.rotation*Zu)*(fe.y-m.getBBox(!1,0).height/2),vc(S.y)&&(N=se.side===0&&se.horiz?S.y+N:S.y),H=H+ad(S.x,[0,1,0,-1][se.side]*Te)+ve+fe.x-(k&&x?k*$*(ee?-1:1):0),n=n+N-(k&&!x?k*$*(ee?1:-1):0),ae&&(Y=L/(R||1)%ae,se.opposite&&(Y=ae-Y-1),n+=Y*(se.labelOffset/ae)),Ae.x=H,Ae.y=Math.round(n),jr(this,"afterGetLabelPosition",{pos:Ae,tickmarkOffset:k,index:L}),Ae}getLabelSize(){return this.label?this.label.getBBox()[this.axis.horiz?"height":"width"]:0}getMarkPath(H,n,m,x,S=!1,k){return k.crispLine([["M",H,n],["L",H+(S?0:-m),n+(S?m:0)]],x)}handleOverflow(H){var Te;let n=this.axis,m=n.options.labels,x=H.x,S=n.chart.chartWidth,k=n.chart.spacing,L=ad(n.labelLeft,Math.min(n.pos,k[3])),R=ad(n.labelRight,Math.max(n.isRadial?0:n.pos+n.len,S-k[1])),N=this.label,Y=this.rotation,se=rc(n.labelAlign||N.attr("align")),$=N.getBBox().width,ee=n.getSlotWidth(this),ae=ee,fe=1,ve;Y||m.overflow!=="justify"?Y<0&&x-se*$<L?ve=Math.round(x/Math.cos(Y*Zu)-L):Y>0&&x+se*$>R&&(ve=Math.round((S-x)/Math.cos(Y*Zu))):(x-se*$<L?ae=H.x+ae*(1-se)-L:x+(1-se)*$>R&&(ae=R-H.x+ae*se,fe=-1),(ae=Math.min(ee,ae))<ee&&n.labelAlign==="center"&&(H.x+=fe*(ee-ae-se*(ee-Math.min($,ae)))),($>ae||n.autoRotation&&((Te=N==null?void 0:N.styles)!=null&&Te.width))&&(ve=ae)),ve&&N&&(this.shortenLabel?this.shortenLabel():N.css(xh({},{width:Math.floor(ve)+"px",lineClamp:+!n.isRadial})))}moveLabel(H,n){let m=this,x=m.label,S=m.axis,k=!1,L;x&&x.textStr===H?(m.movedLabel=x,k=!0,delete m.label):mf(S.ticks,function(R){k||R.isNew||R===m||!R.label||R.label.textStr!==H||(m.movedLabel=R.label,k=!0,R.labelPos=m.movedLabel.xy,delete R.label)}),!k&&(m.labelPos||x)&&(L=m.labelPos||x.xy,m.movedLabel=m.createLabel(H,n,L),m.movedLabel&&m.movedLabel.attr({opacity:0}))}render(H,n,m){var fe;let x=this.axis,S=x.horiz,k=this.pos,L=ad(this.tickmarkOffset,x.tickmarkOffset),R=this.getPosition(S,k,L,n),N=R.x,Y=R.y,se=x.pos,$=se+x.len,ee=S?N:Y,ae=ad(m,(fe=this.label)==null?void 0:fe.newOpacity,1);!x.chart.polar&&(Rl(ee)<se||ee>$)&&(m=0),m??(m=1),this.isActive=!0,this.renderGridLine(n,m),this.renderMark(R,m),this.renderLabel(R,n,ae,H),this.isNew=!1,jr(this,"afterRender")}renderGridLine(H,n){let m=this.axis,x=m.options,S={},k=this.pos,L=this.type,R=ad(this.tickmarkOffset,m.tickmarkOffset),N=m.chart.renderer,Y=this.gridLine,se,$=x.gridLineWidth,ee=x.gridLineColor,ae=x.gridLineDashStyle;this.type==="minor"&&($=x.minorGridLineWidth,ee=x.minorGridLineColor,ae=x.minorGridLineDashStyle),Y||(m.chart.styledMode||(S.stroke=ee,S["stroke-width"]=$||0,S.dashstyle=ae),L||(S.zIndex=1),H&&(n=0),this.gridLine=Y=N.path().attr(S).addClass("highcharts-"+(L?L+"-":"")+"grid-line").add(m.gridGroup)),Y&&(se=m.getPlotLinePath({value:k+R,lineWidth:Y.strokeWidth(),force:"pass",old:H,acrossPanes:!1}))&&Y[H||this.isNew?"attr":"animate"]({d:se,opacity:n})}renderMark(H,n){let m=this.axis,x=m.options,S=m.chart.renderer,k=this.type,L=m.tickSize(k?k+"Tick":"tick"),R=H.x,N=H.y,Y=ad(x[k!=="minor"?"tickWidth":"minorTickWidth"],!k&&m.isXAxis?1:0),se=x[k!=="minor"?"tickColor":"minorTickColor"],$=this.mark,ee=!$;L&&(m.opposite&&(L[0]=-L[0]),!$&&(this.mark=$=S.path().addClass("highcharts-"+(k?k+"-":"")+"tick").add(m.axisGroup),m.chart.styledMode||$.attr({stroke:se,"stroke-width":Y})),$[ee?"attr":"animate"]({d:this.getMarkPath(R,N,L[0],$.strokeWidth(),m.horiz,S),opacity:n}))}renderLabel(H,n,m,x){let S=this.axis,k=S.horiz,L=S.options,R=this.label,N=L.labels,Y=N.step,se=ad(this.tickmarkOffset,S.tickmarkOffset),$=H.x,ee=H.y,ae=!0;R&&Pu($)&&(R.xy=H=this.getLabelPosition($,ee,R,k,N,se,x,Y),(!this.isFirst||this.isLast||L.showFirstLabel)&&(!this.isLast||this.isFirst||L.showLastLabel)?!k||N.step||N.rotation||n||m===0||this.handleOverflow(H):ae=!1,Y&&x%Y&&(ae=!1),ae&&Pu(H.y)?(H.opacity=m,R[this.isNewLabel?"attr":"animate"](H).show(!0),this.isNewLabel=!1):(R.hide(),this.isNewLabel=!0))}replaceMovedLabel(){let H=this.label,n=this.axis;H&&!this.isNew&&(H.animate({opacity:0},void 0,H.destroy),delete this.label),n.isDirty=!0,this.label=this.movedLabel,delete this.movedLabel}},{animObject:ka}=Oo,{xAxis:Zf,yAxis:km}=pf,{defaultOptions:su}=ei,{registerEventOptions:Gp}=Pd,{deg2rad:vn}=fi,{arrayMax:ea,arrayMin:Vc,clamp:Uc,correctFloat:Dr,defined:Un,destroyObjectProperties:ln,erase:oc,error:Iu,extend:yo,fireEvent:sr,getClosestDistance:nc,insertItem:Id,isArray:ru,isNumber:Hr,isString:vo,merge:ou,normalizeTickInterval:Wp,objectEach:xp,pick:Ro,relativeLength:_p,removeEvent:Ku,splat:Lu,syncTimeout:og}=Gs,Em=(H,n)=>Wp(n,void 0,void 0,Ro(H.options.allowDecimals,n<.5||H.tickAmount!==void 0),!!H.tickAmount);yo(su,{xAxis:Zf,yAxis:ou(Zf,km)});class nu{constructor(n,m,x){this.init(n,m,x)}init(n,m,x=this.coll){let S=x==="xAxis",k=this.isZAxis||(n.inverted?!S:S);this.chart=n,this.horiz=k,this.isXAxis=S,this.coll=x,sr(this,"init",{userOptions:m}),this.opposite=Ro(m.opposite,this.opposite),this.side=Ro(m.side,this.side,k?2*!this.opposite:this.opposite?1:3),this.setOptions(m);let L=this.options,R=L.labels;this.type??(this.type=L.type||"linear"),this.uniqueNames??(this.uniqueNames=L.uniqueNames??!0),sr(this,"afterSetType"),this.userOptions=m,this.minPixelPadding=0,this.reversed=Ro(L.reversed,this.reversed),this.visible=L.visible,this.zoomEnabled=L.zoomEnabled,this.hasNames=this.type==="category"||L.categories===!0,this.categories=ru(L.categories)&&L.categories||(this.hasNames?[]:void 0),this.names||(this.names=[],this.names.keys={}),this.plotLinesAndBandsGroups={},this.positiveValuesOnly=!!this.logarithmic,this.isLinked=Un(L.linkedTo),this.ticks={},this.labelEdge=[],this.minorTicks={},this.plotLinesAndBands=[],this.alternateBands={},this.len??(this.len=0),this.minRange=this.userMinRange=L.minRange||L.maxZoom,this.range=L.range,this.offset=L.offset||0,this.max=void 0,this.min=void 0;let N=Ro(L.crosshair,Lu(n.options.tooltip.crosshairs)[+!S]);this.crosshair=N===!0?{}:N,n.axes.indexOf(this)===-1&&(S?n.axes.splice(n.xAxis.length,0,this):n.axes.push(this),Id(this,n[this.coll])),n.orderItems(this.coll),this.series=this.series||[],n.inverted&&!this.isZAxis&&S&&!Un(this.reversed)&&(this.reversed=!0),this.labelRotation=Hr(R.rotation)?R.rotation:void 0,Gp(this,L),sr(this,"afterInit")}setOptions(n){let m=this.horiz?{labels:{autoRotation:[-45],padding:3},margin:15}:{labels:{padding:1},title:{rotation:90*this.side}};this.options=ou(m,this.coll==="yAxis"?{title:{text:this.chart.options.lang.yAxisTitle}}:{},su[this.coll],n),sr(this,"afterSetOptions",{userOptions:n})}defaultLabelFormatter(){let n=this.axis,{numberFormatter:m}=this.chart,x=Hr(this.value)?this.value:NaN,S=n.chart.time,k=n.categories,L=this.dateTimeLabelFormat,R=su.lang,N=R.numericSymbols,Y=R.numericSymbolMagnitude||1e3,se=n.logarithmic?Math.abs(x):n.tickInterval,$=N==null?void 0:N.length,ee,ae;if(k)ae=`${this.value}`;else if(L)ae=S.dateFormat(L,x,!0);else if($&&N&&se>=1e3)for(;$--&&ae===void 0;)se>=(ee=Math.pow(Y,$+1))&&10*x%ee==0&&N[$]!==null&&x!==0&&(ae=m(x/ee,-1)+N[$]);return ae===void 0&&(ae=Math.abs(x)>=1e4?m(x,-1):m(x,-1,void 0,"")),ae}getSeriesExtremes(){let n,m=this;sr(this,"getSeriesExtremes",null,function(){m.hasVisibleSeries=!1,m.dataMin=m.dataMax=m.threshold=void 0,m.softThreshold=!m.isXAxis,m.series.forEach(x=>{if(x.reserveSpace()){let S=x.options,k,L=S.threshold,R,N;if(m.hasVisibleSeries=!0,m.positiveValuesOnly&&0>=(L||0)&&(L=void 0),m.isXAxis)(k=x.getColumn("x")).length&&(k=m.logarithmic?k.filter(Y=>Y>0):k,R=(n=x.getXExtremes(k)).min,N=n.max,Hr(R)||R instanceof Date||(k=k.filter(Hr),R=(n=x.getXExtremes(k)).min,N=n.max),k.length&&(m.dataMin=Math.min(Ro(m.dataMin,R),R),m.dataMax=Math.max(Ro(m.dataMax,N),N)));else{let Y=x.applyExtremes();Hr(Y.dataMin)&&(R=Y.dataMin,m.dataMin=Math.min(Ro(m.dataMin,R),R)),Hr(Y.dataMax)&&(N=Y.dataMax,m.dataMax=Math.max(Ro(m.dataMax,N),N)),Un(L)&&(m.threshold=L),(!S.softThreshold||m.positiveValuesOnly)&&(m.softThreshold=!1)}}})}),sr(this,"afterGetSeriesExtremes")}translate(n,m,x,S,k,L){var ve;let R=this.linkedParent||this,N=S&&R.old?R.old.min:R.min;if(!Hr(N))return NaN;let Y=R.minPixelPadding,se=(R.isOrdinal||((ve=R.brokenAxis)==null?void 0:ve.hasBreaks)||R.logarithmic&&k)&&R.lin2val,$=1,ee=0,ae=S&&R.old?R.old.transA:R.transA,fe=0;return ae||(ae=R.transA),x&&($*=-1,ee=R.len),R.reversed&&($*=-1,ee-=$*(R.sector||R.len)),m?(fe=(n=n*$+ee-Y)/ae+N,se&&(fe=R.lin2val(fe))):(se&&(n=R.val2lin(n)),fe=$*(n-N)*ae+ee+$*Y+(Hr(L)?ae*L:0),R.isRadial||(fe=Dr(fe))),fe}toPixels(n,m){var x;return this.translate(((x=this.chart)==null?void 0:x.time.parse(n))??NaN,!1,!this.horiz,void 0,!0)+(m?0:this.pos)}toValue(n,m){return this.translate(n-(m?0:this.pos),!0,!this.horiz,void 0,!0)}getPlotLinePath(n){let m=this,x=m.chart,S=m.left,k=m.top,L=n.old,R=n.value,N=n.lineWidth,Y=L&&x.oldChartHeight||x.chartHeight,se=L&&x.oldChartWidth||x.chartWidth,$=m.transB,ee=n.translatedValue,ae=n.force,fe,ve,Te,Ae,Ve;function Ke(St,Mt,Nt){return ae!=="pass"&&(St<Mt||St>Nt)&&(ae?St=Uc(St,Mt,Nt):Ve=!0),St}let Tt={value:R,lineWidth:N,old:L,force:ae,acrossPanes:n.acrossPanes,translatedValue:ee};return sr(this,"getPlotLinePath",Tt,function(St){fe=Te=(ee=Uc(ee=Ro(ee,m.translate(R,void 0,void 0,L)),-1e9,1e9))+$,ve=Ae=Y-ee-$,Hr(ee)?m.horiz?(ve=k,Ae=Y-m.bottom+(m.options.isInternal?0:x.scrollablePixelsY||0),fe=Te=Ke(fe,S,S+m.width)):(fe=S,Te=se-m.right+(x.scrollablePixelsX||0),ve=Ae=Ke(ve,k,k+m.height)):(Ve=!0,ae=!1),St.path=Ve&&!ae?void 0:x.renderer.crispLine([["M",fe,ve],["L",Te,Ae]],N||1)}),Tt.path}getLinearTickPositions(n,m,x){let S,k,L,R=Dr(Math.floor(m/n)*n),N=Dr(Math.ceil(x/n)*n),Y=[];if(Dr(R+n)===R&&(L=20),this.single)return[m];for(S=R;S<=N&&(Y.push(S),(S=Dr(S+n,L))!==k);)k=S;return Y}getMinorTickInterval(){let{minorTicks:n,minorTickInterval:m}=this.options;return n===!0?Ro(m,"auto"):n!==!1?m:void 0}getMinorTickPositions(){var se;let n=this.options,m=this.tickPositions,x=this.minorTickInterval,S=this.pointRangePadding||0,k=(this.min||0)-S,L=(this.max||0)+S,R=(se=this.brokenAxis)!=null&&se.hasBreaks?this.brokenAxis.unitLength:L-k,N=[],Y;if(R&&R/x<this.len/3){let $=this.logarithmic;if($)this.paddedTicks.forEach(function(ee,ae,fe){ae&&N.push.apply(N,$.getLogTickPositions(x,fe[ae-1],fe[ae],!0))});else if(this.dateTime&&this.getMinorTickInterval()==="auto")N=N.concat(this.getTimeTicks(this.dateTime.normalizeTimeTickInterval(x),k,L,n.startOfWeek));else for(Y=k+(m[0]-k)%x;Y<=L&&Y!==N[0];Y+=x)N.push(Y)}return N.length!==0&&this.trimTicks(N),N}adjustForMinRange(){let n=this.options,m=this.logarithmic,x=this.chart.time,{max:S,min:k,minRange:L}=this,R,N,Y,se;this.isXAxis&&L===void 0&&!m&&(L=Un(n.min)||Un(n.max)||Un(n.floor)||Un(n.ceiling)?null:Math.min(5*(nc(this.series.map($=>{let ee=$.getColumn("x");return $.xIncrement?ee.slice(0,2):ee}))||0),this.dataMax-this.dataMin)),Hr(S)&&Hr(k)&&Hr(L)&&S-k<L&&(N=this.dataMax-this.dataMin>=L,R=(L-S+k)/2,Y=[k-R,x.parse(n.min)??k-R],N&&(Y[2]=m?m.log2lin(this.dataMin):this.dataMin),se=[(k=ea(Y))+L,x.parse(n.max)??k+L],N&&(se[2]=m?m.log2lin(this.dataMax):this.dataMax),(S=Vc(se))-k<L&&(Y[0]=S-L,Y[1]=x.parse(n.min)??S-L,k=ea(Y))),this.minRange=L,this.min=k,this.max=S}getClosest(){let n,m;if(this.categories)m=1;else{let x=[];this.series.forEach(function(S){let k=S.closestPointRange,L=S.getColumn("x");L.length===1?x.push(L[0]):S.sorted&&Un(k)&&S.reserveSpace()&&(m=Un(m)?Math.min(m,k):k)}),x.length&&(x.sort((S,k)=>S-k),n=nc([x]))}return n&&m?Math.min(n,m):n||m}nameToX(n){let m=ru(this.options.categories),x=m?this.categories:this.names,S=n.options.x,k;return n.series.requireSorting=!1,Un(S)||(S=this.uniqueNames&&x?m?x.indexOf(n.name):Ro(x.keys[n.name],-1):n.series.autoIncrement()),S===-1?!m&&x&&(k=x.length):Hr(S)&&(k=S),k!==void 0?(this.names[k]=n.name,this.names.keys[n.name]=k):n.x&&(k=n.x),k}updateNames(){let n=this,m=this.names;m.length>0&&(Object.keys(m.keys).forEach(function(x){delete m.keys[x]}),m.length=0,this.minRange=this.userMinRange,(this.series||[]).forEach(x=>{x.xIncrement=null,(!x.points||x.isDirtyData)&&(n.max=Math.max(n.max||0,x.dataTable.rowCount-1),x.processData(),x.generatePoints());let S=x.getColumn("x").slice();x.data.forEach((k,L)=>{let R=S[L];k!=null&&k.options&&k.name!==void 0&&(R=n.nameToX(k))!==void 0&&R!==k.x&&(S[L]=k.x=R)}),x.dataTable.setColumn("x",S)}))}setAxisTranslation(){var ee;let n=this,m=n.max-n.min,x=n.linkedParent,S=!!n.categories,k=n.isXAxis,L=n.axisPointRange||0,R,N=0,Y=0,se,$=n.transA;(k||S||L)&&(R=n.getClosest(),x?(N=x.minPointOffset,Y=x.pointRangePadding):n.series.forEach(function(ae){let fe=S?1:k?Ro(ae.options.pointRange,R,0):n.axisPointRange||0,ve=ae.options.pointPlacement;if(L=Math.max(L,fe),!n.single||S){let Te=ae.is("xrange")?!k:k;N=Math.max(N,Te&&vo(ve)?0:fe/2),Y=Math.max(Y,Te&&ve==="on"?0:fe)}}),se=(ee=n.ordinal)!=null&&ee.slope&&R?n.ordinal.slope/R:1,n.minPointOffset=N*=se,n.pointRangePadding=Y*=se,n.pointRange=Math.min(L,n.single&&S?1:m),k&&(n.closestPointRange=R)),n.translationSlope=n.transA=$=n.staticScale||n.len/(m+Y||1),n.transB=n.horiz?n.left:n.bottom,n.minPixelPadding=$*N,sr(this,"afterSetAxisTranslation")}minFromRange(){let{max:n,min:m}=this;return Hr(n)&&Hr(m)&&n-m||void 0}setTickInterval(n){var Is,Hs,qs,dr;let{categories:m,chart:x,dataMax:S,dataMin:k,dateTime:L,isXAxis:R,logarithmic:N,options:Y,softThreshold:se}=this,$=x.time,ee=Hr(this.threshold)?this.threshold:void 0,ae=this.minRange||0,{ceiling:fe,floor:ve,linkedTo:Te,softMax:Ae,softMin:Ve}=Y,Ke=Hr(Te)&&((Is=x[this.coll])==null?void 0:Is[Te]),Tt=Y.tickPixelInterval,St=Y.maxPadding,Mt=Y.minPadding,Nt=0,Rt,$t=Hr(Y.tickInterval)&&Y.tickInterval>=0?Y.tickInterval:void 0,Ti,hi,Ei,Ji;if(L||m||Ke||this.getTickAmount(),Ei=Ro(this.userMin,$.parse(Y.min)),Ji=Ro(this.userMax,$.parse(Y.max)),Ke?(this.linkedParent=Ke,Rt=Ke.getExtremes(),this.min=Ro(Rt.min,Rt.dataMin),this.max=Ro(Rt.max,Rt.dataMax),this.type!==Ke.type&&Iu(11,!0,x)):(se&&Un(ee)&&Hr(S)&&Hr(k)&&(k>=ee?(Ti=ee,Mt=0):S<=ee&&(hi=ee,St=0)),this.min=Ro(Ei,Ti,k),this.max=Ro(Ji,hi,S)),Hr(this.max)&&Hr(this.min)&&(N&&(this.positiveValuesOnly&&!n&&0>=Math.min(this.min,Ro(k,this.min))&&Iu(10,!0,x),this.min=Dr(N.log2lin(this.min),16),this.max=Dr(N.log2lin(this.max),16)),this.range&&Hr(k)&&(this.userMin=this.min=Ei=Math.max(k,this.minFromRange()||0),this.userMax=Ji=this.max,this.range=void 0)),sr(this,"foundExtremes"),this.adjustForMinRange(),Hr(this.min)&&Hr(this.max)){if(!Hr(this.userMin)&&Hr(Ve)&&Ve<this.min&&(this.min=Ei=Ve),!Hr(this.userMax)&&Hr(Ae)&&Ae>this.max&&(this.max=Ji=Ae),m||this.axisPointRange||(Hs=this.stacking)!=null&&Hs.usePercentage||Ke||(Nt=this.max-this.min)&&(!Un(Ei)&&Mt&&(this.min-=Nt*Mt),!Un(Ji)&&St&&(this.max+=Nt*St)),!Hr(this.userMin)&&Hr(ve)&&(this.min=Math.max(this.min,ve)),!Hr(this.userMax)&&Hr(fe)&&(this.max=Math.min(this.max,fe)),se&&Hr(k)&&Hr(S)){let xr=ee||0;!Un(Ei)&&this.min<xr&&k>=xr?this.min=Y.minRange?Math.min(xr,this.max-ae):xr:!Un(Ji)&&this.max>xr&&S<=xr&&(this.max=Y.minRange?Math.max(xr,this.min+ae):xr)}!x.polar&&this.min>this.max&&(Un(Y.min)?this.max=this.min:Un(Y.max)&&(this.min=this.max)),Nt=this.max-this.min}if(this.min!==this.max&&Hr(this.min)&&Hr(this.max)?Ke&&!$t&&Tt===Ke.options.tickPixelInterval?this.tickInterval=$t=Ke.tickInterval:this.tickInterval=Ro($t,this.tickAmount?Nt/Math.max(this.tickAmount-1,1):void 0,m?1:Nt*Tt/Math.max(this.len,Tt)):this.tickInterval=1,R&&!n){let xr=this.min!==((qs=this.old)==null?void 0:qs.min)||this.max!==((dr=this.old)==null?void 0:dr.max);this.series.forEach(function(wr){var io;wr.forceCrop=(io=wr.forceCropping)==null?void 0:io.call(wr),wr.processData(xr)}),sr(this,"postProcessData",{hasExtremesChanged:xr})}this.setAxisTranslation(),sr(this,"initialAxisTranslation"),this.pointRange&&!$t&&(this.tickInterval=Math.max(this.pointRange,this.tickInterval));let er=Ro(Y.minTickInterval,L&&!this.series.some(xr=>!xr.sorted)?this.closestPointRange:0);!$t&&er&&this.tickInterval<er&&(this.tickInterval=er),L||N||$t||(this.tickInterval=Em(this,this.tickInterval)),this.tickAmount||(this.tickInterval=this.unsquish()),this.setTickPositions()}setTickPositions(){var se,$;let n=this.options,m=n.tickPositions,x=n.tickPositioner,S=this.getMinorTickInterval(),k=!this.isPanning,L=k&&n.startOnTick,R=k&&n.endOnTick,N=[],Y;if(this.tickmarkOffset=this.categories&&n.tickmarkPlacement==="between"&&this.tickInterval===1?.5:0,this.single=this.min===this.max&&Un(this.min)&&!this.tickAmount&&(this.min%1==0||n.allowDecimals!==!1),m)N=m.slice();else if(Hr(this.min)&&Hr(this.max)){if(!((se=this.ordinal)!=null&&se.positions)&&(this.max-this.min)/this.tickInterval>Math.max(2*this.len,200))N=[this.min,this.max],Iu(19,!1,this.chart);else if(this.dateTime)N=this.getTimeTicks(this.dateTime.normalizeTimeTickInterval(this.tickInterval,n.units),this.min,this.max,n.startOfWeek,($=this.ordinal)==null?void 0:$.positions,this.closestPointRange,!0);else if(this.logarithmic)N=this.logarithmic.getLogTickPositions(this.tickInterval,this.min,this.max);else{let ee=this.tickInterval,ae=ee;for(;ae<=2*ee&&(N=this.getLinearTickPositions(this.tickInterval,this.min,this.max),this.tickAmount&&N.length>this.tickAmount);)this.tickInterval=Em(this,ae*=1.1)}N.length>this.len&&(N=[N[0],N[N.length-1]])[0]===N[1]&&(N.length=1),x&&(this.tickPositions=N,(Y=x.apply(this,[this.min,this.max]))&&(N=Y))}this.tickPositions=N,this.minorTickInterval=S==="auto"&&this.tickInterval?this.tickInterval/n.minorTicksPerMajor:S,this.paddedTicks=N.slice(0),this.trimTicks(N,L,R),!this.isLinked&&Hr(this.min)&&Hr(this.max)&&(this.single&&N.length<2&&!this.categories&&!this.series.some(ee=>ee.is("heatmap")&&ee.options.pointPlacement==="between")&&(this.min-=.5,this.max+=.5),m||Y||this.adjustTickAmount()),sr(this,"afterSetTickPositions")}trimTicks(n,m,x){let S=n[0],k=n[n.length-1],L=!this.isOrdinal&&this.minPointOffset||0;if(sr(this,"trimTicks"),!this.isLinked||!this.grid){if(m&&S!==-1/0)this.min=S;else for(;this.min-L>n[0];)n.shift();if(x)this.max=k;else for(;this.max+L<n[n.length-1];)n.pop();n.length===0&&Un(S)&&!this.options.tickPositions&&n.push((k+S)/2)}}alignToOthers(){let n,m=this,x=m.chart,S=[this],k=m.options,L=x.options.chart,R=this.coll==="yAxis"&&L.alignThresholds,N=[];if(m.thresholdAlignment=void 0,(L.alignTicks!==!1&&k.alignTicks||R)&&k.startOnTick!==!1&&k.endOnTick!==!1&&!m.logarithmic){let Y=$=>{let{horiz:ee,options:ae}=$;return[ee?ae.left:ae.top,ae.width,ae.height,ae.pane].join(",")},se=Y(this);x[this.coll].forEach(function($){let{series:ee}=$;ee.length&&ee.some(ae=>ae.visible)&&$!==m&&Y($)===se&&(n=!0,S.push($))})}if(n&&R){S.forEach(se=>{let $=se.getThresholdAlignment(m);Hr($)&&N.push($)});let Y=N.length>1?N.reduce((se,$)=>se+=$,0)/N.length:void 0;S.forEach(se=>{se.thresholdAlignment=Y})}return n}getThresholdAlignment(n){if((!Hr(this.dataMin)||this!==n&&this.series.some(m=>m.isDirty||m.isDirtyData))&&this.getSeriesExtremes(),Hr(this.threshold)){let m=Uc((this.threshold-(this.dataMin||0))/((this.dataMax||0)-(this.dataMin||0)),0,1);return this.options.reversed&&(m=1-m),m}}getTickAmount(){let n=this.options,m=n.tickPixelInterval,x=n.tickAmount;Un(n.tickInterval)||x||!(this.len<m)||this.isRadial||this.logarithmic||!n.startOnTick||!n.endOnTick||(x=2),!x&&this.alignToOthers()&&(x=Math.ceil(this.len/m)+1),x<4&&(this.finalTickAmt=x,x=5),this.tickAmount=x}adjustTickAmount(){let n=this,{finalTickAmt:m,max:x,min:S,options:k,tickPositions:L,tickAmount:R,thresholdAlignment:N}=n,Y=L==null?void 0:L.length,se=Ro(n.threshold,n.softThreshold?0:null),$,ee,ae=n.tickInterval,fe,ve=()=>L.push(Dr(L[L.length-1]+ae)),Te=()=>L.unshift(Dr(L[0]-ae));if(Hr(N)&&(fe=N<.5?Math.ceil(N*(R-1)):Math.floor(N*(R-1)),k.reversed&&(fe=R-1-fe)),n.hasData()&&Hr(S)&&Hr(x)){let Ae=()=>{n.transA*=(Y-1)/(R-1),n.min=k.startOnTick?L[0]:Math.min(S,L[0]),n.max=k.endOnTick?L[L.length-1]:Math.max(x,L[L.length-1])};if(Hr(fe)&&Hr(n.threshold)){for(;L[fe]!==se||L.length!==R||L[0]>S||L[L.length-1]<x;){for(L.length=0,L.push(n.threshold);L.length<R;)L[fe]===void 0||L[fe]>n.threshold?Te():ve();if(ae>8*n.tickInterval)break;ae*=2}Ae()}else if(Y<R){for(;L.length<R;)L.length%2||S===se?ve():Te();Ae()}if(Un(m)){for(ee=$=L.length;ee--;)(m===3&&ee%2==1||m<=2&&ee>0&&ee<$-1)&&L.splice(ee,1);n.finalTickAmt=void 0}}}setScale(){var L,R,N,Y,se;let{coll:n,stacking:m}=this,x=!1,S=!1;this.series.forEach($=>{var ee;x=x||$.isDirtyData||$.isDirty,S=S||((ee=$.xAxis)==null?void 0:ee.isDirty)||!1}),this.setAxisSize();let k=this.len!==((L=this.old)==null?void 0:L.len);k||x||S||this.isLinked||this.forceRedraw||this.userMin!==((R=this.old)==null?void 0:R.userMin)||this.userMax!==((N=this.old)==null?void 0:N.userMax)||this.alignToOthers()?(m&&n==="yAxis"&&m.buildStacks(),this.forceRedraw=!1,this.userMinRange||(this.minRange=void 0),this.getSeriesExtremes(),this.setTickInterval(),m&&n==="xAxis"&&m.buildStacks(),this.isDirty||(this.isDirty=k||this.min!==((Y=this.old)==null?void 0:Y.min)||this.max!==((se=this.old)==null?void 0:se.max))):m&&m.cleanStacks(),x&&delete this.allExtremes,sr(this,"afterSetScale")}setExtremes(n,m,x=!0,S,k){let L=this.chart;this.series.forEach(R=>{delete R.kdTree}),n=L.time.parse(n),m=L.time.parse(m),sr(this,"setExtremes",k=yo(k,{min:n,max:m}),R=>{this.userMin=R.min,this.userMax=R.max,this.eventArgs=R,x&&L.redraw(S)})}setAxisSize(){let n=this.chart,m=this.options,x=m.offsets||[0,0,0,0],S=this.horiz,k=this.width=Math.round(_p(Ro(m.width,n.plotWidth-x[3]+x[1]),n.plotWidth)),L=this.height=Math.round(_p(Ro(m.height,n.plotHeight-x[0]+x[2]),n.plotHeight)),R=this.top=Math.round(_p(Ro(m.top,n.plotTop+x[0]),n.plotHeight,n.plotTop)),N=this.left=Math.round(_p(Ro(m.left,n.plotLeft+x[3]),n.plotWidth,n.plotLeft));this.bottom=n.chartHeight-L-R,this.right=n.chartWidth-k-N,this.len=Math.max(S?k:L,0),this.pos=S?N:R}getExtremes(){let n=this.logarithmic;return{min:n?Dr(n.lin2log(this.min)):this.min,max:n?Dr(n.lin2log(this.max)):this.max,dataMin:this.dataMin,dataMax:this.dataMax,userMin:this.userMin,userMax:this.userMax}}getThreshold(n){let m=this.logarithmic,x=m?m.lin2log(this.min):this.min,S=m?m.lin2log(this.max):this.max;return n===null||n===-1/0?n=x:n===1/0?n=S:x>n?n=x:S<n&&(n=S),this.translate(n,0,1,0,1)}autoLabelAlign(n){let m=(Ro(n,0)-90*this.side+720)%360,x={align:"center"};return sr(this,"autoLabelAlign",x,function(S){m>15&&m<165?S.align="right":m>195&&m<345&&(S.align="left")}),x.align}tickSize(n){let m=this.options,x=Ro(m[n==="tick"?"tickWidth":"minorTickWidth"],n==="tick"&&this.isXAxis&&!this.categories?1:0),S=m[n==="tick"?"tickLength":"minorTickLength"],k;x&&S&&(m[n+"Position"]==="inside"&&(S=-S),k=[S,x]);let L={tickSize:k};return sr(this,"afterTickSize",L),L.tickSize}labelMetrics(){let n=this.chart.renderer,m=this.ticks,x=m[Object.keys(m)[0]]||{};return this.chart.renderer.fontMetrics(x.label||x.movedLabel||n.box)}unsquish(){let n=this.options.labels,m=n.padding||0,x=this.horiz,S=this.tickInterval,k=this.len/((+!!this.categories+this.max-this.min)/S),L=n.rotation,R=Dr(.8*this.labelMetrics().h),N=Math.max(this.max-this.min,0),Y=function(fe){let ve=(fe+2*m)/(k||1);return(ve=ve>1?Math.ceil(ve):1)*S>N&&fe!==1/0&&k!==1/0&&N&&(ve=Math.ceil(N/S)),Dr(ve*S)},se=S,$,ee=Number.MAX_VALUE,ae;if(x){if(!n.staggerLines&&(Hr(L)?ae=[L]:k<n.autoRotationLimit&&(ae=n.autoRotation)),ae){let fe,ve;for(let Te of ae)(Te===L||Te&&Te>=-90&&Te<=90)&&(ve=(fe=Y(Math.abs(R/Math.sin(vn*Te))))+Math.abs(Te/360))<ee&&(ee=ve,$=Te,se=fe)}}else se=Y(.75*R);return this.autoRotation=ae,this.labelRotation=Ro($,Hr(L)?L:0),n.step?S:se}getSlotWidth(n){let m=this.chart,x=this.horiz,S=this.options.labels,k=Math.max(this.tickPositions.length-!this.categories,1),L=m.margin[3];if(n&&Hr(n.slotWidth))return n.slotWidth;if(x&&S.step<2&&!this.isRadial)return S.rotation?0:(this.staggerLines||1)*this.len/k;if(!x){let R=S.style.width;if(R!==void 0)return parseInt(String(R),10);if(L)return L-m.spacing[3]}return .33*m.chartWidth}renderUnsquish(){let n=this.chart,m=n.renderer,x=this.tickPositions,S=this.ticks,k=this.options.labels,L=k.style,R=this.horiz,N=this.getSlotWidth(),Y=Math.max(1,Math.round(N-(R?2*(k.padding||0):k.distance||0))),se={},$=this.labelMetrics(),ee=L.lineClamp,ae,fe=ee??(Math.floor(this.len/(x.length*$.h))||1),ve=0;vo(k.rotation)||(se.rotation=k.rotation||0),x.forEach(function(Te){var Ke;let Ae=S[Te];Ae.movedLabel&&Ae.replaceMovedLabel();let Ve=((Ke=Ae.label)==null?void 0:Ke.textPxLength)||0;Ve>ve&&(ve=Ve)}),this.maxLabelLength=ve,this.autoRotation?ve>Y&&ve>$.h?se.rotation=this.labelRotation:this.labelRotation=0:N&&(ae=Y),se.rotation&&(ae=ve>.5*n.chartHeight?.33*n.chartHeight:ve,ee||(fe=1)),this.labelAlign=k.align||this.autoLabelAlign(this.labelRotation),this.labelAlign&&(se.align=this.labelAlign),x.forEach(function(Te){let Ae=S[Te],Ve=Ae==null?void 0:Ae.label,Ke=L.width,Tt={};Ve&&(Ve.attr(se),Ae.shortenLabel?Ae.shortenLabel():ae&&!Ke&&L.whiteSpace!=="nowrap"&&(ae<(Ve.textPxLength||0)||Ve.element.tagName==="SPAN")?Ve.css(yo(Tt,{width:`${ae}px`,lineClamp:fe})):!Ve.styles.width||Tt.width||Ke||Ve.css({width:"auto"}),Ae.rotation=se.rotation)},this),this.tickRotCorr=m.rotCorr($.b,this.labelRotation||0,this.side!==0)}hasData(){return this.series.some(function(n){return n.hasData()})||this.options.showEmpty&&Un(this.min)&&Un(this.max)}addTitle(n){let m,x=this.chart.renderer,S=this.horiz,k=this.opposite,L=this.options.title,R=this.chart.styledMode;this.axisTitle||((m=L.textAlign)||(m=(S?{low:"left",middle:"center",high:"right"}:{low:k?"right":"left",middle:"center",high:k?"left":"right"})[L.align]),this.axisTitle=x.text(L.text||"",0,0,L.useHTML).attr({zIndex:7,rotation:L.rotation||0,align:m}).addClass("highcharts-axis-title"),R||this.axisTitle.css(ou(L.style)),this.axisTitle.add(this.axisGroup),this.axisTitle.isNew=!0),R||L.style.width||this.isRadial||this.axisTitle.css({width:this.len+"px"}),this.axisTitle[n?"show":"hide"](n)}generateTick(n){let m=this.ticks;m[n]?m[n].addLabel():m[n]=new ho(this,n)}createGroups(){let{axisParent:n,chart:m,coll:x,options:S}=this,k=m.renderer,L=(R,N,Y)=>k.g(R).attr({zIndex:Y}).addClass(`highcharts-${x.toLowerCase()}${N} `+(this.isRadial?`highcharts-radial-axis${N} `:"")+(S.className||"")).add(n);this.axisGroup||(this.gridGroup=L("grid","-grid",S.gridZIndex),this.axisGroup=L("axis","",S.zIndex),this.labelGroup=L("axis-labels","-labels",S.labels.zIndex))}getOffset(){let n=this,{chart:m,horiz:x,options:S,side:k,ticks:L,tickPositions:R,coll:N}=n,Y=m.inverted&&!n.isZAxis?[1,0,3,2][k]:k,se=n.hasData(),$=S.title,ee=S.labels,ae=Hr(S.crossing),fe=m.axisOffset,ve=m.clipOffset,Te=[-1,1,1,-1][k],Ae,Ve=0,Ke,Tt=0,St=0,Mt,Nt;if(n.showAxis=Ae=se||S.showEmpty,n.staggerLines=n.horiz&&ee.staggerLines||void 0,n.createGroups(),se||n.isLinked?(R.forEach(function(Rt){n.generateTick(Rt)}),n.renderUnsquish(),n.reserveSpaceDefault=k===0||k===2||{1:"left",3:"right"}[k]===n.labelAlign,Ro(ee.reserveSpace,!ae&&null,n.labelAlign==="center"||null,n.reserveSpaceDefault)&&R.forEach(function(Rt){St=Math.max(L[Rt].getLabelSize(),St)}),n.staggerLines&&(St*=n.staggerLines),n.labelOffset=St*(n.opposite?-1:1)):xp(L,function(Rt,$t){Rt.destroy(),delete L[$t]}),$!=null&&$.text&&$.enabled!==!1&&(n.addTitle(Ae),Ae&&!ae&&$.reserveSpace!==!1&&(n.titleOffset=Ve=n.axisTitle.getBBox()[x?"height":"width"],Tt=Un(Ke=$.offset)?0:Ro($.margin,x?5:10))),n.renderLine(),n.offset=Te*Ro(S.offset,fe[k]?fe[k]+(S.margin||0):0),n.tickRotCorr=n.tickRotCorr||{x:0,y:0},Nt=k===0?-n.labelMetrics().h:k===2?n.tickRotCorr.y:0,Mt=Math.abs(St)+Tt,St&&(Mt-=Nt,Mt+=Te*(x?Ro(ee.y,n.tickRotCorr.y+Te*ee.distance):Ro(ee.x,Te*ee.distance))),n.axisTitleMargin=Ro(Ke,Mt),n.getMaxLabelDimensions&&(n.maxLabelDimensions=n.getMaxLabelDimensions(L,R)),N!=="colorAxis"&&ve){let Rt=this.tickSize("tick");fe[k]=Math.max(fe[k],(n.axisTitleMargin||0)+Ve+Te*n.offset,Mt,R!=null&&R.length&&Rt?Rt[0]+Te*n.offset:0);let $t=!n.axisLine||S.offset?0:n.axisLine.strokeWidth()/2;ve[Y]=Math.max(ve[Y],$t)}sr(this,"afterGetOffset")}getLinePath(n){let m=this.chart,x=this.opposite,S=this.offset,k=this.horiz,L=this.left+(x?this.width:0)+S,R=m.chartHeight-this.bottom-(x?this.height:0)+S;return x&&(n*=-1),m.renderer.crispLine([["M",k?this.left:L,k?R:this.top],["L",k?m.chartWidth-this.right:L,k?R:m.chartHeight-this.bottom]],n)}renderLine(){!this.axisLine&&(this.axisLine=this.chart.renderer.path().addClass("highcharts-axis-line").add(this.axisGroup),this.chart.styledMode||this.axisLine.attr({stroke:this.options.lineColor,"stroke-width":this.options.lineWidth,zIndex:7}))}getTitlePosition(n){let m=this.horiz,x=this.left,S=this.top,k=this.len,L=this.options.title,R=m?x:S,N=this.opposite,Y=this.offset,se=L.x,$=L.y,ee=this.chart.renderer.fontMetrics(n),ae=n?Math.max(n.getBBox(!1,0).height-ee.h-1,0):0,fe={low:R+(m?0:k),middle:R+k/2,high:R+(m?k:0)}[L.align],ve=(m?S+this.height:x)+(m?1:-1)*(N?-1:1)*(this.axisTitleMargin||0)+[-ae,ae,ee.f,-ae][this.side],Te={x:m?fe+se:ve+(N?this.width:0)+Y+se,y:m?ve+$-(N?this.height:0)+Y:fe+$};return sr(this,"afterGetTitlePosition",{titlePosition:Te}),Te}renderMinorTick(n,m){let x=this.minorTicks;x[n]||(x[n]=new ho(this,n,"minor")),m&&x[n].isNew&&x[n].render(null,!0),x[n].render(null,!1,1)}renderTick(n,m,x){var L;let S=this.isLinked,k=this.ticks;(!S||n>=this.min&&n<=this.max||(L=this.grid)!=null&&L.isColumn)&&(k[n]||(k[n]=new ho(this,n)),x&&k[n].isNew&&k[n].render(m,!0,-1),k[n].render(m))}render(){let n,m,x=this,S=x.chart,k=x.logarithmic,L=S.renderer,R=x.options,N=x.isLinked,Y=x.tickPositions,se=x.axisTitle,$=x.ticks,ee=x.minorTicks,ae=x.alternateBands,fe=R.stackLabels,ve=R.alternateGridColor,Te=R.crossing,Ae=x.tickmarkOffset,Ve=x.axisLine,Ke=x.showAxis,Tt=ka(L.globalAnimation);if(x.labelEdge.length=0,x.overlap=!1,[$,ee,ae].forEach(function(St){xp(St,function(Mt){Mt.isActive=!1})}),Hr(Te)){let St=this.isXAxis?S.yAxis[0]:S.xAxis[0],Mt=[1,-1,-1,1][this.side];if(St){let Nt=St.toPixels(Te,!0);x.horiz&&(Nt=St.len-Nt),x.offset=Mt*Nt}}if(x.hasData()||N){let St=x.chart.hasRendered&&x.old&&Hr(x.old.min);x.minorTickInterval&&!x.categories&&x.getMinorTickPositions().forEach(function(Mt){x.renderMinorTick(Mt,St)}),Y.length&&(Y.forEach(function(Mt,Nt){x.renderTick(Mt,Nt,St)}),Ae&&(x.min===0||x.single)&&($[-1]||($[-1]=new ho(x,-1,null,!0)),$[-1].render(-1))),ve&&Y.forEach(function(Mt,Nt){m=Y[Nt+1]!==void 0?Y[Nt+1]+Ae:x.max-Ae,Nt%2==0&&Mt<x.max&&m<=x.max+(S.polar?-Ae:Ae)&&(ae[Mt]||(ae[Mt]=new fi.PlotLineOrBand(x,{})),n=Mt+Ae,ae[Mt].options={from:k?k.lin2log(n):n,to:k?k.lin2log(m):m,color:ve,className:"highcharts-alternate-grid"},ae[Mt].render(),ae[Mt].isActive=!0)}),x._addedPlotLB||(x._addedPlotLB=!0,(R.plotLines||[]).concat(R.plotBands||[]).forEach(function(Mt){x.addPlotBandOrLine(Mt)}))}[$,ee,ae].forEach(function(St){let Mt=[],Nt=Tt.duration;xp(St,function(Rt,$t){Rt.isActive||(Rt.render($t,!1,0),Rt.isActive=!1,Mt.push($t))}),og(function(){let Rt=Mt.length;for(;Rt--;)St[Mt[Rt]]&&!St[Mt[Rt]].isActive&&(St[Mt[Rt]].destroy(),delete St[Mt[Rt]])},St!==ae&&S.hasRendered&&Nt?Nt:0)}),Ve&&(Ve[Ve.isPlaced?"animate":"attr"]({d:this.getLinePath(Ve.strokeWidth())}),Ve.isPlaced=!0,Ve[Ke?"show":"hide"](Ke)),se&&Ke&&(se[se.isNew?"attr":"animate"](x.getTitlePosition(se)),se.isNew=!1),fe!=null&&fe.enabled&&x.stacking&&x.stacking.renderStackTotals(),x.old={len:x.len,max:x.max,min:x.min,transA:x.transA,userMax:x.userMax,userMin:x.userMin},x.isDirty=!1,sr(this,"afterRender")}redraw(){this.visible&&(this.render(),this.plotLinesAndBands.forEach(function(n){n.render()})),this.series.forEach(function(n){n.isDirty=!0})}getKeepProps(){return this.keepProps||nu.keepProps}destroy(n){let m=this,x=m.plotLinesAndBands,S=this.eventOptions;if(sr(this,"destroy",{keepEvents:n}),n||Ku(m),[m.ticks,m.minorTicks,m.alternateBands].forEach(function(k){ln(k)}),x){let k=x.length;for(;k--;)x[k].destroy()}for(let k in["axisLine","axisTitle","axisGroup","gridGroup","labelGroup","cross","scrollbar"].forEach(function(L){m[L]&&(m[L]=m[L].destroy())}),m.plotLinesAndBandsGroups)m.plotLinesAndBandsGroups[k]=m.plotLinesAndBandsGroups[k].destroy();xp(m,function(k,L){m.getKeepProps().indexOf(L)===-1&&delete m[L]}),this.eventOptions=S}drawCrosshair(n,m){var $;let x=this.crosshair,S=(x==null?void 0:x.snap)??!0,k=this.chart,L,R,N,Y=this.cross,se;if(sr(this,"drawCrosshair",{e:n,point:m}),n||(n=($=this.cross)==null?void 0:$.e),x&&(Un(m)||!S)!==!1){if(S?Un(m)&&(R=Ro(this.coll!=="colorAxis"?m.crosshairPos:null,this.isXAxis?m.plotX:this.len-m.plotY)):R=n&&(this.horiz?n.chartX-this.pos:this.len-n.chartY+this.pos),Un(R)&&(se={value:m&&(this.isXAxis?m.x:Ro(m.stackY,m.y)),translatedValue:R},k.polar&&yo(se,{isCrosshair:!0,chartX:n==null?void 0:n.chartX,chartY:n==null?void 0:n.chartY,point:m}),L=this.getPlotLinePath(se)||null),!Un(L))return void this.hideCrosshair();N=this.categories&&!this.isRadial,Y||(this.cross=Y=k.renderer.path().addClass("highcharts-crosshair highcharts-crosshair-"+(N?"category ":"thin ")+(x.className||"")).attr({zIndex:Ro(x.zIndex,2)}).add(),!k.styledMode&&(Y.attr({stroke:x.color||(N?qt.parse("#ccd3ff").setOpacity(.25).get():"#cccccc"),"stroke-width":Ro(x.width,1)}).css({"pointer-events":"none"}),x.dashStyle&&Y.attr({dashstyle:x.dashStyle}))),Y.show().attr({d:L}),N&&!x.width&&Y.attr({"stroke-width":this.transA}),this.cross.e=n}else this.hideCrosshair();sr(this,"afterDrawCrosshair",{e:n,point:m})}hideCrosshair(){this.cross&&this.cross.hide(),sr(this,"afterHideCrosshair")}update(n,m){let x=this.chart;n=ou(this.userOptions,n),this.destroy(!0),this.init(x,n),x.isDirtyBox=!0,Ro(m,!0)&&x.redraw()}remove(n){let m=this.chart,x=this.coll,S=this.series,k=S.length;for(;k--;)S[k]&&S[k].remove(!1);oc(m.axes,this),oc(m[x]||[],this),m.orderItems(x),this.destroy(),m.isDirtyBox=!0,Ro(n,!0)&&m.redraw()}setTitle(n,m){this.update({title:n},m)}setCategories(n,m){this.update({categories:n},m)}}nu.keepProps=["coll","extKey","hcEvents","len","names","series","userMax","userMin"];let{addEvent:Ld,getMagnitude:Cm,normalizeTickInterval:Pm,timeUnits:Kf}=Gs;(function(H){function n(){return this.chart.time.getTimeTicks.apply(this.chart.time,arguments)}function m(){if(this.type!=="datetime"){this.dateTime=void 0;return}this.dateTime||(this.dateTime=new x(this))}H.compose=function(S){return S.keepProps.includes("dateTime")||(S.keepProps.push("dateTime"),S.prototype.getTimeTicks=n,Ld(S,"afterSetType",m)),S};class x{constructor(k){this.axis=k}normalizeTimeTickInterval(k,L){let R=L||[["millisecond",[1,2,5,10,20,25,50,100,200,500]],["second",[1,2,5,10,15,30]],["minute",[1,2,5,10,15,30]],["hour",[1,2,3,4,6,8,12]],["day",[1,2]],["week",[1,2]],["month",[1,2,3,4,6]],["year",null]],N=R[R.length-1],Y=Kf[N[0]],se=N[1],$;for($=0;$<R.length&&(Y=Kf[(N=R[$])[0]],se=N[1],!R[$+1]||!(k<=(Y*se[se.length-1]+Kf[R[$+1][0]])/2));$++);Y===Kf.year&&k<5*Y&&(se=[1,2,5]);let ee=Pm(k/Y,se,N[0]==="year"?Math.max(Cm(k/Y),1):1);return{unitRange:Y,count:ee,unitName:N[0]}}getXDateFormat(k,L){let{axis:R}=this,N=R.chart.time;return R.closestPointRange?N.getDateFormat(R.closestPointRange,k,R.options.startOfWeek,L)||N.resolveDTLFormat(L.year).main:N.resolveDTLFormat(L.day).main}}H.Additions=x})(xs||(xs={}));let Im=xs,{addEvent:gf,normalizeTickInterval:jc,pick:Jf}=Gs;(function(H){function n(){this.type!=="logarithmic"?this.logarithmic=void 0:this.logarithmic??(this.logarithmic=new x(this))}function m(){let S=this.logarithmic;S&&(this.lin2val=function(k){return S.lin2log(k)},this.val2lin=function(k){return S.log2lin(k)})}H.compose=function(S){return S.keepProps.includes("logarithmic")||(S.keepProps.push("logarithmic"),gf(S,"afterSetType",n),gf(S,"afterInit",m)),S};class x{constructor(k){this.axis=k}getLogTickPositions(k,L,R,N){let Y=this.axis,se=Y.len,$=Y.options,ee=[];if(N||(this.minorAutoInterval=void 0),k>=.5)k=Math.round(k),ee=Y.getLinearTickPositions(k,L,R);else if(k>=.08){let ae,fe,ve,Te,Ae,Ve,Ke,Tt=Math.floor(L);for(ae=k>.3?[1,2,4]:k>.15?[1,2,4,6,8]:[1,2,3,4,5,6,7,8,9],fe=Tt;fe<R+1&&!Ke;fe++)for(ve=0,Te=ae.length;ve<Te&&!Ke;ve++)(Ae=this.log2lin(this.lin2log(fe)*ae[ve]))>L&&(!N||Ve<=R)&&Ve!==void 0&&ee.push(Ve),Ve>R&&(Ke=!0),Ve=Ae}else{let ae=this.lin2log(L),fe=this.lin2log(R),ve=N?Y.getMinorTickInterval():$.tickInterval,Te=$.tickPixelInterval/(N?5:1),Ae=N?se/Y.tickPositions.length:se;k=jc(k=Jf(ve==="auto"?null:ve,this.minorAutoInterval,(fe-ae)*Te/(Ae||1))),ee=Y.getLinearTickPositions(k,ae,fe).map(this.log2lin),N||(this.minorAutoInterval=k/5)}return N||(Y.tickInterval=k),ee}lin2log(k){return Math.pow(10,k)}log2lin(k){return Math.log(k)/Math.LN10}}H.Additions=x})(zs||(zs={}));let Ou=zs,{erase:Lm,extend:Qf,isNumber:em}=Gs;(function(H){let n;function m(Y){return this.addPlotBandOrLine(Y,"plotBands")}function x(Y,se){let $=this.userOptions,ee=new n(this,Y);if(this.visible&&(ee=ee.render()),ee){if(this._addedPlotLB||(this._addedPlotLB=!0,($.plotLines||[]).concat($.plotBands||[]).forEach(ae=>{this.addPlotBandOrLine(ae)})),se){let ae=$[se]||[];ae.push(Y),$[se]=ae}this.plotLinesAndBands.push(ee)}return ee}function S(Y){return this.addPlotBandOrLine(Y,"plotLines")}function k(Y,se,$){$=$||this.options;let ee=this.getPlotLinePath({value:se,force:!0,acrossPanes:$.acrossPanes}),ae=[],fe=this.horiz,ve=!em(this.min)||!em(this.max)||Y<this.min&&se<this.min||Y>this.max&&se>this.max,Te=this.getPlotLinePath({value:Y,force:!0,acrossPanes:$.acrossPanes}),Ae,Ve=1,Ke;if(Te&&ee)for(ve&&(Ke=Te.toString()===ee.toString(),Ve=0),Ae=0;Ae<Te.length;Ae+=2){let Tt=Te[Ae],St=Te[Ae+1],Mt=ee[Ae],Nt=ee[Ae+1];(Tt[0]==="M"||Tt[0]==="L")&&(St[0]==="M"||St[0]==="L")&&(Mt[0]==="M"||Mt[0]==="L")&&(Nt[0]==="M"||Nt[0]==="L")&&(fe&&Mt[1]===Tt[1]?(Mt[1]+=Ve,Nt[1]+=Ve):fe||Mt[2]!==Tt[2]||(Mt[2]+=Ve,Nt[2]+=Ve),ae.push(["M",Tt[1],Tt[2]],["L",St[1],St[2]],["L",Nt[1],Nt[2]],["L",Mt[1],Mt[2]],["Z"])),ae.isFlat=Ke}return ae}function L(Y){this.removePlotBandOrLine(Y)}function R(Y){let se=this.plotLinesAndBands,$=this.options,ee=this.userOptions;if(se){let ae=se.length;for(;ae--;)se[ae].id===Y&&se[ae].destroy();[$.plotLines||[],ee.plotLines||[],$.plotBands||[],ee.plotBands||[]].forEach(function(fe){var ve;for(ae=fe.length;ae--;)((ve=fe[ae])==null?void 0:ve.id)===Y&&Lm(fe,fe[ae])})}}function N(Y){this.removePlotBandOrLine(Y)}H.compose=function(Y,se){let $=se.prototype;return $.addPlotBand||(n=Y,Qf($,{addPlotBand:m,addPlotLine:S,addPlotBandOrLine:x,getPlotBandPath:k,removePlotBand:L,removePlotLine:N,removePlotBandOrLine:R})),se}})(hs||(hs={}));let Du=hs,{addEvent:Bl,arrayMax:tm,arrayMin:dh,defined:Gc,destroyObjectProperties:Ju,erase:Hp,fireEvent:Qu,merge:ep,objectEach:im,pick:Od}=Gs;class au{static compose(n,m){return Bl(n,"afterInit",function(){this.labelCollectors.push(()=>{var S;let x=[];for(let k of this.axes)for(let{label:L,options:R}of k.plotLinesAndBands)L&&!((S=R==null?void 0:R.label)!=null&&S.allowOverlap)&&x.push(L);return x})}),Du.compose(au,m)}constructor(n,m){this.axis=n,this.options=m,this.id=m.id}render(){Qu(this,"render");let{axis:n,options:m}=this,{horiz:x,logarithmic:S}=n,{color:k,events:L,zIndex:R=0}=m,{renderer:N,time:Y}=n.chart,se={},$=Y.parse(m.to),ee=Y.parse(m.from),ae=Y.parse(m.value),fe=m.borderWidth,ve=m.label,{label:Te,svgElem:Ae}=this,Ve=[],Ke,Tt=Gc(ee)&&Gc($),St=Gc(ae),Mt=!Ae,Nt={class:"highcharts-plot-"+(Tt?"band ":"line ")+(m.className||"")},Rt=Tt?"bands":"lines";if(!n.chart.styledMode&&(St?(Nt.stroke=k||"#999999",Nt["stroke-width"]=Od(m.width,1),m.dashStyle&&(Nt.dashstyle=m.dashStyle)):Tt&&(Nt.fill=k||"#e6e9ff",fe&&(Nt.stroke=m.borderColor,Nt["stroke-width"]=fe))),se.zIndex=R,Rt+="-"+R,(Ke=n.plotLinesAndBandsGroups[Rt])||(n.plotLinesAndBandsGroups[Rt]=Ke=N.g("plot-"+Rt).attr(se).add()),Ae||(this.svgElem=Ae=N.path().attr(Nt).add(Ke)),Gc(ae))Ve=n.getPlotLinePath({value:(S==null?void 0:S.log2lin(ae))??ae,lineWidth:Ae.strokeWidth(),acrossPanes:m.acrossPanes});else{if(!(Gc(ee)&&Gc($)))return;Ve=n.getPlotBandPath((S==null?void 0:S.log2lin(ee))??ee,(S==null?void 0:S.log2lin($))??$,m)}return!this.eventsAdded&&L&&(im(L,($t,Ti)=>{Ae==null||Ae.on(Ti,hi=>{L[Ti].apply(this,[hi])})}),this.eventsAdded=!0),(Mt||!Ae.d)&&(Ve!=null&&Ve.length)?Ae.attr({d:Ve}):Ae&&(Ve?(Ae.show(),Ae.animate({d:Ve})):Ae.d&&(Ae.hide(),Te&&(this.label=Te=Te.destroy()))),ve&&(Gc(ve.text)||Gc(ve.formatter))&&(Ve!=null&&Ve.length)&&n.width>0&&n.height>0&&!Ve.isFlat?(ve=ep({align:x&&Tt?"center":void 0,x:x?!Tt&&4:10,verticalAlign:!x&&Tt?"middle":void 0,y:x?Tt?16:10:Tt?6:-4,rotation:x&&!Tt?90:0,...Tt?{inside:!0}:{}},ve),this.renderLabel(ve,Ve,Tt,R)):Te&&Te.hide(),this}renderLabel(n,m,x,S){var fe,ve;let k=this.axis,L=k.chart.renderer,R=n.inside,N=this.label;N||(this.label=N=L.text(this.getLabelText(n),0,0,n.useHTML).attr({align:n.textAlign||n.align,rotation:n.rotation,class:"highcharts-plot-"+(x?"band":"line")+"-label "+(n.className||""),zIndex:S}),k.chart.styledMode||N.css(ep({color:(fe=k.chart.options.title)==null?void 0:fe.style.color,fontSize:"0.8em",textOverflow:x&&!R?"":"ellipsis"},n.style)),N.add());let Y=m.xBounds||[m[0][1],m[1][1],x?m[2][1]:m[0][1]],se=m.yBounds||[m[0][2],m[1][2],x?m[2][2]:m[0][2]],$=dh(Y),ee=dh(se),ae=tm(Y)-$;N.align(n,!1,{x:$,y:ee,width:ae,height:tm(se)-ee}),N.alignAttr.y-=L.fontMetrics(N).b,(!N.alignValue||N.alignValue==="left"||Gc(R))&&N.css({width:(((ve=n.style)==null?void 0:ve.width)||(x&&R?ae:N.rotation===90?k.height-(N.alignAttr.y-k.top):(n.clip?k.width:k.chart.chartWidth)-(N.alignAttr.x-k.left)))+"px"}),N.show(!0)}getLabelText(n){return Gc(n.formatter)?n.formatter.call(this):n.text}destroy(){Hp(this.axis.plotLinesAndBands,this),delete this.axis,Ju(this)}}let{animObject:sm}=Oo,{format:Xp}=ja,{composed:rm,dateFormats:yf,doc:ld,isSafari:zu}=fi,{distribute:ng}=Gr,{addEvent:ag,clamp:Yp,css:Lh,discardElement:lg,extend:$p,fireEvent:xf,getAlignFactor:_f,isArray:Oh,isNumber:om,isObject:Ru,isString:vf,merge:lu,pick:ac,pushUnique:qp,splat:lc,syncTimeout:vp}=Gs;class bp{constructor(n,m,x){this.allowShared=!0,this.crosshairs=[],this.distance=0,this.isHidden=!0,this.isSticky=!1,this.options={},this.outside=!1,this.chart=n,this.init(n,m),this.pointer=x}bodyFormatter(n){return n.map(m=>{let x=m.series.tooltipOptions,S=m.formatPrefix||"point";return(x[S+"Formatter"]||m.tooltipFormatter).call(m,x[S+"Format"]||"")})}cleanSplit(n){this.chart.series.forEach(function(m){let x=m==null?void 0:m.tt;x&&(!x.isActive||n?m.tt=x.destroy():x.isActive=!1)})}defaultFormatter(n){let m,x=this.points||lc(this);return(m=(m=[n.headerFooterFormatter(x[0])]).concat(n.bodyFormatter(x))).push(n.headerFooterFormatter(x[0],!0)),m}destroy(){this.label&&(this.label=this.label.destroy()),this.split&&(this.cleanSplit(!0),this.tt&&(this.tt=this.tt.destroy())),this.renderer&&(this.renderer=this.renderer.destroy(),lg(this.container)),Gs.clearTimeout(this.hideTimer)}getAnchor(n,m){var se;let x,{chart:S,pointer:k}=this,L=S.inverted,R=S.plotTop,N=S.plotLeft;if(n=lc(n),(se=n[0].series)!=null&&se.yAxis&&!n[0].series.yAxis.options.reversedStacks&&(n=n.slice().reverse()),this.followPointer&&m)m.chartX===void 0&&(m=k.normalize(m)),x=[m.chartX-N,m.chartY-R];else if(n[0].tooltipPos)x=n[0].tooltipPos;else{let $=0,ee=0;n.forEach(function(ae){let fe=ae.pos(!0);fe&&($+=fe[0],ee+=fe[1])}),$/=n.length,ee/=n.length,this.shared&&n.length>1&&m&&(L?$=m.chartX:ee=m.chartY),x=[$-N,ee-R]}let Y={point:n[0],ret:x};return xf(this,"getAnchor",Y),Y.ret.map(Math.round)}getClassName(n,m,x){let S=this.options,k=n.series,L=k.options;return[S.className,"highcharts-label",x&&"highcharts-tooltip-header",m?"highcharts-tooltip-box":"highcharts-tooltip",!x&&"highcharts-color-"+ac(n.colorIndex,k.colorIndex),L==null?void 0:L.className].filter(vf).join(" ")}getLabel({anchorX:n,anchorY:m}={anchorX:0,anchorY:0}){let x=this,S=this.chart.styledMode,k=this.options,L=this.split&&this.allowShared,R=this.container,N=this.chart.renderer;if(this.label){let Y=!this.label.hasClass("highcharts-label");(!L&&Y||L&&!Y)&&this.destroy()}if(!this.label){if(this.outside){let Y=this.chart,se=Y.options.chart.style,$=Bn.getRendererType();this.container=R=fi.doc.createElement("div"),R.className="highcharts-tooltip-container "+(Y.renderTo.className.match(/(highcharts[a-zA-Z0-9-]+)\s?/gm)||""),Lh(R,{position:"absolute",top:"1px",pointerEvents:"none",zIndex:Math.max(this.options.style.zIndex||0,((se==null?void 0:se.zIndex)||0)+3)}),this.renderer=N=new $(R,0,0,se,void 0,void 0,N.styledMode)}if(L?this.label=N.g("tooltip"):(this.label=N.label("",n,m,k.shape||"callout",void 0,void 0,k.useHTML,void 0,"tooltip").attr({padding:k.padding,r:k.borderRadius}),S||this.label.attr({fill:k.backgroundColor,"stroke-width":k.borderWidth||0}).css(k.style).css({pointerEvents:k.style.pointerEvents||(this.shouldStickOnContact()?"auto":"none")})),x.outside){let Y=this.label;[Y.xSetter,Y.ySetter].forEach((se,$)=>{Y[$?"ySetter":"xSetter"]=ee=>{se.call(Y,x.distance),Y[$?"y":"x"]=ee,R&&(R.style[$?"top":"left"]=`${ee}px`)}})}this.label.attr({zIndex:8}).shadow(k.shadow??!k.fixed).add()}return R&&!R.parentElement&&fi.doc.body.appendChild(R),this.label}getPlayingField(){let{body:n,documentElement:m}=ld,{chart:x,distance:S,outside:k}=this;return{width:k?Math.max(n.scrollWidth,m.scrollWidth,n.offsetWidth,m.offsetWidth,m.clientWidth)-2*S-2:x.chartWidth,height:k?Math.max(n.scrollHeight,m.scrollHeight,n.offsetHeight,m.offsetHeight,m.clientHeight):x.chartHeight}}getPosition(n,m,x){var Is,Hs;let{distance:S,chart:k,outside:L,pointer:R}=this,{inverted:N,plotLeft:Y,plotTop:se,polar:$}=k,{plotX:ee=0,plotY:ae=0}=x,fe={},ve=N&&x.h||0,{height:Te,width:Ae}=this.getPlayingField(),Ve=R.getChartPosition(),Ke=qs=>qs*Ve.scaleX,Tt=qs=>qs*Ve.scaleY,St=qs=>{let dr=qs==="x";return[qs,dr?Ae:Te,dr?n:m].concat(L?[dr?Ke(n):Tt(m),dr?Ve.left-S+Ke(ee+Y):Ve.top-S+Tt(ae+se),0,dr?Ae:Te]:[dr?n:m,dr?ee+Y:ae+se,dr?Y:se,dr?Y+k.plotWidth:se+k.plotHeight])},Mt=St("y"),Nt=St("x"),Rt,$t=!!x.negative;!$&&((Hs=(Is=k.hoverSeries)==null?void 0:Is.yAxis)!=null&&Hs.reversed)&&($t=!$t);let Ti=!this.followPointer&&ac(x.ttBelow,!$&&!N===$t),hi=function(qs,dr,xr,wr,io,sl,Wo){let qo=L?qs==="y"?Tt(S):Ke(S):S,ko=(xr-wr)/2,no=wr<io-S,$a=io+S+wr<dr,Fa=io-qo-xr+ko,ul=io+qo-ko;if(Ti&&$a)fe[qs]=ul;else if(!Ti&&no)fe[qs]=Fa;else if(no)fe[qs]=Math.min(Wo-wr,Fa-ve<0?Fa:Fa-ve);else{if(!$a)return fe[qs]=0,!1;fe[qs]=Math.max(sl,ul+ve+xr>dr?ul:ul+ve)}},Ei=function(qs,dr,xr,wr,io){if(io<S||io>dr-S)return!1;io<xr/2?fe[qs]=1:io>dr-wr/2?fe[qs]=dr-wr-2:fe[qs]=io-xr/2},Ji=function(qs){[Mt,Nt]=[Nt,Mt],Rt=qs},er=()=>{hi.apply(0,Mt)!==!1?Ei.apply(0,Nt)!==!1||Rt||(Ji(!0),er()):Rt?fe.x=fe.y=0:(Ji(!0),er())};return(N&&!$||this.len>1)&&Ji(),er(),fe}getFixedPosition(n,m,x){var ee;let S=x.series,{chart:k,options:L,split:R}=this,N=L.position,Y=N.relativeTo,se=L.shared||(ee=S==null?void 0:S.yAxis)!=null&&ee.isRadial&&(Y==="pane"||!Y)?"plotBox":Y,$=se==="chart"?k.renderer:k[se]||k.getClipBox(S,!0);return{x:$.x+($.width-n)*_f(N.align)+N.x,y:$.y+($.height-m)*_f(N.verticalAlign)+(!R&&N.y||0)}}hide(n){let m=this;Gs.clearTimeout(this.hideTimer),n=ac(n,this.options.hideDelay),this.isHidden||(this.hideTimer=vp(function(){let x=m.getLabel();m.getLabel().animate({opacity:0},{duration:n&&150,complete:()=>{x.hide(),m.container&&m.container.remove()}}),m.isHidden=!0},n))}init(n,m){this.chart=n,this.options=m,this.crosshairs=[],this.isHidden=!0,this.split=m.split&&!n.inverted&&!n.polar,this.shared=m.shared||this.split,this.outside=ac(m.outside,!!(n.scrollablePixelsX||n.scrollablePixelsY))}shouldStickOnContact(n){return!!(!this.followPointer&&this.options.stickOnContact&&(!n||this.pointer.inClass(n.target,"highcharts-tooltip")))}move(n,m,x,S){let{followPointer:k,options:L}=this,R=sm(!k&&!this.isHidden&&!L.fixed&&L.animation),N=k||(this.len||0)>1,Y={x:n,y:m};N?Y.anchorX=Y.anchorY=NaN:(Y.anchorX=x,Y.anchorY=S),R.step=()=>this.drawTracker(),this.getLabel().animate(Y,R)}refresh(n,m){let{chart:x,options:S,pointer:k,shared:L}=this,R=lc(n),N=R[0],Y=S.format,se=S.formatter||this.defaultFormatter,$=x.styledMode,ee=this.allowShared;if(!S.enabled||!N.series)return;Gs.clearTimeout(this.hideTimer),this.allowShared=!(!Oh(n)&&n.series&&n.series.noSharedTooltip),ee=ee&&!this.allowShared,this.followPointer=!this.split&&N.series.tooltipOptions.followPointer;let ae=this.getAnchor(n,m),fe=ae[0],ve=ae[1];L&&this.allowShared&&(k.applyInactiveState(R),R.forEach(Ve=>Ve.setState("hover")),N.points=R),this.len=R.length;let Te=vf(Y)?Xp(Y,N,x):se.call(N,this);N.points=void 0;let Ae=N.series;if(this.distance=ac(Ae.tooltipOptions.distance,16),Te===!1)this.hide();else{if(this.split&&this.allowShared)this.renderSplit(Te,R);else{let Ve=fe,Ke=ve;if(m&&k.isDirectTouch&&(Ve=m.chartX-x.plotLeft,Ke=m.chartY-x.plotTop),!(x.polar||Ae.options.clip===!1||R.some(Tt=>k.isDirectTouch||Tt.series.shouldShowTooltip(Ve,Ke))))return void this.hide();{let Tt=this.getLabel(ee&&this.tt||{});(!S.style.width||$)&&Tt.css({width:(this.outside?this.getPlayingField():x.spacingBox).width+"px"}),Tt.attr({class:this.getClassName(N),text:Te&&Te.join?Te.join(""):Te}),this.outside&&Tt.attr({x:Yp(Tt.x||0,0,this.getPlayingField().width-(Tt.width||0)-1)}),$||Tt.attr({stroke:S.borderColor||N.color||Ae.color||"#666666"}),this.updatePosition({plotX:fe,plotY:ve,negative:N.negative,ttBelow:N.ttBelow,series:Ae,h:ae[2]||0})}}this.isHidden&&this.label&&this.label.attr({opacity:1}).show(),this.isHidden=!1}xf(this,"refresh")}renderSplit(n,m){var io,sl;let x=this,{chart:S,chart:{chartWidth:k,chartHeight:L,plotHeight:R,plotLeft:N,plotTop:Y,scrollablePixelsY:se=0,scrollablePixelsX:$,styledMode:ee},distance:ae,options:fe,options:{fixed:ve,position:Te,positioner:Ae},pointer:Ve}=x,{scrollLeft:Ke=0,scrollTop:Tt=0}=((io=S.scrollablePlotArea)==null?void 0:io.scrollingContainer)||{},St=x.outside&&typeof $!="number"?ld.documentElement.getBoundingClientRect():{left:Ke,right:Ke+k},Mt=x.getLabel(),Nt=this.renderer||S.renderer,Rt=!!((sl=S.xAxis[0])!=null&&sl.opposite),{left:$t,top:Ti}=Ve.getChartPosition(),hi=Ae||ve,Ei=Y+Tt,Ji=0,er=R-se,Is=function(Wo,qo,ko,no=[0,0],$a=!0){let Fa,ul;if(ko.isHeader)ul=Rt?0:er,Fa=Yp(no[0]-Wo/2,St.left,St.right-Wo-(x.outside?$t:0));else if(ve&&ko){let Zc=x.getFixedPosition(Wo,qo,ko);Fa=Zc.x,ul=Zc.y-Ei}else ul=no[1]-Ei,Fa=Yp(Fa=$a?no[0]-Wo-ae:no[0]+ae,$a?Fa:St.left,St.right);return{x:Fa,y:ul}};vf(n)&&(n=[!1,n]);let Hs=n.slice(0,m.length+1).reduce(function(Wo,qo,ko){if(qo!==!1&&qo!==""){let no=m[ko-1]||{isHeader:!0,plotX:m[0].plotX,plotY:R,series:{}},$a=no.isHeader,Fa=$a?x:no.series,ul=Fa.tt=function(bd,nh,ax){let Km=bd,{isHeader:Dy,series:$x}=nh,Mm=$x.tooltipOptions||fe;if(!Km){let lx={padding:Mm.padding,r:Mm.borderRadius};ee||(lx.fill=Mm.backgroundColor,lx["stroke-width"]=Mm.borderWidth??(ve&&!Dy?0:1)),Km=Nt.label("",0,0,Mm[Dy?"headerShape":"shape"]||(ve&&!Dy?"rect":"callout"),void 0,void 0,Mm.useHTML).addClass(x.getClassName(nh,!0,Dy)).attr(lx).add(Mt)}return Km.isActive=!0,Km.attr({text:ax}),ee||Km.css(Mm.style).attr({stroke:Mm.borderColor||nh.color||$x.color||"#333333"}),Km}(Fa.tt,no,qo.toString()),Zc=ul.getBBox(),Sm=Zc.width+ul.strokeWidth();$a&&(Ji=Zc.height,er+=Ji,Rt&&(Ei-=Ji));let{anchorX:Uf,anchorY:vu}=function(bd){let nh,ax,{isHeader:Km,plotX:Dy=0,plotY:$x=0,series:Mm}=bd;if(Km)nh=Math.max(N+Dy,N),ax=Y+R/2;else{let{xAxis:lx,yAxis:d0}=Mm;nh=lx.pos+Yp(Dy,-ae,lx.len+ae),Mm.shouldShowTooltip(0,d0.pos-Y+$x,{ignoreX:!0})&&(ax=d0.pos+$x)}return{anchorX:nh=Yp(nh,St.left-ae,St.right+ae),anchorY:ax}}(no);if(typeof vu=="number"){let bd=Zc.height+1,nh=(Ae||Is).call(x,Sm,bd,no,[Uf,vu]);Wo.push({align:hi?0:void 0,anchorX:Uf,anchorY:vu,boxWidth:Sm,point:no,rank:ac(nh.rank,+!!$a),size:bd,target:nh.y,tt:ul,x:nh.x})}else ul.isActive=!1}return Wo},[]);!hi&&Hs.some(Wo=>{let{outside:qo}=x,ko=(qo?$t:0)+Wo.anchorX;return ko<St.left&&ko+Wo.boxWidth<St.right||ko<$t-St.left+Wo.boxWidth&&St.right-ko>ko})&&(Hs=Hs.map(Wo=>{let{x:qo,y:ko}=Is.call(this,Wo.boxWidth,Wo.size,Wo.point,[Wo.anchorX,Wo.anchorY],!1);return $p(Wo,{target:ko,x:qo})})),x.cleanSplit(),ng(Hs,er);let qs={left:$t,right:$t};Hs.forEach(function(Wo){let{x:qo,boxWidth:ko,isHeader:no}=Wo;!no&&(x.outside&&$t+qo<qs.left&&(qs.left=$t+qo),!no&&x.outside&&qs.left+ko>qs.right&&(qs.right=$t+qo))}),Hs.forEach(function(Wo){let{x:qo,anchorX:ko,anchorY:no,pos:$a,point:{isHeader:Fa}}=Wo,ul={visibility:$a===void 0?"hidden":"inherit",x:qo,y:($a||0)+Ei+(ve&&Te.y||0),anchorX:ko,anchorY:no};if(x.outside&&qo<ko){let Zc=$t-qs.left;Zc>0&&(Fa||(ul.x=qo+Zc,ul.anchorX=ko+Zc),Fa&&(ul.x=(qs.right-qs.left)/2,ul.anchorX=ko+Zc))}Wo.tt.attr(ul)});let{container:dr,outside:xr,renderer:wr}=x;if(xr&&dr&&wr){let{width:Wo,height:qo,x:ko,y:no}=Mt.getBBox();wr.setSize(Wo+ko,qo+no,!1),dr.style.left=qs.left+"px",dr.style.top=Ti+"px"}zu&&Mt.attr({opacity:Mt.opacity===1?.999:1})}drawTracker(){if(!this.shouldStickOnContact()){this.tracker&&(this.tracker=this.tracker.destroy());return}let n=this.chart,m=this.label,x=this.shared?n.hoverPoints:n.hoverPoint;if(!m||!x)return;let S={x:0,y:0,width:0,height:0},k=this.getAnchor(x),L=m.getBBox();k[0]+=n.plotLeft-(m.translateX||0),k[1]+=n.plotTop-(m.translateY||0),S.x=Math.min(0,k[0]),S.y=Math.min(0,k[1]),S.width=k[0]<0?Math.max(Math.abs(k[0]),L.width-k[0]):Math.max(Math.abs(k[0]),L.width),S.height=k[1]<0?Math.max(Math.abs(k[1]),L.height-Math.abs(k[1])):Math.max(Math.abs(k[1]),L.height),this.tracker?this.tracker.attr(S):(this.tracker=m.renderer.rect(S).addClass("highcharts-tracker").add(m),n.styledMode||this.tracker.attr({fill:"rgba(0,0,0,0)"}))}styledModeFormat(n){return n.replace('style="font-size: 0.8em"','class="highcharts-header"').replace(/style="color:{(point|series)\.color}"/g,'class="highcharts-color-{$1.colorIndex} {series.options.className} {point.options.className}"')}headerFooterFormatter(n,m){let x=n.series,S=x.tooltipOptions,k=x.xAxis,L=k==null?void 0:k.dateTime,R={isFooter:m,point:n},N=S.xDateFormat||"",Y=S[m?"footerFormat":"headerFormat"];return xf(this,"headerFormatter",R,function(se){if(L&&!N&&om(n.key)&&(N=L.getXDateFormat(n.key,S.dateTimeLabelFormats)),L&&N){if(Ru(N)){let $=N;yf[0]=ee=>x.chart.time.dateFormat($,ee),N="%0"}(n.tooltipDateKeys||["key"]).forEach($=>{Y=Y.replace(RegExp("point\\."+$+"([ \\)}])"),`(point.${$}:${N})$1`)})}x.chart.styledMode&&(Y=this.styledModeFormat(Y)),se.text=Xp(Y,n,this.chart)}),R.text||""}update(n){this.destroy(),this.init(this.chart,lu(!0,this.options,n))}updatePosition(n){var St;let{chart:m,container:x,distance:S,options:k,pointer:L,renderer:R}=this,{height:N=0,width:Y=0}=this.getLabel(),{fixed:se,positioner:$}=k,{left:ee,top:ae,scaleX:fe,scaleY:ve}=L.getChartPosition(),Te=($||se&&this.getFixedPosition||this.getPosition).call(this,Y,N,n),Ae=fi.doc,Ve=(n.plotX||0)+m.plotLeft,Ke=(n.plotY||0)+m.plotTop,Tt;if(R&&x){if($||se){let{scrollLeft:Mt=0,scrollTop:Nt=0}=((St=m.scrollablePlotArea)==null?void 0:St.scrollingContainer)||{};Te.x+=Mt+ee-S,Te.y+=Nt+ae-S}Tt=(k.borderWidth||0)+2*S+2,R.setSize(Yp(Y+Tt,0,Ae.documentElement.clientWidth)-1,N+Tt,!1),(fe!==1||ve!==1)&&(Lh(x,{transform:`scale(${fe}, ${ve})`}),Ve*=fe,Ke*=ve),Ve+=ee-Te.x,Ke+=ae-Te.y}this.move(Math.round(Te.x),Math.round(Te.y||0),Ve,Ke)}}(function(H){H.compose=function(n){qp(rm,"Core.Tooltip")&&ag(n,"afterInit",function(){let m=this.chart;m.options.tooltip&&(m.tooltip=new H(m,m.options.tooltip,this))})}})(bp||(bp={}));let nm=bp,{animObject:Om}=Oo,{defaultOptions:hd}=ei,{format:Bu}=ja,{addEvent:Zp,crisp:Wc,erase:cd,extend:bf,fireEvent:Dm,getNestedProperty:_h,isArray:bn,isFunction:wp,isNumber:Ge,isObject:J,merge:ge,pick:xe,syncTimeout:Ie,removeEvent:je,uniqueKey:Ye}=Gs;class mt{animateBeforeDestroy(){let n=this,m={x:n.startXPos,opacity:0},x=n.getGraphicalProps();x.singular.forEach(function(S){n[S]=n[S].animate(S==="dataLabel"?{x:n[S].startXPos,y:n[S].startYPos,opacity:0}:m)}),x.plural.forEach(function(S){n[S].forEach(function(k){k.element&&k.animate(bf({x:n.startXPos},k.startYPos?{x:k.startXPos,y:k.startYPos}:{}))})})}applyOptions(n,m){let x=this.series,S=x.options.pointValKey||x.pointValKey;return bf(this,n=mt.prototype.optionsToObject.call(this,n)),this.options=this.options?bf(this.options,n):n,n.group&&delete this.group,n.dataLabels&&delete this.dataLabels,S&&(this.y=mt.prototype.getNestedProperty.call(this,S)),this.selected&&(this.state="select"),"name"in this&&m===void 0&&x.xAxis&&x.xAxis.hasNames&&(this.x=x.xAxis.nameToX(this)),this.x===void 0&&x?this.x=m??x.autoIncrement():Ge(n.x)&&x.options.relativeXValue?this.x=x.autoIncrement(n.x):typeof this.x=="string"&&(m??(m=x.chart.time.parse(this.x)),Ge(m)&&(this.x=m)),this.isNull=this.isValid&&!this.isValid(),this.formatPrefix=this.isNull?"null":"point",this}destroy(){if(!this.destroyed){let n=this,m=n.series,x=m.chart,S=m.options.dataSorting,k=x.hoverPoints,L=Om(n.series.chart.renderer.globalAnimation),R=()=>{for(let N in(n.graphic||n.graphics||n.dataLabel||n.dataLabels)&&(je(n),n.destroyElements()),n)delete n[N]};n.legendItem&&x.legend.destroyItem(n),k&&(n.setState(),cd(k,n),k.length||(x.hoverPoints=null)),n===x.hoverPoint&&n.onMouseOut(),S!=null&&S.enabled?(this.animateBeforeDestroy(),Ie(R,L.duration)):R(),x.pointCount--}this.destroyed=!0}destroyElements(n){let m=this,x=m.getGraphicalProps(n);x.singular.forEach(function(S){m[S]=m[S].destroy()}),x.plural.forEach(function(S){m[S].forEach(function(k){k!=null&&k.element&&k.destroy()}),delete m[S]})}firePointEvent(n,m,x){let S=this,k=this.series.options;S.manageEvent(n),n==="click"&&k.allowPointSelect&&(x=function(L){!S.destroyed&&S.select&&S.select(null,L.ctrlKey||L.metaKey||L.shiftKey)}),Dm(S,n,m,x)}getClassName(){var n;return"highcharts-point"+(this.selected?" highcharts-point-select":"")+(this.negative?" highcharts-negative":"")+(this.isNull?" highcharts-null-point":"")+(this.colorIndex!==void 0?" highcharts-color-"+this.colorIndex:"")+(this.options.className?" "+this.options.className:"")+((n=this.zone)!=null&&n.className?" "+this.zone.className.replace("highcharts-negative",""):"")}getGraphicalProps(n){let m,x,S=this,k=[],L={singular:[],plural:[]};for((n=n||{graphic:1,dataLabel:1}).graphic&&k.push("graphic","connector"),n.dataLabel&&k.push("dataLabel","dataLabelPath","dataLabelUpper"),x=k.length;x--;)S[m=k[x]]&&L.singular.push(m);return["graphic","dataLabel"].forEach(function(R){let N=R+"s";n[R]&&S[N]&&L.plural.push(N)}),L}getNestedProperty(n){if(n)return n.indexOf("custom.")===0?_h(n,this.options):this[n]}getZone(){let n=this.series,m=n.zones,x=n.zoneAxis||"y",S,k=0;for(S=m[0];this[x]>=S.value;)S=m[++k];return this.nonZonedColor||(this.nonZonedColor=this.color),S!=null&&S.color&&!this.options.color?this.color=S.color:this.color=this.nonZonedColor,S}hasNewShapeType(){return(this.graphic&&(this.graphic.symbolName||this.graphic.element.nodeName))!==this.shapeType}constructor(n,m,x){this.formatPrefix="point",this.visible=!0,this.point=this,this.series=n,this.applyOptions(m,x),this.id??(this.id=Ye()),this.resolveColor(),this.dataLabelOnNull??(this.dataLabelOnNull=n.options.nullInteraction),n.chart.pointCount++,Dm(this,"afterInit")}isValid(){return(Ge(this.x)||this.x instanceof Date)&&Ge(this.y)}optionsToObject(n){var se;let m=this.series,x=m.options.keys,S=x||m.pointArrayMap||["y"],k=S.length,L={},R,N=0,Y=0;if(Ge(n)||n===null)L[S[0]]=n;else if(bn(n))for(!x&&n.length>k&&((R=typeof n[0])=="string"?(se=m.xAxis)!=null&&se.dateTime?L.x=m.chart.time.parse(n[0]):L.name=n[0]:R==="number"&&(L.x=n[0]),N++);Y<k;)x&&n[N]===void 0||(S[Y].indexOf(".")>0?mt.prototype.setNestedProperty(L,n[N],S[Y]):L[S[Y]]=n[N]),N++,Y++;else typeof n=="object"&&(L=n,n.dataLabels&&(m.hasDataLabels=()=>!0),n.marker&&(m._hasPointMarkers=!0));return L}pos(n,m=this.plotY){if(!this.destroyed){let{plotX:x,series:S}=this,{chart:k,xAxis:L,yAxis:R}=S,N=0,Y=0;if(Ge(x)&&Ge(m))return n&&(N=L?L.pos:k.plotLeft,Y=R?R.pos:k.plotTop),k.inverted&&L&&R?[R.len-m+Y,L.len-x+N]:[x+N,m+Y]}}resolveColor(){let n=this.series,m=n.chart.options.chart,x=n.chart.styledMode,S,k,L=m.colorCount,R;delete this.nonZonedColor,n.options.colorByPoint?(x||(S=(k=n.options.colors||n.chart.options.colors)[n.colorCounter],L=k.length),R=n.colorCounter,n.colorCounter++,n.colorCounter===L&&(n.colorCounter=0)):(x||(S=n.color),R=n.colorIndex),this.colorIndex=xe(this.options.colorIndex,R),this.color=xe(this.options.color,S)}setNestedProperty(n,m,x){return x.split(".").reduce(function(S,k,L,R){let N=R.length-1===L;return S[k]=N?m:J(S[k],!0)?S[k]:{},S[k]},n),n}shouldDraw(){return!this.isNull}tooltipFormatter(n){var N;let{chart:m,pointArrayMap:x=["y"],tooltipOptions:S}=this.series,{valueDecimals:k="",valuePrefix:L="",valueSuffix:R=""}=S;return m.styledMode&&(n=((N=m.tooltip)==null?void 0:N.styledModeFormat(n))||n),x.forEach(Y=>{Y="{point."+Y,(L||R)&&(n=n.replace(RegExp(Y+"}","g"),L+Y+"}"+R)),n=n.replace(RegExp(Y+"}","g"),Y+":,."+k+"f}")}),Bu(n,this,m)}update(n,m,x,S){let k,L=this,R=L.series,N=L.graphic,Y=R.chart,se=R.options;function $(){L.applyOptions(n);let ee=N&&L.hasMockGraphic,ae=L.y===null?!ee:ee;N&&ae&&(L.graphic=N.destroy(),delete L.hasMockGraphic),J(n,!0)&&(N!=null&&N.element&&n&&n.marker&&n.marker.symbol!==void 0&&(L.graphic=N.destroy()),n!=null&&n.dataLabels&&L.dataLabel&&(L.dataLabel=L.dataLabel.destroy())),k=L.index;let fe={};for(let ve of R.dataColumnKeys())fe[ve]=L[ve];R.dataTable.setRow(fe,k),se.data[k]=J(se.data[k],!0)||J(n,!0)?L.options:xe(n,se.data[k]),R.isDirty=R.isDirtyData=!0,!R.fixedBox&&R.hasCartesianSeries&&(Y.isDirtyBox=!0),se.legendType==="point"&&(Y.isDirtyLegend=!0),m&&Y.redraw(x)}m=xe(m,!0),S===!1?$():L.firePointEvent("update",{options:n},$)}remove(n,m){this.series.removePoint(this.series.data.indexOf(this),n,m)}select(n,m){let x=this,S=x.series,k=S.chart;n=xe(n,!x.selected),this.selectedStaging=n,x.firePointEvent(n?"select":"unselect",{accumulate:m},function(){x.selected=x.options.selected=n,S.options.data[S.data.indexOf(x)]=x.options,x.setState(n&&"select"),m||k.getSelectedPoints().forEach(function(L){let R=L.series;L.selected&&L!==x&&(L.selected=L.options.selected=!1,R.options.data[R.data.indexOf(L)]=L.options,L.setState(k.hoverPoints&&R.options.inactiveOtherPoints?"inactive":""),L.firePointEvent("unselect"))})}),delete this.selectedStaging}onMouseOver(n){let{inverted:m,pointer:x}=this.series.chart;x&&(n=n?x.normalize(n):x.getChartCoordinatesFromPoint(this,m),x.runPointActions(n,this))}onMouseOut(){let n=this.series.chart;this.firePointEvent("mouseOut"),this.series.options.inactiveOtherPoints||(n.hoverPoints||[]).forEach(function(m){m.setState()}),n.hoverPoints=n.hoverPoint=null}manageEvent(n){var S,k,L,R,N,Y,se;let m=ge(this.series.options.point,this.options),x=(S=m.events)==null?void 0:S[n];wp(x)&&(!((k=this.hcEvents)!=null&&k[n])||((R=(L=this.hcEvents)==null?void 0:L[n])==null?void 0:R.map($=>$.fn).indexOf(x))===-1)?((N=this.importedUserEvent)==null||N.call(this),this.importedUserEvent=Zp(this,n,x),this.hcEvents&&(this.hcEvents[n].userEvent=!0)):this.importedUserEvent&&!x&&((Y=this.hcEvents)!=null&&Y[n])&&((se=this.hcEvents)!=null&&se[n].userEvent)&&(je(this,n),delete this.hcEvents[n],Object.keys(this.hcEvents)||delete this.importedUserEvent)}setState(n,m){var Mt,Nt;let x=this.series,S=this.state,k=x.options.states[n||"normal"]||{},L=hd.plotOptions[x.type].marker&&x.options.marker,R=L&&L.enabled===!1,N=((Mt=L==null?void 0:L.states)==null?void 0:Mt[n||"normal"])||{},Y=N.enabled===!1,se=this.marker||{},$=x.chart,ee=L&&x.markerAttribs,ae=x.halo,fe,ve,Te,Ae=x.stateMarkerGraphic,Ve;if((n=n||"")===this.state&&!m||this.selected&&n!=="select"||k.enabled===!1||n&&(Y||R&&N.enabled===!1)||n&&se.states&&se.states[n]&&se.states[n].enabled===!1)return;if(this.state=n,ee&&(fe=x.markerAttribs(this,n)),this.graphic&&!this.hasMockGraphic){if(S&&this.graphic.removeClass("highcharts-point-"+S),n&&this.graphic.addClass("highcharts-point-"+n),!$.styledMode){ve=x.pointAttribs(this,n),Te=xe($.options.chart.animation,k.animation);let Rt=ve.opacity;x.options.inactiveOtherPoints&&Ge(Rt)&&(this.dataLabels||[]).forEach(function($t){$t&&!$t.hasClass("highcharts-data-label-hidden")&&($t.animate({opacity:Rt},Te),$t.connector&&$t.connector.animate({opacity:Rt},Te))}),this.graphic.animate(ve,Te)}fe&&this.graphic.animate(fe,xe($.options.chart.animation,N.animation,L.animation)),Ae&&Ae.hide()}else n&&N&&(Ve=se.symbol||x.symbol,Ae&&Ae.currentSymbol!==Ve&&(Ae=Ae.destroy()),fe&&(Ae?Ae[m?"animate":"attr"]({x:fe.x,y:fe.y}):Ve&&(x.stateMarkerGraphic=Ae=$.renderer.symbol(Ve,fe.x,fe.y,fe.width,fe.height,ge(L,N)).add(x.markerGroup),Ae.currentSymbol=Ve)),!$.styledMode&&Ae&&this.state!=="inactive"&&Ae.attr(x.pointAttribs(this,n))),Ae&&(Ae[n&&this.isInside?"show":"hide"](),Ae.element.point=this,Ae.addClass(this.getClassName(),!0));let Ke=k.halo,Tt=this.graphic||Ae,St=(Tt==null?void 0:Tt.visibility)||"inherit";Ke!=null&&Ke.size&&Tt&&St!=="hidden"&&!this.isCluster?(ae||(x.halo=ae=$.renderer.path().add(Tt.parentGroup)),ae.show()[m?"animate":"attr"]({d:this.haloPath(Ke.size)}),ae.attr({class:"highcharts-halo highcharts-color-"+xe(this.colorIndex,x.colorIndex)+(this.className?" "+this.className:""),visibility:St,zIndex:-1}),ae.point=this,$.styledMode||ae.attr(bf({fill:this.color||x.color,"fill-opacity":Ke.opacity},Wn.filterUserAttributes(Ke.attributes||{})))):(Nt=ae==null?void 0:ae.point)!=null&&Nt.haloPath&&!ae.point.destroyed&&ae.animate({d:ae.point.haloPath(0)},null,ae.hide),Dm(this,"afterSetState",{state:n})}haloPath(n){let m=this.pos();return m?this.series.chart.renderer.symbols.circle(Wc(m[0],1)-n,m[1]-n,2*n,2*n):[]}}let bt=mt,{parse:Bt}=qt,{charts:gt,composed:Lt,isTouchDevice:qe}=fi,{addEvent:vt,attr:_t,css:Wt,extend:Gt,find:Vt,fireEvent:ji,isNumber:Ms,isObject:zi,objectEach:os,offset:Fs,pick:Xi,pushUnique:Es,splat:Ns}=Gs;class rr{applyInactiveState(n=[]){let m=[];n.forEach(x=>{let S=x.series;m.push(S),S.linkedParent&&m.push(S.linkedParent),S.linkedSeries&&m.push.apply(m,S.linkedSeries),S.navigatorSeries&&m.push(S.navigatorSeries),S.boosted&&S.markerGroup&&m.push.apply(m,this.chart.series.filter(k=>k.markerGroup===S.markerGroup))}),this.chart.series.forEach(x=>{m.indexOf(x)===-1?x.setState("inactive",!0):x.options.inactiveOtherPoints&&x.setAllPointsToState("inactive")})}destroy(){let n=this;this.eventsToUnbind.forEach(m=>m()),this.eventsToUnbind=[],!fi.chartCount&&(rr.unbindDocumentMouseUp.forEach(m=>m.unbind()),rr.unbindDocumentMouseUp.length=0,rr.unbindDocumentTouchEnd&&(rr.unbindDocumentTouchEnd=rr.unbindDocumentTouchEnd())),clearInterval(n.tooltipTimeout),os(n,function(m,x){n[x]=void 0})}getSelectionMarkerAttrs(n,m){let x={args:{chartX:n,chartY:m},attrs:{},shapeType:"rect"};return ji(this,"getSelectionMarkerAttrs",x,S=>{let k,{chart:L,zoomHor:R,zoomVert:N}=this,{mouseDownX:Y=0,mouseDownY:se=0}=L,$=S.attrs;$.x=L.plotLeft,$.y=L.plotTop,$.width=R?1:L.plotWidth,$.height=N?1:L.plotHeight,R&&($.width=Math.max(1,Math.abs(k=n-Y)),$.x=(k>0?0:k)+Y),N&&($.height=Math.max(1,Math.abs(k=m-se)),$.y=(k>0?0:k)+se)}),x}drag(n){let{chart:m}=this,{mouseDownX:x=0,mouseDownY:S=0}=m,{panning:k,panKey:L,selectionMarkerFill:R}=m.options.chart,N=m.plotLeft,Y=m.plotTop,se=m.plotWidth,$=m.plotHeight,ee=zi(k)?k.enabled:k,ae=L&&n[`${L}Key`],fe=n.chartX,ve=n.chartY,Te,Ae=this.selectionMarker;if((!Ae||!Ae.touch)&&(fe<N?fe=N:fe>N+se&&(fe=N+se),ve<Y?ve=Y:ve>Y+$&&(ve=Y+$),this.hasDragged=Math.sqrt(Math.pow(x-fe,2)+Math.pow(S-ve,2)),this.hasDragged>10)){Te=m.isInsidePlot(x-N,S-Y,{visiblePlotOnly:!0});let{shapeType:Ve,attrs:Ke}=this.getSelectionMarkerAttrs(fe,ve);this.hasZoom&&Te&&!ae&&!Ae&&(this.selectionMarker=Ae=m.renderer[Ve](),Ae.attr({class:"highcharts-selection-marker",zIndex:7}).add(),m.styledMode||Ae.attr({fill:R||Bt("#334eff").setOpacity(.25).get()})),Ae&&Ae.attr(Ke),Te&&!Ae&&ee&&m.pan(n,k)}}dragStart(n){let m=this.chart;m.mouseIsDown=n.type,m.cancelClick=!1,m.mouseDownX=n.chartX,m.mouseDownY=n.chartY}getSelectionBox(n){let m={args:{marker:n},result:n.getBBox()};return ji(this,"getSelectionBox",m),m.result}drop(n){let m,{chart:x,selectionMarker:S}=this;for(let k of x.axes)k.isPanning&&(k.isPanning=!1,(k.options.startOnTick||k.options.endOnTick||k.series.some(L=>L.boosted))&&(k.forceRedraw=!0,k.setExtremes(k.userMin,k.userMax,!1),m=!0));if(m&&x.redraw(),S&&n){if(this.hasDragged){let k=this.getSelectionBox(S);x.transform({axes:x.axes.filter(L=>L.zoomEnabled&&(L.coll==="xAxis"&&this.zoomX||L.coll==="yAxis"&&this.zoomY)),selection:{originalEvent:n,xAxis:[],yAxis:[],...k},from:k})}Ms(x.index)&&(this.selectionMarker=S.destroy())}x&&Ms(x.index)&&(Wt(x.container,{cursor:x._cursor}),x.cancelClick=this.hasDragged>10,x.mouseIsDown=!1,this.hasDragged=0,this.pinchDown=[])}findNearestKDPoint(n,m,x){let S;return n.forEach(function(k){let L=!(k.noSharedTooltip&&m)&&0>k.options.findNearestPointBy.indexOf("y"),R=k.searchPoint(x,L);zi(R,!0)&&R.series&&(!zi(S,!0)||function(N,Y){var ae,fe;let se=N.distX-Y.distX,$=N.dist-Y.dist,ee=((ae=Y.series.group)==null?void 0:ae.zIndex)-((fe=N.series.group)==null?void 0:fe.zIndex);return se!==0&&m?se:$!==0?$:ee!==0?ee:N.series.index>Y.series.index?-1:1}(S,R)>0)&&(S=R)}),S}getChartCoordinatesFromPoint(n,m){let{xAxis:x,yAxis:S}=n.series,k=n.shapeArgs;if(x&&S){let L=n.clientX??n.plotX??0,R=n.plotY||0;return n.isNode&&k&&Ms(k.x)&&Ms(k.y)&&(L=k.x,R=k.y),m?{chartX:S.len+S.pos-R,chartY:x.len+x.pos-L}:{chartX:L+x.pos,chartY:R+S.pos}}if(k!=null&&k.x&&k.y)return{chartX:k.x,chartY:k.y}}getChartPosition(){if(this.chartPosition)return this.chartPosition;let{container:n}=this.chart,m=Fs(n);this.chartPosition={left:m.left,top:m.top,scaleX:1,scaleY:1};let{offsetHeight:x,offsetWidth:S}=n;return S>2&&x>2&&(this.chartPosition.scaleX=m.width/S,this.chartPosition.scaleY=m.height/x),this.chartPosition}getCoordinates(n){let m={xAxis:[],yAxis:[]};for(let x of this.chart.axes)m[x.isXAxis?"xAxis":"yAxis"].push({axis:x,value:x.toValue(n[x.horiz?"chartX":"chartY"])});return m}getHoverData(n,m,x,S,k,L){let R=[],N=function(ae){return ae.visible&&!(!k&&ae.directTouch)&&Xi(ae.options.enableMouseTracking,!0)},Y=m,se,$={chartX:L?L.chartX:void 0,chartY:L?L.chartY:void 0,shared:k};ji(this,"beforeGetHoverData",$),se=Y&&!Y.stickyTracking?[Y]:x.filter(ae=>ae.stickyTracking&&($.filter||N)(ae));let ee=S&&n||!L?n:this.findNearestKDPoint(se,k,L);return Y=ee==null?void 0:ee.series,ee&&(k&&!Y.noSharedTooltip?(se=x.filter(function(ae){return $.filter?$.filter(ae):N(ae)&&!ae.noSharedTooltip})).forEach(function(ae){var Te;let fe=(Te=ae.options)==null?void 0:Te.nullInteraction,ve=Vt(ae.points,function(Ae){return Ae.x===ee.x&&(!Ae.isNull||!!fe)});zi(ve)&&(ae.boosted&&ae.boost&&(ve=ae.boost.getPoint(ve)),R.push(ve))}):R.push(ee)),ji(this,"afterGetHoverData",$={hoverPoint:ee}),{hoverPoint:$.hoverPoint,hoverSeries:Y,hoverPoints:R}}getPointFromEvent(n){let m=n.target,x;for(;m&&!x;)x=m.point,m=m.parentNode;return x}onTrackerMouseOut(n){let m=this.chart,x=n.relatedTarget,S=m.hoverSeries;this.isDirectTouch=!1,!S||!x||S.stickyTracking||this.inClass(x,"highcharts-tooltip")||this.inClass(x,"highcharts-series-"+S.index)&&this.inClass(x,"highcharts-tracker")||S.onMouseOut()}inClass(n,m){let x=n,S;for(;x;){if(S=_t(x,"class")){if(S.indexOf(m)!==-1)return!0;if(S.indexOf("highcharts-container")!==-1)return!1}x=x.parentElement}}constructor(n,m){var x;this.hasDragged=0,this.pointerCaptureEventsToUnbind=[],this.eventsToUnbind=[],this.options=m,this.chart=n,this.runChartClick=!!((x=m.chart.events)!=null&&x.click),this.pinchDown=[],this.setDOMEvents(),ji(this,"afterInit")}normalize(n,m){let x=n.touches,S=x?x.length?x.item(0):Xi(x.changedTouches,n.changedTouches)[0]:n;m||(m=this.getChartPosition());let k=S.pageX-m.left,L=S.pageY-m.top;return Gt(n,{chartX:Math.round(k/=m.scaleX),chartY:Math.round(L/=m.scaleY)})}onContainerClick(n){let m=this.chart,x=m.hoverPoint,S=this.normalize(n),k=m.plotLeft,L=m.plotTop;!m.cancelClick&&(x&&this.inClass(S.target,"highcharts-tracker")?(ji(x.series,"click",Gt(S,{point:x})),m.hoverPoint&&x.firePointEvent("click",S)):(Gt(S,this.getCoordinates(S)),m.isInsidePlot(S.chartX-k,S.chartY-L,{visiblePlotOnly:!0})&&ji(m,"click",S)))}onContainerMouseDown(n){var x;let m=(1&(n.buttons||n.button))==1;n=this.normalize(n),fi.isFirefox&&n.button!==0&&this.onContainerMouseMove(n),(n.button===void 0||m)&&(this.zoomOption(n),m&&((x=n.preventDefault)==null||x.call(n)),this.dragStart(n))}onContainerMouseLeave(n){let{pointer:m}=gt[Xi(rr.hoverChartIndex,-1)]||{};n=this.normalize(n),this.onContainerMouseMove(n),m&&!this.inClass(n.relatedTarget,"highcharts-tooltip")&&(m.reset(),m.chartPosition=void 0)}onContainerMouseEnter(){delete this.chartPosition}onContainerMouseMove(n){var k;let m=this.chart,x=m.tooltip,S=this.normalize(n);this.setHoverChartIndex(n),(m.mouseIsDown==="mousedown"||this.touchSelect(S))&&this.drag(S),!((k=m.exporting)!=null&&k.openMenu)&&(this.inClass(S.target,"highcharts-tracker")||m.isInsidePlot(S.chartX-m.plotLeft,S.chartY-m.plotTop,{visiblePlotOnly:!0}))&&!(x!=null&&x.shouldStickOnContact(S))&&(this.inClass(S.target,"highcharts-no-tooltip")?this.reset(!1,0):this.runPointActions(S))}onDocumentTouchEnd(n){this.onDocumentMouseUp(n)}onContainerTouchMove(n){this.touchSelect(n)?this.onContainerMouseMove(n):this.touch(n)}onContainerTouchStart(n){this.touchSelect(n)?this.onContainerMouseDown(n):(this.zoomOption(n),this.touch(n,!0))}onDocumentMouseMove(n){let m=this.chart,x=m.tooltip,S=this.chartPosition,k=this.normalize(n,S);!S||m.isInsidePlot(k.chartX-m.plotLeft,k.chartY-m.plotTop,{visiblePlotOnly:!0})||x!=null&&x.shouldStickOnContact(k)||k.target!==m.container.ownerDocument&&this.inClass(k.target,"highcharts-tracker")||this.reset()}onDocumentMouseUp(n){var m,x;(x=(m=gt[Xi(rr.hoverChartIndex,-1)])==null?void 0:m.pointer)==null||x.drop(n)}pinch(n){let m=this,{chart:x,hasZoom:S,lastTouches:k}=m,L=[].map.call(n.touches||[],$=>m.normalize($)),R=L.length,N=R===1&&(m.inClass(n.target,"highcharts-tracker")&&x.runTrackerClick||m.runChartClick),Y=x.tooltip,se=R===1&&Xi(Y==null?void 0:Y.options.followTouchMove,!0);R>1?m.initiated=!0:se&&(m.initiated=!1),S&&m.initiated&&!N&&n.cancelable!==!1&&n.preventDefault(),n.type==="touchstart"?(m.pinchDown=L,m.res=!0,x.mouseDownX=n.chartX):se?this.runPointActions(m.normalize(n)):k&&(ji(x,"touchpan",{originalEvent:n,touches:L},()=>{let $=ee=>{let ae=ee[0],fe=ee[1]||ae;return{x:ae.chartX,y:ae.chartY,width:fe.chartX-ae.chartX,height:fe.chartY-ae.chartY}};x.transform({axes:x.axes.filter(ee=>ee.zoomEnabled&&(this.zoomHor&&ee.horiz||this.zoomVert&&!ee.horiz)),to:$(L),from:$(k),trigger:n.type})}),m.res&&(m.res=!1,this.reset(!1,0))),m.lastTouches=L}reset(n,m){let x=this.chart,S=x.hoverSeries,k=x.hoverPoint,L=x.hoverPoints,R=x.tooltip,N=R!=null&&R.shared?L:k;n&&N&&Ns(N).forEach(function(Y){Y.series.isCartesian&&Y.plotX===void 0&&(n=!1)}),n?R&&N&&Ns(N).length&&(R.refresh(N),R.shared&&L?L.forEach(function(Y){Y.setState(Y.state,!0),Y.series.isCartesian&&(Y.series.xAxis.crosshair&&Y.series.xAxis.drawCrosshair(null,Y),Y.series.yAxis.crosshair&&Y.series.yAxis.drawCrosshair(null,Y))}):k&&(k.setState(k.state,!0),x.axes.forEach(function(Y){Y.crosshair&&k.series[Y.coll]===Y&&Y.drawCrosshair(null,k)}))):(k&&k.onMouseOut(),L&&L.forEach(function(Y){Y.setState()}),S&&S.onMouseOut(),R&&R.hide(m),this.unDocMouseMove&&(this.unDocMouseMove=this.unDocMouseMove()),x.axes.forEach(function(Y){Y.hideCrosshair()}),x.hoverPoints=x.hoverPoint=void 0)}runPointActions(n,m,x){var ve;let S=this.chart,k=S.series,L=(ve=S.tooltip)!=null&&ve.options.enabled?S.tooltip:void 0,R=!!L&&L.shared,N=m||S.hoverPoint,Y=(N==null?void 0:N.series)||S.hoverSeries,se=(!n||n.type!=="touchmove")&&(!!m||(Y==null?void 0:Y.directTouch)&&this.isDirectTouch),$=this.getHoverData(N,Y,k,se,R,n);N=$.hoverPoint,Y=$.hoverSeries;let ee=$.hoverPoints,ae=(Y==null?void 0:Y.tooltipOptions.followPointer)&&!Y.tooltipOptions.split,fe=R&&Y&&!Y.noSharedTooltip;if(N&&(x||N!==S.hoverPoint||L!=null&&L.isHidden)){if((S.hoverPoints||[]).forEach(function(Te){ee.indexOf(Te)===-1&&Te.setState()}),S.hoverSeries!==Y&&Y.onMouseOver(),this.applyInactiveState(ee),(ee||[]).forEach(function(Te){Te.setState("hover")}),S.hoverPoint&&S.hoverPoint.firePointEvent("mouseOut"),!N.series)return;S.hoverPoints=ee,S.hoverPoint=N,N.firePointEvent("mouseOver",void 0,()=>{L&&N&&L.refresh(fe?ee:N,n)})}else if(ae&&L&&!L.isHidden){let Te=L.getAnchor([{}],n);S.isInsidePlot(Te[0],Te[1],{visiblePlotOnly:!0})&&L.updatePosition({plotX:Te[0],plotY:Te[1]})}this.unDocMouseMove||(this.unDocMouseMove=vt(S.container.ownerDocument,"mousemove",Te=>{var Ae,Ve;return(Ve=(Ae=gt[rr.hoverChartIndex??-1])==null?void 0:Ae.pointer)==null?void 0:Ve.onDocumentMouseMove(Te)}),this.eventsToUnbind.push(this.unDocMouseMove)),S.axes.forEach(function(Te){var Ke;let Ae,Ve=((Ke=Te.crosshair)==null?void 0:Ke.snap)??!0;Ve&&((Ae=S.hoverPoint)&&Ae.series[Te.coll]===Te||(Ae=Vt(ee,Tt=>{var St;return((St=Tt.series)==null?void 0:St[Te.coll])===Te}))),Ae||!Ve?Te.drawCrosshair(n,Ae):Te.hideCrosshair()})}setDOMEvents(){let n=this.chart.container,m=n.ownerDocument;n.onmousedown=this.onContainerMouseDown.bind(this),n.onmousemove=this.onContainerMouseMove.bind(this),n.onclick=this.onContainerClick.bind(this),this.eventsToUnbind.push(vt(n,"mouseenter",this.onContainerMouseEnter.bind(this)),vt(n,"mouseleave",this.onContainerMouseLeave.bind(this))),rr.unbindDocumentMouseUp.some(S=>S.doc===m)||rr.unbindDocumentMouseUp.push({doc:m,unbind:vt(m,"mouseup",this.onDocumentMouseUp.bind(this))});let x=this.chart.renderTo.parentElement;for(;x&&x.tagName!=="BODY";)this.eventsToUnbind.push(vt(x,"scroll",()=>{delete this.chartPosition})),x=x.parentElement;this.eventsToUnbind.push(vt(n,"touchstart",this.onContainerTouchStart.bind(this),{passive:!1}),vt(n,"touchmove",this.onContainerTouchMove.bind(this),{passive:!1})),rr.unbindDocumentTouchEnd||(rr.unbindDocumentTouchEnd=vt(m,"touchend",this.onDocumentTouchEnd.bind(this),{passive:!1})),this.setPointerCapture(),vt(this.chart,"redraw",this.setPointerCapture.bind(this))}setPointerCapture(){var k,L;if(!qe)return;let n=this.pointerCaptureEventsToUnbind,m=this.chart,x=m.container,S=Xi((k=m.options.tooltip)==null?void 0:k.followTouchMove,!0)&&m.series.some(R=>R.options.findNearestPointBy.indexOf("y")>-1);!this.hasPointerCapture&&S?(n.push(vt(x,"pointerdown",R=>{var N,Y;(N=R.target)!=null&&N.hasPointerCapture(R.pointerId)&&((Y=R.target)==null||Y.releasePointerCapture(R.pointerId))}),vt(x,"pointermove",R=>{var N,Y;(Y=(N=m.pointer)==null?void 0:N.getPointFromEvent(R))==null||Y.onMouseOver(R)})),m.styledMode||Wt(x,{"touch-action":"none"}),x.className+=" highcharts-no-touch-action",this.hasPointerCapture=!0):this.hasPointerCapture&&!S&&(n.forEach(R=>R()),n.length=0,m.styledMode||Wt(x,{"touch-action":Xi((L=m.options.chart.style)==null?void 0:L["touch-action"],"manipulation")}),x.className=x.className.replace(" highcharts-no-touch-action",""),this.hasPointerCapture=!1)}setHoverChartIndex(n){var S;let m=this.chart,x=fi.charts[Xi(rr.hoverChartIndex,-1)];if(x&&x!==m){let k={relatedTarget:m.container};n&&!(n!=null&&n.relatedTarget)&&Object.assign({},n,k),(S=x.pointer)==null||S.onContainerMouseLeave(n||k)}x!=null&&x.mouseIsDown||(rr.hoverChartIndex=m.index)}touch(n,m){var L;let x,{chart:S,pinchDown:k=[]}=this;this.setHoverChartIndex(),(n=this.normalize(n)).touches.length===1?S.isInsidePlot(n.chartX-S.plotLeft,n.chartY-S.plotTop,{visiblePlotOnly:!0})&&!((L=S.exporting)!=null&&L.openMenu)?(m&&this.runPointActions(n),n.type==="touchmove"&&(x=!!k[0]&&Math.pow(k[0].chartX-n.chartX,2)+Math.pow(k[0].chartY-n.chartY,2)>=16),Xi(x,!0)&&this.pinch(n)):m&&this.reset():n.touches.length===2&&this.pinch(n)}touchSelect(n){return!!(this.chart.zooming.singleTouch&&n.touches&&n.touches.length===1)}zoomOption(n){let m=this.chart,x=m.inverted,S=m.zooming.type||"",k,L;/touch/.test(n.type)&&(S=Xi(m.zooming.pinchType,S)),this.zoomX=k=/x/.test(S),this.zoomY=L=/y/.test(S),this.zoomHor=k&&!x||L&&x,this.zoomVert=L&&!x||k&&x,this.hasZoom=k||L}}rr.unbindDocumentMouseUp=[],function(H){H.compose=function(n){Es(Lt,"Core.Pointer")&&vt(n,"beforeRender",function(){this.pointer=new H(this,this.options)})}}(rr||(rr={}));let bs=rr;(function(H){H.setLength=function(n,m,x){return Array.isArray(n)?(n.length=m,n):n[x?"subarray":"slice"](0,m)},H.splice=function(n,m,x,S,k=[]){if(Array.isArray(n))return Array.isArray(k)||(k=Array.from(k)),{removed:n.splice(m,x,...k),array:n};let L=Object.getPrototypeOf(n).constructor,R=n[S?"subarray":"slice"](m,m+x),N=new L(n.length-x+k.length);return N.set(n.subarray(0,m),0),N.set(k,m),N.set(n.subarray(m+x),m+k.length),{removed:R,array:N}}})(_r||(_r={}));let{setLength:Ks,splice:or}=_r,{fireEvent:Jo,objectEach:co,uniqueKey:eo}=Gs,ya=class{constructor(H={}){this.autoId=!H.id,this.columns={},this.id=H.id||eo(),this.modified=this,this.rowCount=0,this.versionTag=eo();let n=0;co(H.columns||{},(m,x)=>{this.columns[x]=m.slice(),n=Math.max(n,m.length)}),this.applyRowCount(n)}applyRowCount(H){this.rowCount=H,co(this.columns,(n,m)=>{n.length!==H&&(this.columns[m]=Ks(n,H))})}deleteRows(H,n=1){if(n>0&&H<this.rowCount){let m=0;co(this.columns,(x,S)=>{this.columns[S]=or(x,H,n).array,m=x.length}),this.rowCount=m}Jo(this,"afterDeleteRows",{rowIndex:H,rowCount:n}),this.versionTag=eo()}getColumn(H,n){return this.columns[H]}getColumns(H,n){return(H||Object.keys(this.columns)).reduce((m,x)=>(m[x]=this.columns[x],m),{})}getRow(H,n){return(n||Object.keys(this.columns)).map(m=>{var x;return(x=this.columns[m])==null?void 0:x[H]})}setColumn(H,n=[],m=0,x){this.setColumns({[H]:n},m,x)}setColumns(H,n,m){let x=this.rowCount;co(H,(S,k)=>{this.columns[k]=S.slice(),x=S.length}),this.applyRowCount(x),m!=null&&m.silent||(Jo(this,"afterSetColumns"),this.versionTag=eo())}setRow(H,n=this.rowCount,m,x){let{columns:S}=this,k=m?this.rowCount+1:n+1;co(H,(L,R)=>{let N=S[R]||(x==null?void 0:x.addColumns)!==!1&&Array(k);N&&(m?N=or(N,n,0,!0,[L]).array:N[n]=L,S[R]=N)}),k>this.rowCount&&this.applyRowCount(k),x!=null&&x.silent||(Jo(this,"afterSetRows"),this.versionTag=eo())}},{extend:ta,merge:Ea,pick:mn}=Gs;(function(H){function n(m,x,S){var Tt,St;let k=this.legendItem=this.legendItem||{},{chart:L,options:R}=this,{baseline:N=0,symbolWidth:Y,symbolHeight:se}=m,$=this.symbol||"circle",ee=se/2,ae=L.renderer,fe=k.group,ve=N-Math.round((((Tt=m.fontMetrics)==null?void 0:Tt.b)||se)*(S?.4:.3)),Te={},Ae,Ve=R.marker,Ke=0;if(L.styledMode||(Te["stroke-width"]=Math.min(R.lineWidth||0,24),R.dashStyle?Te.dashstyle=R.dashStyle:R.linecap!=="square"&&(Te["stroke-linecap"]="round")),k.line=ae.path().addClass("highcharts-graph").attr(Te).add(fe),S&&(k.area=ae.path().addClass("highcharts-area").add(fe)),Te["stroke-linecap"]&&(Ke=Math.min(k.line.strokeWidth(),Y)/2),Y){let Mt=[["M",Ke,ve],["L",Y-Ke,ve]];k.line.attr({d:Mt}),(St=k.area)==null||St.attr({d:[...Mt,["L",Y-Ke,N],["L",Ke,N]]})}if(Ve&&Ve.enabled!==!1&&Y){let Mt=Math.min(mn(Ve.radius,ee),ee);$.indexOf("url")===0&&(Ve=Ea(Ve,{width:se,height:se}),Mt=0),k.symbol=Ae=ae.symbol($,Y/2-Mt,ve-Mt,2*Mt,2*Mt,ta({context:"legend"},Ve)).addClass("highcharts-point").add(fe),Ae.isMarker=!0}}H.areaMarker=function(m,x){n.call(this,m,x,!0)},H.lineMarker=n,H.rectangle=function(m,x){let S=x.legendItem||{},k=m.options,L=m.symbolHeight,R=k.squareSymbol,N=R?L:m.symbolWidth;S.symbol=this.chart.renderer.rect(R?(m.symbolWidth-L)/2:0,m.baseline-L+1,N,L,mn(m.options.symbolRadius,L/2)).addClass("highcharts-point").attr({zIndex:3}).add(S.group)}})(ar||(ar={}));let qr=ar,{defaultOptions:Sl}=ei,{extend:oo,extendClass:Hc,merge:am}=Gs;(function(H){function n(m,x){let S=Sl.plotOptions||{},k=x.defaultOptions,L=x.prototype;return L.type=m,L.pointClass||(L.pointClass=bt),!H.seriesTypes[m]&&(k&&(S[m]=k),H.seriesTypes[m]=x,!0)}H.seriesTypes=fi.seriesTypes,H.registerSeriesType=n,H.seriesType=function(m,x,S,k,L){let R=Sl.plotOptions||{};if(x=x||"",R[m]=am(R[x],S),delete H.seriesTypes[m],n(m,Hc(H.seriesTypes[x]||function(){},k)),H.seriesTypes[m].prototype.type=m,L){class N extends bt{}oo(N.prototype,L),H.seriesTypes[m].prototype.pointClass=N}return H.seriesTypes[m]}})(Nr||(Nr={}));let pn=Nr,{animObject:Cg,setAnimation:wf}=Oo,{defaultOptions:tp}=ei,{registerEventOptions:Oi}=Pd,{svg:ms,win:Tp}=fi,{seriesTypes:kn}=pn,{format:Zt}=ja,{arrayMax:vh,arrayMin:zm,clamp:Ho,correctFloat:hg,crisp:Pg,defined:Fl,destroyObjectProperties:ip,diffObjects:Ml,erase:ny,error:xa,extend:Fu,find:el,fireEvent:tl,getClosestDistance:cg,getNestedProperty:ia,insertItem:Dh,isArray:hu,isNumber:Nl,isString:_a,merge:th,objectEach:Rm,pick:On,removeEvent:Vo,syncTimeout:bo}=Gs;class Dd{constructor(){this.zoneAxis="y"}init(n,m){var N,Y,se;let x;tl(this,"init",{options:m}),this.dataTable??(this.dataTable=new ya);let S=n.series;this.eventsToUnbind=[],this.chart=n,this.options=this.setOptions(m);let k=this.options,L=k.visible!==!1;this.linkedSeries=[],this.bindAxes(),Fu(this,{name:k.name,state:"",visible:L,selected:k.selected===!0}),Oi(this,k);let R=k.events;(R!=null&&R.click||(Y=(N=k.point)==null?void 0:N.events)!=null&&Y.click||k.allowPointSelect)&&(n.runTrackerClick=!0),this.getColor(),this.getSymbol(),this.isCartesian&&(n.hasCartesianSeries=!0),S.length&&(x=S[S.length-1]),this._i=On(x==null?void 0:x._i,-1)+1,this.opacity=this.options.opacity,n.orderItems("series",Dh(this,S)),(se=k.dataSorting)!=null&&se.enabled?this.setDataSortingOptions():this.points||this.data||this.setData(k.data,!1),tl(this,"afterInit")}is(n){return kn[n]&&this instanceof kn[n]}bindAxes(){let n,m=this,x=m.options,S=m.chart;tl(this,"bindAxes",null,function(){(m.axisTypes||[]).forEach(function(k){(S[k]||[]).forEach(function(L){n=L.options,(On(x[k],0)===L.index||x[k]!==void 0&&x[k]===n.id)&&(Dh(m,L.series),m[k]=L,L.isDirty=!0)}),m[k]||m.optionalAxis===k||xa(18,!0,S)})}),tl(this,"afterBindAxes")}hasData(){return this.visible&&this.dataMax!==void 0&&this.dataMin!==void 0||this.visible&&this.dataTable.rowCount>0}hasMarkerChanged(n,m){let x=n.marker,S=m.marker||{};return x&&(S.enabled&&!x.enabled||S.symbol!==x.symbol||S.height!==x.height||S.width!==x.width)}autoIncrement(n){let m,x=this.options,{pointIntervalUnit:S,relativeXValue:k}=this.options,L=this.chart.time,R=this.xIncrement??L.parse(x.pointStart)??0;if(this.pointInterval=m=On(this.pointInterval,x.pointInterval,1),k&&Nl(n)&&(m*=n),S){let N=L.toParts(R);S==="day"?N[2]+=m:S==="month"?N[1]+=m:S==="year"&&(N[0]+=m),m=L.makeTime.apply(L,N)-R}return k&&Nl(n)?R+m:(this.xIncrement=R+m,R)}setDataSortingOptions(){let n=this.options;Fu(this,{requireSorting:!1,sorted:!1,enabledDataSorting:!0,allowDG:!1}),Fl(n.pointRange)||(n.pointRange=1)}setOptions(n){var Te,Ae;let m,x=this.chart,S=x.options.plotOptions,k=x.userOptions||{},L=th(n),R=x.styledMode,N={plotOptions:S,userOptions:L};tl(this,"setOptions",N);let Y=N.plotOptions[this.type],se=k.plotOptions||{},$=se.series||{},ee=tp.plotOptions[this.type]||{},ae=se[this.type]||{};Y.dataLabels=this.mergeArrays(ee.dataLabels,Y.dataLabels),this.userOptions=N.userOptions;let fe=th(Y,S.series,ae,L);this.tooltipOptions=th(tp.tooltip,(Te=tp.plotOptions.series)==null?void 0:Te.tooltip,ee==null?void 0:ee.tooltip,x.userOptions.tooltip,(Ae=se.series)==null?void 0:Ae.tooltip,ae.tooltip,L.tooltip),this.stickyTracking=On(L.stickyTracking,ae.stickyTracking,$.stickyTracking,!!this.tooltipOptions.shared&&!this.noSharedTooltip||fe.stickyTracking),Y.marker===null&&delete fe.marker,this.zoneAxis=fe.zoneAxis||"y";let ve=this.zones=(fe.zones||[]).map(Ve=>({...Ve}));return(fe.negativeColor||fe.negativeFillColor)&&!fe.zones&&(m={value:fe[this.zoneAxis+"Threshold"]||fe.threshold||0,className:"highcharts-negative"},R||(m.color=fe.negativeColor,m.fillColor=fe.negativeFillColor),ve.push(m)),ve.length&&Fl(ve[ve.length-1].value)&&ve.push(R?{}:{color:this.color,fillColor:this.fillColor}),tl(this,"afterSetOptions",{options:fe}),fe}getName(){return this.options.name??Zt(this.chart.options.lang.seriesName,this,this.chart)}getCyclic(n,m,x){let S,k,L=this.chart,R=`${n}Index`,N=`${n}Counter`,Y=(x==null?void 0:x.length)||L.options.chart.colorCount;!m&&(Fl(k=On(n==="color"?this.options.colorIndex:void 0,this[R]))?S=k:(L.series.length||(L[N]=0),S=L[N]%Y,L[N]+=1),x&&(m=x[S])),S!==void 0&&(this[R]=S),this[n]=m}getColor(){this.chart.styledMode?this.getCyclic("color"):this.options.colorByPoint?this.color="#cccccc":this.getCyclic("color",this.options.color||tp.plotOptions[this.type].color,this.chart.options.colors)}getPointsCollection(){return(this.hasGroupedData?this.points:this.data)||[]}getSymbol(){let n=this.options.marker;this.getCyclic("symbol",n.symbol,this.chart.options.symbols)}getColumn(n,m){return(m?this.dataTable.modified:this.dataTable).getColumn(n,!0)||[]}findPointIndex(n,m){var $;let x,S,k,{id:L,x:R}=n,N=this.points,Y=this.options.dataSorting,se=this.cropStart||0;if(L){let ee=this.chart.get(L);ee instanceof bt&&(x=ee)}else if(this.linkedParent||this.enabledDataSorting||this.options.relativeXValue){let ee=ae=>!ae.touched&&ae.index===n.index;if(Y!=null&&Y.matchByName?ee=ae=>!ae.touched&&ae.name===n.name:this.options.relativeXValue&&(ee=ae=>!ae.touched&&ae.options.x===n.x),!(x=el(N,ee)))return}return x&&(k=x==null?void 0:x.index)!==void 0&&(S=!0),k===void 0&&Nl(R)&&(k=this.getColumn("x").indexOf(R,m)),k!==-1&&k!==void 0&&this.cropped&&(k=k>=se?k-se:k),!S&&Nl(k)&&(($=N[k])!=null&&$.touched)&&(k=void 0),k}updateData(n,m){var ve;let{options:x,requireSorting:S}=this,k=x.dataSorting,L=this.points,R=[],N=n.length===L.length,Y,se,$,ee,ae=!0;if(this.xIncrement=null,n.forEach((Te,Ae)=>{var Mt;let Ve,Ke=Fl(Te)&&this.pointClass.prototype.optionsToObject.call({series:this},Te)||{},{id:Tt,x:St}=Ke;Tt||Nl(St)?((Ve=this.findPointIndex(Ke,ee))===-1||Ve===void 0?R.push(Te):L[Ve]&&Te!==((Mt=x.data)==null?void 0:Mt[Ve])?(L[Ve].update(Te,!1,void 0,!1),L[Ve].touched=!0,S&&(ee=Ve+1)):L[Ve]&&(L[Ve].touched=!0),(!N||Ae!==Ve||k!=null&&k.enabled||this.hasDerivedData)&&(Y=!0)):R.push(Te)},this),Y)for(se=L.length;se--;)($=L[se])&&!$.touched&&((ve=$.remove)==null||ve.call($,!1,m));else N&&!(k!=null&&k.enabled)?(n.forEach((Te,Ae)=>{Te===L[Ae].y||L[Ae].destroyed||L[Ae].update(Te,!1,void 0,!1)}),R.length=0):ae=!1;if(L.forEach(Te=>{Te&&(Te.touched=!1)}),!ae)return!1;R.forEach(Te=>{this.addPoint(Te,!1,void 0,void 0,!1)},this);let fe=this.getColumn("x");return this.xIncrement===null&&fe.length&&(this.xIncrement=vh(fe),this.autoIncrement()),!0}dataColumnKeys(){return["x",...this.pointArrayMap||["y"]]}setData(n,m=!0,x,S){var Nt,Rt;let k=this.points,L=(k==null?void 0:k.length)||0,R=this.options,N=this.chart,Y=R.dataSorting,se=this.xAxis,$=R.turboThreshold,ee=this.dataTable,ae=this.dataColumnKeys(),fe=this.pointValKey||"y",ve=(this.pointArrayMap||[]).length,Te=R.keys,Ae,Ve,Ke=0,Tt=1,St;N.options.chart.allowMutatingData||(R.data&&delete this.options.data,this.userOptions.data&&delete this.userOptions.data,St=th(!0,n));let Mt=(n=St||n||[]).length;if(Y!=null&&Y.enabled&&(n=this.sortData(n)),N.options.chart.allowMutatingData&&S!==!1&&Mt&&L&&!this.cropped&&!this.hasGroupedData&&this.visible&&!this.boosted&&(Ve=this.updateData(n,x)),!Ve){this.xIncrement=null,this.colorCounter=0;let $t=$&&!R.relativeXValue&&Mt>$;if($t){let Ti=this.getFirstValidPoint(n),hi=this.getFirstValidPoint(n,Mt-1,-1),Ei=Ji=>!!(hu(Ji)&&(Te||Nl(Ji[0])));if(Nl(Ti)&&Nl(hi)){let Ji=[],er=[];for(let Is of n)Ji.push(this.autoIncrement()),er.push(Is);ee.setColumns({x:Ji,[fe]:er})}else if(Ei(Ti)&&Ei(hi))if(ve){let Ji=+(Ti.length===ve),er=Array(ae.length).fill(0).map(()=>[]);for(let Is of n){Ji&&er[0].push(this.autoIncrement());for(let Hs=Ji;Hs<=ve;Hs++)(Nt=er[Hs])==null||Nt.push(Is[Hs-Ji])}ee.setColumns(ae.reduce((Is,Hs,qs)=>(Is[Hs]=er[qs],Is),{}))}else{Te&&(Ke=Te.indexOf("x"),Tt=Te.indexOf("y"),Ke=Ke>=0?Ke:0,Tt=Tt>=0?Tt:1),Ti.length===1&&(Tt=0);let Ji=[],er=[];if(Ke===Tt)for(let Is of n)Ji.push(this.autoIncrement()),er.push(Is[Tt]);else for(let Is of n)Ji.push(Is[Ke]),er.push(Is[Tt]);ee.setColumns({x:Ji,[fe]:er})}else $t=!1}if(!$t){let Ti=ae.reduce((hi,Ei)=>(hi[Ei]=[],hi),{});for(Ae=0;Ae<Mt;Ae++){let hi=this.pointClass.prototype.applyOptions.apply({series:this},[n[Ae]]);for(let Ei of ae)Ti[Ei][Ae]=hi[Ei]}ee.setColumns(Ti)}for(_a(this.getColumn("y")[0])&&xa(14,!0,N),this.data=[],this.options.data=this.userOptions.data=n,Ae=L;Ae--;)(Rt=k[Ae])==null||Rt.destroy();se&&(se.minRange=se.userMinRange),this.isDirty=N.isDirtyBox=!0,this.isDirtyData=!!k,x=!1}R.legendType==="point"&&(this.processData(),this.generatePoints()),m&&N.redraw(x)}sortData(n){let m=this,x=m.options.dataSorting.sortKey||"y",S=function(k,L){return Fl(L)&&k.pointClass.prototype.optionsToObject.call({series:k},L)||{}};return n.forEach(function(k,L){n[L]=S(m,k),n[L].index=L},this),n.concat().sort((k,L)=>{let R=ia(x,k),N=ia(x,L);return N<R?-1:+(N>R)}).forEach(function(k,L){k.x=L},this),m.linkedSeries&&m.linkedSeries.forEach(function(k){var N;let L=k.options,R=L.data;!((N=L.dataSorting)!=null&&N.enabled)&&R&&(R.forEach(function(Y,se){R[se]=S(k,Y),n[se]&&(R[se].x=n[se].x,R[se].index=se)}),k.setData(R,!1))}),n}getProcessedData(n){let m=this,{dataTable:x,isCartesian:S,options:k,xAxis:L}=m,R=k.cropThreshold,N=n||m.getExtremesFromAll,Y=L==null?void 0:L.logarithmic,se=x.rowCount,$,ee,ae=0,fe,ve,Te,Ae=m.getColumn("x"),Ve=x,Ke=!1;return L&&(ve=(fe=L.getExtremes()).min,Te=fe.max,Ke=!!(L.categories&&!L.names.length),S&&m.sorted&&!N&&(!R||se>R||m.forceCrop)&&(Ae[se-1]<ve||Ae[0]>Te?Ve=new ya:m.getColumn(m.pointValKey||"y").length&&(Ae[0]<ve||Ae[se-1]>Te)&&(Ve=($=this.cropData(x,ve,Te)).modified,ae=$.start,ee=!0))),Ae=Ve.getColumn("x")||[],{modified:Ve,cropped:ee,cropStart:ae,closestPointRange:cg([Y?Ae.map(Y.log2lin):Ae],()=>m.requireSorting&&!Ke&&xa(15,!1,m.chart))}}processData(n){let m=this.xAxis,x=this.dataTable;if(this.isCartesian&&!this.isDirty&&!m.isDirty&&!this.yAxis.isDirty&&!n)return!1;let S=this.getProcessedData();x.modified=S.modified,this.cropped=S.cropped,this.cropStart=S.cropStart,this.closestPointRange=this.basePointRange=S.closestPointRange,tl(this,"afterProcessData")}cropData(n,m,x){let S=n.getColumn("x",!0)||[],k=S.length,L={},R,N,Y=0,se=k;for(R=0;R<k;R++)if(S[R]>=m){Y=Math.max(0,R-1);break}for(N=R;N<k;N++)if(S[N]>x){se=N+1;break}for(let $ of this.dataColumnKeys()){let ee=n.getColumn($,!0);ee&&(L[$]=ee.slice(Y,se))}return{modified:new ya({columns:L}),start:Y,end:se}}generatePoints(){var St,Mt,Nt;let n=this.options,m=this.processedData||n.data,x=this.dataTable.modified,S=this.getColumn("x",!0),k=this.pointClass,L=x.rowCount,R=this.cropStart||0,N=this.hasGroupedData,Y=n.keys,se=[],$=(St=n.dataGrouping)!=null&&St.groupAll?R:0,ee=(Mt=this.xAxis)==null?void 0:Mt.categories,ae=this.pointArrayMap||["y"],fe=this.dataColumnKeys(),ve,Te,Ae,Ve,Ke=this.data,Tt;if(!Ke&&!N){let Rt=[];Rt.length=(m==null?void 0:m.length)||0,Ke=this.data=Rt}for(Y&&N&&(this.options.keys=!1),Ve=0;Ve<L;Ve++)Te=R+Ve,N?((Ae=new k(this,x.getRow(Ve,fe)||[])).dataGroup=this.groupMap[$+Ve],(Nt=Ae.dataGroup)!=null&&Nt.options&&(Ae.options=Ae.dataGroup.options,Fu(Ae,Ae.dataGroup.options),delete Ae.dataLabels)):(Ae=Ke[Te],Tt=m?m[Te]:x.getRow(Ve,ae),Ae||Tt===void 0||(Ke[Te]=Ae=new k(this,Tt,S[Ve]))),Ae&&(Ae.index=N?$+Ve:Te,se[Ve]=Ae,Ae.category=(ee==null?void 0:ee[Ae.x])??Ae.x,Ae.key=Ae.name??Ae.category);if(this.options.keys=Y,Ke&&(L!==(ve=Ke.length)||N))for(Ve=0;Ve<ve;Ve++)Ve!==R||N||(Ve+=L),Ke[Ve]&&(Ke[Ve].destroyElements(),Ke[Ve].plotX=void 0);this.data=Ke,this.points=se,tl(this,"afterGeneratePoints")}getXExtremes(n){return{min:zm(n),max:vh(n)}}getExtremes(n,m){var St;let{xAxis:x,yAxis:S}=this,k=m||this.getExtremesFromAll||this.options.getExtremesFromAll,L=k&&this.cropped?this.dataTable:this.dataTable.modified,R=L.rowCount,N=n||this.stackedYData,Y=N?[N]:((St=this.keysAffectYAxis||this.pointArrayMap||["y"])==null?void 0:St.map(Mt=>L.getColumn(Mt,!0)||[]))||[],se=this.getColumn("x",!0),$=[],ee=this.requireSorting&&!this.is("column")?1:0,ae=!!S&&S.positiveValuesOnly,fe=k||this.cropped||!x,ve,Te,Ae,Ve=0,Ke=0;for(x&&(Ve=(ve=x.getExtremes()).min,Ke=ve.max),Ae=0;Ae<R;Ae++)if(Te=se[Ae],fe||(se[Ae+ee]||Te)>=Ve&&(se[Ae-ee]||Te)<=Ke)for(let Mt of Y){let Nt=Mt[Ae];Nl(Nt)&&(Nt>0||!ae)&&$.push(Nt)}let Tt={activeYData:$,dataMin:zm($),dataMax:vh($)};return tl(this,"afterGetExtremes",{dataExtremes:Tt}),Tt}applyExtremes(){let n=this.getExtremes();return this.dataMin=n.dataMin,this.dataMax=n.dataMax,n}getFirstValidPoint(n,m=0,x=1){let S=n.length,k=m;for(;k>=0&&k<S;){if(Fl(n[k]))return n[k];k+=x}}translate(){var Ke;this.generatePoints();let n=this.options,m=n.stacking,x=this.xAxis,S=this.enabledDataSorting,k=this.yAxis,L=this.points,R=L.length,N=this.pointPlacementToXValue(),Y=!!N,se=n.threshold,$=n.startFromThreshold?se:0,ee=(n==null?void 0:n.nullInteraction)&&k.len,ae,fe,ve,Te,Ae=Number.MAX_VALUE;function Ve(Tt){return Ho(Tt,-1e9,1e9)}for(ae=0;ae<R;ae++){let Tt,St=L[ae],Mt=St.x,Nt,Rt,$t=St.y,Ti=St.low,hi=m&&((Ke=k.stacking)==null?void 0:Ke.stacks[(this.negStacks&&$t<($?0:se)?"-":"")+this.stackKey]);St.plotX=Nl(fe=x.translate(Mt,!1,!1,!1,!0,N))?hg(Ve(fe)):void 0,m&&this.visible&&hi&&hi[Mt]&&(Te=this.getStackIndicator(Te,Mt,this.index),!St.isNull&&Te.key&&(Rt=(Nt=hi[Mt]).points[Te.key]),Nt&&hu(Rt)&&(Ti=Rt[0],$t=Rt[1],Ti===$&&Te.key===hi[Mt].base&&(Ti=On(Nl(se)?se:k.min)),k.positiveValuesOnly&&Fl(Ti)&&Ti<=0&&(Ti=void 0),St.total=St.stackTotal=On(Nt.total),St.percentage=Fl(St.y)&&Nt.total?St.y/Nt.total*100:void 0,St.stackY=$t,this.irregularWidths||Nt.setOffset(this.pointXOffset||0,this.barW||0,void 0,void 0,void 0,this.xAxis))),St.yBottom=Fl(Ti)?Ve(k.translate(Ti,!1,!0,!1,!0)):void 0,this.dataModify&&($t=this.dataModify.modifyValue($t,ae)),Nl($t)&&St.plotX!==void 0?Tt=Nl(Tt=k.translate($t,!1,!0,!1,!0))?Ve(Tt):void 0:!Nl($t)&&ee&&(Tt=ee),St.plotY=Tt,St.isInside=this.isPointInside(St),St.clientX=Y?hg(x.translate(Mt,!1,!1,!1,!0,N)):fe,St.negative=(St.y||0)<(se||0),St.isNull||St.visible===!1||(ve!==void 0&&(Ae=Math.min(Ae,Math.abs(fe-ve))),ve=fe),St.zone=this.zones.length?St.getZone():void 0,!St.graphic&&this.group&&S&&(St.isNew=!0)}this.closestPointRangePx=Ae,tl(this,"afterTranslate")}getValidPoints(n,m,x){let S=this.chart;return(n||this.points||[]).filter(function(k){let{plotX:L,plotY:R}=k;return(!!x||!k.isNull&&!!Nl(R))&&(!m||!!S.isInsidePlot(L,R,{inverted:S.inverted}))&&k.visible!==!1})}getSharedClipKey(){return this.sharedClipKey=(this.options.xAxis||0)+","+(this.options.yAxis||0),this.sharedClipKey}setClip(){let{chart:n,group:m,markerGroup:x}=this,S=n.sharedClips,k=n.renderer,L=n.getClipBox(this),R=this.getSharedClipKey(),N=S[R];N?N.animate(L):S[R]=N=k.clipRect(L),m&&m.clip(this.options.clip===!1?void 0:N),x&&x.clip()}animate(n){let{chart:m,group:x,markerGroup:S}=this,k=m.inverted,L=Cg(this.options.animation),R=[this.getSharedClipKey(),L.duration,L.easing,L.defer].join(","),N=m.sharedClips[R],Y=m.sharedClips[R+"m"];if(n&&x){let se=m.getClipBox(this);if(N)N.attr("height",se.height);else{se.width=0,k&&(se.x=m.plotHeight),N=m.renderer.clipRect(se),m.sharedClips[R]=N;let $={x:-99,y:-99,width:k?m.plotWidth+199:99,height:k?99:m.plotHeight+199};Y=m.renderer.clipRect($),m.sharedClips[R+"m"]=Y}x.clip(N),S==null||S.clip(Y)}else if(N&&!N.hasClass("highcharts-animating")){let se=m.getClipBox(this),$=L.step;(S!=null&&S.element.childNodes.length||m.series.length>1)&&(L.step=function(ee,ae){$&&$.apply(ae,arguments),ae.prop==="width"&&(Y!=null&&Y.element)&&Y.attr(k?"height":"width",ee+99)}),N.addClass("highcharts-animating").animate(se,L)}}afterAnimate(){this.setClip(),Rm(this.chart.sharedClips,(n,m,x)=>{n&&!this.chart.container.querySelector(`[clip-path="url(#${n.id})"]`)&&(n.destroy(),delete x[m])}),this.finishedAnimating=!0,tl(this,"afterAnimate")}drawPoints(n=this.points){let m,x,S,k,L,R,N,Y=this.chart,se=Y.styledMode,{colorAxis:$,options:ee}=this,ae=ee.marker,fe=ee.nullInteraction,ve=this[this.specialGroup||"markerGroup"],Te=this.xAxis,Ae=On(ae.enabled,!Te||!!Te.isRadial||null,this.closestPointRangePx>=ae.enabledThreshold*ae.radius);if(ae.enabled!==!1||this._hasPointMarkers)for(m=0;m<n.length;m++){k=(S=(x=n[m]).graphic)?"animate":"attr",L=x.marker||{},R=!!x.marker;let Ve=x.isNull;if((Ae&&!Fl(L.enabled)||L.enabled)&&(!Ve||fe)&&x.visible!==!1){let Ke=On(L.symbol,this.symbol,"rect");N=this.markerAttribs(x,x.selected&&"select"),this.enabledDataSorting&&(x.startXPos=Te.reversed?-(N.width||0):Te.width);let Tt=x.isInside!==!1;if(!S&&Tt&&((N.width||0)>0||x.hasImage)&&(x.graphic=S=Y.renderer.symbol(Ke,N.x,N.y,N.width,N.height,R?L:ae).add(ve),this.enabledDataSorting&&Y.hasRendered&&(S.attr({x:x.startXPos}),k="animate")),S&&k==="animate"&&S[Tt?"show":"hide"](Tt).animate(N),S){let St=this.pointAttribs(x,se||!x.selected?void 0:"select");se?$&&S.css({fill:St.fill}):S[k](St)}S&&S.addClass(x.getClassName(),!0)}else S&&(x.graphic=S.destroy())}}markerAttribs(n,m){let x=this.options,S=x.marker,k=n.marker||{},L=k.symbol||S.symbol,R={},N,Y,se=On(k.radius,S==null?void 0:S.radius);m&&(N=S.states[m],Y=k.states&&k.states[m],se=On(Y==null?void 0:Y.radius,N==null?void 0:N.radius,se&&se+((N==null?void 0:N.radiusPlus)||0))),n.hasImage=L&&L.indexOf("url")===0,n.hasImage&&(se=0);let $=n.pos();return Nl(se)&&$&&(x.crisp&&($[0]=Pg($[0],n.hasImage?0:L==="rect"?(S==null?void 0:S.lineWidth)||0:1)),R.x=$[0]-se,R.y=$[1]-se),se&&(R.width=R.height=2*se),R}pointAttribs(n,m){var Ae;let x=this.options,S=x.marker,k=n==null?void 0:n.options,L=(k==null?void 0:k.marker)||{},R=k==null?void 0:k.color,N=n==null?void 0:n.color,Y=(Ae=n==null?void 0:n.zone)==null?void 0:Ae.color,se,$,ee=this.color,ae,fe,ve=On(L.lineWidth,S.lineWidth),Te=n!=null&&n.isNull&&x.nullInteraction?0:1;return ee=R||Y||N||ee,ae=L.fillColor||S.fillColor||ee,fe=L.lineColor||S.lineColor||ee,m=m||"normal",se=S.states[m]||{},ve=On(($=L.states&&L.states[m]||{}).lineWidth,se.lineWidth,ve+On($.lineWidthPlus,se.lineWidthPlus,0)),ae=$.fillColor||se.fillColor||ae,fe=$.lineColor||se.lineColor||fe,{stroke:fe,"stroke-width":ve,fill:ae,opacity:Te=On($.opacity,se.opacity,Te)}}destroy(n){var N,Y;let m,x,S=this,k=S.chart,L=/AppleWebKit\/533/.test(Tp.navigator.userAgent),R=S.data||[];for(tl(S,"destroy",{keepEventsForUpdate:n}),this.removeEvents(n),(S.axisTypes||[]).forEach(function(se){x=S[se],x!=null&&x.series&&(ny(x.series,S),x.isDirty=x.forceRedraw=!0)}),S.legendItem&&S.chart.legend.destroyItem(S),m=R.length;m--;)(Y=(N=R[m])==null?void 0:N.destroy)==null||Y.call(N);for(let se of S.zones)ip(se,void 0,!0);Gs.clearTimeout(S.animationTimeout),Rm(S,function(se,$){se instanceof La&&!se.survive&&se[L&&$==="group"?"hide":"destroy"]()}),k.hoverSeries===S&&(k.hoverSeries=void 0),ny(k.series,S),k.orderItems("series"),Rm(S,function(se,$){n&&$==="hcEvents"||delete S[$]})}applyZones(){let{area:n,chart:m,graph:x,zones:S,points:k,xAxis:L,yAxis:R,zoneAxis:N}=this,{inverted:Y,renderer:se}=m,$=this[`${N}Axis`],{isXAxis:ee,len:ae=0,minPointOffset:fe=0}=$||{},ve=((x==null?void 0:x.strokeWidth())||0)/2+1,Te=(Ae,Ve=0,Ke=0)=>{Y&&(Ke=ae-Ke);let{translated:Tt=0,lineClip:St}=Ae,Mt=Ke-Tt;St==null||St.push(["L",Ve,Math.abs(Mt)<ve?Ke-ve*(Mt<=0?-1:1):Tt])};if(S.length&&(x||n)&&$&&Nl($.min)){let Ae=$.getExtremes().max+fe,Ve=St=>{St.forEach((Mt,Nt)=>{(Mt[0]==="M"||Mt[0]==="L")&&(St[Nt]=[Mt[0],ee?ae-Mt[1]:Mt[1],ee?Mt[2]:ae-Mt[2]])})};if(S.forEach(St=>{St.lineClip=[],St.translated=Ho($.toPixels(On(St.value,Ae),!0)||0,0,ae)}),x&&!this.showLine&&x.hide(),n&&n.hide(),N==="y"&&k.length<L.len)for(let St of k){let{plotX:Mt,plotY:Nt,zone:Rt}=St,$t=Rt&&S[S.indexOf(Rt)-1];Rt&&Te(Rt,Mt,Nt),$t&&Te($t,Mt,Nt)}let Ke=[],Tt=$.toPixels($.getExtremes().min-fe,!0);S.forEach(St=>{var Hs,qs;let Mt=St.lineClip||[],Nt=Math.round(St.translated||0);L.reversed&&Mt.reverse();let{clip:Rt,simpleClip:$t}=St,Ti=0,hi=0,Ei=L.len,Ji=R.len;ee?(Ti=Nt,Ei=Tt):(hi=Nt,Ji=Tt);let er=[["M",Ti,hi],["L",Ei,hi],["L",Ei,Ji],["L",Ti,Ji],["Z"]],Is=[er[0],...Mt,er[1],er[2],...Ke,er[3],er[4]];Ke=Mt.reverse(),Tt=Nt,Y&&(Ve(Is),n&&Ve(er)),Rt?(Rt.animate({d:Is}),$t==null||$t.animate({d:er})):(Rt=St.clip=se.path(Is),n&&($t=St.simpleClip=se.path(er))),x&&((Hs=St.graph)==null||Hs.clip(Rt)),n&&((qs=St.area)==null||qs.clip($t))})}else this.visible&&(x&&x.show(),n&&n.show())}plotGroup(n,m,x,S,k){let L=this[n],R=!L,N={visibility:x,zIndex:S||.1};return Fl(this.opacity)&&!this.chart.styledMode&&this.state!=="inactive"&&(N.opacity=this.opacity),L||(this[n]=L=this.chart.renderer.g().add(k)),L.addClass("highcharts-"+m+" highcharts-series-"+this.index+" highcharts-"+this.type+"-series "+(Fl(this.colorIndex)?"highcharts-color-"+this.colorIndex+" ":"")+(this.options.className||"")+(L.hasClass("highcharts-tracker")?" highcharts-tracker":""),!0),L.attr(N)[R?"attr":"animate"](this.getPlotBox(m)),L}getPlotBox(n){let m=this.xAxis,x=this.yAxis,S=this.chart,k=S.inverted&&!S.polar&&m&&this.invertible&&n==="series";S.inverted&&(m=x,x=this.xAxis);let L={scale:1,translateX:m?m.left:S.plotLeft,translateY:x?x.top:S.plotTop,name:n};tl(this,"getPlotBox",L);let{scale:R,translateX:N,translateY:Y}=L;return{translateX:N,translateY:Y,rotation:90*!!k,rotationOriginX:k?R*(m.len-x.len)/2:0,rotationOriginY:k?R*(m.len+x.len)/2:0,scaleX:k?-R:R,scaleY:R}}removeEvents(n){let{eventsToUnbind:m}=this;n||Vo(this),m.length&&(m.forEach(x=>{x()}),m.length=0)}render(){var se,$,ee,ae,fe;let n=this,{chart:m,options:x,hasRendered:S}=n,k=Cg(x.animation),L=n.visible?"inherit":"hidden",R=x.zIndex,N=m.seriesGroup,Y=n.finishedAnimating?0:k.duration;tl(this,"render"),n.plotGroup("group","series",L,R,N),n.markerGroup=n.plotGroup("markerGroup","markers",L,R,N),x.clip!==!1&&n.setClip(),Y&&((se=n.animate)==null||se.call(n,!0)),n.drawGraph&&(n.drawGraph(),n.applyZones()),n.visible&&n.drawPoints(),($=n.drawDataLabels)==null||$.call(n),(ee=n.redrawPoints)==null||ee.call(n),x.enableMouseTracking&&((ae=n.drawTracker)==null||ae.call(n)),Y&&((fe=n.animate)==null||fe.call(n)),S||(Y&&k.defer&&(Y+=k.defer),n.animationTimeout=bo(()=>{n.afterAnimate()},Y||0)),n.isDirty=!1,n.hasRendered=!0,tl(n,"afterRender")}redraw(){let n=this.isDirty||this.isDirtyData;this.translate(),this.render(),n&&delete this.kdTree}reserveSpace(){return this.visible||!this.chart.options.chart.ignoreHiddenSeries}searchPoint(n,m){let{xAxis:x,yAxis:S}=this,k=this.chart.inverted;return this.searchKDTree({clientX:k?x.len-n.chartY+x.pos:n.chartX-x.pos,plotY:k?S.len-n.chartX+S.pos:n.chartY-S.pos},m,n)}buildKDTree(n){this.buildingKdTree=!0;let m=this,x=m.options,S=x.findNearestPointBy.indexOf("y")>-1?2:1;delete m.kdTree,bo(function(){m.kdTree=function k(L,R,N){let Y,se,$=L==null?void 0:L.length;if($)return Y=m.kdAxisArray[R%N],L.sort((ee,ae)=>(ee[Y]||0)-(ae[Y]||0)),{point:L[se=Math.floor($/2)],left:k(L.slice(0,se),R+1,N),right:k(L.slice(se+1),R+1,N)}}(m.getValidPoints(void 0,!m.directTouch,x==null?void 0:x.nullInteraction),S,S),m.buildingKdTree=!1},x.kdNow||(n==null?void 0:n.type)==="touchstart"?0:1)}searchKDTree(n,m,x,S,k){let L=this,[R,N]=this.kdAxisArray,Y=m?"distX":"dist",se=(L.options.findNearestPointBy||"").indexOf("y")>-1?2:1,$=!!L.isBubble,ee=S||((fe,ve,Te)=>{let Ae=fe[Te]||0,Ve=ve[Te]||0;return[Ae===Ve&&fe.index>ve.index||Ae<Ve?fe:ve,!1]}),ae=k||((fe,ve)=>fe<ve);if(this.kdTree||this.buildingKdTree||this.buildKDTree(x),this.kdTree)return function fe(ve,Te,Ae,Ve){var Ti;let Ke=Te.point,Tt=L.kdAxisArray[Ae%Ve],St=Ke,Mt=!1;(function(hi,Ei){var wr;let Ji=hi[R],er=Ei[R],Is=Fl(Ji)&&Fl(er)?Ji-er:null,Hs=hi[N],qs=Ei[N],dr=Fl(Hs)&&Fl(qs)?Hs-qs:0,xr=$&&((wr=Ei.marker)==null?void 0:wr.radius)||0;Ei.dist=Math.sqrt((Is&&Is*Is||0)+dr*dr)-xr,Ei.distX=Fl(Is)?Math.abs(Is)-xr:Number.MAX_VALUE})(ve,Ke);let Nt=(ve[Tt]||0)-(Ke[Tt]||0)+($&&((Ti=Ke.marker)==null?void 0:Ti.radius)||0),Rt=Nt<0?"left":"right",$t=Nt<0?"right":"left";return Te[Rt]&&([St,Mt]=ee(Ke,fe(ve,Te[Rt],Ae+1,Ve),Y)),Te[$t]&&ae(Math.sqrt(Nt*Nt),St[Y],Mt)&&(St=ee(St,fe(ve,Te[$t],Ae+1,Ve),Y)[0]),St}(n,this.kdTree,se,se)}pointPlacementToXValue(){let{options:n,xAxis:m}=this,x=n.pointPlacement;return x==="between"&&(x=m.reversed?-.5:.5),Nl(x)?x*(n.pointRange||m.pointRange):0}isPointInside(n){let{chart:m,xAxis:x,yAxis:S}=this,{plotX:k=-1,plotY:L=-1}=n;return L>=0&&L<=(S?S.len:m.plotHeight)&&k>=0&&k<=(x?x.len:m.plotWidth)}drawTracker(){var ee;let n=this,m=n.options,x=m.trackByArea,S=[].concat((x?n.areaPath:n.graphPath)||[]),k=n.chart,L=k.pointer,R=k.renderer,N=((ee=k.options.tooltip)==null?void 0:ee.snap)||0,Y=()=>{m.enableMouseTracking&&k.hoverSeries!==n&&n.onMouseOver()},se="rgba(192,192,192,"+(ms?1e-4:.002)+")",$=n.tracker;$?$.attr({d:S}):n.graph&&(n.tracker=$=R.path(S).attr({visibility:n.visible?"inherit":"hidden",zIndex:2}).addClass(x?"highcharts-tracker-area":"highcharts-tracker-line").add(n.group),k.styledMode||$.attr({"stroke-linecap":"round","stroke-linejoin":"round",stroke:se,fill:x?se:"none","stroke-width":n.graph.strokeWidth()+(x?0:2*N)}),[n.tracker,n.markerGroup,n.dataLabelsGroup].forEach(ae=>{ae&&(ae.addClass("highcharts-tracker").on("mouseover",Y).on("mouseout",fe=>{L==null||L.onTrackerMouseOut(fe)}),m.cursor&&!k.styledMode&&ae.css({cursor:m.cursor}),ae.on("touchstart",Y))})),tl(this,"afterDrawTracker")}addPoint(n,m,x,S,k){let L,R,N=this.options,{chart:Y,data:se,dataTable:$,xAxis:ee}=this,ae=(ee==null?void 0:ee.hasNames)&&ee.names,fe=N.data,ve=this.getColumn("x");m=On(m,!0);let Te={series:this};this.pointClass.prototype.applyOptions.apply(Te,[n]);let Ae=Te.x;if(R=ve.length,this.requireSorting&&Ae<ve[R-1])for(L=!0;R&&ve[R-1]>Ae;)R--;$.setRow(Te,R,!0,{addColumns:!1}),ae&&Te.name&&(ae[Ae]=Te.name),fe==null||fe.splice(R,0,n),(L||this.processedData)&&(this.data.splice(R,0,null),this.processData()),N.legendType==="point"&&this.generatePoints(),x&&(se[0]&&se[0].remove?se[0].remove(!1):([se,fe].filter(Fl).forEach(Ve=>{Ve.shift()}),$.deleteRows(0))),k!==!1&&tl(this,"addPoint",{point:Te}),this.isDirty=!0,this.isDirtyData=!0,m&&Y.redraw(S)}removePoint(n,m,x){let S=this,{chart:k,data:L,points:R,dataTable:N}=S,Y=L[n],se=function(){[(R==null?void 0:R.length)===L.length?R:void 0,L,S.options.data].filter(Fl).forEach($=>{$.splice(n,1)}),N.deleteRows(n),Y==null||Y.destroy(),S.isDirty=!0,S.isDirtyData=!0,m&&k.redraw()};wf(x,k),m=On(m,!0),Y?Y.firePointEvent("remove",null,se):se()}remove(n,m,x,S){let k=this,L=k.chart;function R(){k.destroy(S),L.isDirtyLegend=L.isDirtyBox=!0,L.linkSeries(S),On(n,!0)&&L.redraw(m)}x!==!1?tl(k,"remove",null,R):R()}update(n,m){var Ae,Ve;tl(this,"update",{options:n=Ml(n,this.userOptions)});let x=this,S=x.chart,k=x.userOptions,L=x.initialType||x.type,R=S.options.plotOptions,N=kn[L].prototype,Y=x.finishedAnimating&&{animation:!1},se={},$,ee,ae=Dd.keepProps.slice(),fe=n.type||k.type||S.options.chart.type,ve=!(this.hasDerivedData||fe&&fe!==this.type||n.keys!==void 0||n.pointStart!==void 0||n.pointInterval!==void 0||n.relativeXValue!==void 0||n.joinBy||n.mapData||["dataGrouping","pointStart","pointInterval","pointIntervalUnit","keys"].some(Ke=>x.hasOptionChanged(Ke)));fe=fe||L,ve?(ae.push.apply(ae,Dd.keepPropsForPoints),n.visible!==!1&&ae.push("area","graph"),x.parallelArrays.forEach(function(Ke){ae.push(Ke+"Data")}),n.data&&(n.dataSorting&&Fu(x.options.dataSorting,n.dataSorting),this.setData(n.data,!1))):this.dataTable.modified=this.dataTable,n=th(k,{index:k.index===void 0?x.index:k.index,pointStart:((Ae=R==null?void 0:R.series)==null?void 0:Ae.pointStart)??k.pointStart??x.getColumn("x")[0]},!ve&&{data:x.options.data},n,Y),ve&&n.data&&(n.data=x.options.data),(ae=["group","markerGroup","dataLabelsGroup","transformGroup"].concat(ae)).forEach(function(Ke){ae[Ke]=x[Ke],delete x[Ke]});let Te=!1;if(kn[fe]){if(Te=fe!==x.type,x.remove(!1,!1,!1,!0),Te)if(S.propFromSeries(),Object.setPrototypeOf)Object.setPrototypeOf(x,kn[fe].prototype);else{let Ke=Object.hasOwnProperty.call(x,"hcEvents")&&x.hcEvents;for(ee in N)x[ee]=void 0;Fu(x,kn[fe].prototype),Ke?x.hcEvents=Ke:delete x.hcEvents}}else xa(17,!0,S,{missingModuleFor:fe});if(ae.forEach(function(Ke){x[Ke]=ae[Ke]}),x.init(S,n),ve&&this.points)for(let Ke of(($=x.options).visible===!1?(se.graphic=1,se.dataLabel=1):(this.hasMarkerChanged($,k)&&(se.graphic=1),(Ve=x.hasDataLabels)!=null&&Ve.call(x)||(se.dataLabel=1)),this.points))Ke!=null&&Ke.series&&(Ke.resolveColor(),Object.keys(se).length&&Ke.destroyElements(se),$.showInLegend===!1&&Ke.legendItem&&S.legend.destroyItem(Ke));x.initialType=L,S.linkSeries(),S.setSortedData(),Te&&x.linkedSeries.length&&(x.isDirtyData=!0),tl(this,"afterUpdate"),On(m,!0)&&S.redraw(!!ve&&void 0)}setName(n){this.name=this.options.name=this.userOptions.name=n,this.chart.isDirtyLegend=!0}hasOptionChanged(n){var R,N;let m=this.chart,x=this.options[n],S=m.options.plotOptions,k=this.userOptions[n],L=On((R=S==null?void 0:S[this.type])==null?void 0:R[n],(N=S==null?void 0:S.series)==null?void 0:N[n]);return k&&!Fl(L)?x!==k:x!==On(L,x)}onMouseOver(){let n=this.chart,m=n.hoverSeries,x=n.pointer;x==null||x.setHoverChartIndex(),m&&m!==this&&m.onMouseOut(),this.options.events.mouseOver&&tl(this,"mouseOver"),this.setState("hover"),n.hoverSeries=this}onMouseOut(){let n=this.options,m=this.chart,x=m.tooltip,S=m.hoverPoint;m.hoverSeries=null,S&&S.onMouseOut(),this&&n.events.mouseOut&&tl(this,"mouseOut"),x&&!this.stickyTracking&&(!x.shared||this.noSharedTooltip)&&x.hide(),m.series.forEach(function(k){k.setState("",!0)})}setState(n,m){let x=this,S=x.options,k=x.graph,L=S.inactiveOtherPoints,R=S.states,N=On(R[n||"normal"]&&R[n||"normal"].animation,x.chart.options.chart.animation),Y=S.lineWidth,se=S.opacity;if(n=n||"",x.state!==n&&([x.group,x.markerGroup,x.dataLabelsGroup].forEach(function($){$&&(x.state&&$.removeClass("highcharts-series-"+x.state),n&&$.addClass("highcharts-series-"+n))}),x.state=n,!x.chart.styledMode)){if(R[n]&&R[n].enabled===!1)return;if(n&&(Y=R[n].lineWidth||Y+(R[n].lineWidthPlus||0),se=On(R[n].opacity,se)),k&&!k.dashstyle&&Nl(Y))for(let $ of[k,...this.zones.map(ee=>ee.graph)])$==null||$.animate({"stroke-width":Y},N);L||[x.group,x.markerGroup,x.dataLabelsGroup,x.labelBySeries].forEach(function($){$&&$.animate({opacity:se},N)})}m&&L&&x.points&&x.setAllPointsToState(n||void 0)}setAllPointsToState(n){this.points.forEach(function(m){m.setState&&m.setState(n)})}setVisible(n,m){var N;let x=this,S=x.chart,k=S.options.chart.ignoreHiddenSeries,L=x.visible;x.visible=n=x.options.visible=x.userOptions.visible=n===void 0?!L:n;let R=n?"show":"hide";["group","dataLabelsGroup","markerGroup","tracker","tt"].forEach(Y=>{var se;(se=x[Y])==null||se[R]()}),(S.hoverSeries===x||((N=S.hoverPoint)==null?void 0:N.series)===x)&&x.onMouseOut(),x.legendItem&&S.legend.colorizeItem(x,n),x.isDirty=!0,x.options.stacking&&S.series.forEach(Y=>{Y.options.stacking&&Y.visible&&(Y.isDirty=!0)}),x.linkedSeries.forEach(Y=>{Y.setVisible(n,!1)}),k&&(S.isDirtyBox=!0),tl(x,R),m!==!1&&S.redraw()}show(){this.setVisible(!0)}hide(){this.setVisible(!1)}select(n){this.selected=n=this.options.selected=n===void 0?!this.selected:n,this.checkbox&&(this.checkbox.checked=n),tl(this,n?"select":"unselect")}shouldShowTooltip(n,m,x={}){return x.series=this,x.visiblePlotOnly=!0,this.chart.isInsidePlot(n,m,x)}drawLegendSymbol(n,m){var x;(x=qr[this.options.legendSymbol||"rectangle"])==null||x.call(this,n,m)}}Dd.defaultOptions={lineWidth:2,allowPointSelect:!1,crisp:!0,showCheckbox:!1,animation:{duration:1e3},enableMouseTracking:!0,events:{},marker:{enabledThreshold:2,lineColor:"#ffffff",lineWidth:0,radius:4,states:{normal:{animation:!0},hover:{animation:{duration:150},enabled:!0,radiusPlus:2,lineWidthPlus:1},select:{fillColor:"#cccccc",lineColor:"#000000",lineWidth:2}}},point:{events:{}},dataLabels:{animation:{},align:"center",borderWidth:0,defer:!0,formatter:function(){let{numberFormatter:H}=this.series.chart;return typeof this.y!="number"?"":H(this.y,-1)},padding:5,style:{fontSize:"0.7em",fontWeight:"bold",color:"contrast",textOutline:"1px contrast"},verticalAlign:"bottom",x:0,y:0},cropThreshold:300,opacity:1,pointRange:0,softThreshold:!0,states:{normal:{animation:!0},hover:{animation:{duration:150},lineWidthPlus:1,marker:{},halo:{size:10,opacity:.25}},select:{animation:{duration:0}},inactive:{animation:{duration:150},opacity:.2}},stickyTracking:!0,turboThreshold:1e3,findNearestPointBy:"x"},Dd.types=pn.seriesTypes,Dd.registerType=pn.registerSeriesType,Dd.keepProps=["colorIndex","eventOptions","navigatorSeries","symbolIndex","baseSeries"],Dd.keepPropsForPoints=["data","isDirtyData","isDirtyCanvas","points","dataTable","processedData","xIncrement","cropped","_hasPointMarkers","hasDataLabels","nodes","layout","level","mapMap","mapData","minY","maxY","minX","maxX","transformGroups"],Fu(Dd.prototype,{axisTypes:["xAxis","yAxis"],coll:"series",colorCounter:0,directTouch:!1,invertible:!0,isCartesian:!0,kdAxisArray:["clientX","plotY"],parallelArrays:["x","y"],pointClass:bt,requireSorting:!0,sorted:!0}),pn.series=Dd;let Vl=Dd,{animObject:Tf,setAnimation:Sf}=Oo,{registerEventOptions:Sp}=Pd,{composed:Nu,marginNames:Mp}=fi,{distribute:cu}=Gr,{format:dd}=ja,{addEvent:Xc,createElement:Kp,css:Bm,defined:ud,discardElement:Ap,find:zd,fireEvent:wn,isNumber:Mf,merge:wc,pick:Tc,pushUnique:dg,relativeLength:lm,stableSort:du,syncTimeout:ml}=Gs;class Jp{constructor(n,m){this.allItems=[],this.initialItemY=0,this.itemHeight=0,this.itemMarginBottom=0,this.itemMarginTop=0,this.itemX=0,this.itemY=0,this.lastItemY=0,this.lastLineHeight=0,this.legendHeight=0,this.legendWidth=0,this.maxItemWidth=0,this.maxLegendWidth=0,this.offsetWidth=0,this.padding=0,this.pages=[],this.symbolHeight=0,this.symbolWidth=0,this.titleHeight=0,this.totalItemWidth=0,this.widthOption=0,this.chart=n,this.setOptions(m),m.enabled&&(this.render(),Sp(this,m),Xc(this.chart,"endResize",function(){this.legend.positionCheckboxes()})),Xc(this.chart,"render",()=>{this.options.enabled&&this.proximate&&(this.proximatePositions(),this.positionItems())})}setOptions(n){let m=Tc(n.padding,8);this.options=n,this.chart.styledMode||(this.itemStyle=n.itemStyle,this.itemHiddenStyle=wc(this.itemStyle,n.itemHiddenStyle)),this.itemMarginTop=n.itemMarginTop,this.itemMarginBottom=n.itemMarginBottom,this.padding=m,this.initialItemY=m-5,this.symbolWidth=Tc(n.symbolWidth,16),this.pages=[],this.proximate=n.layout==="proximate"&&!this.chart.inverted,this.baseline=void 0}update(n,m){let x=this.chart;this.setOptions(wc(!0,this.options,n)),"events"in this.options&&Sp(this,this.options),this.destroy(),x.isDirtyLegend=x.isDirtyBox=!0,Tc(m,!0)&&x.redraw(),wn(this,"afterUpdate",{redraw:m})}colorizeItem(n,m){var Y;let x=n.color,{area:S,group:k,label:L,line:R,symbol:N}=n.legendItem||{};if((n instanceof Vl||n instanceof bt)&&(n.color=((Y=n.options)==null?void 0:Y.legendSymbolColor)||x),k==null||k[m?"removeClass":"addClass"]("highcharts-legend-item-hidden"),!this.chart.styledMode){let{itemHiddenStyle:se={}}=this,$=se.color,{fillColor:ee,fillOpacity:ae,lineColor:fe,marker:ve}=n.options,Te=Ae=>(!m&&(Ae.fill&&(Ae.fill=$),Ae.stroke&&(Ae.stroke=$)),Ae);L==null||L.css(wc(m?this.itemStyle:se)),R==null||R.attr(Te({stroke:fe||n.color})),N&&N.attr(Te(ve&&N.isMarker?n.pointAttribs():{fill:n.color})),S==null||S.attr(Te({fill:ee||n.color,"fill-opacity":ee?1:ae??.75}))}n.color=x,wn(this,"afterColorizeItem",{item:n,visible:m})}positionItems(){this.allItems.forEach(this.positionItem,this),this.chart.isResizing||this.positionCheckboxes()}positionItem(n){let{group:m,x=0,y:S=0}=n.legendItem||{},k=this.options,L=k.symbolPadding,R=!k.rtl,N=n.checkbox;if(m!=null&&m.element){let Y={translateX:R?x:this.legendWidth-x-2*L-4,translateY:S};m[ud(m.translateY)?"animate":"attr"](Y,void 0,()=>{wn(this,"afterPositionItem",{item:n})})}N&&(N.x=x,N.y=S)}destroyItem(n){let m=n.checkbox,x=n.legendItem||{};for(let S of["group","label","line","symbol"])x[S]&&(x[S]=x[S].destroy());m&&Ap(m),n.legendItem=void 0}destroy(){for(let n of this.getAllItems())this.destroyItem(n);for(let n of["clipRect","up","down","pager","nav","box","title","group"])this[n]&&(this[n]=this[n].destroy());this.display=null}positionCheckboxes(){var k;let n,m=(k=this.group)==null?void 0:k.alignAttr,x=this.clipHeight||this.legendHeight,S=this.titleHeight;m&&(n=m.translateY,this.allItems.forEach(function(L){let R,N=L.checkbox;N&&(R=n+S+N.y+(this.scrollOffset||0)+3,Bm(N,{left:m.translateX+L.checkboxOffset+N.x-20+"px",top:R+"px",display:this.proximate||R>n-6&&R<n+x-6?"":"none"}))},this))}renderTitle(){let n=this.options,m=this.padding,x=n.title,S,k=0;x.text&&(this.title||(this.title=this.chart.renderer.label(x.text,m-3,m-4,void 0,void 0,void 0,n.useHTML,void 0,"legend-title").attr({zIndex:1}),this.chart.styledMode||this.title.css(x.style),this.title.add(this.group)),x.width||this.title.css({width:this.maxLegendWidth+"px"}),k=(S=this.title.getBBox()).height,this.offsetWidth=S.width,this.contentGroup.attr({translateY:k})),this.titleHeight=k}setText(n){let m=this.options;n.legendItem.label.attr({text:m.labelFormat?dd(m.labelFormat,n,this.chart):m.labelFormatter.call(n)})}renderItem(n){var Nt;let m=n.legendItem=n.legendItem||{},x=this.chart,S=x.renderer,k=this.options,L=k.layout==="horizontal",R=this.symbolWidth,N=k.symbolPadding||0,Y=this.itemStyle,se=this.itemHiddenStyle,$=L?Tc(k.itemDistance,20):0,ee=!k.rtl,ae=!n.series,fe=!ae&&n.series.drawLegendSymbol?n.series:n,ve=fe.options,Te=!!this.createCheckboxForItem&&ve&&ve.showCheckbox,Ae=k.useHTML,Ve=n.options.className,Ke=m.label,Tt=R+N+$+20*!!Te;!Ke&&(m.group=S.g("legend-item").addClass("highcharts-"+fe.type+"-series highcharts-color-"+n.colorIndex+(Ve?" "+Ve:"")+(ae?" highcharts-series-"+n.index:"")).attr({zIndex:1}).add(this.scrollGroup),m.label=Ke=S.text("",ee?R+N:-N,this.baseline||0,Ae),x.styledMode||Ke.css(wc(n.visible?Y:se)),Ke.attr({align:ee?"left":"right",zIndex:2}).add(m.group),!this.baseline&&(this.fontMetrics=S.fontMetrics(Ke),this.baseline=this.fontMetrics.f+3+this.itemMarginTop,Ke.attr("y",this.baseline),this.symbolHeight=Tc(k.symbolHeight,this.fontMetrics.f),k.squareSymbol&&(this.symbolWidth=Tc(k.symbolWidth,Math.max(this.symbolHeight,16)),Tt=this.symbolWidth+N+$+20*!!Te,ee&&Ke.attr("x",this.symbolWidth+N))),fe.drawLegendSymbol(this,n),this.setItemEvents&&this.setItemEvents(n,Ke,Ae)),Te&&!n.checkbox&&this.createCheckboxForItem&&this.createCheckboxForItem(n),this.colorizeItem(n,n.visible),(x.styledMode||!Y.width)&&Ke.css({width:(k.itemWidth||this.widthOption||x.spacingBox.width)-Tt+"px"}),this.setText(n);let St=Ke.getBBox(),Mt=((Nt=this.fontMetrics)==null?void 0:Nt.h)||0;n.itemWidth=n.checkboxOffset=k.itemWidth||m.labelWidth||St.width+Tt,this.maxItemWidth=Math.max(this.maxItemWidth,n.itemWidth),this.totalItemWidth+=n.itemWidth,this.itemHeight=n.itemHeight=Math.round(m.labelHeight||(St.height>1.5*Mt?St.height:Mt))}layoutItem(n){let m=this.options,x=this.padding,S=m.layout==="horizontal",k=n.itemHeight,L=this.itemMarginBottom,R=this.itemMarginTop,N=S?Tc(m.itemDistance,20):0,Y=this.maxLegendWidth,se=m.alignColumns&&this.totalItemWidth>Y?this.maxItemWidth:n.itemWidth,$=n.legendItem||{};S&&this.itemX-x+se>Y&&(this.itemX=x,this.lastLineHeight&&(this.itemY+=R+this.lastLineHeight+L),this.lastLineHeight=0),this.lastItemY=R+this.itemY+L,this.lastLineHeight=Math.max(k,this.lastLineHeight),$.x=this.itemX,$.y=this.itemY,S?this.itemX+=se:(this.itemY+=R+k+L,this.lastLineHeight=k),this.offsetWidth=this.widthOption||Math.max((S?this.itemX-x-(n.checkbox?0:N):se)+x,this.offsetWidth)}getAllItems(){let n=[];return this.chart.series.forEach(function(m){var S;let x=m==null?void 0:m.options;m&&Tc(x.showInLegend,!ud(x.linkedTo)&&void 0,!0)&&(n=n.concat(((S=m.legendItem)==null?void 0:S.labels)||(x.legendType==="point"?m.data:m)))}),wn(this,"afterGetAllItems",{allItems:n}),n}getAlignment(){let n=this.options;return this.proximate?n.align.charAt(0)+"tv":n.floating?"":n.align.charAt(0)+n.verticalAlign.charAt(0)+n.layout.charAt(0)}adjustMargins(n,m){let x=this.chart,S=this.options,k=this.getAlignment();k&&[/(lth|ct|rth)/,/(rtv|rm|rbv)/,/(rbh|cb|lbh)/,/(lbv|lm|ltv)/].forEach(function(L,R){L.test(k)&&!ud(n[R])&&(x[Mp[R]]=Math.max(x[Mp[R]],x.legend[(R+1)%2?"legendHeight":"legendWidth"]+[1,-1,-1,1][R]*S[R%2?"x":"y"]+Tc(S.margin,12)+m[R]+(x.titleOffset[R]||0)))})}proximatePositions(){let n,m=this.chart,x=[],S=this.options.align==="left";for(let k of(this.allItems.forEach(function(L){let R,N,Y=S,se,$;L.yAxis&&(L.xAxis.options.reversed&&(Y=!Y),L.points&&(R=zd(Y?L.points:L.points.slice(0).reverse(),function(ee){return Mf(ee.plotY)})),N=this.itemMarginTop+L.legendItem.label.getBBox().height+this.itemMarginBottom,$=L.yAxis.top-m.plotTop,se=L.visible?(R?R.plotY:L.yAxis.height)+($-.3*N):$+L.yAxis.height,x.push({target:se,size:N,item:L}))},this),cu(x,m.plotHeight)))n=k.item.legendItem||{},Mf(k.pos)&&(n.y=m.plotTop-m.spacing[0]+k.pos)}render(){let n=this.chart,m=n.renderer,x=this.options,S=this.padding,k=this.getAllItems(),L,R,N,Y=this.group,se,$=this.box;this.itemX=S,this.itemY=this.initialItemY,this.offsetWidth=0,this.lastItemY=0,this.widthOption=lm(x.width,n.spacingBox.width-S),se=n.spacingBox.width-2*S-x.x,["rm","lm"].indexOf(this.getAlignment().substring(0,2))>-1&&(se/=2),this.maxLegendWidth=this.widthOption||se,Y||(this.group=Y=m.g("legend").addClass(x.className||"").attr({zIndex:7}).add(),this.contentGroup=m.g().attr({zIndex:1}).add(Y),this.scrollGroup=m.g().add(this.contentGroup)),this.renderTitle(),du(k,(ee,ae)=>{var fe,ve;return(((fe=ee.options)==null?void 0:fe.legendIndex)||0)-(((ve=ae.options)==null?void 0:ve.legendIndex)||0)}),x.reversed&&k.reverse(),this.allItems=k,this.display=L=!!k.length,this.lastLineHeight=0,this.maxItemWidth=0,this.totalItemWidth=0,this.itemHeight=0,k.forEach(this.renderItem,this),k.forEach(this.layoutItem,this),R=(this.widthOption||this.offsetWidth)+S,N=this.lastItemY+this.lastLineHeight+this.titleHeight,N=this.handleOverflow(N)+S,$||(this.box=$=m.rect().addClass("highcharts-legend-box").attr({r:x.borderRadius}).add(Y)),n.styledMode||$.attr({stroke:x.borderColor,"stroke-width":x.borderWidth||0,fill:x.backgroundColor||"none"}).shadow(x.shadow),R>0&&N>0&&$[$.placed?"animate":"attr"]($.crisp.call({},{x:0,y:0,width:R,height:N},$.strokeWidth())),Y[L?"show":"hide"](),n.styledMode&&Y.getStyle("display")==="none"&&(R=N=0),this.legendWidth=R,this.legendHeight=N,L&&this.align(),this.proximate||this.positionItems(),wn(this,"afterRender")}align(n=this.chart.spacingBox){let m=this.chart,x=this.options,S=n.y;/(lth|ct|rth)/.test(this.getAlignment())&&m.titleOffset[0]>0?S+=m.titleOffset[0]:/(lbh|cb|rbh)/.test(this.getAlignment())&&m.titleOffset[2]>0&&(S-=m.titleOffset[2]),S!==n.y&&(n=wc(n,{y:S})),m.hasRendered||(this.group.placed=!1),this.group.align(wc(x,{width:this.legendWidth,height:this.legendHeight,verticalAlign:this.proximate?"top":x.verticalAlign}),!0,n)}handleOverflow(n){let m=this,x=this.chart,S=x.renderer,k=this.options,L=k.y,R=k.verticalAlign==="top",N=this.padding,Y=k.maxHeight,se=k.navigation,$=Tc(se.animation,!0),ee=se.arrowSize||12,ae=this.pages,fe=this.allItems,ve=function(Rt){typeof Rt=="number"?Nt.attr({height:Rt}):Nt&&(m.clipRect=Nt.destroy(),m.contentGroup.clip()),m.contentGroup.div&&(m.contentGroup.div.style.clip=Rt?"rect("+N+"px,9999px,"+(N+Rt)+"px,0)":"auto")},Te=function(Rt){return m[Rt]=S.circle(0,0,1.3*ee).translate(ee/2,ee/2).add(Mt),x.styledMode||m[Rt].attr("fill","rgba(0,0,0,0.0001)"),m[Rt]},Ae,Ve,Ke,Tt,St=x.spacingBox.height+(R?-L:L)-N,Mt=this.nav,Nt=this.clipRect;return k.layout!=="horizontal"||k.verticalAlign==="middle"||k.floating||(St/=2),Y&&(St=Math.min(St,Y)),ae.length=0,n&&St>0&&n>St&&se.enabled!==!1?(this.clipHeight=Ae=Math.max(St-20-this.titleHeight-N,0),this.currentPage=Tc(this.currentPage,1),this.fullHeight=n,fe.forEach((Rt,$t)=>{let Ti=(Ke=Rt.legendItem||{}).y||0,hi=Math.round(Ke.label.getBBox().height),Ei=ae.length;(!Ei||Ti-ae[Ei-1]>Ae&&(Ve||Ti)!==ae[Ei-1])&&(ae.push(Ve||Ti),Ei++),Ke.pageIx=Ei-1,Ve&&Tt&&(Tt.pageIx=Ei-1),$t===fe.length-1&&Ti+hi-ae[Ei-1]>Ae&&Ti>ae[Ei-1]&&(ae.push(Ti),Ke.pageIx=Ei),Ti!==Ve&&(Ve=Ti),Tt=Ke}),Nt||(Nt=m.clipRect=S.clipRect(0,N-2,9999,0),m.contentGroup.clip(Nt)),ve(Ae),Mt||(this.nav=Mt=S.g().attr({zIndex:1}).add(this.group),this.up=S.symbol("triangle",0,0,ee,ee).add(Mt),Te("upTracker").on("click",function(){m.scroll(-1,$)}),this.pager=S.text("",15,10).addClass("highcharts-legend-navigation"),!x.styledMode&&se.style&&this.pager.css(se.style),this.pager.add(Mt),this.down=S.symbol("triangle-down",0,0,ee,ee).add(Mt),Te("downTracker").on("click",function(){m.scroll(1,$)})),m.scroll(0),n=St):Mt&&(ve(),this.nav=Mt.destroy(),this.scrollGroup.attr({translateY:1}),this.clipHeight=0),n}scroll(n,m){let x=this.chart,S=this.pages,k=S.length,L=this.clipHeight,R=this.options.navigation,N=this.pager,Y=this.padding,se=this.currentPage+n;se>k&&(se=k),se>0&&(m!==void 0&&Sf(m,x),this.nav.attr({translateX:Y,translateY:L+this.padding+7+this.titleHeight,visibility:"inherit"}),[this.up,this.upTracker].forEach(function($){$.attr({class:se===1?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"})}),N.attr({text:se+"/"+k}),[this.down,this.downTracker].forEach(function($){$.attr({x:18+this.pager.getBBox().width,class:se===k?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"})},this),x.styledMode||(this.up.attr({fill:se===1?R.inactiveColor:R.activeColor}),this.upTracker.css({cursor:se===1?"default":"pointer"}),this.down.attr({fill:se===k?R.inactiveColor:R.activeColor}),this.downTracker.css({cursor:se===k?"default":"pointer"})),this.scrollOffset=-S[se-1]+this.initialItemY,this.scrollGroup.animate({translateY:this.scrollOffset}),this.currentPage=se,this.positionCheckboxes(),ml(()=>{wn(this,"afterScroll",{currentPage:se})},Tf(Tc(m,x.renderer.globalAnimation,!0)).duration))}setItemEvents(n,m,x){let S=this,k=n.legendItem||{},L=S.chart.renderer.boxWrapper,R=n instanceof bt,N=n instanceof Vl,Y="highcharts-legend-"+(R?"point":"series")+"-active",se=S.chart.styledMode,$=x?[m,k.symbol]:[k.group],ee=ae=>{S.allItems.forEach(fe=>{n!==fe&&[fe].concat(fe.linkedSeries||[]).forEach(ve=>{ve.setState(ae,!R)})})};for(let ae of $)ae&&ae.on("mouseover",function(){n.visible&&ee("inactive"),n.setState("hover"),n.visible&&L.addClass(Y),se||m.css(S.options.itemHoverStyle)}).on("mouseout",function(){S.chart.styledMode||m.css(wc(n.visible?S.itemStyle:S.itemHiddenStyle)),ee(""),L.removeClass(Y),n.setState()}).on("click",function(fe){let ve=function(){n.setVisible&&n.setVisible(),ee(n.visible?"inactive":"")};L.removeClass(Y),wn(S,"itemClick",{browserEvent:fe,legendItem:n},ve),R?n.firePointEvent("legendItemClick",{browserEvent:fe}):N&&wn(n,"legendItemClick",{browserEvent:fe})})}createCheckboxForItem(n){n.checkbox=Kp("input",{type:"checkbox",className:"highcharts-legend-checkbox",checked:n.selected,defaultChecked:n.selected},this.options.itemCheckboxStyle,this.chart.container),Xc(n.checkbox,"click",function(m){let x=m.target;wn(n.series||n,"checkboxClick",{checked:x.checked,item:n},function(){n.select()})})}}(function(H){H.compose=function(n){dg(Nu,"Core.Legend")&&Xc(n,"beforeMargins",function(){this.legend=new H(this,this.options.legend)})}})(Jp||(Jp={}));let hm=Jp,{animate:Qp,animObject:sp,setAnimation:rp}=Oo,{defaultOptions:uu}=ei,{numberFormat:op}=ja,{registerEventOptions:bh}=Pd,{charts:Sc,doc:Vu,marginNames:kp,svg:Af,win:kf}=fi,{seriesTypes:Yc}=pn,{addEvent:Mc,attr:Xo,createElement:Fm,css:pd,defined:Ep,diffObjects:np,discardElement:ap,erase:Ef,error:Uo,extend:Uu,find:$l,fireEvent:Fn,getAlignFactor:ef,getStyle:ug,isArray:Cf,isNumber:zh,isObject:sa,isString:Ha,merge:Rd,objectEach:cm,pick:dl,pInt:ju,relativeLength:dm,removeEvent:Pf,splat:fd,syncTimeout:pu,uniqueKey:Nm}=Gs;class ra{static chart(n,m,x){return new ra(n,m,x)}constructor(n,m,x){this.sharedClips={};let S=[...arguments];(Ha(n)||n.nodeName)&&(this.renderTo=S.shift()),this.init(S[0],S[1])}setZoomOptions(){let n=this.options.chart,m=n.zooming;this.zooming={...m,type:dl(n.zoomType,m.type),key:dl(n.zoomKey,m.key),pinchType:dl(n.pinchType,m.pinchType),singleTouch:dl(n.zoomBySingleTouch,m.singleTouch,!1),resetButton:Rd(m.resetButton,n.resetZoomButton)}}init(n,m){Fn(this,"init",{args:arguments},function(){var L;let x=Rd(uu,n),S=x.chart,k=this.renderTo||S.renderTo;this.userOptions=Uu({},n),(this.renderTo=Ha(k)?Vu.getElementById(k):k)||Uo(13,!0,this),this.margin=[],this.spacing=[],this.labelCollectors=[],this.callback=m,this.isResizing=0,this.options=x,this.axes=[],this.series=[],this.locale=x.lang.locale??((L=this.renderTo.closest("[lang]"))==null?void 0:L.lang),this.time=new Zl(Uu(x.time||{},{locale:this.locale}),x.lang),x.time=this.time.options,this.numberFormatter=(S.numberFormatter||op).bind(this),this.styledMode=S.styledMode,this.hasCartesianSeries=S.showAxes,this.index=Sc.length,Sc.push(this),fi.chartCount++,bh(this,S),this.xAxis=[],this.yAxis=[],this.pointCount=this.colorCounter=this.symbolCounter=0,this.setZoomOptions(),Fn(this,"afterInit"),this.firstRender()})}initSeries(n){let m=this.options.chart,x=n.type||m.type,S=Yc[x];S||Uo(17,!0,this,{missingModuleFor:x});let k=new S;return typeof k.init=="function"&&k.init(this,n),k}setSortedData(){this.getSeriesOrderByLinks().forEach(function(n){n.points||n.data||!n.enabledDataSorting||n.setData(n.options.data,!1)})}getSeriesOrderByLinks(){return this.series.concat().sort(function(n,m){return n.linkedSeries.length||m.linkedSeries.length?m.linkedSeries.length-n.linkedSeries.length:0})}orderItems(n,m=0){let x=this[n],S=this.options[n]=fd(this.options[n]).slice(),k=this.userOptions[n]=this.userOptions[n]?fd(this.userOptions[n]).slice():[];if(this.hasRendered&&(S.splice(m),k.splice(m)),x)for(let L=m,R=x.length;L<R;++L){let N=x[L];N&&(N.index=L,N instanceof Vl&&(N.name=N.getName()),N.options.isInternal||(S[L]=N.options,k[L]=N.userOptions))}}getClipBox(n,m){var se,$;let x=this.inverted,{xAxis:S,yAxis:k}=n||{},{x:L,y:R,width:N,height:Y}=Rd(this.clipBox);return n&&(S&&S.len!==this.plotSizeX&&(N=S.len),k&&k.len!==this.plotSizeY&&(Y=k.len),x&&!n.invertible&&([N,Y]=[Y,N])),m&&(L+=((se=x?k:S)==null?void 0:se.pos)??this.plotLeft,R+=(($=x?S:k)==null?void 0:$.pos)??this.plotTop),{x:L,y:R,width:N,height:Y}}isInsidePlot(n,m,x={}){var Te;let{inverted:S,plotBox:k,plotLeft:L,plotTop:R,scrollablePlotBox:N}=this,{scrollLeft:Y=0,scrollTop:se=0}=x.visiblePlotOnly&&((Te=this.scrollablePlotArea)==null?void 0:Te.scrollingContainer)||{},$=x.series,ee=x.visiblePlotOnly&&N||k,ae=x.inverted?m:n,fe=x.inverted?n:m,ve={x:ae,y:fe,isInsidePlot:!0,options:x};if(!x.ignoreX){let Ae=$&&(S&&!this.polar?$.yAxis:$.xAxis)||{pos:L,len:1/0},Ve=x.paneCoordinates?Ae.pos+ae:L+ae;Ve>=Math.max(Y+L,Ae.pos)&&Ve<=Math.min(Y+L+ee.width,Ae.pos+Ae.len)||(ve.isInsidePlot=!1)}if(!x.ignoreY&&ve.isInsidePlot){let Ae=!S&&x.axis&&!x.axis.isXAxis&&x.axis||$&&(S?$.xAxis:$.yAxis)||{pos:R,len:1/0},Ve=x.paneCoordinates?Ae.pos+fe:R+fe;Ve>=Math.max(se+R,Ae.pos)&&Ve<=Math.min(se+R+ee.height,Ae.pos+Ae.len)||(ve.isInsidePlot=!1)}return Fn(this,"afterIsInsidePlot",ve),ve.isInsidePlot}redraw(n){Fn(this,"beforeRedraw");let m=this.hasCartesianSeries?this.axes:this.colorAxis||[],x=this.series,S=this.pointer,k=this.legend,L=this.userOptions.legend,R=this.renderer,N=R.isHidden(),Y=[],se,$,ee,ae=this.isDirtyBox,fe=this.isDirtyLegend,ve;for(R.rootFontSize=R.boxWrapper.getStyle("font-size"),this.setResponsive&&this.setResponsive(!1),rp(!!this.hasRendered&&n,this),N&&this.temporaryDisplay(),this.layOutTitles(!1),ee=x.length;ee--;)if(((ve=x[ee]).options.stacking||ve.options.centerInCategory)&&($=!0,ve.isDirty)){se=!0;break}if(se)for(ee=x.length;ee--;)(ve=x[ee]).options.stacking&&(ve.isDirty=!0);x.forEach(function(Te){Te.isDirty&&(Te.options.legendType==="point"?(typeof Te.updateTotals=="function"&&Te.updateTotals(),fe=!0):L&&(L.labelFormatter||L.labelFormat)&&(fe=!0)),Te.isDirtyData&&Fn(Te,"updatedData")}),fe&&k&&k.options.enabled&&(k.render(),this.isDirtyLegend=!1),$&&this.getStacks(),m.forEach(function(Te){Te.updateNames(),Te.setScale()}),this.getMargins(),m.forEach(function(Te){Te.isDirty&&(ae=!0)}),m.forEach(function(Te){let Ae=Te.min+","+Te.max;Te.extKey!==Ae&&(Te.extKey=Ae,Y.push(function(){Fn(Te,"afterSetExtremes",Uu(Te.eventArgs,Te.getExtremes())),delete Te.eventArgs})),(ae||$)&&Te.redraw()}),ae&&this.drawChartBox(),Fn(this,"predraw"),x.forEach(function(Te){(ae||Te.isDirty)&&Te.visible&&Te.redraw(),Te.isDirtyData=!1}),S&&S.reset(!0),R.draw(),Fn(this,"redraw"),Fn(this,"render"),N&&this.temporaryDisplay(!0),Y.forEach(function(Te){Te.call()})}get(n){let m=this.series;function x(k){return k.id===n||k.options&&k.options.id===n}let S=$l(this.axes,x)||$l(this.series,x);for(let k=0;!S&&k<m.length;k++)S=$l(m[k].points||[],x);return S}createAxes(){let n=this.userOptions;for(let m of(Fn(this,"createAxes"),["xAxis","yAxis"]))for(let x of n[m]=fd(n[m]||{}))new nu(this,x,m);Fn(this,"afterCreateAxes")}getSelectedPoints(){return this.series.reduce((n,m)=>(m.getPointsCollection().forEach(x=>{dl(x.selectedStaging,x.selected)&&n.push(x)}),n),[])}getSelectedSeries(){return this.series.filter(n=>n.selected)}setTitle(n,m,x){this.applyDescription("title",n),this.applyDescription("subtitle",m),this.applyDescription("caption",void 0),this.layOutTitles(x)}applyDescription(n,m){var L;let x=this,S=this.options[n]=Rd(this.options[n],m),k=this[n];k&&m&&(this[n]=k=k.destroy()),S&&!k&&((k=this.renderer.text(S.text,0,0,S.useHTML).attr({align:S.align,class:"highcharts-"+n,zIndex:S.zIndex||4}).css({textOverflow:"ellipsis",whiteSpace:"nowrap"}).add()).update=function(R,N){x.applyDescription(n,R),x.layOutTitles(N)},this.styledMode||k.css(Uu(n==="title"?{fontSize:this.options.isStock?"1em":"1.2em"}:{},S.style)),k.textPxLength=k.getBBox().width,k.css({whiteSpace:(L=S.style)==null?void 0:L.whiteSpace}),this[n]=k)}layOutTitles(n=!0){var R,N,Y,se;let m=[0,0,0],{options:x,renderer:S,spacingBox:k}=this;["title","subtitle","caption"].forEach($=>{var Te;let ee=this[$],ae=this.options[$],fe=Rd(k),ve=(ee==null?void 0:ee.textPxLength)||0;if(ee&&ae){Fn(this,"layOutTitle",{alignTo:fe,key:$,textPxLength:ve});let Ae=S.fontMetrics(ee),Ve=Ae.b,Ke=Ae.h,Tt=ae.verticalAlign||"top",St=Tt==="top",Mt=St&&ae.minScale||1,Nt=$==="title"?St?-3:0:St?m[0]+2:0,Rt=Math.min(fe.width/ve,1),$t=Math.max(Mt,Rt),Ti=Rd({y:Tt==="bottom"?Ve:Nt+Ve},{align:$==="title"?Rt<Mt?"left":"center":(Te=this.title)==null?void 0:Te.alignValue},ae),hi=(ae.width||(Rt>Mt?this.chartWidth:fe.width)/$t)+"px";ee.alignValue!==Ti.align&&(ee.placed=!1);let Ei=Math.round(ee.css({width:hi}).getBBox(ae.useHTML).height);if(Ti.height=Ei,ee.align(Ti,!1,fe).attr({align:Ti.align,scaleX:$t,scaleY:$t,"transform-origin":`${fe.x+ve*$t*ef(Ti.align)} ${Ke}`}),!ae.floating){let Ji=Ei*(Ei<1.2*Ke?1:$t);Tt==="top"?m[0]=Math.ceil(m[0]+Ji):Tt==="bottom"&&(m[2]=Math.ceil(m[2]+Ji))}}},this),m[0]&&(((R=x.title)==null?void 0:R.verticalAlign)||"top")==="top"&&(m[0]+=((N=x.title)==null?void 0:N.margin)||0),m[2]&&((Y=x.caption)==null?void 0:Y.verticalAlign)==="bottom"&&(m[2]+=((se=x.caption)==null?void 0:se.margin)||0);let L=!this.titleOffset||this.titleOffset.join(",")!==m.join(",");this.titleOffset=m,Fn(this,"afterLayOutTitles"),!this.isDirtyBox&&L&&(this.isDirtyBox=this.isDirtyLegend=L,this.hasRendered&&n&&this.isDirtyBox&&this.redraw())}getContainerBox(){let n=[].map.call(this.renderTo.children,x=>{if(x!==this.container){let S=x.style.display;return x.style.display="none",[x,S]}}),m={width:ug(this.renderTo,"width",!0)||0,height:ug(this.renderTo,"height",!0)||0};return n.filter(Boolean).forEach(([x,S])=>{x.style.display=S}),m}getChartSize(){var L;let n=this.options.chart,m=n.width,x=n.height,S=this.getContainerBox(),k=S.height<=1||!((L=this.renderTo.parentElement)!=null&&L.style.height)&&this.renderTo.style.height==="100%";this.chartWidth=Math.max(0,m||S.width||600),this.chartHeight=Math.max(0,dm(x,this.chartWidth)||(k?400:S.height)),this.containerBox=S}temporaryDisplay(n){let m=this.renderTo,x;if(n)for(;m!=null&&m.style;)m.hcOrigStyle&&(pd(m,m.hcOrigStyle),delete m.hcOrigStyle),m.hcOrigDetached&&(Vu.body.removeChild(m),m.hcOrigDetached=!1),m=m.parentNode;else for(;m!=null&&m.style&&(Vu.body.contains(m)||m.parentNode||(m.hcOrigDetached=!0,Vu.body.appendChild(m)),(ug(m,"display",!1)==="none"||m.hcOricDetached)&&(m.hcOrigStyle={display:m.style.display,height:m.style.height,overflow:m.style.overflow},x={display:"block",overflow:"hidden"},m!==this.renderTo&&(x.height=0),pd(m,x),m.offsetWidth||m.style.setProperty("display","block","important")),(m=m.parentNode)!==Vu.body););}setClassName(n){this.container.className="highcharts-container "+(n||"")}getContainer(){var ee,ae;let n,m=this.options,x=m.chart,S="data-highcharts-chart",k=Nm(),L=this.renderTo,R=ju(Xo(L,S));zh(R)&&Sc[R]&&Sc[R].hasRendered&&Sc[R].destroy(),Xo(L,S,this.index),L.innerHTML=Wn.emptyHTML,x.skipClone||L.offsetWidth||this.temporaryDisplay(),this.getChartSize();let N=this.chartHeight,Y=this.chartWidth;pd(L,{overflow:"hidden"}),this.styledMode||(n=Uu({position:"relative",overflow:"hidden",width:Y+"px",height:N+"px",textAlign:"left",lineHeight:"normal",zIndex:0,"-webkit-tap-highlight-color":"rgba(0,0,0,0)",userSelect:"none","touch-action":"manipulation",outline:"none",padding:"0px"},x.style||{}));let se=Fm("div",{id:k},n,L);this.container=se,this.getChartSize(),Y!==this.chartWidth&&(Y=this.chartWidth,this.styledMode||pd(se,{width:dl((ee=x.style)==null?void 0:ee.width,Y+"px")})),this.containerBox=this.getContainerBox(),this._cursor=se.style.cursor;let $=x.renderer||!Af?Bn.getRendererType(x.renderer):Nc;if(this.renderer=new $(se,Y,N,void 0,x.forExport,(ae=m.exporting)==null?void 0:ae.allowHTML,this.styledMode),rp(void 0,this),this.setClassName(x.className),this.styledMode)for(let fe in m.defs)this.renderer.definition(m.defs[fe]);else this.renderer.setStyle(x.style);this.renderer.chartIndex=this.index,Fn(this,"afterGetContainer")}getMargins(n){var k;let{spacing:m,margin:x,titleOffset:S}=this;this.resetMargins(),S[0]&&!Ep(x[0])&&(this.plotTop=Math.max(this.plotTop,S[0]+m[0])),S[2]&&!Ep(x[2])&&(this.marginBottom=Math.max(this.marginBottom,S[2]+m[2])),(k=this.legend)!=null&&k.display&&this.legend.adjustMargins(x,m),Fn(this,"getMargins"),n||this.getAxisMargins()}getAxisMargins(){let n=this,m=n.axisOffset=[0,0,0,0],x=n.colorAxis,S=n.margin,k=function(L){L.forEach(function(R){R.visible&&R.getOffset()})};n.hasCartesianSeries?k(n.axes):x!=null&&x.length&&k(x),kp.forEach(function(L,R){Ep(S[R])||(n[L]+=m[R])}),n.setChartSize()}getOptions(){return np(this.userOptions,uu)}reflow(n){var k,L;let m=this,x=m.containerBox,S=m.getContainerBox();(k=m.pointer)==null||delete k.chartPosition,!((L=m.exporting)!=null&&L.isPrinting)&&!m.isResizing&&x&&S.width&&((S.width!==x.width||S.height!==x.height)&&(Gs.clearTimeout(m.reflowTimeout),m.reflowTimeout=pu(function(){m.container&&m.setSize(void 0,void 0,!1)},100*!!n)),m.containerBox=S)}setReflow(){let n=this,m=x=>{var S;(S=n.options)!=null&&S.chart.reflow&&n.hasLoaded&&n.reflow(x)};if(typeof ResizeObserver=="function")new ResizeObserver(m).observe(n.renderTo);else{let x=Mc(kf,"resize",m);Mc(this,"destroy",x)}}setSize(n,m,x){let S=this,k=S.renderer;S.isResizing+=1,rp(x,S);let L=k.globalAnimation;S.oldChartHeight=S.chartHeight,S.oldChartWidth=S.chartWidth,n!==void 0&&(S.options.chart.width=n),m!==void 0&&(S.options.chart.height=m),S.getChartSize();let{chartWidth:R,chartHeight:N,scrollablePixelsX:Y=0,scrollablePixelsY:se=0}=S;(S.isDirtyBox||R!==S.oldChartWidth||N!==S.oldChartHeight)&&(S.styledMode||(L?Qp:pd)(S.container,{width:`${R+Y}px`,height:`${N+se}px`},L),S.setChartSize(!0),k.setSize(R,N,L),S.axes.forEach(function($){$.isDirty=!0,$.setScale()}),S.isDirtyLegend=!0,S.isDirtyBox=!0,S.layOutTitles(),S.getMargins(),S.redraw(L),S.oldChartHeight=void 0,Fn(S,"resize"),setTimeout(()=>{S&&Fn(S,"endResize")},sp(L).duration)),S.isResizing-=1}setChartSize(n){let m,x,S,k,{chartHeight:L,chartWidth:R,inverted:N,spacing:Y,renderer:se}=this,$=this.clipOffset,ee=Math[N?"floor":"round"];this.plotLeft=m=Math.round(this.plotLeft),this.plotTop=x=Math.round(this.plotTop),this.plotWidth=S=Math.max(0,Math.round(R-m-(this.marginRight??0))),this.plotHeight=k=Math.max(0,Math.round(L-x-(this.marginBottom??0))),this.plotSizeX=N?k:S,this.plotSizeY=N?S:k,this.spacingBox=se.spacingBox={x:Y[3],y:Y[0],width:R-Y[3]-Y[1],height:L-Y[0]-Y[2]},this.plotBox=se.plotBox={x:m,y:x,width:S,height:k},$&&(this.clipBox={x:ee($[3]),y:ee($[0]),width:ee(this.plotSizeX-$[1]-$[3]),height:ee(this.plotSizeY-$[0]-$[2])}),n||(this.axes.forEach(function(ae){ae.setAxisSize(),ae.setAxisTranslation()}),se.alignElements()),Fn(this,"afterSetChartSize",{skipAxes:n})}resetMargins(){Fn(this,"resetMargins");let n=this,m=n.options.chart,x=m.plotBorderWidth||0,S=Math.round(x)/2;["margin","spacing"].forEach(function(k){let L=m[k],R=sa(L)?L:[L,L,L,L];["Top","Right","Bottom","Left"].forEach(function(N,Y){n[k][Y]=dl(m[k+N],R[Y])})}),kp.forEach(function(k,L){n[k]=dl(n.margin[L],n.spacing[L])}),n.axisOffset=[0,0,0,0],n.clipOffset=[S,S,S,S],n.plotBorderWidth=x}drawChartBox(){let n=this.options.chart,m=this.renderer,x=this.chartWidth,S=this.chartHeight,k=this.styledMode,L=this.plotBGImage,R=n.backgroundColor,N=n.plotBackgroundColor,Y=n.plotBackgroundImage,se=this.plotLeft,$=this.plotTop,ee=this.plotWidth,ae=this.plotHeight,fe=this.plotBox,ve=this.clipRect,Te=this.clipBox,Ae=this.chartBackground,Ve=this.plotBackground,Ke=this.plotBorder,Tt,St,Mt,Nt="animate";Ae||(this.chartBackground=Ae=m.rect().addClass("highcharts-background").add(),Nt="attr"),k?Tt=St=Ae.strokeWidth():(St=(Tt=n.borderWidth||0)+8*!!n.shadow,Mt={fill:R||"none"},(Tt||Ae["stroke-width"])&&(Mt.stroke=n.borderColor,Mt["stroke-width"]=Tt),Ae.attr(Mt).shadow(n.shadow)),Ae[Nt]({x:St/2,y:St/2,width:x-St-Tt%2,height:S-St-Tt%2,r:n.borderRadius}),Nt="animate",Ve||(Nt="attr",this.plotBackground=Ve=m.rect().addClass("highcharts-plot-background").add()),Ve[Nt](fe),!k&&(Ve.attr({fill:N||"none"}).shadow(n.plotShadow),Y&&(L?(Y!==L.attr("href")&&L.attr("href",Y),L.animate(fe)):this.plotBGImage=m.image(Y,se,$,ee,ae).add())),ve?ve.animate({width:Te.width,height:Te.height}):this.clipRect=m.clipRect(Te),Nt="animate",Ke||(Nt="attr",this.plotBorder=Ke=m.rect().addClass("highcharts-plot-border").attr({zIndex:1}).add()),k||Ke.attr({stroke:n.plotBorderColor,"stroke-width":n.plotBorderWidth||0,fill:"none"}),Ke[Nt](Ke.crisp(fe,-Ke.strokeWidth())),this.isDirtyBox=!1,Fn(this,"afterDrawChartBox")}propFromSeries(){let n,m,x,S=this,k=S.options.chart,L=S.options.series;["inverted","angular","polar"].forEach(function(R){for(m=Yc[k.type],x=k[R]||m&&m.prototype[R],n=L==null?void 0:L.length;!x&&n--;)(m=Yc[L[n].type])&&m.prototype[R]&&(x=!0);S[R]=x})}linkSeries(n){let m=this,x=m.series;x.forEach(function(S){S.linkedSeries.length=0}),x.forEach(function(S){let{linkedTo:k}=S.options;if(Ha(k)){let L;(L=k===":previous"?m.series[S.index-1]:m.get(k))&&L.linkedParent!==S&&(L.linkedSeries.push(S),S.linkedParent=L,L.enabledDataSorting&&S.setDataSortingOptions(),S.visible=dl(S.options.visible,L.options.visible,S.visible))}}),Fn(this,"afterLinkSeries",{isUpdating:n})}renderSeries(){this.series.forEach(function(n){n.translate(),n.render()})}render(){var se;let n=this.axes,m=this.colorAxis,x=this.renderer,S=this.options.chart.axisLayoutRuns||2,k=$=>{$.forEach(ee=>{ee.visible&&ee.render()})},L=0,R=!0,N,Y=0;for(let $ of(this.setTitle(),Fn(this,"beforeMargins"),(se=this.getStacks)==null||se.call(this),this.getMargins(!0),this.setChartSize(),n)){let{options:ee}=$,{labels:ae}=ee;if(this.hasCartesianSeries&&$.horiz&&$.visible&&ae.enabled&&$.series.length&&$.coll!=="colorAxis"&&!this.polar){L=ee.tickLength,$.createGroups();let fe=new ho($,0,"",!0),ve=fe.createLabel("x",ae);if(fe.destroy(),ve&&dl(ae.reserveSpace,!zh(ee.crossing))&&(L=ve.getBBox().height+ae.distance+Math.max(ee.offset||0,0)),L){ve==null||ve.destroy();break}}}for(this.plotHeight=Math.max(this.plotHeight-L,0);(R||N||S>1)&&Y<S;){let $=this.plotWidth,ee=this.plotHeight;for(let ae of n)Y===0?ae.setScale():(ae.horiz&&R||!ae.horiz&&N)&&ae.setTickInterval(!0);Y===0?this.getAxisMargins():this.getMargins(),R=$/this.plotWidth>(Y?1:1.1),N=ee/this.plotHeight>(Y?1:1.05),Y++}this.drawChartBox(),this.hasCartesianSeries?k(n):m!=null&&m.length&&k(m),this.seriesGroup||(this.seriesGroup=x.g("series-group").attr({zIndex:3}).shadow(this.options.chart.seriesGroupShadow).add()),this.dataLabelsGroup||(this.dataLabelsGroup=x.g("datalabels-group").attr({zIndex:6}).add()),this.renderSeries(),this.addCredits(),this.setResponsive&&this.setResponsive(),this.hasRendered=!0}addCredits(n){let m=this,x=Rd(!0,this.options.credits,n);x.enabled&&!this.credits&&(this.credits=this.renderer.text(x.text+(this.mapCredits||""),0,0).addClass("highcharts-credits").on("click",function(){x.href&&(kf.location.href=x.href)}).attr({align:x.position.align,zIndex:8}),m.styledMode||this.credits.css(x.style),this.credits.add().align(x.position),this.credits.update=function(S){m.credits=m.credits.destroy(),m.addCredits(S)})}destroy(){var R,N;let n,m=this,x=m.axes,S=m.series,k=m.container,L=k==null?void 0:k.parentNode;for(Fn(m,"destroy"),m.renderer.forExport?Ef(Sc,m):Sc[m.index]=void 0,fi.chartCount--,m.renderTo.removeAttribute("data-highcharts-chart"),Pf(m),n=x.length;n--;)x[n]=x[n].destroy();for((N=(R=this.scroller)==null?void 0:R.destroy)==null||N.call(R),n=S.length;n--;)S[n]=S[n].destroy();["title","subtitle","chartBackground","plotBackground","plotBGImage","plotBorder","seriesGroup","clipRect","credits","pointer","rangeSelector","legend","resetZoomButton","tooltip","renderer"].forEach(Y=>{var se,$;m[Y]=($=(se=m[Y])==null?void 0:se.destroy)==null?void 0:$.call(se)}),k&&(k.innerHTML=Wn.emptyHTML,Pf(k),L&&ap(k)),cm(m,function(Y,se){delete m[se]})}firstRender(){var S;let n=this,m=n.options;n.getContainer(),n.resetMargins(),n.setChartSize(),n.propFromSeries(),n.createAxes();let x=Cf(m.series)?m.series:[];m.series=[],x.forEach(function(k){n.initSeries(k)}),n.linkSeries(),n.setSortedData(),Fn(n,"beforeRender"),n.render(),(S=n.pointer)==null||S.getChartPosition(),n.renderer.imgCount||n.hasLoaded||n.onload(),n.temporaryDisplay(!0)}onload(){this.callbacks.concat([this.callback]).forEach(function(n){n&&this.index!==void 0&&n.apply(this,[this])},this),Fn(this,"load"),Fn(this,"render"),Ep(this.index)&&this.setReflow(),this.warnIfA11yModuleNotLoaded(),this.hasLoaded=!0}warnIfA11yModuleNotLoaded(){let{options:n,title:m}=this;n&&!this.accessibility&&(this.renderer.boxWrapper.attr({role:"img","aria-label":((m==null?void 0:m.element.textContent)||"").replace(/</g,"&lt;")}),n.accessibility&&n.accessibility.enabled===!1||Uo('Highcharts warning: Consider including the "accessibility.js" module to make your chart more usable for people with disabilities. Set the "accessibility.enabled" option to false to remove this warning. See https://www.highcharts.com/docs/accessibility/accessibility-module.',!1,this))}addSeries(n,m,x){let S,k=this;return n&&(m=dl(m,!0),Fn(k,"addSeries",{options:n},function(){S=k.initSeries(n),k.isDirtyLegend=!0,k.linkSeries(),S.enabledDataSorting&&S.setData(n.data,!1),Fn(k,"afterAddSeries",{series:S}),m&&k.redraw(x)})),S}addAxis(n,m,x,S){return this.createAxis(m?"xAxis":"yAxis",{axis:n,redraw:x,animation:S})}addColorAxis(n,m,x){return this.createAxis("colorAxis",{axis:n,redraw:m,animation:x})}createAxis(n,m){let x=new nu(this,m.axis,n);return dl(m.redraw,!0)&&this.redraw(m.animation),x}showLoading(n){let m=this,x=m.options,S=x.loading,k=function(){L&&pd(L,{left:m.plotLeft+"px",top:m.plotTop+"px",width:m.plotWidth+"px",height:m.plotHeight+"px"})},L=m.loadingDiv,R=m.loadingSpan;L||(m.loadingDiv=L=Fm("div",{className:"highcharts-loading highcharts-loading-hidden"},null,m.container)),R||(m.loadingSpan=R=Fm("span",{className:"highcharts-loading-inner"},null,L),Mc(m,"redraw",k)),L.className="highcharts-loading",Wn.setElementHTML(R,dl(n,x.lang.loading,"")),!m.styledMode&&(pd(L,Uu(S.style,{zIndex:10})),pd(R,S.labelStyle),m.loadingShown||(pd(L,{opacity:0,display:""}),Qp(L,{opacity:S.style.opacity||.5},{duration:S.showDuration||0}))),m.loadingShown=!0,k()}hideLoading(){let n=this.options,m=this.loadingDiv;m&&(m.className="highcharts-loading highcharts-loading-hidden",this.styledMode||Qp(m,{opacity:0},{duration:n.loading.hideDuration||100,complete:function(){pd(m,{display:"none"})}})),this.loadingShown=!1}update(n,m,x,S){let k,L,R,N=this,Y={credits:"addCredits",title:"setTitle",subtitle:"setSubtitle",caption:"setCaption"},se=n.isResponsiveOptions,$=[];Fn(N,"update",{options:n}),se||N.setResponsive(!1,!0),n=np(n,N.options),N.userOptions=Rd(N.userOptions,n);let ee=n.chart;ee&&(Rd(!0,N.options.chart,ee),this.setZoomOptions(),"className"in ee&&N.setClassName(ee.className),("inverted"in ee||"polar"in ee||"type"in ee)&&(N.propFromSeries(),k=!0),"alignTicks"in ee&&(k=!0),"events"in ee&&bh(this,ee),cm(ee,function(ve,Te){N.propsRequireUpdateSeries.indexOf("chart."+Te)!==-1&&(L=!0),N.propsRequireDirtyBox.indexOf(Te)!==-1&&(N.isDirtyBox=!0),N.propsRequireReflow.indexOf(Te)!==-1&&(N.isDirtyBox=!0,se||(R=!0))}),!N.styledMode&&ee.style&&N.renderer.setStyle(N.options.chart.style||{})),!N.styledMode&&n.colors&&(this.options.colors=n.colors),cm(n,function(ve,Te){N[Te]&&typeof N[Te].update=="function"?N[Te].update(ve,!1):typeof N[Y[Te]]=="function"?N[Y[Te]](ve):Te!=="colors"&&N.collectionsWithUpdate.indexOf(Te)===-1&&Rd(!0,N.options[Te],n[Te]),Te!=="chart"&&N.propsRequireUpdateSeries.indexOf(Te)!==-1&&(L=!0)}),this.collectionsWithUpdate.forEach(function(ve){n[ve]&&(fd(n[ve]).forEach(function(Te,Ae){let Ve,Ke=Ep(Te.id);Ke&&(Ve=N.get(Te.id)),!Ve&&N[ve]&&(Ve=N[ve][dl(Te.index,Ae)])&&(Ke&&Ep(Ve.options.id)||Ve.options.isInternal)&&(Ve=void 0),Ve&&Ve.coll===ve&&(Ve.update(Te,!1),x&&(Ve.touched=!0)),!Ve&&x&&N.collectionsWithInit[ve]&&(N.collectionsWithInit[ve][0].apply(N,[Te].concat(N.collectionsWithInit[ve][1]||[]).concat([!1])).touched=!0)}),x&&N[ve].forEach(function(Te){Te.touched||Te.options.isInternal?delete Te.touched:$.push(Te)}))}),$.forEach(function(ve){ve.chart&&ve.remove&&ve.remove(!1)}),k&&N.axes.forEach(function(ve){ve.update({},!1)}),L&&N.getSeriesOrderByLinks().forEach(function(ve){ve.chart&&ve.update({},!1)},this);let ae=ee==null?void 0:ee.width,fe=ee&&(Ha(ee.height)?dm(ee.height,ae||N.chartWidth):ee.height);R||zh(ae)&&ae!==N.chartWidth||zh(fe)&&fe!==N.chartHeight?N.setSize(ae,fe,S):dl(m,!0)&&N.redraw(S),Fn(N,"afterUpdate",{options:n,redraw:m,animation:S})}setSubtitle(n,m){this.applyDescription("subtitle",n),this.layOutTitles(m)}setCaption(n,m){this.applyDescription("caption",n),this.layOutTitles(m)}showResetZoom(){let n=this,m=uu.lang,x=n.zooming.resetButton,S=x.theme,k=x.relativeTo==="chart"||x.relativeTo==="spacingBox"?null:"plotBox";function L(){n.zoomOut()}Fn(this,"beforeShowResetZoom",null,function(){n.resetZoomButton=n.renderer.button(m.resetZoom,null,null,L,S).attr({align:x.position.align,title:m.resetZoomTitle}).addClass("highcharts-reset-zoom").add().align(x.position,!1,k)}),Fn(this,"afterShowResetZoom")}zoomOut(){Fn(this,"selection",{resetSelection:!0},()=>this.transform({reset:!0,trigger:"zoom"}))}pan(n,m){let x=this,S=typeof m=="object"?m:{enabled:m,type:"x"},k=S.type,L=k&&x[{x:"xAxis",xy:"axes",y:"yAxis"}[k]].filter(N=>N.options.panningEnabled&&!N.options.isInternal),R=x.options.chart;R!=null&&R.panning&&(R.panning=S),Fn(this,"pan",{originalEvent:n},()=>{x.transform({axes:L,event:n,to:{x:n.chartX-(x.mouseDownX||0),y:n.chartY-(x.mouseDownY||0)},trigger:"pan"}),pd(x.container,{cursor:"move"})})}transform(n){var fe;let{axes:m=this.axes,event:x,from:S={},reset:k,selection:L,to:R={},trigger:N}=n,{inverted:Y,time:se}=this;(fe=this.hoverPoints)==null||fe.forEach(ve=>ve.setState()),Fn(this,"transform",n);let $=n.hasZoomed||!1,ee,ae;for(let ve of m){let{horiz:Te,len:Ae,minPointOffset:Ve=0,options:Ke,reversed:Tt}=ve,St=Te?"width":"height",Mt=Te?"x":"y",Nt=dl(R[St],ve.len),Rt=dl(S[St],ve.len),$t=10>Math.abs(Nt)?1:Nt/Rt,Ti=(S[Mt]||0)+Rt/2-ve.pos,hi=Ti-((R[Mt]??ve.pos)+Nt/2-ve.pos)/$t,Ei=Tt&&!Y||!Tt&&Y?-1:1;if(!k&&(Ti<0||Ti>ve.len))continue;let Ji=ve.chart.polar||ve.isOrdinal?0:Ve*Ei||0,er=ve.toValue(hi,!0),Is=ve.toValue(hi+Ae/$t,!0),Hs=er+Ji,qs=Is-Ji,dr=ve.allExtremes;if(L&&L[ve.coll].push({axis:ve,min:Math.min(er,Is),max:Math.max(er,Is)}),Hs>qs&&([Hs,qs]=[qs,Hs]),$t===1&&!k&&ve.coll==="yAxis"&&!dr){for(let bd of ve.series){let nh=bd.getExtremes(bd.getProcessedData(!0).modified.getColumn("y")||[],!0);dr??(dr={dataMin:Number.MAX_VALUE,dataMax:-Number.MAX_VALUE}),zh(nh.dataMin)&&zh(nh.dataMax)&&(dr.dataMin=Math.min(nh.dataMin,dr.dataMin),dr.dataMax=Math.max(nh.dataMax,dr.dataMax))}ve.allExtremes=dr}let{dataMin:xr,dataMax:wr,min:io,max:sl}=Uu(ve.getExtremes(),dr||{}),Wo=se.parse(Ke.min),qo=se.parse(Ke.max),ko=xr??Wo,no=wr??qo,$a=qs-Hs,Fa=ve.categories?0:Math.min($a,no-ko),ul=ko-Fa*(Ep(Wo)?0:Ke.minPadding),Zc=no+Fa*(Ep(qo)?0:Ke.maxPadding),Sm=ve.allowZoomOutside||$t===1||N!=="zoom"&&$t>1,Uf=Math.min(Wo??ul,ul,Sm?io:ul),vu=Math.max(qo??Zc,Zc,Sm?sl:Zc);(!ve.isOrdinal||$t!==1||k)&&(Hs<Uf&&(Hs=Uf,$t>=1&&(qs=Hs+$a)),qs>vu&&(qs=vu,$t>=1&&(Hs=qs-$a)),(k||ve.series.length&&(Hs!==io||qs!==sl)&&Hs>=Uf&&qs<=vu)&&(L?L[ve.coll].push({axis:ve,min:Hs,max:qs}):(ve.isPanning=N!=="zoom",ve.isPanning&&(ae=!0),ve.setExtremes(k?void 0:Hs,k?void 0:qs,!1,!1,{move:hi,trigger:N,scale:$t}),!k&&(Hs>Uf||qs<vu)&&N!=="mousewheel"&&(ee=!0)),$=!0),this.hasCartesianSeries||k||N==="mousewheel"||(ee=!0),x&&(this[Te?"mouseDownX":"mouseDownY"]=x[Te?"chartX":"chartY"]))}return $&&(L?Fn(this,"selection",L,()=>{delete n.selection,n.trigger="zoom",this.transform(n)}):(!ee||ae||this.resetZoomButton?!ee&&this.resetZoomButton&&(this.resetZoomButton=this.resetZoomButton.destroy()):this.showResetZoom(),this.redraw(N==="zoom"&&(this.options.chart.animation??this.pointCount<100)))),$}}Uu(ra.prototype,{callbacks:[],collectionsWithInit:{xAxis:[ra.prototype.addAxis,[!0]],yAxis:[ra.prototype.addAxis,[!1]],series:[ra.prototype.addSeries]},collectionsWithUpdate:["xAxis","yAxis","series"],propsRequireDirtyBox:["backgroundColor","borderColor","borderWidth","borderRadius","plotBackgroundColor","plotBackgroundImage","plotBorderColor","plotBorderWidth","plotShadow","shadow"],propsRequireReflow:["margin","marginTop","marginRight","marginBottom","marginLeft","spacing","spacingTop","spacingRight","spacingBottom","spacingLeft"],propsRequireUpdateSeries:["chart.inverted","chart.polar","chart.ignoreHiddenSeries","chart.type","colors","plotOptions","time","tooltip"]});let ih=ra,{stop:fu}=Oo,{composed:um}=fi,{addEvent:Gu,createElement:pg,css:lp,defined:tf,erase:mu,merge:Wu,pushUnique:Cp}=Gs;function Vm(){let H=this.scrollablePlotArea;(this.scrollablePixelsX||this.scrollablePixelsY)&&!H&&(this.scrollablePlotArea=H=new md(this)),H==null||H.applyFixed()}function If(){this.chart.scrollablePlotArea&&(this.chart.scrollablePlotArea.isDirty=!0)}class md{static compose(n,m,x){Cp(um,this.compose)&&(Gu(n,"afterInit",If),Gu(m,"afterSetChartSize",S=>this.afterSetSize(S.target,S)),Gu(m,"render",Vm),Gu(x,"show",If))}static afterSetSize(n,m){let x,S,k,{minWidth:L,minHeight:R}=n.options.chart.scrollablePlotArea||{},{clipBox:N,plotBox:Y,inverted:se,renderer:$}=n;if(!$.forExport&&(L?(n.scrollablePixelsX=x=Math.max(0,L-n.chartWidth),x&&(n.scrollablePlotBox=Wu(n.plotBox),Y.width=n.plotWidth+=x,N[se?"height":"width"]+=x,k=!0)):R&&(n.scrollablePixelsY=S=Math.max(0,R-n.chartHeight),tf(S)&&(n.scrollablePlotBox=Wu(n.plotBox),Y.height=n.plotHeight+=S,N[se?"width":"height"]+=S,k=!1)),tf(k)&&!m.skipAxes))for(let ee of n.axes)(ee.horiz===k||n.hasParallelCoordinates&&ee.coll==="yAxis")&&(ee.setAxisSize(),ee.setAxisTranslation())}constructor(n){var ae;let m,x=n.options.chart,S=Bn.getRendererType(),k=x.scrollablePlotArea||{},L=this.moveFixedElements.bind(this),R={WebkitOverflowScrolling:"touch",overflowX:"hidden",overflowY:"hidden"};n.scrollablePixelsX&&(R.overflowX="auto"),n.scrollablePixelsY&&(R.overflowY="auto"),this.chart=n;let N=this.parentDiv=pg("div",{className:"highcharts-scrolling-parent"},{position:"relative"},n.renderTo),Y=this.scrollingContainer=pg("div",{className:"highcharts-scrolling"},R,N),se=this.innerContainer=pg("div",{className:"highcharts-inner-container"},void 0,Y),$=this.fixedDiv=pg("div",{className:"highcharts-fixed"},{position:"absolute",overflow:"hidden",pointerEvents:"none",zIndex:(((ae=x.style)==null?void 0:ae.zIndex)||0)+2,top:0},void 0,!0),ee=this.fixedRenderer=new S($,n.chartWidth,n.chartHeight,x.style);this.mask=ee.path().attr({fill:x.backgroundColor||"#fff","fill-opacity":k.opacity??.85,zIndex:-1}).addClass("highcharts-scrollable-mask").add(),Y.parentNode.insertBefore($,Y),lp(n.renderTo,{overflow:"visible"}),Gu(n,"afterShowResetZoom",L),Gu(n,"afterApplyDrilldown",L),Gu(n,"afterLayOutTitles",L),Gu(Y,"scroll",()=>{let{pointer:fe,hoverPoint:ve}=n;fe&&(delete fe.chartPosition,ve&&(m=ve),fe.runPointActions(void 0,m,!0))}),se.appendChild(n.container)}applyFixed(){var Ti;let{chart:n,fixedRenderer:m,isDirty:x,scrollingContainer:S}=this,{axisOffset:k,chartWidth:L,chartHeight:R,container:N,plotHeight:Y,plotLeft:se,plotTop:$,plotWidth:ee,scrollablePixelsX:ae=0,scrollablePixelsY:fe=0}=n,{scrollPositionX:ve=0,scrollPositionY:Te=0}=n.options.chart.scrollablePlotArea||{},Ae=L+ae,Ve=R+fe;m.setSize(L,R),(x??!0)&&(this.isDirty=!1,this.moveFixedElements()),fu(n.container),lp(N,{width:`${Ae}px`,height:`${Ve}px`}),n.renderer.boxWrapper.attr({width:Ae,height:Ve,viewBox:[0,0,Ae,Ve].join(" ")}),(Ti=n.chartBackground)==null||Ti.attr({width:Ae,height:Ve}),lp(S,{width:`${L}px`,height:`${R}px`}),tf(x)||(S.scrollLeft=ae*ve,S.scrollTop=fe*Te);let Ke=$-k[0]-1,Tt=se-k[3]-1,St=$+Y+k[2]+1,Mt=se+ee+k[1]+1,Nt=se+ee-ae,Rt=$+Y-fe,$t=[["M",0,0]];ae?$t=[["M",0,Ke],["L",se-1,Ke],["L",se-1,St],["L",0,St],["Z"],["M",Nt,Ke],["L",L,Ke],["L",L,St],["L",Nt,St],["Z"]]:fe&&($t=[["M",Tt,0],["L",Tt,$-1],["L",Mt,$-1],["L",Mt,0],["Z"],["M",Tt,Rt],["L",Tt,R],["L",Mt,R],["L",Mt,Rt],["Z"]]),n.redrawTrigger!=="adjustHeight"&&this.mask.attr({d:$t})}moveFixedElements(){let n,{container:m,inverted:x,scrollablePixelsX:S,scrollablePixelsY:k}=this.chart,L=this.fixedRenderer,R=md.fixedSelectors;if(S&&!x?n=".highcharts-yaxis":S&&x||k&&!x?n=".highcharts-xaxis":k&&x&&(n=".highcharts-yaxis"),n&&!(this.chart.hasParallelCoordinates&&n===".highcharts-yaxis"))for(let N of[`${n}:not(.highcharts-radial-axis)`,`${n}-labels:not(.highcharts-radial-axis-labels)`])Cp(R,N);else for(let N of[".highcharts-xaxis",".highcharts-yaxis"])for(let Y of[`${N}:not(.highcharts-radial-axis)`,`${N}-labels:not(.highcharts-radial-axis-labels)`])mu(R,Y);for(let N of R)[].forEach.call(m.querySelectorAll(N),Y=>{(Y.namespaceURI===L.SVG_NS?L.box:L.box.parentNode).appendChild(Y),Y.style.pointerEvents="auto"})}}md.fixedSelectors=[".highcharts-breadcrumbs-group",".highcharts-contextbutton",".highcharts-caption",".highcharts-credits",".highcharts-drillup-button",".highcharts-legend",".highcharts-legend-checkbox",".highcharts-navigator-series",".highcharts-navigator-xaxis",".highcharts-navigator-yaxis",".highcharts-navigator",".highcharts-range-selector-group",".highcharts-reset-zoom",".highcharts-scrollbar",".highcharts-subtitle",".highcharts-title"];let{format:Ac}=ja,{series:$c}=pn,{destroyObjectProperties:sf,fireEvent:c,getAlignFactor:t,isNumber:r,pick:d}=Gs,_=class{constructor(H,n,m,x,S){let k=H.chart.inverted,L=H.reversed;this.axis=H;let R=this.isNegative=!!m!=!!L;this.options=n=n||{},this.x=x,this.total=null,this.cumulative=null,this.points={},this.hasValidPoints=!1,this.stack=S,this.leftCliff=0,this.rightCliff=0,this.alignOptions={align:n.align||(k?R?"left":"right":"center"),verticalAlign:n.verticalAlign||(k?"middle":R?"bottom":"top"),y:n.y,x:n.x},this.textAlign=n.textAlign||(k?R?"right":"left":"center")}destroy(){sf(this,this.axis)}render(H){let n=this.axis.chart,m=this.options,x=m.format,S=x?Ac(x,this,n):m.formatter.call(this);if(this.label)this.label.attr({text:S,visibility:"hidden"});else{this.label=n.renderer.label(S,null,void 0,m.shape,void 0,void 0,m.useHTML,!1,"stack-labels");let k={r:m.borderRadius||0,text:S,padding:d(m.padding,5),visibility:"hidden"};n.styledMode||(k.fill=m.backgroundColor,k.stroke=m.borderColor,k["stroke-width"]=m.borderWidth,this.label.css(m.style||{})),this.label.attr(k),this.label.added||this.label.add(H)}this.label.labelrank=n.plotSizeY,c(this,"afterRender")}setOffset(H,n,m,x,S,k){let{alignOptions:L,axis:R,label:N,options:Y,textAlign:se}=this,$=R.chart,ee=this.getStackBox({xOffset:H,width:n,boxBottom:m,boxTop:x,defaultX:S,xAxis:k}),{verticalAlign:ae}=L;if(N&&ee){let fe=N.getBBox(void 0,0),ve=N.padding,Te=d(Y.overflow,"justify")==="justify",Ae;L.x=Y.x||0,L.y=Y.y||0;let{x:Ve,y:Ke}=this.adjustStackPosition({labelBox:fe,verticalAlign:ae,textAlign:se});ee.x-=Ve,ee.y-=Ke,N.align(L,!1,ee),(Ae=$.isInsidePlot(N.alignAttr.x+L.x+Ve,N.alignAttr.y+L.y+Ke))||(Te=!1),Te&&$c.prototype.justifyDataLabel.call(R,N,L,N.alignAttr,fe,ee),N.attr({x:N.alignAttr.x,y:N.alignAttr.y,rotation:Y.rotation,rotationOriginX:fe.width*t(Y.textAlign||"center"),rotationOriginY:fe.height/2}),d(!Te&&Y.crop,!0)&&(Ae=r(N.x)&&r(N.y)&&$.isInsidePlot(N.x-ve+(N.width||0),N.y)&&$.isInsidePlot(N.x+ve,N.y)),N[Ae?"show":"hide"]()}c(this,"afterSetOffset",{xOffset:H,width:n})}adjustStackPosition({labelBox:H,verticalAlign:n,textAlign:m}){return{x:H.width/2+H.width/2*(2*t(m)-1),y:H.height/2*2*(1-t(n))}}getStackBox(H){let n=this.axis,m=n.chart,{boxTop:x,defaultX:S,xOffset:k,width:L,boxBottom:R}=H,N=n.stacking.usePercentage?100:d(x,this.total,0),Y=n.toPixels(N),se=H.xAxis||m.xAxis[0],$=d(S,se.translate(this.x))+k,ee=Math.abs(Y-n.toPixels(R||r(n.min)&&n.logarithmic&&n.logarithmic.lin2log(n.min)||0)),ae=m.inverted,fe=this.isNegative;return ae?{x:(fe?Y:Y-ee)-m.plotLeft,y:se.height-$-L+se.top-m.plotTop,width:ee,height:L}:{x:$+se.transB-m.plotLeft,y:(fe?Y-ee:Y)-m.plotTop,width:L,height:ee}}},{getDeferredAnimation:b}=Oo,{series:{prototype:E}}=pn,{addEvent:D,correctFloat:U,defined:Z,destroyObjectProperties:ie,fireEvent:de,isNumber:ne,objectEach:me,pick:Ce}=Gs;function Me(){let H=this.inverted;this.axes.forEach(n=>{var m;(m=n.stacking)!=null&&m.stacks&&n.hasVisibleSeries&&(n.stacking.oldStacks=n.stacking.stacks)}),this.series.forEach(n=>{var x;let m=((x=n.xAxis)==null?void 0:x.options)||{};n.options.stacking&&n.reserveSpace()&&(n.stackKey=[n.type,Ce(n.options.stack,""),H?m.top:m.left,H?m.height:m.width].join(","))})}function Pe(){var n;let H=this.stacking;if(H){let m=H.stacks;me(m,(x,S)=>{ie(x),delete m[S]}),(n=H.stackTotalGroup)==null||n.destroy()}}function Ne(){this.stacking||(this.stacking=new xt(this))}function He(H,n,m,x){return!Z(H)||H.x!==n||x&&H.stackKey!==x?H={x:n,index:0,key:x,stackKey:x}:H.index++,H.key=[m,n,H.index].join(","),H}function lt(){let H,n=this,m=n.yAxis,x=n.stackKey||"",S=m.stacking.stacks,k=n.getColumn("x",!0),L=n.options.stacking,R=n[L+"Stacker"];R&&[x,"-"+x].forEach(N=>{var ae;let Y=k.length,se,$,ee;for(;Y--;)se=k[Y],H=n.getStackIndicator(H,se,n.index,N),$=(ae=S[N])==null?void 0:ae[se],(ee=$==null?void 0:$.points[H.key||""])&&R.call(n,ee,$,Y)})}function ut(H,n,m){let x=n.total?100/n.total:0;H[0]=U(H[0]*x),H[1]=U(H[1]*x),this.stackedYData[m]=H[1]}function kt(H){(this.is("column")||this.is("columnrange"))&&(this.options.centerInCategory&&this.chart.series.length>1?E.setStackedPoints.call(this,H,"group"):H.stacking.resetStacks())}function wt(H,n){var Rt,$t;let m,x,S,k,L,R,N,Y=n||this.options.stacking;if(!Y||!this.reserveSpace()||({group:"xAxis"}[Y]||"yAxis")!==H.coll)return;let se=this.getColumn("x",!0),$=this.getColumn(this.pointValKey||"y",!0),ee=[],ae=$.length,fe=this.options,ve=fe.threshold||0,Te=fe.startFromThreshold?ve:0,Ae=fe.stack,Ve=n?`${this.type},${Y}`:this.stackKey||"",Ke="-"+Ve,Tt=this.negStacks,St=H.stacking,Mt=St.stacks,Nt=St.oldStacks;for(St.stacksTouched+=1,N=0;N<ae;N++){let Ti=se[N]||0,hi=$[N],Ei=ne(hi)&&hi||0;R=(m=this.getStackIndicator(m,Ti,this.index)).key||"",Mt[L=(x=Tt&&Ei<(Te?0:ve))?Ke:Ve]||(Mt[L]={}),Mt[L][Ti]||((Rt=Nt[L])!=null&&Rt[Ti]?(Mt[L][Ti]=Nt[L][Ti],Mt[L][Ti].total=null):Mt[L][Ti]=new _(H,H.options.stackLabels,!!x,Ti,Ae)),S=Mt[L][Ti],hi!==null?(S.points[R]=S.points[this.index]=[Ce(S.cumulative,Te)],Z(S.cumulative)||(S.base=R),S.touched=St.stacksTouched,m.index>0&&this.singleStacks===!1&&(S.points[R][0]=S.points[this.index+","+Ti+",0"][0])):(delete S.points[R],delete S.points[this.index]);let Ji=S.total||0;Y==="percent"?(k=x?Ve:Ke,Ji=Tt&&(($t=Mt[k])!=null&&$t[Ti])?(k=Mt[k][Ti]).total=Math.max(k.total||0,Ji)+Math.abs(Ei):U(Ji+Math.abs(Ei))):Y==="group"?ne(hi)&&Ji++:Ji=U(Ji+Ei),Y==="group"?S.cumulative=(Ji||1)-1:S.cumulative=U(Ce(S.cumulative,Te)+Ei),S.total=Ji,hi!==null&&(S.points[R].push(S.cumulative),ee[N]=S.cumulative,S.hasValidPoints=!0)}Y==="percent"&&(St.usePercentage=!0),Y!=="group"&&(this.stackedYData=ee),St.oldStacks={}}class xt{constructor(n){this.oldStacks={},this.stacks={},this.stacksTouched=0,this.axis=n}buildStacks(){let n,m,x=this.axis,S=x.series,k=x.coll==="xAxis",L=x.options.reversedStacks,R=S.length;for(this.resetStacks(),this.usePercentage=!1,m=R;m--;)n=S[L?m:R-m-1],k&&n.setGroupedPoints(x),n.setStackedPoints(x);if(!k)for(m=0;m<R;m++)S[m].modifyStacks();de(x,"afterBuildStacks")}cleanStacks(){this.oldStacks&&(this.stacks=this.oldStacks,me(this.stacks,n=>{me(n,m=>{m.cumulative=m.total})}))}resetStacks(){me(this.stacks,n=>{me(n,(m,x)=>{ne(m.touched)&&m.touched<this.stacksTouched?(m.destroy(),delete n[x]):(m.total=null,m.cumulative=null)})})}renderStackTotals(){var R;let n=this.axis,m=n.chart,x=m.renderer,S=this.stacks,k=b(m,((R=n.options.stackLabels)==null?void 0:R.animation)||!1),L=this.stackTotalGroup=this.stackTotalGroup||x.g("stack-labels").attr({zIndex:6,opacity:0}).add();L.translate(m.plotLeft,m.plotTop),me(S,N=>{me(N,Y=>{Y.render(L)})}),L.animate({opacity:1},k)}}(Or||(Or={})).compose=function(H,n,m){let x=n.prototype,S=m.prototype;x.getStacks||(D(H,"init",Ne),D(H,"destroy",Pe),x.getStacks=Me,S.getStackIndicator=He,S.modifyStacks=lt,S.percentStacker=ut,S.setGroupedPoints=kt,S.setStackedPoints=wt)};let pt=Or,{defined:At,merge:Ct,isObject:ti}=Gs;class si extends Vl{drawGraph(){let n=this.options,m=(this.gappedPath||this.getGraphPath).call(this),x=this.chart.styledMode;[this,...this.zones].forEach((S,k)=>{let L,R=S.graph,N=R?"animate":"attr",Y=S.dashStyle||n.dashStyle;R?(R.endX=this.preventGraphAnimation?null:m.xMap,R.animate({d:m})):m.length&&(S.graph=R=this.chart.renderer.path(m).addClass("highcharts-graph"+(k?` highcharts-zone-graph-${k-1} `:" ")+(k&&S.className||"")).attr({zIndex:1}).add(this.group)),R&&!x&&(L={stroke:!k&&n.lineColor||S.color||this.color||"#cccccc","stroke-width":n.lineWidth||0,fill:this.fillGraph&&this.color||"none"},Y?L.dashstyle=Y:n.linecap!=="square"&&(L["stroke-linecap"]=L["stroke-linejoin"]="round"),R[N](L).shadow(n.shadow&&Ct({filterUnits:"userSpaceOnUse"},ti(n.shadow)?n.shadow:{}))),R&&(R.startX=m.xMap,R.isArea=m.isArea)})}getGraphPath(n,m,x){let S=this,k=S.options,L=[],R=[],N,Y=k.step,se=(n=n||S.points).reversed;return se&&n.reverse(),(Y={right:1,center:2}[Y]||Y&&3)&&se&&(Y=4-Y),(n=this.getValidPoints(n,!1,k.nullInteraction||!(k.connectNulls&&!m&&!x))).forEach(function($,ee){let ae,fe=$.plotX,ve=$.plotY,Te=n[ee-1],Ae=$.isNull||typeof ve!="number";($.leftCliff||Te!=null&&Te.rightCliff)&&!x&&(N=!0),Ae&&!At(m)&&ee>0?N=!k.connectNulls:Ae&&!m?N=!0:(ee===0||N?ae=[["M",$.plotX,$.plotY]]:S.getPointSpline?ae=[S.getPointSpline(n,$,ee)]:Y?(ae=Y===1?[["L",Te.plotX,ve]]:Y===2?[["L",(Te.plotX+fe)/2,Te.plotY],["L",(Te.plotX+fe)/2,ve]]:[["L",fe,Te.plotY]]).push(["L",fe,ve]):ae=[["L",fe,ve]],R.push($.x),Y&&(R.push($.x),Y===2&&R.push($.x)),L.push.apply(L,ae),N=!1)}),L.xMap=R,S.graphPath=L,L}}si.defaultOptions=Ct(Vl.defaultOptions,{legendSymbol:"lineMarker"}),pn.registerSeriesType("line",si);let{seriesTypes:{line:wi}}=pn,{extend:_i,merge:Bi,objectEach:Kt,pick:ui}=Gs;class Ft extends wi{drawGraph(){this.areaPath=[],super.drawGraph.apply(this);let{areaPath:n,options:m}=this;[this,...this.zones].forEach((x,S)=>{let k={},L=x.fillColor||m.fillColor,R=x.area,N=R?"animate":"attr";R?(R.endX=this.preventGraphAnimation?null:n.xMap,R.animate({d:n})):(k.zIndex=0,(R=x.area=this.chart.renderer.path(n).addClass("highcharts-area"+(S?` highcharts-zone-area-${S-1} `:" ")+(S&&x.className||"")).add(this.group)).isArea=!0),this.chart.styledMode||(k.fill=L||x.color||this.color,k["fill-opacity"]=L?1:m.fillOpacity??.75,R.css({pointerEvents:this.stickyTracking?"none":"auto"})),R[N](k),R.startX=n.xMap,R.shiftUnit=m.step?2:1})}getGraphPath(n){let m,x,S,k=wi.prototype.getGraphPath,L=this.options,R=L.stacking,N=this.yAxis,Y=[],se=[],$=this.index,ee=N.stacking.stacks[this.stackKey],ae=L.threshold,fe=Math.round(N.getThreshold(L.threshold)),ve=ui(L.connectNulls,R==="percent"),Te=function(Mt,Nt,Rt){let $t=n[Mt],Ti=R&&ee[$t.x].points[$],hi=$t[Rt+"Null"]||0,Ei=$t[Rt+"Cliff"]||0,Ji,er,Is=!0;Ei||hi?(Ji=(hi?Ti[0]:Ti[1])+Ei,er=Ti[0]+Ei,Is=!!hi):!R&&n[Nt]&&n[Nt].isNull&&(Ji=er=ae),Ji!==void 0&&(se.push({plotX:m,plotY:Ji===null?fe:N.getThreshold(Ji),isNull:Is,isCliff:!0}),Y.push({plotX:m,plotY:er===null?fe:N.getThreshold(er),doCurve:!1}))};n=n||this.points,R&&(n=this.getStackPoints(n));for(let Mt=0,Nt=n.length;Mt<Nt;++Mt)R||(n[Mt].leftCliff=n[Mt].rightCliff=n[Mt].leftNull=n[Mt].rightNull=void 0),x=n[Mt].isNull,m=ui(n[Mt].rectPlotX,n[Mt].plotX),S=R?ui(n[Mt].yBottom,fe):fe,(!x||ve)&&(ve||Te(Mt,Mt-1,"left"),x&&!R&&ve||(se.push(n[Mt]),Y.push({x:Mt,plotX:m,plotY:S})),ve||Te(Mt,Mt+1,"right"));let Ae=k.call(this,se,!0,!0);Y.reversed=!0;let Ve=k.call(this,Y,!0,!0),Ke=Ve[0];Ke&&Ke[0]==="M"&&(Ve[0]=["L",Ke[1],Ke[2]]);let Tt=Ae.concat(Ve);Tt.length&&Tt.push(["Z"]);let St=k.call(this,se,!1,ve);return this.chart.series.length>1&&R&&se.some(Mt=>Mt.isCliff)&&(Tt.hasStackedCliffs=St.hasStackedCliffs=!0),Tt.xMap=Ae.xMap,this.areaPath=Tt,St}getStackPoints(n){let m=this,x=[],S=[],k=this.xAxis,L=this.yAxis,R=L.stacking.stacks[this.stackKey],N={},Y=L.series,se=Y.length,$=L.options.reversedStacks?1:-1,ee=Y.indexOf(m);if(n=n||this.points,this.options.stacking){for(let fe=0;fe<n.length;fe++)n[fe].leftNull=n[fe].rightNull=void 0,N[n[fe].x]=n[fe];Kt(R,function(fe,ve){fe.total!==null&&S.push(ve)}),S.sort(function(fe,ve){return fe-ve});let ae=Y.map(fe=>fe.visible);S.forEach(function(fe,ve){let Te=0,Ae,Ve;if(N[fe]&&!N[fe].isNull)x.push(N[fe]),[-1,1].forEach(function(Ke){let Tt=Ke===1?"rightNull":"leftNull",St=R[S[ve+Ke]],Mt=0;if(St){let Nt=ee;for(;Nt>=0&&Nt<se;){let Rt=Y[Nt].index;!(Ae=St.points[Rt])&&(Rt===m.index?N[fe][Tt]=!0:ae[Nt]&&(Ve=R[fe].points[Rt])&&(Mt-=Ve[1]-Ve[0])),Nt+=$}}N[fe][Ke===1?"rightCliff":"leftCliff"]=Mt});else{let Ke=ee;for(;Ke>=0&&Ke<se;){let Tt=Y[Ke].index;if(Ae=R[fe].points[Tt]){Te=Ae[1];break}Ke+=$}Te=ui(Te,0),Te=L.translate(Te,0,1,0,1),x.push({isNull:!0,plotX:k.translate(fe,0,0,0,1),x:fe,plotY:Te,yBottom:Te})}})}return x}}Ft.defaultOptions=Bi(wi.defaultOptions,{threshold:0,legendSymbol:"areaMarker"}),_i(Ft.prototype,{singleStacks:!1}),pn.registerSeriesType("area",Ft);let{line:Ai}=pn.seriesTypes,{merge:ai,pick:Di}=Gs;class Yi extends Ai{getPointSpline(n,m,x){let S,k,L,R,N=m.plotX||0,Y=m.plotY||0,se=n[x-1],$=n[x+1];function ee(fe){return fe&&!fe.isNull&&fe.doCurve!==!1&&!m.isCliff}if(ee(se)&&ee($)){let fe=se.plotX||0,ve=se.plotY||0,Te=$.plotX||0,Ae=$.plotY||0,Ve=0;S=(1.5*N+fe)/2.5,k=(1.5*Y+ve)/2.5,L=(1.5*N+Te)/2.5,R=(1.5*Y+Ae)/2.5,L!==S&&(Ve=(R-k)*(L-N)/(L-S)+Y-R),k+=Ve,R+=Ve,k>ve&&k>Y?(k=Math.max(ve,Y),R=2*Y-k):k<ve&&k<Y&&(k=Math.min(ve,Y),R=2*Y-k),R>Ae&&R>Y?(R=Math.max(Ae,Y),k=2*Y-R):R<Ae&&R<Y&&(R=Math.min(Ae,Y),k=2*Y-R),m.rightContX=L,m.rightContY=R,m.controlPoints={low:[S,k],high:[L,R]}}let ae=["C",Di(se.rightContX,se.plotX,0),Di(se.rightContY,se.plotY,0),Di(S,N,0),Di(k,Y,0),N,Y];return se.rightContX=se.rightContY=void 0,ae}}Yi.defaultOptions=ai(Ai.defaultOptions),pn.registerSeriesType("spline",Yi);let Mi=Yi,{area:qi,area:{prototype:_s}}=pn.seriesTypes,{extend:Ts,merge:us}=Gs;class Os extends Mi{}Os.defaultOptions=us(Mi.defaultOptions,qi.defaultOptions),Ts(Os.prototype,{getGraphPath:_s.getGraphPath,getStackPoints:_s.getStackPoints,drawGraph:_s.drawGraph}),pn.registerSeriesType("areaspline",Os);let{animObject:Rs}=Oo,{parse:Js}=qt,{noop:ur}=fi,{clamp:Pr,crisp:Bo,defined:Tn,extend:xo,fireEvent:Yo,isArray:Nn,isNumber:Er,merge:br,pick:zr,objectEach:_n}=Gs;class Xa extends Vl{animate(n){let m,x,S=this,k=this.yAxis,L=k.pos,R=k.reversed,N=S.options,{clipOffset:Y,inverted:se}=this.chart,$={},ee=se?"translateX":"translateY";n&&Y?($.scaleY=.001,x=Pr(k.toPixels(N.threshold||0),L,L+k.len),se?$.translateX=(x+=R?-Math.floor(Y[0]):Math.ceil(Y[2]))-k.len:$.translateY=x+=R?Math.ceil(Y[0]):-Math.floor(Y[2]),S.clipBox&&S.setClip(),S.group.attr($)):(m=Number(S.group.attr(ee)),S.group.animate({scaleY:1},xo(Rs(S.options.animation),{step:function(ae,fe){S.group&&($[ee]=m+fe.pos*(L-m),S.group.attr($))}})))}init(n,m){super.init.apply(this,arguments);let x=this;(n=x.chart).hasRendered&&n.series.forEach(function(S){S.type===x.type&&(S.isDirty=!0)})}getColumnMetrics(){var ve,Te;let n=this,m=n.options,x=n.xAxis,S=n.yAxis,k=x.options.reversedStacks,L=x.reversed&&!k||!x.reversed&&k,R={},N,Y=0;m.grouping===!1?Y=1:n.chart.series.forEach(function(Ae){let Ve,Ke=Ae.yAxis,Tt=Ae.options;Ae.type===n.type&&Ae.reserveSpace()&&S.len===Ke.len&&S.pos===Ke.pos&&(Tt.stacking&&Tt.stacking!=="group"?(R[N=Ae.stackKey]===void 0&&(R[N]=Y++),Ve=R[N]):Tt.grouping!==!1&&(Ve=Y++),Ae.columnIndex=Ve)});let se=Math.min(Math.abs(x.transA)*(!((ve=x.brokenAxis)!=null&&ve.hasBreaks)&&((Te=x.ordinal)==null?void 0:Te.slope)||m.pointRange||x.closestPointRange||x.tickInterval||1),x.len),$=se*m.groupPadding,ee=(se-2*$)/(Y||1),ae=Math.min(m.maxPointWidth||x.len,zr(m.pointWidth,ee*(1-2*m.pointPadding))),fe=(n.columnIndex||0)+ +!!L;return n.columnMetrics={width:ae,offset:(ee-ae)/2+($+fe*ee-se/2)*(L?-1:1),paddedWidth:ee,columnCount:Y},n.columnMetrics}crispCol(n,m,x,S){let k=this.borderWidth,L=this.chart.inverted;return S=Bo(m+S,k,L)-(m=Bo(m,k,L)),this.options.crisp&&(x=Bo(n+x,k)-(n=Bo(n,k))),{x:n,y:m,width:x,height:S}}adjustForMissingColumns(n,m,x,S){var k;if(!x.isNull&&S.columnCount>1){let L=this.xAxis.series.filter(se=>se.visible).map(se=>se.index),R=0,N=0;_n((k=this.xAxis.stacking)==null?void 0:k.stacks,se=>{var fe;let $=typeof x.x=="number"?(fe=se[x.x.toString()])==null?void 0:fe.points:void 0,ee=$==null?void 0:$[this.index],ae={};if($&&Nn(ee)){let ve=this.index,Te=Object.keys($).filter(Ae=>!Ae.match(",")&&$[Ae]&&$[Ae].length>1).map(parseFloat).filter(Ae=>L.indexOf(Ae)!==-1).filter(Ae=>{let Ve=this.chart.series[Ae].options,Ke=Ve.stacking&&Ve.stack;if(Tn(Ke)){if(Er(ae[Ke]))return ve===Ae&&(ve=ae[Ke]),!1;ae[Ke]=Ae}return!0}).sort((Ae,Ve)=>Ve-Ae);R=Te.indexOf(ve),N=Te.length}}),R=this.xAxis.reversed?N-1-R:R;let Y=(N-1)*S.paddedWidth+m;n=(x.plotX||0)+Y/2-m-R*S.paddedWidth}return n}translate(){let n=this,m=n.chart,x=n.options,S=n.dense=n.closestPointRange*n.xAxis.transA<2,k=n.borderWidth=zr(x.borderWidth,+!S),L=n.xAxis,R=n.yAxis,N=x.threshold,Y=zr(x.minPointLength,5),se=n.getColumnMetrics(),$=se.width,ee=n.pointXOffset=se.offset,ae=n.dataMin,fe=n.dataMax,ve=n.translatedThreshold=R.getThreshold(N),Te=n.barW=Math.max($,1+2*k);x.pointPadding&&x.crisp&&(Te=Math.ceil(Te)),Vl.prototype.translate.apply(n),n.points.forEach(function(Ae){let Ve=zr(Ae.yBottom,ve),Ke=999+Math.abs(Ve),Tt=Ae.plotX||0,St=Pr(Ae.plotY,-Ke,R.len+Ke),Mt,Nt=Math.min(St,Ve),Rt=Math.max(St,Ve)-Nt,$t=$,Ti=Tt+ee,hi=Te;Y&&Math.abs(Rt)<Y&&(Rt=Y,Mt=!R.reversed&&!Ae.negative||R.reversed&&Ae.negative,Er(N)&&Er(fe)&&Ae.y===N&&fe<=N&&(R.min||0)<N&&(ae!==fe||(R.max||0)<=N)&&(Mt=!Mt,Ae.negative=!Ae.negative),Nt=Math.abs(Nt-ve)>Y?Ve-Y:ve-(Mt?Y:0)),Tn(Ae.options.pointWidth)&&(Ti-=Math.round((($t=hi=Math.ceil(Ae.options.pointWidth))-$)/2)),x.centerInCategory&&(Ti=n.adjustForMissingColumns(Ti,$t,Ae,se)),Ae.barX=Ti,Ae.pointWidth=$t,Ae.tooltipPos=m.inverted?[Pr(R.len+R.pos-m.plotLeft-St,R.pos-m.plotLeft,R.len+R.pos-m.plotLeft),L.len+L.pos-m.plotTop-Ti-hi/2,Rt]:[L.left-m.plotLeft+Ti+hi/2,Pr(St+R.pos-m.plotTop,R.pos-m.plotTop,R.len+R.pos-m.plotTop),Rt],Ae.shapeType=n.pointClass.prototype.shapeType||"roundedRect",Ae.shapeArgs=n.crispCol(Ti,Nt,hi,Ae.isNull?0:Rt)}),Yo(this,"afterColumnTranslate")}drawGraph(){this.group[this.dense?"addClass":"removeClass"]("highcharts-dense-data")}pointAttribs(n,m){let x=this.options,S=this.pointAttrToOptions||{},k=S.stroke||"borderColor",L=S["stroke-width"]||"borderWidth",R,N,Y,se=n&&n.color||this.color,$=n&&n[k]||x[k]||se,ee=n&&n.options.dashStyle||x.dashStyle,ae=n&&n[L]||x[L]||this[L]||0,fe=n!=null&&n.isNull&&x.nullInteraction?0:(n==null?void 0:n.opacity)??x.opacity??1;n&&this.zones.length&&(N=n.getZone(),se=n.options.color||N&&(N.color||n.nonZonedColor)||this.color,N&&($=N.borderColor||$,ee=N.dashStyle||ee,ae=N.borderWidth||ae)),m&&n&&(Y=(R=br(x.states[m],n.options.states&&n.options.states[m]||{})).brightness,se=R.color||Y!==void 0&&Js(se).brighten(R.brightness).get()||se,$=R[k]||$,ae=R[L]||ae,ee=R.dashStyle||ee,fe=zr(R.opacity,fe));let ve={fill:se,stroke:$,"stroke-width":ae,opacity:fe};return ee&&(ve.dashstyle=ee),ve}drawPoints(n=this.points){let m,x=this,S=this.chart,k=x.options,L=k.nullInteraction,R=S.renderer,N=k.animationLimit||250;n.forEach(function(Y){let se=Y.plotY,$=Y.graphic,ee=!!$,ae=$&&S.pointCount<N?"animate":"attr";Er(se)&&(Y.y!==null||L)?(m=Y.shapeArgs,$&&Y.hasNewShapeType()&&($=$.destroy()),x.enabledDataSorting&&(Y.startXPos=x.xAxis.reversed?-(m&&m.width||0):x.xAxis.width),!$&&(Y.graphic=$=R[Y.shapeType](m).add(Y.group||x.group),$&&x.enabledDataSorting&&S.hasRendered&&S.pointCount<N&&($.attr({x:Y.startXPos}),ee=!0,ae="animate")),$&&ee&&$[ae](br(m)),S.styledMode||$[ae](x.pointAttribs(Y,Y.selected&&"select")).shadow(Y.allowShadow!==!1&&k.shadow),$&&($.addClass(Y.getClassName(),!0),$.attr({visibility:Y.visible?"inherit":"hidden"}))):$&&(Y.graphic=$.destroy())})}drawTracker(n=this.points){let m,x=this,S=x.chart,k=S.pointer,L=function(R){k==null||k.normalize(R);let N=k==null?void 0:k.getPointFromEvent(R);k&&N&&x.options.enableMouseTracking&&(S.isInsidePlot(R.chartX-S.plotLeft,R.chartY-S.plotTop,{visiblePlotOnly:!0})||k!=null&&k.inClass(R.target,"highcharts-data-label"))&&(k.isDirectTouch=!0,N.onMouseOver(R))};n.forEach(function(R){m=Nn(R.dataLabels)?R.dataLabels:R.dataLabel?[R.dataLabel]:[],R.graphic&&(R.graphic.element.point=R),m.forEach(function(N){(N.div||N.element).point=R})}),x._hasTracking||(x.trackerGroups.forEach(function(R){x[R]&&(x[R].addClass("highcharts-tracker").on("mouseover",L).on("mouseout",function(N){k==null||k.onTrackerMouseOut(N)}).on("touchstart",L),!S.styledMode&&x.options.cursor&&x[R].css({cursor:x.options.cursor}))}),x._hasTracking=!0),Yo(this,"afterDrawTracker")}remove(){let n=this,m=n.chart;m.hasRendered&&m.series.forEach(function(x){x.type===n.type&&(x.isDirty=!0)}),Vl.prototype.remove.apply(n,arguments)}}Xa.defaultOptions=br(Vl.defaultOptions,{borderRadius:3,centerInCategory:!1,groupPadding:.2,marker:null,pointPadding:.1,minPointLength:0,cropThreshold:50,pointRange:null,states:{hover:{halo:!1,brightness:.1},select:{color:"#cccccc",borderColor:"#000000"}},dataLabels:{align:void 0,verticalAlign:void 0,y:void 0},startFromThreshold:!0,stickyTracking:!1,tooltip:{distance:6},threshold:0,borderColor:"#ffffff"}),xo(Xa.prototype,{directTouch:!0,getSymbol:ur,negStacks:!0,trackerGroups:["group","dataLabelsGroup"]}),pn.registerSeriesType("column",Xa);let Mo=Xa,{getDeferredAnimation:jo}=Oo,{format:Yn}=ja,{defined:Xr,extend:$n,fireEvent:hn,getAlignFactor:cn,isArray:dn,isString:_o,merge:qn,objectEach:uh,pick:sn,pInt:Go,splat:hc}=Gs;(function(H){function n(){return N(this).some(se=>se==null?void 0:se.enabled)}function m(se,$,ee,ae,fe){var Ti;let{chart:ve,enabledDataSorting:Te}=this,Ae=this.isCartesian&&ve.inverted,Ve=se.plotX,Ke=se.plotY,Tt=ee.rotation||0,St=Xr(Ve)&&Xr(Ke)&&ve.isInsidePlot(Ve,Math.round(Ke),{inverted:Ae,paneCoordinates:!0,series:this}),Mt=Tt===0&&sn(ee.overflow,Te?"none":"justify")==="justify",Nt=this.visible&&se.visible!==!1&&Xr(Ve)&&(se.series.forceDL||Te&&!Mt||St||sn(ee.inside,!!this.options.stacking)&&ae&&ve.isInsidePlot(Ve,Ae?ae.x+1:ae.y+ae.height-1,{inverted:Ae,paneCoordinates:!0,series:this})),Rt=se.pos();if(Nt&&Rt){var $t;let hi=$.getBBox(),Ei=$.getBBox(void 0,0);if(ae=$n({x:Rt[0],y:Math.round(Rt[1]),width:0,height:0},ae||{}),ee.alignTo==="plotEdges"&&this.isCartesian&&(ae[Ae?"x":"y"]=0,ae[Ae?"width":"height"]=((Ti=this.yAxis)==null?void 0:Ti.len)||0),$n(ee,{width:hi.width,height:hi.height}),$t=ae,Te&&this.xAxis&&!Mt&&this.setDataLabelStartPos(se,$,fe,St,$t),$.align(qn(ee,{width:Ei.width,height:Ei.height}),!1,ae,!1),$.alignAttr.x+=cn(ee.align)*(Ei.width-hi.width),$.alignAttr.y+=cn(ee.verticalAlign)*(Ei.height-hi.height),$[$.placed?"animate":"attr"]({"text-align":$.alignAttr["text-align"]||"center",x:$.alignAttr.x+(hi.width-Ei.width)/2,y:$.alignAttr.y+(hi.height-Ei.height)/2,rotationOriginX:($.width||0)/2,rotationOriginY:($.height||0)/2}),Mt&&ae.height>=0)this.justifyDataLabel($,ee,$.alignAttr,hi,ae,fe);else if(sn(ee.crop,!0)){let{x:Ji,y:er}=$.alignAttr;Nt=ve.isInsidePlot(Ji,er,{paneCoordinates:!0,series:this})&&ve.isInsidePlot(Ji+hi.width-1,er+hi.height-1,{paneCoordinates:!0,series:this})}ee.shape&&!Tt&&$[fe?"attr":"animate"]({anchorX:Rt[0],anchorY:Rt[1]})}fe&&Te&&($.placed=!1),Nt||Te&&!Mt?($.show(),$.placed=!0):($.hide(),$.placed=!1)}function x(){return this.plotGroup("dataLabelsGroup","data-labels",this.hasRendered?"inherit":"hidden",this.options.dataLabels.zIndex||6,this.chart.dataLabelsGroup)}function S(se){let $=this.hasRendered||0,ee=this.initDataLabelsGroup().attr({opacity:+$});return!$&&ee&&(this.visible&&ee.show(),this.options.animation?ee.animate({opacity:1},se):ee.attr({opacity:1})),ee}function k(se){var Nt;let $;se=se||this.points;let ee=this,ae=ee.chart,fe=ee.options,ve=ae.renderer,{backgroundColor:Te,plotBackgroundColor:Ae}=ae.options.chart,Ve=ve.getContrast(_o(Ae)&&Ae||_o(Te)&&Te||"#000000"),Ke=N(ee),{animation:Tt,defer:St}=Ke[0],Mt=St?jo(ae,Tt,ee):{defer:0,duration:0};hn(this,"drawDataLabels"),(Nt=ee.hasDataLabels)!=null&&Nt.call(ee)&&($=this.initDataLabels(Mt),se.forEach(Rt=>{var Ei,Ji,er;let $t=Rt.dataLabels||[],Ti=Rt.color||ee.color;hc(R(Ke,Rt.dlOptions||((Ei=Rt.options)==null?void 0:Ei.dataLabels))).forEach((Is,Hs)=>{var ul;let qs=Is.enabled&&(Rt.visible||Rt.dataLabelOnHidden)&&(!Rt.isNull||Rt.dataLabelOnNull)&&function(Zc,Sm){let Uf=Sm.filter;if(Uf){let vu=Uf.operator,bd=Zc[Uf.property],nh=Uf.value;return vu===">"&&bd>nh||vu==="<"&&bd<nh||vu===">="&&bd>=nh||vu==="<="&&bd<=nh||vu==="=="&&bd==nh||vu==="==="&&bd===nh||vu==="!="&&bd!=nh||vu==="!=="&&bd!==nh||!1}return!0}(Rt,Is),{backgroundColor:dr,borderColor:xr,distance:wr,style:io={}}=Is,sl,Wo,qo,ko={},no=$t[Hs],$a=!no,Fa;qs&&(Wo=Xr(sl=sn(Is[Rt.formatPrefix+"Format"],Is.format))?Yn(sl,Rt,ae):(Is[Rt.formatPrefix+"Formatter"]||Is.formatter).call(Rt,Is),qo=Is.rotation,!ae.styledMode&&(io.color=sn(Is.color,io.color,_o(ee.color)?ee.color:void 0,"#000000"),io.color==="contrast"?(dr!=="none"&&(Fa=dr),Rt.contrastColor=ve.getContrast(Fa!=="auto"&&_o(Fa)&&Fa||(_o(Ti)?Ti:"")),io.color=Fa||!Xr(wr)&&Is.inside||0>Go(wr||0)||fe.stacking?Rt.contrastColor:Ve):delete Rt.contrastColor,fe.cursor&&(io.cursor=fe.cursor)),ko={r:Is.borderRadius||0,rotation:qo,padding:Is.padding,zIndex:1},ae.styledMode||(ko.fill=dr==="auto"?Rt.color:dr,ko.stroke=xr==="auto"?Rt.color:xr,ko["stroke-width"]=Is.borderWidth),uh(ko,(Zc,Sm)=>{Zc===void 0&&delete ko[Sm]})),!no||qs&&Xr(Wo)&&!!(no.div||(ul=no.text)!=null&&ul.foreignObject)==!!Is.useHTML&&(no.rotation&&Is.rotation||no.rotation===Is.rotation)||(no=void 0,$a=!0),qs&&Xr(Wo)&&Wo!==""&&(no?ko.text=Wo:(no=ve.label(Wo,0,0,Is.shape,void 0,void 0,Is.useHTML,void 0,"data-label")).addClass(" highcharts-data-label-color-"+Rt.colorIndex+" "+(Is.className||"")+(Is.useHTML?" highcharts-tracker":"")),no&&(no.options=Is,no.attr(ko),ae.styledMode?io.width&&no.css({width:io.width,textOverflow:io.textOverflow,whiteSpace:io.whiteSpace}):no.css(io).shadow(Is.shadow),hn(no,"beforeAddingDataLabel",{labelOptions:Is,point:Rt}),no.added||no.add($),ee.alignDataLabel(Rt,no,Is,void 0,$a),no.isActive=!0,$t[Hs]&&$t[Hs]!==no&&$t[Hs].destroy(),$t[Hs]=no))});let hi=$t.length;for(;hi--;)(Ji=$t[hi])!=null&&Ji.isActive?$t[hi].isActive=!1:((er=$t[hi])==null||er.destroy(),$t.splice(hi,1));Rt.dataLabel=$t[0],Rt.dataLabels=$t})),hn(this,"afterDrawDataLabels")}function L(se,$,ee,ae,fe,ve){let Te=this.chart,Ae=$.align,Ve=$.verticalAlign,Ke=se.box?0:se.padding||0,Tt=Te.inverted?this.yAxis:this.xAxis,St=Tt?Tt.left-Te.plotLeft:0,Mt=Te.inverted?this.xAxis:this.yAxis,Nt=Mt?Mt.top-Te.plotTop:0,{x:Rt=0,y:$t=0}=$,Ti,hi;return(Ti=(ee.x||0)+Ke+St)<0&&(Ae==="right"&&Rt>=0?($.align="left",$.inside=!0):Rt-=Ti,hi=!0),(Ti=(ee.x||0)+ae.width-Ke+St)>Te.plotWidth&&(Ae==="left"&&Rt<=0?($.align="right",$.inside=!0):Rt+=Te.plotWidth-Ti,hi=!0),(Ti=ee.y+Ke+Nt)<0&&(Ve==="bottom"&&$t>=0?($.verticalAlign="top",$.inside=!0):$t-=Ti,hi=!0),(Ti=(ee.y||0)+ae.height-Ke+Nt)>Te.plotHeight&&(Ve==="top"&&$t<=0?($.verticalAlign="bottom",$.inside=!0):$t+=Te.plotHeight-Ti,hi=!0),hi&&($.x=Rt,$.y=$t,se.placed=!ve,se.align($,void 0,fe)),hi}function R(se,$){let ee=[],ae;if(dn(se)&&!dn($))ee=se.map(function(fe){return qn(fe,$)});else if(dn($)&&!dn(se))ee=$.map(function(fe){return qn(se,fe)});else if(dn(se)||dn($)){if(dn(se)&&dn($))for(ae=Math.max(se.length,$.length);ae--;)ee[ae]=qn(se[ae],$[ae])}else ee=qn(se,$);return ee}function N(se){var ee,ae;let $=se.chart.options.plotOptions;return hc(R(R((ee=$==null?void 0:$.series)==null?void 0:ee.dataLabels,(ae=$==null?void 0:$[se.type])==null?void 0:ae.dataLabels),se.options.dataLabels))}function Y(se,$,ee,ae,fe){let ve=this.chart,Te=ve.inverted,Ae=this.xAxis,Ve=Ae.reversed,Ke=((Te?$.height:$.width)||0)/2,Tt=se.pointWidth,St=Tt?Tt/2:0;$.startXPos=Te?fe.x:Ve?-Ke-St:Ae.width-Ke+St,$.startYPos=Te?Ve?this.yAxis.height-Ke+St:-Ke-St:fe.y,ae?$.visibility==="hidden"&&($.show(),$.attr({opacity:0}).animate({opacity:1})):$.attr({opacity:1}).animate({opacity:0},void 0,$.hide),ve.hasRendered&&(ee&&$.attr({x:$.startXPos,y:$.startYPos}),$.placed=!0)}H.compose=function(se){let $=se.prototype;$.initDataLabels||($.initDataLabels=S,$.initDataLabelsGroup=x,$.alignDataLabel=m,$.drawDataLabels=k,$.justifyDataLabel=L,$.mergeArrays=R,$.setDataLabelStartPos=Y,$.hasDataLabels=n)}})(ir||(ir={}));let Rh=ir,{composed:Bd}=fi,{series:gu}=pn,{merge:qc,pushUnique:kc}=Gs;(function(H){function n(m,x,S,k,L){var ve,Te;let{chart:R,options:N}=this,Y=R.inverted,se=((ve=this.xAxis)==null?void 0:ve.len)||R.plotSizeX||0,$=((Te=this.yAxis)==null?void 0:Te.len)||R.plotSizeY||0,ee=m.dlBox||m.shapeArgs,ae=m.below??(m.plotY||0)>(this.translatedThreshold??$),fe=S.inside??!!N.stacking;if(ee){if(k=qc(ee),S.overflow!=="allow"||S.crop!==!1||N.clip!==!1){k.y<0&&(k.height+=k.y,k.y=0);let Ae=k.y+k.height-$;Ae>0&&Ae<k.height-1&&(k.height-=Ae)}Y&&(k={x:$-k.y-k.height,y:se-k.x-k.width,width:k.height,height:k.width}),fe||(Y?(k.x+=ae?0:k.width,k.width=0):(k.y+=ae?k.height:0,k.height=0))}S.align??(S.align=!Y||fe?"center":ae?"right":"left"),S.verticalAlign??(S.verticalAlign=Y||fe?"middle":ae?"top":"bottom"),gu.prototype.alignDataLabel.call(this,m,x,S,k,L),S.inside&&m.contrastColor&&x.css({color:m.contrastColor})}H.compose=function(m){Rh.compose(gu),kc(Bd,"ColumnDataLabel")&&(m.prototype.alignDataLabel=n)}})(fr||(fr={}));let hp=fr,{extend:Fd,merge:yu}=Gs;class Lf extends Mo{}Lf.defaultOptions=yu(Mo.defaultOptions,{}),Fd(Lf.prototype,{inverted:!0}),pn.registerSeriesType("bar",Lf);let{column:fg,line:Of}=pn.seriesTypes,{addEvent:Df,extend:pm,merge:mg}=Gs;class Pp extends Of{applyJitter(){let n=this,m=this.options.jitter,x=this.points.length;m&&this.points.forEach(function(S,k){["x","y"].forEach(function(L,R){if(m[L]&&!S.isNull){let N=`plot${L.toUpperCase()}`,Y=n[`${L}Axis`],se=m[L]*Y.transA;if(Y&&!Y.logarithmic){let $=Math.max(0,(S[N]||0)-se),ee=Math.min(Y.len,(S[N]||0)+se);S[N]=$+(ee-$)*function(ae){let fe=1e4*Math.sin(ae);return fe-Math.floor(fe)}(k+R*x),L==="x"&&(S.clientX=S.plotX)}}})})}drawGraph(){this.options.lineWidth?super.drawGraph():this.graph&&(this.graph=this.graph.destroy())}}Pp.defaultOptions=mg(Of.defaultOptions,{lineWidth:0,findNearestPointBy:"xy",jitter:{x:0,y:0},marker:{enabled:!0},tooltip:{headerFormat:'<span style="color:{point.color}">●</span> <span style="font-size: 0.8em"> {series.name}</span><br/>',pointFormat:"x: <b>{point.x}</b><br/>y: <b>{point.y}</b><br/>"}}),pm(Pp.prototype,{drawTracker:fg.prototype.drawTracker,sorted:!1,requireSorting:!1,noSharedTooltip:!0,trackerGroups:["group","markerGroup","dataLabelsGroup"]}),Df(Pp,"afterTranslate",function(){this.applyJitter()}),pn.registerSeriesType("scatter",Pp);let{deg2rad:gd}=fi,{fireEvent:fm,isNumber:xu,pick:Hu,relativeLength:Ig}=Gs;(function(H){H.getCenter=function(){let n=this.options,m=this.chart,x=2*(n.slicedOffset||0),S=m.plotWidth-2*x,k=m.plotHeight-2*x,L=n.center,R=Math.min(S,k),N=n.thickness,Y,se=n.size,$=n.innerSize||0,ee,ae;typeof se=="string"&&(se=parseFloat(se)),typeof $=="string"&&($=parseFloat($));let fe=[Hu(L==null?void 0:L[0],"50%"),Hu(L==null?void 0:L[1],"50%"),Hu(se&&se<0?void 0:n.size,"100%"),Hu($&&$<0?void 0:n.innerSize||0,"0%")];for(!m.angular||this instanceof Vl||(fe[3]=0),ee=0;ee<4;++ee)ae=fe[ee],Y=ee<2||ee===2&&/%$/.test(ae),fe[ee]=Ig(ae,[S,k,R,fe[2]][ee])+(Y?x:0);return fe[3]>fe[2]&&(fe[3]=fe[2]),xu(N)&&2*N<fe[2]&&N>0&&(fe[3]=fe[2]-2*N),fm(this,"afterGetCenter",{positions:fe}),fe},H.getStartAndEndRadians=function(n,m){let x=xu(n)?n:0,S=xu(m)&&m>x&&m-x<360?m:x+360;return{start:gd*(x+-90),end:gd*(S+-90)}}})(wo||(wo={}));let Um=wo,{setAnimation:ay}=Oo,{addEvent:ly,defined:hy,extend:yx,isNumber:Lg,pick:xx,relativeLength:mm}=Gs;class Ny extends bt{getConnectorPath(n){let m=n.dataLabelPosition,x=n.options||{},S=x.connectorShape,k=this.connectorShapes[S]||S;return m&&k.call(this,{...m.computed,alignment:m.alignment},m.connectorPosition,x)||[]}getTranslate(){return this.sliced&&this.slicedTranslation||{translateX:0,translateY:0}}haloPath(n){let m=this.shapeArgs;return this.sliced||!this.visible?[]:this.series.chart.renderer.symbols.arc(m.x,m.y,m.r+n,m.r+n,{innerR:m.r-1,start:m.start,end:m.end,borderRadius:m.borderRadius})}constructor(n,m,x){super(n,m,x),this.half=0,this.name??(this.name=n.chart.options.lang.pieSliceName);let S=k=>{this.slice(k.type==="select")};ly(this,"select",S),ly(this,"unselect",S)}isValid(){return Lg(this.y)&&this.y>=0}setVisible(n,m=!0){n!==this.visible&&this.update({visible:n??!this.visible},m,void 0,!1)}slice(n,m,x){let S=this.series;ay(x,S.chart),m=xx(m,!0),this.sliced=this.options.sliced=n=hy(n)?n:!this.sliced,S.options.data[S.data.indexOf(this)]=this.options,this.graphic&&this.graphic.animate(this.getTranslate())}}yx(Ny.prototype,{connectorShapes:{fixedOffset:function(H,n,m){let x=n.breakAt,S=n.touchingSliceAt,k=m.softConnector?["C",H.x+(H.alignment==="left"?-5:5),H.y,2*x.x-S.x,2*x.y-S.y,x.x,x.y]:["L",x.x,x.y];return[["M",H.x,H.y],k,["L",S.x,S.y]]},straight:function(H,n){let m=n.touchingSliceAt;return[["M",H.x,H.y],["L",m.x,m.y]]},crookedLine:function(H,n,m){let{angle:x=this.angle||0,breakAt:S,touchingSliceAt:k}=n,{series:L}=this,[R,N,Y]=L.center,se=Y/2,{plotLeft:$,plotWidth:ee}=L.chart,ae=H.alignment==="left",{x:fe,y:ve}=H,Te=S.x;if(m.crookDistance){let Ve=mm(m.crookDistance,1);Te=ae?R+se+(ee+$-R-se)*(1-Ve):$+(R-se)*Ve}else Te=R+(N-ve)*Math.tan(x-Math.PI/2);let Ae=[["M",fe,ve]];return(ae?Te<=fe&&Te>=S.x:Te>=fe&&Te<=S.x)&&Ae.push(["L",Te,ve]),Ae.push(["L",S.x,S.y],["L",k.x,k.y]),Ae}}});let{getStartAndEndRadians:cc}=Um,{noop:gm}=fi,{clamp:cy,extend:_x,fireEvent:jm,merge:Vy,pick:Uy}=Gs;class gg extends Vl{animate(n){let m=this,x=m.points,S=m.startAngleRad;n||x.forEach(function(k){let L=k.graphic,R=k.shapeArgs;L&&R&&(L.attr({r:Uy(k.startR,m.center&&m.center[3]/2),start:S,end:S}),L.animate({r:R.r,start:R.start,end:R.end},m.options.animation))})}drawEmpty(){let n,m,x=this.startAngleRad,S=this.endAngleRad,k=this.options;this.total===0&&this.center?(n=this.center[0],m=this.center[1],this.graph||(this.graph=this.chart.renderer.arc(n,m,this.center[1]/2,0,x,S).addClass("highcharts-empty-series").add(this.group)),this.graph.attr({d:sd.arc(n,m,this.center[2]/2,0,{start:x,end:S,innerR:this.center[3]/2})}),this.chart.styledMode||this.graph.attr({"stroke-width":k.borderWidth,fill:k.fillColor||"none",stroke:k.color||"#cccccc"})):this.graph&&(this.graph=this.graph.destroy())}drawPoints(){let n=this.chart.renderer;this.points.forEach(function(m){m.graphic&&m.hasNewShapeType()&&(m.graphic=m.graphic.destroy()),m.graphic||(m.graphic=n[m.shapeType](m.shapeArgs).add(m.series.group),m.delayedRendering=!0)})}generatePoints(){super.generatePoints(),this.updateTotals()}getX(n,m,x,S){let k=this.center,L=this.radii?this.radii[x.index]||0:k[2]/2,R=S.dataLabelPosition,N=(R==null?void 0:R.distance)||0,Y=Math.asin(cy((n-k[1])/(L+N),-1,1));return k[0]+Math.cos(Y)*(L+N)*(m?-1:1)+(N>0?(m?-1:1)*(S.padding||0):0)}hasData(){return!!this.dataTable.rowCount}redrawPoints(){let n,m,x,S,k=this,L=k.chart;this.drawEmpty(),k.group&&!L.styledMode&&k.group.shadow(k.options.shadow),k.points.forEach(function(R){let N={};m=R.graphic,!R.isNull&&m?(S=R.shapeArgs,n=R.getTranslate(),L.styledMode||(x=k.pointAttribs(R,R.selected&&"select")),R.delayedRendering?(m.setRadialReference(k.center).attr(S).attr(n),L.styledMode||m.attr(x).attr({"stroke-linejoin":"round"}),R.delayedRendering=!1):(m.setRadialReference(k.center),L.styledMode||Vy(!0,N,x),Vy(!0,N,S,n),m.animate(N)),m.attr({visibility:R.visible?"inherit":"hidden"}),m.addClass(R.getClassName(),!0)):m&&(R.graphic=m.destroy())})}sortByAngle(n,m){n.sort(function(x,S){return x.angle!==void 0&&(S.angle-x.angle)*m})}translate(n){jm(this,"translate"),this.generatePoints();let m=this.options,x=m.slicedOffset,S=cc(m.startAngle,m.endAngle),k=this.startAngleRad=S.start,L=(this.endAngleRad=S.end)-k,R=this.points,N=m.ignoreHiddenPoint,Y=R.length,se,$,ee,ae,fe,ve,Te,Ae=0;for(n||(this.center=n=this.getCenter()),ve=0;ve<Y;ve++){Te=R[ve],se=k+Ae*L,Te.isValid()&&(!N||Te.visible)&&(Ae+=Te.percentage/100),$=k+Ae*L;let Ve={x:n[0],y:n[1],r:n[2]/2,innerR:n[3]/2,start:Math.round(1e3*se)/1e3,end:Math.round(1e3*$)/1e3};Te.shapeType="arc",Te.shapeArgs=Ve,(ee=($+se)/2)>1.5*Math.PI?ee-=2*Math.PI:ee<-Math.PI/2&&(ee+=2*Math.PI),Te.slicedTranslation={translateX:Math.round(Math.cos(ee)*x),translateY:Math.round(Math.sin(ee)*x)},ae=Math.cos(ee)*n[2]/2,fe=Math.sin(ee)*n[2]/2,Te.tooltipPos=[n[0]+.7*ae,n[1]+.7*fe],Te.half=+(ee<-Math.PI/2||ee>Math.PI/2),Te.angle=ee}jm(this,"afterTranslate")}updateTotals(){let n=this.points,m=n.length,x=this.options.ignoreHiddenPoint,S,k,L=0;for(S=0;S<m;S++)(k=n[S]).isValid()&&(!x||k.visible)&&(L+=k.y);for(S=0,this.total=L;S<m;S++)(k=n[S]).percentage=L>0&&(k.visible||!x)?k.y/L*100:0,k.total=L}}gg.defaultOptions=Vy(Vl.defaultOptions,{borderRadius:3,center:[null,null],clip:!1,colorByPoint:!0,dataLabels:{connectorPadding:5,connectorShape:"crookedLine",crookDistance:void 0,distance:30,enabled:!0,formatter:function(){return this.isNull?void 0:this.name},softConnector:!0,x:0},fillColor:void 0,ignoreHiddenPoint:!0,inactiveOtherPoints:!0,legendType:"point",marker:null,size:null,showInLegend:!1,slicedOffset:10,stickyTracking:!1,tooltip:{followPointer:!0},borderColor:"#ffffff",borderWidth:1,lineWidth:void 0,states:{hover:{brightness:.1}}}),_x(gg.prototype,{axisTypes:[],directTouch:!0,drawGraph:void 0,drawTracker:Mo.prototype.drawTracker,getCenter:Um.getCenter,getSymbol:gm,invertible:!1,isCartesian:!1,noSharedTooltip:!0,pointAttribs:Mo.prototype.pointAttribs,pointClass:Ny,requireSorting:!1,searchPoint:gm,trackerGroups:["group","dataLabelsGroup"]}),pn.registerSeriesType("pie",gg);let{composed:vx,noop:bx}=fi,{distribute:wx}=Gr,{series:yg}=pn,{arrayMax:Ip,clamp:rf,defined:dy,pick:jy,pushUnique:Og,relativeLength:Dg}=Gs;(function(H){let n={radialDistributionY:function(L,R){var N;return(((N=R.dataLabelPosition)==null?void 0:N.top)||0)+L.distributeBox.pos},radialDistributionX:function(L,R,N,Y,se){let $=se.dataLabelPosition;return L.getX(N<(($==null?void 0:$.top)||0)+2||N>(($==null?void 0:$.bottom)||0)-2?Y:N,R.half,R,se)},justify:function(L,R,N,Y){var se;return Y[0]+(L.half?-1:1)*(N+(((se=R.dataLabelPosition)==null?void 0:se.distance)||0))},alignToPlotEdges:function(L,R,N,Y){let se=L.getBBox().width;return R?se+Y:N-se-Y},alignToConnectors:function(L,R,N,Y){let se=0,$;return L.forEach(function(ee){($=ee.dataLabel.getBBox().width)>se&&(se=$)}),R?se+Y:N-se-Y}};function m(L,R){let N=Math.PI/2,{start:Y=0,end:se=0}=L.shapeArgs||{},$=L.angle||0;R>0&&Y<N&&se>N&&$>N/2&&$<1.5*N&&($=$<=N?Math.max(N/2,(Y+N)/2):Math.min(1.5*N,(N+se)/2));let{center:ee,options:ae}=this,fe=ee[2]/2,ve=Math.cos($),Te=Math.sin($),Ae=ee[0]+ve*fe,Ve=ee[1]+Te*fe,Ke=Math.min((ae.slicedOffset||0)+(ae.borderWidth||0),R/5);return{natural:{x:Ae+ve*R,y:Ve+Te*R},computed:{},alignment:R<0?"center":L.half?"right":"left",connectorPosition:{angle:$,breakAt:{x:Ae+ve*Ke,y:Ve+Te*Ke},touchingSliceAt:{x:Ae,y:Ve}},distance:R}}function x(){var Nt;let L=this,R=L.points,N=L.chart,Y=N.plotWidth,se=N.plotHeight,$=N.plotLeft,ee=Math.round(N.chartWidth/3),ae=L.center,fe=ae[2]/2,ve=ae[1],Te=[[],[]],Ae=[0,0,0,0],Ve=L.dataLabelPositioners,Ke,Tt,St,Mt=0;L.visible&&((Nt=L.hasDataLabels)!=null&&Nt.call(L))&&(R.forEach(Rt=>{(Rt.dataLabels||[]).forEach($t=>{$t.shortened&&($t.attr({width:"auto"}).css({width:"auto",textOverflow:"clip"}),$t.shortened=!1)})}),yg.prototype.drawDataLabels.apply(L),R.forEach(Rt=>{(Rt.dataLabels||[]).forEach(($t,Ti)=>{var er;let hi=ae[2]/2,Ei=$t.options,Ji=Dg((Ei==null?void 0:Ei.distance)||0,hi);Ti===0&&Te[Rt.half].push(Rt),!dy((er=Ei==null?void 0:Ei.style)==null?void 0:er.width)&&$t.getBBox().width>ee&&($t.css({width:Math.round(.7*ee)+"px"}),$t.shortened=!0),$t.dataLabelPosition=this.getDataLabelPosition(Rt,Ji),Mt=Math.max(Mt,Ji)})}),Te.forEach((Rt,$t)=>{let Ti=Rt.length,hi=[],Ei,Ji,er=0,Is;Ti&&(L.sortByAngle(Rt,$t-.5),Mt>0&&(Ei=Math.max(0,ve-fe-Mt),Ji=Math.min(ve+fe+Mt,N.plotHeight),Rt.forEach(Hs=>{(Hs.dataLabels||[]).forEach(qs=>{var xr;let dr=qs.dataLabelPosition;dr&&dr.distance>0&&(dr.top=Math.max(0,ve-fe-dr.distance),dr.bottom=Math.min(ve+fe+dr.distance,N.plotHeight),er=qs.getBBox().height||21,qs.lineHeight=N.renderer.fontMetrics(qs.text||qs).h+2*qs.padding,Hs.distributeBox={target:(((xr=qs.dataLabelPosition)==null?void 0:xr.natural.y)||0)-dr.top+qs.lineHeight/2,size:er,rank:Hs.y},hi.push(Hs.distributeBox))})}),wx(hi,Is=Ji+er-Ei,Is/5)),Rt.forEach(Hs=>{(Hs.dataLabels||[]).forEach(qs=>{let dr=qs.options||{},xr=Hs.distributeBox,wr=qs.dataLabelPosition,io=(wr==null?void 0:wr.natural.y)||0,sl=dr.connectorPadding||0,Wo=qs.lineHeight||21,qo=(Wo-qs.getBBox().height)/2,ko=0,no=io,$a="inherit";if(wr){if(hi&&dy(xr)&&wr.distance>0&&(xr.pos===void 0?$a="hidden":(St=xr.size,no=Ve.radialDistributionY(Hs,qs))),dr.justify)ko=Ve.justify(Hs,qs,fe,ae);else switch(dr.alignTo){case"connectors":ko=Ve.alignToConnectors(Rt,$t,Y,$);break;case"plotEdges":ko=Ve.alignToPlotEdges(qs,$t,Y,$);break;default:ko=Ve.radialDistributionX(L,Hs,no-qo,io,qs)}if(wr.attribs={visibility:$a,align:wr.alignment},wr.posAttribs={x:ko+(dr.x||0)+({left:sl,right:-sl}[wr.alignment]||0),y:no+(dr.y||0)-Wo/2},wr.computed.x=ko,wr.computed.y=no-qo,jy(dr.crop,!0)){let Fa;ko-(Tt=qs.getBBox().width)<sl&&$t===1?(Fa=Math.round(Tt-ko+sl),Ae[3]=Math.max(Fa,Ae[3])):ko+Tt>Y-sl&&$t===0&&(Fa=Math.round(ko+Tt-Y+sl),Ae[1]=Math.max(Fa,Ae[1])),no-St/2<0?Ae[0]=Math.max(Math.round(-no+St/2),Ae[0]):no+St/2>se&&(Ae[2]=Math.max(Math.round(no+St/2-se),Ae[2])),wr.sideOverflow=Fa}}})}))}),(Ip(Ae)===0||this.verifyDataLabelOverflow(Ae))&&(this.placeDataLabels(),this.points.forEach(Rt=>{(Rt.dataLabels||[]).forEach($t=>{var Ji;let{connectorColor:Ti,connectorWidth:hi=1}=$t.options||{},Ei=$t.dataLabelPosition;if(hi){let er;Ke=$t.connector,Ei&&Ei.distance>0?(er=!Ke,Ke||($t.connector=Ke=N.renderer.path().addClass("highcharts-data-label-connector  highcharts-color-"+Rt.colorIndex+(Rt.className?" "+Rt.className:"")).add(L.dataLabelsGroup)),N.styledMode||Ke.attr({"stroke-width":hi,stroke:Ti||Rt.color||"#666666"}),Ke[er?"attr":"animate"]({d:Rt.getConnectorPath($t)}),Ke.attr({visibility:(Ji=Ei.attribs)==null?void 0:Ji.visibility})):Ke&&($t.connector=Ke.destroy())}})})))}function S(){this.points.forEach(L=>{(L.dataLabels||[]).forEach(R=>{var Y,se;let N=R.dataLabelPosition;N?(N.sideOverflow&&(R.css({width:Math.max(R.getBBox().width-N.sideOverflow,0)+"px",textOverflow:((se=(Y=R.options)==null?void 0:Y.style)==null?void 0:se.textOverflow)||"ellipsis"}),R.shortened=!0),R.attr(N.attribs),R[R.moved?"animate":"attr"](N.posAttribs),R.moved=!0):R&&R.attr({y:-9999})}),delete L.distributeBox},this)}function k(L){let R=this.center,N=this.options,Y=N.center,se=N.minSize||80,$=se,ee=N.size!==null;return!ee&&(Y[0]!==null?$=Math.max(R[2]-Math.max(L[1],L[3]),se):($=Math.max(R[2]-L[1]-L[3],se),R[0]+=(L[3]-L[1])/2),Y[1]!==null?$=rf($,se,R[2]-Math.max(L[0],L[2])):($=rf($,se,R[2]-L[0]-L[2]),R[1]+=(L[0]-L[2])/2),$<R[2]?(R[2]=$,R[3]=Math.min(N.thickness?Math.max(0,$-2*N.thickness):Math.max(0,Dg(N.innerSize||0,$)),$),this.translate(R),this.drawDataLabels&&this.drawDataLabels()):ee=!0),ee}H.compose=function(L){if(Rh.compose(yg),Og(vx,"PieDataLabel")){let R=L.prototype;R.dataLabelPositioners=n,R.alignDataLabel=bx,R.drawDataLabels=x,R.getDataLabelPosition=m,R.placeDataLabels=S,R.verifyDataLabelOverflow=k}}})(rn||(rn={}));let zg=rn;(function(H){H.getCenterOfPoints=function(n){let m=n.reduce((x,S)=>(x.x+=S.x,x.y+=S.y,x),{x:0,y:0});return{x:m.x/n.length,y:m.y/n.length}},H.getDistanceBetweenPoints=function(n,m){return Math.sqrt(Math.pow(m.x-n.x,2)+Math.pow(m.y-n.y,2))},H.getAngleBetweenPoints=function(n,m){return Math.atan2(m.x-n.x,m.y-n.y)},H.pointInPolygon=function({x:n,y:m},x){let S=x.length,k,L,R=!1;for(k=0,L=S-1;k<S;L=k++){let[N,Y]=x[k],[se,$]=x[L];Y>m!=$>m&&n<(se-N)*(m-Y)/($-Y)+N&&(R=!R)}return R}})(Pi||(Pi={}));let{pointInPolygon:Rg}=Pi,{addEvent:uy,getAlignFactor:Bg,fireEvent:Fg,objectEach:py,pick:Ng}=Gs;function Tx(H){let n=H.length,m=(se,$)=>!($.x>=se.x+se.width||$.x+$.width<=se.x||$.y>=se.y+se.height||$.y+$.height<=se.y),x=(se,$)=>{for(let ee of se)if(Rg({x:ee[0],y:ee[1]},$))return!0;return!1},S,k,L,R,N,Y=!1;for(let se=0;se<n;se++)(S=H[se])&&(S.oldOpacity=S.opacity,S.newOpacity=1,S.absoluteBox=function($){var ee,ae;if($&&(!$.alignAttr||$.placed)){let fe=$.box?0:$.padding||0,ve=$.alignAttr||{x:$.attr("x"),y:$.attr("y")},{height:Te,polygon:Ae,width:Ve}=$.getBBox(),Ke=Bg($.alignValue)*Ve;return $.width=Ve,$.height=Te,{x:ve.x+(((ee=$.parentGroup)==null?void 0:ee.translateX)||0)+fe-Ke,y:ve.y+(((ae=$.parentGroup)==null?void 0:ae.translateY)||0)+fe,width:Ve-2*fe,height:Te-2*fe,polygon:Ae}}}(S));H.sort((se,$)=>($.labelrank||0)-(se.labelrank||0));for(let se=0;se<n;++se){R=(k=H[se])&&k.absoluteBox;let $=R==null?void 0:R.polygon;for(let ee=se+1;ee<n;++ee){N=(L=H[ee])&&L.absoluteBox;let ae=!1;if(R&&N&&k!==L&&k.newOpacity!==0&&L.newOpacity!==0&&k.visibility!=="hidden"&&L.visibility!=="hidden"){let fe=N.polygon;if($&&fe&&$!==fe?x($,fe)&&(ae=!0):m(R,N)&&(ae=!0),ae){let ve=k.labelrank<L.labelrank?k:L,Te=ve.text;ve.newOpacity=0,Te!=null&&Te.element.querySelector("textPath")&&Te.hide()}}}}for(let se of H)Lp(se,this)&&(Y=!0);Y&&Fg(this,"afterHideAllOverlappingLabels")}function Lp(H,n){let m,x=!1;return H&&(m=H.newOpacity,H.oldOpacity!==m&&(H.hasClass("highcharts-data-label")?(H[m?"removeClass":"addClass"]("highcharts-data-label-hidden"),x=!0,H[H.isOld?"animate":"attr"]({opacity:m},void 0,function(){n.styledMode||H.css({pointerEvents:m?"auto":"none"})}),Fg(n,"afterHideOverlappingLabel")):H.attr({opacity:m})),H.isOld=!0),x}function Gy(){var m;let H=this,n=[];for(let x of H.labelCollectors||[])n=n.concat(x());for(let x of H.yAxis||[])x.stacking&&x.options.stackLabels&&!x.options.stackLabels.allowOverlap&&py(x.stacking.stacks,S=>{py(S,k=>{k.label&&n.push(k.label)})});for(let x of H.series||[])if(x.visible&&((m=x.hasDataLabels)!=null&&m.call(x))){let S=k=>{for(let L of k)L.visible&&(L.dataLabels||[]).forEach(R=>{var Y;let N=R.options||{};R.labelrank=Ng(N.labelrank,L.labelrank,(Y=L.shapeArgs)==null?void 0:Y.height),N.allowOverlap??Number(N.distance)>0?(R.oldOpacity=R.opacity,R.newOpacity=1,Lp(R,H)):n.push(R)})};S(x.nodes||[]),S(x.points)}this.hideOverlappingLabels(n)}let Vg={compose:function(H){let n=H.prototype;n.hideOverlappingLabels||(n.hideOverlappingLabels=Tx,uy(H,"render",Gy))}},{defaultOptions:Wy}=ei,{noop:fy}=fi,{addEvent:Hy,extend:n_,isObject:Ug,merge:Sx,relativeLength:my}=Gs,Xy={radius:0,scope:"stack",where:void 0},jg=fy,Mx=fy;function gy(H,n,m,x,S={}){let k=jg(H,n,m,x,S),{innerR:L=0,r:R=m,start:N=0,end:Y=0}=S;if(S.open||!S.borderRadius)return k;let se=Y-N,$=Math.sin(se/2),ee=Math.max(Math.min(my(S.borderRadius||0,R-L),(R-L)/2,R*$/(1+$)),0),ae=Math.min(ee,se/Math.PI*2*L),fe=k.length-1;for(;fe--;)(function(ve,Te,Ae){let Ve,Ke,Tt,St=ve[Te],Mt=ve[Te+1];if(Mt[0]==="Z"&&(Mt=ve[0]),(St[0]==="M"||St[0]==="L")&&Mt[0]==="A"?(Ve=St,Ke=Mt,Tt=!0):St[0]==="A"&&(Mt[0]==="M"||Mt[0]==="L")&&(Ve=Mt,Ke=St),Ve&&Ke&&Ke.params){let Nt=Ke[1],Rt=Ke[5],$t=Ke.params,{start:Ti,end:hi,cx:Ei,cy:Ji}=$t,er=Rt?Nt-Ae:Nt+Ae,Is=er?Math.asin(Ae/er):0,Hs=Rt?Is:-Is,qs=Math.cos(Is)*er;Tt?($t.start=Ti+Hs,Ve[1]=Ei+qs*Math.cos(Ti),Ve[2]=Ji+qs*Math.sin(Ti),ve.splice(Te+1,0,["A",Ae,Ae,0,0,1,Ei+Nt*Math.cos($t.start),Ji+Nt*Math.sin($t.start)])):($t.end=hi-Hs,Ke[6]=Ei+Nt*Math.cos($t.end),Ke[7]=Ji+Nt*Math.sin($t.end),ve.splice(Te+1,0,["A",Ae,Ae,0,0,1,Ei+qs*Math.cos(hi),Ji+qs*Math.sin(hi)])),Ke[4]=Math.abs($t.end-$t.start)<Math.PI?0:1}})(k,fe,fe>1?ae:ee);return k}function Ax(){var H,n;if(this.options.borderRadius&&!(this.chart.is3d&&this.chart.is3d())){let{options:m,yAxis:x}=this,S=m.stacking==="percent",k=(n=(H=Wy.plotOptions)==null?void 0:H[this.type])==null?void 0:n.borderRadius,L=Gg(m.borderRadius,Ug(k)?k:{}),R=x.options.reversed;for(let N of this.points){let{shapeArgs:Y}=N;if(N.shapeType==="roundedRect"&&Y){let{width:se=0,height:$=0,y:ee=0}=Y,ae=ee,fe=$;if(L.scope==="stack"&&N.stackTotal){let Ve=x.translate(S?100:N.stackTotal,!1,!0,!1,!0),Ke=x.translate(m.threshold||0,!1,!0,!1,!0),Tt=this.crispCol(0,Math.min(Ve,Ke),0,Math.abs(Ve-Ke));ae=Tt.y,fe=Tt.height}let ve=(N.negative?-1:1)*(R?-1:1)==-1,Te=L.where;!Te&&this.is("waterfall")&&Math.abs((N.yBottom||0)-(this.translatedThreshold||0))>this.borderWidth&&(Te="all"),Te||(Te="end");let Ae=Math.min(my(L.radius,se),se/2,Te==="all"?$/2:1/0)||0;Te==="end"&&(ve&&(ae-=Ae),fe+=Ae),n_(Y,{brBoxHeight:fe,brBoxY:ae,r:Ae})}}}}function Gg(H,n){return Ug(H)||(H={radius:H||0}),Sx(Xy,n,H)}function he(){let H=Gg(this.options.borderRadius);for(let n of this.points){let m=n.shapeArgs;m&&(m.borderRadius=my(H.radius,(m.r||0)-(m.innerR||0)))}}function u(H,n,m,x,S={}){let k=Mx(H,n,m,x,S),{r:L=0,brBoxHeight:R=x,brBoxY:N=n}=S,Y=n-N,se=N+R-(n+x),$=Y-L>-.1?0:L,ee=se-L>-.1?0:L,ae=Math.max($&&Y,0),fe=Math.max(ee&&se,0),ve=[H+$,n],Te=[H+m-$,n],Ae=[H+m,n+$],Ve=[H+m,n+x-ee],Ke=[H+m-ee,n+x],Tt=[H+ee,n+x],St=[H,n+x-ee],Mt=[H,n+$],Nt=(Rt,$t)=>Math.sqrt(Math.pow(Rt,2)-Math.pow($t,2));if(ae){let Rt=Nt($,$-ae);ve[0]-=Rt,Te[0]+=Rt,Ae[1]=Mt[1]=n+$-ae}if(x<$-ae){let Rt=Nt($,$-ae-x);Ae[0]=Ve[0]=H+m-$+Rt,Ke[0]=Math.min(Ae[0],Ke[0]),Tt[0]=Math.max(Ve[0],Tt[0]),St[0]=Mt[0]=H+$-Rt,Ae[1]=Mt[1]=n+x}if(fe){let Rt=Nt(ee,ee-fe);Ke[0]+=Rt,Tt[0]-=Rt,Ve[1]=St[1]=n+x-ee+fe}if(x<ee-fe){let Rt=Nt(ee,ee-fe-x);Ae[0]=Ve[0]=H+m-ee+Rt,Te[0]=Math.min(Ae[0],Te[0]),ve[0]=Math.max(Ve[0],ve[0]),St[0]=Mt[0]=H+ee-Rt,Ve[1]=St[1]=n}return k.length=0,k.push(["M",...ve],["L",...Te],["A",$,$,0,0,1,...Ae],["L",...Ve],["A",ee,ee,0,0,1,...Ke],["L",...Tt],["A",ee,ee,0,0,1,...St],["L",...Mt],["A",$,$,0,0,1,...ve],["Z"]),k}let{diffObjects:v,extend:M,find:z,merge:F,pick:V,uniqueKey:G}=Gs;(function(H){function n(x,S){let k=x.condition;(k.callback||function(){return this.chartWidth<=V(k.maxWidth,Number.MAX_VALUE)&&this.chartHeight<=V(k.maxHeight,Number.MAX_VALUE)&&this.chartWidth>=V(k.minWidth,0)&&this.chartHeight>=V(k.minHeight,0)}).call(this)&&S.push(x._id)}function m(x,S){let k=this.options.responsive,L=this.currentResponsive,R=[],N;!S&&k&&k.rules&&k.rules.forEach($=>{$._id===void 0&&($._id=G()),this.matchResponsiveRule($,R)},this);let Y=F(...R.map($=>z((k==null?void 0:k.rules)||[],ee=>ee._id===$)).map($=>$==null?void 0:$.chartOptions));Y.isResponsiveOptions=!0,R=R.toString()||void 0;let se=L==null?void 0:L.ruleIds;R!==se&&(L&&(this.currentResponsive=void 0,this.updatingResponsive=!0,this.update(L.undoOptions,x,!0),this.updatingResponsive=!1),R?((N=v(Y,this.options,!0,this.collectionsWithUpdate)).isResponsiveOptions=!0,this.currentResponsive={ruleIds:R,mergedOptions:Y,undoOptions:N},this.updatingResponsive||this.update(Y,x,!0)):this.currentResponsive=void 0)}H.compose=function(x){let S=x.prototype;return S.matchResponsiveRule||M(S,{matchResponsiveRule:n,setResponsive:m}),x}})(fo||(fo={}));let Q=fo;fi.AST=Wn,fi.Axis=nu,fi.Chart=ih,fi.Color=qt,fi.DataLabel=Rh,fi.DataTableCore=ya,fi.Fx=ds,fi.HTMLElement=_c,fi.Legend=hm,fi.LegendSymbol=qr,fi.OverlappingDataLabels=fi.OverlappingDataLabels||Vg,fi.PlotLineOrBand=au,fi.Point=bt,fi.Pointer=bs,fi.RendererRegistry=Bn,fi.Series=Vl,fi.SeriesRegistry=pn,fi.StackItem=_,fi.SVGElement=La,fi.SVGRenderer=Nc,fi.Templating=ja,fi.Tick=ho,fi.Time=Zl,fi.Tooltip=nm,fi.animate=Oo.animate,fi.animObject=Oo.animObject,fi.chart=ih.chart,fi.color=qt.parse,fi.dateFormat=ja.dateFormat,fi.defaultOptions=ei.defaultOptions,fi.distribute=Gr.distribute,fi.format=ja.format,fi.getDeferredAnimation=Oo.getDeferredAnimation,fi.getOptions=ei.getOptions,fi.numberFormat=ja.numberFormat,fi.seriesType=pn.seriesType,fi.setAnimation=Oo.setAnimation,fi.setOptions=ei.setOptions,fi.stop=Oo.stop,fi.time=ei.defaultTime,fi.timers=ds.timers,{compose:function(H,n,m){let x=H.types.pie;if(!n.symbolCustomAttribs.includes("borderRadius")){let S=m.prototype.symbols;Hy(H,"afterColumnTranslate",Ax,{order:9}),Hy(x,"afterTranslate",he),n.symbolCustomAttribs.push("borderRadius","brBoxHeight","brBoxY"),jg=S.arc,Mx=S.roundedRect,S.arc=gy,S.roundedRect=u}},optionsToObject:Gg}.compose(fi.Series,fi.SVGElement,fi.SVGRenderer),hp.compose(fi.Series.types.column),Rh.compose(fi.Series),Im.compose(fi.Axis),_c.compose(fi.SVGRenderer),hm.compose(fi.Chart),Ou.compose(fi.Axis),Vg.compose(fi.Chart),zg.compose(fi.Series.types.pie),au.compose(fi.Chart,fi.Axis),bs.compose(fi.Chart),Q.compose(fi.Chart),md.compose(fi.Axis,fi.Chart,fi.Series),pt.compose(fi.Axis,fi.Chart,fi.Series),nm.compose(fi.Pointer),Gs.extend(fi,Gs);let{tooltipFormatter:le}=bt.prototype,{addEvent:ye,arrayMax:ce,arrayMin:we,correctFloat:Le,defined:Ue,isArray:et,isNumber:tt,isString:$e,pick:ht}=Gs;(function(H){function n($,ee,ae){!this.isXAxis&&(this.series.forEach(function(fe){$==="compare"&&typeof ee!="boolean"?fe.setCompare(ee,!1):$!=="cumulative"||$e(ee)||fe.setCumulative(ee,!1)}),ht(ae,!0)&&this.chart.redraw())}function m($){let ee=this,{numberFormatter:ae}=ee.series.chart,fe=function(ve){$=$.replace("{point."+ve+"}",(ee[ve]>0&&ve==="change"?"+":"")+ae(ee[ve],ht(ee.series.tooltipOptions.changeDecimals,2)))};return Ue(ee.change)&&fe("change"),Ue(ee.cumulativeSum)&&fe("cumulativeSum"),le.apply(this,[$])}function x(){let $,ee=this.options.compare;(ee==="percent"||ee==="value"||this.options.cumulative)&&($=new se(this),ee==="percent"||ee==="value"?$.initCompare(ee):$.initCumulative()),this.dataModify=$}function S($){let ee=$.dataExtremes,ae=ee.activeYData;if(this.dataModify&&ee){let fe;this.options.compare?fe=[this.dataModify.modifyValue(ee.dataMin),this.dataModify.modifyValue(ee.dataMax)]:this.options.cumulative&&et(ae)&&ae.length>=2&&(fe=se.getCumulativeExtremes(ae)),fe&&(ee.dataMin=we(fe),ee.dataMax=ce(fe))}}function k($,ee){this.options.compare=this.userOptions.compare=$,this.update({},ht(ee,!0)),this.dataModify&&($==="value"||$==="percent")?this.dataModify.initCompare($):this.points.forEach(ae=>{delete ae.change})}function L(){let $=this.getColumn(this.pointArrayMap&&(this.options.pointValKey||this.pointValKey)||"y",!0);if(this.xAxis&&$.length&&this.dataModify){let ee=this.getColumn("x",!0),ae=this.dataTable.rowCount,fe=+(this.options.compareStart!==!0);for(let ve=0;ve<ae-fe;ve++){let Te=$[ve];if(tt(Te)&&Te!==0&&ee[ve+fe]>=(this.xAxis.min||0)){this.dataModify.compareValue=Te;break}}}}function R($,ee){this.setModifier("compare",$,ee)}function N($,ee){$=ht($,!1),this.options.cumulative=this.userOptions.cumulative=$,this.update({},ht(ee,!0)),this.dataModify?this.dataModify.initCumulative():this.points.forEach(ae=>{delete ae.cumulativeSum})}function Y($,ee){this.setModifier("cumulative",$,ee)}H.compose=function($,ee,ae){let fe=ee.prototype,ve=ae.prototype,Te=$.prototype;return Te.setCompare||(Te.setCompare=k,Te.setCumulative=N,ye($,"afterInit",x),ye($,"afterGetExtremes",S),ye($,"afterProcessData",L)),fe.setCompare||(fe.setCompare=R,fe.setModifier=n,fe.setCumulative=Y,ve.tooltipFormatter=m),$};class se{constructor(ee){this.series=ee}modifyValue(){return 0}static getCumulativeExtremes(ee){let ae=1/0,fe=-1/0;return ee.reduce((ve,Te)=>{let Ae=ve+Te;return ae=Math.min(ae,Ae,ve),fe=Math.max(fe,Ae,ve),Ae}),[ae,fe]}initCompare(ee){this.modifyValue=function(ae,fe){ae===null&&(ae=0);let ve=this.compareValue;if(ae!==void 0&&ve!==void 0){if(ee==="value"?ae-=ve:ae=ae/ve*100-100*(this.series.options.compareBase!==100),fe!==void 0){let Te=this.series.points[fe];Te&&(Te.change=ae)}return ae}return 0}}initCumulative(){this.modifyValue=function(ee,ae){if(ee===null&&(ee=0),ee!==void 0&&ae!==void 0){let fe=ae>0?this.series.points[ae-1]:null;fe&&fe.cumulativeSum&&(ee=Le(fe.cumulativeSum+ee));let ve=this.series.points[ae],Te=ve.series.options.cumulativeStart,Ae=ve.x<=this.series.xAxis.max&&ve.x>=this.series.xAxis.min;return ve&&(!Te||Ae?ve.cumulativeSum=ee:ve.cumulativeSum=void 0),ee}return 0}}}H.Additions=se})(pl||(pl={}));let yt=pl,{isTouchDevice:ci}=fi,{addEvent:ii,merge:ri,pick:Ri}=Gs,ki=[];function Li(){this.navigator&&this.navigator.setBaseSeries(null,!1)}function ls(){var k;let H,n,m,x=this.legend,S=this.navigator;if(S){H=x&&x.options,n=S.xAxis,m=S.yAxis;let{scrollbarHeight:L,scrollButtonSize:R}=S;this.inverted?(S.left=S.opposite?this.chartWidth-L-S.height:this.spacing[3]+L,S.top=this.plotTop+R):(S.left=Ri(n.left,this.plotLeft+R),S.top=S.navigatorOptions.top||this.chartHeight-S.height-L-(((k=this.scrollbar)==null?void 0:k.options.margin)||0)-this.spacing[2]-(this.rangeSelector&&this.extraBottomMargin?this.rangeSelector.getHeight():0)-(H&&H.verticalAlign==="bottom"&&H.layout!=="proximate"&&H.enabled&&!H.floating?x.legendHeight+Ri(H.margin,10):0)-(this.titleOffset?this.titleOffset[2]:0)),n&&m&&(this.inverted?n.options.left=m.options.left=S.left:n.options.top=m.options.top=S.top,n.setAxisSize(),m.setAxisSize())}}function vs(H){!this.navigator&&!this.scroller&&(this.options.navigator.enabled||this.options.scrollbar.enabled)&&(this.scroller=this.navigator=new Qt(this),Ri(H.redraw,!0)&&this.redraw(H.animation))}function Ys(){let H=this.options;(H.navigator.enabled||H.scrollbar.enabled)&&(this.scroller=this.navigator=new Qt(this))}function ks(){let H=this.options,n=H.navigator,m=H.rangeSelector;if((n&&n.enabled||m&&m.enabled)&&(!ci&&this.zooming.type==="x"||ci&&this.zooming.pinchType==="x"))return!1}function Lr(H){let n=H.navigator;if(n&&H.xAxis[0]){let m=H.xAxis[0].getExtremes();n.render(m.min,m.max)}}function Cr(H){let n=H.options.navigator||{},m=H.options.scrollbar||{};!this.navigator&&!this.scroller&&(n.enabled||m.enabled)&&(ri(!0,this.options.navigator,n),ri(!0,this.options.scrollbar,m),delete H.options.navigator,delete H.options.scrollbar)}let Ur={compose:function(H,n){if(Gs.pushUnique(ki,H)){let m=H.prototype;Qt=n,m.callbacks.push(Lr),ii(H,"afterAddSeries",Li),ii(H,"afterSetChartSize",ls),ii(H,"afterUpdate",vs),ii(H,"beforeRender",Ys),ii(H,"beforeShowResetZoom",ks),ii(H,"update",Cr)}}},{isTouchDevice:nr}=fi,{addEvent:Yr,correctFloat:En,defined:Sn,isNumber:Mn,pick:Bh}=Gs;function $o(){this.navigatorAxis||(this.navigatorAxis=new Do(this))}function Ca(H){let n,m=this.chart,x=m.options,S=x.navigator,k=this.navigatorAxis,L=m.zooming.pinchType,R=x.rangeSelector,N=m.zooming.type;if(this.isXAxis&&(S!=null&&S.enabled||R!=null&&R.enabled)){if(N==="y"&&H.trigger==="zoom")n=!1;else if((H.trigger==="zoom"&&N==="xy"||nr&&L==="xy")&&this.options.range){let Y=k.previousZoom;Sn(H.min)?k.previousZoom=[this.min,this.max]:Y&&(H.min=Y[0],H.max=Y[1],k.previousZoom=void 0)}}n!==void 0&&H.preventDefault()}class Do{static compose(n){n.keepProps.includes("navigatorAxis")||(n.keepProps.push("navigatorAxis"),Yr(n,"init",$o),Yr(n,"setExtremes",Ca))}constructor(n){this.axis=n}destroy(){this.axis=void 0}toFixedRange(n,m,x,S){let k=this.axis,L=(k.pointRange||0)/2,R=Bh(x,k.translate(n,!0,!k.horiz)),N=Bh(S,k.translate(m,!0,!k.horiz));return Sn(x)||(R=En(R+L)),Sn(S)||(N=En(N-L)),Mn(R)&&Mn(N)||(R=N=void 0),{min:R,max:N}}}let{parse:go}=qt,{seriesTypes:Al}=pn,oa={height:40,margin:22,maskInside:!0,handles:{width:7,borderRadius:0,height:15,symbols:["navigator-handle","navigator-handle"],enabled:!0,lineWidth:1,backgroundColor:"#f2f2f2",borderColor:"#999999"},maskFill:go("#667aff").setOpacity(.3).get(),outlineColor:"#999999",outlineWidth:1,series:{type:Al.areaspline===void 0?"line":"areaspline",fillOpacity:.05,lineWidth:1,compare:null,sonification:{enabled:!1},dataGrouping:{approximation:"average",enabled:!0,groupPixelWidth:2,firstAnchor:"firstPoint",anchor:"middle",lastAnchor:"lastPoint",units:[["millisecond",[1,2,5,10,20,25,50,100,200,500]],["second",[1,2,5,10,15,30]],["minute",[1,2,5,10,15,30]],["hour",[1,2,3,4,6,8,12]],["day",[1,2,3,4]],["week",[1,2,3]],["month",[1,3,6]],["year",null]]},dataLabels:{enabled:!1,zIndex:2},id:"highcharts-navigator-series",className:"highcharts-navigator-series",lineColor:null,marker:{enabled:!1},threshold:null},xAxis:{className:"highcharts-navigator-xaxis",tickLength:0,lineWidth:0,gridLineColor:"#e6e6e6",id:"navigator-x-axis",gridLineWidth:1,tickPixelInterval:200,labels:{align:"left",style:{color:"#000000",fontSize:"0.7em",opacity:.6,textOutline:"2px contrast"},x:3,y:-4},crosshair:!1},yAxis:{className:"highcharts-navigator-yaxis",gridLineWidth:0,startOnTick:!1,endOnTick:!1,minPadding:.1,id:"navigator-y-axis",maxPadding:.1,labels:{enabled:!1},crosshair:!1,title:{text:void 0},tickLength:0,tickWidth:0}},{relativeLength:na}=Gs,ph={"navigator-handle":function(H,n,m,x,S={}){let k=S.width?S.width/2:m,L=na(S.borderRadius||0,Math.min(2*k,x));return[["M",-1.5,(x=S.height||x)/2-3.5],["L",-1.5,x/2+4.5],["M",.5,x/2-3.5],["L",.5,x/2+4.5],...sd.rect(-k-1,.5,2*k+1,x,{r:L})]}},{defined:sh}=Gs,_u={setFixedRange:function(H){let n=this.xAxis[0];sh(n.dataMax)&&sh(n.dataMin)&&H?this.fixedRange=Math.min(H,n.dataMax-n.dataMin):this.fixedRange=H}},{defaultOptions:Ec}=ei,{composed:aa}=fi,{getRendererType:il}=Bn,{setFixedRange:zf}=_u,{addEvent:ym,extend:Op,pushUnique:xm}=Gs;function yd(){this.chart.navigator&&!this.options.isInternal&&this.chart.navigator.setBaseSeries(null,!1)}let Rf={compose:function(H,n,m){Do.compose(n),xm(aa,"Navigator")&&(H.prototype.setFixedRange=zf,Op(il().prototype.symbols,ph),Op(Ec,{navigator:oa}),ym(m,"afterUpdate",yd))}},{composed:Yy}=fi,{addEvent:$y,defined:xg,pick:Gm,pushUnique:kx}=Gs;(function(H){let n;function m(L){var Y,se;let R=Gm((Y=L.options)==null?void 0:Y.min,L.min),N=Gm((se=L.options)==null?void 0:se.max,L.max);return{axisMin:R,axisMax:N,scrollMin:xg(L.dataMin)?Math.min(R,L.min,L.dataMin,Gm(L.threshold,1/0)):R,scrollMax:xg(L.dataMax)?Math.max(N,L.max,L.dataMax,Gm(L.threshold,-1/0)):N}}function x(){let L=this.scrollbar,R=L&&!L.options.opposite,N=this.horiz?2:R?3:1;L&&(this.chart.scrollbarsOffsets=[0,0],this.chart.axisOffset[N]+=L.size+(L.options.margin||0))}function S(){var R,N;let L=this;(N=(R=L.options)==null?void 0:R.scrollbar)!=null&&N.enabled&&(L.options.scrollbar.vertical=!L.horiz,L.options.startOnTick=L.options.endOnTick=!1,L.scrollbar=new n(L.chart.renderer,L.options.scrollbar,L.chart),$y(L.scrollbar,"changed",function(Y){let se,$,{axisMin:ee,axisMax:ae,scrollMin:fe,scrollMax:ve}=m(L),Te=ve-fe;if(xg(ee)&&xg(ae))if(L.horiz&&!L.reversed||!L.horiz&&L.reversed?(se=fe+Te*this.to,$=fe+Te*this.from):(se=fe+Te*(1-this.from),$=fe+Te*(1-this.to)),this.shouldUpdateExtremes(Y.DOMType)){let Ae=Y.DOMType!=="mousemove"&&Y.DOMType!=="touchmove"&&void 0;L.setExtremes($,se,!0,Ae,Y)}else this.setRange(this.from,this.to)}))}function k(){let L,R,N,{scrollMin:Y,scrollMax:se}=m(this),$=this.scrollbar,ee=this.axisTitleMargin+(this.titleOffset||0),ae=this.chart.scrollbarsOffsets,fe=this.options.margin||0;if($&&ae){if(this.horiz)this.opposite||(ae[1]+=ee),$.position(this.left,this.top+this.height+2+ae[1]-(this.opposite?fe:0),this.width,this.height),this.opposite||(ae[1]+=fe),L=1;else{let ve;this.opposite&&(ae[0]+=ee),ve=$.options.opposite?this.left+this.width+2+ae[0]-(this.opposite?0:fe):this.opposite?0:fe,$.position(ve,this.top,this.width,this.height),this.opposite&&(ae[0]+=fe),L=0}if(ae[L]+=$.size+($.options.margin||0),isNaN(Y)||isNaN(se)||!xg(this.min)||!xg(this.max)||this.dataMin===this.dataMax)$.setRange(0,1);else if(this.min===this.max){let ve=this.pointRange/(this.dataMax+1);R=ve*this.min,N=ve*(this.max+1),$.setRange(R,N)}else R=(this.min-Y)/(se-Y),N=(this.max-Y)/(se-Y),this.horiz&&!this.reversed||!this.horiz&&this.reversed?$.setRange(R,N):$.setRange(1-N,1-R)}}H.compose=function(L,R){kx(Yy,"Axis.Scrollbar")&&(n=R,$y(L,"afterGetOffset",x),$y(L,"afterInit",S),$y(L,"afterRender",k))}})(Cs||(Cs={}));let Xu=Cs,qy={height:10,barBorderRadius:5,buttonBorderRadius:0,buttonsEnabled:!1,liveRedraw:void 0,margin:void 0,minWidth:6,opposite:!0,step:.2,zIndex:3,barBackgroundColor:"#cccccc",barBorderWidth:0,barBorderColor:"#cccccc",buttonArrowColor:"#333333",buttonBackgroundColor:"#e6e6e6",buttonBorderColor:"#cccccc",buttonBorderWidth:1,rifleColor:"none",trackBackgroundColor:"rgba(255, 255, 255, 0.001)",trackBorderColor:"#cccccc",trackBorderRadius:5,trackBorderWidth:1},{defaultOptions:R_}=ei,{composed:B_}=fi,{addEvent:F_,correctFloat:_g,crisp:Ex,defined:N_,destroyObjectProperties:E0,extend:Wg,fireEvent:Hg,merge:Xg,pick:Yg,pushUnique:$g,removeEvent:qg}=Gs;class Dp{static compose(n){Xu.compose(n,Dp),$g(B_,"Scrollbar")&&Wg(R_,{scrollbar:qy})}static swapXY(n,m){return m&&n.forEach(x=>{let S,k=x.length;for(let L=0;L<k;L+=2)typeof(S=x[L+1])=="number"&&(x[L+1]=x[L+2],x[L+2]=S)}),n}constructor(n,m,x){this._events=[],this.chartX=0,this.chartY=0,this.from=0,this.scrollbarButtons=[],this.scrollbarLeft=0,this.scrollbarStrokeWidth=1,this.scrollbarTop=0,this.size=0,this.to=0,this.trackBorderWidth=1,this.x=0,this.y=0,this.init(n,m,x)}addEvents(){let n=this.options.inverted?[1,0]:[0,1],m=this.scrollbarButtons,x=this.scrollbarGroup.element,S=this.track.element,k=this.mouseDownHandler.bind(this),L=this.mouseMoveHandler.bind(this),R=this.mouseUpHandler.bind(this),N=[[m[n[0]].element,"click",this.buttonToMinClick.bind(this)],[m[n[1]].element,"click",this.buttonToMaxClick.bind(this)],[S,"click",this.trackClick.bind(this)],[x,"mousedown",k],[x.ownerDocument,"mousemove",L],[x.ownerDocument,"mouseup",R],[x,"touchstart",k],[x.ownerDocument,"touchmove",L],[x.ownerDocument,"touchend",R]];N.forEach(function(Y){F_.apply(null,Y)}),this._events=N}buttonToMaxClick(n){let m=(this.to-this.from)*Yg(this.options.step,.2);this.updatePosition(this.from+m,this.to+m),Hg(this,"changed",{from:this.from,to:this.to,trigger:"scrollbar",DOMEvent:n})}buttonToMinClick(n){let m=_g(this.to-this.from)*Yg(this.options.step,.2);this.updatePosition(_g(this.from-m),_g(this.to-m)),Hg(this,"changed",{from:this.from,to:this.to,trigger:"scrollbar",DOMEvent:n})}cursorToScrollbarPosition(n){let m=this.options,x=m.minWidth>this.calculatedWidth?m.minWidth:0;return{chartX:(n.chartX-this.x-this.xOffset)/(this.barWidth-x),chartY:(n.chartY-this.y-this.yOffset)/(this.barWidth-x)}}destroy(){let n=this,m=n.chart.scroller;n.removeEvents(),["track","scrollbarRifles","scrollbar","scrollbarGroup","group"].forEach(function(x){n[x]&&n[x].destroy&&(n[x]=n[x].destroy())}),m&&n===m.scrollbar&&(m.scrollbar=null,E0(m.scrollbarButtons))}drawScrollbarButton(n){let m=this.renderer,x=this.scrollbarButtons,S=this.options,k=this.size,L=m.g().add(this.group);if(x.push(L),S.buttonsEnabled){let R=m.rect().addClass("highcharts-scrollbar-button").add(L);this.chart.styledMode||R.attr({stroke:S.buttonBorderColor,"stroke-width":S.buttonBorderWidth,fill:S.buttonBackgroundColor}),R.attr(R.crisp({x:-.5,y:-.5,width:k,height:k,r:S.buttonBorderRadius},R.strokeWidth()));let N=m.path(Dp.swapXY([["M",k/2+(n?-1:1),k/2-3],["L",k/2+(n?-1:1),k/2+3],["L",k/2+(n?2:-2),k/2]],S.vertical)).addClass("highcharts-scrollbar-arrow").add(x[n]);this.chart.styledMode||N.attr({fill:S.buttonArrowColor})}}init(n,m,x){this.scrollbarButtons=[],this.renderer=n,this.userOptions=m,this.options=Xg(qy,R_.scrollbar,m),this.options.margin=Yg(this.options.margin,10),this.chart=x,this.size=Yg(this.options.size,this.options.height),m.enabled&&(this.render(),this.addEvents())}mouseDownHandler(n){var S;let m=((S=this.chart.pointer)==null?void 0:S.normalize(n))||n,x=this.cursorToScrollbarPosition(m);this.chartX=x.chartX,this.chartY=x.chartY,this.initPositions=[this.from,this.to],this.grabbedCenter=!0}mouseMoveHandler(n){var L;let m,x=((L=this.chart.pointer)==null?void 0:L.normalize(n))||n,S=this.options.vertical?"chartY":"chartX",k=this.initPositions||[];this.grabbedCenter&&(!n.touches||n.touches[0][S]!==0)&&(m=this.cursorToScrollbarPosition(x)[S]-this[S],this.hasDragged=!0,this.updatePosition(k[0]+m,k[1]+m),this.hasDragged&&Hg(this,"changed",{from:this.from,to:this.to,trigger:"scrollbar",DOMType:n.type,DOMEvent:n}))}mouseUpHandler(n){this.hasDragged&&Hg(this,"changed",{from:this.from,to:this.to,trigger:"scrollbar",DOMType:n.type,DOMEvent:n}),this.grabbedCenter=this.hasDragged=this.chartX=this.chartY=null}position(n,m,x,S){let{buttonsEnabled:k,margin:L=0,vertical:R}=this.options,N=this.rendered?"animate":"attr",Y=S,se=0;this.group.show(),this.x=n,this.y=m+this.trackBorderWidth,this.width=x,this.height=S,this.xOffset=Y,this.yOffset=se,R?(this.width=this.yOffset=x=se=this.size,this.xOffset=Y=0,this.yOffset=se=k?this.size:0,this.barWidth=S-(k?2*x:0),this.x=n+=L):(this.height=S=this.size,this.xOffset=Y=k?this.size:0,this.barWidth=x-(k?2*S:0),this.y=this.y+L),this.group[N]({translateX:n,translateY:this.y}),this.track[N]({width:x,height:S}),this.scrollbarButtons[1][N]({translateX:R?0:x-Y,translateY:R?S-se:0})}removeEvents(){this._events.forEach(function(n){qg.apply(null,n)}),this._events.length=0}render(){let n=this.renderer,m=this.options,x=this.size,S=this.chart.styledMode,k=n.g("scrollbar").attr({zIndex:m.zIndex}).hide().add();this.group=k,this.track=n.rect().addClass("highcharts-scrollbar-track").attr({r:m.trackBorderRadius||0,height:x,width:x}).add(k),S||this.track.attr({fill:m.trackBackgroundColor,stroke:m.trackBorderColor,"stroke-width":m.trackBorderWidth});let L=this.trackBorderWidth=this.track.strokeWidth();this.track.attr({x:-Ex(0,L),y:-Ex(0,L)}),this.scrollbarGroup=n.g().add(k),this.scrollbar=n.rect().addClass("highcharts-scrollbar-thumb").attr({height:x-L,width:x-L,r:m.barBorderRadius||0}).add(this.scrollbarGroup),this.scrollbarRifles=n.path(Dp.swapXY([["M",-3,x/4],["L",-3,2*x/3],["M",0,x/4],["L",0,2*x/3],["M",3,x/4],["L",3,2*x/3]],m.vertical)).addClass("highcharts-scrollbar-rifles").add(this.scrollbarGroup),S||(this.scrollbar.attr({fill:m.barBackgroundColor,stroke:m.barBorderColor,"stroke-width":m.barBorderWidth}),this.scrollbarRifles.attr({stroke:m.rifleColor,"stroke-width":1})),this.scrollbarStrokeWidth=this.scrollbar.strokeWidth(),this.scrollbarGroup.translate(-Ex(0,this.scrollbarStrokeWidth),-Ex(0,this.scrollbarStrokeWidth)),this.drawScrollbarButton(0),this.drawScrollbarButton(1)}setRange(n,m){let x,S,k=this.options,L=k.vertical,R=k.minWidth,N=this.barWidth,Y=!this.rendered||this.hasDragged||this.chart.navigator&&this.chart.navigator.hasDragged?"attr":"animate";if(!N_(N))return;let se=N*Math.min(m,1);x=Math.ceil(N*(n=Math.max(n,0))),this.calculatedWidth=S=_g(se-x),S<R&&(x=(N-R+S)*n,S=R);let $=Math.floor(x+this.xOffset+this.yOffset),ee=S/2-.5;this.from=n,this.to=m,L?(this.scrollbarGroup[Y]({translateY:$}),this.scrollbar[Y]({height:S}),this.scrollbarRifles[Y]({translateY:ee}),this.scrollbarTop=$,this.scrollbarLeft=0):(this.scrollbarGroup[Y]({translateX:$}),this.scrollbar[Y]({width:S}),this.scrollbarRifles[Y]({translateX:ee}),this.scrollbarLeft=$,this.scrollbarTop=0),S<=12?this.scrollbarRifles.hide():this.scrollbarRifles.show(),k.showFull===!1&&(n<=0&&m>=1?this.group.hide():this.group.show()),this.rendered=!0}shouldUpdateExtremes(n){return Yg(this.options.liveRedraw,fi.svg&&!fi.isTouchDevice&&!this.chart.boosted)||n==="mouseup"||n==="touchend"||!N_(n)}trackClick(n){var L;let m=((L=this.chart.pointer)==null?void 0:L.normalize(n))||n,x=this.to-this.from,S=this.y+this.scrollbarTop,k=this.x+this.scrollbarLeft;this.options.vertical&&m.chartY>S||!this.options.vertical&&m.chartX>k?this.updatePosition(this.from+x,this.to+x):this.updatePosition(this.from-x,this.to-x),Hg(this,"changed",{from:this.from,to:this.to,trigger:"scrollbar",DOMEvent:n})}update(n){this.destroy(),this.init(this.chart.renderer,Xg(!0,this.options,n),this.chart)}updatePosition(n,m){m>1&&(n=_g(1-_g(m-n)),m=1),n<0&&(m=_g(m-n),n=0),this.from=n,this.to=m}}Dp.defaultOptions=qy;let{defaultOptions:yy}=ei,{isTouchDevice:V_}=fi,{prototype:{symbols:xy}}=Nc,{addEvent:xd,clamp:Cx,correctFloat:Wm,defined:Zg,destroyObjectProperties:_y,erase:vy,extend:Px,find:C0,fireEvent:a_,isArray:l_,isNumber:Nd,merge:_m,pick:la,removeEvent:of,splat:Kg}=Gs;function Zy(H,...n){let m=[].filter.call(n,Nd);if(m.length)return Math[H].apply(0,m)}class dc{static compose(n,m,x){Ur.compose(n,dc),Rf.compose(n,m,x)}constructor(n){this.isDirty=!1,this.scrollbarHeight=0,this.init(n)}drawHandle(n,m,x,S){let k=this.navigatorOptions.handles.height;this.handles[m][S](x?{translateX:Math.round(this.left+this.height/2),translateY:Math.round(this.top+parseInt(n,10)+.5-k)}:{translateX:Math.round(this.left+parseInt(n,10)),translateY:Math.round(this.top+this.height/2-k/2-1)})}drawOutline(n,m,x,S){let k=this.navigatorOptions.maskInside,L=this.outline.strokeWidth(),R=L/2,N=L%2/2,Y=this.scrollButtonSize,se=this.size,$=this.top,ee=this.height,ae=$-R,fe=$+ee,ve=this.left,Te,Ae;x?(Te=$+m+N,m=$+n+N,Ae=[["M",ve+ee,$-Y-N],["L",ve+ee,Te],["L",ve,Te],["M",ve,m],["L",ve+ee,m],["L",ve+ee,$+se+Y]],k&&Ae.push(["M",ve+ee,Te-R],["L",ve+ee,m+R])):(ve-=Y,n+=ve+Y-N,m+=ve+Y-N,Ae=[["M",ve,ae],["L",n,ae],["L",n,fe],["M",m,fe],["L",m,ae],["L",ve+se+2*Y,ae]],k&&Ae.push(["M",n-R,ae],["L",m+R,ae])),this.outline[S]({d:Ae})}drawMasks(n,m,x,S){let k,L,R,N,Y=this.left,se=this.top,$=this.height;x?(R=[Y,Y,Y],N=[se,se+n,se+m],L=[$,$,$],k=[n,m-n,this.size-m]):(R=[Y,Y+n,Y+m],N=[se,se,se],L=[n,m-n,this.size-m],k=[$,$,$]),this.shades.forEach((ee,ae)=>{ee[S]({x:R[ae],y:N[ae],width:L[ae],height:k[ae]})})}renderElements(){var Y;let n=this,m=n.navigatorOptions,x=m.maskInside,S=n.chart,k=S.inverted,L=S.renderer,R={cursor:k?"ns-resize":"ew-resize"},N=n.navigatorGroup??(n.navigatorGroup=L.g("navigator").attr({zIndex:8,visibility:"hidden"}).add());if([!x,x,!x].forEach((se,$)=>{let ee=n.shades[$]??(n.shades[$]=L.rect().addClass("highcharts-navigator-mask"+($===1?"-inside":"-outside")).add(N));S.styledMode||(ee.attr({fill:se?m.maskFill:"rgba(0,0,0,0)"}),$===1&&ee.css(R))}),n.outline||(n.outline=L.path().addClass("highcharts-navigator-outline").add(N)),S.styledMode||n.outline.attr({"stroke-width":m.outlineWidth,stroke:m.outlineColor}),(Y=m.handles)==null?void 0:Y.enabled){let se=m.handles,{height:$,width:ee}=se;[0,1].forEach(ae=>{var ve;let fe=se.symbols[ae];if(n.handles[ae]&&n.handles[ae].symbolUrl===fe){if(!n.handles[ae].isImg&&n.handles[ae].symbolName!==fe){let Te=xy[fe].call(xy,-ee/2-1,0,ee,$);n.handles[ae].attr({d:Te}),n.handles[ae].symbolName=fe}}else(ve=n.handles[ae])==null||ve.destroy(),n.handles[ae]=L.symbol(fe,-ee/2-1,0,ee,$,se),n.handles[ae].attr({zIndex:7-ae}).addClass("highcharts-navigator-handle highcharts-navigator-handle-"+["left","right"][ae]).add(N),n.addMouseEvents();S.inverted&&n.handles[ae].attr({rotation:90,rotationOriginX:Math.floor(-ee/2),rotationOriginY:($+ee)/2}),S.styledMode||n.handles[ae].attr({fill:se.backgroundColor,stroke:se.borderColor,"stroke-width":se.lineWidth,width:se.width,height:se.height,x:-ee/2-1,y:0}).css(R)})}}update(n,m=!1){var k;let x=this.chart,S=x.options.chart.inverted!==((k=x.scrollbar)==null?void 0:k.options.vertical);if(_m(!0,x.options.navigator,n),this.navigatorOptions=x.options.navigator||{},this.setOpposite(),Zg(n.enabled)||S)return this.destroy(),this.navigatorEnabled=n.enabled||this.navigatorEnabled,this.init(x);if(this.navigatorEnabled&&(this.isDirty=!0,n.adaptToUpdatedData===!1&&this.baseSeries.forEach(L=>{of(L,"updatedData",this.updatedDataHandler)},this),n.adaptToUpdatedData&&this.baseSeries.forEach(L=>{L.eventsToUnbind.push(xd(L,"updatedData",this.updatedDataHandler))},this),(n.series||n.baseSeries)&&this.setBaseSeries(void 0,!1),n.height||n.xAxis||n.yAxis)){this.height=n.height??this.height;let L=this.getXAxisOffsets();this.xAxis.update({...n.xAxis,offsets:L,[x.inverted?"width":"height"]:this.height,[x.inverted?"height":"width"]:void 0},!1),this.yAxis.update({...n.yAxis,[x.inverted?"width":"height"]:this.height},!1)}m&&x.redraw()}render(n,m,x,S){let k=this.chart,L=this.xAxis,R=L.pointRange||0,N=L.navigatorAxis.fake?k.xAxis[0]:L,Y=this.navigatorEnabled,se=this.rendered,$=k.inverted,ee=k.xAxis[0].minRange,ae=k.xAxis[0].options.maxRange,fe=this.scrollButtonSize,ve,Te,Ae,Ve=this.scrollbarHeight,Ke,Tt;if(this.hasDragged&&!Zg(x))return;if(this.isDirty&&this.renderElements(),n=Wm(n-R/2),m=Wm(m+R/2),!Nd(n)||!Nd(m))if(se)x=0,S=la(L.width,N.width);else return;this.left=la(L.left,k.plotLeft+fe+($?k.plotWidth:0));let St=this.size=Ke=la(L.len,($?k.plotHeight:k.plotWidth)-2*fe);ve=$?Ve:Ke+2*fe,x=la(x,L.toPixels(n,!0)),S=la(S,L.toPixels(m,!0)),Nd(x)&&Math.abs(x)!==1/0||(x=0,S=ve);let Mt=L.toValue(x,!0),Nt=L.toValue(S,!0),Rt=Math.abs(Wm(Nt-Mt));Rt<ee?this.grabbedLeft?x=L.toPixels(Nt-ee-R,!0):this.grabbedRight&&(S=L.toPixels(Mt+ee+R,!0)):Zg(ae)&&Wm(Rt-R)>ae&&(this.grabbedLeft?x=L.toPixels(Nt-ae-R,!0):this.grabbedRight&&(S=L.toPixels(Mt+ae+R,!0))),this.zoomedMax=Cx(Math.max(x,S),0,St),this.zoomedMin=Cx(this.fixedWidth?this.zoomedMax-this.fixedWidth:Math.min(x,S),0,St),this.range=this.zoomedMax-this.zoomedMin,St=Math.round(this.zoomedMax);let $t=Math.round(this.zoomedMin);Y&&(this.navigatorGroup.attr({visibility:"inherit"}),Tt=se&&!this.hasDragged?"animate":"attr",this.drawMasks($t,St,$,Tt),this.drawOutline($t,St,$,Tt),this.navigatorOptions.handles.enabled&&(this.drawHandle($t,0,$,Tt),this.drawHandle(St,1,$,Tt))),this.scrollbar&&($?(Ae=this.top-fe,Te=this.left-Ve+(Y||!N.opposite?0:(N.titleOffset||0)+N.axisTitleMargin),Ve=Ke+2*fe):(Ae=this.top+(Y?this.height:-Ve),Te=this.left-fe),this.scrollbar.position(Te,Ae,ve,Ve),this.scrollbar.setRange(this.zoomedMin/(Ke||1),this.zoomedMax/(Ke||1))),this.rendered=!0,this.isDirty=!1,a_(this,"afterRender")}addMouseEvents(){let n=this,m=n.chart,x=m.container,S=[],k,L;n.mouseMoveHandler=k=function(R){n.onMouseMove(R)},n.mouseUpHandler=L=function(R){n.onMouseUp(R)},(S=n.getPartsEvents("mousedown")).push(xd(m.renderTo,"mousemove",k),xd(x.ownerDocument,"mouseup",L),xd(m.renderTo,"touchmove",k),xd(x.ownerDocument,"touchend",L)),S.concat(n.getPartsEvents("touchstart")),n.eventsToUnbind=S,n.series&&n.series[0]&&S.push(xd(n.series[0].xAxis,"foundExtremes",function(){m.navigator.modifyNavigatorAxisExtremes()}))}getPartsEvents(n){let m=this,x=[];return["shades","handles"].forEach(function(S){m[S].forEach(function(k,L){x.push(xd(k.element,n,function(R){m[S+"Mousedown"](R,L)}))})}),x}shadesMousedown(n,m){var fe;n=((fe=this.chart.pointer)==null?void 0:fe.normalize(n))||n;let x=this.chart,S=this.xAxis,k=this.zoomedMin,L=this.size,R=this.range,N=this.left,Y=n.chartX,se,$,ee,ae;x.inverted&&(Y=n.chartY,N=this.top),m===1?(this.grabbedCenter=Y,this.fixedWidth=R,this.dragOffset=Y-k):(ae=Y-N-R/2,m===0?ae=Math.max(0,ae):m===2&&ae+R>=L&&(ae=L-R,this.reversedExtremes?(ae-=R,$=this.getUnionExtremes().dataMin):se=this.getUnionExtremes().dataMax),ae!==k&&(this.fixedWidth=R,Zg((ee=S.navigatorAxis.toFixedRange(ae,ae+R,$,se)).min)&&a_(this,"setRange",{min:Math.min(ee.min,ee.max),max:Math.max(ee.min,ee.max),redraw:!0,eventArguments:{trigger:"navigator"}})))}handlesMousedown(n,m){var L;n=((L=this.chart.pointer)==null?void 0:L.normalize(n))||n;let x=this.chart,S=x.xAxis[0],k=this.reversedExtremes;m===0?(this.grabbedLeft=!0,this.otherHandlePos=this.zoomedMax,this.fixedExtreme=k?S.min:S.max):(this.grabbedRight=!0,this.otherHandlePos=this.zoomedMin,this.fixedExtreme=k?S.max:S.min),x.setFixedRange(void 0)}onMouseMove(n){var se;let m=this,x=m.chart,S=m.navigatorSize,k=m.range,L=m.dragOffset,R=x.inverted,N=m.left,Y;(!n.touches||n.touches[0].pageX!==0)&&(Y=(n=((se=x.pointer)==null?void 0:se.normalize(n))||n).chartX,R&&(N=m.top,Y=n.chartY),m.grabbedLeft?(m.hasDragged=!0,m.render(0,0,Y-N,m.otherHandlePos)):m.grabbedRight?(m.hasDragged=!0,m.render(0,0,m.otherHandlePos,Y-N)):m.grabbedCenter&&(m.hasDragged=!0,Y<L?Y=L:Y>S+L-k&&(Y=S+L-k),m.render(0,0,Y-L,Y-L+k)),m.hasDragged&&m.scrollbar&&la(m.scrollbar.options.liveRedraw,!V_&&!this.chart.boosted)&&(n.DOMType=n.type,setTimeout(function(){m.onMouseUp(n)},0)))}onMouseUp(n){let m,x,S,k,L,R,N=this.chart,Y=this.xAxis,se=this.scrollbar,$=n.DOMEvent||n,ee=N.inverted,ae=this.rendered&&!this.hasDragged?"animate":"attr";(this.hasDragged&&(!se||!se.hasDragged)||n.trigger==="scrollbar")&&(S=this.getUnionExtremes(),this.zoomedMin===this.otherHandlePos?k=this.fixedExtreme:this.zoomedMax===this.otherHandlePos&&(L=this.fixedExtreme),this.zoomedMax===this.size&&(L=this.reversedExtremes?S.dataMin:S.dataMax),this.zoomedMin===0&&(k=this.reversedExtremes?S.dataMax:S.dataMin),Zg((R=Y.navigatorAxis.toFixedRange(this.zoomedMin,this.zoomedMax,k,L)).min)&&a_(this,"setRange",{min:Math.min(R.min,R.max),max:Math.max(R.min,R.max),redraw:!0,animation:!this.hasDragged&&null,eventArguments:{trigger:"navigator",triggerOp:"navigator-drag",DOMEvent:$}})),n.DOMType!=="mousemove"&&n.DOMType!=="touchmove"&&(this.grabbedLeft=this.grabbedRight=this.grabbedCenter=this.fixedWidth=this.fixedExtreme=this.otherHandlePos=this.hasDragged=this.dragOffset=null),this.navigatorEnabled&&Nd(this.zoomedMin)&&Nd(this.zoomedMax)&&(x=Math.round(this.zoomedMin),m=Math.round(this.zoomedMax),this.shades&&this.drawMasks(x,m,ee,ae),this.outline&&this.drawOutline(x,m,ee,ae),this.navigatorOptions.handles.enabled&&Object.keys(this.handles).length===this.handles.length&&(this.drawHandle(x,0,ee,ae),this.drawHandle(m,1,ee,ae)))}removeEvents(){this.eventsToUnbind&&(this.eventsToUnbind.forEach(function(n){n()}),this.eventsToUnbind=void 0),this.removeBaseSeriesEvents()}removeBaseSeriesEvents(){let n=this.baseSeries||[];this.navigatorEnabled&&n[0]&&(this.navigatorOptions.adaptToUpdatedData!==!1&&n.forEach(function(m){of(m,"updatedData",this.updatedDataHandler)},this),n[0].xAxis&&of(n[0].xAxis,"foundExtremes",this.modifyBaseAxisExtremes))}getXAxisOffsets(){return this.chart.inverted?[this.scrollButtonSize,0,-this.scrollButtonSize,0]:[0,-this.scrollButtonSize,0,this.scrollButtonSize]}init(n){var ve,Te;let m=n.options,x=m.navigator||{},S=x.enabled,k=m.scrollbar||{},L=k.enabled,R=S&&x.height||0,N=L&&k.height||0,Y=k.buttonsEnabled&&N||0;this.handles=[],this.shades=[],this.chart=n,this.setBaseSeries(),this.height=R,this.scrollbarHeight=N,this.scrollButtonSize=Y,this.scrollbarEnabled=L,this.navigatorEnabled=S,this.navigatorOptions=x,this.scrollbarOptions=k,this.setOpposite();let se=this,$=se.baseSeries,ee=n.xAxis.length,ae=n.yAxis.length,fe=$&&$[0]&&$[0].xAxis||n.xAxis[0]||{options:{}};if(n.isDirtyBox=!0,se.navigatorEnabled){let Ae=this.getXAxisOffsets();se.xAxis=new nu(n,_m({breaks:fe.options.breaks,ordinal:fe.options.ordinal,overscroll:fe.options.overscroll},x.xAxis,{type:"datetime",yAxis:(ve=x.yAxis)==null?void 0:ve.id,index:ee,isInternal:!0,offset:0,keepOrdinalPadding:!0,startOnTick:!1,endOnTick:!1,minPadding:fe.options.ordinal?0:fe.options.minPadding,maxPadding:fe.options.ordinal?0:fe.options.maxPadding,zoomEnabled:!1},n.inverted?{offsets:Ae,width:R}:{offsets:Ae,height:R}),"xAxis"),se.yAxis=new nu(n,_m(x.yAxis,{alignTicks:!1,offset:0,index:ae,isInternal:!0,reversed:la(x.yAxis&&x.yAxis.reversed,n.yAxis[0]&&n.yAxis[0].reversed,!1),zoomEnabled:!1},n.inverted?{width:R}:{height:R}),"yAxis"),$||x.series.data?se.updateNavigatorSeries(!1):n.series.length===0&&(se.unbindRedraw=xd(n,"beforeRedraw",function(){n.series.length>0&&!se.series&&(se.setBaseSeries(),se.unbindRedraw())})),se.reversedExtremes=n.inverted&&!se.xAxis.reversed||!n.inverted&&se.xAxis.reversed,se.renderElements(),se.addMouseEvents()}else se.xAxis={chart:n,navigatorAxis:{fake:!0},translate:function(Ae,Ve){let Ke=n.xAxis[0],Tt=Ke.getExtremes(),St=Ke.len-2*Y,Mt=Zy("min",Ke.options.min,Tt.dataMin),Nt=Zy("max",Ke.options.max,Tt.dataMax)-Mt;return Ve?Ae*Nt/St+Mt:St*(Ae-Mt)/Nt},toPixels:function(Ae){return this.translate(Ae)},toValue:function(Ae){return this.translate(Ae,!0)}},se.xAxis.navigatorAxis.axis=se.xAxis,se.xAxis.navigatorAxis.toFixedRange=Do.prototype.toFixedRange.bind(se.xAxis.navigatorAxis);if((Te=n.options.scrollbar)!=null&&Te.enabled){let Ae=_m(n.options.scrollbar,{vertical:n.inverted});Nd(Ae.margin)||(Ae.margin=n.inverted?-3:3),n.scrollbar=se.scrollbar=new Dp(n.renderer,Ae,n),xd(se.scrollbar,"changed",function(Ve){let Ke=se.size,Tt=Ke*this.to,St=Ke*this.from;se.hasDragged=se.scrollbar.hasDragged,se.render(0,0,St,Tt),this.shouldUpdateExtremes(Ve.DOMType)&&setTimeout(function(){se.onMouseUp(Ve)})})}se.addBaseSeriesEvents(),se.addChartEvents()}setOpposite(){let n=this.navigatorOptions,m=this.navigatorEnabled,x=this.chart;this.opposite=la(n.opposite,!!(!m&&x.inverted))}getUnionExtremes(n){let m,x=this.chart.xAxis[0],S=this.chart.time,k=this.xAxis,L=k.options,R=x.options;return n&&x.dataMin===null||(m={dataMin:la(S.parse(L==null?void 0:L.min),Zy("min",S.parse(R.min),x.dataMin,k.dataMin,k.min)),dataMax:la(S.parse(L==null?void 0:L.max),Zy("max",S.parse(R.max),x.dataMax,k.dataMax,k.max))}),m}setBaseSeries(n,m){let x=this.chart,S=this.baseSeries=[];n=n||x.options&&x.options.navigator.baseSeries||(x.series.length?C0(x.series,k=>!k.options.isInternal).index:0),(x.series||[]).forEach((k,L)=>{!k.options.isInternal&&(k.options.showInNavigator||(L===n||k.options.id===n)&&k.options.showInNavigator!==!1)&&S.push(k)}),this.xAxis&&!this.xAxis.navigatorAxis.fake&&this.updateNavigatorSeries(!0,m)}updateNavigatorSeries(n,m){var ee,ae;let x=this,S=x.chart,k=x.baseSeries,L={enableMouseTracking:!1,index:null,linkedTo:null,group:"nav",padXAxis:!1,xAxis:(ee=this.navigatorOptions.xAxis)==null?void 0:ee.id,yAxis:(ae=this.navigatorOptions.yAxis)==null?void 0:ae.id,showInLegend:!1,stacking:void 0,isInternal:!0,states:{inactive:{opacity:1}}},R=x.series=(x.series||[]).filter(fe=>{let ve=fe.baseSeries;return!(0>k.indexOf(ve))||(ve&&(of(ve,"updatedData",x.updatedDataHandler),delete ve.navigatorSeries),fe.chart&&fe.destroy(),!1)}),N,Y,se=x.navigatorOptions.series,$;k&&k.length&&k.forEach(fe=>{var Ve;let ve=fe.navigatorSeries,Te=Px({color:fe.color,visible:fe.visible},l_(se)?yy.navigator.series:se);if(ve&&x.navigatorOptions.adaptToUpdatedData===!1)return;L.name="Navigator "+k.length,$=(N=fe.options||{}).navigatorOptions||{},Te.dataLabels=Kg(Te.dataLabels),(Y=_m(N,L,Te,$)).pointRange=la(Te.pointRange,$.pointRange,yy.plotOptions[Y.type||"line"].pointRange);let Ae=$.data||Te.data;x.hasNavigatorData=x.hasNavigatorData||!!Ae,Y.data=Ae||((Ve=N.data)==null?void 0:Ve.slice(0)),ve&&ve.options?ve.update(Y,m):(fe.navigatorSeries=S.initSeries(Y),S.setSortedData(),fe.navigatorSeries.baseSeries=fe,R.push(fe.navigatorSeries))}),(se.data&&!(k&&k.length)||l_(se))&&(x.hasNavigatorData=!1,(se=Kg(se)).forEach((fe,ve)=>{L.name="Navigator "+(R.length+1),(Y=_m(yy.navigator.series,{color:S.series[ve]&&!S.series[ve].options.isInternal&&S.series[ve].color||S.options.colors[ve]||S.options.colors[0]},L,fe)).data=fe.data,Y.data&&(x.hasNavigatorData=!0,R.push(S.initSeries(Y)))})),n&&this.addBaseSeriesEvents()}addBaseSeriesEvents(){let n=this,m=n.baseSeries||[];m[0]&&m[0].xAxis&&m[0].eventsToUnbind.push(xd(m[0].xAxis,"foundExtremes",this.modifyBaseAxisExtremes)),m.forEach(x=>{x.eventsToUnbind.push(xd(x,"show",function(){this.navigatorSeries&&this.navigatorSeries.setVisible(!0,!1)})),x.eventsToUnbind.push(xd(x,"hide",function(){this.navigatorSeries&&this.navigatorSeries.setVisible(!1,!1)})),this.navigatorOptions.adaptToUpdatedData!==!1&&x.xAxis&&x.eventsToUnbind.push(xd(x,"updatedData",this.updatedDataHandler)),x.eventsToUnbind.push(xd(x,"remove",function(){m&&vy(m,x),this.navigatorSeries&&n.series&&(vy(n.series,this.navigatorSeries),Zg(this.navigatorSeries.options)&&this.navigatorSeries.remove(!1),delete this.navigatorSeries)}))})}getBaseSeriesMin(n){return this.baseSeries.reduce(function(m,x){return Math.min(m,x.getColumn("x")[0]??m)},n)}modifyNavigatorAxisExtremes(){let n=this.xAxis;if(n.getExtremes!==void 0){let m=this.getUnionExtremes(!0);m&&(m.dataMin!==n.min||m.dataMax!==n.max)&&(n.min=m.dataMin,n.max=m.dataMax)}}modifyBaseAxisExtremes(){var ve;let n,m,x=this.chart.navigator,S=this.getExtremes(),k=S.min,L=S.max,R=S.dataMin,N=S.dataMax,Y=L-k,se=x.stickToMin,$=x.stickToMax,ee=la((ve=this.ordinal)==null?void 0:ve.convertOverscroll(this.options.overscroll),0),ae=x.series&&x.series[0],fe=!!this.setExtremes;!(this.eventArgs&&this.eventArgs.trigger==="rangeSelectorButton")&&(se&&(n=(m=R)+Y),$&&(n=N+ee,se||(m=Math.max(R,n-Y,x.getBaseSeriesMin(ae&&ae.xData?ae.xData[0]:-Number.MAX_VALUE)))),fe&&(se||$)&&Nd(m)&&(this.min=this.userMin=m,this.max=this.userMax=n)),x.stickToMin=x.stickToMax=null}updatedDataHandler(){let n=this.chart.navigator,m=this.navigatorSeries,x=n.reversedExtremes?Math.round(n.zoomedMin)===0:Math.round(n.zoomedMax)>=Math.round(n.size);n.stickToMax=la(this.chart.options.navigator&&this.chart.options.navigator.stickToMax,x),n.stickToMin=n.shouldStickToMin(this,n),m&&!n.hasNavigatorData&&(m.options.pointStart=this.getColumn("x")[0],m.setData(this.options.data,!1,null,!1))}shouldStickToMin(n,m){let x=m.getBaseSeriesMin(n.getColumn("x")[0]),S=n.xAxis,k=S.max,L=S.min,R=S.options.range;return!!(Nd(k)&&Nd(L))&&(R&&k-x>0?k-x<R:L<=x)}addChartEvents(){this.eventsToUnbind||(this.eventsToUnbind=[]),this.eventsToUnbind.push(xd(this.chart,"redraw",function(){let n=this.navigator,m=n&&(n.baseSeries&&n.baseSeries[0]&&n.baseSeries[0].xAxis||this.xAxis[0]);m&&n.render(m.min,m.max)}),xd(this.chart,"getMargins",function(){var x;let n=this.navigator,m=n.opposite?"plotTop":"marginBottom";this.inverted&&(m=n.opposite?"marginRight":"plotLeft"),this[m]=(this[m]||0)+(n.navigatorEnabled||!this.inverted?n.height+(((x=this.scrollbar)==null?void 0:x.options.margin)||0)+n.scrollbarHeight:0)+(n.navigatorOptions.margin||0)}),xd(dc,"setRange",function(n){this.chart.xAxis[0].setExtremes(n.min,n.max,n.redraw,n.animation,n.eventArguments)}))}destroy(){this.removeEvents(),this.xAxis&&(vy(this.chart.xAxis,this.xAxis),vy(this.chart.axes,this.xAxis)),this.yAxis&&(vy(this.chart.yAxis,this.yAxis),vy(this.chart.axes,this.yAxis)),(this.series||[]).forEach(n=>{n.destroy&&n.destroy()}),["series","xAxis","yAxis","shades","outline","scrollbarTrack","scrollbarRifles","scrollbarGroup","scrollbar","navigatorGroup","rendered"].forEach(n=>{this[n]&&this[n].destroy&&this[n].destroy(),this[n]=null}),[this.handles].forEach(n=>{_y(n)}),this.baseSeries.forEach(n=>{n.navigatorSeries=void 0}),this.navigatorEnabled=!1}}let{addEvent:vg,correctFloat:Hm,css:U_,defined:Bf,error:bg,isNumber:by,pick:Ky,timeUnits:j_,isString:G_}=Gs;(function(H){function n(ee,ae,fe,ve,Te=[],Ae=0,Ve){let Ke={},Tt=this.options.tickPixelInterval,St=this.chart.time,Mt=[],Nt,Rt,$t,Ti,hi,Ei=0,Ji=[],er=-Number.MAX_VALUE;if(!this.options.ordinal&&!this.options.breaks||!Te||Te.length<3||ae===void 0)return St.getTimeTicks.apply(St,arguments);let Is=Te.length;for(Nt=0;Nt<Is;Nt++){if(hi=Nt&&Te[Nt-1]>fe,Te[Nt]<ae&&(Ei=Nt),Nt===Is-1||Te[Nt+1]-Te[Nt]>5*Ae||hi){if(Te[Nt]>er){for(Rt=St.getTimeTicks(ee,Te[Ei],Te[Nt],ve);Rt.length&&Rt[0]<=er;)Rt.shift();Rt.length&&(er=Rt[Rt.length-1]),Mt.push(Ji.length),Ji=Ji.concat(Rt)}Ei=Nt+1}if(hi)break}if(Rt){if(Ti=Rt.info,Ve&&Ti.unitRange<=j_.hour){for(Ei=1,Nt=Ji.length-1;Ei<Nt;Ei++)St.dateFormat("%d",Ji[Ei])!==St.dateFormat("%d",Ji[Ei-1])&&(Ke[Ji[Ei]]="day",$t=!0);$t&&(Ke[Ji[0]]="day"),Ti.higherRanks=Ke}Ti.segmentStarts=Mt,Ji.info=Ti}else bg(12,!1,this.chart);if(Ve&&Bf(Tt)){let Hs=Ji.length,qs=[],dr=[],xr,wr,io,sl,Wo,qo=Hs;for(;qo--;)wr=this.translate(Ji[qo]),io&&(dr[qo]=io-wr),qs[qo]=io=wr;for(dr.sort((ko,no)=>ko-no),(sl=dr[Math.floor(dr.length/2)])<.6*Tt&&(sl=null),qo=Ji[Hs-1]>fe?Hs-1:Hs,io=void 0;qo--;)Wo=Math.abs(io-(wr=qs[qo])),io&&Wo<.8*Tt&&(sl===null||Wo<.8*sl)?(Ke[Ji[qo]]&&!Ke[Ji[qo+1]]?(xr=qo+1,io=wr):xr=qo,Ji.splice(xr,1)):io=wr}return Ji}function m(ee){let ae=this.ordinal.positions;if(!ae)return ee;let fe=ae.length-1,ve;return ee<0?ee=ae[0]:ee>fe?ee=ae[fe]:(fe=Math.floor(ee),ve=ee-fe),ve!==void 0&&ae[fe]!==void 0?ae[fe]+(ve?ve*(ae[fe+1]-ae[fe]):0):ee}function x(ee){let ae=this.ordinal,fe=this.old?this.old.min:this.min,ve=this.old?this.old.transA:this.transA,Te=ae.getExtendedPositions();if(Te!=null&&Te.length){let Ae=Hm((ee-fe)*ve+this.minPixelPadding),Ve=Hm(ae.getIndexOfPoint(Ae,Te)),Ke=Hm(Ve%1);if(Ve>=0&&Ve<=Te.length-1){let Tt=Te[Math.floor(Ve)],St=Te[Math.ceil(Ve)];return Te[Math.floor(Ve)]+Ke*(St-Tt)}}return ee}function S(ee,ae){let fe=H.Additions.findIndexOf(ee,ae,!0);if(ee[fe]===ae)return fe;let ve=(ae-ee[fe])/(ee[fe+1]-ee[fe]);return fe+ve}function k(){this.ordinal||(this.ordinal=new H.Additions(this))}function L(){let{eventArgs:ee,options:ae}=this;if(this.isXAxis&&Bf(ae.overscroll)&&ae.overscroll!==0&&by(this.max)&&by(this.min)&&(this.options.ordinal&&!this.ordinal.originalOrdinalRange&&this.ordinal.getExtendedPositions(!1),this.max===this.dataMax&&((ee==null?void 0:ee.trigger)!=="pan"||this.isInternal)&&(ee==null?void 0:ee.trigger)!=="navigator")){let fe=this.ordinal.convertOverscroll(ae.overscroll);this.max+=fe,!this.isInternal&&Bf(this.userMin)&&(ee==null?void 0:ee.trigger)!=="mousewheel"&&(this.min+=fe)}}function R(){this.horiz&&!this.isDirty&&(this.isDirty=this.isOrdinal&&this.chart.navigator&&!this.chart.navigator.adaptToUpdatedData)}function N(){this.ordinal&&(this.ordinal.beforeSetTickPositions(),this.tickInterval=this.ordinal.postProcessTickInterval(this.tickInterval))}function Y(ee){var Ve;let ae=this.xAxis[0],fe=ae.ordinal.convertOverscroll(ae.options.overscroll),ve=ee.originalEvent.chartX,Te=this.options.chart.panning,Ae=!1;if((Te==null?void 0:Te.type)!=="y"&&ae.options.ordinal&&ae.series.length&&(!ee.touches||ee.touches.length<=1)){let Ke,Tt,St=this.mouseDownX,Mt=ae.getExtremes(),Nt=Mt.dataMin,Rt=Mt.dataMax,$t=Mt.min,Ti=Mt.max,hi=this.hoverPoints,Ei=ae.closestPointRange||((Ve=ae.ordinal)==null?void 0:Ve.overscrollPointsRange),Ji=Math.round((St-ve)/(ae.translationSlope*(ae.ordinal.slope||Ei))),er=ae.ordinal.getExtendedPositions(),Is={ordinal:{positions:er,extendedOrdinalPositions:er}},Hs=ae.index2val,qs=ae.val2lin;if($t<=Nt&&Ji<=0||Ti>=Rt+fe&&Ji>=0)return void ee.preventDefault();Is.ordinal.positions?Math.abs(Ji)>1&&(hi&&hi.forEach(function(dr){dr.setState()}),Tt=Is.ordinal.positions,fe&&(Tt=Is.ordinal.positions=Tt.concat(ae.ordinal.getOverscrollPositions())),Rt>Tt[Tt.length-1]&&Tt.push(Rt),this.setFixedRange(Ti-$t),(Ke=ae.navigatorAxis.toFixedRange(void 0,void 0,Hs.apply(Is,[qs.apply(Is,[$t,!0])+Ji]),Hs.apply(Is,[qs.apply(Is,[Ti,!0])+Ji]))).min>=Math.min(Tt[0],$t)&&Ke.max<=Math.max(Tt[Tt.length-1],Ti)+fe&&ae.setExtremes(Ke.min,Ke.max,!0,!1,{trigger:"pan"}),this.mouseDownX=ve,U_(this.container,{cursor:"move"})):Ae=!0}else Ae=!0;Ae||Te&&/y/.test(Te.type)?fe&&by(ae.dataMax)&&(ae.max=ae.dataMax+fe):ee.preventDefault()}function se(){let ee=this.xAxis;ee!=null&&ee.options.ordinal&&(delete ee.ordinal.index,delete ee.ordinal.originalOrdinalRange)}function $(ee,ae){var Tt;let fe,ve=this.ordinal,Te=ve.positions,Ae=ve.slope,Ve;if(!Te)return ee;let Ke=Te.length;if(Te[0]<=ee&&Te[Ke-1]>=ee)fe=S(Te,ee);else{if(Ve=(Tt=ve.getExtendedPositions)==null?void 0:Tt.call(ve),!(Ve!=null&&Ve.length))return ee;let St=Ve.length;Ae||(Ae=(Ve[St-1]-Ve[0])/St);let Mt=S(Ve,Te[0]);if(ee>=Ve[0]&&ee<=Ve[St-1])fe=S(Ve,ee)-Mt;else{if(!ae)return ee;fe=ee<Ve[0]?-Mt-(Ve[0]-ee)/Ae:(ee-Ve[St-1])/Ae+St-Mt}}return ae?fe:Ae*(fe||0)+ve.offset}H.compose=function(ee,ae,fe){let ve=ee.prototype;return ve.ordinal2lin||(ve.getTimeTicks=n,ve.index2val=m,ve.lin2val=x,ve.val2lin=$,ve.ordinal2lin=ve.val2lin,vg(ee,"afterInit",k),vg(ee,"foundExtremes",L),vg(ee,"afterSetScale",R),vg(ee,"initialAxisTranslation",N),vg(fe,"pan",Y),vg(fe,"touchpan",Y),vg(ae,"updatedData",se)),ee},H.Additions=class{constructor(ee){this.index={},this.axis=ee}beforeSetTickPositions(){var Hs;let ee=this.axis,ae=ee.ordinal,fe=ee.getExtremes(),ve=fe.min,Te=fe.max,Ae=(Hs=ee.brokenAxis)==null?void 0:Hs.hasBreaks,Ve=ee.options.ordinal,Ke=ee.options.overscroll&&ee.ordinal.convertOverscroll(ee.options.overscroll)||0,Tt,St,Mt,Nt,Rt,$t,Ti,hi=[],Ei=Number.MAX_VALUE,Ji=!1,er=!1,Is=!1;if(Ve||Ae){let qs=0;if(ee.series.forEach(function(dr,xr){let wr=dr.getColumn("x",!0);if(St=[],xr>0&&dr.options.id!=="highcharts-navigator-series"&&wr.length>1&&(er=qs!==wr[1]-wr[0]),qs=wr[1]-wr[0],dr.boosted&&(Is=dr.boosted),dr.reserveSpace()&&(dr.takeOrdinalPosition!==!1||Ae)&&(Tt=(hi=hi.concat(wr)).length,hi.sort(function(io,sl){return io-sl}),Ei=Math.min(Ei,Ky(dr.closestPointRange,Ei)),Tt)){for(xr=0;xr<Tt-1;)hi[xr]!==hi[xr+1]&&St.push(hi[xr+1]),xr++;St[0]!==hi[0]&&St.unshift(hi[0]),hi=St}}),ee.ordinal.originalOrdinalRange||(ee.ordinal.originalOrdinalRange=(hi.length-1)*Ei),er&&Is&&(hi.pop(),hi.shift()),(Tt=hi.length)>2){for(Mt=hi[1]-hi[0],Ti=Tt-1;Ti--&&!Ji;)hi[Ti+1]-hi[Ti]!==Mt&&(Ji=!0);!ee.options.keepOrdinalPadding&&(hi[0]-ve>Mt||Te-Ke-hi[Tt-1]>Mt)&&(Ji=!0)}else ee.options.overscroll&&(Tt===2?Ei=hi[1]-hi[0]:Tt===1?(Ei=Ke,hi=[hi[0],hi[0]+Ei]):Ei=ae.overscrollPointsRange);Ji||ee.forceOrdinal?(ee.options.overscroll&&(ae.overscrollPointsRange=Ei,hi=hi.concat(ae.getOverscrollPositions())),ae.positions=hi,Nt=ee.ordinal2lin(Math.max(ve,hi[0]),!0),Rt=Math.max(ee.ordinal2lin(Math.min(Te,hi[hi.length-1]),!0),1),ae.slope=$t=(Te-ve)/(Rt-Nt),ae.offset=ve-Nt*$t):(ae.overscrollPointsRange=Ky(ee.closestPointRange,ae.overscrollPointsRange),ae.positions=ee.ordinal.slope=ae.offset=void 0)}ee.isOrdinal=Ve&&Ji,ae.groupIntervalFactor=null}static findIndexOf(ee,ae,fe){let ve=0,Te=ee.length-1,Ae;for(;ve<Te;)ee[Ae=Math.ceil((ve+Te)/2)]<=ae?ve=Ae:Te=Ae-1;return ee[ve]===ae||fe?ve:-1}getExtendedPositions(ee=!0){let ae=this,fe=ae.axis,ve=fe.constructor.prototype,Te=fe.chart,Ae=fe.series.reduce((Nt,Rt)=>{let $t=Rt.currentDataGrouping;return Nt+($t?$t.count+$t.unitName:"raw")},""),Ve=ee?fe.ordinal.convertOverscroll(fe.options.overscroll):0,Ke=fe.getExtremes(),Tt,St,Mt=ae.index;return Mt||(Mt=ae.index={}),!Mt[Ae]&&((Tt={series:[],chart:Te,forceOrdinal:!1,getExtremes:function(){return{min:Ke.dataMin,max:Ke.dataMax+Ve}},applyGrouping:ve.applyGrouping,getGroupPixelWidth:ve.getGroupPixelWidth,getTimeTicks:ve.getTimeTicks,options:{ordinal:!0},ordinal:{getGroupIntervalFactor:this.getGroupIntervalFactor},ordinal2lin:ve.ordinal2lin,getIndexOfPoint:ve.getIndexOfPoint,val2lin:ve.val2lin}).ordinal.axis=Tt,fe.series.forEach(Nt=>{var $t,Ti,hi;if(Nt.takeOrdinalPosition===!1)return;St={xAxis:Tt,chart:Te,groupPixelWidth:Nt.groupPixelWidth,destroyGroupedData:fi.noop,getColumn:Nt.getColumn,applyGrouping:Nt.applyGrouping,getProcessedData:Nt.getProcessedData,reserveSpace:Nt.reserveSpace,visible:Nt.visible};let Rt=Nt.getColumn("x").concat(ee?ae.getOverscrollPositions():[]);St.dataTable=new ya({columns:{x:Rt}}),St.options={...Nt.options,dataGrouping:Nt.currentDataGrouping?{firstAnchor:($t=Nt.options.dataGrouping)==null?void 0:$t.firstAnchor,anchor:(Ti=Nt.options.dataGrouping)==null?void 0:Ti.anchor,lastAnchor:(hi=Nt.options.dataGrouping)==null?void 0:hi.firstAnchor,enabled:!0,forced:!0,approximation:"open",units:[[Nt.currentDataGrouping.unitName,[Nt.currentDataGrouping.count]]]}:{enabled:!1}},Tt.series.push(St),Nt.processData.apply(St)}),Tt.applyGrouping({hasExtremesChanged:!0}),(St==null?void 0:St.closestPointRange)!==(St==null?void 0:St.basePointRange)&&St.currentDataGrouping&&(Tt.forceOrdinal=!0),fe.ordinal.beforeSetTickPositions.apply({axis:Tt}),!fe.ordinal.originalOrdinalRange&&Tt.ordinal.originalOrdinalRange&&(fe.ordinal.originalOrdinalRange=Tt.ordinal.originalOrdinalRange),Tt.ordinal.positions&&(Mt[Ae]=Tt.ordinal.positions)),Mt[Ae]}getGroupIntervalFactor(ee,ae,fe){let ve=fe.getColumn("x",!0),Te=ve.length,Ae=[],Ve,Ke,Tt=this.groupIntervalFactor;if(!Tt){for(Ke=0;Ke<Te-1;Ke++)Ae[Ke]=ve[Ke+1]-ve[Ke];Ae.sort(function(St,Mt){return St-Mt}),Ve=Ae[Math.floor(Te/2)],ee=Math.max(ee,ve[0]),ae=Math.min(ae,ve[Te-1]),this.groupIntervalFactor=Tt=Te*Ve/(ae-ee)}return Tt}getIndexOfPoint(ee,ae){let fe=this.axis,ve=fe.min,Te=fe.minPixelPadding;return S(ae,ve)+Hm((ee-Te)/(fe.translationSlope*(this.slope||fe.closestPointRange||this.overscrollPointsRange)))}getOverscrollPositions(){let ee=this.axis,ae=this.convertOverscroll(ee.options.overscroll),fe=this.overscrollPointsRange,ve=[],Te=ee.dataMax;if(Bf(fe))for(;Te<ee.dataMax+ae;)ve.push(Te+=fe);return ve}postProcessTickInterval(ee){let ae=this.axis,fe=this.slope,ve=ae.closestPointRange;return fe&&ve?ae.options.breaks?ve||ee:ee/(fe/ve):ee}convertOverscroll(ee=0){let ae=this,fe=ae.axis,ve=function(Te){return Ky(ae.originalOrdinalRange,Bf(fe.dataMax)&&Bf(fe.dataMin)?fe.dataMax-fe.dataMin:0)*Te};if(G_(ee)){let Te,Ae=parseInt(ee,10);if(Bf(fe.min)&&Bf(fe.max)&&Bf(fe.dataMin)&&Bf(fe.dataMax)&&((Te=fe.max-fe.min==fe.dataMax-fe.dataMin)||(this.originalOrdinalRange=fe.max-fe.min)),/%$/.test(ee))return ve(Ae/100);if(/px/.test(ee)){let Ve=Math.min(Ae,.9*fe.len)/fe.len;return ve(Ve/(Te?1-Ve:1))}return 0}return ee}}})(Da||(Da={}));let cp=Da,Ix={lang:{rangeSelectorZoom:"Zoom",rangeSelectorFrom:"",rangeSelectorTo:"→",rangeSelector:{allText:"All",allTitle:"View all",monthText:"{count}m",monthTitle:"View {count} {#eq count 1}month{else}months{/eq}",yearText:"{count}y",yearTitle:"View {count} {#eq count 1}year{else}years{/eq}",ytdText:"YTD",ytdTitle:"View year to date"}},rangeSelector:{allButtonsEnabled:!1,buttons:[{type:"month",count:1},{type:"month",count:3},{type:"month",count:6},{type:"ytd"},{type:"year",count:1},{type:"all"}],buttonSpacing:5,dropdown:"responsive",enabled:void 0,verticalAlign:"top",buttonTheme:{width:28,height:18,padding:2,zIndex:7},floating:!1,x:0,y:0,height:void 0,inputBoxBorderColor:"none",inputBoxHeight:17,inputBoxWidth:void 0,inputDateFormat:"%[ebY]",inputDateParser:void 0,inputEditDateFormat:"%Y-%m-%d",inputEnabled:!0,inputPosition:{align:"right",x:0,y:0},inputSpacing:5,selected:void 0,buttonPosition:{align:"left",x:0,y:0},inputStyle:{color:"#334eff",cursor:"pointer",fontSize:"0.8em"},labelStyle:{color:"#666666",fontSize:"0.8em"}}},{defaultOptions:h_}=ei,{composed:vm}=fi,{addEvent:wg,defined:W_,extend:Xm,isNumber:Ff,merge:c_,pick:Ym,pushUnique:Nf}=Gs,Jy=[];function d_(){let H,n,m=this.range,x=m.type,S=this.max,k=this.chart.time,L=function(N,Y){let se=k.toParts(N),$=se.slice();x==="year"?$[0]+=Y:$[1]+=Y;let ee=k.makeTime.apply(k,$),ae=k.toParts(ee);return x==="month"&&se[1]===ae[1]&&Math.abs(Y)===1&&($[0]=se[0],$[1]=se[1],$[2]=0),(ee=k.makeTime.apply(k,$))-N};Ff(m)?(H=S-m,n=m):m&&(H=S+L(S,-(m.count||1)),this.chart&&this.chart.setFixedRange(S-H));let R=Ym(this.dataMin,Number.MIN_VALUE);return Ff(H)||(H=R),H<=R&&(H=R,n===void 0&&(n=L(H,m.count)),this.newMax=Math.min(H+n,Ym(this.dataMax,Number.MAX_VALUE))),Ff(S)?!Ff(m)&&m&&m._offsetMin&&(H+=m._offsetMin):H=void 0,H}function Lx(){var H;(H=this.rangeSelector)==null||H.redrawElements()}function Ox(){this.options.rangeSelector&&this.options.rangeSelector.enabled&&(this.rangeSelector=new ni(this))}function H_(){let H=this.rangeSelector;if(H){Ff(H.deferredYTDClick)&&(H.clickButton(H.deferredYTDClick),delete H.deferredYTDClick);let n=H.options.verticalAlign;H.options.floating||(n==="bottom"?this.extraBottomMargin=!0:n==="top"&&(this.extraTopMargin=!0))}}function Jg(){let H,n=this.rangeSelector;if(!n)return;let m=this.xAxis[0].getExtremes(),x=this.legend,S=n&&n.options.verticalAlign;Ff(m.min)&&n.render(m.min,m.max),x.display&&S==="top"&&S===x.options.verticalAlign&&(H=c_(this.spacingBox),x.options.layout==="vertical"?H.y=this.plotTop:H.y+=n.getHeight(),x.group.placed=!1,x.align(H))}function u_(){for(let H=0,n=Jy.length;H<n;++H){let m=Jy[H];if(m[0]===this){m[1].forEach(x=>x()),Jy.splice(H,1);return}}}function X_(){var n;let H=this.rangeSelector;if((n=H==null?void 0:H.options)!=null&&n.enabled){let m=H.getHeight(),x=H.options.verticalAlign;H.options.floating||(x==="bottom"?this.marginBottom+=m:x!=="middle"&&(this.plotTop+=m))}}function P0(H){let n=H.options.rangeSelector,m=this.extraBottomMargin,x=this.extraTopMargin,S=this.rangeSelector;if(n&&n.enabled&&!W_(S)&&this.options.rangeSelector&&(this.options.rangeSelector.enabled=!0,this.rangeSelector=S=new ni(this)),this.extraBottomMargin=!1,this.extraTopMargin=!1,S){let k=n&&n.verticalAlign||S.options&&S.options.verticalAlign;S.options.floating||(k==="bottom"?this.extraBottomMargin=!0:k!=="middle"&&(this.extraTopMargin=!0)),(this.extraBottomMargin!==m||this.extraTopMargin!==x)&&(this.isDirtyBox=!0)}}let Y_={compose:function(H,n,m){if(ni=m,Nf(vm,"RangeSelector")){let x=n.prototype;H.prototype.minFromRange=d_,wg(n,"afterGetContainer",Ox),wg(n,"beforeRender",H_),wg(n,"destroy",u_),wg(n,"getMargins",X_),wg(n,"redraw",Jg),wg(n,"update",P0),wg(n,"beforeRedraw",Lx),x.callbacks.push(Jg),Xm(h_,{rangeSelector:Ix.rangeSelector}),Xm(h_.lang,Ix.lang)}}},{defaultOptions:Qy}=ei,{format:Tg}=ja,{addEvent:zp,createElement:Fh,css:dp,defined:Vd,destroyObjectProperties:p_,diffObjects:wy,discardElement:I0,extend:bm,fireEvent:$m,isNumber:rh,isString:Sg,merge:nf,objectEach:Ty,pick:_d,splat:$_}=Gs;function Dx(H){let n=S=>RegExp(`%[[a-zA-Z]*${S}`).test(H);if(Sg(H)?H.indexOf("%L")!==-1:H.fractionalSecondDigits)return"text";let m=Sg(H)?["a","A","d","e","w","b","B","m","o","y","Y"].some(n):H.dateStyle||H.day||H.month||H.year,x=Sg(H)?["H","k","I","l","M","S"].some(n):H.timeStyle||H.hour||H.minute||H.second;return m&&x?"datetime-local":m?"date":x?"time":"text"}class Sy{static compose(n,m){Y_.compose(n,m,Sy)}constructor(n){this.isDirty=!1,this.buttonOptions=[],this.initialButtonGroupWidth=0,this.maxButtonWidth=()=>{let m=0;return this.buttons.forEach(x=>{let S=x.getBBox();S.width>m&&(m=S.width)}),m},this.init(n)}clickButton(n,m){let x=this.chart,S=this.buttonOptions[n],k=x.xAxis[0],L=x.scroller&&x.scroller.getUnionExtremes()||k||{},R=S.type,N=S.dataGrouping,Y=L.dataMin,se=L.dataMax,$,ee=rh(k==null?void 0:k.max)?Math.round(Math.min(k.max,se??k.max)):void 0,ae,fe=S._range,ve,Te,Ae,Ve=!0;if(Y!==null&&se!==null){if(this.setSelected(n),N&&(this.forcedDataGrouping=!0,nu.prototype.setDataGrouping.call(k||{chart:this.chart},N,!1),this.frozenStates=S.preserveDataGrouping),R==="month"||R==="year")k?(Te={range:S,max:ee,chart:x,dataMin:Y,dataMax:se},$=k.minFromRange.call(Te),rh(Te.newMax)&&(ee=Te.newMax),Ve=!1):fe=S;else if(fe)rh(ee)&&(ee=Math.min(($=Math.max(ee-fe,Y))+fe,se),Ve=!1);else if(R==="ytd")if(k)!k.hasData()||rh(se)&&rh(Y)||(Y=Number.MAX_VALUE,se=-Number.MAX_VALUE,x.series.forEach(Ke=>{let Tt=Ke.getColumn("x");Tt.length&&(Y=Math.min(Tt[0],Y),se=Math.max(Tt[Tt.length-1],se))}),m=!1),rh(se)&&rh(Y)&&($=ve=(Ae=this.getYTDExtremes(se,Y)).min,ee=Ae.max);else{this.deferredYTDClick=n;return}else R==="all"&&k&&(x.navigator&&x.navigator.baseSeries[0]&&(x.navigator.baseSeries[0].xAxis.options.range=void 0),$=Y,ee=se);if(Ve&&S._offsetMin&&Vd($)&&($+=S._offsetMin),S._offsetMax&&Vd(ee)&&(ee+=S._offsetMax),this.dropdown&&(this.dropdown.selectedIndex=n+1),k)rh($)&&rh(ee)&&(k.setExtremes($,ee,_d(m,!0),void 0,{trigger:"rangeSelectorButton",rangeSelectorButton:S}),x.setFixedRange(S._range));else{ae=$_(x.options.xAxis||{})[0];let Ke=zp(x,"afterCreateAxes",function(){let Tt=x.xAxis[0];Tt.range=Tt.options.range=fe,Tt.min=Tt.options.min=ve});zp(x,"load",function(){let Tt=x.xAxis[0];x.setFixedRange(S._range),Tt.options.range=ae.range,Tt.options.min=ae.min,Ke()})}$m(this,"afterBtnClick")}}setSelected(n){this.selected=this.options.selected=n}init(n){let m=this,x=n.options.rangeSelector,S=n.options.lang,k=x.buttons,L=x.selected,R=function(){let N=m.minInput,Y=m.maxInput;N&&N.blur&&$m(N,"blur"),Y&&Y.blur&&$m(Y,"blur")};m.chart=n,m.options=x,m.buttons=[],m.buttonOptions=k.map(N=>(N.type&&S.rangeSelector&&(N.text??(N.text=S.rangeSelector[`${N.type}Text`]),N.title??(N.title=S.rangeSelector[`${N.type}Title`])),N.text=Tg(N.text,{count:N.count||1}),N.title=Tg(N.title,{count:N.count||1}),N)),this.eventsToUnbind=[],this.eventsToUnbind.push(zp(n.container,"mousedown",R)),this.eventsToUnbind.push(zp(n,"resize",R)),k.forEach(m.computeButtonRange),L!==void 0&&k[L]&&this.clickButton(L,!1),this.eventsToUnbind.push(zp(n,"load",function(){n.xAxis&&n.xAxis[0]&&zp(n.xAxis[0],"setExtremes",function(N){rh(this.max)&&rh(this.min)&&this.max-this.min!==n.fixedRange&&N.trigger!=="rangeSelectorButton"&&N.trigger!=="updatedData"&&m.forcedDataGrouping&&!m.frozenStates&&this.setDataGrouping(!1,!1)})})),this.createElements()}updateButtonStates(){let n=this,m=this.chart,x=this.dropdown,S=this.dropdownLabel,k=m.xAxis[0],L=Math.round(k.max-k.min),R=!k.hasVisibleSeries,N=24*36e5,Y=m.scroller&&m.scroller.getUnionExtremes()||k,se=Y.dataMin,$=Y.dataMax,ee=n.getYTDExtremes($,se),ae=ee.min,fe=ee.max,ve=n.selected,Te=n.options.allButtonsEnabled,Ae=Array(n.buttonOptions.length).fill(0),Ve=rh(ve),Ke=n.buttons,Tt=!1,St=null;n.buttonOptions.forEach((Mt,Nt)=>{var xr;let Rt=Mt._range,$t=Mt.type,Ti=Mt.count||1,hi=Mt._offsetMax-Mt._offsetMin,Ei=Nt===ve,Ji=Rt>$-se,er=Rt<k.minRange,Is=!1,Hs=Rt===L;if(Ei&&Ji&&(Tt=!0),k.isOrdinal&&((xr=k.ordinal)==null?void 0:xr.positions)&&Rt&&L<Rt){let wr=k.ordinal.positions,io=cp.Additions.findIndexOf(wr,k.min,!0),sl=Math.min(cp.Additions.findIndexOf(wr,k.max,!0)+1,wr.length-1);wr[sl]-wr[io]>Rt&&(Hs=!0)}else($t==="month"||$t==="year")&&L+36e5>={month:28,year:365}[$t]*N*Ti-hi&&L-36e5<={month:31,year:366}[$t]*N*Ti+hi?Hs=!0:$t==="ytd"?(Hs=fe-ae+hi===L,Is=!Ei):$t==="all"&&(Hs=k.max-k.min>=$-se);let qs=!Te&&!(Tt&&$t==="all")&&(Ji||er||R),dr=Tt&&$t==="all"||!Is&&Hs||Ei&&n.frozenStates;qs?Ae[Nt]=3:dr&&(!Ve||Nt===ve)&&(St=Nt)}),St!==null?(Ae[St]=2,n.setSelected(St),this.dropdown&&(this.dropdown.selectedIndex=St+1)):(n.setSelected(),this.dropdown&&(this.dropdown.selectedIndex=-1),S&&(S.setState(0),S.attr({text:(Qy.lang.rangeSelectorZoom||"")+" ▾"})));for(let Mt=0;Mt<Ae.length;Mt++){let Nt=Ae[Mt],Rt=Ke[Mt];if(Rt.state!==Nt&&(Rt.setState(Nt),x)){x.options[Mt+1].disabled=Nt===3,Nt===2&&(S&&(S.setState(2),S.attr({text:n.buttonOptions[Mt].text+" ▾"})),x.selectedIndex=Mt+1);let $t=S.getBBox();dp(x,{width:`${$t.width}px`,height:`${$t.height}px`})}}}computeButtonRange(n){let m=n.type,x=n.count||1,S={millisecond:1,second:1e3,minute:6e4,hour:36e5,day:864e5,week:6048e5};S[m]?n._range=S[m]*x:(m==="month"||m==="year")&&(n._range=24*{month:30,year:365}[m]*36e5*x),n._offsetMin=_d(n.offsetMin,0),n._offsetMax=_d(n.offsetMax,0),n._range+=n._offsetMax-n._offsetMin}getInputValue(n){let m=n==="min"?this.minInput:this.maxInput,x=this.chart.options.rangeSelector,S=this.chart.time;return m?(m.type==="text"&&x.inputDateParser||this.defaultInputDateParser)(m.value,S.timezone==="UTC",S):0}setInputValue(n,m){let x=this.options,S=this.chart.time,k=n==="min"?this.minInput:this.maxInput,L=n==="min"?this.minDateBox:this.maxDateBox;if(k){k.setAttribute("type",Dx(x.inputDateFormat||"%e %b %Y"));let R=k.getAttribute("data-hc-time"),N=Vd(R)?Number(R):void 0;if(Vd(m)){let Y=N;Vd(Y)&&k.setAttribute("data-hc-time-previous",Y),k.setAttribute("data-hc-time",m),N=m}k.value=S.dateFormat(this.inputTypeFormats[k.type]||x.inputEditDateFormat,N),L&&L.attr({text:S.dateFormat(x.inputDateFormat,N)})}}setInputExtremes(n,m,x){let S=n==="min"?this.minInput:this.maxInput;if(S){let k=this.inputTypeFormats[S.type],L=this.chart.time;if(k){let R=L.dateFormat(k,m);S.min!==R&&(S.min=R);let N=L.dateFormat(k,x);S.max!==N&&(S.max=N)}}}showInput(n){let m=n==="min"?this.minDateBox:this.maxDateBox,x=n==="min"?this.minInput:this.maxInput;if(x&&m&&this.inputGroup){let S=x.type==="text",{translateX:k=0,translateY:L=0}=this.inputGroup,{x:R=0,width:N=0,height:Y=0}=m,{inputBoxWidth:se}=this.options;dp(x,{width:S?N+(se?-2:20)+"px":"auto",height:Y-2+"px",border:"2px solid silver"}),S&&se?dp(x,{left:k+R+"px",top:L+"px"}):dp(x,{left:Math.min(Math.round(R+k-(x.offsetWidth-N)/2),this.chart.chartWidth-x.offsetWidth)+"px",top:L-(x.offsetHeight-Y)/2+"px"})}}hideInput(n){let m=n==="min"?this.minInput:this.maxInput;m&&dp(m,{top:"-9999em",border:0,width:"1px",height:"1px"})}defaultInputDateParser(n,m,x){return(x==null?void 0:x.parse(n))||0}drawInput(n){let{chart:m,div:x,inputGroup:S}=this,k=this,L=m.renderer.style||{},R=m.renderer,N=m.options.rangeSelector,Y=Qy.lang,se=n==="min";function $(Ae){var Ti;let{maxInput:Ve,minInput:Ke}=k,Tt=m.xAxis[0],St=((Ti=m.scroller)==null?void 0:Ti.getUnionExtremes())||Tt,Mt=St.dataMin,Nt=St.dataMax,Rt=m.xAxis[0].getExtremes()[Ae],$t=k.getInputValue(Ae);rh($t)&&$t!==Rt&&(se&&Ve&&rh(Mt)?$t>Number(Ve.getAttribute("data-hc-time"))?$t=void 0:$t<Mt&&($t=Mt):Ke&&rh(Nt)&&($t<Number(Ke.getAttribute("data-hc-time"))?$t=void 0:$t>Nt&&($t=Nt)),$t!==void 0&&Tt.setExtremes(se?$t:Tt.min,se?Tt.max:$t,void 0,void 0,{trigger:"rangeSelectorInput"}))}let ee=Y[se?"rangeSelectorFrom":"rangeSelectorTo"]||"",ae=R.label(ee,0).addClass("highcharts-range-label").attr({padding:2*!!ee,height:ee?N.inputBoxHeight:0}).add(S),fe=R.label("",0).addClass("highcharts-range-input").attr({padding:2,width:N.inputBoxWidth,height:N.inputBoxHeight,"text-align":"center"}).on("click",function(){k.showInput(n),k[n+"Input"].focus()});m.styledMode||fe.attr({stroke:N.inputBoxBorderColor,"stroke-width":1}),fe.add(S);let ve=Fh("input",{name:n,className:"highcharts-range-selector"},void 0,x);ve.setAttribute("type",Dx(N.inputDateFormat||"%e %b %Y")),m.styledMode||(ae.css(nf(L,N.labelStyle)),fe.css(nf({color:"#333333"},L,N.inputStyle)),dp(ve,bm({position:"absolute",border:0,boxShadow:"0 0 15px rgba(0,0,0,0.3)",width:"1px",height:"1px",padding:0,textAlign:"center",fontSize:L.fontSize,fontFamily:L.fontFamily,top:"-9999em"},N.inputStyle))),ve.onfocus=()=>{k.showInput(n)},ve.onblur=()=>{ve===fi.doc.activeElement&&$(n),k.hideInput(n),k.setInputValue(n),ve.blur()};let Te=!1;return ve.onchange=()=>{Te||($(n),k.hideInput(n),ve.blur())},ve.onkeypress=Ae=>{Ae.keyCode===13&&$(n)},ve.onkeydown=Ae=>{Te=!0,(Ae.key==="ArrowUp"||Ae.key==="ArrowDown"||Ae.key==="Tab")&&$(n)},ve.onkeyup=()=>{Te=!1},{dateBox:fe,input:ve,label:ae}}getPosition(){let n=this.chart,m=n.options.rangeSelector,x=m.verticalAlign==="top"?n.plotTop-n.axisOffset[0]:0;return{buttonTop:x+m.buttonPosition.y,inputTop:x+m.inputPosition.y-10}}getYTDExtremes(n,m){let x=this.chart.time,S=x.toParts(n)[0];return{max:n,min:Math.max(m,x.makeTime(S,0))}}createElements(){var N;let n=this.chart,m=n.renderer,x=n.container,S=n.options,k=S.rangeSelector,L=k.inputEnabled,R=_d((N=S.chart.style)==null?void 0:N.zIndex,0)+1;k.enabled!==!1&&(this.group=m.g("range-selector-group").attr({zIndex:7}).add(),this.div=Fh("div",void 0,{position:"relative",height:0,zIndex:R}),this.buttonOptions.length&&this.renderButtons(),x.parentNode&&x.parentNode.insertBefore(this.div,x),L&&this.createInputs())}createInputs(){this.inputGroup=this.chart.renderer.g("input-group").add(this.group);let n=this.drawInput("min");this.minDateBox=n.dateBox,this.minLabel=n.label,this.minInput=n.input;let m=this.drawInput("max");this.maxDateBox=m.dateBox,this.maxLabel=m.label,this.maxInput=m.input}render(n,m){var k,L;if(this.options.enabled===!1)return;let x=this.chart,S=x.options.rangeSelector;if(S.inputEnabled){this.inputGroup||this.createInputs(),this.setInputValue("min",n),this.setInputValue("max",m),this.chart.styledMode||((k=this.maxLabel)==null||k.css(S.labelStyle),(L=this.minLabel)==null||L.css(S.labelStyle));let R=x.scroller&&x.scroller.getUnionExtremes()||x.xAxis[0]||{};if(Vd(R.dataMin)&&Vd(R.dataMax)){let N=x.xAxis[0].minRange||0;this.setInputExtremes("min",R.dataMin,Math.min(R.dataMax,this.getInputValue("max"))-N),this.setInputExtremes("max",Math.max(R.dataMin,this.getInputValue("min"))+N,R.dataMax)}if(this.inputGroup){let N=0;[this.minLabel,this.minDateBox,this.maxLabel,this.maxDateBox].forEach(Y=>{if(Y){let{width:se}=Y.getBBox();se&&(Y.attr({x:N}),N+=se+S.inputSpacing)}})}}else this.inputGroup&&(this.inputGroup.destroy(),delete this.inputGroup);!this.chart.styledMode&&this.zoomText&&this.zoomText.css(S.labelStyle),this.alignElements(),this.updateButtonStates()}renderButtons(){var ee;var n;let{chart:m,options:x}=this,S=Qy.lang,k=m.renderer,L=nf(x.buttonTheme),R=L&&L.states;delete L.width,delete L.states,this.buttonGroup=k.g("range-selector-buttons").add(this.group);let N=this.dropdown=Fh("select",void 0,{position:"absolute",padding:0,border:0,cursor:"pointer",opacity:1e-4},this.div),Y=(ee=m.userOptions.rangeSelector)==null?void 0:ee.buttonTheme;this.dropdownLabel=k.button("",0,0,()=>{},nf(L,{"stroke-width":_d(L["stroke-width"],0),width:"auto",paddingLeft:_d(x.buttonTheme.paddingLeft,Y==null?void 0:Y.padding,8),paddingRight:_d(x.buttonTheme.paddingRight,Y==null?void 0:Y.padding,8)}),R&&R.hover,R&&R.select,R&&R.disabled).hide().add(this.group),zp(N,"touchstart",()=>{N.style.fontSize="16px"});let se=fi.isMS?"mouseover":"mouseenter",$=fi.isMS?"mouseout":"mouseleave";zp(N,se,()=>{$m(this.dropdownLabel.element,se)}),zp(N,$,()=>{$m(this.dropdownLabel.element,$)}),zp(N,"change",()=>{$m(this.buttons[N.selectedIndex-1].element,"click")}),this.zoomText=k.label(S.rangeSelectorZoom||"",0).attr({padding:x.buttonTheme.padding,height:x.buttonTheme.height,paddingLeft:0,paddingRight:0}).add(this.buttonGroup),this.chart.styledMode||(this.zoomText.css(x.labelStyle),(n=x.buttonTheme)["stroke-width"]??(n["stroke-width"]=0)),Fh("option",{textContent:this.zoomText.textStr,disabled:!0},void 0,N),this.createButtons()}createButtons(){let{options:n}=this,m=nf(n.buttonTheme),x=m&&m.states,S=m.width||28;delete m.width,delete m.states,this.buttonOptions.forEach((k,L)=>{this.createButton(k,L,S,x)})}createButton(n,m,x,S){let{dropdown:k,buttons:L,chart:R,options:N}=this,Y=R.renderer,se=nf(N.buttonTheme);k==null||k.add(Fh("option",{textContent:n.title||n.text}),m+2),L[m]=Y.button(n.text??"",0,0,$=>{let ee,ae=n.events&&n.events.click;ae&&(ee=ae.call(n,$)),ee!==!1&&this.clickButton(m),this.isActive=!0},se,S&&S.hover,S&&S.select,S&&S.disabled).attr({"text-align":"center",width:x}).add(this.buttonGroup),n.title&&L[m].attr("title",n.title)}alignElements(){var ve;let{buttonGroup:n,buttons:m,chart:x,group:S,inputGroup:k,options:L,zoomText:R}=this,N=x.options,Y=N.exporting&&N.exporting.enabled!==!1&&N.navigation&&N.navigation.buttonOptions,{buttonPosition:se,inputPosition:$,verticalAlign:ee}=L,ae=(Te,Ae,Ve)=>Y&&this.titleCollision(x)&&ee==="top"&&Ve&&Ae.y-Te.getBBox().height-12<(Y.y||0)+(Y.height||0)+x.spacing[0]?-40:0,fe=x.plotLeft;if(S&&se&&$){let Te=se.x-x.spacing[3];if(n){if(this.positionButtons(),!this.initialButtonGroupWidth){let $t=0;R&&($t+=R.getBBox().width+5),m.forEach((Ti,hi)=>{$t+=Ti.width||0,hi!==m.length-1&&($t+=L.buttonSpacing)}),this.initialButtonGroupWidth=$t}fe-=x.spacing[3];let Rt=ae(n,se,se.align==="right"||$.align==="right");this.alignButtonGroup(Rt),(ve=this.buttonGroup)!=null&&ve.translateY&&this.dropdownLabel.attr({y:this.buttonGroup.translateY}),S.placed=n.placed=x.hasLoaded}let Ae=0;L.inputEnabled&&k&&(Ae=ae(k,$,se.align==="right"||$.align==="right"),$.align==="left"?Te=fe:$.align==="right"&&(Te=-Math.max(x.axisOffset[1],-Ae)),k.align({y:$.y,width:k.getBBox().width,align:$.align,x:$.x+Te-2},!0,x.spacingBox),k.placed=x.hasLoaded),this.handleCollision(Ae),S.align({verticalAlign:ee},!0,x.spacingBox);let Ve=S.alignAttr.translateY,Ke=S.getBBox().height+20,Tt=0;if(ee==="bottom"){let Rt=x.legend&&x.legend.options;Tt=Ve-(Ke=Ke+(Rt&&Rt.verticalAlign==="bottom"&&Rt.enabled&&!Rt.floating?x.legend.legendHeight+_d(Rt.margin,10):0)-20)-(L.floating?0:L.y)-(x.titleOffset?x.titleOffset[2]:0)-10}ee==="top"?(L.floating&&(Tt=0),x.titleOffset&&x.titleOffset[0]&&(Tt=x.titleOffset[0]),Tt+=x.margin[0]-x.spacing[0]||0):ee==="middle"&&($.y===se.y?Tt=Ve:($.y||se.y)&&($.y<0||se.y<0?Tt-=Math.min($.y,se.y):Tt=Ve-Ke)),S.translate(L.x,L.y+Math.floor(Tt));let{minInput:St,maxInput:Mt,dropdown:Nt}=this;L.inputEnabled&&St&&Mt&&(St.style.marginTop=S.translateY+"px",Mt.style.marginTop=S.translateY+"px"),Nt&&(Nt.style.marginTop=S.translateY+"px")}}redrawElements(){var S,k,L,R,N;let n=this.chart,{inputBoxHeight:m,inputBoxBorderColor:x}=this.options;if((S=this.maxDateBox)==null||S.attr({height:m}),(k=this.minDateBox)==null||k.attr({height:m}),n.styledMode||((L=this.maxDateBox)==null||L.attr({stroke:x}),(R=this.minDateBox)==null||R.attr({stroke:x})),this.isDirty){this.isDirty=!1,this.isCollapsed=void 0;let Y=this.options.buttons??[],se=Math.min(Y.length,this.buttonOptions.length),{dropdown:$,options:ee}=this,ae=nf(ee.buttonTheme),fe=ae&&ae.states,ve=ae.width||28;if(Y.length<this.buttonOptions.length)for(let Te=this.buttonOptions.length-1;Te>=Y.length;Te--){let Ae=this.buttons.pop();Ae==null||Ae.destroy(),(N=this.dropdown)==null||N.options.remove(Te+1)}for(let Te=se-1;Te>=0;Te--)if(Object.keys(wy(Y[Te],this.buttonOptions[Te])).length!==0){let Ae=Y[Te];this.buttons[Te].destroy(),$==null||$.options.remove(Te+1),this.createButton(Ae,Te,ve,fe),this.computeButtonRange(Ae)}if(Y.length>this.buttonOptions.length)for(let Te=this.buttonOptions.length;Te<Y.length;Te++)this.createButton(Y[Te],Te,ve,fe),this.computeButtonRange(Y[Te]);this.buttonOptions=this.options.buttons??[],Vd(this.options.selected)&&this.buttons.length&&this.clickButton(this.options.selected,!1)}}alignButtonGroup(n,m){let{chart:x,options:S,buttonGroup:k,dropdown:L,dropdownLabel:R}=this,{buttonPosition:N}=S,Y=x.plotLeft-x.spacing[3],se=N.x-x.spacing[3],$=x.plotLeft;N.align==="right"?(se+=n-Y,this.hasVisibleDropdown&&($=x.chartWidth+n-this.maxButtonWidth()-20)):N.align==="center"&&(se-=Y/2,this.hasVisibleDropdown&&($=x.chartWidth/2-this.maxButtonWidth())),L&&dp(L,{left:$+"px",top:(k==null?void 0:k.translateY)+"px"}),R==null||R.attr({x:$}),k&&k.align({y:N.y,width:_d(m,this.initialButtonGroupWidth),align:N.align,x:se},!0,x.spacingBox)}positionButtons(){let{buttons:n,chart:m,options:x,zoomText:S}=this,k=m.hasLoaded?"animate":"attr",{buttonPosition:L}=x,R=m.plotLeft,N=R;S&&S.visibility!=="hidden"&&(S[k]({x:_d(R+L.x,R)}),N+=L.x+S.getBBox().width+5);for(let Y=0,se=this.buttonOptions.length;Y<se;++Y)n[Y].visibility!=="hidden"?(n[Y][k]({x:N}),N+=(n[Y].width||0)+x.buttonSpacing):n[Y][k]({x:R})}handleCollision(n){let{chart:m,buttonGroup:x,inputGroup:S,initialButtonGroupWidth:k}=this,{buttonPosition:L,dropdown:R,inputPosition:N}=this.options,Y=()=>{S&&x&&S.attr({translateX:S.alignAttr.translateX+(m.axisOffset[1]>=-n?0:-n),translateY:S.alignAttr.translateY+x.getBBox().height+10})};S&&x?N.align===L.align?(Y(),k>m.plotWidth+n-20?this.collapseButtons():this.expandButtons()):k-n+S.getBBox().width>m.plotWidth?R==="responsive"?this.collapseButtons():Y():this.expandButtons():x&&R==="responsive"&&(k>m.plotWidth?this.collapseButtons():this.expandButtons()),x&&(R==="always"&&this.collapseButtons(),R==="never"&&this.expandButtons()),this.alignButtonGroup(n)}collapseButtons(){let{buttons:n,zoomText:m}=this;this.isCollapsed!==!0&&(this.isCollapsed=!0,m.hide(),n.forEach(x=>void x.hide()),this.showDropdown())}expandButtons(){let{buttons:n,zoomText:m}=this;this.isCollapsed!==!1&&(this.isCollapsed=!1,this.hideDropdown(),m.show(),n.forEach(x=>void x.show()),this.positionButtons())}showDropdown(){let{buttonGroup:n,dropdownLabel:m,dropdown:x}=this;n&&x&&(m.show(),dp(x,{visibility:"inherit"}),this.hasVisibleDropdown=!0)}hideDropdown(){let{dropdown:n}=this;n&&(this.dropdownLabel.hide(),dp(n,{visibility:"hidden",width:"1px",height:"1px"}),this.hasVisibleDropdown=!1)}getHeight(){let n=this.options,m=this.group,x=n.inputPosition,S=n.buttonPosition,k=n.y,L=S.y,R=x.y,N=0;if(n.height)return n.height;this.alignElements(),N=m?m.getBBox(!0).height+13+k:0;let Y=Math.min(R,L);return(R<0&&L<0||R>0&&L>0)&&(N+=Math.abs(Y)),N}titleCollision(n){return!(n.options.title.text||n.options.subtitle.text)}update(n,m=!0){let x=this.chart;if(nf(!0,this.options,n),this.options.selected&&this.options.selected>=this.options.buttons.length&&(this.options.selected=void 0,x.options.rangeSelector.selected=void 0),Vd(n.enabled))return this.destroy(),this.init(x);this.isDirty=!!n.buttons,m&&this.render()}destroy(){let n=this,m=n.minInput,x=n.maxInput;n.eventsToUnbind&&(n.eventsToUnbind.forEach(S=>S()),n.eventsToUnbind=void 0),p_(n.buttons),m&&(m.onfocus=m.onblur=m.onchange=null),x&&(x.onfocus=x.onblur=x.onchange=null),Ty(n,function(S,k){S&&k!=="chart"&&(S instanceof La?S.destroy():S instanceof window.HTMLElement&&I0(S),delete n[k]),S!==Sy.prototype[k]&&(n[k]=null)},this),this.buttons=[]}}bm(Sy.prototype,{inputTypeFormats:{"datetime-local":"%Y-%m-%dT%H:%M:%S",date:"%Y-%m-%d",time:"%H:%M:%S"}});let{format:f_}=ja,{getOptions:ex}=ei,{setFixedRange:L0}=_u,{addEvent:Ud,clamp:m_,crisp:My,defined:g_,extend:zx,find:O0,isNumber:qm,isString:y_,merge:Vf,pick:Rp,splat:x_}=Gs;function __(H,n,m){return H==="xAxis"?{minPadding:0,maxPadding:0,overscroll:0,ordinal:!0}:H==="yAxis"?{labels:{y:-2},opposite:m.opposite??n.opposite??!0,showLastLabel:!!(n.categories||n.type==="category"),title:{text:void 0}}:{}}function v_(H,n){var m;if(H==="xAxis"){let x=Rp((m=n.navigator)==null?void 0:m.enabled,oa.enabled,!0),S={type:"datetime",categories:void 0};return x&&(S.startOnTick=!1,S.endOnTick=!1),S}return{}}class Rx extends ih{init(n,m){var N,Y;let x=ex(),S=n.xAxis,k=n.yAxis,L=Rp((N=n.navigator)==null?void 0:N.enabled,oa.enabled,!0);n.xAxis=n.yAxis=void 0;let R=Vf({chart:{panning:{enabled:!0,type:"x"},zooming:{pinchType:"x",mouseWheel:{type:"x"}}},navigator:{enabled:L},scrollbar:{enabled:Rp(qy.enabled,!0)},rangeSelector:{enabled:Rp(Ix.rangeSelector.enabled,!0)},title:{text:null},tooltip:{split:Rp((Y=x.tooltip)==null?void 0:Y.split,!0),crosshairs:!0},legend:{enabled:!1}},n,{isStock:!0});n.xAxis=S,n.yAxis=k,R.xAxis=x_(n.xAxis||{}).map(se=>Vf(__("xAxis",se,x.xAxis),se,v_("xAxis",n))),R.yAxis=x_(n.yAxis||{}).map(se=>Vf(__("yAxis",se,x.yAxis),se)),super.init(R,m)}createAxis(n,m){return m.axis=Vf(__(n,m.axis,ex()[n]),m.axis,v_(n,this.userOptions)),super.createAxis(n,m)}}Ud(ih,"update",function(H){let n=H.options;"scrollbar"in n&&this.navigator&&(Vf(!0,this.options.scrollbar,n.scrollbar),this.navigator.update({enabled:!!this.navigator.navigatorEnabled}),delete n.scrollbar)}),function(H){function n(Y){var io,sl,Wo,qo;if(!((sl=(io=this.crosshair)==null?void 0:io.label)!=null&&sl.enabled&&this.cross&&qm(this.min)&&qm(this.max)))return;let se=this.chart,$=this.logarithmic,ee=this.crosshair.label,ae=this.horiz,fe=this.opposite,ve=this.left,Te=this.top,Ae=this.width,Ve=this.options.tickPosition==="inside",Ke=this.crosshair.snap!==!1,Tt=Y.e||((Wo=this.cross)==null?void 0:Wo.e),St=Y.point,Mt=this.crossLabel,Nt,Rt,$t=ee.format,Ti="",hi,Ei=0,Ji=this.min,er=this.max;$&&(Ji=$.lin2log(this.min),er=$.lin2log(this.max));let Is=ae?"center":fe?this.labelAlign==="right"?"right":"left":this.labelAlign==="left"?"left":"center";!Mt&&(Mt=this.crossLabel=se.renderer.label("",0,void 0,ee.shape||"callout").addClass("highcharts-crosshair-label highcharts-color-"+(St!=null&&St.series?St.series.colorIndex:this.series[0]&&this.series[0].colorIndex)).attr({align:ee.align||Is,padding:Rp(ee.padding,8),r:Rp(ee.borderRadius,3),zIndex:2}).add(this.labelGroup),se.styledMode||Mt.attr({fill:ee.backgroundColor||((qo=St==null?void 0:St.series)==null?void 0:qo.color)||"#666666",stroke:ee.borderColor||"","stroke-width":ee.borderWidth||0}).css(zx({color:"#ffffff",fontWeight:"normal",fontSize:"0.7em",textAlign:"center"},ee.style||{}))),ae?(Nt=Ke?(St.plotX||0)+ve:Tt.chartX,Rt=Te+(fe?0:this.height)):(Nt=ve+this.offset+(fe?Ae:0),Rt=Ke?(St.plotY||0)+Te:Tt.chartY),$t||ee.formatter||(this.dateTime&&(Ti="%b %d, %Y"),$t="{value"+(Ti?":"+Ti:"")+"}");let Hs=Ke?this.isXAxis?St.x:St.y:this.toValue(ae?Tt.chartX:Tt.chartY),qs=St!=null&&St.series?St.series.isPointInside(St):qm(Hs)&&Hs>Ji&&Hs<er,dr="";$t?dr=f_($t,{value:Hs},se):ee.formatter&&qm(Hs)&&(dr=ee.formatter.call(this,Hs)),Mt.attr({text:dr,x:Nt,y:Rt,visibility:qs?"inherit":"hidden"});let xr=Mt.getBBox();!qm(Mt.x)||ae||fe||(Nt=Mt.x-xr.width/2),qm(Mt.y)&&(ae?(Ve&&!fe||!Ve&&fe)&&(Rt=Mt.y-xr.height):Rt=Mt.y-xr.height/2),hi=ae?{left:ve,right:ve+this.width}:{left:this.labelAlign==="left"?ve:0,right:this.labelAlign==="right"?ve+this.width:se.chartWidth};let wr=Mt.translateX||0;wr<hi.left&&(Ei=hi.left-wr),wr+xr.width>=hi.right&&(Ei=-(wr+xr.width-hi.right)),Mt.attr({x:Math.max(0,Nt+Ei),y:Math.max(0,Rt),anchorX:ae?Nt:this.opposite?0:se.chartWidth,anchorY:ae?this.opposite?se.chartHeight:0:Rt+xr.height/2})}function m(){this.crossLabel&&(this.crossLabel=this.crossLabel.hide())}function x(Y){let se=this.chart,$=this.options,ee=se._labelPanes=se._labelPanes||{},ae=$.labels;if(se.options.isStock&&this.coll==="yAxis"){let fe=$.top+","+$.height;!ee[fe]&&ae.enabled&&(ae.distance===15&&this.side===1&&(ae.distance=0),ae.align===void 0&&(ae.align="right"),ee[fe]=this,Y.align="right",Y.preventDefault())}}function S(){let Y=this.chart,se=this.options&&this.options.top+","+this.options.height;se&&Y._labelPanes&&Y._labelPanes[se]===this&&delete Y._labelPanes[se]}function k(Y){let se=this,$=se.isLinked&&!se.series&&se.linkedParent?se.linkedParent.series:se.series,ee=se.chart,ae=ee.renderer,fe=se.left,ve=se.top,Te=[],Ae=Y.translatedValue,Ve=Y.value,Ke=Y.force,Tt,St,Mt,Nt,Rt=[],$t,Ti;if(ee.options.isStock&&Y.acrossPanes!==!1&&se.coll==="xAxis"||se.coll==="yAxis"){for(let hi of(Y.preventDefault(),Rt=(Ei=>{let Ji=Ei==="xAxis"?"yAxis":"xAxis",er=se.options[Ji];return qm(er)?[ee[Ji][er]]:y_(er)?[ee.get(er)]:$.map(Is=>Is[Ji])})(se.coll),se.isXAxis?ee.yAxis:ee.xAxis))if(!hi.options.isInternal){let Ei=hi.isXAxis?"yAxis":"xAxis";se===(g_(hi.options[Ei])?ee[Ei][hi.options[Ei]]:ee[Ei][0])&&Rt.push(hi)}for(let hi of($t=Rt.length?[]:[se.isXAxis?ee.yAxis[0]:ee.xAxis[0]],Rt))$t.indexOf(hi)!==-1||O0($t,Ei=>Ei.pos===hi.pos&&Ei.len===hi.len)||$t.push(hi);if(qm(Ti=Rp(Ae,se.translate(Ve||0,void 0,void 0,Y.old))))if(se.horiz)for(let hi of $t){let Ei;Nt=(St=hi.pos)+hi.len,Tt=Mt=Math.round(Ti+se.transB),Ke!=="pass"&&(Tt<fe||Tt>fe+se.width)&&(Ke?Tt=Mt=m_(Tt,fe,fe+se.width):Ei=!0),Ei||Te.push(["M",Tt,St],["L",Mt,Nt])}else for(let hi of $t){let Ei;Mt=(Tt=hi.pos)+hi.len,St=Nt=ve+se.height-Ti,Ke!=="pass"&&(St<ve||St>ve+se.height)&&(Ke?St=Nt=m_(St,ve,ve+se.height):Ei=!0),Ei||Te.push(["M",Tt,St],["L",Mt,Nt])}Y.path=Te.length>0?ae.crispPolyLine(Te,Y.lineWidth||1):void 0}}function L(Y){if(this.chart.options.isStock){let se;this.is("column")||this.is("columnrange")?se={borderWidth:0,shadow:!1}:this.is("scatter")||this.is("sma")||(se={marker:{enabled:!1,radius:2}}),se&&(Y.plotOptions[this.type]=Vf(Y.plotOptions[this.type],se))}}function R(){let Y=this.chart,se=this.options.dataGrouping;return this.allowDG!==!1&&se&&Rp(se.enabled,Y.options.isStock)}function N(Y,se){for(let $=0;$<Y.length;$+=2){let ee=Y[$],ae=Y[$+1];g_(ee[1])&&ee[1]===ae[1]&&(ee[1]=ae[1]=My(ee[1],se)),g_(ee[2])&&ee[2]===ae[2]&&(ee[2]=ae[2]=My(ee[2],se))}return Y}H.compose=function(Y,se,$,ee){let ae=$.prototype;ae.forceCropping||(Ud(se,"afterDrawCrosshair",n),Ud(se,"afterHideCrosshair",m),Ud(se,"autoLabelAlign",x),Ud(se,"destroy",S),Ud(se,"getPlotLinePath",k),Y.prototype.setFixedRange=L0,ae.forceCropping=R,Ud($,"setOptions",L),ee.prototype.crispPolyLine=N)},H.stockChart=function(Y,se,$){return new H(Y,se,$)}}(Rx||(Rx={}));let Bx=Rx,{column:{prototype:{pointClass:q_}}}=pn.seriesTypes,{column:Z_}=pn.seriesTypes,{crisp:K_,extend:J_,merge:b_}=Gs,{defaultOptions:Q_}=ei;class w_ extends Z_{extendStem(n,m,x){let S=n[0],k=n[1];typeof S[2]=="number"&&(S[2]=Math.max(x+m,S[2])),typeof k[2]=="number"&&(k[2]=Math.min(x-m,k[2]))}getPointPath(n,m){let x=m.strokeWidth(),S=n.series,k=K_(n.plotX||0,x),L=Math.round(n.shapeArgs.width/2),R=[["M",k,Math.round(n.yBottom)],["L",k,Math.round(n.plotHigh)]];if(n.close!==null){let N=K_(n.plotClose,x);R.push(["M",k,N],["L",k+L,N]),S.extendStem(R,x/2,N)}return R}drawSinglePoint(n){let m=n.series,x=m.chart,S,k=n.graphic;n.plotY!==void 0&&(k||(n.graphic=k=x.renderer.path().add(m.group)),x.styledMode||k.attr(m.pointAttribs(n,n.selected&&"select")),S=m.getPointPath(n,k),k[k?"animate":"attr"]({d:S}).addClass(n.getClassName(),!0))}drawPoints(){this.points.forEach(this.drawSinglePoint)}init(){super.init.apply(this,arguments),this.options.stacking=void 0}pointAttribs(n,m){let x=super.pointAttribs.call(this,n,m);return delete x.fill,x}toYData(n){return[n.high,n.low,n.close]}translate(){let n=this,m=n.yAxis,x=this.pointArrayMap&&this.pointArrayMap.slice()||[],S=x.map(k=>`plot${k.charAt(0).toUpperCase()+k.slice(1)}`);S.push("yBottom"),x.push("low"),super.translate.apply(n),n.points.forEach(function(k){x.forEach(function(L,R){let N=k[L];N!==null&&(n.dataModify&&(N=n.dataModify.modifyValue(N)),k[S[R]]=m.toPixels(N,!0))}),k.tooltipPos[1]=k.plotHigh+m.pos-n.chart.plotTop})}}w_.defaultOptions=b_(Z_.defaultOptions,{lineWidth:1,tooltip:{pointFormat:'<span style="color:{point.color}">●</span> <b> {series.name}</b><br/>{series.chart.options.lang.stockHigh}: {point.high}<br/>{series.chart.options.lang.stockLow}: {point.low}<br/>{series.chart.options.lang.stockClose}: {point.close}<br/>'},threshold:null,states:{hover:{lineWidth:3}},stickyTracking:!0}),J_(w_.prototype,{pointClass:class extends q_{},animate:null,directTouch:!1,keysAffectYAxis:["low","high"],pointArrayMap:["high","low","close"],pointAttrToOptions:{stroke:"color","stroke-width":"lineWidth"},pointValKey:"close"}),J_(Q_.lang,{stockOpen:"Open",stockHigh:"High",stockLow:"Low",stockClose:"Close"}),pn.registerSeriesType("hlc",w_);let{seriesTypes:{hlc:D0}}=pn;class T_ extends D0.prototype.pointClass{getClassName(){return super.getClassName.call(this)+(this.open<this.close?" highcharts-point-up":" highcharts-point-down")}resolveUpColor(){this.open<this.close&&!this.options.color&&this.series.options.upColor&&(this.color=this.series.options.upColor)}resolveColor(){super.resolveColor(),this.series.is("heikinashi")||this.resolveUpColor()}getZone(){let n=super.getZone();return this.resolveUpColor(),n}applyOptions(){return super.applyOptions.apply(this,arguments),this.resolveColor&&this.resolveColor(),this}}let{composed:z0}=fi,{hlc:e0}=pn.seriesTypes,{addEvent:t0,crisp:tx,extend:ix,merge:i0,pushUnique:Fx}=Gs;function s0(H){let n=H.options,m=n.dataGrouping;m&&n.useOhlcData&&n.id!=="highcharts-navigator-series"&&(m.approximation="ohlc")}function r0(H){let n=H.options;n.useOhlcData&&n.id!=="highcharts-navigator-series"&&ix(this,{pointValKey:Zm.prototype.pointValKey,pointArrayMap:Zm.prototype.pointArrayMap,toYData:Zm.prototype.toYData})}class Zm extends e0{static compose(n,...m){Fx(z0,"OHLCSeries")&&(t0(n,"afterSetOptions",s0),t0(n,"init",r0))}getPointPath(n,m){let x=super.getPointPath(n,m),S=m.strokeWidth(),k=tx(n.plotX||0,S),L=Math.round(n.shapeArgs.width/2);if(n.open!==null){let R=tx(n.plotOpen,S);x.push(["M",k,R],["L",k-L,R]),super.extendStem(x,S/2,R)}return x}pointAttribs(n,m){let x=super.pointAttribs.call(this,n,m),S=this.options;return delete x.fill,!n.options.color&&S.upColor&&n.open<n.close&&(x.stroke=S.upColor),x}toYData(n){return[n.open,n.high,n.low,n.close]}}Zm.defaultOptions=i0(e0.defaultOptions,{tooltip:{pointFormat:'<span style="color:{point.color}">●</span> <b> {series.name}</b><br/>{series.chart.options.lang.stockOpen}: {point.open}<br/>{series.chart.options.lang.stockHigh}: {point.high}<br/>{series.chart.options.lang.stockLow}: {point.low}<br/>{series.chart.options.lang.stockClose}: {point.close}<br/>'}}),ix(Zm.prototype,{pointClass:T_,pointArrayMap:["open","high","low","close"]}),pn.registerSeriesType("ohlc",Zm);let{column:sx,ohlc:Nx}=pn.seriesTypes,{crisp:Vx,merge:S_}=Gs;class rx extends Nx{pointAttribs(n,m){let x=sx.prototype.pointAttribs.call(this,n,m),S=this.options,k=n.open<n.close,L=S.lineColor||this.color,R=n.color||this.color;if(x["stroke-width"]=S.lineWidth,x.fill=n.options.color||k&&S.upColor||R,x.stroke=n.options.lineColor||k&&S.upLineColor||L,m){let N=S.states[m];x.fill=N.color||x.fill,x.stroke=N.lineColor||x.stroke,x["stroke-width"]=N.lineWidth||x["stroke-width"]}return x}drawPoints(){let n=this.points,m=this.chart,x=this.yAxis.reversed;for(let S of n){let k=S.graphic,L,R,N,Y,se,$,ee,ae,fe,ve=!k;if(S.plotY!==void 0){k||(S.graphic=k=m.renderer.path().add(this.group)),this.chart.styledMode||k.attr(this.pointAttribs(S,S.selected&&"select")).shadow(this.options.shadow);let Te=k.strokeWidth();ee=Vx(S.plotX||0,Te),N=Math.min(L=S.plotOpen,R=S.plotClose),Y=Math.max(L,R),fe=Math.round(S.shapeArgs.width/2),se=x?Y!==S.yBottom:Math.round(N)!==Math.round(S.plotHigh||0),$=x?Math.round(N)!==Math.round(S.plotHigh||0):Y!==S.yBottom,N=Vx(N,Te),Y=Vx(Y,Te),(ae=[]).push(["M",ee-fe,Y],["L",ee-fe,N],["L",ee+fe,N],["L",ee+fe,Y],["Z"],["M",ee,N],["L",ee,se?Math.round(x?S.yBottom:S.plotHigh):N],["M",ee,Y],["L",ee,$?Math.round(x?S.plotHigh:S.yBottom):Y]),k[ve?"attr":"animate"]({d:ae}).addClass(S.getClassName(),!0)}}}}rx.defaultOptions=S_(Nx.defaultOptions,{tooltip:Nx.defaultOptions.tooltip},{states:{hover:{lineWidth:2}},threshold:null,lineColor:"#000000",lineWidth:1,upColor:"#ffffff",stickyTracking:!0}),pn.registerSeriesType("candlestick",rx);let{column:{prototype:{pointClass:Qg}}}=pn.seriesTypes,{isNumber:ox}=Gs,Mg=class extends Qg{constructor(){super(...arguments),this.ttBelow=!1}isValid(){return ox(this.y)||this.y===void 0}hasNewShapeType(){let H=this.options.shape||this.series.options.shape;return this.graphic&&H&&H!==this.graphic.symbolKey}};(function(H){let n=[];function m(S,k,L,R,N){let Y=N&&N.anchorX||S,se=N&&N.anchorY||k,$=this.circle(Y-1,se-1,2,2);return $.push(["M",Y,se],["L",S,k+R],["L",S,k],["L",S+L,k],["L",S+L,k+R],["L",S,k+R],["Z"]),$}function x(S,k){S[k+"pin"]=function(L,R,N,Y,se){let $,ee=se&&se.anchorX,ae=se&&se.anchorY;if(k==="circle"&&Y>N&&(L-=Math.round((Y-N)/2),N=Y),$=S[k](L,R,N,Y,se),ee&&ae){let fe=ee;if(k==="circle")fe=L+N/2;else{let Te=$[0],Ae=$[1];Te[0]==="M"&&Ae[0]==="L"&&(fe=(Te[1]+Ae[1])/2)}let ve=R>ae?R:R+Y;$.push(["M",fe,ve],["L",ee,ae]),$=$.concat(S.circle(ee-1,ae-1,2,2))}return $}}H.compose=function(S){if(n.indexOf(S)===-1){n.push(S);let L=S.prototype.symbols;L.flag=m,x(L,"circle"),x(L,"square")}let k=Bn.getRendererType();n.indexOf(k)&&n.push(k)}})(No||(No={}));let R0=No,{composed:B0}=fi,{prototype:F0}=Mo,{prototype:Ay}=Vl,{defined:Ux,pushUnique:o0,stableSort:N0}=Gs;(function(H){function n(x){return Ay.getPlotBox.call(this.options.onSeries&&this.chart.get(this.options.onSeries)||this,x)}function m(){var $t,Ti;F0.translate.apply(this);let x=this,S=x.options,k=x.chart,L=x.points,R=S.onSeries,N=R&&k.get(R),Y=N&&N.options.step,se=N&&N.points,$=k.inverted,ee=x.xAxis,ae=x.yAxis,fe=L.length-1,ve,Te,Ae=S.onKey||"y",Ve=se&&se.length,Ke=0,Tt,St,Mt,Nt,Rt;if(N&&N.visible&&Ve){for(Ke=(N.pointXOffset||0)+(N.barW||0)/2,Nt=N.currentDataGrouping,St=se[Ve-1].x+(Nt?Nt.totalRange:0),N0(L,(hi,Ei)=>hi.x-Ei.x),Ae="plot"+Ae[0].toUpperCase()+Ae.substr(1);Ve--&&L[fe];)if(Tt=se[Ve],(ve=L[fe]).y=Tt.y,Tt.x<=ve.x&&Tt[Ae]!==void 0){if(ve.x<=St&&(ve.plotY=Tt[Ae],Tt.x<ve.x&&!Y&&(Mt=se[Ve+1]))&&Mt[Ae]!==void 0)if(Ux(ve.plotX)&&N.is("spline")){let hi=[Tt.plotX||0,Tt.plotY||0],Ei=[Mt.plotX||0,Mt.plotY||0],Ji=(($t=Tt.controlPoints)==null?void 0:$t.high)||hi,er=((Ti=Mt.controlPoints)==null?void 0:Ti.low)||Ei,Is=(xr,wr)=>Math.pow(1-xr,3)*hi[wr]+3*(1-xr)*(1-xr)*xr*Ji[wr]+3*(1-xr)*xr*xr*er[wr]+xr*xr*xr*Ei[wr],Hs=0,qs=1,dr;for(let xr=0;xr<100;xr++){let wr=(Hs+qs)/2,io=Is(wr,0);if(io===null)break;if(.25>Math.abs(io-ve.plotX)){dr=wr;break}io<ve.plotX?Hs=wr:qs=wr}Ux(dr)&&(ve.plotY=Is(dr,1),ve.y=ae.toValue(ve.plotY,!0))}else Rt=(ve.x-Tt.x)/(Mt.x-Tt.x),ve.plotY+=Rt*(Mt[Ae]-Tt[Ae]),ve.y+=Rt*(Mt.y-Tt.y);if(fe--,Ve++,fe<0)break}}L.forEach((hi,Ei)=>{let Ji;hi.plotX+=Ke,(hi.plotY===void 0||$)&&(hi.plotX>=0&&hi.plotX<=ee.len?$?(hi.plotY=ee.translate(hi.x,0,1,0,1),hi.plotX=Ux(hi.y)?ae.translate(hi.y,0,0,0,1):0):hi.plotY=(ee.opposite?0:x.yAxis.len)+ee.offset:hi.shapeArgs={}),(Te=L[Ei-1])&&Te.plotX===hi.plotX&&(Te.stackIndex===void 0&&(Te.stackIndex=0),Ji=Te.stackIndex+1),hi.stackIndex=Ji}),this.onSeries=N}H.compose=function(x){if(o0(B0,"OnSeries")){let S=x.prototype;S.getPlotBox=n,S.translate=m}return x},H.getPlotBox=n,H.translate=m})(pi||(pi={}));let n0=pi,{noop:ey}=fi,{distribute:a0}=Gr,{series:wh,seriesTypes:{column:l0}}=pn,{addEvent:Ag,defined:V0,extend:jx,isNumber:h0,merge:Gx,objectEach:c0,wrap:Wx}=Gs;class ky extends l0{animate(n){n&&this.setClip()}drawPoints(){let n,m,x,S,k,L,R,N,Y,se,$,ee=this.points,ae=this.chart,fe=ae.renderer,ve=ae.inverted,Te=this.options,Ae=Te.y,Ve=this.yAxis,Ke={},Tt=[],St=h0(Te.borderRadius)?Te.borderRadius:0;for(S=ee.length;S--;)k=ee[S],se=(ve?k.plotY:k.plotX)>this.xAxis.len,n=k.plotX,R=k.stackIndex,x=k.options.shape||Te.shape,(m=k.plotY)!==void 0&&(m=k.plotY+Ae-(R!==void 0&&R*Te.stackDistance)),k.anchorX=R?void 0:k.plotX,N=R?void 0:k.plotY,$=x!=="flag",L=k.graphic,m!==void 0&&n>=0&&!se?(L&&k.hasNewShapeType()&&(L=L.destroy()),L||(L=k.graphic=fe.label("",0,void 0,x,void 0,void 0,Te.useHTML).addClass("highcharts-point").add(this.markerGroup),k.graphic.div&&(k.graphic.div.point=k),L.isNew=!0),L.attr({align:$?"center":"left",width:Te.width,height:Te.height,"text-align":Te.textAlign,r:St}),ae.styledMode||L.attr(this.pointAttribs(k)).css(Gx(Te.style,k.style)).shadow(Te.shadow),n>0&&(n-=L.strokeWidth()%2),Y={y:m,anchorY:N},Te.allowOverlapX&&(Y.x=n,Y.anchorX=k.anchorX),L.attr({text:k.options.title??Te.title??"A"})[L.isNew?"attr":"animate"](Y),Te.allowOverlapX||(Ke[k.plotX]?Ke[k.plotX].size=Math.max(Ke[k.plotX].size,L.width||0):Ke[k.plotX]={align:.5*!!$,size:L.width||0,target:n,anchorX:n}),k.tooltipPos=[n,m+Ve.pos-ae.plotTop]):L&&(k.graphic=L.destroy());if(!Te.allowOverlapX){let Mt=100;for(let Nt of(c0(Ke,function(Rt){Rt.plotX=Rt.anchorX,Tt.push(Rt),Mt=Math.max(Rt.size,Mt)}),a0(Tt,ve?Ve.len:this.xAxis.len,Mt),ee)){let Rt=Nt.plotX,$t=Nt.graphic,Ti=$t&&Ke[Rt];Ti&&$t&&(V0(Ti.pos)?$t[$t.isNew?"attr":"animate"]({x:Ti.pos+(Ti.align||0)*Ti.size,anchorX:Nt.anchorX}).show().isNew=!1:$t.hide().isNew=!0)}}Te.useHTML&&this.markerGroup&&Wx(this.markerGroup,"on",function(Mt){return La.prototype.on.apply(Mt.apply(this,[].slice.call(arguments,1)),[].slice.call(arguments,1))})}drawTracker(){let n=this.points;for(let m of(super.drawTracker(),n)){let x=m.graphic;x&&(m.unbindMouseOver&&m.unbindMouseOver(),m.unbindMouseOver=Ag(x.element,"mouseover",function(){for(let S of(m.stackIndex>0&&!m.raised&&(m._y=x.y,x.attr({y:m._y-8}),m.raised=!0),n))S!==m&&S.raised&&S.graphic&&(S.graphic.attr({y:S._y}),S.raised=!1)}))}}pointAttribs(n,m){let x=this.options,S=n&&n.color||this.color,k=x.lineColor,L=n&&n.lineWidth,R=n&&n.fillColor||x.fillColor;return m&&(R=x.states[m].fillColor,k=x.states[m].lineColor,L=x.states[m].lineWidth),{fill:R||S,stroke:k||S,"stroke-width":L||x.lineWidth||0}}setClip(){wh.prototype.setClip.apply(this,arguments),this.options.clip!==!1&&this.sharedClipKey&&this.markerGroup&&this.markerGroup.clip(this.chart.sharedClips[this.sharedClipKey])}}ky.compose=R0.compose,ky.defaultOptions=Gx(l0.defaultOptions,{borderRadius:0,pointRange:0,allowOverlapX:!1,shape:"flag",stackDistance:12,textAlign:"center",tooltip:{pointFormat:"{point.text}"},threshold:null,y:-30,fillColor:"#ffffff",lineWidth:1,states:{hover:{lineColor:"#000000",fillColor:"#ccd3ff"}},style:{color:"#000000",fontSize:"0.7em",fontWeight:"bold"}}),n0.compose(ky),jx(ky.prototype,{allowDG:!1,forceCrop:!0,invertible:!1,noSharedTooltip:!0,pointClass:Mg,sorted:!1,takeOrdinalPosition:!1,trackerGroups:["markerGroup"],buildKDTree:ey,init:wh.prototype.init}),pn.registerSeriesType("flags",ky);let{addEvent:ty,find:Hx,fireEvent:Ey,isArray:Cy,isNumber:Bp,pick:iy}=Gs;(function(H){function n(){this.brokenAxis!==void 0&&this.brokenAxis.setBreaks(this.options.breaks,!1)}function m(){var se;(se=this.brokenAxis)!=null&&se.hasBreaks&&(this.options.ordinal=!1)}function x(){let se=this.brokenAxis;if(se!=null&&se.hasBreaks){let $=this.tickPositions,ee=this.tickPositions.info,ae=[];for(let fe=0;fe<$.length;fe++)se.isInAnyBreak($[fe])||ae.push($[fe]);this.tickPositions=ae,this.tickPositions.info=ee}}function S(){this.brokenAxis||(this.brokenAxis=new Y(this))}function k(){var ve,Te;let{isDirty:se,options:{connectNulls:$},points:ee,xAxis:ae,yAxis:fe}=this;if(se){let Ae=ee.length;for(;Ae--;){let Ve=ee[Ae],Ke=(Ve.y!==null||$!==!1)&&(((ve=ae==null?void 0:ae.brokenAxis)==null?void 0:ve.isInAnyBreak(Ve.x,!0))||((Te=fe==null?void 0:fe.brokenAxis)==null?void 0:Te.isInAnyBreak(Ve.y,!0)));Ve.visible=!Ke&&Ve.options.visible!==!1}}}function L(){this.drawBreaks(this.xAxis,["x"]),this.drawBreaks(this.yAxis,iy(this.pointArrayMap,["y"]))}function R(se,$){var Ae;let ee,ae,fe,ve=this,Te=ve.points;if((Ae=se==null?void 0:se.brokenAxis)!=null&&Ae.hasBreaks){let Ve=se.brokenAxis;$.forEach(function(Ke){var St,Mt;ee=(Ve==null?void 0:Ve.breakArray)||[],ae=se.isXAxis?se.min:iy(ve.options.threshold,se.min);let Tt=(Mt=(St=se==null?void 0:se.options)==null?void 0:St.breaks)==null?void 0:Mt.filter(function(Nt){let Rt=!0;for(let $t=0;$t<ee.length;$t++){let Ti=ee[$t];if(Ti.from===Nt.from&&Ti.to===Nt.to){Rt=!1;break}}return Rt});Te.forEach(function(Nt){fe=iy(Nt["stack"+Ke.toUpperCase()],Nt[Ke]),ee.forEach(function(Rt){if(Bp(ae)&&Bp(fe)){let $t="";ae<Rt.from&&fe>Rt.to||ae>Rt.from&&fe<Rt.from?$t="pointBreak":(ae<Rt.from&&fe>Rt.from&&fe<Rt.to||ae>Rt.from&&fe>Rt.to&&fe<Rt.from)&&($t="pointInBreak"),$t&&Ey(se,$t,{point:Nt,brk:Rt})}}),Tt==null||Tt.forEach(function(Rt){Ey(se,"pointOutsideOfBreak",{point:Nt,brk:Rt})})})})}}function N(){let se=this.currentDataGrouping,$=se==null?void 0:se.gapSize,ee=this.points.slice(),ae=this.yAxis,fe=this.options.gapSize,ve=ee.length-1;if(fe&&ve>0){let Te,Ae;for(this.options.gapUnit!=="value"&&(fe*=this.basePointRange),$&&$>fe&&$>=this.basePointRange&&(fe=$);ve--;)if(Ae&&Ae.visible!==!1||(Ae=ee[ve+1]),Te=ee[ve],Ae.visible!==!1&&Te.visible!==!1){if(Ae.x-Te.x>fe){let Ve=(Te.x+Ae.x)/2;ee.splice(ve+1,0,{isNull:!0,x:Ve}),ae.stacking&&this.options.stacking&&((ae.stacking.stacks[this.stackKey][Ve]=new _(ae,ae.options.stackLabels,!1,Ve,this.stack)).total=0)}Ae=Te}}return this.getGraphPath(ee)}H.compose=function(se,$){if(!se.keepProps.includes("brokenAxis")){se.keepProps.push("brokenAxis"),ty(se,"init",S),ty(se,"afterInit",n),ty(se,"afterSetTickPositions",x),ty(se,"afterSetOptions",m);let ee=$.prototype;ee.drawBreaks=R,ee.gappedPath=N,ty($,"afterGeneratePoints",k),ty($,"afterRender",L)}return se};class Y{static isInBreak($,ee){let ae=$.repeat||1/0,fe=$.from,ve=$.to-$.from,Te=ee>=fe?(ee-fe)%ae:ae-(fe-ee)%ae;return $.inclusive?Te<=ve:Te<ve&&Te!==0}static lin2Val($){let ee=this.brokenAxis,ae=ee==null?void 0:ee.breakArray;if(!ae||!Bp($))return $;let fe=$,ve,Te;for(Te=0;Te<ae.length&&!((ve=ae[Te]).from>=fe);Te++)(ve.to<fe||Y.isInBreak(ve,fe))&&(fe+=ve.len);return fe}static val2Lin($){let ee=this.brokenAxis,ae=ee==null?void 0:ee.breakArray;if(!ae||!Bp($))return $;let fe=$,ve,Te;for(Te=0;Te<ae.length;Te++)if((ve=ae[Te]).to<=$)fe-=ve.len;else{if(ve.from>=$)break;if(Y.isInBreak(ve,$)){fe-=$-ve.from;break}}return fe}constructor($){this.hasBreaks=!1,this.axis=$}findBreakAt($,ee){return Hx(ee,function(ae){return ae.from<$&&$<ae.to})}isInAnyBreak($,ee){let ae=this.axis,fe=ae.options.breaks||[],ve=fe.length,Te,Ae,Ve;if(ve&&Bp($)){for(;ve--;)Y.isInBreak(fe[ve],$)&&(Te=!0,Ae||(Ae=iy(fe[ve].showPoints,!ae.isXAxis)));Ve=Te&&ee?Te&&!Ae:Te}return Ve}setBreaks($,ee){let ae=this,fe=ae.axis,ve=fe.chart.time,Te=Cy($)&&!!$.length&&!!Object.keys($[0]).length;fe.isDirty=ae.hasBreaks!==Te,ae.hasBreaks=Te,$==null||$.forEach(Ae=>{Ae.from=ve.parse(Ae.from)||0,Ae.to=ve.parse(Ae.to)||0}),$!==fe.options.breaks&&(fe.options.breaks=fe.userOptions.breaks=$),fe.forceRedraw=!0,fe.series.forEach(function(Ae){Ae.isDirty=!0}),Te||fe.val2lin!==Y.val2Lin||(delete fe.val2lin,delete fe.lin2val),Te&&(fe.userOptions.ordinal=!1,fe.lin2val=Y.lin2Val,fe.val2lin=Y.val2Lin,fe.setExtremes=function(Ae,Ve,Ke,Tt,St){if(ae.hasBreaks){let Mt,Nt=this.options.breaks||[];for(;Mt=ae.findBreakAt(Ae,Nt);)Ae=Mt.to;for(;Mt=ae.findBreakAt(Ve,Nt);)Ve=Mt.from;Ve<Ae&&(Ve=Ae)}fe.constructor.prototype.setExtremes.call(this,Ae,Ve,Ke,Tt,St)},fe.setAxisTranslation=function(){if(fe.constructor.prototype.setAxisTranslation.call(this),ae.unitLength=void 0,ae.hasBreaks){let Ae=fe.options.breaks||[],Ve=[],Ke=[],Tt=iy(fe.pointRangePadding,0),St=0,Mt,Nt,Rt=fe.userMin||fe.min,$t=fe.userMax||fe.max,Ti,hi;Ae.forEach(function(Ei){Nt=Ei.repeat||1/0,Bp(Rt)&&Bp($t)&&(Y.isInBreak(Ei,Rt)&&(Rt+=Ei.to%Nt-Rt%Nt),Y.isInBreak(Ei,$t)&&($t-=$t%Nt-Ei.from%Nt))}),Ae.forEach(function(Ei){if(Ti=Ei.from,Nt=Ei.repeat||1/0,Bp(Rt)&&Bp($t)){for(;Ti-Nt>Rt;)Ti-=Nt;for(;Ti<Rt;)Ti+=Nt;for(hi=Ti;hi<$t;hi+=Nt)Ve.push({value:hi,move:"in"}),Ve.push({value:hi+Ei.to-Ei.from,move:"out",size:Ei.breakSize})}}),Ve.sort(function(Ei,Ji){return Ei.value===Ji.value?(Ei.move!=="in")-(Ji.move!=="in"):Ei.value-Ji.value}),Mt=0,Ti=Rt,Ve.forEach(function(Ei){(Mt+=Ei.move==="in"?1:-1)===1&&Ei.move==="in"&&(Ti=Ei.value),Mt===0&&Bp(Ti)&&(Ke.push({from:Ti,to:Ei.value,len:Ei.value-Ti-(Ei.size||0)}),St+=Ei.value-Ti-(Ei.size||0))}),ae.breakArray=Ke,Bp(Rt)&&Bp($t)&&Bp(fe.min)&&(ae.unitLength=$t-Rt-St+Tt,Ey(fe,"afterBreaks"),fe.staticScale?fe.transA=fe.staticScale:ae.unitLength&&(fe.transA*=($t-fe.min+Tt)/ae.unitLength),Tt&&(fe.minPixelPadding=fe.transA*(fe.minPointOffset||0)),fe.min=Rt,fe.max=$t)}}),iy(ee,!0)&&fe.chart.redraw()}}H.Additions=Y})(on||(on={}));let Xx=on;fi.BrokenAxis=fi.BrokenAxis||Xx,fi.BrokenAxis.compose(fi.Axis,fi.Series);let kl={},{arrayMax:nx,arrayMin:Py,correctFloat:Iy,extend:Ly,isNumber:wm}=Gs;function M_(H){let n=H.length,m=A_(H);return wm(m)&&n&&(m=Iy(m/n)),m}function A_(H){let n=H.length,m;if(!n&&H.hasNulls)m=null;else if(n)for(m=0;n--;)m+=H[n];return m}let Oy={average:M_,averages:function(){let H=[];return[].forEach.call(arguments,function(n){H.push(M_(n))}),H[0]===void 0?void 0:H},close:function(H){return H.length?H[H.length-1]:H.hasNulls?null:void 0},high:function(H){return H.length?nx(H):H.hasNulls?null:void 0},hlc:function(H,n,m){if(H=kl.high(H),n=kl.low(n),m=kl.close(m),wm(H)||wm(n)||wm(m))return[H,n,m]},low:function(H){return H.length?Py(H):H.hasNulls?null:void 0},ohlc:function(H,n,m,x){if(H=kl.open(H),n=kl.high(n),m=kl.low(m),x=kl.close(x),wm(H)||wm(n)||wm(m)||wm(x))return[H,n,m,x]},open:function(H){return H.length?H[0]:H.hasNulls?null:void 0},range:function(H,n){return H=kl.low(H),n=kl.high(n),wm(H)||wm(n)?[H,n]:H===null&&n===null?null:void 0},sum:A_};Ly(kl,Oy);let sy={common:{groupPixelWidth:2,dateTimeLabelFormats:{millisecond:["%[AebHMSL]","%[AebHMSL]","-%[HMSL]"],second:["%[AebHMS]","%[AebHMS]","-%[HMS]"],minute:["%[AebHM]","%[AebHM]","-%[HM]"],hour:["%[AebHM]","%[AebHM]","-%[HM]"],day:["%[AebY]","%[Aeb]","-%[AebY]"],week:["%v %[AebY]","%[Aeb]","-%[AebY]"],month:["%[BY]","%[B]","-%[BY]"],year:["%Y","%Y","-%Y"]}},seriesSpecific:{line:{},spline:{},area:{},areaspline:{},arearange:{},column:{groupPixelWidth:10},columnrange:{groupPixelWidth:10},candlestick:{groupPixelWidth:10},ohlc:{groupPixelWidth:5},hlc:{groupPixelWidth:5},heikinashi:{groupPixelWidth:10}},units:[["millisecond",[1,2,5,10,20,25,50,100,200,500]],["second",[1,2,5,10,15,30]],["minute",[1,2,5,10,15,30]],["hour",[1,2,3,4,6,8,12]],["day",[1]],["week",[1]],["month",[1,3,6]],["year",null]]},{addEvent:Yx,extend:q,merge:l,pick:p}=Gs;function y(H){let n=this,m=n.series;m.forEach(function(x){x.groupPixelWidth=void 0}),m.forEach(function(x){x.groupPixelWidth=n.getGroupPixelWidth&&n.getGroupPixelWidth(),x.groupPixelWidth&&(x.hasProcessed=!0),x.applyGrouping(!!H.hasExtremesChanged)})}function T(){let H=this.series,n=H.length,m=0,x=!1,S,k;for(;n--;)(k=H[n].options.dataGrouping)&&(m=Math.max(m,p(k.groupPixelWidth,sy.common.groupPixelWidth)),S=(H[n].dataTable.modified||H[n].dataTable).rowCount,(H[n].groupPixelWidth||S>this.chart.plotSizeX/m||S&&k.forced)&&(x=!0));return x?m:0}function A(){this.series.forEach(function(H){H.hasProcessed=!1})}function P(H,n){let m;if(n=p(n,!0),H||(H={forced:!1,units:null}),this instanceof Vi)for(m=this.series.length;m--;)this.series[m].update({dataGrouping:H},!1);else this.chart.options.series.forEach(function(x){x.dataGrouping=typeof H=="boolean"?H:l(H,x.dataGrouping)});this.ordinal&&(this.ordinal.slope=void 0),n&&this.chart.redraw()}let I={compose:function(H){Vi=H;let n=H.prototype;n.applyGrouping||(Yx(H,"afterSetScale",A),Yx(H,"postProcessData",y),q(n,{applyGrouping:y,getGroupPixelWidth:T,setDataGrouping:P}))}},{series:{prototype:B}}=pn,{addEvent:X,defined:re,error:te,extend:pe,isNumber:_e,merge:Ee,pick:De,splat:Re}=Gs,Be=B.generatePoints;function Ze(H){var n,m,x;let S,k,L=this.chart,R=this.options.dataGrouping,N=this.allowDG!==!1&&R&&De(R.enabled,L.options.isStock),Y=this.reserveSpace(),se=this.currentDataGrouping,$,ee,ae=!1;N&&!this.requireSorting&&(this.requireSorting=ae=!0);let fe=(n=this,m=H,!!(n.isCartesian&&!n.isDirty&&!n.xAxis.isDirty&&!n.yAxis.isDirty&&!m)||!N);if(ae&&(this.requireSorting=!1),fe)return;this.destroyGroupedData();let ve=R.groupAll?this.dataTable:this.dataTable.modified||this.dataTable,Te=this.getColumn("x",!R.groupAll),Ae=L.plotSizeX,Ve=this.xAxis,Ke=Ve.getExtremes(),Tt=Ve.options.ordinal,St=this.groupPixelWidth;if(St&&Te&&ve.rowCount&&Ae&&_e(Ke.min)){k=!0,this.isDirty=!0,this.points=null;let Mt=Ke.min,Nt=Ke.max,Rt=Tt&&Ve.ordinal&&Ve.ordinal.getGroupIntervalFactor(Mt,Nt,this)||1,$t=St*(Nt-Mt)/Ae*Rt,Ti=Ve.getTimeTicks(Im.Additions.prototype.normalizeTimeTickInterval($t,R.units||sy.units),Math.min(Mt,Te[0]),Math.max(Nt,Te[Te.length-1]),Ve.options.startOfWeek,Te,this.closestPointRange),hi=B.groupData.apply(this,[ve,Ti,R.approximation]),Ei=hi.modified,Ji=Ei.getColumn("x",!0),er=0;for(R!=null&&R.smoothed&&Ei.rowCount&&(R.firstAnchor="firstPoint",R.anchor="middle",R.lastAnchor="lastPoint",te(32,!1,L,{"dataGrouping.smoothed":"use dataGrouping.anchor"})),S=1;S<Ti.length;S++)Ti.info.segmentStarts&&Ti.info.segmentStarts.indexOf(S)!==-1||(er=Math.max(Ti[S]-Ti[S-1],er));($=Ti.info).gapSize=er,this.closestPointRange=Ti.info.totalRange,this.groupMap=hi.groupMap,this.currentDataGrouping=$,function(Is,Hs,qs){let dr=Is.options.dataGrouping,xr=Is.currentDataGrouping&&Is.currentDataGrouping.gapSize,wr=Is.getColumn("x");if(!(dr&&wr.length&&xr&&Is.groupMap))return;let io=Hs.length-1,sl=dr.anchor,Wo=dr.firstAnchor,qo=dr.lastAnchor,ko=Hs.length-1,no=0;if(Wo&&wr[0]>=Hs[0]){let $a;no++;let Fa=Is.groupMap[0].start,ul=Is.groupMap[0].length;_e(Fa)&&_e(ul)&&($a=Fa+(ul-1)),Hs[0]={start:Hs[0],middle:Hs[0]+.5*xr,end:Hs[0]+xr,firstPoint:wr[0],lastPoint:$a&&wr[$a]}[Wo]}if(io>0&&qo&&xr&&Hs[io]>=qs-xr){ko--;let $a=Is.groupMap[Is.groupMap.length-1].start;Hs[io]={start:Hs[io],middle:Hs[io]+.5*xr,end:Hs[io]+xr,firstPoint:$a&&wr[$a],lastPoint:wr[wr.length-1]}[qo]}if(sl&&sl!=="start"){let $a=xr*{middle:.5,end:1}[sl];for(;ko>=no;)Hs[ko]+=$a,ko--}}(this,Ji||[],Nt),Y&&Ji&&(re((x=Ji)[0])&&_e(Ve.min)&&_e(Ve.dataMin)&&x[0]<Ve.min&&((!re(Ve.options.min)&&Ve.min<=Ve.dataMin||Ve.min===Ve.dataMin)&&(Ve.min=Math.min(x[0],Ve.min)),Ve.dataMin=Math.min(x[0],Ve.dataMin)),re(x[x.length-1])&&_e(Ve.max)&&_e(Ve.dataMax)&&x[x.length-1]>Ve.max&&((!re(Ve.options.max)&&_e(Ve.dataMax)&&Ve.max>=Ve.dataMax||Ve.max===Ve.dataMax)&&(Ve.max=Math.max(x[x.length-1],Ve.max)),Ve.dataMax=Math.max(x[x.length-1],Ve.dataMax))),R.groupAll&&(this.allGroupedTable=Ei,Ji=(Ei=(ee=this.cropData(Ei,Ve.min||0,Ve.max||0)).modified).getColumn("x"),this.cropStart=ee.start),this.dataTable.modified=Ei}else this.groupMap=void 0,this.currentDataGrouping=void 0;this.hasGroupedData=k,this.preventGraphAnimation=(se&&se.totalRange)!==($&&$.totalRange)}function rt(){this.groupedData&&(this.groupedData.forEach(function(H,n){H&&(this.groupedData[n]=H.destroy?H.destroy():null)},this),this.groupedData.length=0,delete this.allGroupedTable)}function Yt(){Be.apply(this),this.destroyGroupedData(),this.groupedData=this.hasGroupedData?this.points:null}function Ut(){return this.is("arearange")?"range":this.is("ohlc")?"ohlc":this.is("hlc")?"hlc":this.is("column")||this.options.cumulative?"sum":"average"}function Xt(H,n,m){let x=H.getColumn("x",!0)||[],S=H.getColumn("y",!0),k=this,L=k.data,R=k.options&&k.options.data,N=[],Y=new ya,se=[],$=H.rowCount,ee=!!S,ae=[],fe=k.pointArrayMap,ve=fe&&fe.length,Te=["x"].concat(fe||["y"]),Ae=(fe||["y"]).map(()=>[]),Ve=this.options.dataGrouping&&this.options.dataGrouping.groupAll,Ke,Tt,St,Mt=0,Nt=0,Rt=typeof m=="function"?m:m&&kl[m]?kl[m]:kl[k.getDGApproximation&&k.getDGApproximation()||"average"];if(ve){let hi=fe.length;for(;hi--;)ae.push([])}else ae.push([]);let $t=ve||1;for(let hi=0;hi<=$;hi++)if(!(x[hi]<n[0])){for(;n[Mt+1]!==void 0&&x[hi]>=n[Mt+1]||hi===$;){if(Ke=n[Mt],k.dataGroupInfo={start:Ve?Nt:k.cropStart+Nt,length:ae[0].length,groupStart:Ke},St=Rt.apply(k,ae),k.pointClass&&!re(k.dataGroupInfo.options)&&(k.dataGroupInfo.options=Ee(k.pointClass.prototype.optionsToObject.call({series:k},k.options.data[k.cropStart+Nt])),Te.forEach(function(Ei){delete k.dataGroupInfo.options[Ei]})),St!==void 0){N.push(Ke);let Ei=Re(St);for(let Ji=0;Ji<Ei.length;Ji++)Ae[Ji].push(Ei[Ji]);se.push(k.dataGroupInfo)}Nt=hi;for(let Ei=0;Ei<$t;Ei++)ae[Ei].length=0,ae[Ei].hasNulls=!1;if(Mt+=1,hi===$)break}if(hi===$)break;if(fe){let Ei,Ji=Ve?hi:k.cropStart+hi,er=L&&L[Ji]||k.pointClass.prototype.applyOptions.apply({series:k},[R[Ji]]);for(let Is=0;Is<ve;Is++)_e(Ei=er[fe[Is]])?ae[Is].push(Ei):Ei===null&&(ae[Is].hasNulls=!0)}else _e(Tt=ee?S[hi]:null)?ae[0].push(Tt):Tt===null&&(ae[0].hasNulls=!0)}let Ti={x:N};return(fe||["y"]).forEach((hi,Ei)=>{Ti[hi]=Ae[Ei]}),Y.setColumns(Ti),{groupMap:se,modified:Y}}function Ci(H){let n=H.options,m=this.type,x=this.chart.options.plotOptions,S=this.useCommonDataGrouping&&sy.common,k=sy.seriesSpecific,L=ei.defaultOptions.plotOptions[m].dataGrouping;if(x&&(k[m]||S)){let R=this.chart.rangeSelector;L||(L=Ee(sy.common,k[m])),n.dataGrouping=Ee(S,L,x.series&&x.series.dataGrouping,x[m].dataGrouping,this.userOptions.dataGrouping,!n.isInternal&&R&&_e(R.selected)&&R.buttonOptions[R.selected].dataGrouping)}}let di={compose:function(H){let n=H.prototype;n.applyGrouping||(X(H.prototype.pointClass,"update",function(){if(this.dataGroup)return te(24,!1,this.series.chart),!1}),X(H,"afterSetOptions",Ci),X(H,"destroy",rt),pe(n,{applyGrouping:Ze,destroyGroupedData:rt,generatePoints:Yt,getDGApproximation:Ut,groupData:Xt}))},groupData:Xt},{format:vi}=ja,{composed:es}=fi,{addEvent:ws,extend:As,isNumber:$s,pick:kr,pushUnique:pr}=Gs;function Vr(H){var Te;let n=this.chart,m=n.time,x=H.point,S=x.series,k=S.options,L=S.tooltipOptions,R=k.dataGrouping,N=S.xAxis,Y=L.xDateFormat||"",se,$,ee,ae,fe,ve=L[H.isFooter?"footerFormat":"headerFormat"];if(N&&N.options.type==="datetime"&&R&&$s(x.key)){$=S.currentDataGrouping,ee=R.dateTimeLabelFormats||sy.common.dateTimeLabelFormats,$?(ae=ee[$.unitName],$.count===1?Y=ae[0]:(Y=ae[1],se=ae[2])):!Y&&ee&&N.dateTime&&(Y=N.dateTime.getXDateFormat(x.x,L.dateTimeLabelFormats));let Ae=kr((Te=S.groupMap)==null?void 0:Te[x.index].groupStart,x.key),Ve=Ae+(($==null?void 0:$.totalRange)||0)-1;fe=m.dateFormat(Y,Ae),se&&(fe+=m.dateFormat(se,Ve)),S.chart.styledMode&&(ve=this.styledModeFormat(ve)),H.text=vi(ve,{point:As(x,{key:fe}),series:S},n),H.preventDefault()}}let cr={compose:function(H,n,m){I.compose(H),di.compose(n),m&&pr(es,"DataGrouping")&&ws(m,"headerFormatter",Vr)},groupData:di.groupData};fi.dataGrouping=fi.dataGrouping||{},fi.dataGrouping.approximationDefaults=fi.dataGrouping.approximationDefaults||Oy,fi.dataGrouping.approximations=fi.dataGrouping.approximations||kl,cr.compose(fi.Axis,fi.Series,fi.Tooltip);let{defined:Zr,isNumber:Cn,pick:Qo}=Gs,{addEvent:en,isObject:uc,pick:gn,defined:va,merge:Fo}=Gs,{getAssignedAxis:Ao}={getAssignedAxis:function(H){return H.filter(n=>{let m=n.axis.getExtremes(),x=m.min,S=m.max,k=Qo(n.axis.minPointOffset,0);return Cn(x)&&Cn(S)&&n.value>=x-k&&n.value<=S+k&&!n.axis.options.isInternal})[0]}},oh=[],Ya={enabled:!0,sensitivity:1.1},El=H=>(uc(H)||(H={enabled:H??!0}),Fo(Ya,H)),Nh=function(H,n,m,x,S,k,L){let R=gn(L.type,H.zooming.type,""),N=[];R==="x"?N=m:R==="y"?N=x:R==="xy"&&(N=H.axes);let Y=H.transform({axes:N,to:{x:S-5,y:k-5,width:10,height:10},from:{x:S-5*n,y:k-5*n,width:10*n,height:10*n},trigger:"mousewheel"});return Y&&(va(a)&&clearTimeout(a),a=setTimeout(()=>{var se;(se=H.pointer)==null||se.drop()},400)),Y};function Tm(){let H=El(this.zooming.mouseWheel);H.enabled&&en(this.container,"wheel",n=>{var S,k;n=((S=this.pointer)==null?void 0:S.normalize(n))||n;let{pointer:m}=this,x=m&&!m.inClass(n.target,"highcharts-no-mousewheel");if(this.isInsidePlot(n.chartX-this.plotLeft,n.chartY-this.plotTop)&&x){let L=H.sensitivity||1.1,R=n.detail||(n.deltaY||0)/120,N=Ao(m.getCoordinates(n).xAxis),Y=Ao(m.getCoordinates(n).yAxis);Nh(this,Math.pow(L,R),N?[N.axis]:this.xAxis,Y?[Y.axis]:this.yAxis,n.chartX,n.chartY,H)&&((k=n.preventDefault)==null||k.call(n))}})}fi.MouseWheelZoom=fi.MouseWheelZoom||{compose:function(H){oh.indexOf(H)===-1&&(oh.push(H),en(H,"afterGetContainer",Tm))}},fi.MouseWheelZoom.compose(fi.Chart),fi.Navigator=fi.Navigator||dc,fi.OrdinalAxis=fi.OrdinalAxis||cp,fi.RangeSelector=fi.RangeSelector||Sy,fi.Scrollbar=fi.Scrollbar||Dp,fi.stockChart=fi.stockChart||Bx.stockChart,fi.StockChart=fi.StockChart||fi.stockChart,fi.extend(fi.StockChart,Bx),yt.compose(fi.Series,fi.Axis,fi.Point),ky.compose(fi.Renderer),Zm.compose(fi.Series),fi.Navigator.compose(fi.Chart,fi.Axis,fi.Series),fi.OrdinalAxis.compose(fi.Axis,fi.Series,fi.Chart),fi.RangeSelector.compose(fi.Axis,fi.Chart),fi.Scrollbar.compose(fi.Axis),fi.StockChart.compose(fi.Chart,fi.Axis,fi.Series,fi.SVGRenderer),fi.product="Highstock";let Fp=fi;return Qn.default})())}(Ev)),Ev.exports}$A();var Cv={exports:{}},qA=Cv.exports,Ow;function ZA(){return Ow||(Ow=1,function(ze,Je){(function(ot,Ht){ot._Highcharts=Ht(),ze.exports=ot._Highcharts})(typeof window>"u"?qA:window,()=>(()=>{var Yx;let ot,Ht,Qt;var ni,Vi,a,Ni,Ui,is,Xs,Qi,xs,zs,hs,_r,ar,Nr,Or,ir,fr,wo,rn,Pi,fo,pl,Cs,Da={};Da.d=(q,l)=>{for(var p in l)Da.o(l,p)&&!Da.o(q,p)&&Object.defineProperty(q,p,{enumerable:!0,get:l[p]})},Da.o=(q,l)=>Object.prototype.hasOwnProperty.call(q,l);var No={};Da.d(No,{default:()=>sy}),function(q){var l,p,y,T,A,P,I;q.SVG_NS="http://www.w3.org/2000/svg",q.product="Highcharts",q.version="12.3.0",q.win=typeof window<"u"?window:{},q.doc=q.win.document,q.svg=!!((y=(p=(l=q.doc)==null?void 0:l.createElementNS)==null?void 0:p.call(l,q.SVG_NS,"svg"))!=null&&y.createSVGRect),q.pageLang=(P=(A=(T=q.doc)==null?void 0:T.documentElement)==null?void 0:A.closest("[lang]"))==null?void 0:P.lang,q.userAgent=((I=q.win.navigator)==null?void 0:I.userAgent)||"",q.isChrome=q.win.chrome,q.isFirefox=q.userAgent.indexOf("Firefox")!==-1,q.isMS=/(edge|msie|trident)/i.test(q.userAgent)&&!q.win.opera,q.isSafari=!q.isChrome&&q.userAgent.indexOf("Safari")!==-1,q.isTouchDevice=/(Mobile|Android|Windows Phone)/.test(q.userAgent),q.isWebKit=q.userAgent.indexOf("AppleWebKit")!==-1,q.deg2rad=2*Math.PI/360,q.marginNames=["plotTop","marginRight","marginBottom","plotLeft"],q.noop=function(){},q.supportsPassiveEvents=function(){let B=!1;if(!q.isMS){let X=Object.defineProperty({},"passive",{get:function(){B=!0}});q.win.addEventListener&&q.win.removeEventListener&&(q.win.addEventListener("testPassive",q.noop,X),q.win.removeEventListener("testPassive",q.noop,X))}return B}(),q.charts=[],q.composed=[],q.dateFormats={},q.seriesTypes={},q.symbolSizes={},q.chartCount=0}(ni||(ni={}));let pi=ni,{charts:on,doc:Io,win:Qn}=pi;function fi(q,l,p,y){let T=l?"Highcharts error":"Highcharts warning";q===32&&(q=`${T}: Deprecated member`);let A=Lo(q),P=A?`${T} #${q}: www.highcharts.com/errors/${q}/`:q.toString();if(y!==void 0){let I="";A&&(P+="?"),_l(y,function(B,X){I+=`
 - ${X}: ${B}`,A&&(P+=encodeURI(X)+"="+encodeURI(B))}),P+=I}Lc(pi,"displayError",{chart:p,code:q,message:P,params:y},function(){if(l)throw Error(P);Qn.console&&fi.messages.indexOf(P)===-1&&console.warn(P)}),fi.messages.push(P)}function xl(q,l){return parseInt(q,l||10)}function gr(q){return typeof q=="string"}function Kn(q){let l=Object.prototype.toString.call(q);return l==="[object Array]"||l==="[object Array Iterator]"}function za(q,l){return!!q&&typeof q=="object"&&(!l||!Kn(q))}function Na(q){return za(q)&&typeof q.nodeType=="number"}function Pl(q){let l=q==null?void 0:q.constructor;return!!(za(q,!0)&&!Na(q)&&(l!=null&&l.name)&&l.name!=="Object")}function Lo(q){return typeof q=="number"&&!isNaN(q)&&q<1/0&&q>-1/0}function Zo(q){return q!=null}function pa(q,l,p){let y,T=gr(l)&&!Zo(p),A=(P,I)=>{Zo(P)?q.setAttribute(I,P):T?(y=q.getAttribute(I))||I!=="class"||(y=q.getAttribute(I+"Name")):q.removeAttribute(I)};return gr(l)?A(p,l):_l(l,A),y}function Ul(q){return Kn(q)?q:[q]}function mo(q,l){let p;for(p in q||(q={}),l)q[p]=l[p];return q}function ql(){let q=arguments,l=q.length;for(let p=0;p<l;p++){let y=q[p];if(y!=null)return y}}function Sh(q,l){mo(q.style,l)}function Wh(q){return Math.pow(10,Math.floor(Math.log(q)/Math.LN10))}function Qs(q,l){return q>1e14?q:parseFloat(q.toPrecision(l||14))}(fi||(fi={})).messages=[],Math.easeInOutSine=function(q){return-.5*(Math.cos(Math.PI*q)-1)};let Ic=Array.prototype.find?function(q,l){return q.find(l)}:function(q,l){let p,y=q.length;for(p=0;p<y;p++)if(l(q[p],p))return q[p]};function _l(q,l,p){for(let y in q)Object.hasOwnProperty.call(q,y)&&l.call(p||q[y],q[y],y,q)}function qa(q,l,p){function y(P,I){let B=q.removeEventListener;B&&B.call(q,P,I,!1)}function T(P){let I,B;q.nodeName&&(l?(I={})[l]=!0:I=P,_l(I,function(X,re){if(P[re])for(B=P[re].length;B--;)y(re,P[re][B].fn)}))}let A=typeof q=="function"&&q.prototype||q;if(Object.hasOwnProperty.call(A,"hcEvents")){let P=A.hcEvents;if(l){let I=P[l]||[];p?(P[l]=I.filter(function(B){return p!==B.fn}),y(l,p)):(T(P),P[l]=[])}else T(P),delete A.hcEvents}}function Lc(q,l,p,y){if(p=p||{},(Io==null?void 0:Io.createEvent)&&(q.dispatchEvent||q.fireEvent&&q!==pi)){let T=Io.createEvent("Events");T.initEvent(l,!0,!0),p=mo(T,p),q.dispatchEvent?q.dispatchEvent(p):q.fireEvent(l,p)}else if(q.hcEvents){p.target||mo(p,{preventDefault:function(){p.defaultPrevented=!0},target:q,type:l});let T=[],A=q,P=!1;for(;A.hcEvents;)Object.hasOwnProperty.call(A,"hcEvents")&&A.hcEvents[l]&&(T.length&&(P=!0),T.unshift.apply(T,A.hcEvents[l])),A=Object.getPrototypeOf(A);P&&T.sort((I,B)=>I.order-B.order),T.forEach(I=>{I.fn.call(q,p)===!1&&p.preventDefault()})}y&&!p.defaultPrevented&&y.call(q,p)}let wd=function(){let q=Math.random().toString(36).substring(2,9)+"-",l=0;return function(){return"highcharts-"+(ot?"":q)+l++}}();Qn.jQuery&&(Qn.jQuery.fn.highcharts=function(){let q=[].slice.call(arguments);if(this[0])return q[0]?(new pi[gr(q[0])?q.shift():"Chart"](this[0],q[0],q[1]),this):on[pa(this[0],"data-highcharts-chart")]});let Ps={addEvent:function(q,l,p,y={}){let T=typeof q=="function"&&q.prototype||q;Object.hasOwnProperty.call(T,"hcEvents")||(T.hcEvents={});let A=T.hcEvents;pi.Point&&q instanceof pi.Point&&q.series&&q.series.chart&&(q.series.chart.runTrackerClick=!0);let P=q.addEventListener;P&&P.call(q,l,p,!!pi.supportsPassiveEvents&&{passive:y.passive===void 0?l.indexOf("touch")!==-1:y.passive,capture:!1}),A[l]||(A[l]=[]);let I={fn:p,order:typeof y.order=="number"?y.order:1/0};return A[l].push(I),A[l].sort((B,X)=>B.order-X.order),function(){qa(q,l,p)}},arrayMax:function(q){let l=q.length,p=q[0];for(;l--;)q[l]>p&&(p=q[l]);return p},arrayMin:function(q){let l=q.length,p=q[0];for(;l--;)q[l]<p&&(p=q[l]);return p},attr:pa,clamp:function(q,l,p){return q>l?q<p?q:p:l},clearTimeout:function(q){Zo(q)&&clearTimeout(q)},correctFloat:Qs,createElement:function(q,l,p,y,T){let A=Io.createElement(q);return l&&mo(A,l),T&&Sh(A,{padding:"0",border:"none",margin:"0"}),p&&Sh(A,p),y&&y.appendChild(A),A},crisp:function(q,l=0,p){let y=l%2/2,T=p?-1:1;return(Math.round(q*T-y)+y)*T},css:Sh,defined:Zo,destroyObjectProperties:function(q,l,p){_l(q,function(y,T){y!==l&&(y!=null&&y.destroy)&&y.destroy(),(y!=null&&y.destroy||!p)&&delete q[T]})},diffObjects:function(q,l,p,y){let T={};return function A(P,I,B,X){let re=p?I:P;_l(P,function(te,pe){if(!X&&y&&y.indexOf(pe)>-1&&I[pe]){te=Ul(te),B[pe]=[];for(let _e=0;_e<Math.max(te.length,I[pe].length);_e++)I[pe][_e]&&(te[_e]===void 0?B[pe][_e]=I[pe][_e]:(B[pe][_e]={},A(te[_e],I[pe][_e],B[pe][_e],X+1)))}else za(te,!0)&&!te.nodeType?(B[pe]=Kn(te)?[]:{},A(te,I[pe]||{},B[pe],X+1),Object.keys(B[pe]).length===0&&(pe!=="colorAxis"||X!==0)&&delete B[pe]):(P[pe]!==I[pe]||pe in P&&!(pe in I))&&pe!=="__proto__"&&pe!=="constructor"&&(B[pe]=re[pe])})}(q,l,T,0),T},discardElement:function(q){var l;(l=q==null?void 0:q.parentElement)==null||l.removeChild(q)},erase:function(q,l){let p=q.length;for(;p--;)if(q[p]===l){q.splice(p,1);break}},error:fi,extend:mo,extendClass:function(q,l){let p=function(){};return p.prototype=new q,mo(p.prototype,l),p},find:Ic,fireEvent:Lc,getAlignFactor:(q="")=>({center:.5,right:1,middle:.5,bottom:1})[q]||0,getClosestDistance:function(q,l){let p,y,T,A=!l;return q.forEach(P=>{if(P.length>1)for(T=P.length-1;T>0;T--)(y=P[T]-P[T-1])<0&&!A?(l==null||l(),l=void 0):y&&(p===void 0||y<p)&&(p=y)}),p},getMagnitude:Wh,getNestedProperty:function(q,l){let p=q.split(".");for(;p.length&&Zo(l);){let y=p.shift();if(y===void 0||y==="__proto__")return;if(y==="this"){let A;return za(l)&&(A=l["@this"]),A??l}let T=l[y.replace(/[\\'"]/g,"")];if(!Zo(T)||typeof T=="function"||typeof T.nodeType=="number"||T===Qn)return;l=T}return l},getStyle:function q(l,p,y){var P;let T;if(p==="width"){let I=Math.min(l.offsetWidth,l.scrollWidth),B=(P=l.getBoundingClientRect)==null?void 0:P.call(l).width;return B<I&&B>=I-1&&(I=Math.floor(B)),Math.max(0,I-(q(l,"padding-left",!0)||0)-(q(l,"padding-right",!0)||0))}if(p==="height")return Math.max(0,Math.min(l.offsetHeight,l.scrollHeight)-(q(l,"padding-top",!0)||0)-(q(l,"padding-bottom",!0)||0));let A=Qn.getComputedStyle(l,void 0);return A&&(T=A.getPropertyValue(p),ql(y,p!=="opacity")&&(T=xl(T))),T},insertItem:function(q,l){let p,y=q.options.index,T=l.length;for(p=q.options.isInternal?T:0;p<T+1;p++)if(!l[p]||Lo(y)&&y<ql(l[p].options.index,l[p]._i)||l[p].options.isInternal){l.splice(p,0,q);break}return p},isArray:Kn,isClass:Pl,isDOMElement:Na,isFunction:function(q){return typeof q=="function"},isNumber:Lo,isObject:za,isString:gr,merge:function(q,...l){let p,y=[q,...l],T={},A=function(I,B){return typeof I!="object"&&(I={}),_l(B,function(X,re){re!=="__proto__"&&re!=="constructor"&&(!za(X,!0)||Pl(X)||Na(X)?I[re]=B[re]:I[re]=A(I[re]||{},X))}),I};q===!0&&(T=y[1],y=Array.prototype.slice.call(y,2));let P=y.length;for(p=0;p<P;p++)T=A(T,y[p]);return T},normalizeTickInterval:function(q,l,p,y,T){let A,P=q;p=ql(p,Wh(q));let I=q/p;for(!l&&(l=T?[1,1.2,1.5,2,2.5,3,4,5,6,8,10]:[1,2,2.5,5,10],y===!1&&(p===1?l=l.filter(function(B){return B%1==0}):p<=.1&&(l=[1/p]))),A=0;A<l.length&&(P=l[A],(!T||!(P*p>=q))&&(T||!(I<=(l[A]+(l[A+1]||l[A]))/2)));A++);return Qs(P*p,-Math.round(Math.log(.001)/Math.LN10))},objectEach:_l,offset:function(q){let l=Io.documentElement,p=q.parentElement||q.parentNode?q.getBoundingClientRect():{top:0,left:0,width:0,height:0};return{top:p.top+(Qn.pageYOffset||l.scrollTop)-(l.clientTop||0),left:p.left+(Qn.pageXOffset||l.scrollLeft)-(l.clientLeft||0),width:p.width,height:p.height}},pad:function(q,l,p){return Array((l||2)+1-String(q).replace("-","").length).join(p||"0")+q},pick:ql,pInt:xl,pushUnique:function(q,l){return 0>q.indexOf(l)&&!!q.push(l)},relativeLength:function(q,l,p){return/%$/.test(q)?l*parseFloat(q)/100+(p||0):parseFloat(q)},removeEvent:qa,replaceNested:function(q,...l){let p,y;do for(y of(p=q,l))q=q.replace(y[0],y[1]);while(q!==p);return q},splat:Ul,stableSort:function(q,l){let p,y,T=q.length;for(y=0;y<T;y++)q[y].safeI=y;for(q.sort(function(A,P){return(p=l(A,P))===0?A.safeI-P.safeI:p}),y=0;y<T;y++)delete q[y].safeI},syncTimeout:function(q,l,p){return l>0?setTimeout(q,l,p):(q.call(0,p),-1)},timeUnits:{millisecond:1,second:1e3,minute:6e4,hour:36e5,day:864e5,week:6048e5,month:24192e5,year:314496e5},ucfirst:function(q){return gr(q)?q.substring(0,1).toUpperCase()+q.substring(1):String(q)},uniqueKey:wd,useSerialIds:function(q){return ot=ql(q,ot)},wrap:function(q,l,p){let y=q[l];q[l]=function(){let T=arguments,A=this;return p.apply(this,[function(){return y.apply(A,arguments.length?arguments:T)}].concat([].slice.call(arguments)))}}},{pageLang:nl,win:jl}=pi,{defined:Kc,error:Gs,extend:zn,isNumber:Gl,isObject:fc,isString:al,merge:Gd,objectEach:Oc,pad:mh,splat:ll,timeUnits:Mh,ucfirst:Sa}=Ps,Wl=pi.isSafari&&jl.Intl&&!jl.Intl.DateTimeFormat.prototype.formatRange,Tu=q=>q.main===void 0,Jc=class{constructor(q,l){this.options={timezone:"UTC"},this.variableTimezone=!1,this.Date=jl.Date,this.update(q),this.lang=l}update(q={}){this.dTLCache={},this.options=q=Gd(!0,this.options,q);let{timezoneOffset:l,useUTC:p,locale:y}=q;this.Date=q.Date||jl.Date||Date;let T=q.timezone;Kc(p)&&(T=p?"UTC":void 0),l&&l%60==0&&(T="Etc/GMT"+(l>0?"+":"")+l/60),this.variableTimezone=T!=="UTC"&&(T==null?void 0:T.indexOf("Etc/GMT"))!==0,this.timezone=T,this.lang&&y&&(this.lang.locale=y),["months","shortMonths","weekdays","shortWeekdays"].forEach(A=>{let P=/months/i.test(A),I=/short/.test(A),B={timeZone:"UTC"};B[P?"month":"weekday"]=I?"short":"long",this[A]=(P?[0,1,2,3,4,5,6,7,8,9,10,11]:[3,4,5,6,7,8,9]).map(X=>this.dateFormat(B,(P?31:1)*24*36e5*X))})}toParts(q){let[l,p,y,T,A,P,I]=this.dateTimeFormat({weekday:"narrow",day:"numeric",month:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},q,"es").split(/(?:, | |\/|:)/g);return[T,y-1,p,A,P,I,Math.floor(Number(q)||0)%1e3,"DLMXJVS".indexOf(l)].map(Number)}dateTimeFormat(q,l,p=this.options.locale||nl){let y=JSON.stringify(q)+p;al(q)&&(q=this.str2dtf(q));let T=this.dTLCache[y];if(!T){q.timeZone??(q.timeZone=this.timezone);try{T=new Intl.DateTimeFormat(p,q)}catch(A){/Invalid time zone/i.test(A.message)?(Gs(34),q.timeZone="UTC",T=new Intl.DateTimeFormat(p,q)):Gs(A.message,!1)}}return this.dTLCache[y]=T,(T==null?void 0:T.format(l))||""}str2dtf(q,l={}){let p={L:{fractionalSecondDigits:3},S:{second:"2-digit"},M:{minute:"numeric"},H:{hour:"2-digit"},k:{hour:"numeric"},E:{weekday:"narrow"},a:{weekday:"short"},A:{weekday:"long"},d:{day:"2-digit"},e:{day:"numeric"},b:{month:"short"},B:{month:"long"},m:{month:"2-digit"},o:{month:"numeric"},y:{year:"2-digit"},Y:{year:"numeric"}};return Object.keys(p).forEach(y=>{q.indexOf(y)!==-1&&zn(l,p[y])}),l}makeTime(q,l,p=1,y=0,T,A,P){let I=this.Date.UTC(q,l,p,y,T||0,A||0,P||0);if(this.timezone!=="UTC"){let B=this.getTimezoneOffset(I);if(I+=B,[2,3,8,9,10,11].indexOf(l)!==-1&&(y<5||y>20)){let X=this.getTimezoneOffset(I);B!==X?I+=X-B:B-36e5!==this.getTimezoneOffset(I-36e5)||Wl||(I-=36e5)}}return I}parse(q){if(!al(q))return q??void 0;let l=(q=q.replace(/\//g,"-").replace(/(GMT|UTC)/,"")).indexOf("Z")>-1||/([+-][0-9]{2}):?[0-9]{2}$/.test(q),p=/^[0-9]{4}-[0-9]{2}(-[0-9]{2}|)$/.test(q);l||p||(q+="Z");let y=Date.parse(q);if(Gl(y))return y+(!l||p?this.getTimezoneOffset(y):0)}getTimezoneOffset(q){if(this.timezone!=="UTC"){let[l,p,y,T,A=0]=this.dateTimeFormat({timeZoneName:"shortOffset"},q,"en").split(/(GMT|:)/).map(Number),P=-(60*(y+A/60)*6e4);if(Gl(P))return P}return 0}dateFormat(q,l,p){let y=this.lang;if(!Kc(l)||isNaN(l))return(y==null?void 0:y.invalidDate)||"";if(al(q=q??"%Y-%m-%d %H:%M:%S")){let T,A=/%\[([a-zA-Z]+)\]/g;for(;T=A.exec(q);)q=q.replace(T[0],this.dateTimeFormat(T[1],l,y==null?void 0:y.locale))}if(al(q)&&q.indexOf("%")!==-1){let T=this,[A,P,I,B,X,re,te,pe]=this.toParts(l),_e=(y==null?void 0:y.weekdays)||this.weekdays,Ee=(y==null?void 0:y.shortWeekdays)||this.shortWeekdays,De=(y==null?void 0:y.months)||this.months,Re=(y==null?void 0:y.shortMonths)||this.shortMonths;Oc(zn({a:Ee?Ee[pe]:_e[pe].substr(0,3),A:_e[pe],d:mh(I),e:mh(I,2," "),w:pe,v:(y==null?void 0:y.weekFrom)??"",b:Re[P],B:De[P],m:mh(P+1),o:P+1,y:A.toString().substr(2,2),Y:A,H:mh(B),k:B,I:mh(B%12||12),l:B%12||12,M:mh(X),p:B<12?"AM":"PM",P:B<12?"am":"pm",S:mh(re),L:mh(te,3)},pi.dateFormats),function(Be,Ze){if(al(q))for(;q.indexOf("%"+Ze)!==-1;)q=q.replace("%"+Ze,typeof Be=="function"?Be.call(T,l):Be)})}else if(fc(q)){let T=(this.getTimezoneOffset(l)||0)/36e5,A=this.timezone||"Etc/GMT"+(T>=0?"+":"")+T,{prefix:P="",suffix:I=""}=q;q=P+this.dateTimeFormat(zn({timeZone:A},q),l)+I}return p?Sa(q):q}resolveDTLFormat(q){return fc(q,!0)?fc(q,!0)&&Tu(q)?{main:q}:q:{main:(q=ll(q))[0],from:q[1],to:q[2]}}getDateFormat(q,l,p,y){let T=this.dateFormat("%m-%d %H:%M:%S.%L",l),A="01-01 00:00:00.000",P={millisecond:15,second:12,minute:9,hour:6,day:3},I="millisecond",B=I;for(I in Mh){if(q&&q===Mh.week&&+this.dateFormat("%w",l)===p&&T.substr(6)===A.substr(6)){I="week";break}if(q&&Mh[I]>q){I=B;break}if(P[I]&&T.substr(P[I])!==A.substr(P[I]))break;I!=="week"&&(B=I)}return this.resolveDTLFormat(y[I]).main}},{defined:Td,extend:To,timeUnits:Rn}=Ps,Za=class extends Jc{getTimeTicks(q,l,p,y){let T=this,A=[],P={},{count:I=1,unitRange:B}=q,[X,re,te,pe,_e,Ee]=T.toParts(l),De=(l||0)%1e3,Re;if(y??(y=1),Td(l)){if(De=B>=Rn.second?0:I*Math.floor(De/I),B>=Rn.second&&(Ee=B>=Rn.minute?0:I*Math.floor(Ee/I)),B>=Rn.minute&&(_e=B>=Rn.hour?0:I*Math.floor(_e/I)),B>=Rn.hour&&(pe=B>=Rn.day?0:I*Math.floor(pe/I)),B>=Rn.day&&(te=B>=Rn.month?1:Math.max(1,I*Math.floor(te/I))),B>=Rn.month&&(re=B>=Rn.year?0:I*Math.floor(re/I)),B>=Rn.year&&(X-=X%I),B===Rn.week){I&&(l=T.makeTime(X,re,te,pe,_e,Ee,De));let rt=this.dateTimeFormat({timeZone:this.timezone,weekday:"narrow"},l,"es"),Yt="DLMXJVS".indexOf(rt);te+=-Yt+y+(Yt<y?-7:0)}l=T.makeTime(X,re,te,pe,_e,Ee,De),T.variableTimezone&&Td(p)&&(Re=p-l>4*Rn.month||T.getTimezoneOffset(l)!==T.getTimezoneOffset(p));let Be=l,Ze=1;for(;Be<p;)A.push(Be),B===Rn.year?Be=T.makeTime(X+Ze*I,0):B===Rn.month?Be=T.makeTime(X,re+Ze*I):Re&&(B===Rn.day||B===Rn.week)?Be=T.makeTime(X,re,te+Ze*I*(B===Rn.day?1:7)):Re&&B===Rn.hour&&I>1?Be=T.makeTime(X,re,te,pe+Ze*I):Be+=B*I,Ze++;A.push(Be),B<=Rn.hour&&A.length<1e4&&A.forEach(rt=>{rt%18e5==0&&T.dateFormat("%H%M%S%L",rt)==="000000000"&&(P[rt]="day")})}return A.info=To(q,{higherRanks:P,totalRange:B*I}),A}},{isTouchDevice:Hl}=pi,{fireEvent:mc,merge:Va}=Ps,Zl={colors:["#2caffe","#544fc5","#00e272","#fe6a35","#6b8abc","#d568fb","#2ee0ca","#fa4b42","#feb56a","#91e8e1"],symbols:["circle","diamond","square","triangle","triangle-down"],lang:{weekFrom:"week from",chartTitle:"Chart title",locale:void 0,loading:"Loading...",months:void 0,seriesName:"Series {add index 1}",shortMonths:void 0,weekdays:void 0,numericSymbols:["k","M","G","T","P","E"],pieSliceName:"Slice",resetZoom:"Reset zoom",yAxisTitle:"Values",resetZoomTitle:"Reset zoom level 1:1"},global:{buttonTheme:{fill:"#f7f7f7",padding:8,r:2,stroke:"#cccccc","stroke-width":1,style:{color:"#333333",cursor:"pointer",fontSize:"0.8em",fontWeight:"normal"},states:{hover:{fill:"#e6e6e6"},select:{fill:"#e6e9ff",style:{color:"#000000",fontWeight:"bold"}},disabled:{style:{color:"#cccccc"}}}}},time:{Date:void 0,timezone:"UTC",timezoneOffset:0,useUTC:void 0},chart:{alignThresholds:!1,panning:{enabled:!1,type:"x"},styledMode:!1,borderRadius:0,colorCount:10,allowMutatingData:!0,ignoreHiddenSeries:!0,spacing:[10,10,15,10],resetZoomButton:{theme:{},position:{}},reflow:!0,type:"line",zooming:{singleTouch:!1,resetButton:{theme:{zIndex:6},position:{align:"right",x:-10,y:10}}},width:null,height:null,borderColor:"#334eff",backgroundColor:"#ffffff",plotBorderColor:"#cccccc"},title:{style:{color:"#333333",fontWeight:"bold"},text:"Chart title",margin:15,minScale:.67},subtitle:{style:{color:"#666666",fontSize:"0.8em"},text:""},caption:{margin:15,style:{color:"#666666",fontSize:"0.8em"},text:"",align:"left",verticalAlign:"bottom"},plotOptions:{},legend:{enabled:!0,align:"center",alignColumns:!0,className:"highcharts-no-tooltip",events:{},layout:"horizontal",itemMarginBottom:2,itemMarginTop:2,labelFormatter:function(){return this.name},borderColor:"#999999",borderRadius:0,navigation:{style:{fontSize:"0.8em"},activeColor:"#0022ff",inactiveColor:"#cccccc"},itemStyle:{color:"#333333",cursor:"pointer",fontSize:"0.8em",textDecoration:"none",textOverflow:"ellipsis"},itemHoverStyle:{color:"#000000"},itemHiddenStyle:{color:"#666666",textDecoration:"line-through"},shadow:!1,itemCheckboxStyle:{position:"absolute",width:"13px",height:"13px"},squareSymbol:!0,symbolPadding:5,verticalAlign:"bottom",x:0,y:0,title:{style:{color:"#333333",fontSize:"0.8em",fontWeight:"bold"}}},loading:{labelStyle:{fontWeight:"bold",position:"relative",top:"45%"},style:{position:"absolute",backgroundColor:"#ffffff",opacity:.5,textAlign:"center"}},tooltip:{enabled:!0,animation:{duration:300,easing:q=>Math.sqrt(1-Math.pow(q-1,2))},borderRadius:3,dateTimeLabelFormats:{millisecond:"%[AebHMSL]",second:"%[AebHMS]",minute:"%[AebHM]",hour:"%[AebHM]",day:"%[AebY]",week:"%v %[AebY]",month:"%[BY]",year:"%Y"},footerFormat:"",headerShape:"callout",hideDelay:500,padding:8,position:{x:0,y:3},shared:!1,snap:Hl?25:10,headerFormat:'<span style="font-size: 0.8em">{ucfirst point.key}</span><br/>',pointFormat:'<span style="color:{point.color}">●</span> {series.name}: <b>{point.y}</b><br/>',backgroundColor:"#ffffff",borderWidth:void 0,stickOnContact:!1,style:{color:"#333333",cursor:"default",fontSize:"0.8em"},useHTML:!1},credits:{enabled:!0,href:"https://www.highcharts.com?credits",position:{align:"right",x:-10,verticalAlign:"bottom",y:-5},style:{cursor:"pointer",color:"#999999",fontSize:"0.6em"},text:"Highcharts.com"}},Wi=new Za(Zl.time,Zl.lang),Ra={defaultOptions:Zl,defaultTime:Wi,getOptions:function(){return Zl},setOptions:function(q){var l;return mc(pi,"setOptions",{options:q}),Va(!0,Zl,q),q.time&&Wi.update(Zl.time),q.lang&&"locale"in q.lang&&Wi.update({locale:q.lang.locale}),(l=q.lang)!=null&&l.chartTitle&&(Zl.title={...Zl.title,text:q.lang.chartTitle}),Zl}},{win:pp}=pi,{isNumber:vl,isString:lr,merge:ei,pInt:Oe,defined:We}=Ps,ct=(q,l,p)=>`color-mix(in srgb,${q},${l} ${100*p}%)`,Et=q=>lr(q)&&!!q&&q!=="none";class at{static parse(l){return l?new at(l):at.None}constructor(l){let p,y,T,A;this.rgba=[NaN,NaN,NaN,NaN],this.input=l;let P=pi.Color;if(P&&P!==at)return new P(l);if(typeof l=="object"&&l.stops!==void 0)this.stops=l.stops.map(I=>new at(I[1]));else if(typeof l=="string")for(this.input=l=at.names[l.toLowerCase()]||l,T=at.parsers.length;T--&&!y;)(p=(A=at.parsers[T]).regex.exec(l))&&(y=A.parse(p));y&&(this.rgba=y)}get(l){let p=this.input,y=this.rgba;if(this.output)return this.output;if(typeof p=="object"&&this.stops!==void 0){let T=ei(p);return T.stops=[].slice.call(T.stops),this.stops.forEach((A,P)=>{T.stops[P]=[T.stops[P][0],A.get(l)]}),T}return y&&vl(y[0])?l!=="rgb"&&(l||y[3]!==1)?l==="a"?`${y[3]}`:"rgba("+y.join(",")+")":"rgb("+y[0]+","+y[1]+","+y[2]+")":p}brighten(l){let p=this.rgba;if(this.stops)this.stops.forEach(function(y){y.brighten(l)});else if(vl(l)&&l!==0)if(vl(p[0]))for(let y=0;y<3;y++)p[y]+=Oe(255*l),p[y]<0&&(p[y]=0),p[y]>255&&(p[y]=255);else at.useColorMix&&Et(this.input)&&(this.output=ct(this.input,l>0?"white":"black",Math.abs(l)));return this}setOpacity(l){return this.rgba[3]=l,this}tweenTo(l,p){let y=this.rgba,T=l.rgba;if(!vl(y[0])||!vl(T[0]))return at.useColorMix&&Et(this.input)&&Et(l.input)&&p<.99?ct(this.input,l.input,p):l.input||"none";let A=T[3]!==1||y[3]!==1,P=(B,X)=>B+(y[X]-B)*(1-p),I=T.slice(0,3).map(P).map(Math.round);return A&&I.push(P(T[3],3)),(A?"rgba(":"rgb(")+I.join(",")+")"}}at.names={white:"#ffffff",black:"#000000"},at.parsers=[{regex:/rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d?(?:\.\d+)?)\s*\)/,parse:function(q){return[Oe(q[1]),Oe(q[2]),Oe(q[3]),parseFloat(q[4],10)]}},{regex:/rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/,parse:function(q){return[Oe(q[1]),Oe(q[2]),Oe(q[3]),1]}},{regex:/^#([a-f0-9])([a-f0-9])([a-f0-9])([a-f0-9])?$/i,parse:function(q){return[Oe(q[1]+q[1],16),Oe(q[2]+q[2],16),Oe(q[3]+q[3],16),We(q[4])?Oe(q[4]+q[4],16)/255:1]}},{regex:/^#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})?$/i,parse:function(q){return[Oe(q[1],16),Oe(q[2],16),Oe(q[3],16),We(q[4])?Oe(q[4],16)/255:1]}}],at.useColorMix=(Yx=pp.CSS)==null?void 0:Yx.supports("color","color-mix(in srgb,red,blue 9%)"),at.None=new at("");let{parse:zt}=at,{win:oi}=pi,{isNumber:jt,objectEach:qt}=Ps;class gi{constructor(l,p,y){this.pos=NaN,this.options=p,this.elem=l,this.prop=y}dSetter(){let l=this.paths,p=l==null?void 0:l[0],y=l==null?void 0:l[1],T=this.now||0,A=[];if(T!==1&&p&&y)if(p.length===y.length&&T<1)for(let P=0;P<y.length;P++){let I=p[P],B=y[P],X=[];for(let re=0;re<B.length;re++){let te=I[re],pe=B[re];jt(te)&&jt(pe)&&(B[0]!=="A"||re!==4&&re!==5)?X[re]=te+T*(pe-te):X[re]=pe}A.push(X)}else A=y;else A=this.toD||[];this.elem.attr("d",A,void 0,!0)}update(){let l=this.elem,p=this.prop,y=this.now,T=this.options.step;this[p+"Setter"]?this[p+"Setter"]():l.attr?l.element&&l.attr(p,y,null,!0):l.style[p]=y+this.unit,T&&T.call(l,y,this)}run(l,p,y){let T=this,A=T.options,P=function(X){return!P.stopped&&T.step(X)},I=oi.requestAnimationFrame||function(X){setTimeout(X,13)},B=function(){for(let X=0;X<gi.timers.length;X++)gi.timers[X]()||gi.timers.splice(X--,1);gi.timers.length&&I(B)};l!==p||this.elem["forceAnimate:"+this.prop]?(this.startTime=+new Date,this.start=l,this.end=p,this.unit=y,this.now=this.start,this.pos=0,P.elem=this.elem,P.prop=this.prop,P()&&gi.timers.push(P)===1&&I(B)):(delete A.curAnim[this.prop],A.complete&&Object.keys(A.curAnim).length===0&&A.complete.call(this.elem))}step(l){let p,y,T=+new Date,A=this.options,P=this.elem,I=A.complete,B=A.duration,X=A.curAnim;return P.attr&&!P.element?p=!1:l||T>=B+this.startTime?(this.now=this.end,this.pos=1,this.update(),X[this.prop]=!0,y=!0,qt(X,function(re){re!==!0&&(y=!1)}),y&&I&&I.call(P),p=!1):(this.pos=A.easing((T-this.startTime)/B),this.now=this.start+(this.end-this.start)*this.pos,this.update(),p=!0),p}initPath(l,p,y){let T=l.startX,A=l.endX,P=y.slice(),I=l.isArea,B=I?2:1,X=p&&y.length>p.length&&y.hasStackedCliffs,re,te,pe,_e,Ee=p==null?void 0:p.slice();if(!Ee||X)return[P,P];function De(Be,Ze){for(;Be.length<te;){let rt=Be[0],Yt=Ze[te-Be.length];if(Yt&&rt[0]==="M"&&(Yt[0]==="C"?Be[0]=["C",rt[1],rt[2],rt[1],rt[2],rt[1],rt[2]]:Be[0]=["L",rt[1],rt[2]]),Be.unshift(rt),I){let Ut=Be.pop();Be.push(Be[Be.length-1],Ut)}}}function Re(Be){for(;Be.length<te;){let Ze=Be[Math.floor(Be.length/B)-1].slice();if(Ze[0]==="C"&&(Ze[1]=Ze[5],Ze[2]=Ze[6]),I){let rt=Be[Math.floor(Be.length/B)].slice();Be.splice(Be.length/2,0,Ze,rt)}else Be.push(Ze)}}if(T&&A&&A.length){for(pe=0;pe<T.length;pe++)if(T[pe]===A[0]){re=pe;break}else if(T[0]===A[A.length-T.length+pe]){re=pe,_e=!0;break}else if(T[T.length-1]===A[A.length-T.length+pe]){re=T.length-pe;break}re===void 0&&(Ee=[])}return Ee.length&&jt(re)&&(te=P.length+re*B,_e?(De(Ee,P),Re(P)):(De(P,Ee),Re(Ee))),[Ee,P]}fillSetter(){gi.prototype.strokeSetter.apply(this,arguments)}strokeSetter(){this.elem.attr(this.prop,zt(this.start).tweenTo(zt(this.end),this.pos),void 0,!0)}}gi.timers=[];let{defined:li,getStyle:Zi,isArray:Ss,isNumber:ds,isObject:Ws,merge:mr,objectEach:vr,pick:Rr}=Ps;function Ar(q){return Ws(q)?mr({duration:500,defer:0},q):{duration:500*!!q,defer:0}}function Ko(q,l){let p=gi.timers.length;for(;p--;)gi.timers[p].elem!==q||l&&l!==gi.timers[p].prop||(gi.timers[p].stopped=!0)}let to={animate:function(q,l,p){let y,T="",A,P,I;Ws(p)||(I=arguments,p={duration:I[2],easing:I[3],complete:I[4]}),ds(p.duration)||(p.duration=400),p.easing=typeof p.easing=="function"?p.easing:Math[p.easing]||Math.easeInOutSine,p.curAnim=mr(l),vr(l,function(B,X){Ko(q,X),P=new gi(q,p,X),A=void 0,X==="d"&&Ss(l.d)?(P.paths=P.initPath(q,q.pathArray,l.d),P.toD=l.d,y=0,A=1):q.attr?y=q.attr(X):(y=parseFloat(Zi(q,X))||0,X!=="opacity"&&(T="px")),A||(A=B),typeof A=="string"&&A.match("px")&&(A=A.replace(/px/g,"")),P.run(y,A,T)})},animObject:Ar,getDeferredAnimation:function(q,l,p){let y=Ar(l),T=p?[p]:q.series,A=0,P=0;return T.forEach(I=>{let B=Ar(I.options.animation);A=Ws(l)&&li(l.defer)?y.defer:Math.max(A,B.duration+B.defer),P=Math.min(y.duration,B.duration)}),q.renderer.forExport&&(A=0),{defer:Math.max(0,A-P),duration:Math.min(A,P)}},setAnimation:function(q,l){l.renderer.globalAnimation=Rr(q,l.options.chart.animation,!0)},stop:Ko},{SVG_NS:nn,win:ao}=pi,{attr:lo,createElement:Oo,css:fn,error:un,isFunction:Ka,isString:an,objectEach:Il,splat:Hh}=Ps,{trustedTypes:Ua}=ao,Xh=Ua&&Ka(Ua.createPolicy)&&Ua.createPolicy("highcharts",{createHTML:q=>q}),fp=Xh?Xh.createHTML(""):"";class Gn{static filterUserAttributes(l){return Il(l,(p,y)=>{let T=!0;Gn.allowedAttributes.indexOf(y)===-1&&(T=!1),["background","dynsrc","href","lowsrc","src"].indexOf(y)!==-1&&(T=an(p)&&Gn.allowedReferences.some(A=>p.indexOf(A)===0)),T||(un(33,!1,void 0,{"Invalid attribute in config":`${y}`}),delete l[y]),an(p)&&l[y]&&(l[y]=p.replace(/</g,"&lt;"))}),l}static parseStyle(l){return l.split(";").reduce((p,y)=>{let T=y.split(":").map(P=>P.trim()),A=T.shift();return A&&T.length&&(p[A.replace(/-([a-z])/g,P=>P[1].toUpperCase())]=T.join(":")),p},{})}static setElementHTML(l,p){l.innerHTML=Gn.emptyHTML,p&&new Gn(p).addToDOM(l)}constructor(l){this.nodes=typeof l=="string"?this.parseMarkup(l):l}addToDOM(l){return function p(y,T){let A;return Hh(y).forEach(function(P){let I,B=P.tagName,X=P.textContent?pi.doc.createTextNode(P.textContent):void 0,re=Gn.bypassHTMLFiltering;if(B)if(B==="#text")I=X;else if(Gn.allowedTags.indexOf(B)!==-1||re){let te=B==="svg"?nn:T.namespaceURI||nn,pe=pi.doc.createElementNS(te,B),_e=P.attributes||{};Il(P,function(Ee,De){De!=="tagName"&&De!=="attributes"&&De!=="children"&&De!=="style"&&De!=="textContent"&&(_e[De]=Ee)}),lo(pe,re?_e:Gn.filterUserAttributes(_e)),P.style&&fn(pe,P.style),X&&pe.appendChild(X),p(P.children||[],pe),I=pe}else un(33,!1,void 0,{"Invalid tagName in config":B});I&&T.appendChild(I),A=I}),A}(this.nodes,l)}parseMarkup(l){let p,y=[];l=l.trim().replace(/ style=(["'])/g," data-style=$1");try{p=new DOMParser().parseFromString(Xh?Xh.createHTML(l):l,"text/html")}catch{}if(!p){let A=Oo("div");A.innerHTML=l,p={body:A}}let T=(A,P)=>{let I=A.nodeName.toLowerCase(),B={tagName:I};I==="#text"&&(B.textContent=A.textContent||"");let X=A.attributes;if(X){let re={};[].forEach.call(X,te=>{te.name==="data-style"?B.style=Gn.parseStyle(te.value):re[te.name]=te.value}),B.attributes=re}if(A.childNodes.length){let re=[];[].forEach.call(A.childNodes,te=>{T(te,re)}),re.length&&(B.children=re)}P.push(B)};return[].forEach.call(p.body.childNodes,A=>T(A,y)),y}}Gn.allowedAttributes=["alt","aria-controls","aria-describedby","aria-expanded","aria-haspopup","aria-hidden","aria-label","aria-labelledby","aria-live","aria-pressed","aria-readonly","aria-roledescription","aria-selected","class","clip-path","color","colspan","cx","cy","d","disabled","dx","dy","fill","filterUnits","flood-color","flood-opacity","height","href","id","in","in2","markerHeight","markerWidth","offset","opacity","operator","orient","padding","paddingLeft","paddingRight","patternUnits","r","radius","refX","refY","result","role","rowspan","scope","slope","src","startOffset","stdDeviation","stroke-linecap","stroke-width","stroke","style","summary","tabindex","tableValues","target","text-align","text-anchor","textAnchor","textLength","title","type","valign","width","x","x1","x2","xlink:href","y","y1","y2","zIndex"],Gn.allowedReferences=["https://","http://","mailto:","/","../","./","#"],Gn.allowedTags=["#text","a","abbr","b","br","button","caption","circle","clipPath","code","dd","defs","div","dl","dt","em","feComponentTransfer","feComposite","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feMerge","feMergeNode","feMorphology","feOffset","filter","h1","h2","h3","h4","h5","h6","hr","i","img","li","linearGradient","marker","ol","p","path","pattern","pre","rect","small","span","stop","strong","style","sub","sup","svg","table","tbody","td","text","textPath","th","thead","title","tr","tspan","u","ul"],Gn.emptyHTML=fp,Gn.bypassHTMLFiltering=!1;let{defaultOptions:Yh,defaultTime:Sd}=Ra,{pageLang:Wd}=pi,{extend:Wn,getNestedProperty:$u,isArray:Ah,isNumber:$h,isObject:gh,isString:Kl,pick:Qc,ucfirst:Ma}=Ps,yn={add:(q,l)=>q+l,divide:(q,l)=>l!==0?q/l:"",eq:(q,l)=>q==l,each:function(q){let l=arguments[arguments.length-1];return!!Ah(q)&&q.map((p,y)=>qh(l.body,Wn(gh(p)?p:{"@this":p},{"@index":y,"@first":y===0,"@last":y===q.length-1}))).join("")},ge:(q,l)=>q>=l,gt:(q,l)=>q>l,if:q=>!!q,le:(q,l)=>q<=l,lt:(q,l)=>q<l,multiply:(q,l)=>q*l,ne:(q,l)=>q!=l,subtract:(q,l)=>q-l,ucfirst:Ma,unless:q=>!q},Hd={},bl=q=>/^["'].+["']$/.test(q);function qh(q="",l,p){var Re;let y=/\{([a-zA-Z\u00C0-\u017F\d:\.,;\-\/<>\[\]%_@+"'’= #\(\)]+)\}/g,T=/\(([a-zA-Z\u00C0-\u017F\d:\.,;\-\/<>\[\]%_@+"'= ]+)\)/g,A=[],P=/f$/,I=/\.(\d)/,B=((Re=p==null?void 0:p.options)==null?void 0:Re.lang)||Yh.lang,X=(p==null?void 0:p.time)||Sd,re=(p==null?void 0:p.numberFormatter)||Zh.bind(p),te=(Be="")=>{let Ze;return Be==="true"||Be!=="false"&&((Ze=Number(Be)).toString()===Be?Ze:bl(Be)?Be.slice(1,-1):$u(Be,l))},pe,_e,Ee=0,De;for(;(pe=y.exec(q))!==null;){let Be=pe,Ze=T.exec(pe[1]);Ze&&(pe=Ze,De=!0),_e!=null&&_e.isBlock||(_e={ctx:l,expression:pe[1],find:pe[0],isBlock:pe[1].charAt(0)==="#",start:pe.index,startInner:pe.index+pe[0].length,length:pe[0].length});let rt=(_e.isBlock?Be:pe)[1].split(" ")[0].replace("#","");yn[rt]&&(_e.isBlock&&rt===_e.fn&&Ee++,_e.fn||(_e.fn=rt));let Yt=pe[1]==="else";if(_e.isBlock&&_e.fn&&(pe[1]===`/${_e.fn}`||Yt))if(Ee)!Yt&&Ee--;else{let Ut=_e.startInner,Xt=q.substr(Ut,pe.index-Ut);_e.body===void 0?(_e.body=Xt,_e.startInner=pe.index+pe[0].length):_e.elseBody=Xt,_e.find+=Xt+pe[0],Yt||(A.push(_e),_e=void 0)}else _e.isBlock||A.push(_e);if(Ze&&!(_e!=null&&_e.isBlock))break}return A.forEach(Be=>{let Ze,rt,{body:Yt,elseBody:Ut,expression:Xt,fn:Ci}=Be;if(Ci){let di=[Be],vi=[],es=Xt.length,ws=0,As;for(rt=0;rt<=es;rt++){let $s=Xt.charAt(rt);As||$s!=='"'&&$s!=="'"?As===$s&&(As=""):As=$s,As||$s!==" "&&rt!==es||(vi.push(Xt.substr(ws,rt-ws)),ws=rt+1)}for(rt=yn[Ci].length;rt--;)di.unshift(te(vi[rt+1]));Ze=yn[Ci].apply(l,di),Be.isBlock&&typeof Ze=="boolean"&&(Ze=qh(Ze?Yt:Ut,l,p))}else{let di=bl(Xt)?[Xt]:Xt.split(":"),vi=(Ze=te(di.shift()||""))%1!=0;if(typeof Ze=="number"&&(di.length||vi)){let es=di.join(":");if(P.test(es)||vi){let ws=parseInt((es.match(I)||["","-1"])[1],10);Ze!==null&&(Ze=re(Ze,ws,B.decimalPoint,es.indexOf(",")>-1?B.thousandsSep:""))}else Ze=X.dateFormat(es,Ze)}T.lastIndex=0,T.test(Be.find)&&Kl(Ze)&&(Ze=`"${Ze}"`)}q=q.replace(Be.find,Qc(Ze,""))}),De?qh(q,l,p):q}function Zh(q,l,p,y){var De;l*=1;let T,A,[P,I]=(q=+q||0).toString().split("e").map(Number),B=((De=this==null?void 0:this.options)==null?void 0:De.lang)||Yh.lang,X=(q.toString().split(".")[1]||"").split("e")[0].length,re=l,te={};p??(p=B.decimalPoint),y??(y=B.thousandsSep),l===-1?l=Math.min(X,20):$h(l)?l&&I<0&&((A=l+I)>=0?(P=+P.toExponential(A).split("e")[0],l=A):(P=Math.floor(P),q=l<20?+(P*Math.pow(10,I)).toFixed(l):0,I=0)):l=2,I&&(l??(l=2),q=P),$h(l)&&l>=0&&(te.minimumFractionDigits=l,te.maximumFractionDigits=l),y===""&&(te.useGrouping=!1);let pe=y||p,_e=pe?"en":(this==null?void 0:this.locale)||B.locale||Wd,Ee=JSON.stringify(te)+_e;return T=(Hd[Ee]??(Hd[Ee]=new Intl.NumberFormat(_e,te))).format(q),pe&&(T=T.replace(/([,\.])/g,"_$1").replace(/_\,/g,y??",").replace("_.",p??".")),(l||+T!=0)&&(!(I<0)||re)||(T="0"),I&&+T!=0&&(T+="e"+(I<0?"":"+")+I),T}let fa={dateFormat:function(q,l,p){return Sd.dateFormat(q,l,p)},format:qh,helpers:yn,numberFormat:Zh};(function(q){let l;q.rendererTypes={},q.getRendererType=function(p=l){return q.rendererTypes[p]||q.rendererTypes[l]},q.registerRendererType=function(p,y,T){q.rendererTypes[p]=y,(!l||T)&&(l=p,pi.Renderer=y)}})(Vi||(Vi={}));let Xd=Vi,{clamp:qu,pick:Ll,pushUnique:ja,stableSort:Bn}=Ps;(a||(a={})).distribute=function q(l,p,y){let T=l,A=T.reducedLen||p,P=(rt,Yt)=>rt.target-Yt.target,I=[],B=l.length,X=[],re=I.push,te,pe,_e,Ee=!0,De,Re,Be=0,Ze;for(te=B;te--;)Be+=l[te].size;if(Be>A){for(Bn(l,(rt,Yt)=>(Yt.rank||0)-(rt.rank||0)),_e=(Ze=l[0].rank===l[l.length-1].rank)?B/2:-1,pe=Ze?_e:B-1;_e&&Be>A;)De=l[te=Math.floor(pe)],ja(X,te)&&(Be-=De.size),pe+=_e,Ze&&pe>=l.length&&(_e/=2,pe=_e);X.sort((rt,Yt)=>Yt-rt).forEach(rt=>re.apply(I,l.splice(rt,1)))}for(Bn(l,P),l=l.map(rt=>({size:rt.size,targets:[rt.target],align:Ll(rt.align,.5)}));Ee;){for(te=l.length;te--;)De=l[te],Re=(Math.min.apply(0,De.targets)+Math.max.apply(0,De.targets))/2,De.pos=qu(Re-De.size*De.align,0,p-De.size);for(te=l.length,Ee=!1;te--;)te>0&&l[te-1].pos+l[te-1].size>l[te].pos&&(l[te-1].size+=l[te].size,l[te-1].targets=l[te-1].targets.concat(l[te].targets),l[te-1].align=.5,l[te-1].pos+l[te-1].size>p&&(l[te-1].pos=p-l[te-1].size),l.splice(te,1),Ee=!0)}return re.apply(T,I),te=0,l.some(rt=>{let Yt=0;return(rt.targets||[]).some(()=>(T[te].pos=rt.pos+Yt,y!==void 0&&Math.abs(T[te].pos-T[te].target)>y?(T.slice(0,te+1).forEach(Ut=>delete Ut.pos),T.reducedLen=(T.reducedLen||p)-.1*p,T.reducedLen>.1*p&&q(T,p,y),!0):(Yt+=T[te].size,te++,!1)))}),Bn(T,P),T};let kh=a,{animate:Xl,animObject:mp,stop:Dc}=to,{deg2rad:Gr,doc:Eh,svg:Su,SVG_NS:Ch,win:cf,isFirefox:ma}=pi,{addEvent:Mu,attr:wl,createElement:ed,crisp:Yd,css:It,defined:Fi,erase:fs,extend:Ir,fireEvent:Ga,getAlignFactor:xn,isArray:Ol,isFunction:Ln,isNumber:td,isObject:id,isString:Au,merge:zc,objectEach:fl,pick:Hn,pInt:hl,pushUnique:$d,replaceNested:So,syncTimeout:Dl,uniqueKey:Md}=Ps;class Ja{_defaultGetter(l){let p=Hn(this[l+"Value"],this[l],this.element?this.element.getAttribute(l):null,0);return/^-?[\d\.]+$/.test(p)&&(p=parseFloat(p)),p}_defaultSetter(l,p,y){y.setAttribute(p,l)}add(l){let p,y=this.renderer,T=this.element;return l&&(this.parentGroup=l),this.textStr!==void 0&&this.element.nodeName==="text"&&y.buildText(this),this.added=!0,(!l||l.handleZ||this.zIndex)&&(p=this.zIndexSetter()),p||(l?l.element:y.box).appendChild(T),this.onAdd&&this.onAdd(),this}addClass(l,p){let y=p?"":this.attr("class")||"";return(l=(l||"").split(/ /g).reduce(function(T,A){return y.indexOf(A)===-1&&T.push(A),T},y?[y]:[]).join(" "))!==y&&this.attr("class",l),this}afterSetters(){this.doTransform&&(this.updateTransform(),this.doTransform=!1)}align(l,p,y,T=!0){let A=this.renderer,P=A.alignedObjects,I=!!l;l?(this.alignOptions=l,this.alignByTranslate=p,this.alignTo=y):(l=this.alignOptions||{},p=this.alignByTranslate,y=this.alignTo);let B=!y||Au(y)?y||"renderer":void 0;B&&(I&&$d(P,this),y=void 0);let X=Hn(y,A[B],A),re=(X.x||0)+(l.x||0)+((X.width||0)-(l.width||0))*xn(l.align),te=(X.y||0)+(l.y||0)+((X.height||0)-(l.height||0))*xn(l.verticalAlign),pe={"text-align":l==null?void 0:l.align};return pe[p?"translateX":"x"]=Math.round(re),pe[p?"translateY":"y"]=Math.round(te),T&&(this[this.placed?"animate":"attr"](pe),this.placed=!0),this.alignAttr=pe,this}alignSetter(l){let p={left:"start",center:"middle",right:"end"};p[l]&&(this.alignValue=l,this.element.setAttribute("text-anchor",p[l]))}animate(l,p,y){let T=mp(Hn(p,this.renderer.globalAnimation,!0)),A=T.defer;return Eh.hidden&&(T.duration=0),T.duration!==0?(y&&(T.complete=y),Dl(()=>{this.element&&Xl(this,l,T)},A)):(this.attr(l,void 0,y||T.complete),fl(l,function(P,I){T.step&&T.step.call(this,P,{prop:I,pos:1,elem:this})},this)),this}applyTextOutline(l){let p=this.element;l.indexOf("contrast")!==-1&&(l=l.replace(/contrast/g,this.renderer.getContrast(p.style.fill)));let y=l.indexOf(" "),T=l.substring(y+1),A=l.substring(0,y);if(A&&A!=="none"&&pi.svg){this.fakeTS=!0,A=A.replace(/(^[\d\.]+)(.*?)$/g,function(re,te,pe){return 2*Number(te)+pe}),this.removeTextOutline();let P=Eh.createElementNS(Ch,"tspan");wl(P,{class:"highcharts-text-outline",fill:T,stroke:T,"stroke-width":A,"stroke-linejoin":"round"});let I=p.querySelector("textPath")||p;[].forEach.call(I.childNodes,re=>{let te=re.cloneNode(!0);te.removeAttribute&&["fill","stroke","stroke-width","stroke"].forEach(pe=>te.removeAttribute(pe)),P.appendChild(te)});let B=0;[].forEach.call(I.querySelectorAll("text tspan"),re=>{B+=Number(re.getAttribute("dy"))});let X=Eh.createElementNS(Ch,"tspan");X.textContent="​",wl(X,{x:Number(p.getAttribute("x")),dy:-B}),P.appendChild(X),I.insertBefore(P,I.firstChild)}}attr(l,p,y,T){let{element:A}=this,P=Ja.symbolCustomAttribs,I,B,X=this,re;return typeof l=="string"&&p!==void 0&&(I=l,(l={})[I]=p),typeof l=="string"?X=(this[l+"Getter"]||this._defaultGetter).call(this,l,A):(fl(l,function(te,pe){re=!1,T||Dc(this,pe),this.symbolName&&P.indexOf(pe)!==-1&&(B||(this.symbolAttr(l),B=!0),re=!0),this.rotation&&(pe==="x"||pe==="y")&&(this.doTransform=!0),re||(this[pe+"Setter"]||this._defaultSetter).call(this,te,pe,A)},this),this.afterSetters()),y&&y.call(this),X}clip(l){if(l&&!l.clipPath){let p=Md()+"-",y=this.renderer.createElement("clipPath").attr({id:p}).add(this.renderer.defs);Ir(l,{clipPath:y,id:p,count:0}),l.add(y)}return this.attr("clip-path",l?`url(${this.renderer.url}#${l.id})`:"none")}crisp(l,p){p=Math.round(p||l.strokeWidth||0);let y=l.x||this.x||0,T=l.y||this.y||0,A=(l.width||this.width||0)+y,P=(l.height||this.height||0)+T,I=Yd(y,p),B=Yd(T,p);return Ir(l,{x:I,y:B,width:Yd(A,p)-I,height:Yd(P,p)-B}),Fi(l.strokeWidth)&&(l.strokeWidth=p),l}complexColor(l,p,y){let T=this.renderer,A,P,I,B,X,re,te,pe,_e,Ee,De=[],Re;Ga(this.renderer,"complexColor",{args:arguments},function(){if(l.radialGradient?P="radialGradient":l.linearGradient&&(P="linearGradient"),P){if(I=l[P],X=T.gradients,re=l.stops,_e=y.radialReference,Ol(I)&&(l[P]=I={x1:I[0],y1:I[1],x2:I[2],y2:I[3],gradientUnits:"userSpaceOnUse"}),P==="radialGradient"&&_e&&!Fi(I.gradientUnits)&&(B=I,I=zc(I,T.getRadialAttr(_e,B),{gradientUnits:"userSpaceOnUse"})),fl(I,function(Be,Ze){Ze!=="id"&&De.push(Ze,Be)}),fl(re,function(Be){De.push(Be)}),X[De=De.join(",")])Ee=X[De].attr("id");else{I.id=Ee=Md();let Be=X[De]=T.createElement(P).attr(I).add(T.defs);Be.radAttr=B,Be.stops=[],re.forEach(function(Ze){Ze[1].indexOf("rgba")===0?(te=(A=at.parse(Ze[1])).get("rgb"),pe=A.get("a")):(te=Ze[1],pe=1);let rt=T.createElement("stop").attr({offset:Ze[0],"stop-color":te,"stop-opacity":pe}).add(Be);Be.stops.push(rt)})}Re="url("+T.url+"#"+Ee+")",y.setAttribute(p,Re),y.gradient=De,l.toString=function(){return Re}}})}css(l){let p=this.styles,y={},T=this.element,A,P=!p;if(p&&fl(l,function(I,B){p&&p[B]!==I&&(y[B]=I,P=!0)}),P){p&&(l=Ir(p,y)),l.width===null||l.width==="auto"?delete this.textWidth:T.nodeName.toLowerCase()==="text"&&l.width&&(A=this.textWidth=hl(l.width)),Ir(this.styles,l),A&&!Su&&this.renderer.forExport&&delete l.width;let I=ma&&l.fontSize||null;I&&(td(I)||/^\d+$/.test(I))&&(l.fontSize+="px");let B=zc(l);T.namespaceURI===this.SVG_NS&&(["textOutline","textOverflow","whiteSpace","width"].forEach(X=>B&&delete B[X]),B.color&&(B.fill=B.color,delete B.color)),It(T,B)}return this.added&&(this.element.nodeName==="text"&&this.renderer.buildText(this),l.textOutline&&this.applyTextOutline(l.textOutline)),this}dashstyleSetter(l){let p,y=this["stroke-width"];if(y==="inherit"&&(y=1),l){let T=(l=l.toLowerCase()).replace("shortdashdotdot","3,1,1,1,1,1,").replace("shortdashdot","3,1,1,1").replace("shortdot","1,1,").replace("shortdash","3,1,").replace("longdash","8,3,").replace(/dot/g,"1,3,").replace("dash","4,3,").replace(/,$/,"").split(",");for(p=T.length;p--;)T[p]=""+hl(T[p])*Hn(y,NaN);l=T.join(",").replace(/NaN/g,"none"),this.element.setAttribute("stroke-dasharray",l)}}destroy(){let l=this,p=l.element||{},y=l.renderer,T=p.ownerSVGElement,A=p.nodeName==="SPAN"&&l.parentGroup||void 0,P,I;if(p.onclick=p.onmouseout=p.onmouseover=p.onmousemove=p.point=null,Dc(l),l.clipPath&&T){let B=l.clipPath;[].forEach.call(T.querySelectorAll("[clip-path],[CLIP-PATH]"),function(X){X.getAttribute("clip-path").indexOf(B.element.id)>-1&&X.removeAttribute("clip-path")}),l.clipPath=B.destroy()}if(l.stops){for(I=0;I<l.stops.length;I++)l.stops[I].destroy();l.stops.length=0,l.stops=void 0}for(l.safeRemoveChild(p);A!=null&&A.div&&A.div.childNodes.length===0;)P=A.parentGroup,l.safeRemoveChild(A.div),delete A.div,A=P;l.alignOptions&&fs(y.alignedObjects,l),fl(l,(B,X)=>{var re,te,pe;(((re=l[X])==null?void 0:re.parentGroup)===l||["connector","foreignObject"].indexOf(X)!==-1)&&((pe=(te=l[X])==null?void 0:te.destroy)==null||pe.call(te)),delete l[X]})}dSetter(l,p,y){Ol(l)&&(typeof l[0]=="string"&&(l=this.renderer.pathToSegments(l)),this.pathArray=l,l=l.reduce((T,A,P)=>A!=null&&A.join?(P?T+" ":"")+A.join(" "):(A||"").toString(),"")),/(NaN| {2}|^$)/.test(l)&&(l="M 0 0"),this[p]!==l&&(y.setAttribute(p,l),this[p]=l)}fillSetter(l,p,y){typeof l=="string"?y.setAttribute(p,l):l&&this.complexColor(l,p,y)}hrefSetter(l,p,y){y.setAttributeNS("http://www.w3.org/1999/xlink",p,l)}getBBox(l,p){let y,T,A,P,{alignValue:I,element:B,renderer:X,styles:re,textStr:te}=this,{cache:pe,cacheKeys:_e}=X,Ee=B.namespaceURI===this.SVG_NS,De=Hn(p,this.rotation,0),Re=X.styledMode?B&&Ja.prototype.getStyle.call(B,"font-size"):re.fontSize;if(Fi(te)&&((P=te.toString()).indexOf("<")===-1&&(P=P.replace(/\d/g,"0")),P+=["",X.rootFontSize,Re,De,this.textWidth,I,re.lineClamp,re.textOverflow,re.fontWeight].join(",")),P&&!l&&(y=pe[P]),!y||y.polygon){if(Ee||X.forExport){try{A=this.fakeTS&&function(Ze){let rt=B.querySelector(".highcharts-text-outline");rt&&It(rt,{display:Ze})},Ln(A)&&A("none"),y=B.getBBox?Ir({},B.getBBox()):{width:B.offsetWidth,height:B.offsetHeight,x:0,y:0},Ln(A)&&A("")}catch{}(!y||y.width<0)&&(y={x:0,y:0,width:0,height:0})}else y=this.htmlGetBBox();T=y.height,Ee&&(y.height=T={"11px,17":14,"13px,20":16}[`${Re||""},${Math.round(T)}`]||T),De&&(y=this.getRotatedBox(y,De));let Be={bBox:y};Ga(this,"afterGetBBox",Be),y=Be.bBox}if(P&&(te===""||y.height>0)){for(;_e.length>250;)delete pe[_e.shift()];pe[P]||_e.push(P),pe[P]=y}return y}getRotatedBox(l,p){let{x:y,y:T,width:A,height:P}=l,{alignValue:I,translateY:B,rotationOriginX:X=0,rotationOriginY:re=0}=this,te=xn(I),pe=Number(this.element.getAttribute("y")||0)-(B?0:T),_e=p*Gr,Ee=(p-90)*Gr,De=Math.cos(_e),Re=Math.sin(_e),Be=A*De,Ze=A*Re,rt=Math.cos(Ee),Yt=Math.sin(Ee),[[Ut,Xt],[Ci,di]]=[X,re].map(en=>[en-en*De,en*Re]),vi=y+te*(A-Be)+Ut+di+pe*rt,es=vi+Be,ws=es-P*rt,As=ws-Be,$s=T+pe-te*Ze-Xt+Ci+pe*Yt,kr=$s+Ze,pr=kr-P*Yt,Vr=pr-Ze,cr=Math.min(vi,es,ws,As),Zr=Math.min($s,kr,pr,Vr),Cn=Math.max(vi,es,ws,As)-cr,Qo=Math.max($s,kr,pr,Vr)-Zr;return{x:cr,y:Zr,width:Cn,height:Qo,polygon:[[vi,$s],[es,kr],[ws,pr],[As,Vr]]}}getStyle(l){return cf.getComputedStyle(this.element||this,"").getPropertyValue(l)}hasClass(l){return(""+this.attr("class")).split(" ").indexOf(l)!==-1}hide(){return this.attr({visibility:"hidden"})}htmlGetBBox(){return{height:0,width:0,x:0,y:0}}constructor(l,p){this.onEvents={},this.opacity=1,this.SVG_NS=Ch,this.element=p==="span"||p==="body"?ed(p):Eh.createElementNS(this.SVG_NS,p),this.renderer=l,this.styles={},Ga(this,"afterInit")}on(l,p){let{onEvents:y}=this;return y[l]&&y[l](),y[l]=Mu(this.element,l,p),this}opacitySetter(l,p,y){let T=Number(Number(l).toFixed(3));this.opacity=T,y.setAttribute(p,T)}reAlign(){var l;(l=this.alignOptions)!=null&&l.width&&this.alignOptions.align!=="left"&&(this.alignOptions.width=this.getBBox().width,this.placed=!1,this.align())}removeClass(l){return this.attr("class",(""+this.attr("class")).replace(Au(l)?RegExp(`(^| )${l}( |$)`):l," ").replace(/ +/g," ").trim())}removeTextOutline(){let l=this.element.querySelector("tspan.highcharts-text-outline");l&&this.safeRemoveChild(l)}safeRemoveChild(l){let p=l.parentNode;p&&p.removeChild(l)}setRadialReference(l){let p=this.element.gradient&&this.renderer.gradients[this.element.gradient]||void 0;return this.element.radialReference=l,p!=null&&p.radAttr&&p.animate(this.renderer.getRadialAttr(l,p.radAttr)),this}shadow(l){var A;let{renderer:p}=this,y=zc(((A=this.parentGroup)==null?void 0:A.rotation)===90?{offsetX:-1,offsetY:-1}:{},id(l)?l:{}),T=p.shadowDefinition(y);return this.attr({filter:l?`url(${p.url}#${T})`:"none"})}show(l=!0){return this.attr({visibility:l?"inherit":"visible"})}"stroke-widthSetter"(l,p,y){this[p]=l,y.setAttribute(p,l)}strokeWidth(){if(!this.renderer.styledMode)return this["stroke-width"]||0;let l=this.getStyle("stroke-width"),p=0,y;return/px$/.test(l)?p=hl(l):l!==""&&(wl(y=Eh.createElementNS(Ch,"rect"),{width:l,"stroke-width":0}),this.element.parentNode.appendChild(y),p=y.getBBox().width,y.parentNode.removeChild(y)),p}symbolAttr(l){let p=this;Ja.symbolCustomAttribs.forEach(function(y){p[y]=Hn(l[y],p[y])}),p.attr({d:p.renderer.symbols[p.symbolName](p.x,p.y,p.width,p.height,p)})}textSetter(l){l!==this.textStr&&(delete this.textPxLength,this.textStr=l,this.added&&this.renderer.buildText(this),this.reAlign())}titleSetter(l){let p=this.element,y=p.getElementsByTagName("title")[0]||Eh.createElementNS(this.SVG_NS,"title");p.insertBefore?p.insertBefore(y,p.firstChild):p.appendChild(y),y.textContent=So(Hn(l,""),[/<[^>]*>/g,""]).replace(/&lt;/g,"<").replace(/&gt;/g,">")}toFront(){let l=this.element;return l.parentNode.appendChild(l),this}translate(l,p){return this.attr({translateX:l,translateY:p})}updateTransform(l="transform"){let{element:p,foreignObject:y,matrix:T,padding:A,rotation:P=0,rotationOriginX:I,rotationOriginY:B,scaleX:X,scaleY:re,text:te,translateX:pe=0,translateY:_e=0}=this,Ee=["translate("+pe+","+_e+")"];Fi(T)&&Ee.push("matrix("+T.join(",")+")"),P&&(Ee.push("rotate("+P+" "+(I??p.getAttribute("x")??this.x??0)+" "+(B??p.getAttribute("y")??this.y??0)+")"),(te==null?void 0:te.element.tagName)!=="SPAN"||te!=null&&te.foreignObject||te.attr({rotation:P,rotationOriginX:(I||0)-A,rotationOriginY:(B||0)-A})),(Fi(X)||Fi(re))&&Ee.push("scale("+Hn(X,1)+" "+Hn(re,1)+")"),Ee.length&&!(te||this).textPath&&((y==null?void 0:y.element)||p).setAttribute(l,Ee.join(" "))}visibilitySetter(l,p,y){l==="inherit"?y.removeAttribute(p):this[p]!==l&&y.setAttribute(p,l),this[p]=l}xGetter(l){return this.element.nodeName==="circle"&&(l==="x"?l="cx":l==="y"&&(l="cy")),this._defaultGetter(l)}zIndexSetter(l,p){let y=this.renderer,T=this.parentGroup,A=(T||y).element||y.box,P=this.element,I=A===y.box,B,X,re,te=!1,pe,_e=this.added,Ee;if(Fi(l)?(P.setAttribute("data-z-index",l),l*=1,this[p]===l&&(_e=!1)):Fi(this[p])&&P.removeAttribute("data-z-index"),this[p]=l,_e){for((l=this.zIndex)&&T&&(T.handleZ=!0),Ee=(B=A.childNodes).length-1;Ee>=0&&!te;Ee--)pe=!Fi(re=(X=B[Ee]).getAttribute("data-z-index")),X!==P&&(l<0&&pe&&!I&&!Ee?(A.insertBefore(P,B[Ee]),te=!0):(hl(re)<=l||pe&&(!Fi(l)||l>=0))&&(A.insertBefore(P,B[Ee+1]),te=!0));te||(A.insertBefore(P,B[3*!!I]),te=!0)}return te}}Ja.symbolCustomAttribs=["anchorX","anchorY","clockwise","end","height","innerR","r","start","width","x","y"],Ja.prototype.strokeSetter=Ja.prototype.fillSetter,Ja.prototype.yGetter=Ja.prototype.xGetter,Ja.prototype.matrixSetter=Ja.prototype.rotationOriginXSetter=Ja.prototype.rotationOriginYSetter=Ja.prototype.rotationSetter=Ja.prototype.scaleXSetter=Ja.prototype.scaleYSetter=Ja.prototype.translateXSetter=Ja.prototype.translateYSetter=Ja.prototype.verticalAlignSetter=function(q,l){this[l]=q,this.doTransform=!0};let js=Ja,{defined:Np,extend:lh,getAlignFactor:ga,isNumber:La,merge:yh,pick:qd,removeEvent:Ls}=Ps;class Qr extends js{constructor(l,p,y,T,A,P,I,B,X,re){let te;super(l,"g"),this.paddingLeftSetter=this.paddingSetter,this.paddingRightSetter=this.paddingSetter,this.doUpdate=!1,this.textStr=p,this.x=y,this.y=T,this.anchorX=P,this.anchorY=I,this.baseline=X,this.className=re,this.addClass(re==="button"?"highcharts-no-tooltip":"highcharts-label"),re&&this.addClass("highcharts-"+re),this.text=l.text(void 0,0,0,B).attr({zIndex:1}),typeof A=="string"&&((te=/^url\((.*?)\)$/.test(A))||this.renderer.symbols[A])&&(this.symbolKey=A),this.bBox=Qr.emptyBBox,this.padding=3,this.baselineOffset=0,this.needsBox=l.styledMode||te,this.deferredAttr={},this.alignFactor=0}alignSetter(l){let p=ga(l);this.textAlign=l,p!==this.alignFactor&&(this.alignFactor=p,this.bBox&&La(this.xSetting)&&this.attr({x:this.xSetting}))}anchorXSetter(l,p){this.anchorX=l,this.boxAttr(p,Math.round(l)-this.getCrispAdjust()-this.xSetting)}anchorYSetter(l,p){this.anchorY=l,this.boxAttr(p,l-this.ySetting)}boxAttr(l,p){this.box?this.box.attr(l,p):this.deferredAttr[l]=p}css(l){if(l){let p={};l=yh(l),Qr.textProps.forEach(y=>{l[y]!==void 0&&(p[y]=l[y],delete l[y])}),this.text.css(p),"fontSize"in p||"fontWeight"in p?this.updateTextPadding():("width"in p||"textOverflow"in p)&&this.updateBoxSize()}return js.prototype.css.call(this,l)}destroy(){Ls(this.element,"mouseenter"),Ls(this.element,"mouseleave"),this.text&&this.text.destroy(),this.box&&(this.box=this.box.destroy()),js.prototype.destroy.call(this)}fillSetter(l,p){l&&(this.needsBox=!0),this.fill=l,this.boxAttr(p,l)}getBBox(l,p){this.textStr&&this.bBox.width===0&&this.bBox.height===0&&this.updateBoxSize();let{padding:y,height:T=0,translateX:A=0,translateY:P=0,width:I=0}=this,B=qd(this.paddingLeft,y),X=p??(this.rotation||0),re={width:I,height:T,x:A+this.bBox.x-B,y:P+this.bBox.y-y+this.baselineOffset};return X&&(re=this.getRotatedBox(re,X)),re}getCrispAdjust(){return(this.renderer.styledMode&&this.box?this.box.strokeWidth():this["stroke-width"]?parseInt(this["stroke-width"],10):0)%2/2}heightSetter(l){this.heightSetting=l,this.doUpdate=!0}afterSetters(){super.afterSetters(),this.doUpdate&&(this.updateBoxSize(),this.doUpdate=!1)}onAdd(){this.text.add(this),this.attr({text:qd(this.textStr,""),x:this.x||0,y:this.y||0}),this.box&&Np(this.anchorX)&&this.attr({anchorX:this.anchorX,anchorY:this.anchorY})}paddingSetter(l,p){La(l)?l!==this[p]&&(this[p]=l,this.updateTextPadding()):this[p]=void 0}rSetter(l,p){this.boxAttr(p,l)}strokeSetter(l,p){this.stroke=l,this.boxAttr(p,l)}"stroke-widthSetter"(l,p){l&&(this.needsBox=!0),this["stroke-width"]=l,this.boxAttr(p,l)}"text-alignSetter"(l){this.textAlign=this["text-align"]=l,this.updateTextPadding()}textSetter(l){l!==void 0&&this.text.attr({text:l}),this.updateTextPadding(),this.reAlign()}updateBoxSize(){let l,p=this.text,y={},T=this.padding,A=this.bBox=(!La(this.widthSetting)||!La(this.heightSetting)||this.textAlign)&&Np(p.textStr)?p.getBBox(void 0,0):Qr.emptyBBox;this.width=this.getPaddedWidth(),this.height=(this.heightSetting||A.height||0)+2*T;let P=this.renderer.fontMetrics(p);if(this.baselineOffset=T+Math.min((this.text.firstLineMetrics||P).b,A.height||1/0),this.heightSetting&&(this.baselineOffset+=(this.heightSetting-P.h)/2),this.needsBox&&!p.textPath){if(!this.box){let I=this.box=this.symbolKey?this.renderer.symbol(this.symbolKey):this.renderer.rect();I.addClass((this.className==="button"?"":"highcharts-label-box")+(this.className?" highcharts-"+this.className+"-box":"")),I.add(this)}y.x=l=this.getCrispAdjust(),y.y=(this.baseline?-this.baselineOffset:0)+l,y.width=Math.round(this.width),y.height=Math.round(this.height),this.box.attr(lh(y,this.deferredAttr)),this.deferredAttr={}}}updateTextPadding(){let l=this.text,p=l.styles.textAlign||this.textAlign;if(!l.textPath){this.updateBoxSize();let y=this.baseline?0:this.baselineOffset,T=(this.paddingLeft??this.padding)+ga(p)*(this.widthSetting??this.bBox.width);(T!==l.x||y!==l.y)&&(l.attr({align:p,x:T}),y!==void 0&&l.attr("y",y)),l.x=T,l.y=y}}widthSetter(l){this.widthSetting=La(l)?l:void 0,this.doUpdate=!0}getPaddedWidth(){let l=this.padding,p=qd(this.paddingLeft,l),y=qd(this.paddingRight,l);return(this.widthSetting||this.bBox.width||0)+p+y}xSetter(l){this.x=l,this.alignFactor&&(l-=this.alignFactor*this.getPaddedWidth(),this["forceAnimate:x"]=!0),this.xSetting=Math.round(l),this.attr("translateX",this.xSetting)}ySetter(l){this.ySetting=this.y=Math.round(l),this.attr("translateY",this.ySetting)}}Qr.emptyBBox={width:0,height:0,x:0,y:0},Qr.textProps=["color","direction","fontFamily","fontSize","fontStyle","fontWeight","lineClamp","lineHeight","textAlign","textDecoration","textOutline","textOverflow","whiteSpace","width"];let{defined:zo,isNumber:Jl,pick:Kh}=Ps;function ro(q,l,p,y,T){let A=[];if(T){let P=T.start||0,I=T.end||0,B=Kh(T.r,p),X=Kh(T.r,y||p),re=2e-4/(T.borderRadius?1:Math.max(B,1)),te=Math.abs(I-P-2*Math.PI)<re;te&&(P=Math.PI/2,I=2.5*Math.PI-re);let pe=T.innerR,_e=Kh(T.open,te),Ee=Math.cos(P),De=Math.sin(P),Re=Math.cos(I),Be=Math.sin(I),Ze=Kh(T.longArc,I-P-Math.PI<re?0:1),rt=["A",B,X,0,Ze,Kh(T.clockwise,1),q+B*Re,l+X*Be];rt.params={start:P,end:I,cx:q,cy:l},A.push(["M",q+B*Ee,l+X*De],rt),zo(pe)&&((rt=["A",pe,pe,0,Ze,zo(T.clockwise)?1-T.clockwise:0,q+pe*Ee,l+pe*De]).params={start:I,end:P,cx:q,cy:l},A.push(_e?["M",q+pe*Re,l+pe*Be]:["L",q+pe*Re,l+pe*Be],rt)),_e||A.push(["Z"])}return A}function ku(q,l,p,y,T){return T!=null&&T.r?Ph(q,l,p,y,T):[["M",q,l],["L",q+p,l],["L",q+p,l+y],["L",q,l+y],["Z"]]}function Ph(q,l,p,y,T){let A=(T==null?void 0:T.r)||0;return[["M",q+A,l],["L",q+p-A,l],["A",A,A,0,0,1,q+p,l+A],["L",q+p,l+y-A],["A",A,A,0,0,1,q+p-A,l+y],["L",q+A,l+y],["A",A,A,0,0,1,q,l+y-A],["L",q,l+A],["A",A,A,0,0,1,q+A,l],["Z"]]}let gc={arc:ro,callout:function(q,l,p,y,T){let A=Math.min((T==null?void 0:T.r)||0,p,y),P=A+6,I=T==null?void 0:T.anchorX,B=(T==null?void 0:T.anchorY)||0,X=Ph(q,l,p,y,{r:A});if(!Jl(I)||I<p&&I>0&&B<y&&B>0)return X;if(q+I>p-P)if(B>l+P&&B<l+y-P)X.splice(3,1,["L",q+p,B-6],["L",q+p+6,B],["L",q+p,B+6],["L",q+p,l+y-A]);else if(I<p){let re=B<l+P,te=re?l:l+y;X.splice(re?2:5,0,["L",I,B],["L",q+p-A,te])}else X.splice(3,1,["L",q+p,y/2],["L",I,B],["L",q+p,y/2],["L",q+p,l+y-A]);else if(q+I<P)if(B>l+P&&B<l+y-P)X.splice(7,1,["L",q,B+6],["L",q-6,B],["L",q,B-6],["L",q,l+A]);else if(I>0){let re=B<l+P,te=re?l:l+y;X.splice(re?1:6,0,["L",I,B],["L",q+A,te])}else X.splice(7,1,["L",q,y/2],["L",I,B],["L",q,y/2],["L",q,l+A]);else B>y&&I<p-P?X.splice(5,1,["L",I+6,l+y],["L",I,l+y+6],["L",I-6,l+y],["L",q+A,l+y]):B<0&&I>P&&X.splice(1,1,["L",I-6,l],["L",I,l-6],["L",I+6,l],["L",p-A,l]);return X},circle:function(q,l,p,y){return ro(q+p/2,l+y/2,p/2,y/2,{start:.5*Math.PI,end:2.5*Math.PI,open:!1})},diamond:function(q,l,p,y){return[["M",q+p/2,l],["L",q+p,l+y/2],["L",q+p/2,l+y],["L",q,l+y/2],["Z"]]},rect:ku,roundedRect:Ph,square:ku,triangle:function(q,l,p,y){return[["M",q+p/2,l],["L",q+p,l+y],["L",q,l+y],["Z"]]},"triangle-down":function(q,l,p,y){return[["M",q,l],["L",q+p,l],["L",q+p/2,l+y],["Z"]]}},{doc:Ba,SVG_NS:Xn,win:Hf}=pi,{attr:sd,extend:Zd,fireEvent:Vp,isString:Kd,objectEach:Tl,pick:Ad}=Ps,Wa=(q,l)=>q.substring(0,l)+"…",Jd=class{constructor(q){let l=q.styles;this.renderer=q.renderer,this.svgElement=q,this.width=q.textWidth,this.textLineHeight=l==null?void 0:l.lineHeight,this.textOutline=l==null?void 0:l.textOutline,this.ellipsis=(l==null?void 0:l.textOverflow)==="ellipsis",this.lineClamp=l==null?void 0:l.lineClamp,this.noWrap=(l==null?void 0:l.whiteSpace)==="nowrap"}buildSVG(){let q=this.svgElement,l=q.element,p=q.renderer,y=Ad(q.textStr,"").toString(),T=y.indexOf("<")!==-1,A=l.childNodes,P=!q.added&&p.box,I=[y,this.ellipsis,this.noWrap,this.textLineHeight,this.textOutline,q.getStyle("font-size"),q.styles.lineClamp,this.width].join(",");if(I!==q.textCache){q.textCache=I,delete q.actualWidth;for(let B=A.length;B--;)l.removeChild(A[B]);if(T||this.ellipsis||this.width||q.textPath||y.indexOf(" ")!==-1&&(!this.noWrap||/<br.*?>/g.test(y))){if(y!==""){P&&P.appendChild(l);let B=new Gn(y);this.modifyTree(B.nodes),B.addToDOM(l),this.modifyDOM(),this.ellipsis&&(l.textContent||"").indexOf("…")!==-1&&q.attr("title",this.unescapeEntities(q.textStr||"",["&lt;","&gt;"])),P&&P.removeChild(l)}}else l.appendChild(Ba.createTextNode(this.unescapeEntities(y)));Kd(this.textOutline)&&q.applyTextOutline&&q.applyTextOutline(this.textOutline)}}modifyDOM(){let q,l=this.svgElement,p=sd(l.element,"x");for(l.firstLineMetrics=void 0;(q=l.element.firstChild)&&/^[\s\u200B]*$/.test(q.textContent||" ");)l.element.removeChild(q);[].forEach.call(l.element.querySelectorAll("tspan.highcharts-br"),(P,I)=>{P.nextSibling&&P.previousSibling&&(I===0&&P.previousSibling.nodeType===1&&(l.firstLineMetrics=l.renderer.fontMetrics(P.previousSibling)),sd(P,{dy:this.getLineHeight(P.nextSibling),x:p}))});let y=this.width||0;if(!y)return;let T=(P,I)=>{var De;let B=P.textContent||"",X=B.replace(/([^\^])-/g,"$1- ").split(" "),re=!this.noWrap&&(X.length>1||l.element.childNodes.length>1),te=this.getLineHeight(I),pe=Math.max(0,y-.8*te),_e=0,Ee=l.actualWidth;if(re){let Re=[],Be=[];for(;I.firstChild&&I.firstChild!==P;)Be.push(I.firstChild),I.removeChild(I.firstChild);for(;X.length;)if(X.length&&!this.noWrap&&_e>0&&(Re.push(P.textContent||""),P.textContent=X.join(" ").replace(/- /g,"-")),this.truncate(P,void 0,X,_e===0&&Ee||0,y,pe,(Ze,rt)=>X.slice(0,rt).join(" ").replace(/- /g,"-")),Ee=l.actualWidth,_e++,this.lineClamp&&_e>=this.lineClamp){X.length&&(this.truncate(P,P.textContent||"",void 0,0,y,pe,Wa),P.textContent=((De=P.textContent)==null?void 0:De.replace("…",""))+"…");break}Be.forEach(Ze=>{I.insertBefore(Ze,P)}),Re.forEach(Ze=>{I.insertBefore(Ba.createTextNode(Ze),P);let rt=Ba.createElementNS(Xn,"tspan");rt.textContent="​",sd(rt,{dy:te,x:p}),I.insertBefore(rt,P)})}else this.ellipsis&&B&&this.truncate(P,B,void 0,0,y,pe,Wa)},A=P=>{[].slice.call(P.childNodes).forEach(I=>{I.nodeType===Hf.Node.TEXT_NODE?T(I,P):(I.className.baseVal.indexOf("highcharts-br")!==-1&&(l.actualWidth=0),A(I))})};A(l.element)}getLineHeight(q){let l=q.nodeType===Hf.Node.TEXT_NODE?q.parentElement:q;return this.textLineHeight?parseInt(this.textLineHeight.toString(),10):this.renderer.fontMetrics(l||this.svgElement.element).h}modifyTree(q){let l=(p,y)=>{let{attributes:T={},children:A,style:P={},tagName:I}=p,B=this.renderer.styledMode;if(I==="b"||I==="strong"?B?T.class="highcharts-strong":P.fontWeight="bold":(I==="i"||I==="em")&&(B?T.class="highcharts-emphasized":P.fontStyle="italic"),P!=null&&P.color&&(P.fill=P.color),I==="br"){T.class="highcharts-br",p.textContent="​";let X=q[y+1];X!=null&&X.textContent&&(X.textContent=X.textContent.replace(/^ +/gm,""))}else I==="a"&&A&&A.some(X=>X.tagName==="#text")&&(p.children=[{children:A,tagName:"tspan"}]);I!=="#text"&&I!=="a"&&(p.tagName="tspan"),Zd(p,{attributes:T,style:P}),A&&A.filter(X=>X.tagName!=="#text").forEach(l)};q.forEach(l),Vp(this.svgElement,"afterModifyTree",{nodes:q})}truncate(q,l,p,y,T,A,P){let I,B,X=this.svgElement,{rotation:re}=X,te=[],pe=p&&!y?1:0,_e=(l||p||"").length,Ee=_e;p||(T=A);let De=function(Re,Be){let Ze=Be||Re,rt=q.parentNode;if(rt&&te[Ze]===void 0&&rt.getSubStringLength)try{te[Ze]=y+rt.getSubStringLength(0,p?Ze+1:Ze)}catch{}return te[Ze]};if(X.rotation=0,y+(B=De(q.textContent.length))>T){for(;pe<=_e;)Ee=Math.ceil((pe+_e)/2),p&&(I=P(p,Ee)),B=De(Ee,I&&I.length-1),pe===_e?pe=_e+1:B>T?_e=Ee-1:pe=Ee;_e===0?q.textContent="":l&&_e===l.length-1||(q.textContent=I||P(l||p,Ee)),this.ellipsis&&B>T&&this.truncate(q,q.textContent||"",void 0,0,T,A,Wa)}p&&p.splice(0,Ee),X.actualWidth=B,X.rotation=re}unescapeEntities(q,l){return Tl(this.renderer.escapes,function(p,y){l&&l.indexOf(p)!==-1||(q=q.toString().replace(RegExp(p,"g"),y))}),q}},{defaultOptions:cl}=Ra,{charts:gp,deg2rad:Fr,doc:cs,isFirefox:Jh,isMS:hr,isWebKit:An,noop:Qh,SVG_NS:Zs,symbolSizes:ec,win:Ql}=pi,{addEvent:rd,attr:Rc,createElement:tc,crisp:Qa,css:ic,defined:Aa,destroyObjectProperties:df,extend:eh,isArray:zl,isNumber:hh,isObject:uf,isString:Qd,merge:eu,pick:yc,pInt:kd,replaceNested:xc,uniqueKey:Xf}=Ps;class Bc{constructor(l,p,y,T,A,P,I){let B,X;this.x=0,this.y=0;let re=this.createElement("svg").attr({version:"1.1",class:"highcharts-root"}),te=re.element;I||re.css(this.getStyle(T||{})),l.appendChild(te),Rc(l,"dir","ltr"),l.innerHTML.indexOf("xmlns")===-1&&Rc(te,"xmlns",this.SVG_NS),this.box=te,this.boxWrapper=re,this.alignedObjects=[],this.url=this.getReferenceURL(),this.createElement("desc").add().element.appendChild(cs.createTextNode("Created with Highcharts 12.3.0")),this.defs=this.createElement("defs").add(),this.allowHTML=P,this.forExport=A,this.styledMode=I,this.gradients={},this.cache={},this.cacheKeys=[],this.imgCount=0,this.rootFontSize=re.getStyle("font-size"),this.setSize(p,y,!1),Jh&&l.getBoundingClientRect&&((B=function(){ic(l,{left:0,top:0}),X=l.getBoundingClientRect(),ic(l,{left:Math.ceil(X.left)-X.left+"px",top:Math.ceil(X.top)-X.top+"px"})})(),this.unSubPixelFix=rd(Ql,"resize",B))}definition(l){return new Gn([l]).addToDOM(this.defs.element)}getReferenceURL(){if((Jh||An)&&cs.getElementsByTagName("base").length){if(!Aa(Ht)){let l=Xf(),p=new Gn([{tagName:"svg",attributes:{width:8,height:8},children:[{tagName:"defs",children:[{tagName:"clipPath",attributes:{id:l},children:[{tagName:"rect",attributes:{width:4,height:4}}]}]},{tagName:"rect",attributes:{id:"hitme",width:8,height:8,"clip-path":`url(#${l})`,fill:"rgba(0,0,0,0.001)"}}]}]).addToDOM(cs.body);ic(p,{position:"fixed",top:0,left:0,zIndex:9e5});let y=cs.elementFromPoint(6,6);Ht=(y==null?void 0:y.id)==="hitme",cs.body.removeChild(p)}if(Ht)return xc(Ql.location.href.split("#")[0],[/<[^>]*>/g,""],[/([\('\)])/g,"\\$1"],[/ /g,"%20"])}return""}getStyle(l){return this.style=eh({fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif',fontSize:"1rem"},l),this.style}setStyle(l){this.boxWrapper.css(this.getStyle(l))}isHidden(){return!this.boxWrapper.getBBox().width}destroy(){let l=this.defs;return this.box=null,this.boxWrapper=this.boxWrapper.destroy(),df(this.gradients||{}),this.gradients=null,this.defs=l.destroy(),this.unSubPixelFix&&this.unSubPixelFix(),this.alignedObjects=null,null}createElement(l){return new this.Element(this,l)}getRadialAttr(l,p){return{cx:l[0]-l[2]/2+(p.cx||0)*l[2],cy:l[1]-l[2]/2+(p.cy||0)*l[2],r:(p.r||0)*l[2]}}shadowDefinition(l){let p=[`highcharts-drop-shadow-${this.chartIndex}`,...Object.keys(l).map(T=>`${T}-${l[T]}`)].join("-").toLowerCase().replace(/[^a-z\d\-]/g,""),y=eu({color:"#000000",offsetX:1,offsetY:1,opacity:.15,width:5},l);return this.defs.element.querySelector(`#${p}`)||this.definition({tagName:"filter",attributes:{id:p,filterUnits:y.filterUnits},children:this.getShadowFilterContent(y)}),p}getShadowFilterContent(l){return[{tagName:"feDropShadow",attributes:{dx:l.offsetX,dy:l.offsetY,"flood-color":l.color,"flood-opacity":Math.min(5*l.opacity,1),stdDeviation:l.width/2}}]}buildText(l){new Jd(l).buildSVG()}getContrast(l){if(l==="transparent")return"#000000";let p=at.parse(l).rgba,y=" clamp(0,calc(9e9*(0.5 - (0.2126*r + 0.7152*g + 0.0722*b))),1)";if(hh(p[0])||!at.useColorMix){let T=p.map(P=>{let I=P/255;return I<=.04?I/12.92:Math.pow((I+.055)/1.055,2.4)}),A=.2126*T[0]+.7152*T[1]+.0722*T[2];return 1.05/(A+.05)>(A+.05)/.05?"#FFFFFF":"#000000"}return"color(from "+l+" srgb"+y+y+y+")"}button(l,p,y,T,A={},P,I,B,X,re){let te=this.label(l,p,y,X,void 0,void 0,re,void 0,"button"),pe=this.styledMode,_e=arguments,Ee=0;A=eu(cl.global.buttonTheme,A),pe&&(delete A.fill,delete A.stroke,delete A["stroke-width"]);let De=A.states||{},Re=A.style||{};delete A.states,delete A.style;let Be=[Gn.filterUserAttributes(A)],Ze=[Re];return pe||["hover","select","disabled"].forEach((rt,Yt)=>{Be.push(eu(Be[0],Gn.filterUserAttributes(_e[Yt+5]||De[rt]||{}))),Ze.push(Be[Yt+1].style),delete Be[Yt+1].style}),rd(te.element,hr?"mouseover":"mouseenter",function(){Ee!==3&&te.setState(1)}),rd(te.element,hr?"mouseout":"mouseleave",function(){Ee!==3&&te.setState(Ee)}),te.setState=(rt=0)=>{if(rt!==1&&(te.state=Ee=rt),te.removeClass(/highcharts-button-(normal|hover|pressed|disabled)/).addClass("highcharts-button-"+["normal","hover","pressed","disabled"][rt]),!pe){te.attr(Be[rt]);let Yt=Ze[rt];uf(Yt)&&te.css(Yt)}},te.attr(Be[0]),!pe&&(te.css(eh({cursor:"default"},Re)),re&&te.text.css({pointerEvents:"none"})),te.on("touchstart",rt=>rt.stopPropagation()).on("click",function(rt){Ee!==3&&(T==null||T.call(te,rt))})}crispLine(l,p){let[y,T]=l;return Aa(y[1])&&y[1]===T[1]&&(y[1]=T[1]=Qa(y[1],p)),Aa(y[2])&&y[2]===T[2]&&(y[2]=T[2]=Qa(y[2],p)),l}path(l){let p=this.styledMode?{}:{fill:"none"};return zl(l)?p.d=l:uf(l)&&eh(p,l),this.createElement("path").attr(p)}circle(l,p,y){let T=uf(l)?l:l===void 0?{}:{x:l,y:p,r:y},A=this.createElement("circle");return A.xSetter=A.ySetter=function(P,I,B){B.setAttribute("c"+I,P)},A.attr(T)}arc(l,p,y,T,A,P){let I;uf(l)?(p=(I=l).y,y=I.r,T=I.innerR,A=I.start,P=I.end,l=I.x):I={innerR:T,start:A,end:P};let B=this.symbol("arc",l,p,y,y,I);return B.r=y,B}rect(l,p,y,T,A,P){let I=uf(l)?l:l===void 0?{}:{x:l,y:p,r:A,width:Math.max(y||0,0),height:Math.max(T||0,0)},B=this.createElement("rect");return this.styledMode||(P!==void 0&&(I["stroke-width"]=P,eh(I,B.crisp(I))),I.fill="none"),B.rSetter=function(X,re,te){B.r=X,Rc(te,{rx:X,ry:X})},B.rGetter=function(){return B.r||0},B.attr(I)}roundedRect(l){return this.symbol("roundedRect").attr(l)}setSize(l,p,y){this.width=l,this.height=p,this.boxWrapper.animate({width:l,height:p},{step:function(){this.attr({viewBox:"0 0 "+this.attr("width")+" "+this.attr("height")})},duration:yc(y,!0)?void 0:0}),this.alignElements()}g(l){let p=this.createElement("g");return l?p.attr({class:"highcharts-"+l}):p}image(l,p,y,T,A,P){let I={preserveAspectRatio:"none"};hh(p)&&(I.x=p),hh(y)&&(I.y=y),hh(T)&&(I.width=T),hh(A)&&(I.height=A);let B=this.createElement("image").attr(I),X=function(re){B.attr({href:l}),P.call(B,re)};if(P){B.attr({href:"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="});let re=new Ql.Image;rd(re,"load",X),re.src=l,re.complete&&X({})}else B.attr({href:l});return B}symbol(l,p,y,T,A,P){var Re,Be;let I,B,X,re,te=this,pe=/^url\((.*?)\)$/,_e=pe.test(l),Ee=!_e&&(this.symbols[l]?l:"circle"),De=Ee&&this.symbols[Ee];if(De)typeof p=="number"&&(B=De.call(this.symbols,p||0,y||0,T||0,A||0,P)),I=this.path(B),te.styledMode||I.attr("fill","none"),eh(I,{symbolName:Ee||void 0,x:p,y,width:T,height:A}),P&&eh(I,P);else if(_e){X=l.match(pe)[1];let Ze=I=this.image(X);Ze.imgwidth=yc(P==null?void 0:P.width,(Re=ec[X])==null?void 0:Re.width),Ze.imgheight=yc(P==null?void 0:P.height,(Be=ec[X])==null?void 0:Be.height),re=rt=>rt.attr({width:rt.width,height:rt.height}),["width","height"].forEach(rt=>{Ze[`${rt}Setter`]=function(Yt,Ut){this[Ut]=Yt;let{alignByTranslate:Xt,element:Ci,width:di,height:vi,imgwidth:es,imgheight:ws}=this,As=Ut==="width"?es:ws,$s=1;P&&P.backgroundSize==="within"&&di&&vi&&es&&ws?($s=Math.min(di/es,vi/ws),Rc(Ci,{width:Math.round(es*$s),height:Math.round(ws*$s)})):Ci&&As&&Ci.setAttribute(Ut,As),!Xt&&es&&ws&&this.translate(((di||0)-es*$s)/2,((vi||0)-ws*$s)/2)}}),Aa(p)&&Ze.attr({x:p,y}),Ze.isImg=!0,Ze.symbolUrl=l,Aa(Ze.imgwidth)&&Aa(Ze.imgheight)?re(Ze):(Ze.attr({width:0,height:0}),tc("img",{onload:function(){let rt=gp[te.chartIndex];this.width===0&&(ic(this,{position:"absolute",top:"-999em"}),cs.body.appendChild(this)),ec[X]={width:this.width,height:this.height},Ze.imgwidth=this.width,Ze.imgheight=this.height,Ze.element&&re(Ze),this.parentNode&&this.parentNode.removeChild(this),te.imgCount--,te.imgCount||!rt||rt.hasLoaded||rt.onload()},src:X}),this.imgCount++)}return I}clipRect(l,p,y,T){return this.rect(l,p,y,T,0)}text(l,p,y,T){let A={};if(T&&(this.allowHTML||!this.forExport))return this.html(l,p,y);A.x=Math.round(p||0),y&&(A.y=Math.round(y)),Aa(l)&&(A.text=l);let P=this.createElement("text").attr(A);return T&&(!this.forExport||this.allowHTML)||(P.xSetter=function(I,B,X){let re=X.getElementsByTagName("tspan"),te=X.getAttribute(B);for(let pe=0,_e;pe<re.length;pe++)(_e=re[pe]).getAttribute(B)===te&&_e.setAttribute(B,I);X.setAttribute(B,I)}),P}fontMetrics(l){let p=kd(js.prototype.getStyle.call(l,"font-size")||0),y=p<24?p+3:Math.round(1.2*p),T=Math.round(.8*y);return{h:y,b:T,f:p}}rotCorr(l,p,y){let T=l;return p&&y&&(T=Math.max(T*Math.cos(p*Fr),4)),{x:-l/3*Math.sin(p*Fr),y:T}}pathToSegments(l){let p=[],y=[],T={A:8,C:7,H:2,L:3,M:3,Q:5,S:5,T:3,V:2};for(let A=0;A<l.length;A++)Qd(y[0])&&hh(l[A])&&y.length===T[y[0].toUpperCase()]&&l.splice(A,0,y[0].replace("M","L").replace("m","l")),typeof l[A]=="string"&&(y.length&&p.push(y.slice(0)),y.length=0),y.push(l[A]);return p.push(y.slice(0)),p}label(l,p,y,T,A,P,I,B,X){return new Qr(this,l,p,y,T,A,P,I,B,X)}alignElements(){this.alignedObjects.forEach(l=>l.align())}}eh(Bc.prototype,{Element:js,SVG_NS:Zs,escapes:{"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},symbols:gc,draw:Qh}),Xd.registerRendererType("svg",Bc,!0);let{composed:Am,isFirefox:Fc}=pi,{attr:Eu,css:Nc,createElement:rg,defined:Yf,extend:yp,getAlignFactor:sc,isNumber:Ed,pInt:Up,pushUnique:$f}=Ps;function qf(q,l,p){var T;let y=(T=this.div)==null?void 0:T.style;js.prototype[`${l}Setter`].call(this,q,l,p),y&&(p.style[l]=y[l]=q)}let Yl=(q,l)=>{var p;if(!q.div){let y=Eu(q.element,"class"),T=q.css,A=rg("div",y?{className:y}:void 0,{position:"absolute",left:`${q.translateX||0}px`,top:`${q.translateY||0}px`,...q.styles,display:q.display,opacity:q.opacity,visibility:q.visibility},((p=q.parentGroup)==null?void 0:p.div)||l);q.classSetter=(P,I,B)=>{B.setAttribute("class",P),A.className=P},q.translateXSetter=q.translateYSetter=(P,I)=>{q[I]=P,A.style[I==="translateX"?"left":"top"]=`${P}px`,q.doTransform=!0},q.scaleXSetter=q.scaleYSetter=(P,I)=>{q[I]=P,q.doTransform=!0},q.opacitySetter=q.visibilitySetter=qf,q.css=P=>(T.call(q,P),P.cursor&&(A.style.cursor=P.cursor),P.pointerEvents&&(A.style.pointerEvents=P.pointerEvents),q),q.on=function(){return js.prototype.on.apply({element:A,onEvents:q.onEvents},arguments),q},q.div=A}return q.div};class tu extends js{static compose(l){$f(Am,this.compose)&&(l.prototype.html=function(p,y,T){return new tu(this,"span").attr({text:p,x:Math.round(y),y:Math.round(T)})})}constructor(l,p){super(l,p),tu.useForeignObject?this.foreignObject=l.createElement("foreignObject").attr({zIndex:2}):this.css({position:"absolute",...l.styledMode?{}:{fontFamily:l.style.fontFamily,fontSize:l.style.fontSize}}),this.element.style.whiteSpace="nowrap"}getSpanCorrection(l,p,y){this.xCorr=-l*y,this.yCorr=-p}css(l){let p,{element:y}=this,T=y.tagName==="SPAN"&&l&&"width"in l,A=T&&l.width;return T&&(delete l.width,this.textWidth=Up(A)||void 0,p=!0),(l==null?void 0:l.textOverflow)==="ellipsis"&&(l.overflow="hidden",l.whiteSpace="nowrap"),l!=null&&l.lineClamp&&(l.display="-webkit-box",l.WebkitLineClamp=l.lineClamp,l.WebkitBoxOrient="vertical",l.overflow="hidden"),Ed(Number(l==null?void 0:l.fontSize))&&(l.fontSize+="px"),yp(this.styles,l),Nc(y,l),p&&this.updateTransform(),this}htmlGetBBox(){let{element:l}=this;return{x:l.offsetLeft,y:l.offsetTop,width:l.offsetWidth,height:l.offsetHeight}}updateTransform(){var Ze;if(!this.added){this.alignOnAdd=!0;return}let{element:l,foreignObject:p,oldTextWidth:y,renderer:T,rotation:A,rotationOriginX:P,rotationOriginY:I,scaleX:B,scaleY:X,styles:{display:re="inline-block",whiteSpace:te},textAlign:pe="left",textWidth:_e,translateX:Ee=0,translateY:De=0,x:Re=0,y:Be=0}=this;if(p||Nc(l,{marginLeft:`${Ee}px`,marginTop:`${De}px`}),l.tagName==="SPAN"){let rt,Yt=[A,pe,l.innerHTML,_e,this.textAlign].join(","),Ut=-(((Ze=this.parentGroup)==null?void 0:Ze.padding)*1)||0;if(_e!==y){let vi=this.textPxLength?this.textPxLength:(Nc(l,{width:"",whiteSpace:te||"nowrap"}),l.offsetWidth),es=_e||0,ws=l.style.textOverflow===""&&l.style.webkitLineClamp;(es>y||vi>es||ws)&&(/[\-\s\u00AD]/.test(l.textContent||l.innerText)||l.style.textOverflow==="ellipsis")&&(Nc(l,{width:(A||B||vi>es||ws)&&Ed(_e)?_e+"px":"auto",display:re,whiteSpace:te||"normal"}),this.oldTextWidth=_e)}p&&(Nc(l,{display:"inline-block",verticalAlign:"top"}),p.attr({width:T.width,height:T.height})),Yt!==this.cTT&&(rt=T.fontMetrics(l).b,Yf(A)&&!p&&(A!==(this.oldRotation||0)||pe!==this.oldAlign)&&Nc(l,{transform:`rotate(${A}deg)`,transformOrigin:`${Ut}% ${Ut}px`}),this.getSpanCorrection(!Yf(A)&&!this.textWidth&&this.textPxLength||l.offsetWidth,rt,sc(pe)));let{xCorr:Xt=0,yCorr:Ci=0}=this,di={left:`${Re+Xt}px`,top:`${Be+Ci}px`,textAlign:pe,transformOrigin:`${(P??Re)-Xt-Re-Ut}px ${(I??Be)-Ci-Be-Ut}px`};(B||X)&&(di.transform=`scale(${B??1},${X??1})`),p?(super.updateTransform(),Ed(Re)&&Ed(Be)?(p.attr({x:Re+Xt,y:Be+Ci,width:l.offsetWidth+3,height:l.offsetHeight,"transform-origin":l.getAttribute("transform-origin")||"0 0"}),Nc(l,{display:re,textAlign:pe})):Fc&&p.attr({width:0,height:0})):Nc(l,di),this.cTT=Yt,this.oldRotation=A,this.oldAlign=pe}}add(l){let{foreignObject:p,renderer:y}=this,T=y.box.parentNode,A=[];if(p)p.add(l),super.add(y.createElement("body").attr({xmlns:"http://www.w3.org/1999/xhtml"}).css({background:"transparent",margin:"0 3px 0 0"}).add(p));else{let P;if(this.parentGroup=l,l&&!(P=l.div)){let I=l;for(;I;)A.push(I),I=I.parentGroup;for(let B of A.reverse())P=Yl(B,T)}(P||T).appendChild(this.element)}return this.added=!0,this.alignOnAdd&&this.updateTransform(),this}textSetter(l){l!==this.textStr&&(delete this.bBox,delete this.oldTextWidth,Gn.setElementHTML(this.element,l??""),this.textStr=l,this.doTransform=!0)}alignSetter(l){this.alignValue=this.textAlign=l,this.doTransform=!0}xSetter(l,p){this[p]=l,this.doTransform=!0}}let od=tu.prototype;od.visibilitySetter=od.opacitySetter=qf,od.ySetter=od.rotationSetter=od.rotationOriginXSetter=od.rotationOriginYSetter=od.xSetter,function(q){q.xAxis={alignTicks:!0,allowDecimals:void 0,panningEnabled:!0,zIndex:2,zoomEnabled:!0,dateTimeLabelFormats:{millisecond:{main:"%[HMSL]",range:!1},second:{main:"%[HMS]",range:!1},minute:{main:"%[HM]",range:!1},hour:{main:"%[HM]",range:!1},day:{main:"%[eb]"},week:{main:"%[eb]"},month:{main:"%[bY]"},year:{main:"%Y"}},endOnTick:!1,gridLineDashStyle:"Solid",gridZIndex:1,labels:{autoRotationLimit:80,distance:15,enabled:!0,indentation:10,overflow:"justify",reserveSpace:void 0,rotation:void 0,staggerLines:0,step:0,useHTML:!1,zIndex:7,style:{color:"#333333",cursor:"default",fontSize:"0.8em",textOverflow:"ellipsis"}},maxPadding:.01,minorGridLineDashStyle:"Solid",minorTickLength:2,minorTickPosition:"outside",minorTicksPerMajor:5,minPadding:.01,offset:void 0,reversed:void 0,reversedStacks:!1,showEmpty:!0,showFirstLabel:!0,showLastLabel:!0,startOfWeek:1,startOnTick:!1,tickLength:10,tickPixelInterval:100,tickmarkPlacement:"between",tickPosition:"outside",title:{align:"middle",useHTML:!1,x:0,y:0,style:{color:"#666666",fontSize:"0.8em"}},visible:!0,minorGridLineColor:"#f2f2f2",minorGridLineWidth:1,minorTickColor:"#999999",lineColor:"#333333",lineWidth:1,gridLineColor:"#e6e6e6",gridLineWidth:void 0,tickColor:"#333333"},q.yAxis={reversedStacks:!0,endOnTick:!0,maxPadding:.05,minPadding:.05,tickPixelInterval:72,showLastLabel:!0,labels:{x:void 0},startOnTick:!0,title:{},stackLabels:{animation:{},allowOverlap:!1,enabled:!1,crop:!0,overflow:"justify",formatter:function(){let{numberFormatter:l}=this.axis.chart;return l(this.total||0,-1)},style:{color:"#000000",fontSize:"0.7em",fontWeight:"bold",textOutline:"1px contrast"}},gridLineWidth:1,lineWidth:0}}(Ni||(Ni={}));let jp=Ni,{addEvent:Cu,isFunction:_c,objectEach:nd,removeEvent:pf}=Ps;(Ui||(Ui={})).registerEventOptions=function(q,l){q.eventOptions=q.eventOptions||{},nd(l.events,function(p,y){q.eventOptions[y]!==p&&(q.eventOptions[y]&&(pf(q,y,q.eventOptions[y]),delete q.eventOptions[y]),_c(p)&&(q.eventOptions[y]=p,Cu(q,y,p,{order:0})))})};let ch=Ui,{deg2rad:iu}=pi,{clamp:ns,correctFloat:Cd,defined:Pd,destroyObjectProperties:Zu,extend:Ih,fireEvent:Rl,getAlignFactor:vc,isNumber:bc,merge:xh,objectEach:jr,pick:rc}=Ps,Pu=class{constructor(q,l,p,y,T){this.isNew=!0,this.isNewLabel=!0,this.axis=q,this.pos=l,this.type=p||"",this.parameters=T||{},this.tickmarkOffset=this.parameters.tickmarkOffset,this.options=this.parameters.options,Rl(this,"init"),p||y||this.addLabel()}addLabel(){var Ci,di;let q=this,l=q.axis,p=l.options,y=l.chart,T=l.categories,A=l.logarithmic,P=l.names,I=q.pos,B=rc((Ci=q.options)==null?void 0:Ci.labels,p.labels),X=l.tickPositions,re=I===X[0],te=I===X[X.length-1],pe=(!B.step||B.step===1)&&l.tickInterval===1,_e=X.info,Ee=q.label,De,Re,Be,Ze=this.parameters.category||(T?rc(T[I],P[I],I):I);A&&bc(Ze)&&(Ze=Cd(A.lin2log(Ze))),l.dateTime&&(_e?De=(Re=y.time.resolveDTLFormat(p.dateTimeLabelFormats[!((di=p.grid)!=null&&di.enabled)&&_e.higherRanks[I]||_e.unitName])).main:bc(Ze)&&(De=l.dateTime.getXDateFormat(Ze,p.dateTimeLabelFormats||{}))),q.isFirst=re,q.isLast=te;let rt={axis:l,chart:y,dateTimeLabelFormat:De,isFirst:re,isLast:te,pos:I,tick:q,tickPositionInfo:_e,value:Ze};Rl(this,"labelFormat",rt);let Yt=vi=>B.formatter?B.formatter.call(vi,vi):B.format?(vi.text=l.defaultLabelFormatter.call(vi),fa.format(B.format,vi,y)):l.defaultLabelFormatter.call(vi),Ut=Yt.call(rt,rt),Xt=Re==null?void 0:Re.list;Xt?q.shortenLabel=function(){for(Be=0;Be<Xt.length;Be++)if(Ih(rt,{dateTimeLabelFormat:Xt[Be]}),Ee.attr({text:Yt.call(rt,rt)}),Ee.getBBox().width<l.getSlotWidth(q)-2*(B.padding||0))return;Ee.attr({text:""})}:q.shortenLabel=void 0,pe&&l._addedPlotLB&&q.moveLabel(Ut,B),Pd(Ee)||q.movedLabel?Ee&&Ee.textStr!==Ut&&!pe&&(!Ee.textWidth||B.style.width||Ee.styles.width||Ee.css({width:null}),Ee.attr({text:Ut}),Ee.textPxLength=Ee.getBBox().width):(q.label=Ee=q.createLabel(Ut,B),q.rotation=0)}createLabel(q,l,p){let y=this.axis,{renderer:T,styledMode:A}=y.chart,P=l.style.whiteSpace,I=Pd(q)&&l.enabled?T.text(q,p==null?void 0:p.x,p==null?void 0:p.y,l.useHTML).add(y.labelGroup):void 0;return I&&(A||I.css(xh(l.style)),I.textPxLength=I.getBBox().width,!A&&P&&I.css({whiteSpace:P})),I}destroy(){Zu(this,this.axis)}getPosition(q,l,p,y){let T=this.axis,A=T.chart,P=y&&A.oldChartHeight||A.chartHeight,I={x:q?Cd(T.translate(l+p,void 0,void 0,y)+T.transB):T.left+T.offset+(T.opposite?(y&&A.oldChartWidth||A.chartWidth)-T.right-T.left:0),y:q?P-T.bottom+T.offset-(T.opposite?T.height:0):Cd(P-T.translate(l+p,void 0,void 0,y)-T.transB)};return I.y=ns(I.y,-1e9,1e9),Rl(this,"afterGetPosition",{pos:I}),I}getLabelPosition(q,l,p,y,T,A,P,I){let B,X,re=this.axis,te=re.transA,pe=re.isLinked&&re.linkedParent?re.linkedParent.reversed:re.reversed,_e=re.staggerLines,Ee=re.tickRotCorr||{x:0,y:0},De=y||re.reserveSpaceDefault?0:-re.labelOffset*(re.labelAlign==="center"?.5:1),Re=T.distance,Be={};return B=re.side===0?p.rotation?-Re:-p.getBBox().height:re.side===2?Ee.y+Re:Math.cos(p.rotation*iu)*(Ee.y-p.getBBox(!1,0).height/2),Pd(T.y)&&(B=re.side===0&&re.horiz?T.y+B:T.y),q=q+rc(T.x,[0,1,0,-1][re.side]*Re)+De+Ee.x-(A&&y?A*te*(pe?-1:1):0),l=l+B-(A&&!y?A*te*(pe?1:-1):0),_e&&(X=P/(I||1)%_e,re.opposite&&(X=_e-X-1),l+=X*(re.labelOffset/_e)),Be.x=q,Be.y=Math.round(l),Rl(this,"afterGetLabelPosition",{pos:Be,tickmarkOffset:A,index:P}),Be}getLabelSize(){return this.label?this.label.getBBox()[this.axis.horiz?"height":"width"]:0}getMarkPath(q,l,p,y,T=!1,A){return A.crispLine([["M",q,l],["L",q+(T?0:-p),l+(T?p:0)]],y)}handleOverflow(q){var Re;let l=this.axis,p=l.options.labels,y=q.x,T=l.chart.chartWidth,A=l.chart.spacing,P=rc(l.labelLeft,Math.min(l.pos,A[3])),I=rc(l.labelRight,Math.max(l.isRadial?0:l.pos+l.len,T-A[1])),B=this.label,X=this.rotation,re=vc(l.labelAlign||B.attr("align")),te=B.getBBox().width,pe=l.getSlotWidth(this),_e=pe,Ee=1,De;X||p.overflow!=="justify"?X<0&&y-re*te<P?De=Math.round(y/Math.cos(X*iu)-P):X>0&&y+re*te>I&&(De=Math.round((T-y)/Math.cos(X*iu))):(y-re*te<P?_e=q.x+_e*(1-re)-P:y+(1-re)*te>I&&(_e=I-q.x+_e*re,Ee=-1),(_e=Math.min(pe,_e))<pe&&l.labelAlign==="center"&&(q.x+=Ee*(pe-_e-re*(pe-Math.min(te,_e)))),(te>_e||l.autoRotation&&((Re=B==null?void 0:B.styles)!=null&&Re.width))&&(De=_e)),De&&B&&(this.shortenLabel?this.shortenLabel():B.css(Ih({},{width:Math.floor(De)+"px",lineClamp:+!l.isRadial})))}moveLabel(q,l){let p=this,y=p.label,T=p.axis,A=!1,P;y&&y.textStr===q?(p.movedLabel=y,A=!0,delete p.label):jr(T.ticks,function(I){A||I.isNew||I===p||!I.label||I.label.textStr!==q||(p.movedLabel=I.label,A=!0,I.labelPos=p.movedLabel.xy,delete I.label)}),!A&&(p.labelPos||y)&&(P=p.labelPos||y.xy,p.movedLabel=p.createLabel(q,l,P),p.movedLabel&&p.movedLabel.attr({opacity:0}))}render(q,l,p){var Ee;let y=this.axis,T=y.horiz,A=this.pos,P=rc(this.tickmarkOffset,y.tickmarkOffset),I=this.getPosition(T,A,P,l),B=I.x,X=I.y,re=y.pos,te=re+y.len,pe=T?B:X,_e=rc(p,(Ee=this.label)==null?void 0:Ee.newOpacity,1);!y.chart.polar&&(Cd(pe)<re||pe>te)&&(p=0),p??(p=1),this.isActive=!0,this.renderGridLine(l,p),this.renderMark(I,p),this.renderLabel(I,l,_e,q),this.isNew=!1,Rl(this,"afterRender")}renderGridLine(q,l){let p=this.axis,y=p.options,T={},A=this.pos,P=this.type,I=rc(this.tickmarkOffset,p.tickmarkOffset),B=p.chart.renderer,X=this.gridLine,re,te=y.gridLineWidth,pe=y.gridLineColor,_e=y.gridLineDashStyle;this.type==="minor"&&(te=y.minorGridLineWidth,pe=y.minorGridLineColor,_e=y.minorGridLineDashStyle),X||(p.chart.styledMode||(T.stroke=pe,T["stroke-width"]=te||0,T.dashstyle=_e),P||(T.zIndex=1),q&&(l=0),this.gridLine=X=B.path().attr(T).addClass("highcharts-"+(P?P+"-":"")+"grid-line").add(p.gridGroup)),X&&(re=p.getPlotLinePath({value:A+I,lineWidth:X.strokeWidth(),force:"pass",old:q,acrossPanes:!1}))&&X[q||this.isNew?"attr":"animate"]({d:re,opacity:l})}renderMark(q,l){let p=this.axis,y=p.options,T=p.chart.renderer,A=this.type,P=p.tickSize(A?A+"Tick":"tick"),I=q.x,B=q.y,X=rc(y[A!=="minor"?"tickWidth":"minorTickWidth"],!A&&p.isXAxis?1:0),re=y[A!=="minor"?"tickColor":"minorTickColor"],te=this.mark,pe=!te;P&&(p.opposite&&(P[0]=-P[0]),!te&&(this.mark=te=T.path().addClass("highcharts-"+(A?A+"-":"")+"tick").add(p.axisGroup),p.chart.styledMode||te.attr({stroke:re,"stroke-width":X})),te[pe?"attr":"animate"]({d:this.getMarkPath(I,B,P[0],te.strokeWidth(),p.horiz,T),opacity:l}))}renderLabel(q,l,p,y){let T=this.axis,A=T.horiz,P=T.options,I=this.label,B=P.labels,X=B.step,re=rc(this.tickmarkOffset,T.tickmarkOffset),te=q.x,pe=q.y,_e=!0;I&&bc(te)&&(I.xy=q=this.getLabelPosition(te,pe,I,A,B,re,y,X),(!this.isFirst||this.isLast||P.showFirstLabel)&&(!this.isLast||this.isFirst||P.showLastLabel)?!A||B.step||B.rotation||l||p===0||this.handleOverflow(q):_e=!1,X&&y%X&&(_e=!1),_e&&bc(q.y)?(q.opacity=p,I[this.isNewLabel?"attr":"animate"](q).show(!0),this.isNewLabel=!1):(I.hide(),this.isNewLabel=!0))}replaceMovedLabel(){let q=this.label,l=this.axis;q&&!this.isNew&&(q.animate({opacity:0},void 0,q.destroy),delete this.label),l.isDirty=!0,this.label=this.movedLabel,delete this.movedLabel}},{animObject:ff}=to,{xAxis:mf,yAxis:ad}=jp,{defaultOptions:ho}=Ra,{registerEventOptions:ka}=ch,{deg2rad:Zf}=pi,{arrayMax:km,arrayMin:su,clamp:Gp,correctFloat:vn,defined:ea,destroyObjectProperties:Vc,erase:Uc,error:Dr,extend:Un,fireEvent:ln,getClosestDistance:oc,insertItem:Iu,isArray:yo,isNumber:sr,isString:nc,merge:Id,normalizeTickInterval:ru,objectEach:Hr,pick:vo,relativeLength:ou,removeEvent:Wp,splat:xp,syncTimeout:Ro}=Ps,_p=(q,l)=>ru(l,void 0,void 0,vo(q.options.allowDecimals,l<.5||q.tickAmount!==void 0),!!q.tickAmount);Un(ho,{xAxis:mf,yAxis:Id(mf,ad)});class Ku{constructor(l,p,y){this.init(l,p,y)}init(l,p,y=this.coll){let T=y==="xAxis",A=this.isZAxis||(l.inverted?!T:T);this.chart=l,this.horiz=A,this.isXAxis=T,this.coll=y,ln(this,"init",{userOptions:p}),this.opposite=vo(p.opposite,this.opposite),this.side=vo(p.side,this.side,A?2*!this.opposite:this.opposite?1:3),this.setOptions(p);let P=this.options,I=P.labels;this.type??(this.type=P.type||"linear"),this.uniqueNames??(this.uniqueNames=P.uniqueNames??!0),ln(this,"afterSetType"),this.userOptions=p,this.minPixelPadding=0,this.reversed=vo(P.reversed,this.reversed),this.visible=P.visible,this.zoomEnabled=P.zoomEnabled,this.hasNames=this.type==="category"||P.categories===!0,this.categories=yo(P.categories)&&P.categories||(this.hasNames?[]:void 0),this.names||(this.names=[],this.names.keys={}),this.plotLinesAndBandsGroups={},this.positiveValuesOnly=!!this.logarithmic,this.isLinked=ea(P.linkedTo),this.ticks={},this.labelEdge=[],this.minorTicks={},this.plotLinesAndBands=[],this.alternateBands={},this.len??(this.len=0),this.minRange=this.userMinRange=P.minRange||P.maxZoom,this.range=P.range,this.offset=P.offset||0,this.max=void 0,this.min=void 0;let B=vo(P.crosshair,xp(l.options.tooltip.crosshairs)[+!T]);this.crosshair=B===!0?{}:B,l.axes.indexOf(this)===-1&&(T?l.axes.splice(l.xAxis.length,0,this):l.axes.push(this),Iu(this,l[this.coll])),l.orderItems(this.coll),this.series=this.series||[],l.inverted&&!this.isZAxis&&T&&!ea(this.reversed)&&(this.reversed=!0),this.labelRotation=sr(I.rotation)?I.rotation:void 0,ka(this,P),ln(this,"afterInit")}setOptions(l){let p=this.horiz?{labels:{autoRotation:[-45],padding:3},margin:15}:{labels:{padding:1},title:{rotation:90*this.side}};this.options=Id(p,this.coll==="yAxis"?{title:{text:this.chart.options.lang.yAxisTitle}}:{},ho[this.coll],l),ln(this,"afterSetOptions",{userOptions:l})}defaultLabelFormatter(){let l=this.axis,{numberFormatter:p}=this.chart,y=sr(this.value)?this.value:NaN,T=l.chart.time,A=l.categories,P=this.dateTimeLabelFormat,I=ho.lang,B=I.numericSymbols,X=I.numericSymbolMagnitude||1e3,re=l.logarithmic?Math.abs(y):l.tickInterval,te=B==null?void 0:B.length,pe,_e;if(A)_e=`${this.value}`;else if(P)_e=T.dateFormat(P,y,!0);else if(te&&B&&re>=1e3)for(;te--&&_e===void 0;)re>=(pe=Math.pow(X,te+1))&&10*y%pe==0&&B[te]!==null&&y!==0&&(_e=p(y/pe,-1)+B[te]);return _e===void 0&&(_e=Math.abs(y)>=1e4?p(y,-1):p(y,-1,void 0,"")),_e}getSeriesExtremes(){let l,p=this;ln(this,"getSeriesExtremes",null,function(){p.hasVisibleSeries=!1,p.dataMin=p.dataMax=p.threshold=void 0,p.softThreshold=!p.isXAxis,p.series.forEach(y=>{if(y.reserveSpace()){let T=y.options,A,P=T.threshold,I,B;if(p.hasVisibleSeries=!0,p.positiveValuesOnly&&0>=(P||0)&&(P=void 0),p.isXAxis)(A=y.getColumn("x")).length&&(A=p.logarithmic?A.filter(X=>X>0):A,I=(l=y.getXExtremes(A)).min,B=l.max,sr(I)||I instanceof Date||(A=A.filter(sr),I=(l=y.getXExtremes(A)).min,B=l.max),A.length&&(p.dataMin=Math.min(vo(p.dataMin,I),I),p.dataMax=Math.max(vo(p.dataMax,B),B)));else{let X=y.applyExtremes();sr(X.dataMin)&&(I=X.dataMin,p.dataMin=Math.min(vo(p.dataMin,I),I)),sr(X.dataMax)&&(B=X.dataMax,p.dataMax=Math.max(vo(p.dataMax,B),B)),ea(P)&&(p.threshold=P),(!T.softThreshold||p.positiveValuesOnly)&&(p.softThreshold=!1)}}})}),ln(this,"afterGetSeriesExtremes")}translate(l,p,y,T,A,P){var De;let I=this.linkedParent||this,B=T&&I.old?I.old.min:I.min;if(!sr(B))return NaN;let X=I.minPixelPadding,re=(I.isOrdinal||((De=I.brokenAxis)==null?void 0:De.hasBreaks)||I.logarithmic&&A)&&I.lin2val,te=1,pe=0,_e=T&&I.old?I.old.transA:I.transA,Ee=0;return _e||(_e=I.transA),y&&(te*=-1,pe=I.len),I.reversed&&(te*=-1,pe-=te*(I.sector||I.len)),p?(Ee=(l=l*te+pe-X)/_e+B,re&&(Ee=I.lin2val(Ee))):(re&&(l=I.val2lin(l)),Ee=te*(l-B)*_e+pe+te*X+(sr(P)?_e*P:0),I.isRadial||(Ee=vn(Ee))),Ee}toPixels(l,p){var y;return this.translate(((y=this.chart)==null?void 0:y.time.parse(l))??NaN,!1,!this.horiz,void 0,!0)+(p?0:this.pos)}toValue(l,p){return this.translate(l-(p?0:this.pos),!0,!this.horiz,void 0,!0)}getPlotLinePath(l){let p=this,y=p.chart,T=p.left,A=p.top,P=l.old,I=l.value,B=l.lineWidth,X=P&&y.oldChartHeight||y.chartHeight,re=P&&y.oldChartWidth||y.chartWidth,te=p.transB,pe=l.translatedValue,_e=l.force,Ee,De,Re,Be,Ze;function rt(Ut,Xt,Ci){return _e!=="pass"&&(Ut<Xt||Ut>Ci)&&(_e?Ut=Gp(Ut,Xt,Ci):Ze=!0),Ut}let Yt={value:I,lineWidth:B,old:P,force:_e,acrossPanes:l.acrossPanes,translatedValue:pe};return ln(this,"getPlotLinePath",Yt,function(Ut){Ee=Re=(pe=Gp(pe=vo(pe,p.translate(I,void 0,void 0,P)),-1e9,1e9))+te,De=Be=X-pe-te,sr(pe)?p.horiz?(De=A,Be=X-p.bottom+(p.options.isInternal?0:y.scrollablePixelsY||0),Ee=Re=rt(Ee,T,T+p.width)):(Ee=T,Re=re-p.right+(y.scrollablePixelsX||0),De=Be=rt(De,A,A+p.height)):(Ze=!0,_e=!1),Ut.path=Ze&&!_e?void 0:y.renderer.crispLine([["M",Ee,De],["L",Re,Be]],B||1)}),Yt.path}getLinearTickPositions(l,p,y){let T,A,P,I=vn(Math.floor(p/l)*l),B=vn(Math.ceil(y/l)*l),X=[];if(vn(I+l)===I&&(P=20),this.single)return[p];for(T=I;T<=B&&(X.push(T),(T=vn(T+l,P))!==A);)A=T;return X}getMinorTickInterval(){let{minorTicks:l,minorTickInterval:p}=this.options;return l===!0?vo(p,"auto"):l!==!1?p:void 0}getMinorTickPositions(){var re;let l=this.options,p=this.tickPositions,y=this.minorTickInterval,T=this.pointRangePadding||0,A=(this.min||0)-T,P=(this.max||0)+T,I=(re=this.brokenAxis)!=null&&re.hasBreaks?this.brokenAxis.unitLength:P-A,B=[],X;if(I&&I/y<this.len/3){let te=this.logarithmic;if(te)this.paddedTicks.forEach(function(pe,_e,Ee){_e&&B.push.apply(B,te.getLogTickPositions(y,Ee[_e-1],Ee[_e],!0))});else if(this.dateTime&&this.getMinorTickInterval()==="auto")B=B.concat(this.getTimeTicks(this.dateTime.normalizeTimeTickInterval(y),A,P,l.startOfWeek));else for(X=A+(p[0]-A)%y;X<=P&&X!==B[0];X+=y)B.push(X)}return B.length!==0&&this.trimTicks(B),B}adjustForMinRange(){let l=this.options,p=this.logarithmic,y=this.chart.time,{max:T,min:A,minRange:P}=this,I,B,X,re;this.isXAxis&&P===void 0&&!p&&(P=ea(l.min)||ea(l.max)||ea(l.floor)||ea(l.ceiling)?null:Math.min(5*(oc(this.series.map(te=>{let pe=te.getColumn("x");return te.xIncrement?pe.slice(0,2):pe}))||0),this.dataMax-this.dataMin)),sr(T)&&sr(A)&&sr(P)&&T-A<P&&(B=this.dataMax-this.dataMin>=P,I=(P-T+A)/2,X=[A-I,y.parse(l.min)??A-I],B&&(X[2]=p?p.log2lin(this.dataMin):this.dataMin),re=[(A=km(X))+P,y.parse(l.max)??A+P],B&&(re[2]=p?p.log2lin(this.dataMax):this.dataMax),(T=su(re))-A<P&&(X[0]=T-P,X[1]=y.parse(l.min)??T-P,A=km(X))),this.minRange=P,this.min=A,this.max=T}getClosest(){let l,p;if(this.categories)p=1;else{let y=[];this.series.forEach(function(T){let A=T.closestPointRange,P=T.getColumn("x");P.length===1?y.push(P[0]):T.sorted&&ea(A)&&T.reserveSpace()&&(p=ea(p)?Math.min(p,A):A)}),y.length&&(y.sort((T,A)=>T-A),l=oc([y]))}return l&&p?Math.min(l,p):l||p}nameToX(l){let p=yo(this.options.categories),y=p?this.categories:this.names,T=l.options.x,A;return l.series.requireSorting=!1,ea(T)||(T=this.uniqueNames&&y?p?y.indexOf(l.name):vo(y.keys[l.name],-1):l.series.autoIncrement()),T===-1?!p&&y&&(A=y.length):sr(T)&&(A=T),A!==void 0?(this.names[A]=l.name,this.names.keys[l.name]=A):l.x&&(A=l.x),A}updateNames(){let l=this,p=this.names;p.length>0&&(Object.keys(p.keys).forEach(function(y){delete p.keys[y]}),p.length=0,this.minRange=this.userMinRange,(this.series||[]).forEach(y=>{y.xIncrement=null,(!y.points||y.isDirtyData)&&(l.max=Math.max(l.max||0,y.dataTable.rowCount-1),y.processData(),y.generatePoints());let T=y.getColumn("x").slice();y.data.forEach((A,P)=>{let I=T[P];A!=null&&A.options&&A.name!==void 0&&(I=l.nameToX(A))!==void 0&&I!==A.x&&(T[P]=A.x=I)}),y.dataTable.setColumn("x",T)}))}setAxisTranslation(){var pe;let l=this,p=l.max-l.min,y=l.linkedParent,T=!!l.categories,A=l.isXAxis,P=l.axisPointRange||0,I,B=0,X=0,re,te=l.transA;(A||T||P)&&(I=l.getClosest(),y?(B=y.minPointOffset,X=y.pointRangePadding):l.series.forEach(function(_e){let Ee=T?1:A?vo(_e.options.pointRange,I,0):l.axisPointRange||0,De=_e.options.pointPlacement;if(P=Math.max(P,Ee),!l.single||T){let Re=_e.is("xrange")?!A:A;B=Math.max(B,Re&&nc(De)?0:Ee/2),X=Math.max(X,Re&&De==="on"?0:Ee)}}),re=(pe=l.ordinal)!=null&&pe.slope&&I?l.ordinal.slope/I:1,l.minPointOffset=B*=re,l.pointRangePadding=X*=re,l.pointRange=Math.min(P,l.single&&T?1:p),A&&(l.closestPointRange=I)),l.translationSlope=l.transA=te=l.staticScale||l.len/(p+X||1),l.transB=l.horiz?l.left:l.bottom,l.minPixelPadding=te*B,ln(this,"afterSetAxisTranslation")}minFromRange(){let{max:l,min:p}=this;return sr(l)&&sr(p)&&l-p||void 0}setTickInterval(l){var pr,Vr,cr,Zr;let{categories:p,chart:y,dataMax:T,dataMin:A,dateTime:P,isXAxis:I,logarithmic:B,options:X,softThreshold:re}=this,te=y.time,pe=sr(this.threshold)?this.threshold:void 0,_e=this.minRange||0,{ceiling:Ee,floor:De,linkedTo:Re,softMax:Be,softMin:Ze}=X,rt=sr(Re)&&((pr=y[this.coll])==null?void 0:pr[Re]),Yt=X.tickPixelInterval,Ut=X.maxPadding,Xt=X.minPadding,Ci=0,di,vi=sr(X.tickInterval)&&X.tickInterval>=0?X.tickInterval:void 0,es,ws,As,$s;if(P||p||rt||this.getTickAmount(),As=vo(this.userMin,te.parse(X.min)),$s=vo(this.userMax,te.parse(X.max)),rt?(this.linkedParent=rt,di=rt.getExtremes(),this.min=vo(di.min,di.dataMin),this.max=vo(di.max,di.dataMax),this.type!==rt.type&&Dr(11,!0,y)):(re&&ea(pe)&&sr(T)&&sr(A)&&(A>=pe?(es=pe,Xt=0):T<=pe&&(ws=pe,Ut=0)),this.min=vo(As,es,A),this.max=vo($s,ws,T)),sr(this.max)&&sr(this.min)&&(B&&(this.positiveValuesOnly&&!l&&0>=Math.min(this.min,vo(A,this.min))&&Dr(10,!0,y),this.min=vn(B.log2lin(this.min),16),this.max=vn(B.log2lin(this.max),16)),this.range&&sr(A)&&(this.userMin=this.min=As=Math.max(A,this.minFromRange()||0),this.userMax=$s=this.max,this.range=void 0)),ln(this,"foundExtremes"),this.adjustForMinRange(),sr(this.min)&&sr(this.max)){if(!sr(this.userMin)&&sr(Ze)&&Ze<this.min&&(this.min=As=Ze),!sr(this.userMax)&&sr(Be)&&Be>this.max&&(this.max=$s=Be),p||this.axisPointRange||(Vr=this.stacking)!=null&&Vr.usePercentage||rt||(Ci=this.max-this.min)&&(!ea(As)&&Xt&&(this.min-=Ci*Xt),!ea($s)&&Ut&&(this.max+=Ci*Ut)),!sr(this.userMin)&&sr(De)&&(this.min=Math.max(this.min,De)),!sr(this.userMax)&&sr(Ee)&&(this.max=Math.min(this.max,Ee)),re&&sr(A)&&sr(T)){let Cn=pe||0;!ea(As)&&this.min<Cn&&A>=Cn?this.min=X.minRange?Math.min(Cn,this.max-_e):Cn:!ea($s)&&this.max>Cn&&T<=Cn&&(this.max=X.minRange?Math.max(Cn,this.min+_e):Cn)}!y.polar&&this.min>this.max&&(ea(X.min)?this.max=this.min:ea(X.max)&&(this.min=this.max)),Ci=this.max-this.min}if(this.min!==this.max&&sr(this.min)&&sr(this.max)?rt&&!vi&&Yt===rt.options.tickPixelInterval?this.tickInterval=vi=rt.tickInterval:this.tickInterval=vo(vi,this.tickAmount?Ci/Math.max(this.tickAmount-1,1):void 0,p?1:Ci*Yt/Math.max(this.len,Yt)):this.tickInterval=1,I&&!l){let Cn=this.min!==((cr=this.old)==null?void 0:cr.min)||this.max!==((Zr=this.old)==null?void 0:Zr.max);this.series.forEach(function(Qo){var en;Qo.forceCrop=(en=Qo.forceCropping)==null?void 0:en.call(Qo),Qo.processData(Cn)}),ln(this,"postProcessData",{hasExtremesChanged:Cn})}this.setAxisTranslation(),ln(this,"initialAxisTranslation"),this.pointRange&&!vi&&(this.tickInterval=Math.max(this.pointRange,this.tickInterval));let kr=vo(X.minTickInterval,P&&!this.series.some(Cn=>!Cn.sorted)?this.closestPointRange:0);!vi&&kr&&this.tickInterval<kr&&(this.tickInterval=kr),P||B||vi||(this.tickInterval=_p(this,this.tickInterval)),this.tickAmount||(this.tickInterval=this.unsquish()),this.setTickPositions()}setTickPositions(){var re,te;let l=this.options,p=l.tickPositions,y=l.tickPositioner,T=this.getMinorTickInterval(),A=!this.isPanning,P=A&&l.startOnTick,I=A&&l.endOnTick,B=[],X;if(this.tickmarkOffset=this.categories&&l.tickmarkPlacement==="between"&&this.tickInterval===1?.5:0,this.single=this.min===this.max&&ea(this.min)&&!this.tickAmount&&(this.min%1==0||l.allowDecimals!==!1),p)B=p.slice();else if(sr(this.min)&&sr(this.max)){if(!((re=this.ordinal)!=null&&re.positions)&&(this.max-this.min)/this.tickInterval>Math.max(2*this.len,200))B=[this.min,this.max],Dr(19,!1,this.chart);else if(this.dateTime)B=this.getTimeTicks(this.dateTime.normalizeTimeTickInterval(this.tickInterval,l.units),this.min,this.max,l.startOfWeek,(te=this.ordinal)==null?void 0:te.positions,this.closestPointRange,!0);else if(this.logarithmic)B=this.logarithmic.getLogTickPositions(this.tickInterval,this.min,this.max);else{let pe=this.tickInterval,_e=pe;for(;_e<=2*pe&&(B=this.getLinearTickPositions(this.tickInterval,this.min,this.max),this.tickAmount&&B.length>this.tickAmount);)this.tickInterval=_p(this,_e*=1.1)}B.length>this.len&&(B=[B[0],B[B.length-1]])[0]===B[1]&&(B.length=1),y&&(this.tickPositions=B,(X=y.apply(this,[this.min,this.max]))&&(B=X))}this.tickPositions=B,this.minorTickInterval=T==="auto"&&this.tickInterval?this.tickInterval/l.minorTicksPerMajor:T,this.paddedTicks=B.slice(0),this.trimTicks(B,P,I),!this.isLinked&&sr(this.min)&&sr(this.max)&&(this.single&&B.length<2&&!this.categories&&!this.series.some(pe=>pe.is("heatmap")&&pe.options.pointPlacement==="between")&&(this.min-=.5,this.max+=.5),p||X||this.adjustTickAmount()),ln(this,"afterSetTickPositions")}trimTicks(l,p,y){let T=l[0],A=l[l.length-1],P=!this.isOrdinal&&this.minPointOffset||0;if(ln(this,"trimTicks"),!this.isLinked||!this.grid){if(p&&T!==-1/0)this.min=T;else for(;this.min-P>l[0];)l.shift();if(y)this.max=A;else for(;this.max+P<l[l.length-1];)l.pop();l.length===0&&ea(T)&&!this.options.tickPositions&&l.push((A+T)/2)}}alignToOthers(){let l,p=this,y=p.chart,T=[this],A=p.options,P=y.options.chart,I=this.coll==="yAxis"&&P.alignThresholds,B=[];if(p.thresholdAlignment=void 0,(P.alignTicks!==!1&&A.alignTicks||I)&&A.startOnTick!==!1&&A.endOnTick!==!1&&!p.logarithmic){let X=te=>{let{horiz:pe,options:_e}=te;return[pe?_e.left:_e.top,_e.width,_e.height,_e.pane].join(",")},re=X(this);y[this.coll].forEach(function(te){let{series:pe}=te;pe.length&&pe.some(_e=>_e.visible)&&te!==p&&X(te)===re&&(l=!0,T.push(te))})}if(l&&I){T.forEach(re=>{let te=re.getThresholdAlignment(p);sr(te)&&B.push(te)});let X=B.length>1?B.reduce((re,te)=>re+=te,0)/B.length:void 0;T.forEach(re=>{re.thresholdAlignment=X})}return l}getThresholdAlignment(l){if((!sr(this.dataMin)||this!==l&&this.series.some(p=>p.isDirty||p.isDirtyData))&&this.getSeriesExtremes(),sr(this.threshold)){let p=Gp((this.threshold-(this.dataMin||0))/((this.dataMax||0)-(this.dataMin||0)),0,1);return this.options.reversed&&(p=1-p),p}}getTickAmount(){let l=this.options,p=l.tickPixelInterval,y=l.tickAmount;ea(l.tickInterval)||y||!(this.len<p)||this.isRadial||this.logarithmic||!l.startOnTick||!l.endOnTick||(y=2),!y&&this.alignToOthers()&&(y=Math.ceil(this.len/p)+1),y<4&&(this.finalTickAmt=y,y=5),this.tickAmount=y}adjustTickAmount(){let l=this,{finalTickAmt:p,max:y,min:T,options:A,tickPositions:P,tickAmount:I,thresholdAlignment:B}=l,X=P==null?void 0:P.length,re=vo(l.threshold,l.softThreshold?0:null),te,pe,_e=l.tickInterval,Ee,De=()=>P.push(vn(P[P.length-1]+_e)),Re=()=>P.unshift(vn(P[0]-_e));if(sr(B)&&(Ee=B<.5?Math.ceil(B*(I-1)):Math.floor(B*(I-1)),A.reversed&&(Ee=I-1-Ee)),l.hasData()&&sr(T)&&sr(y)){let Be=()=>{l.transA*=(X-1)/(I-1),l.min=A.startOnTick?P[0]:Math.min(T,P[0]),l.max=A.endOnTick?P[P.length-1]:Math.max(y,P[P.length-1])};if(sr(Ee)&&sr(l.threshold)){for(;P[Ee]!==re||P.length!==I||P[0]>T||P[P.length-1]<y;){for(P.length=0,P.push(l.threshold);P.length<I;)P[Ee]===void 0||P[Ee]>l.threshold?Re():De();if(_e>8*l.tickInterval)break;_e*=2}Be()}else if(X<I){for(;P.length<I;)P.length%2||T===re?De():Re();Be()}if(ea(p)){for(pe=te=P.length;pe--;)(p===3&&pe%2==1||p<=2&&pe>0&&pe<te-1)&&P.splice(pe,1);l.finalTickAmt=void 0}}}setScale(){var P,I,B,X,re;let{coll:l,stacking:p}=this,y=!1,T=!1;this.series.forEach(te=>{var pe;y=y||te.isDirtyData||te.isDirty,T=T||((pe=te.xAxis)==null?void 0:pe.isDirty)||!1}),this.setAxisSize();let A=this.len!==((P=this.old)==null?void 0:P.len);A||y||T||this.isLinked||this.forceRedraw||this.userMin!==((I=this.old)==null?void 0:I.userMin)||this.userMax!==((B=this.old)==null?void 0:B.userMax)||this.alignToOthers()?(p&&l==="yAxis"&&p.buildStacks(),this.forceRedraw=!1,this.userMinRange||(this.minRange=void 0),this.getSeriesExtremes(),this.setTickInterval(),p&&l==="xAxis"&&p.buildStacks(),this.isDirty||(this.isDirty=A||this.min!==((X=this.old)==null?void 0:X.min)||this.max!==((re=this.old)==null?void 0:re.max))):p&&p.cleanStacks(),y&&delete this.allExtremes,ln(this,"afterSetScale")}setExtremes(l,p,y=!0,T,A){let P=this.chart;this.series.forEach(I=>{delete I.kdTree}),l=P.time.parse(l),p=P.time.parse(p),ln(this,"setExtremes",A=Un(A,{min:l,max:p}),I=>{this.userMin=I.min,this.userMax=I.max,this.eventArgs=I,y&&P.redraw(T)})}setAxisSize(){let l=this.chart,p=this.options,y=p.offsets||[0,0,0,0],T=this.horiz,A=this.width=Math.round(ou(vo(p.width,l.plotWidth-y[3]+y[1]),l.plotWidth)),P=this.height=Math.round(ou(vo(p.height,l.plotHeight-y[0]+y[2]),l.plotHeight)),I=this.top=Math.round(ou(vo(p.top,l.plotTop+y[0]),l.plotHeight,l.plotTop)),B=this.left=Math.round(ou(vo(p.left,l.plotLeft+y[3]),l.plotWidth,l.plotLeft));this.bottom=l.chartHeight-P-I,this.right=l.chartWidth-A-B,this.len=Math.max(T?A:P,0),this.pos=T?B:I}getExtremes(){let l=this.logarithmic;return{min:l?vn(l.lin2log(this.min)):this.min,max:l?vn(l.lin2log(this.max)):this.max,dataMin:this.dataMin,dataMax:this.dataMax,userMin:this.userMin,userMax:this.userMax}}getThreshold(l){let p=this.logarithmic,y=p?p.lin2log(this.min):this.min,T=p?p.lin2log(this.max):this.max;return l===null||l===-1/0?l=y:l===1/0?l=T:y>l?l=y:T<l&&(l=T),this.translate(l,0,1,0,1)}autoLabelAlign(l){let p=(vo(l,0)-90*this.side+720)%360,y={align:"center"};return ln(this,"autoLabelAlign",y,function(T){p>15&&p<165?T.align="right":p>195&&p<345&&(T.align="left")}),y.align}tickSize(l){let p=this.options,y=vo(p[l==="tick"?"tickWidth":"minorTickWidth"],l==="tick"&&this.isXAxis&&!this.categories?1:0),T=p[l==="tick"?"tickLength":"minorTickLength"],A;y&&T&&(p[l+"Position"]==="inside"&&(T=-T),A=[T,y]);let P={tickSize:A};return ln(this,"afterTickSize",P),P.tickSize}labelMetrics(){let l=this.chart.renderer,p=this.ticks,y=p[Object.keys(p)[0]]||{};return this.chart.renderer.fontMetrics(y.label||y.movedLabel||l.box)}unsquish(){let l=this.options.labels,p=l.padding||0,y=this.horiz,T=this.tickInterval,A=this.len/((+!!this.categories+this.max-this.min)/T),P=l.rotation,I=vn(.8*this.labelMetrics().h),B=Math.max(this.max-this.min,0),X=function(Ee){let De=(Ee+2*p)/(A||1);return(De=De>1?Math.ceil(De):1)*T>B&&Ee!==1/0&&A!==1/0&&B&&(De=Math.ceil(B/T)),vn(De*T)},re=T,te,pe=Number.MAX_VALUE,_e;if(y){if(!l.staggerLines&&(sr(P)?_e=[P]:A<l.autoRotationLimit&&(_e=l.autoRotation)),_e){let Ee,De;for(let Re of _e)(Re===P||Re&&Re>=-90&&Re<=90)&&(De=(Ee=X(Math.abs(I/Math.sin(Zf*Re))))+Math.abs(Re/360))<pe&&(pe=De,te=Re,re=Ee)}}else re=X(.75*I);return this.autoRotation=_e,this.labelRotation=vo(te,sr(P)?P:0),l.step?T:re}getSlotWidth(l){let p=this.chart,y=this.horiz,T=this.options.labels,A=Math.max(this.tickPositions.length-!this.categories,1),P=p.margin[3];if(l&&sr(l.slotWidth))return l.slotWidth;if(y&&T.step<2&&!this.isRadial)return T.rotation?0:(this.staggerLines||1)*this.len/A;if(!y){let I=T.style.width;if(I!==void 0)return parseInt(String(I),10);if(P)return P-p.spacing[3]}return .33*p.chartWidth}renderUnsquish(){let l=this.chart,p=l.renderer,y=this.tickPositions,T=this.ticks,A=this.options.labels,P=A.style,I=this.horiz,B=this.getSlotWidth(),X=Math.max(1,Math.round(B-(I?2*(A.padding||0):A.distance||0))),re={},te=this.labelMetrics(),pe=P.lineClamp,_e,Ee=pe??(Math.floor(this.len/(y.length*te.h))||1),De=0;nc(A.rotation)||(re.rotation=A.rotation||0),y.forEach(function(Re){var rt;let Be=T[Re];Be.movedLabel&&Be.replaceMovedLabel();let Ze=((rt=Be.label)==null?void 0:rt.textPxLength)||0;Ze>De&&(De=Ze)}),this.maxLabelLength=De,this.autoRotation?De>X&&De>te.h?re.rotation=this.labelRotation:this.labelRotation=0:B&&(_e=X),re.rotation&&(_e=De>.5*l.chartHeight?.33*l.chartHeight:De,pe||(Ee=1)),this.labelAlign=A.align||this.autoLabelAlign(this.labelRotation),this.labelAlign&&(re.align=this.labelAlign),y.forEach(function(Re){let Be=T[Re],Ze=Be==null?void 0:Be.label,rt=P.width,Yt={};Ze&&(Ze.attr(re),Be.shortenLabel?Be.shortenLabel():_e&&!rt&&P.whiteSpace!=="nowrap"&&(_e<(Ze.textPxLength||0)||Ze.element.tagName==="SPAN")?Ze.css(Un(Yt,{width:`${_e}px`,lineClamp:Ee})):!Ze.styles.width||Yt.width||rt||Ze.css({width:"auto"}),Be.rotation=re.rotation)},this),this.tickRotCorr=p.rotCorr(te.b,this.labelRotation||0,this.side!==0)}hasData(){return this.series.some(function(l){return l.hasData()})||this.options.showEmpty&&ea(this.min)&&ea(this.max)}addTitle(l){let p,y=this.chart.renderer,T=this.horiz,A=this.opposite,P=this.options.title,I=this.chart.styledMode;this.axisTitle||((p=P.textAlign)||(p=(T?{low:"left",middle:"center",high:"right"}:{low:A?"right":"left",middle:"center",high:A?"left":"right"})[P.align]),this.axisTitle=y.text(P.text||"",0,0,P.useHTML).attr({zIndex:7,rotation:P.rotation||0,align:p}).addClass("highcharts-axis-title"),I||this.axisTitle.css(Id(P.style)),this.axisTitle.add(this.axisGroup),this.axisTitle.isNew=!0),I||P.style.width||this.isRadial||this.axisTitle.css({width:this.len+"px"}),this.axisTitle[l?"show":"hide"](l)}generateTick(l){let p=this.ticks;p[l]?p[l].addLabel():p[l]=new Pu(this,l)}createGroups(){let{axisParent:l,chart:p,coll:y,options:T}=this,A=p.renderer,P=(I,B,X)=>A.g(I).attr({zIndex:X}).addClass(`highcharts-${y.toLowerCase()}${B} `+(this.isRadial?`highcharts-radial-axis${B} `:"")+(T.className||"")).add(l);this.axisGroup||(this.gridGroup=P("grid","-grid",T.gridZIndex),this.axisGroup=P("axis","",T.zIndex),this.labelGroup=P("axis-labels","-labels",T.labels.zIndex))}getOffset(){let l=this,{chart:p,horiz:y,options:T,side:A,ticks:P,tickPositions:I,coll:B}=l,X=p.inverted&&!l.isZAxis?[1,0,3,2][A]:A,re=l.hasData(),te=T.title,pe=T.labels,_e=sr(T.crossing),Ee=p.axisOffset,De=p.clipOffset,Re=[-1,1,1,-1][A],Be,Ze=0,rt,Yt=0,Ut=0,Xt,Ci;if(l.showAxis=Be=re||T.showEmpty,l.staggerLines=l.horiz&&pe.staggerLines||void 0,l.createGroups(),re||l.isLinked?(I.forEach(function(di){l.generateTick(di)}),l.renderUnsquish(),l.reserveSpaceDefault=A===0||A===2||{1:"left",3:"right"}[A]===l.labelAlign,vo(pe.reserveSpace,!_e&&null,l.labelAlign==="center"||null,l.reserveSpaceDefault)&&I.forEach(function(di){Ut=Math.max(P[di].getLabelSize(),Ut)}),l.staggerLines&&(Ut*=l.staggerLines),l.labelOffset=Ut*(l.opposite?-1:1)):Hr(P,function(di,vi){di.destroy(),delete P[vi]}),te!=null&&te.text&&te.enabled!==!1&&(l.addTitle(Be),Be&&!_e&&te.reserveSpace!==!1&&(l.titleOffset=Ze=l.axisTitle.getBBox()[y?"height":"width"],Yt=ea(rt=te.offset)?0:vo(te.margin,y?5:10))),l.renderLine(),l.offset=Re*vo(T.offset,Ee[A]?Ee[A]+(T.margin||0):0),l.tickRotCorr=l.tickRotCorr||{x:0,y:0},Ci=A===0?-l.labelMetrics().h:A===2?l.tickRotCorr.y:0,Xt=Math.abs(Ut)+Yt,Ut&&(Xt-=Ci,Xt+=Re*(y?vo(pe.y,l.tickRotCorr.y+Re*pe.distance):vo(pe.x,Re*pe.distance))),l.axisTitleMargin=vo(rt,Xt),l.getMaxLabelDimensions&&(l.maxLabelDimensions=l.getMaxLabelDimensions(P,I)),B!=="colorAxis"&&De){let di=this.tickSize("tick");Ee[A]=Math.max(Ee[A],(l.axisTitleMargin||0)+Ze+Re*l.offset,Xt,I!=null&&I.length&&di?di[0]+Re*l.offset:0);let vi=!l.axisLine||T.offset?0:l.axisLine.strokeWidth()/2;De[X]=Math.max(De[X],vi)}ln(this,"afterGetOffset")}getLinePath(l){let p=this.chart,y=this.opposite,T=this.offset,A=this.horiz,P=this.left+(y?this.width:0)+T,I=p.chartHeight-this.bottom-(y?this.height:0)+T;return y&&(l*=-1),p.renderer.crispLine([["M",A?this.left:P,A?I:this.top],["L",A?p.chartWidth-this.right:P,A?I:p.chartHeight-this.bottom]],l)}renderLine(){!this.axisLine&&(this.axisLine=this.chart.renderer.path().addClass("highcharts-axis-line").add(this.axisGroup),this.chart.styledMode||this.axisLine.attr({stroke:this.options.lineColor,"stroke-width":this.options.lineWidth,zIndex:7}))}getTitlePosition(l){let p=this.horiz,y=this.left,T=this.top,A=this.len,P=this.options.title,I=p?y:T,B=this.opposite,X=this.offset,re=P.x,te=P.y,pe=this.chart.renderer.fontMetrics(l),_e=l?Math.max(l.getBBox(!1,0).height-pe.h-1,0):0,Ee={low:I+(p?0:A),middle:I+A/2,high:I+(p?A:0)}[P.align],De=(p?T+this.height:y)+(p?1:-1)*(B?-1:1)*(this.axisTitleMargin||0)+[-_e,_e,pe.f,-_e][this.side],Re={x:p?Ee+re:De+(B?this.width:0)+X+re,y:p?De+te-(B?this.height:0)+X:Ee+te};return ln(this,"afterGetTitlePosition",{titlePosition:Re}),Re}renderMinorTick(l,p){let y=this.minorTicks;y[l]||(y[l]=new Pu(this,l,"minor")),p&&y[l].isNew&&y[l].render(null,!0),y[l].render(null,!1,1)}renderTick(l,p,y){var P;let T=this.isLinked,A=this.ticks;(!T||l>=this.min&&l<=this.max||(P=this.grid)!=null&&P.isColumn)&&(A[l]||(A[l]=new Pu(this,l)),y&&A[l].isNew&&A[l].render(p,!0,-1),A[l].render(p))}render(){let l,p,y=this,T=y.chart,A=y.logarithmic,P=T.renderer,I=y.options,B=y.isLinked,X=y.tickPositions,re=y.axisTitle,te=y.ticks,pe=y.minorTicks,_e=y.alternateBands,Ee=I.stackLabels,De=I.alternateGridColor,Re=I.crossing,Be=y.tickmarkOffset,Ze=y.axisLine,rt=y.showAxis,Yt=ff(P.globalAnimation);if(y.labelEdge.length=0,y.overlap=!1,[te,pe,_e].forEach(function(Ut){Hr(Ut,function(Xt){Xt.isActive=!1})}),sr(Re)){let Ut=this.isXAxis?T.yAxis[0]:T.xAxis[0],Xt=[1,-1,-1,1][this.side];if(Ut){let Ci=Ut.toPixels(Re,!0);y.horiz&&(Ci=Ut.len-Ci),y.offset=Xt*Ci}}if(y.hasData()||B){let Ut=y.chart.hasRendered&&y.old&&sr(y.old.min);y.minorTickInterval&&!y.categories&&y.getMinorTickPositions().forEach(function(Xt){y.renderMinorTick(Xt,Ut)}),X.length&&(X.forEach(function(Xt,Ci){y.renderTick(Xt,Ci,Ut)}),Be&&(y.min===0||y.single)&&(te[-1]||(te[-1]=new Pu(y,-1,null,!0)),te[-1].render(-1))),De&&X.forEach(function(Xt,Ci){p=X[Ci+1]!==void 0?X[Ci+1]+Be:y.max-Be,Ci%2==0&&Xt<y.max&&p<=y.max+(T.polar?-Be:Be)&&(_e[Xt]||(_e[Xt]=new pi.PlotLineOrBand(y,{})),l=Xt+Be,_e[Xt].options={from:A?A.lin2log(l):l,to:A?A.lin2log(p):p,color:De,className:"highcharts-alternate-grid"},_e[Xt].render(),_e[Xt].isActive=!0)}),y._addedPlotLB||(y._addedPlotLB=!0,(I.plotLines||[]).concat(I.plotBands||[]).forEach(function(Xt){y.addPlotBandOrLine(Xt)}))}[te,pe,_e].forEach(function(Ut){let Xt=[],Ci=Yt.duration;Hr(Ut,function(di,vi){di.isActive||(di.render(vi,!1,0),di.isActive=!1,Xt.push(vi))}),Ro(function(){let di=Xt.length;for(;di--;)Ut[Xt[di]]&&!Ut[Xt[di]].isActive&&(Ut[Xt[di]].destroy(),delete Ut[Xt[di]])},Ut!==_e&&T.hasRendered&&Ci?Ci:0)}),Ze&&(Ze[Ze.isPlaced?"animate":"attr"]({d:this.getLinePath(Ze.strokeWidth())}),Ze.isPlaced=!0,Ze[rt?"show":"hide"](rt)),re&&rt&&(re[re.isNew?"attr":"animate"](y.getTitlePosition(re)),re.isNew=!1),Ee!=null&&Ee.enabled&&y.stacking&&y.stacking.renderStackTotals(),y.old={len:y.len,max:y.max,min:y.min,transA:y.transA,userMax:y.userMax,userMin:y.userMin},y.isDirty=!1,ln(this,"afterRender")}redraw(){this.visible&&(this.render(),this.plotLinesAndBands.forEach(function(l){l.render()})),this.series.forEach(function(l){l.isDirty=!0})}getKeepProps(){return this.keepProps||Ku.keepProps}destroy(l){let p=this,y=p.plotLinesAndBands,T=this.eventOptions;if(ln(this,"destroy",{keepEvents:l}),l||Wp(p),[p.ticks,p.minorTicks,p.alternateBands].forEach(function(A){Vc(A)}),y){let A=y.length;for(;A--;)y[A].destroy()}for(let A in["axisLine","axisTitle","axisGroup","gridGroup","labelGroup","cross","scrollbar"].forEach(function(P){p[P]&&(p[P]=p[P].destroy())}),p.plotLinesAndBandsGroups)p.plotLinesAndBandsGroups[A]=p.plotLinesAndBandsGroups[A].destroy();Hr(p,function(A,P){p.getKeepProps().indexOf(P)===-1&&delete p[P]}),this.eventOptions=T}drawCrosshair(l,p){var te;let y=this.crosshair,T=(y==null?void 0:y.snap)??!0,A=this.chart,P,I,B,X=this.cross,re;if(ln(this,"drawCrosshair",{e:l,point:p}),l||(l=(te=this.cross)==null?void 0:te.e),y&&(ea(p)||!T)!==!1){if(T?ea(p)&&(I=vo(this.coll!=="colorAxis"?p.crosshairPos:null,this.isXAxis?p.plotX:this.len-p.plotY)):I=l&&(this.horiz?l.chartX-this.pos:this.len-l.chartY+this.pos),ea(I)&&(re={value:p&&(this.isXAxis?p.x:vo(p.stackY,p.y)),translatedValue:I},A.polar&&Un(re,{isCrosshair:!0,chartX:l==null?void 0:l.chartX,chartY:l==null?void 0:l.chartY,point:p}),P=this.getPlotLinePath(re)||null),!ea(P))return void this.hideCrosshair();B=this.categories&&!this.isRadial,X||(this.cross=X=A.renderer.path().addClass("highcharts-crosshair highcharts-crosshair-"+(B?"category ":"thin ")+(y.className||"")).attr({zIndex:vo(y.zIndex,2)}).add(),!A.styledMode&&(X.attr({stroke:y.color||(B?at.parse("#ccd3ff").setOpacity(.25).get():"#cccccc"),"stroke-width":vo(y.width,1)}).css({"pointer-events":"none"}),y.dashStyle&&X.attr({dashstyle:y.dashStyle}))),X.show().attr({d:P}),B&&!y.width&&X.attr({"stroke-width":this.transA}),this.cross.e=l}else this.hideCrosshair();ln(this,"afterDrawCrosshair",{e:l,point:p})}hideCrosshair(){this.cross&&this.cross.hide(),ln(this,"afterHideCrosshair")}update(l,p){let y=this.chart;l=Id(this.userOptions,l),this.destroy(!0),this.init(y,l),y.isDirtyBox=!0,vo(p,!0)&&y.redraw()}remove(l){let p=this.chart,y=this.coll,T=this.series,A=T.length;for(;A--;)T[A]&&T[A].remove(!1);Uc(p.axes,this),Uc(p[y]||[],this),p.orderItems(y),this.destroy(),p.isDirtyBox=!0,vo(l,!0)&&p.redraw()}setTitle(l,p){this.update({title:l},p)}setCategories(l,p){this.update({categories:l},p)}}Ku.keepProps=["coll","extKey","hcEvents","len","names","series","userMax","userMin"];let Lu=Ku,{addEvent:og,getMagnitude:Em,normalizeTickInterval:nu,timeUnits:Ld}=Ps;(function(q){function l(){return this.chart.time.getTimeTicks.apply(this.chart.time,arguments)}function p(){if(this.type!=="datetime"){this.dateTime=void 0;return}this.dateTime||(this.dateTime=new y(this))}q.compose=function(T){return T.keepProps.includes("dateTime")||(T.keepProps.push("dateTime"),T.prototype.getTimeTicks=l,og(T,"afterSetType",p)),T};class y{constructor(A){this.axis=A}normalizeTimeTickInterval(A,P){let I=P||[["millisecond",[1,2,5,10,20,25,50,100,200,500]],["second",[1,2,5,10,15,30]],["minute",[1,2,5,10,15,30]],["hour",[1,2,3,4,6,8,12]],["day",[1,2]],["week",[1,2]],["month",[1,2,3,4,6]],["year",null]],B=I[I.length-1],X=Ld[B[0]],re=B[1],te;for(te=0;te<I.length&&(X=Ld[(B=I[te])[0]],re=B[1],!I[te+1]||!(A<=(X*re[re.length-1]+Ld[I[te+1][0]])/2));te++);X===Ld.year&&A<5*X&&(re=[1,2,5]);let pe=nu(A/X,re,B[0]==="year"?Math.max(Em(A/X),1):1);return{unitRange:X,count:pe,unitName:B[0]}}getXDateFormat(A,P){let{axis:I}=this,B=I.chart.time;return I.closestPointRange?B.getDateFormat(I.closestPointRange,A,I.options.startOfWeek,P)||B.resolveDTLFormat(P.year).main:B.resolveDTLFormat(P.day).main}}q.Additions=y})(is||(is={}));let Cm=is,{addEvent:Pm,normalizeTickInterval:Kf,pick:Im}=Ps;(function(q){function l(){this.type!=="logarithmic"?this.logarithmic=void 0:this.logarithmic??(this.logarithmic=new y(this))}function p(){let T=this.logarithmic;T&&(this.lin2val=function(A){return T.lin2log(A)},this.val2lin=function(A){return T.log2lin(A)})}q.compose=function(T){return T.keepProps.includes("logarithmic")||(T.keepProps.push("logarithmic"),Pm(T,"afterSetType",l),Pm(T,"afterInit",p)),T};class y{constructor(A){this.axis=A}getLogTickPositions(A,P,I,B){let X=this.axis,re=X.len,te=X.options,pe=[];if(B||(this.minorAutoInterval=void 0),A>=.5)A=Math.round(A),pe=X.getLinearTickPositions(A,P,I);else if(A>=.08){let _e,Ee,De,Re,Be,Ze,rt,Yt=Math.floor(P);for(_e=A>.3?[1,2,4]:A>.15?[1,2,4,6,8]:[1,2,3,4,5,6,7,8,9],Ee=Yt;Ee<I+1&&!rt;Ee++)for(De=0,Re=_e.length;De<Re&&!rt;De++)(Be=this.log2lin(this.lin2log(Ee)*_e[De]))>P&&(!B||Ze<=I)&&Ze!==void 0&&pe.push(Ze),Ze>I&&(rt=!0),Ze=Be}else{let _e=this.lin2log(P),Ee=this.lin2log(I),De=B?X.getMinorTickInterval():te.tickInterval,Re=te.tickPixelInterval/(B?5:1),Be=B?re/X.tickPositions.length:re;A=Kf(A=Im(De==="auto"?null:De,this.minorAutoInterval,(Ee-_e)*Re/(Be||1))),pe=X.getLinearTickPositions(A,_e,Ee).map(this.log2lin),B||(this.minorAutoInterval=A/5)}return B||(X.tickInterval=A),pe}lin2log(A){return Math.pow(10,A)}log2lin(A){return Math.log(A)/Math.LN10}}q.Additions=y})(Xs||(Xs={}));let gf=Xs,{erase:jc,extend:Jf,isNumber:Ou}=Ps;(function(q){let l;function p(X){return this.addPlotBandOrLine(X,"plotBands")}function y(X,re){let te=this.userOptions,pe=new l(this,X);if(this.visible&&(pe=pe.render()),pe){if(this._addedPlotLB||(this._addedPlotLB=!0,(te.plotLines||[]).concat(te.plotBands||[]).forEach(_e=>{this.addPlotBandOrLine(_e)})),re){let _e=te[re]||[];_e.push(X),te[re]=_e}this.plotLinesAndBands.push(pe)}return pe}function T(X){return this.addPlotBandOrLine(X,"plotLines")}function A(X,re,te){te=te||this.options;let pe=this.getPlotLinePath({value:re,force:!0,acrossPanes:te.acrossPanes}),_e=[],Ee=this.horiz,De=!Ou(this.min)||!Ou(this.max)||X<this.min&&re<this.min||X>this.max&&re>this.max,Re=this.getPlotLinePath({value:X,force:!0,acrossPanes:te.acrossPanes}),Be,Ze=1,rt;if(Re&&pe)for(De&&(rt=Re.toString()===pe.toString(),Ze=0),Be=0;Be<Re.length;Be+=2){let Yt=Re[Be],Ut=Re[Be+1],Xt=pe[Be],Ci=pe[Be+1];(Yt[0]==="M"||Yt[0]==="L")&&(Ut[0]==="M"||Ut[0]==="L")&&(Xt[0]==="M"||Xt[0]==="L")&&(Ci[0]==="M"||Ci[0]==="L")&&(Ee&&Xt[1]===Yt[1]?(Xt[1]+=Ze,Ci[1]+=Ze):Ee||Xt[2]!==Yt[2]||(Xt[2]+=Ze,Ci[2]+=Ze),_e.push(["M",Yt[1],Yt[2]],["L",Ut[1],Ut[2]],["L",Ci[1],Ci[2]],["L",Xt[1],Xt[2]],["Z"])),_e.isFlat=rt}return _e}function P(X){this.removePlotBandOrLine(X)}function I(X){let re=this.plotLinesAndBands,te=this.options,pe=this.userOptions;if(re){let _e=re.length;for(;_e--;)re[_e].id===X&&re[_e].destroy();[te.plotLines||[],pe.plotLines||[],te.plotBands||[],pe.plotBands||[]].forEach(function(Ee){var De;for(_e=Ee.length;_e--;)((De=Ee[_e])==null?void 0:De.id)===X&&jc(Ee,Ee[_e])})}}function B(X){this.removePlotBandOrLine(X)}q.compose=function(X,re){let te=re.prototype;return te.addPlotBand||(l=X,Jf(te,{addPlotBand:p,addPlotLine:T,addPlotBandOrLine:y,getPlotBandPath:A,removePlotBand:P,removePlotLine:B,removePlotBandOrLine:I})),re}})(Qi||(Qi={}));let Lm=Qi,{addEvent:Qf,arrayMax:em,arrayMin:Du,defined:Bl,destroyObjectProperties:tm,erase:dh,fireEvent:Gc,merge:Ju,objectEach:Hp,pick:Qu}=Ps;class ep{static compose(l,p){return Qf(l,"afterInit",function(){this.labelCollectors.push(()=>{var T;let y=[];for(let A of this.axes)for(let{label:P,options:I}of A.plotLinesAndBands)P&&!((T=I==null?void 0:I.label)!=null&&T.allowOverlap)&&y.push(P);return y})}),Lm.compose(ep,p)}constructor(l,p){this.axis=l,this.options=p,this.id=p.id}render(){Gc(this,"render");let{axis:l,options:p}=this,{horiz:y,logarithmic:T}=l,{color:A,events:P,zIndex:I=0}=p,{renderer:B,time:X}=l.chart,re={},te=X.parse(p.to),pe=X.parse(p.from),_e=X.parse(p.value),Ee=p.borderWidth,De=p.label,{label:Re,svgElem:Be}=this,Ze=[],rt,Yt=Bl(pe)&&Bl(te),Ut=Bl(_e),Xt=!Be,Ci={class:"highcharts-plot-"+(Yt?"band ":"line ")+(p.className||"")},di=Yt?"bands":"lines";if(!l.chart.styledMode&&(Ut?(Ci.stroke=A||"#999999",Ci["stroke-width"]=Qu(p.width,1),p.dashStyle&&(Ci.dashstyle=p.dashStyle)):Yt&&(Ci.fill=A||"#e6e9ff",Ee&&(Ci.stroke=p.borderColor,Ci["stroke-width"]=Ee))),re.zIndex=I,di+="-"+I,(rt=l.plotLinesAndBandsGroups[di])||(l.plotLinesAndBandsGroups[di]=rt=B.g("plot-"+di).attr(re).add()),Be||(this.svgElem=Be=B.path().attr(Ci).add(rt)),Bl(_e))Ze=l.getPlotLinePath({value:(T==null?void 0:T.log2lin(_e))??_e,lineWidth:Be.strokeWidth(),acrossPanes:p.acrossPanes});else{if(!(Bl(pe)&&Bl(te)))return;Ze=l.getPlotBandPath((T==null?void 0:T.log2lin(pe))??pe,(T==null?void 0:T.log2lin(te))??te,p)}return!this.eventsAdded&&P&&(Hp(P,(vi,es)=>{Be==null||Be.on(es,ws=>{P[es].apply(this,[ws])})}),this.eventsAdded=!0),(Xt||!Be.d)&&(Ze!=null&&Ze.length)?Be.attr({d:Ze}):Be&&(Ze?(Be.show(),Be.animate({d:Ze})):Be.d&&(Be.hide(),Re&&(this.label=Re=Re.destroy()))),De&&(Bl(De.text)||Bl(De.formatter))&&(Ze!=null&&Ze.length)&&l.width>0&&l.height>0&&!Ze.isFlat?(De=Ju({align:y&&Yt?"center":void 0,x:y?!Yt&&4:10,verticalAlign:!y&&Yt?"middle":void 0,y:y?Yt?16:10:Yt?6:-4,rotation:y&&!Yt?90:0,...Yt?{inside:!0}:{}},De),this.renderLabel(De,Ze,Yt,I)):Re&&Re.hide(),this}renderLabel(l,p,y,T){var Ee,De;let A=this.axis,P=A.chart.renderer,I=l.inside,B=this.label;B||(this.label=B=P.text(this.getLabelText(l),0,0,l.useHTML).attr({align:l.textAlign||l.align,rotation:l.rotation,class:"highcharts-plot-"+(y?"band":"line")+"-label "+(l.className||""),zIndex:T}),A.chart.styledMode||B.css(Ju({color:(Ee=A.chart.options.title)==null?void 0:Ee.style.color,fontSize:"0.8em",textOverflow:y&&!I?"":"ellipsis"},l.style)),B.add());let X=p.xBounds||[p[0][1],p[1][1],y?p[2][1]:p[0][1]],re=p.yBounds||[p[0][2],p[1][2],y?p[2][2]:p[0][2]],te=Du(X),pe=Du(re),_e=em(X)-te;B.align(l,!1,{x:te,y:pe,width:_e,height:em(re)-pe}),B.alignAttr.y-=P.fontMetrics(B).b,(!B.alignValue||B.alignValue==="left"||Bl(I))&&B.css({width:(((De=l.style)==null?void 0:De.width)||(y&&I?_e:B.rotation===90?A.height-(B.alignAttr.y-A.top):(l.clip?A.width:A.chart.chartWidth)-(B.alignAttr.x-A.left)))+"px"}),B.show(!0)}getLabelText(l){return Bl(l.formatter)?l.formatter.call(this):l.text}destroy(){dh(this.axis.plotLinesAndBands,this),delete this.axis,tm(this)}}let{animObject:im}=to,{format:Od}=fa,{composed:au,dateFormats:sm,doc:Xp,isSafari:rm}=pi,{distribute:yf}=kh,{addEvent:ld,clamp:zu,css:ng,discardElement:ag,extend:Yp,fireEvent:Lh,getAlignFactor:lg,isArray:$p,isNumber:xf,isObject:_f,isString:Oh,merge:om,pick:Ru,pushUnique:vf,splat:lu,syncTimeout:ac}=Ps;class qp{constructor(l,p,y){this.allowShared=!0,this.crosshairs=[],this.distance=0,this.isHidden=!0,this.isSticky=!1,this.options={},this.outside=!1,this.chart=l,this.init(l,p),this.pointer=y}bodyFormatter(l){return l.map(p=>{let y=p.series.tooltipOptions,T=p.formatPrefix||"point";return(y[T+"Formatter"]||p.tooltipFormatter).call(p,y[T+"Format"]||"")})}cleanSplit(l){this.chart.series.forEach(function(p){let y=p==null?void 0:p.tt;y&&(!y.isActive||l?p.tt=y.destroy():y.isActive=!1)})}defaultFormatter(l){let p,y=this.points||lu(this);return(p=(p=[l.headerFooterFormatter(y[0])]).concat(l.bodyFormatter(y))).push(l.headerFooterFormatter(y[0],!0)),p}destroy(){this.label&&(this.label=this.label.destroy()),this.split&&(this.cleanSplit(!0),this.tt&&(this.tt=this.tt.destroy())),this.renderer&&(this.renderer=this.renderer.destroy(),ag(this.container)),Ps.clearTimeout(this.hideTimer)}getAnchor(l,p){var re;let y,{chart:T,pointer:A}=this,P=T.inverted,I=T.plotTop,B=T.plotLeft;if(l=lu(l),(re=l[0].series)!=null&&re.yAxis&&!l[0].series.yAxis.options.reversedStacks&&(l=l.slice().reverse()),this.followPointer&&p)p.chartX===void 0&&(p=A.normalize(p)),y=[p.chartX-B,p.chartY-I];else if(l[0].tooltipPos)y=l[0].tooltipPos;else{let te=0,pe=0;l.forEach(function(_e){let Ee=_e.pos(!0);Ee&&(te+=Ee[0],pe+=Ee[1])}),te/=l.length,pe/=l.length,this.shared&&l.length>1&&p&&(P?te=p.chartX:pe=p.chartY),y=[te-B,pe-I]}let X={point:l[0],ret:y};return Lh(this,"getAnchor",X),X.ret.map(Math.round)}getClassName(l,p,y){let T=this.options,A=l.series,P=A.options;return[T.className,"highcharts-label",y&&"highcharts-tooltip-header",p?"highcharts-tooltip-box":"highcharts-tooltip",!y&&"highcharts-color-"+Ru(l.colorIndex,A.colorIndex),P==null?void 0:P.className].filter(Oh).join(" ")}getLabel({anchorX:l,anchorY:p}={anchorX:0,anchorY:0}){let y=this,T=this.chart.styledMode,A=this.options,P=this.split&&this.allowShared,I=this.container,B=this.chart.renderer;if(this.label){let X=!this.label.hasClass("highcharts-label");(!P&&X||P&&!X)&&this.destroy()}if(!this.label){if(this.outside){let X=this.chart,re=X.options.chart.style,te=Xd.getRendererType();this.container=I=pi.doc.createElement("div"),I.className="highcharts-tooltip-container "+(X.renderTo.className.match(/(highcharts[a-zA-Z0-9-]+)\s?/gm)||""),ng(I,{position:"absolute",top:"1px",pointerEvents:"none",zIndex:Math.max(this.options.style.zIndex||0,((re==null?void 0:re.zIndex)||0)+3)}),this.renderer=B=new te(I,0,0,re,void 0,void 0,B.styledMode)}if(P?this.label=B.g("tooltip"):(this.label=B.label("",l,p,A.shape||"callout",void 0,void 0,A.useHTML,void 0,"tooltip").attr({padding:A.padding,r:A.borderRadius}),T||this.label.attr({fill:A.backgroundColor,"stroke-width":A.borderWidth||0}).css(A.style).css({pointerEvents:A.style.pointerEvents||(this.shouldStickOnContact()?"auto":"none")})),y.outside){let X=this.label;[X.xSetter,X.ySetter].forEach((re,te)=>{X[te?"ySetter":"xSetter"]=pe=>{re.call(X,y.distance),X[te?"y":"x"]=pe,I&&(I.style[te?"top":"left"]=`${pe}px`)}})}this.label.attr({zIndex:8}).shadow(A.shadow??!A.fixed).add()}return I&&!I.parentElement&&pi.doc.body.appendChild(I),this.label}getPlayingField(){let{body:l,documentElement:p}=Xp,{chart:y,distance:T,outside:A}=this;return{width:A?Math.max(l.scrollWidth,p.scrollWidth,l.offsetWidth,p.offsetWidth,p.clientWidth)-2*T-2:y.chartWidth,height:A?Math.max(l.scrollHeight,p.scrollHeight,l.offsetHeight,p.offsetHeight,p.clientHeight):y.chartHeight}}getPosition(l,p,y){var pr,Vr;let{distance:T,chart:A,outside:P,pointer:I}=this,{inverted:B,plotLeft:X,plotTop:re,polar:te}=A,{plotX:pe=0,plotY:_e=0}=y,Ee={},De=B&&y.h||0,{height:Re,width:Be}=this.getPlayingField(),Ze=I.getChartPosition(),rt=cr=>cr*Ze.scaleX,Yt=cr=>cr*Ze.scaleY,Ut=cr=>{let Zr=cr==="x";return[cr,Zr?Be:Re,Zr?l:p].concat(P?[Zr?rt(l):Yt(p),Zr?Ze.left-T+rt(pe+X):Ze.top-T+Yt(_e+re),0,Zr?Be:Re]:[Zr?l:p,Zr?pe+X:_e+re,Zr?X:re,Zr?X+A.plotWidth:re+A.plotHeight])},Xt=Ut("y"),Ci=Ut("x"),di,vi=!!y.negative;!te&&((Vr=(pr=A.hoverSeries)==null?void 0:pr.yAxis)!=null&&Vr.reversed)&&(vi=!vi);let es=!this.followPointer&&Ru(y.ttBelow,!te&&!B===vi),ws=function(cr,Zr,Cn,Qo,en,uc,gn){let va=P?cr==="y"?Yt(T):rt(T):T,Fo=(Cn-Qo)/2,Ao=Qo<en-T,oh=en+T+Qo<Zr,Ya=en-va-Cn+Fo,El=en+va-Fo;if(es&&oh)Ee[cr]=El;else if(!es&&Ao)Ee[cr]=Ya;else if(Ao)Ee[cr]=Math.min(gn-Qo,Ya-De<0?Ya:Ya-De);else{if(!oh)return Ee[cr]=0,!1;Ee[cr]=Math.max(uc,El+De+Cn>Zr?El:El+De)}},As=function(cr,Zr,Cn,Qo,en){if(en<T||en>Zr-T)return!1;en<Cn/2?Ee[cr]=1:en>Zr-Qo/2?Ee[cr]=Zr-Qo-2:Ee[cr]=en-Cn/2},$s=function(cr){[Xt,Ci]=[Ci,Xt],di=cr},kr=()=>{ws.apply(0,Xt)!==!1?As.apply(0,Ci)!==!1||di||($s(!0),kr()):di?Ee.x=Ee.y=0:($s(!0),kr())};return(B&&!te||this.len>1)&&$s(),kr(),Ee}getFixedPosition(l,p,y){var pe;let T=y.series,{chart:A,options:P,split:I}=this,B=P.position,X=B.relativeTo,re=P.shared||(pe=T==null?void 0:T.yAxis)!=null&&pe.isRadial&&(X==="pane"||!X)?"plotBox":X,te=re==="chart"?A.renderer:A[re]||A.getClipBox(T,!0);return{x:te.x+(te.width-l)*lg(B.align)+B.x,y:te.y+(te.height-p)*lg(B.verticalAlign)+(!I&&B.y||0)}}hide(l){let p=this;Ps.clearTimeout(this.hideTimer),l=Ru(l,this.options.hideDelay),this.isHidden||(this.hideTimer=ac(function(){let y=p.getLabel();p.getLabel().animate({opacity:0},{duration:l&&150,complete:()=>{y.hide(),p.container&&p.container.remove()}}),p.isHidden=!0},l))}init(l,p){this.chart=l,this.options=p,this.crosshairs=[],this.isHidden=!0,this.split=p.split&&!l.inverted&&!l.polar,this.shared=p.shared||this.split,this.outside=Ru(p.outside,!!(l.scrollablePixelsX||l.scrollablePixelsY))}shouldStickOnContact(l){return!!(!this.followPointer&&this.options.stickOnContact&&(!l||this.pointer.inClass(l.target,"highcharts-tooltip")))}move(l,p,y,T){let{followPointer:A,options:P}=this,I=im(!A&&!this.isHidden&&!P.fixed&&P.animation),B=A||(this.len||0)>1,X={x:l,y:p};B?X.anchorX=X.anchorY=NaN:(X.anchorX=y,X.anchorY=T),I.step=()=>this.drawTracker(),this.getLabel().animate(X,I)}refresh(l,p){let{chart:y,options:T,pointer:A,shared:P}=this,I=lu(l),B=I[0],X=T.format,re=T.formatter||this.defaultFormatter,te=y.styledMode,pe=this.allowShared;if(!T.enabled||!B.series)return;Ps.clearTimeout(this.hideTimer),this.allowShared=!(!$p(l)&&l.series&&l.series.noSharedTooltip),pe=pe&&!this.allowShared,this.followPointer=!this.split&&B.series.tooltipOptions.followPointer;let _e=this.getAnchor(l,p),Ee=_e[0],De=_e[1];P&&this.allowShared&&(A.applyInactiveState(I),I.forEach(Ze=>Ze.setState("hover")),B.points=I),this.len=I.length;let Re=Oh(X)?Od(X,B,y):re.call(B,this);B.points=void 0;let Be=B.series;if(this.distance=Ru(Be.tooltipOptions.distance,16),Re===!1)this.hide();else{if(this.split&&this.allowShared)this.renderSplit(Re,I);else{let Ze=Ee,rt=De;if(p&&A.isDirectTouch&&(Ze=p.chartX-y.plotLeft,rt=p.chartY-y.plotTop),!(y.polar||Be.options.clip===!1||I.some(Yt=>A.isDirectTouch||Yt.series.shouldShowTooltip(Ze,rt))))return void this.hide();{let Yt=this.getLabel(pe&&this.tt||{});(!T.style.width||te)&&Yt.css({width:(this.outside?this.getPlayingField():y.spacingBox).width+"px"}),Yt.attr({class:this.getClassName(B),text:Re&&Re.join?Re.join(""):Re}),this.outside&&Yt.attr({x:zu(Yt.x||0,0,this.getPlayingField().width-(Yt.width||0)-1)}),te||Yt.attr({stroke:T.borderColor||B.color||Be.color||"#666666"}),this.updatePosition({plotX:Ee,plotY:De,negative:B.negative,ttBelow:B.ttBelow,series:Be,h:_e[2]||0})}}this.isHidden&&this.label&&this.label.attr({opacity:1}).show(),this.isHidden=!1}Lh(this,"refresh")}renderSplit(l,p){var en,uc;let y=this,{chart:T,chart:{chartWidth:A,chartHeight:P,plotHeight:I,plotLeft:B,plotTop:X,scrollablePixelsY:re=0,scrollablePixelsX:te,styledMode:pe},distance:_e,options:Ee,options:{fixed:De,position:Re,positioner:Be},pointer:Ze}=y,{scrollLeft:rt=0,scrollTop:Yt=0}=((en=T.scrollablePlotArea)==null?void 0:en.scrollingContainer)||{},Ut=y.outside&&typeof te!="number"?Xp.documentElement.getBoundingClientRect():{left:rt,right:rt+A},Xt=y.getLabel(),Ci=this.renderer||T.renderer,di=!!((uc=T.xAxis[0])!=null&&uc.opposite),{left:vi,top:es}=Ze.getChartPosition(),ws=Be||De,As=X+Yt,$s=0,kr=I-re,pr=function(gn,va,Fo,Ao=[0,0],oh=!0){let Ya,El;if(Fo.isHeader)El=di?0:kr,Ya=zu(Ao[0]-gn/2,Ut.left,Ut.right-gn-(y.outside?vi:0));else if(De&&Fo){let Nh=y.getFixedPosition(gn,va,Fo);Ya=Nh.x,El=Nh.y-As}else El=Ao[1]-As,Ya=zu(Ya=oh?Ao[0]-gn-_e:Ao[0]+_e,oh?Ya:Ut.left,Ut.right);return{x:Ya,y:El}};Oh(l)&&(l=[!1,l]);let Vr=l.slice(0,p.length+1).reduce(function(gn,va,Fo){if(va!==!1&&va!==""){let Ao=p[Fo-1]||{isHeader:!0,plotX:p[0].plotX,plotY:I,series:{}},oh=Ao.isHeader,Ya=oh?y:Ao.series,El=Ya.tt=function(H,n,m){let x=H,{isHeader:S,series:k}=n,L=k.tooltipOptions||Ee;if(!x){let R={padding:L.padding,r:L.borderRadius};pe||(R.fill=L.backgroundColor,R["stroke-width"]=L.borderWidth??(De&&!S?0:1)),x=Ci.label("",0,0,L[S?"headerShape":"shape"]||(De&&!S?"rect":"callout"),void 0,void 0,L.useHTML).addClass(y.getClassName(n,!0,S)).attr(R).add(Xt)}return x.isActive=!0,x.attr({text:m}),pe||x.css(L.style).attr({stroke:L.borderColor||n.color||k.color||"#333333"}),x}(Ya.tt,Ao,va.toString()),Nh=El.getBBox(),Tm=Nh.width+El.strokeWidth();oh&&($s=Nh.height,kr+=$s,di&&(As-=$s));let{anchorX:Fp,anchorY:vd}=function(H){let n,m,{isHeader:x,plotX:S=0,plotY:k=0,series:L}=H;if(x)n=Math.max(B+S,B),m=X+I/2;else{let{xAxis:R,yAxis:N}=L;n=R.pos+zu(S,-_e,R.len+_e),L.shouldShowTooltip(0,N.pos-X+k,{ignoreX:!0})&&(m=N.pos+k)}return{anchorX:n=zu(n,Ut.left-_e,Ut.right+_e),anchorY:m}}(Ao);if(typeof vd=="number"){let H=Nh.height+1,n=(Be||pr).call(y,Tm,H,Ao,[Fp,vd]);gn.push({align:ws?0:void 0,anchorX:Fp,anchorY:vd,boxWidth:Tm,point:Ao,rank:Ru(n.rank,+!!oh),size:H,target:n.y,tt:El,x:n.x})}else El.isActive=!1}return gn},[]);!ws&&Vr.some(gn=>{let{outside:va}=y,Fo=(va?vi:0)+gn.anchorX;return Fo<Ut.left&&Fo+gn.boxWidth<Ut.right||Fo<vi-Ut.left+gn.boxWidth&&Ut.right-Fo>Fo})&&(Vr=Vr.map(gn=>{let{x:va,y:Fo}=pr.call(this,gn.boxWidth,gn.size,gn.point,[gn.anchorX,gn.anchorY],!1);return Yp(gn,{target:Fo,x:va})})),y.cleanSplit(),yf(Vr,kr);let cr={left:vi,right:vi};Vr.forEach(function(gn){let{x:va,boxWidth:Fo,isHeader:Ao}=gn;!Ao&&(y.outside&&vi+va<cr.left&&(cr.left=vi+va),!Ao&&y.outside&&cr.left+Fo>cr.right&&(cr.right=vi+va))}),Vr.forEach(function(gn){let{x:va,anchorX:Fo,anchorY:Ao,pos:oh,point:{isHeader:Ya}}=gn,El={visibility:oh===void 0?"hidden":"inherit",x:va,y:(oh||0)+As+(De&&Re.y||0),anchorX:Fo,anchorY:Ao};if(y.outside&&va<Fo){let Nh=vi-cr.left;Nh>0&&(Ya||(El.x=va+Nh,El.anchorX=Fo+Nh),Ya&&(El.x=(cr.right-cr.left)/2,El.anchorX=Fo+Nh))}gn.tt.attr(El)});let{container:Zr,outside:Cn,renderer:Qo}=y;if(Cn&&Zr&&Qo){let{width:gn,height:va,x:Fo,y:Ao}=Xt.getBBox();Qo.setSize(gn+Fo,va+Ao,!1),Zr.style.left=cr.left+"px",Zr.style.top=es+"px"}rm&&Xt.attr({opacity:Xt.opacity===1?.999:1})}drawTracker(){if(!this.shouldStickOnContact()){this.tracker&&(this.tracker=this.tracker.destroy());return}let l=this.chart,p=this.label,y=this.shared?l.hoverPoints:l.hoverPoint;if(!p||!y)return;let T={x:0,y:0,width:0,height:0},A=this.getAnchor(y),P=p.getBBox();A[0]+=l.plotLeft-(p.translateX||0),A[1]+=l.plotTop-(p.translateY||0),T.x=Math.min(0,A[0]),T.y=Math.min(0,A[1]),T.width=A[0]<0?Math.max(Math.abs(A[0]),P.width-A[0]):Math.max(Math.abs(A[0]),P.width),T.height=A[1]<0?Math.max(Math.abs(A[1]),P.height-Math.abs(A[1])):Math.max(Math.abs(A[1]),P.height),this.tracker?this.tracker.attr(T):(this.tracker=p.renderer.rect(T).addClass("highcharts-tracker").add(p),l.styledMode||this.tracker.attr({fill:"rgba(0,0,0,0)"}))}styledModeFormat(l){return l.replace('style="font-size: 0.8em"','class="highcharts-header"').replace(/style="color:{(point|series)\.color}"/g,'class="highcharts-color-{$1.colorIndex} {series.options.className} {point.options.className}"')}headerFooterFormatter(l,p){let y=l.series,T=y.tooltipOptions,A=y.xAxis,P=A==null?void 0:A.dateTime,I={isFooter:p,point:l},B=T.xDateFormat||"",X=T[p?"footerFormat":"headerFormat"];return Lh(this,"headerFormatter",I,function(re){if(P&&!B&&xf(l.key)&&(B=P.getXDateFormat(l.key,T.dateTimeLabelFormats)),P&&B){if(_f(B)){let te=B;sm[0]=pe=>y.chart.time.dateFormat(te,pe),B="%0"}(l.tooltipDateKeys||["key"]).forEach(te=>{X=X.replace(RegExp("point\\."+te+"([ \\)}])"),`(point.${te}:${B})$1`)})}y.chart.styledMode&&(X=this.styledModeFormat(X)),re.text=Od(X,l,this.chart)}),I.text||""}update(l){this.destroy(),this.init(this.chart,om(!0,this.options,l))}updatePosition(l){var Ut;let{chart:p,container:y,distance:T,options:A,pointer:P,renderer:I}=this,{height:B=0,width:X=0}=this.getLabel(),{fixed:re,positioner:te}=A,{left:pe,top:_e,scaleX:Ee,scaleY:De}=P.getChartPosition(),Re=(te||re&&this.getFixedPosition||this.getPosition).call(this,X,B,l),Be=pi.doc,Ze=(l.plotX||0)+p.plotLeft,rt=(l.plotY||0)+p.plotTop,Yt;if(I&&y){if(te||re){let{scrollLeft:Xt=0,scrollTop:Ci=0}=((Ut=p.scrollablePlotArea)==null?void 0:Ut.scrollingContainer)||{};Re.x+=Xt+pe-T,Re.y+=Ci+_e-T}Yt=(A.borderWidth||0)+2*T+2,I.setSize(zu(X+Yt,0,Be.documentElement.clientWidth)-1,B+Yt,!1),(Ee!==1||De!==1)&&(ng(y,{transform:`scale(${Ee}, ${De})`}),Ze*=Ee,rt*=De),Ze+=pe-Re.x,rt+=_e-Re.y}this.move(Math.round(Re.x),Math.round(Re.y||0),Ze,rt)}}(function(q){q.compose=function(l){vf(au,"Core.Tooltip")&&ld(l,"afterInit",function(){let p=this.chart;p.options.tooltip&&(p.tooltip=new q(p,p.options.tooltip,this))})}})(qp||(qp={}));let lc=qp,{animObject:vp}=to,{defaultOptions:bp}=Ra,{format:nm}=fa,{addEvent:Om,crisp:hd,erase:Bu,extend:Zp,fireEvent:Wc,getNestedProperty:cd,isArray:bf,isFunction:Dm,isNumber:_h,isObject:bn,merge:wp,pick:Ge,syncTimeout:J,removeEvent:ge,uniqueKey:xe}=Ps;class Ie{animateBeforeDestroy(){let l=this,p={x:l.startXPos,opacity:0},y=l.getGraphicalProps();y.singular.forEach(function(T){l[T]=l[T].animate(T==="dataLabel"?{x:l[T].startXPos,y:l[T].startYPos,opacity:0}:p)}),y.plural.forEach(function(T){l[T].forEach(function(A){A.element&&A.animate(Zp({x:l.startXPos},A.startYPos?{x:A.startXPos,y:A.startYPos}:{}))})})}applyOptions(l,p){let y=this.series,T=y.options.pointValKey||y.pointValKey;return Zp(this,l=Ie.prototype.optionsToObject.call(this,l)),this.options=this.options?Zp(this.options,l):l,l.group&&delete this.group,l.dataLabels&&delete this.dataLabels,T&&(this.y=Ie.prototype.getNestedProperty.call(this,T)),this.selected&&(this.state="select"),"name"in this&&p===void 0&&y.xAxis&&y.xAxis.hasNames&&(this.x=y.xAxis.nameToX(this)),this.x===void 0&&y?this.x=p??y.autoIncrement():_h(l.x)&&y.options.relativeXValue?this.x=y.autoIncrement(l.x):typeof this.x=="string"&&(p??(p=y.chart.time.parse(this.x)),_h(p)&&(this.x=p)),this.isNull=this.isValid&&!this.isValid(),this.formatPrefix=this.isNull?"null":"point",this}destroy(){if(!this.destroyed){let l=this,p=l.series,y=p.chart,T=p.options.dataSorting,A=y.hoverPoints,P=vp(l.series.chart.renderer.globalAnimation),I=()=>{for(let B in(l.graphic||l.graphics||l.dataLabel||l.dataLabels)&&(ge(l),l.destroyElements()),l)delete l[B]};l.legendItem&&y.legend.destroyItem(l),A&&(l.setState(),Bu(A,l),A.length||(y.hoverPoints=null)),l===y.hoverPoint&&l.onMouseOut(),T!=null&&T.enabled?(this.animateBeforeDestroy(),J(I,P.duration)):I(),y.pointCount--}this.destroyed=!0}destroyElements(l){let p=this,y=p.getGraphicalProps(l);y.singular.forEach(function(T){p[T]=p[T].destroy()}),y.plural.forEach(function(T){p[T].forEach(function(A){A!=null&&A.element&&A.destroy()}),delete p[T]})}firePointEvent(l,p,y){let T=this,A=this.series.options;T.manageEvent(l),l==="click"&&A.allowPointSelect&&(y=function(P){!T.destroyed&&T.select&&T.select(null,P.ctrlKey||P.metaKey||P.shiftKey)}),Wc(T,l,p,y)}getClassName(){var l;return"highcharts-point"+(this.selected?" highcharts-point-select":"")+(this.negative?" highcharts-negative":"")+(this.isNull?" highcharts-null-point":"")+(this.colorIndex!==void 0?" highcharts-color-"+this.colorIndex:"")+(this.options.className?" "+this.options.className:"")+((l=this.zone)!=null&&l.className?" "+this.zone.className.replace("highcharts-negative",""):"")}getGraphicalProps(l){let p,y,T=this,A=[],P={singular:[],plural:[]};for((l=l||{graphic:1,dataLabel:1}).graphic&&A.push("graphic","connector"),l.dataLabel&&A.push("dataLabel","dataLabelPath","dataLabelUpper"),y=A.length;y--;)T[p=A[y]]&&P.singular.push(p);return["graphic","dataLabel"].forEach(function(I){let B=I+"s";l[I]&&T[B]&&P.plural.push(B)}),P}getNestedProperty(l){if(l)return l.indexOf("custom.")===0?cd(l,this.options):this[l]}getZone(){let l=this.series,p=l.zones,y=l.zoneAxis||"y",T,A=0;for(T=p[0];this[y]>=T.value;)T=p[++A];return this.nonZonedColor||(this.nonZonedColor=this.color),T!=null&&T.color&&!this.options.color?this.color=T.color:this.color=this.nonZonedColor,T}hasNewShapeType(){return(this.graphic&&(this.graphic.symbolName||this.graphic.element.nodeName))!==this.shapeType}constructor(l,p,y){this.formatPrefix="point",this.visible=!0,this.point=this,this.series=l,this.applyOptions(p,y),this.id??(this.id=xe()),this.resolveColor(),this.dataLabelOnNull??(this.dataLabelOnNull=l.options.nullInteraction),l.chart.pointCount++,Wc(this,"afterInit")}isValid(){return(_h(this.x)||this.x instanceof Date)&&_h(this.y)}optionsToObject(l){var re;let p=this.series,y=p.options.keys,T=y||p.pointArrayMap||["y"],A=T.length,P={},I,B=0,X=0;if(_h(l)||l===null)P[T[0]]=l;else if(bf(l))for(!y&&l.length>A&&((I=typeof l[0])=="string"?(re=p.xAxis)!=null&&re.dateTime?P.x=p.chart.time.parse(l[0]):P.name=l[0]:I==="number"&&(P.x=l[0]),B++);X<A;)y&&l[B]===void 0||(T[X].indexOf(".")>0?Ie.prototype.setNestedProperty(P,l[B],T[X]):P[T[X]]=l[B]),B++,X++;else typeof l=="object"&&(P=l,l.dataLabels&&(p.hasDataLabels=()=>!0),l.marker&&(p._hasPointMarkers=!0));return P}pos(l,p=this.plotY){if(!this.destroyed){let{plotX:y,series:T}=this,{chart:A,xAxis:P,yAxis:I}=T,B=0,X=0;if(_h(y)&&_h(p))return l&&(B=P?P.pos:A.plotLeft,X=I?I.pos:A.plotTop),A.inverted&&P&&I?[I.len-p+X,P.len-y+B]:[y+B,p+X]}}resolveColor(){let l=this.series,p=l.chart.options.chart,y=l.chart.styledMode,T,A,P=p.colorCount,I;delete this.nonZonedColor,l.options.colorByPoint?(y||(T=(A=l.options.colors||l.chart.options.colors)[l.colorCounter],P=A.length),I=l.colorCounter,l.colorCounter++,l.colorCounter===P&&(l.colorCounter=0)):(y||(T=l.color),I=l.colorIndex),this.colorIndex=Ge(this.options.colorIndex,I),this.color=Ge(this.options.color,T)}setNestedProperty(l,p,y){return y.split(".").reduce(function(T,A,P,I){let B=I.length-1===P;return T[A]=B?p:bn(T[A],!0)?T[A]:{},T[A]},l),l}shouldDraw(){return!this.isNull}tooltipFormatter(l){var B;let{chart:p,pointArrayMap:y=["y"],tooltipOptions:T}=this.series,{valueDecimals:A="",valuePrefix:P="",valueSuffix:I=""}=T;return p.styledMode&&(l=((B=p.tooltip)==null?void 0:B.styledModeFormat(l))||l),y.forEach(X=>{X="{point."+X,(P||I)&&(l=l.replace(RegExp(X+"}","g"),P+X+"}"+I)),l=l.replace(RegExp(X+"}","g"),X+":,."+A+"f}")}),nm(l,this,p)}update(l,p,y,T){let A,P=this,I=P.series,B=P.graphic,X=I.chart,re=I.options;function te(){P.applyOptions(l);let pe=B&&P.hasMockGraphic,_e=P.y===null?!pe:pe;B&&_e&&(P.graphic=B.destroy(),delete P.hasMockGraphic),bn(l,!0)&&(B!=null&&B.element&&l&&l.marker&&l.marker.symbol!==void 0&&(P.graphic=B.destroy()),l!=null&&l.dataLabels&&P.dataLabel&&(P.dataLabel=P.dataLabel.destroy())),A=P.index;let Ee={};for(let De of I.dataColumnKeys())Ee[De]=P[De];I.dataTable.setRow(Ee,A),re.data[A]=bn(re.data[A],!0)||bn(l,!0)?P.options:Ge(l,re.data[A]),I.isDirty=I.isDirtyData=!0,!I.fixedBox&&I.hasCartesianSeries&&(X.isDirtyBox=!0),re.legendType==="point"&&(X.isDirtyLegend=!0),p&&X.redraw(y)}p=Ge(p,!0),T===!1?te():P.firePointEvent("update",{options:l},te)}remove(l,p){this.series.removePoint(this.series.data.indexOf(this),l,p)}select(l,p){let y=this,T=y.series,A=T.chart;l=Ge(l,!y.selected),this.selectedStaging=l,y.firePointEvent(l?"select":"unselect",{accumulate:p},function(){y.selected=y.options.selected=l,T.options.data[T.data.indexOf(y)]=y.options,y.setState(l&&"select"),p||A.getSelectedPoints().forEach(function(P){let I=P.series;P.selected&&P!==y&&(P.selected=P.options.selected=!1,I.options.data[I.data.indexOf(P)]=P.options,P.setState(A.hoverPoints&&I.options.inactiveOtherPoints?"inactive":""),P.firePointEvent("unselect"))})}),delete this.selectedStaging}onMouseOver(l){let{inverted:p,pointer:y}=this.series.chart;y&&(l=l?y.normalize(l):y.getChartCoordinatesFromPoint(this,p),y.runPointActions(l,this))}onMouseOut(){let l=this.series.chart;this.firePointEvent("mouseOut"),this.series.options.inactiveOtherPoints||(l.hoverPoints||[]).forEach(function(p){p.setState()}),l.hoverPoints=l.hoverPoint=null}manageEvent(l){var T,A,P,I,B,X,re;let p=wp(this.series.options.point,this.options),y=(T=p.events)==null?void 0:T[l];Dm(y)&&(!((A=this.hcEvents)!=null&&A[l])||((I=(P=this.hcEvents)==null?void 0:P[l])==null?void 0:I.map(te=>te.fn).indexOf(y))===-1)?((B=this.importedUserEvent)==null||B.call(this),this.importedUserEvent=Om(this,l,y),this.hcEvents&&(this.hcEvents[l].userEvent=!0)):this.importedUserEvent&&!y&&((X=this.hcEvents)!=null&&X[l])&&((re=this.hcEvents)!=null&&re[l].userEvent)&&(ge(this,l),delete this.hcEvents[l],Object.keys(this.hcEvents)||delete this.importedUserEvent)}setState(l,p){var Xt,Ci;let y=this.series,T=this.state,A=y.options.states[l||"normal"]||{},P=bp.plotOptions[y.type].marker&&y.options.marker,I=P&&P.enabled===!1,B=((Xt=P==null?void 0:P.states)==null?void 0:Xt[l||"normal"])||{},X=B.enabled===!1,re=this.marker||{},te=y.chart,pe=P&&y.markerAttribs,_e=y.halo,Ee,De,Re,Be=y.stateMarkerGraphic,Ze;if((l=l||"")===this.state&&!p||this.selected&&l!=="select"||A.enabled===!1||l&&(X||I&&B.enabled===!1)||l&&re.states&&re.states[l]&&re.states[l].enabled===!1)return;if(this.state=l,pe&&(Ee=y.markerAttribs(this,l)),this.graphic&&!this.hasMockGraphic){if(T&&this.graphic.removeClass("highcharts-point-"+T),l&&this.graphic.addClass("highcharts-point-"+l),!te.styledMode){De=y.pointAttribs(this,l),Re=Ge(te.options.chart.animation,A.animation);let di=De.opacity;y.options.inactiveOtherPoints&&_h(di)&&(this.dataLabels||[]).forEach(function(vi){vi&&!vi.hasClass("highcharts-data-label-hidden")&&(vi.animate({opacity:di},Re),vi.connector&&vi.connector.animate({opacity:di},Re))}),this.graphic.animate(De,Re)}Ee&&this.graphic.animate(Ee,Ge(te.options.chart.animation,B.animation,P.animation)),Be&&Be.hide()}else l&&B&&(Ze=re.symbol||y.symbol,Be&&Be.currentSymbol!==Ze&&(Be=Be.destroy()),Ee&&(Be?Be[p?"animate":"attr"]({x:Ee.x,y:Ee.y}):Ze&&(y.stateMarkerGraphic=Be=te.renderer.symbol(Ze,Ee.x,Ee.y,Ee.width,Ee.height,wp(P,B)).add(y.markerGroup),Be.currentSymbol=Ze)),!te.styledMode&&Be&&this.state!=="inactive"&&Be.attr(y.pointAttribs(this,l))),Be&&(Be[l&&this.isInside?"show":"hide"](),Be.element.point=this,Be.addClass(this.getClassName(),!0));let rt=A.halo,Yt=this.graphic||Be,Ut=(Yt==null?void 0:Yt.visibility)||"inherit";rt!=null&&rt.size&&Yt&&Ut!=="hidden"&&!this.isCluster?(_e||(y.halo=_e=te.renderer.path().add(Yt.parentGroup)),_e.show()[p?"animate":"attr"]({d:this.haloPath(rt.size)}),_e.attr({class:"highcharts-halo highcharts-color-"+Ge(this.colorIndex,y.colorIndex)+(this.className?" "+this.className:""),visibility:Ut,zIndex:-1}),_e.point=this,te.styledMode||_e.attr(Zp({fill:this.color||y.color,"fill-opacity":rt.opacity},Gn.filterUserAttributes(rt.attributes||{})))):(Ci=_e==null?void 0:_e.point)!=null&&Ci.haloPath&&!_e.point.destroyed&&_e.animate({d:_e.point.haloPath(0)},null,_e.hide),Wc(this,"afterSetState",{state:l})}haloPath(l){let p=this.pos();return p?this.series.chart.renderer.symbols.circle(hd(p[0],1)-l,p[1]-l,2*l,2*l):[]}}let je=Ie,{parse:Ye}=at,{charts:mt,composed:bt,isTouchDevice:Bt}=pi,{addEvent:gt,attr:Lt,css:qe,extend:vt,find:_t,fireEvent:Wt,isNumber:Gt,isObject:Vt,objectEach:ji,offset:Ms,pick:zi,pushUnique:os,splat:Fs}=Ps;class Xi{applyInactiveState(l=[]){let p=[];l.forEach(y=>{let T=y.series;p.push(T),T.linkedParent&&p.push(T.linkedParent),T.linkedSeries&&p.push.apply(p,T.linkedSeries),T.navigatorSeries&&p.push(T.navigatorSeries),T.boosted&&T.markerGroup&&p.push.apply(p,this.chart.series.filter(A=>A.markerGroup===T.markerGroup))}),this.chart.series.forEach(y=>{p.indexOf(y)===-1?y.setState("inactive",!0):y.options.inactiveOtherPoints&&y.setAllPointsToState("inactive")})}destroy(){let l=this;this.eventsToUnbind.forEach(p=>p()),this.eventsToUnbind=[],!pi.chartCount&&(Xi.unbindDocumentMouseUp.forEach(p=>p.unbind()),Xi.unbindDocumentMouseUp.length=0,Xi.unbindDocumentTouchEnd&&(Xi.unbindDocumentTouchEnd=Xi.unbindDocumentTouchEnd())),clearInterval(l.tooltipTimeout),ji(l,function(p,y){l[y]=void 0})}getSelectionMarkerAttrs(l,p){let y={args:{chartX:l,chartY:p},attrs:{},shapeType:"rect"};return Wt(this,"getSelectionMarkerAttrs",y,T=>{let A,{chart:P,zoomHor:I,zoomVert:B}=this,{mouseDownX:X=0,mouseDownY:re=0}=P,te=T.attrs;te.x=P.plotLeft,te.y=P.plotTop,te.width=I?1:P.plotWidth,te.height=B?1:P.plotHeight,I&&(te.width=Math.max(1,Math.abs(A=l-X)),te.x=(A>0?0:A)+X),B&&(te.height=Math.max(1,Math.abs(A=p-re)),te.y=(A>0?0:A)+re)}),y}drag(l){let{chart:p}=this,{mouseDownX:y=0,mouseDownY:T=0}=p,{panning:A,panKey:P,selectionMarkerFill:I}=p.options.chart,B=p.plotLeft,X=p.plotTop,re=p.plotWidth,te=p.plotHeight,pe=Vt(A)?A.enabled:A,_e=P&&l[`${P}Key`],Ee=l.chartX,De=l.chartY,Re,Be=this.selectionMarker;if((!Be||!Be.touch)&&(Ee<B?Ee=B:Ee>B+re&&(Ee=B+re),De<X?De=X:De>X+te&&(De=X+te),this.hasDragged=Math.sqrt(Math.pow(y-Ee,2)+Math.pow(T-De,2)),this.hasDragged>10)){Re=p.isInsidePlot(y-B,T-X,{visiblePlotOnly:!0});let{shapeType:Ze,attrs:rt}=this.getSelectionMarkerAttrs(Ee,De);this.hasZoom&&Re&&!_e&&!Be&&(this.selectionMarker=Be=p.renderer[Ze](),Be.attr({class:"highcharts-selection-marker",zIndex:7}).add(),p.styledMode||Be.attr({fill:I||Ye("#334eff").setOpacity(.25).get()})),Be&&Be.attr(rt),Re&&!Be&&pe&&p.pan(l,A)}}dragStart(l){let p=this.chart;p.mouseIsDown=l.type,p.cancelClick=!1,p.mouseDownX=l.chartX,p.mouseDownY=l.chartY}getSelectionBox(l){let p={args:{marker:l},result:l.getBBox()};return Wt(this,"getSelectionBox",p),p.result}drop(l){let p,{chart:y,selectionMarker:T}=this;for(let A of y.axes)A.isPanning&&(A.isPanning=!1,(A.options.startOnTick||A.options.endOnTick||A.series.some(P=>P.boosted))&&(A.forceRedraw=!0,A.setExtremes(A.userMin,A.userMax,!1),p=!0));if(p&&y.redraw(),T&&l){if(this.hasDragged){let A=this.getSelectionBox(T);y.transform({axes:y.axes.filter(P=>P.zoomEnabled&&(P.coll==="xAxis"&&this.zoomX||P.coll==="yAxis"&&this.zoomY)),selection:{originalEvent:l,xAxis:[],yAxis:[],...A},from:A})}Gt(y.index)&&(this.selectionMarker=T.destroy())}y&&Gt(y.index)&&(qe(y.container,{cursor:y._cursor}),y.cancelClick=this.hasDragged>10,y.mouseIsDown=!1,this.hasDragged=0,this.pinchDown=[])}findNearestKDPoint(l,p,y){let T;return l.forEach(function(A){let P=!(A.noSharedTooltip&&p)&&0>A.options.findNearestPointBy.indexOf("y"),I=A.searchPoint(y,P);Vt(I,!0)&&I.series&&(!Vt(T,!0)||function(B,X){var _e,Ee;let re=B.distX-X.distX,te=B.dist-X.dist,pe=((_e=X.series.group)==null?void 0:_e.zIndex)-((Ee=B.series.group)==null?void 0:Ee.zIndex);return re!==0&&p?re:te!==0?te:pe!==0?pe:B.series.index>X.series.index?-1:1}(T,I)>0)&&(T=I)}),T}getChartCoordinatesFromPoint(l,p){let{xAxis:y,yAxis:T}=l.series,A=l.shapeArgs;if(y&&T){let P=l.clientX??l.plotX??0,I=l.plotY||0;return l.isNode&&A&&Gt(A.x)&&Gt(A.y)&&(P=A.x,I=A.y),p?{chartX:T.len+T.pos-I,chartY:y.len+y.pos-P}:{chartX:P+y.pos,chartY:I+T.pos}}if(A!=null&&A.x&&A.y)return{chartX:A.x,chartY:A.y}}getChartPosition(){if(this.chartPosition)return this.chartPosition;let{container:l}=this.chart,p=Ms(l);this.chartPosition={left:p.left,top:p.top,scaleX:1,scaleY:1};let{offsetHeight:y,offsetWidth:T}=l;return T>2&&y>2&&(this.chartPosition.scaleX=p.width/T,this.chartPosition.scaleY=p.height/y),this.chartPosition}getCoordinates(l){let p={xAxis:[],yAxis:[]};for(let y of this.chart.axes)p[y.isXAxis?"xAxis":"yAxis"].push({axis:y,value:y.toValue(l[y.horiz?"chartX":"chartY"])});return p}getHoverData(l,p,y,T,A,P){let I=[],B=function(_e){return _e.visible&&!(!A&&_e.directTouch)&&zi(_e.options.enableMouseTracking,!0)},X=p,re,te={chartX:P?P.chartX:void 0,chartY:P?P.chartY:void 0,shared:A};Wt(this,"beforeGetHoverData",te),re=X&&!X.stickyTracking?[X]:y.filter(_e=>_e.stickyTracking&&(te.filter||B)(_e));let pe=T&&l||!P?l:this.findNearestKDPoint(re,A,P);return X=pe==null?void 0:pe.series,pe&&(A&&!X.noSharedTooltip?(re=y.filter(function(_e){return te.filter?te.filter(_e):B(_e)&&!_e.noSharedTooltip})).forEach(function(_e){var Re;let Ee=(Re=_e.options)==null?void 0:Re.nullInteraction,De=_t(_e.points,function(Be){return Be.x===pe.x&&(!Be.isNull||!!Ee)});Vt(De)&&(_e.boosted&&_e.boost&&(De=_e.boost.getPoint(De)),I.push(De))}):I.push(pe)),Wt(this,"afterGetHoverData",te={hoverPoint:pe}),{hoverPoint:te.hoverPoint,hoverSeries:X,hoverPoints:I}}getPointFromEvent(l){let p=l.target,y;for(;p&&!y;)y=p.point,p=p.parentNode;return y}onTrackerMouseOut(l){let p=this.chart,y=l.relatedTarget,T=p.hoverSeries;this.isDirectTouch=!1,!T||!y||T.stickyTracking||this.inClass(y,"highcharts-tooltip")||this.inClass(y,"highcharts-series-"+T.index)&&this.inClass(y,"highcharts-tracker")||T.onMouseOut()}inClass(l,p){let y=l,T;for(;y;){if(T=Lt(y,"class")){if(T.indexOf(p)!==-1)return!0;if(T.indexOf("highcharts-container")!==-1)return!1}y=y.parentElement}}constructor(l,p){var y;this.hasDragged=0,this.pointerCaptureEventsToUnbind=[],this.eventsToUnbind=[],this.options=p,this.chart=l,this.runChartClick=!!((y=p.chart.events)!=null&&y.click),this.pinchDown=[],this.setDOMEvents(),Wt(this,"afterInit")}normalize(l,p){let y=l.touches,T=y?y.length?y.item(0):zi(y.changedTouches,l.changedTouches)[0]:l;p||(p=this.getChartPosition());let A=T.pageX-p.left,P=T.pageY-p.top;return vt(l,{chartX:Math.round(A/=p.scaleX),chartY:Math.round(P/=p.scaleY)})}onContainerClick(l){let p=this.chart,y=p.hoverPoint,T=this.normalize(l),A=p.plotLeft,P=p.plotTop;!p.cancelClick&&(y&&this.inClass(T.target,"highcharts-tracker")?(Wt(y.series,"click",vt(T,{point:y})),p.hoverPoint&&y.firePointEvent("click",T)):(vt(T,this.getCoordinates(T)),p.isInsidePlot(T.chartX-A,T.chartY-P,{visiblePlotOnly:!0})&&Wt(p,"click",T)))}onContainerMouseDown(l){var y;let p=(1&(l.buttons||l.button))==1;l=this.normalize(l),pi.isFirefox&&l.button!==0&&this.onContainerMouseMove(l),(l.button===void 0||p)&&(this.zoomOption(l),p&&((y=l.preventDefault)==null||y.call(l)),this.dragStart(l))}onContainerMouseLeave(l){let{pointer:p}=mt[zi(Xi.hoverChartIndex,-1)]||{};l=this.normalize(l),this.onContainerMouseMove(l),p&&!this.inClass(l.relatedTarget,"highcharts-tooltip")&&(p.reset(),p.chartPosition=void 0)}onContainerMouseEnter(){delete this.chartPosition}onContainerMouseMove(l){var A;let p=this.chart,y=p.tooltip,T=this.normalize(l);this.setHoverChartIndex(l),(p.mouseIsDown==="mousedown"||this.touchSelect(T))&&this.drag(T),!((A=p.exporting)!=null&&A.openMenu)&&(this.inClass(T.target,"highcharts-tracker")||p.isInsidePlot(T.chartX-p.plotLeft,T.chartY-p.plotTop,{visiblePlotOnly:!0}))&&!(y!=null&&y.shouldStickOnContact(T))&&(this.inClass(T.target,"highcharts-no-tooltip")?this.reset(!1,0):this.runPointActions(T))}onDocumentTouchEnd(l){this.onDocumentMouseUp(l)}onContainerTouchMove(l){this.touchSelect(l)?this.onContainerMouseMove(l):this.touch(l)}onContainerTouchStart(l){this.touchSelect(l)?this.onContainerMouseDown(l):(this.zoomOption(l),this.touch(l,!0))}onDocumentMouseMove(l){let p=this.chart,y=p.tooltip,T=this.chartPosition,A=this.normalize(l,T);!T||p.isInsidePlot(A.chartX-p.plotLeft,A.chartY-p.plotTop,{visiblePlotOnly:!0})||y!=null&&y.shouldStickOnContact(A)||A.target!==p.container.ownerDocument&&this.inClass(A.target,"highcharts-tracker")||this.reset()}onDocumentMouseUp(l){var p,y;(y=(p=mt[zi(Xi.hoverChartIndex,-1)])==null?void 0:p.pointer)==null||y.drop(l)}pinch(l){let p=this,{chart:y,hasZoom:T,lastTouches:A}=p,P=[].map.call(l.touches||[],te=>p.normalize(te)),I=P.length,B=I===1&&(p.inClass(l.target,"highcharts-tracker")&&y.runTrackerClick||p.runChartClick),X=y.tooltip,re=I===1&&zi(X==null?void 0:X.options.followTouchMove,!0);I>1?p.initiated=!0:re&&(p.initiated=!1),T&&p.initiated&&!B&&l.cancelable!==!1&&l.preventDefault(),l.type==="touchstart"?(p.pinchDown=P,p.res=!0,y.mouseDownX=l.chartX):re?this.runPointActions(p.normalize(l)):A&&(Wt(y,"touchpan",{originalEvent:l,touches:P},()=>{let te=pe=>{let _e=pe[0],Ee=pe[1]||_e;return{x:_e.chartX,y:_e.chartY,width:Ee.chartX-_e.chartX,height:Ee.chartY-_e.chartY}};y.transform({axes:y.axes.filter(pe=>pe.zoomEnabled&&(this.zoomHor&&pe.horiz||this.zoomVert&&!pe.horiz)),to:te(P),from:te(A),trigger:l.type})}),p.res&&(p.res=!1,this.reset(!1,0))),p.lastTouches=P}reset(l,p){let y=this.chart,T=y.hoverSeries,A=y.hoverPoint,P=y.hoverPoints,I=y.tooltip,B=I!=null&&I.shared?P:A;l&&B&&Fs(B).forEach(function(X){X.series.isCartesian&&X.plotX===void 0&&(l=!1)}),l?I&&B&&Fs(B).length&&(I.refresh(B),I.shared&&P?P.forEach(function(X){X.setState(X.state,!0),X.series.isCartesian&&(X.series.xAxis.crosshair&&X.series.xAxis.drawCrosshair(null,X),X.series.yAxis.crosshair&&X.series.yAxis.drawCrosshair(null,X))}):A&&(A.setState(A.state,!0),y.axes.forEach(function(X){X.crosshair&&A.series[X.coll]===X&&X.drawCrosshair(null,A)}))):(A&&A.onMouseOut(),P&&P.forEach(function(X){X.setState()}),T&&T.onMouseOut(),I&&I.hide(p),this.unDocMouseMove&&(this.unDocMouseMove=this.unDocMouseMove()),y.axes.forEach(function(X){X.hideCrosshair()}),y.hoverPoints=y.hoverPoint=void 0)}runPointActions(l,p,y){var De;let T=this.chart,A=T.series,P=(De=T.tooltip)!=null&&De.options.enabled?T.tooltip:void 0,I=!!P&&P.shared,B=p||T.hoverPoint,X=(B==null?void 0:B.series)||T.hoverSeries,re=(!l||l.type!=="touchmove")&&(!!p||(X==null?void 0:X.directTouch)&&this.isDirectTouch),te=this.getHoverData(B,X,A,re,I,l);B=te.hoverPoint,X=te.hoverSeries;let pe=te.hoverPoints,_e=(X==null?void 0:X.tooltipOptions.followPointer)&&!X.tooltipOptions.split,Ee=I&&X&&!X.noSharedTooltip;if(B&&(y||B!==T.hoverPoint||P!=null&&P.isHidden)){if((T.hoverPoints||[]).forEach(function(Re){pe.indexOf(Re)===-1&&Re.setState()}),T.hoverSeries!==X&&X.onMouseOver(),this.applyInactiveState(pe),(pe||[]).forEach(function(Re){Re.setState("hover")}),T.hoverPoint&&T.hoverPoint.firePointEvent("mouseOut"),!B.series)return;T.hoverPoints=pe,T.hoverPoint=B,B.firePointEvent("mouseOver",void 0,()=>{P&&B&&P.refresh(Ee?pe:B,l)})}else if(_e&&P&&!P.isHidden){let Re=P.getAnchor([{}],l);T.isInsidePlot(Re[0],Re[1],{visiblePlotOnly:!0})&&P.updatePosition({plotX:Re[0],plotY:Re[1]})}this.unDocMouseMove||(this.unDocMouseMove=gt(T.container.ownerDocument,"mousemove",Re=>{var Be,Ze;return(Ze=(Be=mt[Xi.hoverChartIndex??-1])==null?void 0:Be.pointer)==null?void 0:Ze.onDocumentMouseMove(Re)}),this.eventsToUnbind.push(this.unDocMouseMove)),T.axes.forEach(function(Re){var rt;let Be,Ze=((rt=Re.crosshair)==null?void 0:rt.snap)??!0;Ze&&((Be=T.hoverPoint)&&Be.series[Re.coll]===Re||(Be=_t(pe,Yt=>{var Ut;return((Ut=Yt.series)==null?void 0:Ut[Re.coll])===Re}))),Be||!Ze?Re.drawCrosshair(l,Be):Re.hideCrosshair()})}setDOMEvents(){let l=this.chart.container,p=l.ownerDocument;l.onmousedown=this.onContainerMouseDown.bind(this),l.onmousemove=this.onContainerMouseMove.bind(this),l.onclick=this.onContainerClick.bind(this),this.eventsToUnbind.push(gt(l,"mouseenter",this.onContainerMouseEnter.bind(this)),gt(l,"mouseleave",this.onContainerMouseLeave.bind(this))),Xi.unbindDocumentMouseUp.some(T=>T.doc===p)||Xi.unbindDocumentMouseUp.push({doc:p,unbind:gt(p,"mouseup",this.onDocumentMouseUp.bind(this))});let y=this.chart.renderTo.parentElement;for(;y&&y.tagName!=="BODY";)this.eventsToUnbind.push(gt(y,"scroll",()=>{delete this.chartPosition})),y=y.parentElement;this.eventsToUnbind.push(gt(l,"touchstart",this.onContainerTouchStart.bind(this),{passive:!1}),gt(l,"touchmove",this.onContainerTouchMove.bind(this),{passive:!1})),Xi.unbindDocumentTouchEnd||(Xi.unbindDocumentTouchEnd=gt(p,"touchend",this.onDocumentTouchEnd.bind(this),{passive:!1})),this.setPointerCapture(),gt(this.chart,"redraw",this.setPointerCapture.bind(this))}setPointerCapture(){var A,P;if(!Bt)return;let l=this.pointerCaptureEventsToUnbind,p=this.chart,y=p.container,T=zi((A=p.options.tooltip)==null?void 0:A.followTouchMove,!0)&&p.series.some(I=>I.options.findNearestPointBy.indexOf("y")>-1);!this.hasPointerCapture&&T?(l.push(gt(y,"pointerdown",I=>{var B,X;(B=I.target)!=null&&B.hasPointerCapture(I.pointerId)&&((X=I.target)==null||X.releasePointerCapture(I.pointerId))}),gt(y,"pointermove",I=>{var B,X;(X=(B=p.pointer)==null?void 0:B.getPointFromEvent(I))==null||X.onMouseOver(I)})),p.styledMode||qe(y,{"touch-action":"none"}),y.className+=" highcharts-no-touch-action",this.hasPointerCapture=!0):this.hasPointerCapture&&!T&&(l.forEach(I=>I()),l.length=0,p.styledMode||qe(y,{"touch-action":zi((P=p.options.chart.style)==null?void 0:P["touch-action"],"manipulation")}),y.className=y.className.replace(" highcharts-no-touch-action",""),this.hasPointerCapture=!1)}setHoverChartIndex(l){var T;let p=this.chart,y=pi.charts[zi(Xi.hoverChartIndex,-1)];if(y&&y!==p){let A={relatedTarget:p.container};l&&!(l!=null&&l.relatedTarget)&&Object.assign({},l,A),(T=y.pointer)==null||T.onContainerMouseLeave(l||A)}y!=null&&y.mouseIsDown||(Xi.hoverChartIndex=p.index)}touch(l,p){var P;let y,{chart:T,pinchDown:A=[]}=this;this.setHoverChartIndex(),(l=this.normalize(l)).touches.length===1?T.isInsidePlot(l.chartX-T.plotLeft,l.chartY-T.plotTop,{visiblePlotOnly:!0})&&!((P=T.exporting)!=null&&P.openMenu)?(p&&this.runPointActions(l),l.type==="touchmove"&&(y=!!A[0]&&Math.pow(A[0].chartX-l.chartX,2)+Math.pow(A[0].chartY-l.chartY,2)>=16),zi(y,!0)&&this.pinch(l)):p&&this.reset():l.touches.length===2&&this.pinch(l)}touchSelect(l){return!!(this.chart.zooming.singleTouch&&l.touches&&l.touches.length===1)}zoomOption(l){let p=this.chart,y=p.inverted,T=p.zooming.type||"",A,P;/touch/.test(l.type)&&(T=zi(p.zooming.pinchType,T)),this.zoomX=A=/x/.test(T),this.zoomY=P=/y/.test(T),this.zoomHor=A&&!y||P&&y,this.zoomVert=P&&!y||A&&y,this.hasZoom=A||P}}Xi.unbindDocumentMouseUp=[],function(q){q.compose=function(l){os(bt,"Core.Pointer")&&gt(l,"beforeRender",function(){this.pointer=new q(this,this.options)})}}(Xi||(Xi={}));let Es=Xi;(function(q){q.setLength=function(l,p,y){return Array.isArray(l)?(l.length=p,l):l[y?"subarray":"slice"](0,p)},q.splice=function(l,p,y,T,A=[]){if(Array.isArray(l))return Array.isArray(A)||(A=Array.from(A)),{removed:l.splice(p,y,...A),array:l};let P=Object.getPrototypeOf(l).constructor,I=l[T?"subarray":"slice"](p,p+y),B=new P(l.length-y+A.length);return B.set(l.subarray(0,p),0),B.set(A,p),B.set(l.subarray(p+y),p+A.length),{removed:I,array:B}}})(xs||(xs={}));let{setLength:Ns,splice:rr}=xs,{fireEvent:bs,objectEach:Ks,uniqueKey:or}=Ps,Jo=class{constructor(q={}){this.autoId=!q.id,this.columns={},this.id=q.id||or(),this.modified=this,this.rowCount=0,this.versionTag=or();let l=0;Ks(q.columns||{},(p,y)=>{this.columns[y]=p.slice(),l=Math.max(l,p.length)}),this.applyRowCount(l)}applyRowCount(q){this.rowCount=q,Ks(this.columns,(l,p)=>{l.length!==q&&(this.columns[p]=Ns(l,q))})}deleteRows(q,l=1){if(l>0&&q<this.rowCount){let p=0;Ks(this.columns,(y,T)=>{this.columns[T]=rr(y,q,l).array,p=y.length}),this.rowCount=p}bs(this,"afterDeleteRows",{rowIndex:q,rowCount:l}),this.versionTag=or()}getColumn(q,l){return this.columns[q]}getColumns(q,l){return(q||Object.keys(this.columns)).reduce((p,y)=>(p[y]=this.columns[y],p),{})}getRow(q,l){return(l||Object.keys(this.columns)).map(p=>{var y;return(y=this.columns[p])==null?void 0:y[q]})}setColumn(q,l=[],p=0,y){this.setColumns({[q]:l},p,y)}setColumns(q,l,p){let y=this.rowCount;Ks(q,(T,A)=>{this.columns[A]=T.slice(),y=T.length}),this.applyRowCount(y),p!=null&&p.silent||(bs(this,"afterSetColumns"),this.versionTag=or())}setRow(q,l=this.rowCount,p,y){let{columns:T}=this,A=p?this.rowCount+1:l+1;Ks(q,(P,I)=>{let B=T[I]||(y==null?void 0:y.addColumns)!==!1&&Array(A);B&&(p?B=rr(B,l,0,!0,[P]).array:B[l]=P,T[I]=B)}),A>this.rowCount&&this.applyRowCount(A),y!=null&&y.silent||(bs(this,"afterSetRows"),this.versionTag=or())}},{extend:co,merge:eo,pick:ya}=Ps;(function(q){function l(p,y,T){var Yt,Ut;let A=this.legendItem=this.legendItem||{},{chart:P,options:I}=this,{baseline:B=0,symbolWidth:X,symbolHeight:re}=p,te=this.symbol||"circle",pe=re/2,_e=P.renderer,Ee=A.group,De=B-Math.round((((Yt=p.fontMetrics)==null?void 0:Yt.b)||re)*(T?.4:.3)),Re={},Be,Ze=I.marker,rt=0;if(P.styledMode||(Re["stroke-width"]=Math.min(I.lineWidth||0,24),I.dashStyle?Re.dashstyle=I.dashStyle:I.linecap!=="square"&&(Re["stroke-linecap"]="round")),A.line=_e.path().addClass("highcharts-graph").attr(Re).add(Ee),T&&(A.area=_e.path().addClass("highcharts-area").add(Ee)),Re["stroke-linecap"]&&(rt=Math.min(A.line.strokeWidth(),X)/2),X){let Xt=[["M",rt,De],["L",X-rt,De]];A.line.attr({d:Xt}),(Ut=A.area)==null||Ut.attr({d:[...Xt,["L",X-rt,B],["L",rt,B]]})}if(Ze&&Ze.enabled!==!1&&X){let Xt=Math.min(ya(Ze.radius,pe),pe);te.indexOf("url")===0&&(Ze=eo(Ze,{width:re,height:re}),Xt=0),A.symbol=Be=_e.symbol(te,X/2-Xt,De-Xt,2*Xt,2*Xt,co({context:"legend"},Ze)).addClass("highcharts-point").add(Ee),Be.isMarker=!0}}q.areaMarker=function(p,y){l.call(this,p,y,!0)},q.lineMarker=l,q.rectangle=function(p,y){let T=y.legendItem||{},A=p.options,P=p.symbolHeight,I=A.squareSymbol,B=I?P:p.symbolWidth;T.symbol=this.chart.renderer.rect(I?(p.symbolWidth-P)/2:0,p.baseline-P+1,B,P,ya(p.options.symbolRadius,P/2)).addClass("highcharts-point").attr({zIndex:3}).add(T.group)}})(zs||(zs={}));let ta=zs,{defaultOptions:Ea}=Ra,{extend:mn,extendClass:qr,merge:Sl}=Ps;(function(q){function l(p,y){let T=Ea.plotOptions||{},A=y.defaultOptions,P=y.prototype;return P.type=p,P.pointClass||(P.pointClass=je),!q.seriesTypes[p]&&(A&&(T[p]=A),q.seriesTypes[p]=y,!0)}q.seriesTypes=pi.seriesTypes,q.registerSeriesType=l,q.seriesType=function(p,y,T,A,P){let I=Ea.plotOptions||{};if(y=y||"",I[p]=Sl(I[y],T),delete q.seriesTypes[p],l(p,qr(q.seriesTypes[y]||function(){},A)),q.seriesTypes[p].prototype.type=p,P){class B extends je{}mn(B.prototype,P),q.seriesTypes[p].prototype.pointClass=B}return q.seriesTypes[p]}})(hs||(hs={}));let oo=hs,{animObject:Hc,setAnimation:am}=to,{defaultOptions:pn}=Ra,{registerEventOptions:Cg}=ch,{svg:wf,win:tp}=pi,{seriesTypes:Oi}=oo,{format:ms}=fa,{arrayMax:Tp,arrayMin:kn,clamp:Zt,correctFloat:vh,crisp:zm,defined:Ho,destroyObjectProperties:hg,diffObjects:Pg,erase:Fl,error:ip,extend:Ml,find:ny,fireEvent:xa,getClosestDistance:Fu,getNestedProperty:el,insertItem:tl,isArray:cg,isNumber:ia,isString:Dh,merge:hu,objectEach:Nl,pick:_a,removeEvent:th,syncTimeout:Rm}=Ps;class On{constructor(){this.zoneAxis="y"}init(l,p){var B,X,re;let y;xa(this,"init",{options:p}),this.dataTable??(this.dataTable=new Jo);let T=l.series;this.eventsToUnbind=[],this.chart=l,this.options=this.setOptions(p);let A=this.options,P=A.visible!==!1;this.linkedSeries=[],this.bindAxes(),Ml(this,{name:A.name,state:"",visible:P,selected:A.selected===!0}),Cg(this,A);let I=A.events;(I!=null&&I.click||(X=(B=A.point)==null?void 0:B.events)!=null&&X.click||A.allowPointSelect)&&(l.runTrackerClick=!0),this.getColor(),this.getSymbol(),this.isCartesian&&(l.hasCartesianSeries=!0),T.length&&(y=T[T.length-1]),this._i=_a(y==null?void 0:y._i,-1)+1,this.opacity=this.options.opacity,l.orderItems("series",tl(this,T)),(re=A.dataSorting)!=null&&re.enabled?this.setDataSortingOptions():this.points||this.data||this.setData(A.data,!1),xa(this,"afterInit")}is(l){return Oi[l]&&this instanceof Oi[l]}bindAxes(){let l,p=this,y=p.options,T=p.chart;xa(this,"bindAxes",null,function(){(p.axisTypes||[]).forEach(function(A){(T[A]||[]).forEach(function(P){l=P.options,(_a(y[A],0)===P.index||y[A]!==void 0&&y[A]===l.id)&&(tl(p,P.series),p[A]=P,P.isDirty=!0)}),p[A]||p.optionalAxis===A||ip(18,!0,T)})}),xa(this,"afterBindAxes")}hasData(){return this.visible&&this.dataMax!==void 0&&this.dataMin!==void 0||this.visible&&this.dataTable.rowCount>0}hasMarkerChanged(l,p){let y=l.marker,T=p.marker||{};return y&&(T.enabled&&!y.enabled||T.symbol!==y.symbol||T.height!==y.height||T.width!==y.width)}autoIncrement(l){let p,y=this.options,{pointIntervalUnit:T,relativeXValue:A}=this.options,P=this.chart.time,I=this.xIncrement??P.parse(y.pointStart)??0;if(this.pointInterval=p=_a(this.pointInterval,y.pointInterval,1),A&&ia(l)&&(p*=l),T){let B=P.toParts(I);T==="day"?B[2]+=p:T==="month"?B[1]+=p:T==="year"&&(B[0]+=p),p=P.makeTime.apply(P,B)-I}return A&&ia(l)?I+p:(this.xIncrement=I+p,I)}setDataSortingOptions(){let l=this.options;Ml(this,{requireSorting:!1,sorted:!1,enabledDataSorting:!0,allowDG:!1}),Ho(l.pointRange)||(l.pointRange=1)}setOptions(l){var Re,Be;let p,y=this.chart,T=y.options.plotOptions,A=y.userOptions||{},P=hu(l),I=y.styledMode,B={plotOptions:T,userOptions:P};xa(this,"setOptions",B);let X=B.plotOptions[this.type],re=A.plotOptions||{},te=re.series||{},pe=pn.plotOptions[this.type]||{},_e=re[this.type]||{};X.dataLabels=this.mergeArrays(pe.dataLabels,X.dataLabels),this.userOptions=B.userOptions;let Ee=hu(X,T.series,_e,P);this.tooltipOptions=hu(pn.tooltip,(Re=pn.plotOptions.series)==null?void 0:Re.tooltip,pe==null?void 0:pe.tooltip,y.userOptions.tooltip,(Be=re.series)==null?void 0:Be.tooltip,_e.tooltip,P.tooltip),this.stickyTracking=_a(P.stickyTracking,_e.stickyTracking,te.stickyTracking,!!this.tooltipOptions.shared&&!this.noSharedTooltip||Ee.stickyTracking),X.marker===null&&delete Ee.marker,this.zoneAxis=Ee.zoneAxis||"y";let De=this.zones=(Ee.zones||[]).map(Ze=>({...Ze}));return(Ee.negativeColor||Ee.negativeFillColor)&&!Ee.zones&&(p={value:Ee[this.zoneAxis+"Threshold"]||Ee.threshold||0,className:"highcharts-negative"},I||(p.color=Ee.negativeColor,p.fillColor=Ee.negativeFillColor),De.push(p)),De.length&&Ho(De[De.length-1].value)&&De.push(I?{}:{color:this.color,fillColor:this.fillColor}),xa(this,"afterSetOptions",{options:Ee}),Ee}getName(){return this.options.name??ms(this.chart.options.lang.seriesName,this,this.chart)}getCyclic(l,p,y){let T,A,P=this.chart,I=`${l}Index`,B=`${l}Counter`,X=(y==null?void 0:y.length)||P.options.chart.colorCount;!p&&(Ho(A=_a(l==="color"?this.options.colorIndex:void 0,this[I]))?T=A:(P.series.length||(P[B]=0),T=P[B]%X,P[B]+=1),y&&(p=y[T])),T!==void 0&&(this[I]=T),this[l]=p}getColor(){this.chart.styledMode?this.getCyclic("color"):this.options.colorByPoint?this.color="#cccccc":this.getCyclic("color",this.options.color||pn.plotOptions[this.type].color,this.chart.options.colors)}getPointsCollection(){return(this.hasGroupedData?this.points:this.data)||[]}getSymbol(){let l=this.options.marker;this.getCyclic("symbol",l.symbol,this.chart.options.symbols)}getColumn(l,p){return(p?this.dataTable.modified:this.dataTable).getColumn(l,!0)||[]}findPointIndex(l,p){var te;let y,T,A,{id:P,x:I}=l,B=this.points,X=this.options.dataSorting,re=this.cropStart||0;if(P){let pe=this.chart.get(P);pe instanceof je&&(y=pe)}else if(this.linkedParent||this.enabledDataSorting||this.options.relativeXValue){let pe=_e=>!_e.touched&&_e.index===l.index;if(X!=null&&X.matchByName?pe=_e=>!_e.touched&&_e.name===l.name:this.options.relativeXValue&&(pe=_e=>!_e.touched&&_e.options.x===l.x),!(y=ny(B,pe)))return}return y&&(A=y==null?void 0:y.index)!==void 0&&(T=!0),A===void 0&&ia(I)&&(A=this.getColumn("x").indexOf(I,p)),A!==-1&&A!==void 0&&this.cropped&&(A=A>=re?A-re:A),!T&&ia(A)&&((te=B[A])!=null&&te.touched)&&(A=void 0),A}updateData(l,p){var De;let{options:y,requireSorting:T}=this,A=y.dataSorting,P=this.points,I=[],B=l.length===P.length,X,re,te,pe,_e=!0;if(this.xIncrement=null,l.forEach((Re,Be)=>{var Xt;let Ze,rt=Ho(Re)&&this.pointClass.prototype.optionsToObject.call({series:this},Re)||{},{id:Yt,x:Ut}=rt;Yt||ia(Ut)?((Ze=this.findPointIndex(rt,pe))===-1||Ze===void 0?I.push(Re):P[Ze]&&Re!==((Xt=y.data)==null?void 0:Xt[Ze])?(P[Ze].update(Re,!1,void 0,!1),P[Ze].touched=!0,T&&(pe=Ze+1)):P[Ze]&&(P[Ze].touched=!0),(!B||Be!==Ze||A!=null&&A.enabled||this.hasDerivedData)&&(X=!0)):I.push(Re)},this),X)for(re=P.length;re--;)(te=P[re])&&!te.touched&&((De=te.remove)==null||De.call(te,!1,p));else B&&!(A!=null&&A.enabled)?(l.forEach((Re,Be)=>{Re===P[Be].y||P[Be].destroyed||P[Be].update(Re,!1,void 0,!1)}),I.length=0):_e=!1;if(P.forEach(Re=>{Re&&(Re.touched=!1)}),!_e)return!1;I.forEach(Re=>{this.addPoint(Re,!1,void 0,void 0,!1)},this);let Ee=this.getColumn("x");return this.xIncrement===null&&Ee.length&&(this.xIncrement=Tp(Ee),this.autoIncrement()),!0}dataColumnKeys(){return["x",...this.pointArrayMap||["y"]]}setData(l,p=!0,y,T){var Ci,di;let A=this.points,P=(A==null?void 0:A.length)||0,I=this.options,B=this.chart,X=I.dataSorting,re=this.xAxis,te=I.turboThreshold,pe=this.dataTable,_e=this.dataColumnKeys(),Ee=this.pointValKey||"y",De=(this.pointArrayMap||[]).length,Re=I.keys,Be,Ze,rt=0,Yt=1,Ut;B.options.chart.allowMutatingData||(I.data&&delete this.options.data,this.userOptions.data&&delete this.userOptions.data,Ut=hu(!0,l));let Xt=(l=Ut||l||[]).length;if(X!=null&&X.enabled&&(l=this.sortData(l)),B.options.chart.allowMutatingData&&T!==!1&&Xt&&P&&!this.cropped&&!this.hasGroupedData&&this.visible&&!this.boosted&&(Ze=this.updateData(l,y)),!Ze){this.xIncrement=null,this.colorCounter=0;let vi=te&&!I.relativeXValue&&Xt>te;if(vi){let es=this.getFirstValidPoint(l),ws=this.getFirstValidPoint(l,Xt-1,-1),As=$s=>!!(cg($s)&&(Re||ia($s[0])));if(ia(es)&&ia(ws)){let $s=[],kr=[];for(let pr of l)$s.push(this.autoIncrement()),kr.push(pr);pe.setColumns({x:$s,[Ee]:kr})}else if(As(es)&&As(ws))if(De){let $s=+(es.length===De),kr=Array(_e.length).fill(0).map(()=>[]);for(let pr of l){$s&&kr[0].push(this.autoIncrement());for(let Vr=$s;Vr<=De;Vr++)(Ci=kr[Vr])==null||Ci.push(pr[Vr-$s])}pe.setColumns(_e.reduce((pr,Vr,cr)=>(pr[Vr]=kr[cr],pr),{}))}else{Re&&(rt=Re.indexOf("x"),Yt=Re.indexOf("y"),rt=rt>=0?rt:0,Yt=Yt>=0?Yt:1),es.length===1&&(Yt=0);let $s=[],kr=[];if(rt===Yt)for(let pr of l)$s.push(this.autoIncrement()),kr.push(pr[Yt]);else for(let pr of l)$s.push(pr[rt]),kr.push(pr[Yt]);pe.setColumns({x:$s,[Ee]:kr})}else vi=!1}if(!vi){let es=_e.reduce((ws,As)=>(ws[As]=[],ws),{});for(Be=0;Be<Xt;Be++){let ws=this.pointClass.prototype.applyOptions.apply({series:this},[l[Be]]);for(let As of _e)es[As][Be]=ws[As]}pe.setColumns(es)}for(Dh(this.getColumn("y")[0])&&ip(14,!0,B),this.data=[],this.options.data=this.userOptions.data=l,Be=P;Be--;)(di=A[Be])==null||di.destroy();re&&(re.minRange=re.userMinRange),this.isDirty=B.isDirtyBox=!0,this.isDirtyData=!!A,y=!1}I.legendType==="point"&&(this.processData(),this.generatePoints()),p&&B.redraw(y)}sortData(l){let p=this,y=p.options.dataSorting.sortKey||"y",T=function(A,P){return Ho(P)&&A.pointClass.prototype.optionsToObject.call({series:A},P)||{}};return l.forEach(function(A,P){l[P]=T(p,A),l[P].index=P},this),l.concat().sort((A,P)=>{let I=el(y,A),B=el(y,P);return B<I?-1:+(B>I)}).forEach(function(A,P){A.x=P},this),p.linkedSeries&&p.linkedSeries.forEach(function(A){var B;let P=A.options,I=P.data;!((B=P.dataSorting)!=null&&B.enabled)&&I&&(I.forEach(function(X,re){I[re]=T(A,X),l[re]&&(I[re].x=l[re].x,I[re].index=re)}),A.setData(I,!1))}),l}getProcessedData(l){let p=this,{dataTable:y,isCartesian:T,options:A,xAxis:P}=p,I=A.cropThreshold,B=l||p.getExtremesFromAll,X=P==null?void 0:P.logarithmic,re=y.rowCount,te,pe,_e=0,Ee,De,Re,Be=p.getColumn("x"),Ze=y,rt=!1;return P&&(De=(Ee=P.getExtremes()).min,Re=Ee.max,rt=!!(P.categories&&!P.names.length),T&&p.sorted&&!B&&(!I||re>I||p.forceCrop)&&(Be[re-1]<De||Be[0]>Re?Ze=new Jo:p.getColumn(p.pointValKey||"y").length&&(Be[0]<De||Be[re-1]>Re)&&(Ze=(te=this.cropData(y,De,Re)).modified,_e=te.start,pe=!0))),Be=Ze.getColumn("x")||[],{modified:Ze,cropped:pe,cropStart:_e,closestPointRange:Fu([X?Be.map(X.log2lin):Be],()=>p.requireSorting&&!rt&&ip(15,!1,p.chart))}}processData(l){let p=this.xAxis,y=this.dataTable;if(this.isCartesian&&!this.isDirty&&!p.isDirty&&!this.yAxis.isDirty&&!l)return!1;let T=this.getProcessedData();y.modified=T.modified,this.cropped=T.cropped,this.cropStart=T.cropStart,this.closestPointRange=this.basePointRange=T.closestPointRange,xa(this,"afterProcessData")}cropData(l,p,y){let T=l.getColumn("x",!0)||[],A=T.length,P={},I,B,X=0,re=A;for(I=0;I<A;I++)if(T[I]>=p){X=Math.max(0,I-1);break}for(B=I;B<A;B++)if(T[B]>y){re=B+1;break}for(let te of this.dataColumnKeys()){let pe=l.getColumn(te,!0);pe&&(P[te]=pe.slice(X,re))}return{modified:new Jo({columns:P}),start:X,end:re}}generatePoints(){var Ut,Xt,Ci;let l=this.options,p=this.processedData||l.data,y=this.dataTable.modified,T=this.getColumn("x",!0),A=this.pointClass,P=y.rowCount,I=this.cropStart||0,B=this.hasGroupedData,X=l.keys,re=[],te=(Ut=l.dataGrouping)!=null&&Ut.groupAll?I:0,pe=(Xt=this.xAxis)==null?void 0:Xt.categories,_e=this.pointArrayMap||["y"],Ee=this.dataColumnKeys(),De,Re,Be,Ze,rt=this.data,Yt;if(!rt&&!B){let di=[];di.length=(p==null?void 0:p.length)||0,rt=this.data=di}for(X&&B&&(this.options.keys=!1),Ze=0;Ze<P;Ze++)Re=I+Ze,B?((Be=new A(this,y.getRow(Ze,Ee)||[])).dataGroup=this.groupMap[te+Ze],(Ci=Be.dataGroup)!=null&&Ci.options&&(Be.options=Be.dataGroup.options,Ml(Be,Be.dataGroup.options),delete Be.dataLabels)):(Be=rt[Re],Yt=p?p[Re]:y.getRow(Ze,_e),Be||Yt===void 0||(rt[Re]=Be=new A(this,Yt,T[Ze]))),Be&&(Be.index=B?te+Ze:Re,re[Ze]=Be,Be.category=(pe==null?void 0:pe[Be.x])??Be.x,Be.key=Be.name??Be.category);if(this.options.keys=X,rt&&(P!==(De=rt.length)||B))for(Ze=0;Ze<De;Ze++)Ze!==I||B||(Ze+=P),rt[Ze]&&(rt[Ze].destroyElements(),rt[Ze].plotX=void 0);this.data=rt,this.points=re,xa(this,"afterGeneratePoints")}getXExtremes(l){return{min:kn(l),max:Tp(l)}}getExtremes(l,p){var Ut;let{xAxis:y,yAxis:T}=this,A=p||this.getExtremesFromAll||this.options.getExtremesFromAll,P=A&&this.cropped?this.dataTable:this.dataTable.modified,I=P.rowCount,B=l||this.stackedYData,X=B?[B]:((Ut=this.keysAffectYAxis||this.pointArrayMap||["y"])==null?void 0:Ut.map(Xt=>P.getColumn(Xt,!0)||[]))||[],re=this.getColumn("x",!0),te=[],pe=this.requireSorting&&!this.is("column")?1:0,_e=!!T&&T.positiveValuesOnly,Ee=A||this.cropped||!y,De,Re,Be,Ze=0,rt=0;for(y&&(Ze=(De=y.getExtremes()).min,rt=De.max),Be=0;Be<I;Be++)if(Re=re[Be],Ee||(re[Be+pe]||Re)>=Ze&&(re[Be-pe]||Re)<=rt)for(let Xt of X){let Ci=Xt[Be];ia(Ci)&&(Ci>0||!_e)&&te.push(Ci)}let Yt={activeYData:te,dataMin:kn(te),dataMax:Tp(te)};return xa(this,"afterGetExtremes",{dataExtremes:Yt}),Yt}applyExtremes(){let l=this.getExtremes();return this.dataMin=l.dataMin,this.dataMax=l.dataMax,l}getFirstValidPoint(l,p=0,y=1){let T=l.length,A=p;for(;A>=0&&A<T;){if(Ho(l[A]))return l[A];A+=y}}translate(){var rt;this.generatePoints();let l=this.options,p=l.stacking,y=this.xAxis,T=this.enabledDataSorting,A=this.yAxis,P=this.points,I=P.length,B=this.pointPlacementToXValue(),X=!!B,re=l.threshold,te=l.startFromThreshold?re:0,pe=(l==null?void 0:l.nullInteraction)&&A.len,_e,Ee,De,Re,Be=Number.MAX_VALUE;function Ze(Yt){return Zt(Yt,-1e9,1e9)}for(_e=0;_e<I;_e++){let Yt,Ut=P[_e],Xt=Ut.x,Ci,di,vi=Ut.y,es=Ut.low,ws=p&&((rt=A.stacking)==null?void 0:rt.stacks[(this.negStacks&&vi<(te?0:re)?"-":"")+this.stackKey]);Ut.plotX=ia(Ee=y.translate(Xt,!1,!1,!1,!0,B))?vh(Ze(Ee)):void 0,p&&this.visible&&ws&&ws[Xt]&&(Re=this.getStackIndicator(Re,Xt,this.index),!Ut.isNull&&Re.key&&(di=(Ci=ws[Xt]).points[Re.key]),Ci&&cg(di)&&(es=di[0],vi=di[1],es===te&&Re.key===ws[Xt].base&&(es=_a(ia(re)?re:A.min)),A.positiveValuesOnly&&Ho(es)&&es<=0&&(es=void 0),Ut.total=Ut.stackTotal=_a(Ci.total),Ut.percentage=Ho(Ut.y)&&Ci.total?Ut.y/Ci.total*100:void 0,Ut.stackY=vi,this.irregularWidths||Ci.setOffset(this.pointXOffset||0,this.barW||0,void 0,void 0,void 0,this.xAxis))),Ut.yBottom=Ho(es)?Ze(A.translate(es,!1,!0,!1,!0)):void 0,this.dataModify&&(vi=this.dataModify.modifyValue(vi,_e)),ia(vi)&&Ut.plotX!==void 0?Yt=ia(Yt=A.translate(vi,!1,!0,!1,!0))?Ze(Yt):void 0:!ia(vi)&&pe&&(Yt=pe),Ut.plotY=Yt,Ut.isInside=this.isPointInside(Ut),Ut.clientX=X?vh(y.translate(Xt,!1,!1,!1,!0,B)):Ee,Ut.negative=(Ut.y||0)<(re||0),Ut.isNull||Ut.visible===!1||(De!==void 0&&(Be=Math.min(Be,Math.abs(Ee-De))),De=Ee),Ut.zone=this.zones.length?Ut.getZone():void 0,!Ut.graphic&&this.group&&T&&(Ut.isNew=!0)}this.closestPointRangePx=Be,xa(this,"afterTranslate")}getValidPoints(l,p,y){let T=this.chart;return(l||this.points||[]).filter(function(A){let{plotX:P,plotY:I}=A;return(!!y||!A.isNull&&!!ia(I))&&(!p||!!T.isInsidePlot(P,I,{inverted:T.inverted}))&&A.visible!==!1})}getSharedClipKey(){return this.sharedClipKey=(this.options.xAxis||0)+","+(this.options.yAxis||0),this.sharedClipKey}setClip(){let{chart:l,group:p,markerGroup:y}=this,T=l.sharedClips,A=l.renderer,P=l.getClipBox(this),I=this.getSharedClipKey(),B=T[I];B?B.animate(P):T[I]=B=A.clipRect(P),p&&p.clip(this.options.clip===!1?void 0:B),y&&y.clip()}animate(l){let{chart:p,group:y,markerGroup:T}=this,A=p.inverted,P=Hc(this.options.animation),I=[this.getSharedClipKey(),P.duration,P.easing,P.defer].join(","),B=p.sharedClips[I],X=p.sharedClips[I+"m"];if(l&&y){let re=p.getClipBox(this);if(B)B.attr("height",re.height);else{re.width=0,A&&(re.x=p.plotHeight),B=p.renderer.clipRect(re),p.sharedClips[I]=B;let te={x:-99,y:-99,width:A?p.plotWidth+199:99,height:A?99:p.plotHeight+199};X=p.renderer.clipRect(te),p.sharedClips[I+"m"]=X}y.clip(B),T==null||T.clip(X)}else if(B&&!B.hasClass("highcharts-animating")){let re=p.getClipBox(this),te=P.step;(T!=null&&T.element.childNodes.length||p.series.length>1)&&(P.step=function(pe,_e){te&&te.apply(_e,arguments),_e.prop==="width"&&(X!=null&&X.element)&&X.attr(A?"height":"width",pe+99)}),B.addClass("highcharts-animating").animate(re,P)}}afterAnimate(){this.setClip(),Nl(this.chart.sharedClips,(l,p,y)=>{l&&!this.chart.container.querySelector(`[clip-path="url(#${l.id})"]`)&&(l.destroy(),delete y[p])}),this.finishedAnimating=!0,xa(this,"afterAnimate")}drawPoints(l=this.points){let p,y,T,A,P,I,B,X=this.chart,re=X.styledMode,{colorAxis:te,options:pe}=this,_e=pe.marker,Ee=pe.nullInteraction,De=this[this.specialGroup||"markerGroup"],Re=this.xAxis,Be=_a(_e.enabled,!Re||!!Re.isRadial||null,this.closestPointRangePx>=_e.enabledThreshold*_e.radius);if(_e.enabled!==!1||this._hasPointMarkers)for(p=0;p<l.length;p++){A=(T=(y=l[p]).graphic)?"animate":"attr",P=y.marker||{},I=!!y.marker;let Ze=y.isNull;if((Be&&!Ho(P.enabled)||P.enabled)&&(!Ze||Ee)&&y.visible!==!1){let rt=_a(P.symbol,this.symbol,"rect");B=this.markerAttribs(y,y.selected&&"select"),this.enabledDataSorting&&(y.startXPos=Re.reversed?-(B.width||0):Re.width);let Yt=y.isInside!==!1;if(!T&&Yt&&((B.width||0)>0||y.hasImage)&&(y.graphic=T=X.renderer.symbol(rt,B.x,B.y,B.width,B.height,I?P:_e).add(De),this.enabledDataSorting&&X.hasRendered&&(T.attr({x:y.startXPos}),A="animate")),T&&A==="animate"&&T[Yt?"show":"hide"](Yt).animate(B),T){let Ut=this.pointAttribs(y,re||!y.selected?void 0:"select");re?te&&T.css({fill:Ut.fill}):T[A](Ut)}T&&T.addClass(y.getClassName(),!0)}else T&&(y.graphic=T.destroy())}}markerAttribs(l,p){let y=this.options,T=y.marker,A=l.marker||{},P=A.symbol||T.symbol,I={},B,X,re=_a(A.radius,T==null?void 0:T.radius);p&&(B=T.states[p],X=A.states&&A.states[p],re=_a(X==null?void 0:X.radius,B==null?void 0:B.radius,re&&re+((B==null?void 0:B.radiusPlus)||0))),l.hasImage=P&&P.indexOf("url")===0,l.hasImage&&(re=0);let te=l.pos();return ia(re)&&te&&(y.crisp&&(te[0]=zm(te[0],l.hasImage?0:P==="rect"?(T==null?void 0:T.lineWidth)||0:1)),I.x=te[0]-re,I.y=te[1]-re),re&&(I.width=I.height=2*re),I}pointAttribs(l,p){var Be;let y=this.options,T=y.marker,A=l==null?void 0:l.options,P=(A==null?void 0:A.marker)||{},I=A==null?void 0:A.color,B=l==null?void 0:l.color,X=(Be=l==null?void 0:l.zone)==null?void 0:Be.color,re,te,pe=this.color,_e,Ee,De=_a(P.lineWidth,T.lineWidth),Re=l!=null&&l.isNull&&y.nullInteraction?0:1;return pe=I||X||B||pe,_e=P.fillColor||T.fillColor||pe,Ee=P.lineColor||T.lineColor||pe,p=p||"normal",re=T.states[p]||{},De=_a((te=P.states&&P.states[p]||{}).lineWidth,re.lineWidth,De+_a(te.lineWidthPlus,re.lineWidthPlus,0)),_e=te.fillColor||re.fillColor||_e,Ee=te.lineColor||re.lineColor||Ee,{stroke:Ee,"stroke-width":De,fill:_e,opacity:Re=_a(te.opacity,re.opacity,Re)}}destroy(l){var B,X;let p,y,T=this,A=T.chart,P=/AppleWebKit\/533/.test(tp.navigator.userAgent),I=T.data||[];for(xa(T,"destroy",{keepEventsForUpdate:l}),this.removeEvents(l),(T.axisTypes||[]).forEach(function(re){y=T[re],y!=null&&y.series&&(Fl(y.series,T),y.isDirty=y.forceRedraw=!0)}),T.legendItem&&T.chart.legend.destroyItem(T),p=I.length;p--;)(X=(B=I[p])==null?void 0:B.destroy)==null||X.call(B);for(let re of T.zones)hg(re,void 0,!0);Ps.clearTimeout(T.animationTimeout),Nl(T,function(re,te){re instanceof js&&!re.survive&&re[P&&te==="group"?"hide":"destroy"]()}),A.hoverSeries===T&&(A.hoverSeries=void 0),Fl(A.series,T),A.orderItems("series"),Nl(T,function(re,te){l&&te==="hcEvents"||delete T[te]})}applyZones(){let{area:l,chart:p,graph:y,zones:T,points:A,xAxis:P,yAxis:I,zoneAxis:B}=this,{inverted:X,renderer:re}=p,te=this[`${B}Axis`],{isXAxis:pe,len:_e=0,minPointOffset:Ee=0}=te||{},De=((y==null?void 0:y.strokeWidth())||0)/2+1,Re=(Be,Ze=0,rt=0)=>{X&&(rt=_e-rt);let{translated:Yt=0,lineClip:Ut}=Be,Xt=rt-Yt;Ut==null||Ut.push(["L",Ze,Math.abs(Xt)<De?rt-De*(Xt<=0?-1:1):Yt])};if(T.length&&(y||l)&&te&&ia(te.min)){let Be=te.getExtremes().max+Ee,Ze=Ut=>{Ut.forEach((Xt,Ci)=>{(Xt[0]==="M"||Xt[0]==="L")&&(Ut[Ci]=[Xt[0],pe?_e-Xt[1]:Xt[1],pe?Xt[2]:_e-Xt[2]])})};if(T.forEach(Ut=>{Ut.lineClip=[],Ut.translated=Zt(te.toPixels(_a(Ut.value,Be),!0)||0,0,_e)}),y&&!this.showLine&&y.hide(),l&&l.hide(),B==="y"&&A.length<P.len)for(let Ut of A){let{plotX:Xt,plotY:Ci,zone:di}=Ut,vi=di&&T[T.indexOf(di)-1];di&&Re(di,Xt,Ci),vi&&Re(vi,Xt,Ci)}let rt=[],Yt=te.toPixels(te.getExtremes().min-Ee,!0);T.forEach(Ut=>{var Vr,cr;let Xt=Ut.lineClip||[],Ci=Math.round(Ut.translated||0);P.reversed&&Xt.reverse();let{clip:di,simpleClip:vi}=Ut,es=0,ws=0,As=P.len,$s=I.len;pe?(es=Ci,As=Yt):(ws=Ci,$s=Yt);let kr=[["M",es,ws],["L",As,ws],["L",As,$s],["L",es,$s],["Z"]],pr=[kr[0],...Xt,kr[1],kr[2],...rt,kr[3],kr[4]];rt=Xt.reverse(),Yt=Ci,X&&(Ze(pr),l&&Ze(kr)),di?(di.animate({d:pr}),vi==null||vi.animate({d:kr})):(di=Ut.clip=re.path(pr),l&&(vi=Ut.simpleClip=re.path(kr))),y&&((Vr=Ut.graph)==null||Vr.clip(di)),l&&((cr=Ut.area)==null||cr.clip(vi))})}else this.visible&&(y&&y.show(),l&&l.show())}plotGroup(l,p,y,T,A){let P=this[l],I=!P,B={visibility:y,zIndex:T||.1};return Ho(this.opacity)&&!this.chart.styledMode&&this.state!=="inactive"&&(B.opacity=this.opacity),P||(this[l]=P=this.chart.renderer.g().add(A)),P.addClass("highcharts-"+p+" highcharts-series-"+this.index+" highcharts-"+this.type+"-series "+(Ho(this.colorIndex)?"highcharts-color-"+this.colorIndex+" ":"")+(this.options.className||"")+(P.hasClass("highcharts-tracker")?" highcharts-tracker":""),!0),P.attr(B)[I?"attr":"animate"](this.getPlotBox(p)),P}getPlotBox(l){let p=this.xAxis,y=this.yAxis,T=this.chart,A=T.inverted&&!T.polar&&p&&this.invertible&&l==="series";T.inverted&&(p=y,y=this.xAxis);let P={scale:1,translateX:p?p.left:T.plotLeft,translateY:y?y.top:T.plotTop,name:l};xa(this,"getPlotBox",P);let{scale:I,translateX:B,translateY:X}=P;return{translateX:B,translateY:X,rotation:90*!!A,rotationOriginX:A?I*(p.len-y.len)/2:0,rotationOriginY:A?I*(p.len+y.len)/2:0,scaleX:A?-I:I,scaleY:I}}removeEvents(l){let{eventsToUnbind:p}=this;l||th(this),p.length&&(p.forEach(y=>{y()}),p.length=0)}render(){var re,te,pe,_e,Ee;let l=this,{chart:p,options:y,hasRendered:T}=l,A=Hc(y.animation),P=l.visible?"inherit":"hidden",I=y.zIndex,B=p.seriesGroup,X=l.finishedAnimating?0:A.duration;xa(this,"render"),l.plotGroup("group","series",P,I,B),l.markerGroup=l.plotGroup("markerGroup","markers",P,I,B),y.clip!==!1&&l.setClip(),X&&((re=l.animate)==null||re.call(l,!0)),l.drawGraph&&(l.drawGraph(),l.applyZones()),l.visible&&l.drawPoints(),(te=l.drawDataLabels)==null||te.call(l),(pe=l.redrawPoints)==null||pe.call(l),y.enableMouseTracking&&((_e=l.drawTracker)==null||_e.call(l)),X&&((Ee=l.animate)==null||Ee.call(l)),T||(X&&A.defer&&(X+=A.defer),l.animationTimeout=Rm(()=>{l.afterAnimate()},X||0)),l.isDirty=!1,l.hasRendered=!0,xa(l,"afterRender")}redraw(){let l=this.isDirty||this.isDirtyData;this.translate(),this.render(),l&&delete this.kdTree}reserveSpace(){return this.visible||!this.chart.options.chart.ignoreHiddenSeries}searchPoint(l,p){let{xAxis:y,yAxis:T}=this,A=this.chart.inverted;return this.searchKDTree({clientX:A?y.len-l.chartY+y.pos:l.chartX-y.pos,plotY:A?T.len-l.chartX+T.pos:l.chartY-T.pos},p,l)}buildKDTree(l){this.buildingKdTree=!0;let p=this,y=p.options,T=y.findNearestPointBy.indexOf("y")>-1?2:1;delete p.kdTree,Rm(function(){p.kdTree=function A(P,I,B){let X,re,te=P==null?void 0:P.length;if(te)return X=p.kdAxisArray[I%B],P.sort((pe,_e)=>(pe[X]||0)-(_e[X]||0)),{point:P[re=Math.floor(te/2)],left:A(P.slice(0,re),I+1,B),right:A(P.slice(re+1),I+1,B)}}(p.getValidPoints(void 0,!p.directTouch,y==null?void 0:y.nullInteraction),T,T),p.buildingKdTree=!1},y.kdNow||(l==null?void 0:l.type)==="touchstart"?0:1)}searchKDTree(l,p,y,T,A){let P=this,[I,B]=this.kdAxisArray,X=p?"distX":"dist",re=(P.options.findNearestPointBy||"").indexOf("y")>-1?2:1,te=!!P.isBubble,pe=T||((Ee,De,Re)=>{let Be=Ee[Re]||0,Ze=De[Re]||0;return[Be===Ze&&Ee.index>De.index||Be<Ze?Ee:De,!1]}),_e=A||((Ee,De)=>Ee<De);if(this.kdTree||this.buildingKdTree||this.buildKDTree(y),this.kdTree)return function Ee(De,Re,Be,Ze){var es;let rt=Re.point,Yt=P.kdAxisArray[Be%Ze],Ut=rt,Xt=!1;(function(ws,As){var Qo;let $s=ws[I],kr=As[I],pr=Ho($s)&&Ho(kr)?$s-kr:null,Vr=ws[B],cr=As[B],Zr=Ho(Vr)&&Ho(cr)?Vr-cr:0,Cn=te&&((Qo=As.marker)==null?void 0:Qo.radius)||0;As.dist=Math.sqrt((pr&&pr*pr||0)+Zr*Zr)-Cn,As.distX=Ho(pr)?Math.abs(pr)-Cn:Number.MAX_VALUE})(De,rt);let Ci=(De[Yt]||0)-(rt[Yt]||0)+(te&&((es=rt.marker)==null?void 0:es.radius)||0),di=Ci<0?"left":"right",vi=Ci<0?"right":"left";return Re[di]&&([Ut,Xt]=pe(rt,Ee(De,Re[di],Be+1,Ze),X)),Re[vi]&&_e(Math.sqrt(Ci*Ci),Ut[X],Xt)&&(Ut=pe(Ut,Ee(De,Re[vi],Be+1,Ze),X)[0]),Ut}(l,this.kdTree,re,re)}pointPlacementToXValue(){let{options:l,xAxis:p}=this,y=l.pointPlacement;return y==="between"&&(y=p.reversed?-.5:.5),ia(y)?y*(l.pointRange||p.pointRange):0}isPointInside(l){let{chart:p,xAxis:y,yAxis:T}=this,{plotX:A=-1,plotY:P=-1}=l;return P>=0&&P<=(T?T.len:p.plotHeight)&&A>=0&&A<=(y?y.len:p.plotWidth)}drawTracker(){var pe;let l=this,p=l.options,y=p.trackByArea,T=[].concat((y?l.areaPath:l.graphPath)||[]),A=l.chart,P=A.pointer,I=A.renderer,B=((pe=A.options.tooltip)==null?void 0:pe.snap)||0,X=()=>{p.enableMouseTracking&&A.hoverSeries!==l&&l.onMouseOver()},re="rgba(192,192,192,"+(wf?1e-4:.002)+")",te=l.tracker;te?te.attr({d:T}):l.graph&&(l.tracker=te=I.path(T).attr({visibility:l.visible?"inherit":"hidden",zIndex:2}).addClass(y?"highcharts-tracker-area":"highcharts-tracker-line").add(l.group),A.styledMode||te.attr({"stroke-linecap":"round","stroke-linejoin":"round",stroke:re,fill:y?re:"none","stroke-width":l.graph.strokeWidth()+(y?0:2*B)}),[l.tracker,l.markerGroup,l.dataLabelsGroup].forEach(_e=>{_e&&(_e.addClass("highcharts-tracker").on("mouseover",X).on("mouseout",Ee=>{P==null||P.onTrackerMouseOut(Ee)}),p.cursor&&!A.styledMode&&_e.css({cursor:p.cursor}),_e.on("touchstart",X))})),xa(this,"afterDrawTracker")}addPoint(l,p,y,T,A){let P,I,B=this.options,{chart:X,data:re,dataTable:te,xAxis:pe}=this,_e=(pe==null?void 0:pe.hasNames)&&pe.names,Ee=B.data,De=this.getColumn("x");p=_a(p,!0);let Re={series:this};this.pointClass.prototype.applyOptions.apply(Re,[l]);let Be=Re.x;if(I=De.length,this.requireSorting&&Be<De[I-1])for(P=!0;I&&De[I-1]>Be;)I--;te.setRow(Re,I,!0,{addColumns:!1}),_e&&Re.name&&(_e[Be]=Re.name),Ee==null||Ee.splice(I,0,l),(P||this.processedData)&&(this.data.splice(I,0,null),this.processData()),B.legendType==="point"&&this.generatePoints(),y&&(re[0]&&re[0].remove?re[0].remove(!1):([re,Ee].filter(Ho).forEach(Ze=>{Ze.shift()}),te.deleteRows(0))),A!==!1&&xa(this,"addPoint",{point:Re}),this.isDirty=!0,this.isDirtyData=!0,p&&X.redraw(T)}removePoint(l,p,y){let T=this,{chart:A,data:P,points:I,dataTable:B}=T,X=P[l],re=function(){[(I==null?void 0:I.length)===P.length?I:void 0,P,T.options.data].filter(Ho).forEach(te=>{te.splice(l,1)}),B.deleteRows(l),X==null||X.destroy(),T.isDirty=!0,T.isDirtyData=!0,p&&A.redraw()};am(y,A),p=_a(p,!0),X?X.firePointEvent("remove",null,re):re()}remove(l,p,y,T){let A=this,P=A.chart;function I(){A.destroy(T),P.isDirtyLegend=P.isDirtyBox=!0,P.linkSeries(T),_a(l,!0)&&P.redraw(p)}y!==!1?xa(A,"remove",null,I):I()}update(l,p){var Be,Ze;xa(this,"update",{options:l=Pg(l,this.userOptions)});let y=this,T=y.chart,A=y.userOptions,P=y.initialType||y.type,I=T.options.plotOptions,B=Oi[P].prototype,X=y.finishedAnimating&&{animation:!1},re={},te,pe,_e=On.keepProps.slice(),Ee=l.type||A.type||T.options.chart.type,De=!(this.hasDerivedData||Ee&&Ee!==this.type||l.keys!==void 0||l.pointStart!==void 0||l.pointInterval!==void 0||l.relativeXValue!==void 0||l.joinBy||l.mapData||["dataGrouping","pointStart","pointInterval","pointIntervalUnit","keys"].some(rt=>y.hasOptionChanged(rt)));Ee=Ee||P,De?(_e.push.apply(_e,On.keepPropsForPoints),l.visible!==!1&&_e.push("area","graph"),y.parallelArrays.forEach(function(rt){_e.push(rt+"Data")}),l.data&&(l.dataSorting&&Ml(y.options.dataSorting,l.dataSorting),this.setData(l.data,!1))):this.dataTable.modified=this.dataTable,l=hu(A,{index:A.index===void 0?y.index:A.index,pointStart:((Be=I==null?void 0:I.series)==null?void 0:Be.pointStart)??A.pointStart??y.getColumn("x")[0]},!De&&{data:y.options.data},l,X),De&&l.data&&(l.data=y.options.data),(_e=["group","markerGroup","dataLabelsGroup","transformGroup"].concat(_e)).forEach(function(rt){_e[rt]=y[rt],delete y[rt]});let Re=!1;if(Oi[Ee]){if(Re=Ee!==y.type,y.remove(!1,!1,!1,!0),Re)if(T.propFromSeries(),Object.setPrototypeOf)Object.setPrototypeOf(y,Oi[Ee].prototype);else{let rt=Object.hasOwnProperty.call(y,"hcEvents")&&y.hcEvents;for(pe in B)y[pe]=void 0;Ml(y,Oi[Ee].prototype),rt?y.hcEvents=rt:delete y.hcEvents}}else ip(17,!0,T,{missingModuleFor:Ee});if(_e.forEach(function(rt){y[rt]=_e[rt]}),y.init(T,l),De&&this.points)for(let rt of((te=y.options).visible===!1?(re.graphic=1,re.dataLabel=1):(this.hasMarkerChanged(te,A)&&(re.graphic=1),(Ze=y.hasDataLabels)!=null&&Ze.call(y)||(re.dataLabel=1)),this.points))rt!=null&&rt.series&&(rt.resolveColor(),Object.keys(re).length&&rt.destroyElements(re),te.showInLegend===!1&&rt.legendItem&&T.legend.destroyItem(rt));y.initialType=P,T.linkSeries(),T.setSortedData(),Re&&y.linkedSeries.length&&(y.isDirtyData=!0),xa(this,"afterUpdate"),_a(p,!0)&&T.redraw(!!De&&void 0)}setName(l){this.name=this.options.name=this.userOptions.name=l,this.chart.isDirtyLegend=!0}hasOptionChanged(l){var I,B;let p=this.chart,y=this.options[l],T=p.options.plotOptions,A=this.userOptions[l],P=_a((I=T==null?void 0:T[this.type])==null?void 0:I[l],(B=T==null?void 0:T.series)==null?void 0:B[l]);return A&&!Ho(P)?y!==A:y!==_a(P,y)}onMouseOver(){let l=this.chart,p=l.hoverSeries,y=l.pointer;y==null||y.setHoverChartIndex(),p&&p!==this&&p.onMouseOut(),this.options.events.mouseOver&&xa(this,"mouseOver"),this.setState("hover"),l.hoverSeries=this}onMouseOut(){let l=this.options,p=this.chart,y=p.tooltip,T=p.hoverPoint;p.hoverSeries=null,T&&T.onMouseOut(),this&&l.events.mouseOut&&xa(this,"mouseOut"),y&&!this.stickyTracking&&(!y.shared||this.noSharedTooltip)&&y.hide(),p.series.forEach(function(A){A.setState("",!0)})}setState(l,p){let y=this,T=y.options,A=y.graph,P=T.inactiveOtherPoints,I=T.states,B=_a(I[l||"normal"]&&I[l||"normal"].animation,y.chart.options.chart.animation),X=T.lineWidth,re=T.opacity;if(l=l||"",y.state!==l&&([y.group,y.markerGroup,y.dataLabelsGroup].forEach(function(te){te&&(y.state&&te.removeClass("highcharts-series-"+y.state),l&&te.addClass("highcharts-series-"+l))}),y.state=l,!y.chart.styledMode)){if(I[l]&&I[l].enabled===!1)return;if(l&&(X=I[l].lineWidth||X+(I[l].lineWidthPlus||0),re=_a(I[l].opacity,re)),A&&!A.dashstyle&&ia(X))for(let te of[A,...this.zones.map(pe=>pe.graph)])te==null||te.animate({"stroke-width":X},B);P||[y.group,y.markerGroup,y.dataLabelsGroup,y.labelBySeries].forEach(function(te){te&&te.animate({opacity:re},B)})}p&&P&&y.points&&y.setAllPointsToState(l||void 0)}setAllPointsToState(l){this.points.forEach(function(p){p.setState&&p.setState(l)})}setVisible(l,p){var B;let y=this,T=y.chart,A=T.options.chart.ignoreHiddenSeries,P=y.visible;y.visible=l=y.options.visible=y.userOptions.visible=l===void 0?!P:l;let I=l?"show":"hide";["group","dataLabelsGroup","markerGroup","tracker","tt"].forEach(X=>{var re;(re=y[X])==null||re[I]()}),(T.hoverSeries===y||((B=T.hoverPoint)==null?void 0:B.series)===y)&&y.onMouseOut(),y.legendItem&&T.legend.colorizeItem(y,l),y.isDirty=!0,y.options.stacking&&T.series.forEach(X=>{X.options.stacking&&X.visible&&(X.isDirty=!0)}),y.linkedSeries.forEach(X=>{X.setVisible(l,!1)}),A&&(T.isDirtyBox=!0),xa(y,I),p!==!1&&T.redraw()}show(){this.setVisible(!0)}hide(){this.setVisible(!1)}select(l){this.selected=l=this.options.selected=l===void 0?!this.selected:l,this.checkbox&&(this.checkbox.checked=l),xa(this,l?"select":"unselect")}shouldShowTooltip(l,p,y={}){return y.series=this,y.visiblePlotOnly=!0,this.chart.isInsidePlot(l,p,y)}drawLegendSymbol(l,p){var y;(y=ta[this.options.legendSymbol||"rectangle"])==null||y.call(this,l,p)}}On.defaultOptions={lineWidth:2,allowPointSelect:!1,crisp:!0,showCheckbox:!1,animation:{duration:1e3},enableMouseTracking:!0,events:{},marker:{enabledThreshold:2,lineColor:"#ffffff",lineWidth:0,radius:4,states:{normal:{animation:!0},hover:{animation:{duration:150},enabled:!0,radiusPlus:2,lineWidthPlus:1},select:{fillColor:"#cccccc",lineColor:"#000000",lineWidth:2}}},point:{events:{}},dataLabels:{animation:{},align:"center",borderWidth:0,defer:!0,formatter:function(){let{numberFormatter:q}=this.series.chart;return typeof this.y!="number"?"":q(this.y,-1)},padding:5,style:{fontSize:"0.7em",fontWeight:"bold",color:"contrast",textOutline:"1px contrast"},verticalAlign:"bottom",x:0,y:0},cropThreshold:300,opacity:1,pointRange:0,softThreshold:!0,states:{normal:{animation:!0},hover:{animation:{duration:150},lineWidthPlus:1,marker:{},halo:{size:10,opacity:.25}},select:{animation:{duration:0}},inactive:{animation:{duration:150},opacity:.2}},stickyTracking:!0,turboThreshold:1e3,findNearestPointBy:"x"},On.types=oo.seriesTypes,On.registerType=oo.registerSeriesType,On.keepProps=["colorIndex","eventOptions","navigatorSeries","symbolIndex","baseSeries"],On.keepPropsForPoints=["data","isDirtyData","isDirtyCanvas","points","dataTable","processedData","xIncrement","cropped","_hasPointMarkers","hasDataLabels","nodes","layout","level","mapMap","mapData","minY","maxY","minX","maxX","transformGroups"],Ml(On.prototype,{axisTypes:["xAxis","yAxis"],coll:"series",colorCounter:0,directTouch:!1,invertible:!0,isCartesian:!0,kdAxisArray:["clientX","plotY"],parallelArrays:["x","y"],pointClass:je,requireSorting:!0,sorted:!0}),oo.series=On;let Vo=On,{animObject:bo,setAnimation:Dd}=to,{registerEventOptions:Vl}=ch,{composed:Tf,marginNames:Sf}=pi,{distribute:Sp}=kh,{format:Nu}=fa,{addEvent:Mp,createElement:cu,css:dd,defined:Xc,discardElement:Kp,find:Bm,fireEvent:ud,isNumber:Ap,merge:zd,pick:wn,pushUnique:Mf,relativeLength:wc,stableSort:Tc,syncTimeout:dg}=Ps;class lm{constructor(l,p){this.allItems=[],this.initialItemY=0,this.itemHeight=0,this.itemMarginBottom=0,this.itemMarginTop=0,this.itemX=0,this.itemY=0,this.lastItemY=0,this.lastLineHeight=0,this.legendHeight=0,this.legendWidth=0,this.maxItemWidth=0,this.maxLegendWidth=0,this.offsetWidth=0,this.padding=0,this.pages=[],this.symbolHeight=0,this.symbolWidth=0,this.titleHeight=0,this.totalItemWidth=0,this.widthOption=0,this.chart=l,this.setOptions(p),p.enabled&&(this.render(),Vl(this,p),Mp(this.chart,"endResize",function(){this.legend.positionCheckboxes()})),Mp(this.chart,"render",()=>{this.options.enabled&&this.proximate&&(this.proximatePositions(),this.positionItems())})}setOptions(l){let p=wn(l.padding,8);this.options=l,this.chart.styledMode||(this.itemStyle=l.itemStyle,this.itemHiddenStyle=zd(this.itemStyle,l.itemHiddenStyle)),this.itemMarginTop=l.itemMarginTop,this.itemMarginBottom=l.itemMarginBottom,this.padding=p,this.initialItemY=p-5,this.symbolWidth=wn(l.symbolWidth,16),this.pages=[],this.proximate=l.layout==="proximate"&&!this.chart.inverted,this.baseline=void 0}update(l,p){let y=this.chart;this.setOptions(zd(!0,this.options,l)),"events"in this.options&&Vl(this,this.options),this.destroy(),y.isDirtyLegend=y.isDirtyBox=!0,wn(p,!0)&&y.redraw(),ud(this,"afterUpdate",{redraw:p})}colorizeItem(l,p){var X;let y=l.color,{area:T,group:A,label:P,line:I,symbol:B}=l.legendItem||{};if((l instanceof Vo||l instanceof je)&&(l.color=((X=l.options)==null?void 0:X.legendSymbolColor)||y),A==null||A[p?"removeClass":"addClass"]("highcharts-legend-item-hidden"),!this.chart.styledMode){let{itemHiddenStyle:re={}}=this,te=re.color,{fillColor:pe,fillOpacity:_e,lineColor:Ee,marker:De}=l.options,Re=Be=>(!p&&(Be.fill&&(Be.fill=te),Be.stroke&&(Be.stroke=te)),Be);P==null||P.css(zd(p?this.itemStyle:re)),I==null||I.attr(Re({stroke:Ee||l.color})),B&&B.attr(Re(De&&B.isMarker?l.pointAttribs():{fill:l.color})),T==null||T.attr(Re({fill:pe||l.color,"fill-opacity":pe?1:_e??.75}))}l.color=y,ud(this,"afterColorizeItem",{item:l,visible:p})}positionItems(){this.allItems.forEach(this.positionItem,this),this.chart.isResizing||this.positionCheckboxes()}positionItem(l){let{group:p,x:y=0,y:T=0}=l.legendItem||{},A=this.options,P=A.symbolPadding,I=!A.rtl,B=l.checkbox;if(p!=null&&p.element){let X={translateX:I?y:this.legendWidth-y-2*P-4,translateY:T};p[Xc(p.translateY)?"animate":"attr"](X,void 0,()=>{ud(this,"afterPositionItem",{item:l})})}B&&(B.x=y,B.y=T)}destroyItem(l){let p=l.checkbox,y=l.legendItem||{};for(let T of["group","label","line","symbol"])y[T]&&(y[T]=y[T].destroy());p&&Kp(p),l.legendItem=void 0}destroy(){for(let l of this.getAllItems())this.destroyItem(l);for(let l of["clipRect","up","down","pager","nav","box","title","group"])this[l]&&(this[l]=this[l].destroy());this.display=null}positionCheckboxes(){var A;let l,p=(A=this.group)==null?void 0:A.alignAttr,y=this.clipHeight||this.legendHeight,T=this.titleHeight;p&&(l=p.translateY,this.allItems.forEach(function(P){let I,B=P.checkbox;B&&(I=l+T+B.y+(this.scrollOffset||0)+3,dd(B,{left:p.translateX+P.checkboxOffset+B.x-20+"px",top:I+"px",display:this.proximate||I>l-6&&I<l+y-6?"":"none"}))},this))}renderTitle(){let l=this.options,p=this.padding,y=l.title,T,A=0;y.text&&(this.title||(this.title=this.chart.renderer.label(y.text,p-3,p-4,void 0,void 0,void 0,l.useHTML,void 0,"legend-title").attr({zIndex:1}),this.chart.styledMode||this.title.css(y.style),this.title.add(this.group)),y.width||this.title.css({width:this.maxLegendWidth+"px"}),A=(T=this.title.getBBox()).height,this.offsetWidth=T.width,this.contentGroup.attr({translateY:A})),this.titleHeight=A}setText(l){let p=this.options;l.legendItem.label.attr({text:p.labelFormat?Nu(p.labelFormat,l,this.chart):p.labelFormatter.call(l)})}renderItem(l){var Ci;let p=l.legendItem=l.legendItem||{},y=this.chart,T=y.renderer,A=this.options,P=A.layout==="horizontal",I=this.symbolWidth,B=A.symbolPadding||0,X=this.itemStyle,re=this.itemHiddenStyle,te=P?wn(A.itemDistance,20):0,pe=!A.rtl,_e=!l.series,Ee=!_e&&l.series.drawLegendSymbol?l.series:l,De=Ee.options,Re=!!this.createCheckboxForItem&&De&&De.showCheckbox,Be=A.useHTML,Ze=l.options.className,rt=p.label,Yt=I+B+te+20*!!Re;!rt&&(p.group=T.g("legend-item").addClass("highcharts-"+Ee.type+"-series highcharts-color-"+l.colorIndex+(Ze?" "+Ze:"")+(_e?" highcharts-series-"+l.index:"")).attr({zIndex:1}).add(this.scrollGroup),p.label=rt=T.text("",pe?I+B:-B,this.baseline||0,Be),y.styledMode||rt.css(zd(l.visible?X:re)),rt.attr({align:pe?"left":"right",zIndex:2}).add(p.group),!this.baseline&&(this.fontMetrics=T.fontMetrics(rt),this.baseline=this.fontMetrics.f+3+this.itemMarginTop,rt.attr("y",this.baseline),this.symbolHeight=wn(A.symbolHeight,this.fontMetrics.f),A.squareSymbol&&(this.symbolWidth=wn(A.symbolWidth,Math.max(this.symbolHeight,16)),Yt=this.symbolWidth+B+te+20*!!Re,pe&&rt.attr("x",this.symbolWidth+B))),Ee.drawLegendSymbol(this,l),this.setItemEvents&&this.setItemEvents(l,rt,Be)),Re&&!l.checkbox&&this.createCheckboxForItem&&this.createCheckboxForItem(l),this.colorizeItem(l,l.visible),(y.styledMode||!X.width)&&rt.css({width:(A.itemWidth||this.widthOption||y.spacingBox.width)-Yt+"px"}),this.setText(l);let Ut=rt.getBBox(),Xt=((Ci=this.fontMetrics)==null?void 0:Ci.h)||0;l.itemWidth=l.checkboxOffset=A.itemWidth||p.labelWidth||Ut.width+Yt,this.maxItemWidth=Math.max(this.maxItemWidth,l.itemWidth),this.totalItemWidth+=l.itemWidth,this.itemHeight=l.itemHeight=Math.round(p.labelHeight||(Ut.height>1.5*Xt?Ut.height:Xt))}layoutItem(l){let p=this.options,y=this.padding,T=p.layout==="horizontal",A=l.itemHeight,P=this.itemMarginBottom,I=this.itemMarginTop,B=T?wn(p.itemDistance,20):0,X=this.maxLegendWidth,re=p.alignColumns&&this.totalItemWidth>X?this.maxItemWidth:l.itemWidth,te=l.legendItem||{};T&&this.itemX-y+re>X&&(this.itemX=y,this.lastLineHeight&&(this.itemY+=I+this.lastLineHeight+P),this.lastLineHeight=0),this.lastItemY=I+this.itemY+P,this.lastLineHeight=Math.max(A,this.lastLineHeight),te.x=this.itemX,te.y=this.itemY,T?this.itemX+=re:(this.itemY+=I+A+P,this.lastLineHeight=A),this.offsetWidth=this.widthOption||Math.max((T?this.itemX-y-(l.checkbox?0:B):re)+y,this.offsetWidth)}getAllItems(){let l=[];return this.chart.series.forEach(function(p){var T;let y=p==null?void 0:p.options;p&&wn(y.showInLegend,!Xc(y.linkedTo)&&void 0,!0)&&(l=l.concat(((T=p.legendItem)==null?void 0:T.labels)||(y.legendType==="point"?p.data:p)))}),ud(this,"afterGetAllItems",{allItems:l}),l}getAlignment(){let l=this.options;return this.proximate?l.align.charAt(0)+"tv":l.floating?"":l.align.charAt(0)+l.verticalAlign.charAt(0)+l.layout.charAt(0)}adjustMargins(l,p){let y=this.chart,T=this.options,A=this.getAlignment();A&&[/(lth|ct|rth)/,/(rtv|rm|rbv)/,/(rbh|cb|lbh)/,/(lbv|lm|ltv)/].forEach(function(P,I){P.test(A)&&!Xc(l[I])&&(y[Sf[I]]=Math.max(y[Sf[I]],y.legend[(I+1)%2?"legendHeight":"legendWidth"]+[1,-1,-1,1][I]*T[I%2?"x":"y"]+wn(T.margin,12)+p[I]+(y.titleOffset[I]||0)))})}proximatePositions(){let l,p=this.chart,y=[],T=this.options.align==="left";for(let A of(this.allItems.forEach(function(P){let I,B,X=T,re,te;P.yAxis&&(P.xAxis.options.reversed&&(X=!X),P.points&&(I=Bm(X?P.points:P.points.slice(0).reverse(),function(pe){return Ap(pe.plotY)})),B=this.itemMarginTop+P.legendItem.label.getBBox().height+this.itemMarginBottom,te=P.yAxis.top-p.plotTop,re=P.visible?(I?I.plotY:P.yAxis.height)+(te-.3*B):te+P.yAxis.height,y.push({target:re,size:B,item:P}))},this),Sp(y,p.plotHeight)))l=A.item.legendItem||{},Ap(A.pos)&&(l.y=p.plotTop-p.spacing[0]+A.pos)}render(){let l=this.chart,p=l.renderer,y=this.options,T=this.padding,A=this.getAllItems(),P,I,B,X=this.group,re,te=this.box;this.itemX=T,this.itemY=this.initialItemY,this.offsetWidth=0,this.lastItemY=0,this.widthOption=wc(y.width,l.spacingBox.width-T),re=l.spacingBox.width-2*T-y.x,["rm","lm"].indexOf(this.getAlignment().substring(0,2))>-1&&(re/=2),this.maxLegendWidth=this.widthOption||re,X||(this.group=X=p.g("legend").addClass(y.className||"").attr({zIndex:7}).add(),this.contentGroup=p.g().attr({zIndex:1}).add(X),this.scrollGroup=p.g().add(this.contentGroup)),this.renderTitle(),Tc(A,(pe,_e)=>{var Ee,De;return(((Ee=pe.options)==null?void 0:Ee.legendIndex)||0)-(((De=_e.options)==null?void 0:De.legendIndex)||0)}),y.reversed&&A.reverse(),this.allItems=A,this.display=P=!!A.length,this.lastLineHeight=0,this.maxItemWidth=0,this.totalItemWidth=0,this.itemHeight=0,A.forEach(this.renderItem,this),A.forEach(this.layoutItem,this),I=(this.widthOption||this.offsetWidth)+T,B=this.lastItemY+this.lastLineHeight+this.titleHeight,B=this.handleOverflow(B)+T,te||(this.box=te=p.rect().addClass("highcharts-legend-box").attr({r:y.borderRadius}).add(X)),l.styledMode||te.attr({stroke:y.borderColor,"stroke-width":y.borderWidth||0,fill:y.backgroundColor||"none"}).shadow(y.shadow),I>0&&B>0&&te[te.placed?"animate":"attr"](te.crisp.call({},{x:0,y:0,width:I,height:B},te.strokeWidth())),X[P?"show":"hide"](),l.styledMode&&X.getStyle("display")==="none"&&(I=B=0),this.legendWidth=I,this.legendHeight=B,P&&this.align(),this.proximate||this.positionItems(),ud(this,"afterRender")}align(l=this.chart.spacingBox){let p=this.chart,y=this.options,T=l.y;/(lth|ct|rth)/.test(this.getAlignment())&&p.titleOffset[0]>0?T+=p.titleOffset[0]:/(lbh|cb|rbh)/.test(this.getAlignment())&&p.titleOffset[2]>0&&(T-=p.titleOffset[2]),T!==l.y&&(l=zd(l,{y:T})),p.hasRendered||(this.group.placed=!1),this.group.align(zd(y,{width:this.legendWidth,height:this.legendHeight,verticalAlign:this.proximate?"top":y.verticalAlign}),!0,l)}handleOverflow(l){let p=this,y=this.chart,T=y.renderer,A=this.options,P=A.y,I=A.verticalAlign==="top",B=this.padding,X=A.maxHeight,re=A.navigation,te=wn(re.animation,!0),pe=re.arrowSize||12,_e=this.pages,Ee=this.allItems,De=function(di){typeof di=="number"?Ci.attr({height:di}):Ci&&(p.clipRect=Ci.destroy(),p.contentGroup.clip()),p.contentGroup.div&&(p.contentGroup.div.style.clip=di?"rect("+B+"px,9999px,"+(B+di)+"px,0)":"auto")},Re=function(di){return p[di]=T.circle(0,0,1.3*pe).translate(pe/2,pe/2).add(Xt),y.styledMode||p[di].attr("fill","rgba(0,0,0,0.0001)"),p[di]},Be,Ze,rt,Yt,Ut=y.spacingBox.height+(I?-P:P)-B,Xt=this.nav,Ci=this.clipRect;return A.layout!=="horizontal"||A.verticalAlign==="middle"||A.floating||(Ut/=2),X&&(Ut=Math.min(Ut,X)),_e.length=0,l&&Ut>0&&l>Ut&&re.enabled!==!1?(this.clipHeight=Be=Math.max(Ut-20-this.titleHeight-B,0),this.currentPage=wn(this.currentPage,1),this.fullHeight=l,Ee.forEach((di,vi)=>{let es=(rt=di.legendItem||{}).y||0,ws=Math.round(rt.label.getBBox().height),As=_e.length;(!As||es-_e[As-1]>Be&&(Ze||es)!==_e[As-1])&&(_e.push(Ze||es),As++),rt.pageIx=As-1,Ze&&Yt&&(Yt.pageIx=As-1),vi===Ee.length-1&&es+ws-_e[As-1]>Be&&es>_e[As-1]&&(_e.push(es),rt.pageIx=As),es!==Ze&&(Ze=es),Yt=rt}),Ci||(Ci=p.clipRect=T.clipRect(0,B-2,9999,0),p.contentGroup.clip(Ci)),De(Be),Xt||(this.nav=Xt=T.g().attr({zIndex:1}).add(this.group),this.up=T.symbol("triangle",0,0,pe,pe).add(Xt),Re("upTracker").on("click",function(){p.scroll(-1,te)}),this.pager=T.text("",15,10).addClass("highcharts-legend-navigation"),!y.styledMode&&re.style&&this.pager.css(re.style),this.pager.add(Xt),this.down=T.symbol("triangle-down",0,0,pe,pe).add(Xt),Re("downTracker").on("click",function(){p.scroll(1,te)})),p.scroll(0),l=Ut):Xt&&(De(),this.nav=Xt.destroy(),this.scrollGroup.attr({translateY:1}),this.clipHeight=0),l}scroll(l,p){let y=this.chart,T=this.pages,A=T.length,P=this.clipHeight,I=this.options.navigation,B=this.pager,X=this.padding,re=this.currentPage+l;re>A&&(re=A),re>0&&(p!==void 0&&Dd(p,y),this.nav.attr({translateX:X,translateY:P+this.padding+7+this.titleHeight,visibility:"inherit"}),[this.up,this.upTracker].forEach(function(te){te.attr({class:re===1?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"})}),B.attr({text:re+"/"+A}),[this.down,this.downTracker].forEach(function(te){te.attr({x:18+this.pager.getBBox().width,class:re===A?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"})},this),y.styledMode||(this.up.attr({fill:re===1?I.inactiveColor:I.activeColor}),this.upTracker.css({cursor:re===1?"default":"pointer"}),this.down.attr({fill:re===A?I.inactiveColor:I.activeColor}),this.downTracker.css({cursor:re===A?"default":"pointer"})),this.scrollOffset=-T[re-1]+this.initialItemY,this.scrollGroup.animate({translateY:this.scrollOffset}),this.currentPage=re,this.positionCheckboxes(),dg(()=>{ud(this,"afterScroll",{currentPage:re})},bo(wn(p,y.renderer.globalAnimation,!0)).duration))}setItemEvents(l,p,y){let T=this,A=l.legendItem||{},P=T.chart.renderer.boxWrapper,I=l instanceof je,B=l instanceof Vo,X="highcharts-legend-"+(I?"point":"series")+"-active",re=T.chart.styledMode,te=y?[p,A.symbol]:[A.group],pe=_e=>{T.allItems.forEach(Ee=>{l!==Ee&&[Ee].concat(Ee.linkedSeries||[]).forEach(De=>{De.setState(_e,!I)})})};for(let _e of te)_e&&_e.on("mouseover",function(){l.visible&&pe("inactive"),l.setState("hover"),l.visible&&P.addClass(X),re||p.css(T.options.itemHoverStyle)}).on("mouseout",function(){T.chart.styledMode||p.css(zd(l.visible?T.itemStyle:T.itemHiddenStyle)),pe(""),P.removeClass(X),l.setState()}).on("click",function(Ee){let De=function(){l.setVisible&&l.setVisible(),pe(l.visible?"inactive":"")};P.removeClass(X),ud(T,"itemClick",{browserEvent:Ee,legendItem:l},De),I?l.firePointEvent("legendItemClick",{browserEvent:Ee}):B&&ud(l,"legendItemClick",{browserEvent:Ee})})}createCheckboxForItem(l){l.checkbox=cu("input",{type:"checkbox",className:"highcharts-legend-checkbox",checked:l.selected,defaultChecked:l.selected},this.options.itemCheckboxStyle,this.chart.container),Mp(l.checkbox,"click",function(p){let y=p.target;ud(l.series||l,"checkboxClick",{checked:y.checked,item:l},function(){l.select()})})}}(function(q){q.compose=function(l){Mf(Tf,"Core.Legend")&&Mp(l,"beforeMargins",function(){this.legend=new q(this,this.options.legend)})}})(lm||(lm={}));let du=lm,{animate:ml,animObject:Jp,setAnimation:hm}=to,{defaultOptions:Qp}=Ra,{numberFormat:sp}=fa,{registerEventOptions:rp}=ch,{charts:uu,doc:op,marginNames:bh,svg:Sc,win:Vu}=pi,{seriesTypes:kp}=oo,{addEvent:Af,attr:kf,createElement:Yc,css:Mc,defined:Xo,diffObjects:Fm,discardElement:pd,erase:Ep,error:np,extend:ap,find:Ef,fireEvent:Uo,getAlignFactor:Uu,getStyle:$l,isArray:Fn,isNumber:ef,isObject:ug,isString:Cf,merge:zh,objectEach:sa,pick:Ha,pInt:Rd,relativeLength:cm,removeEvent:dl,splat:ju,syncTimeout:dm,uniqueKey:Pf}=Ps;class fd{static chart(l,p,y){return new fd(l,p,y)}constructor(l,p,y){this.sharedClips={};let T=[...arguments];(Cf(l)||l.nodeName)&&(this.renderTo=T.shift()),this.init(T[0],T[1])}setZoomOptions(){let l=this.options.chart,p=l.zooming;this.zooming={...p,type:Ha(l.zoomType,p.type),key:Ha(l.zoomKey,p.key),pinchType:Ha(l.pinchType,p.pinchType),singleTouch:Ha(l.zoomBySingleTouch,p.singleTouch,!1),resetButton:zh(p.resetButton,l.resetZoomButton)}}init(l,p){Uo(this,"init",{args:arguments},function(){var P;let y=zh(Qp,l),T=y.chart,A=this.renderTo||T.renderTo;this.userOptions=ap({},l),(this.renderTo=Cf(A)?op.getElementById(A):A)||np(13,!0,this),this.margin=[],this.spacing=[],this.labelCollectors=[],this.callback=p,this.isResizing=0,this.options=y,this.axes=[],this.series=[],this.locale=y.lang.locale??((P=this.renderTo.closest("[lang]"))==null?void 0:P.lang),this.time=new Za(ap(y.time||{},{locale:this.locale}),y.lang),y.time=this.time.options,this.numberFormatter=(T.numberFormatter||sp).bind(this),this.styledMode=T.styledMode,this.hasCartesianSeries=T.showAxes,this.index=uu.length,uu.push(this),pi.chartCount++,rp(this,T),this.xAxis=[],this.yAxis=[],this.pointCount=this.colorCounter=this.symbolCounter=0,this.setZoomOptions(),Uo(this,"afterInit"),this.firstRender()})}initSeries(l){let p=this.options.chart,y=l.type||p.type,T=kp[y];T||np(17,!0,this,{missingModuleFor:y});let A=new T;return typeof A.init=="function"&&A.init(this,l),A}setSortedData(){this.getSeriesOrderByLinks().forEach(function(l){l.points||l.data||!l.enabledDataSorting||l.setData(l.options.data,!1)})}getSeriesOrderByLinks(){return this.series.concat().sort(function(l,p){return l.linkedSeries.length||p.linkedSeries.length?p.linkedSeries.length-l.linkedSeries.length:0})}orderItems(l,p=0){let y=this[l],T=this.options[l]=ju(this.options[l]).slice(),A=this.userOptions[l]=this.userOptions[l]?ju(this.userOptions[l]).slice():[];if(this.hasRendered&&(T.splice(p),A.splice(p)),y)for(let P=p,I=y.length;P<I;++P){let B=y[P];B&&(B.index=P,B instanceof Vo&&(B.name=B.getName()),B.options.isInternal||(T[P]=B.options,A[P]=B.userOptions))}}getClipBox(l,p){var re,te;let y=this.inverted,{xAxis:T,yAxis:A}=l||{},{x:P,y:I,width:B,height:X}=zh(this.clipBox);return l&&(T&&T.len!==this.plotSizeX&&(B=T.len),A&&A.len!==this.plotSizeY&&(X=A.len),y&&!l.invertible&&([B,X]=[X,B])),p&&(P+=((re=y?A:T)==null?void 0:re.pos)??this.plotLeft,I+=((te=y?T:A)==null?void 0:te.pos)??this.plotTop),{x:P,y:I,width:B,height:X}}isInsidePlot(l,p,y={}){var Re;let{inverted:T,plotBox:A,plotLeft:P,plotTop:I,scrollablePlotBox:B}=this,{scrollLeft:X=0,scrollTop:re=0}=y.visiblePlotOnly&&((Re=this.scrollablePlotArea)==null?void 0:Re.scrollingContainer)||{},te=y.series,pe=y.visiblePlotOnly&&B||A,_e=y.inverted?p:l,Ee=y.inverted?l:p,De={x:_e,y:Ee,isInsidePlot:!0,options:y};if(!y.ignoreX){let Be=te&&(T&&!this.polar?te.yAxis:te.xAxis)||{pos:P,len:1/0},Ze=y.paneCoordinates?Be.pos+_e:P+_e;Ze>=Math.max(X+P,Be.pos)&&Ze<=Math.min(X+P+pe.width,Be.pos+Be.len)||(De.isInsidePlot=!1)}if(!y.ignoreY&&De.isInsidePlot){let Be=!T&&y.axis&&!y.axis.isXAxis&&y.axis||te&&(T?te.xAxis:te.yAxis)||{pos:I,len:1/0},Ze=y.paneCoordinates?Be.pos+Ee:I+Ee;Ze>=Math.max(re+I,Be.pos)&&Ze<=Math.min(re+I+pe.height,Be.pos+Be.len)||(De.isInsidePlot=!1)}return Uo(this,"afterIsInsidePlot",De),De.isInsidePlot}redraw(l){Uo(this,"beforeRedraw");let p=this.hasCartesianSeries?this.axes:this.colorAxis||[],y=this.series,T=this.pointer,A=this.legend,P=this.userOptions.legend,I=this.renderer,B=I.isHidden(),X=[],re,te,pe,_e=this.isDirtyBox,Ee=this.isDirtyLegend,De;for(I.rootFontSize=I.boxWrapper.getStyle("font-size"),this.setResponsive&&this.setResponsive(!1),hm(!!this.hasRendered&&l,this),B&&this.temporaryDisplay(),this.layOutTitles(!1),pe=y.length;pe--;)if(((De=y[pe]).options.stacking||De.options.centerInCategory)&&(te=!0,De.isDirty)){re=!0;break}if(re)for(pe=y.length;pe--;)(De=y[pe]).options.stacking&&(De.isDirty=!0);y.forEach(function(Re){Re.isDirty&&(Re.options.legendType==="point"?(typeof Re.updateTotals=="function"&&Re.updateTotals(),Ee=!0):P&&(P.labelFormatter||P.labelFormat)&&(Ee=!0)),Re.isDirtyData&&Uo(Re,"updatedData")}),Ee&&A&&A.options.enabled&&(A.render(),this.isDirtyLegend=!1),te&&this.getStacks(),p.forEach(function(Re){Re.updateNames(),Re.setScale()}),this.getMargins(),p.forEach(function(Re){Re.isDirty&&(_e=!0)}),p.forEach(function(Re){let Be=Re.min+","+Re.max;Re.extKey!==Be&&(Re.extKey=Be,X.push(function(){Uo(Re,"afterSetExtremes",ap(Re.eventArgs,Re.getExtremes())),delete Re.eventArgs})),(_e||te)&&Re.redraw()}),_e&&this.drawChartBox(),Uo(this,"predraw"),y.forEach(function(Re){(_e||Re.isDirty)&&Re.visible&&Re.redraw(),Re.isDirtyData=!1}),T&&T.reset(!0),I.draw(),Uo(this,"redraw"),Uo(this,"render"),B&&this.temporaryDisplay(!0),X.forEach(function(Re){Re.call()})}get(l){let p=this.series;function y(A){return A.id===l||A.options&&A.options.id===l}let T=Ef(this.axes,y)||Ef(this.series,y);for(let A=0;!T&&A<p.length;A++)T=Ef(p[A].points||[],y);return T}createAxes(){let l=this.userOptions;for(let p of(Uo(this,"createAxes"),["xAxis","yAxis"]))for(let y of l[p]=ju(l[p]||{}))new Lu(this,y,p);Uo(this,"afterCreateAxes")}getSelectedPoints(){return this.series.reduce((l,p)=>(p.getPointsCollection().forEach(y=>{Ha(y.selectedStaging,y.selected)&&l.push(y)}),l),[])}getSelectedSeries(){return this.series.filter(l=>l.selected)}setTitle(l,p,y){this.applyDescription("title",l),this.applyDescription("subtitle",p),this.applyDescription("caption",void 0),this.layOutTitles(y)}applyDescription(l,p){var P;let y=this,T=this.options[l]=zh(this.options[l],p),A=this[l];A&&p&&(this[l]=A=A.destroy()),T&&!A&&((A=this.renderer.text(T.text,0,0,T.useHTML).attr({align:T.align,class:"highcharts-"+l,zIndex:T.zIndex||4}).css({textOverflow:"ellipsis",whiteSpace:"nowrap"}).add()).update=function(I,B){y.applyDescription(l,I),y.layOutTitles(B)},this.styledMode||A.css(ap(l==="title"?{fontSize:this.options.isStock?"1em":"1.2em"}:{},T.style)),A.textPxLength=A.getBBox().width,A.css({whiteSpace:(P=T.style)==null?void 0:P.whiteSpace}),this[l]=A)}layOutTitles(l=!0){var I,B,X,re;let p=[0,0,0],{options:y,renderer:T,spacingBox:A}=this;["title","subtitle","caption"].forEach(te=>{var Re;let pe=this[te],_e=this.options[te],Ee=zh(A),De=(pe==null?void 0:pe.textPxLength)||0;if(pe&&_e){Uo(this,"layOutTitle",{alignTo:Ee,key:te,textPxLength:De});let Be=T.fontMetrics(pe),Ze=Be.b,rt=Be.h,Yt=_e.verticalAlign||"top",Ut=Yt==="top",Xt=Ut&&_e.minScale||1,Ci=te==="title"?Ut?-3:0:Ut?p[0]+2:0,di=Math.min(Ee.width/De,1),vi=Math.max(Xt,di),es=zh({y:Yt==="bottom"?Ze:Ci+Ze},{align:te==="title"?di<Xt?"left":"center":(Re=this.title)==null?void 0:Re.alignValue},_e),ws=(_e.width||(di>Xt?this.chartWidth:Ee.width)/vi)+"px";pe.alignValue!==es.align&&(pe.placed=!1);let As=Math.round(pe.css({width:ws}).getBBox(_e.useHTML).height);if(es.height=As,pe.align(es,!1,Ee).attr({align:es.align,scaleX:vi,scaleY:vi,"transform-origin":`${Ee.x+De*vi*Uu(es.align)} ${rt}`}),!_e.floating){let $s=As*(As<1.2*rt?1:vi);Yt==="top"?p[0]=Math.ceil(p[0]+$s):Yt==="bottom"&&(p[2]=Math.ceil(p[2]+$s))}}},this),p[0]&&(((I=y.title)==null?void 0:I.verticalAlign)||"top")==="top"&&(p[0]+=((B=y.title)==null?void 0:B.margin)||0),p[2]&&((X=y.caption)==null?void 0:X.verticalAlign)==="bottom"&&(p[2]+=((re=y.caption)==null?void 0:re.margin)||0);let P=!this.titleOffset||this.titleOffset.join(",")!==p.join(",");this.titleOffset=p,Uo(this,"afterLayOutTitles"),!this.isDirtyBox&&P&&(this.isDirtyBox=this.isDirtyLegend=P,this.hasRendered&&l&&this.isDirtyBox&&this.redraw())}getContainerBox(){let l=[].map.call(this.renderTo.children,y=>{if(y!==this.container){let T=y.style.display;return y.style.display="none",[y,T]}}),p={width:$l(this.renderTo,"width",!0)||0,height:$l(this.renderTo,"height",!0)||0};return l.filter(Boolean).forEach(([y,T])=>{y.style.display=T}),p}getChartSize(){var P;let l=this.options.chart,p=l.width,y=l.height,T=this.getContainerBox(),A=T.height<=1||!((P=this.renderTo.parentElement)!=null&&P.style.height)&&this.renderTo.style.height==="100%";this.chartWidth=Math.max(0,p||T.width||600),this.chartHeight=Math.max(0,cm(y,this.chartWidth)||(A?400:T.height)),this.containerBox=T}temporaryDisplay(l){let p=this.renderTo,y;if(l)for(;p!=null&&p.style;)p.hcOrigStyle&&(Mc(p,p.hcOrigStyle),delete p.hcOrigStyle),p.hcOrigDetached&&(op.body.removeChild(p),p.hcOrigDetached=!1),p=p.parentNode;else for(;p!=null&&p.style&&(op.body.contains(p)||p.parentNode||(p.hcOrigDetached=!0,op.body.appendChild(p)),($l(p,"display",!1)==="none"||p.hcOricDetached)&&(p.hcOrigStyle={display:p.style.display,height:p.style.height,overflow:p.style.overflow},y={display:"block",overflow:"hidden"},p!==this.renderTo&&(y.height=0),Mc(p,y),p.offsetWidth||p.style.setProperty("display","block","important")),(p=p.parentNode)!==op.body););}setClassName(l){this.container.className="highcharts-container "+(l||"")}getContainer(){var pe,_e;let l,p=this.options,y=p.chart,T="data-highcharts-chart",A=Pf(),P=this.renderTo,I=Rd(kf(P,T));ef(I)&&uu[I]&&uu[I].hasRendered&&uu[I].destroy(),kf(P,T,this.index),P.innerHTML=Gn.emptyHTML,y.skipClone||P.offsetWidth||this.temporaryDisplay(),this.getChartSize();let B=this.chartHeight,X=this.chartWidth;Mc(P,{overflow:"hidden"}),this.styledMode||(l=ap({position:"relative",overflow:"hidden",width:X+"px",height:B+"px",textAlign:"left",lineHeight:"normal",zIndex:0,"-webkit-tap-highlight-color":"rgba(0,0,0,0)",userSelect:"none","touch-action":"manipulation",outline:"none",padding:"0px"},y.style||{}));let re=Yc("div",{id:A},l,P);this.container=re,this.getChartSize(),X!==this.chartWidth&&(X=this.chartWidth,this.styledMode||Mc(re,{width:Ha((pe=y.style)==null?void 0:pe.width,X+"px")})),this.containerBox=this.getContainerBox(),this._cursor=re.style.cursor;let te=y.renderer||!Sc?Xd.getRendererType(y.renderer):Bc;if(this.renderer=new te(re,X,B,void 0,y.forExport,(_e=p.exporting)==null?void 0:_e.allowHTML,this.styledMode),hm(void 0,this),this.setClassName(y.className),this.styledMode)for(let Ee in p.defs)this.renderer.definition(p.defs[Ee]);else this.renderer.setStyle(y.style);this.renderer.chartIndex=this.index,Uo(this,"afterGetContainer")}getMargins(l){var A;let{spacing:p,margin:y,titleOffset:T}=this;this.resetMargins(),T[0]&&!Xo(y[0])&&(this.plotTop=Math.max(this.plotTop,T[0]+p[0])),T[2]&&!Xo(y[2])&&(this.marginBottom=Math.max(this.marginBottom,T[2]+p[2])),(A=this.legend)!=null&&A.display&&this.legend.adjustMargins(y,p),Uo(this,"getMargins"),l||this.getAxisMargins()}getAxisMargins(){let l=this,p=l.axisOffset=[0,0,0,0],y=l.colorAxis,T=l.margin,A=function(P){P.forEach(function(I){I.visible&&I.getOffset()})};l.hasCartesianSeries?A(l.axes):y!=null&&y.length&&A(y),bh.forEach(function(P,I){Xo(T[I])||(l[P]+=p[I])}),l.setChartSize()}getOptions(){return Fm(this.userOptions,Qp)}reflow(l){var A,P;let p=this,y=p.containerBox,T=p.getContainerBox();(A=p.pointer)==null||delete A.chartPosition,!((P=p.exporting)!=null&&P.isPrinting)&&!p.isResizing&&y&&T.width&&((T.width!==y.width||T.height!==y.height)&&(Ps.clearTimeout(p.reflowTimeout),p.reflowTimeout=dm(function(){p.container&&p.setSize(void 0,void 0,!1)},100*!!l)),p.containerBox=T)}setReflow(){let l=this,p=y=>{var T;(T=l.options)!=null&&T.chart.reflow&&l.hasLoaded&&l.reflow(y)};if(typeof ResizeObserver=="function")new ResizeObserver(p).observe(l.renderTo);else{let y=Af(Vu,"resize",p);Af(this,"destroy",y)}}setSize(l,p,y){let T=this,A=T.renderer;T.isResizing+=1,hm(y,T);let P=A.globalAnimation;T.oldChartHeight=T.chartHeight,T.oldChartWidth=T.chartWidth,l!==void 0&&(T.options.chart.width=l),p!==void 0&&(T.options.chart.height=p),T.getChartSize();let{chartWidth:I,chartHeight:B,scrollablePixelsX:X=0,scrollablePixelsY:re=0}=T;(T.isDirtyBox||I!==T.oldChartWidth||B!==T.oldChartHeight)&&(T.styledMode||(P?ml:Mc)(T.container,{width:`${I+X}px`,height:`${B+re}px`},P),T.setChartSize(!0),A.setSize(I,B,P),T.axes.forEach(function(te){te.isDirty=!0,te.setScale()}),T.isDirtyLegend=!0,T.isDirtyBox=!0,T.layOutTitles(),T.getMargins(),T.redraw(P),T.oldChartHeight=void 0,Uo(T,"resize"),setTimeout(()=>{T&&Uo(T,"endResize")},Jp(P).duration)),T.isResizing-=1}setChartSize(l){let p,y,T,A,{chartHeight:P,chartWidth:I,inverted:B,spacing:X,renderer:re}=this,te=this.clipOffset,pe=Math[B?"floor":"round"];this.plotLeft=p=Math.round(this.plotLeft),this.plotTop=y=Math.round(this.plotTop),this.plotWidth=T=Math.max(0,Math.round(I-p-(this.marginRight??0))),this.plotHeight=A=Math.max(0,Math.round(P-y-(this.marginBottom??0))),this.plotSizeX=B?A:T,this.plotSizeY=B?T:A,this.spacingBox=re.spacingBox={x:X[3],y:X[0],width:I-X[3]-X[1],height:P-X[0]-X[2]},this.plotBox=re.plotBox={x:p,y,width:T,height:A},te&&(this.clipBox={x:pe(te[3]),y:pe(te[0]),width:pe(this.plotSizeX-te[1]-te[3]),height:pe(this.plotSizeY-te[0]-te[2])}),l||(this.axes.forEach(function(_e){_e.setAxisSize(),_e.setAxisTranslation()}),re.alignElements()),Uo(this,"afterSetChartSize",{skipAxes:l})}resetMargins(){Uo(this,"resetMargins");let l=this,p=l.options.chart,y=p.plotBorderWidth||0,T=Math.round(y)/2;["margin","spacing"].forEach(function(A){let P=p[A],I=ug(P)?P:[P,P,P,P];["Top","Right","Bottom","Left"].forEach(function(B,X){l[A][X]=Ha(p[A+B],I[X])})}),bh.forEach(function(A,P){l[A]=Ha(l.margin[P],l.spacing[P])}),l.axisOffset=[0,0,0,0],l.clipOffset=[T,T,T,T],l.plotBorderWidth=y}drawChartBox(){let l=this.options.chart,p=this.renderer,y=this.chartWidth,T=this.chartHeight,A=this.styledMode,P=this.plotBGImage,I=l.backgroundColor,B=l.plotBackgroundColor,X=l.plotBackgroundImage,re=this.plotLeft,te=this.plotTop,pe=this.plotWidth,_e=this.plotHeight,Ee=this.plotBox,De=this.clipRect,Re=this.clipBox,Be=this.chartBackground,Ze=this.plotBackground,rt=this.plotBorder,Yt,Ut,Xt,Ci="animate";Be||(this.chartBackground=Be=p.rect().addClass("highcharts-background").add(),Ci="attr"),A?Yt=Ut=Be.strokeWidth():(Ut=(Yt=l.borderWidth||0)+8*!!l.shadow,Xt={fill:I||"none"},(Yt||Be["stroke-width"])&&(Xt.stroke=l.borderColor,Xt["stroke-width"]=Yt),Be.attr(Xt).shadow(l.shadow)),Be[Ci]({x:Ut/2,y:Ut/2,width:y-Ut-Yt%2,height:T-Ut-Yt%2,r:l.borderRadius}),Ci="animate",Ze||(Ci="attr",this.plotBackground=Ze=p.rect().addClass("highcharts-plot-background").add()),Ze[Ci](Ee),!A&&(Ze.attr({fill:B||"none"}).shadow(l.plotShadow),X&&(P?(X!==P.attr("href")&&P.attr("href",X),P.animate(Ee)):this.plotBGImage=p.image(X,re,te,pe,_e).add())),De?De.animate({width:Re.width,height:Re.height}):this.clipRect=p.clipRect(Re),Ci="animate",rt||(Ci="attr",this.plotBorder=rt=p.rect().addClass("highcharts-plot-border").attr({zIndex:1}).add()),A||rt.attr({stroke:l.plotBorderColor,"stroke-width":l.plotBorderWidth||0,fill:"none"}),rt[Ci](rt.crisp(Ee,-rt.strokeWidth())),this.isDirtyBox=!1,Uo(this,"afterDrawChartBox")}propFromSeries(){let l,p,y,T=this,A=T.options.chart,P=T.options.series;["inverted","angular","polar"].forEach(function(I){for(p=kp[A.type],y=A[I]||p&&p.prototype[I],l=P==null?void 0:P.length;!y&&l--;)(p=kp[P[l].type])&&p.prototype[I]&&(y=!0);T[I]=y})}linkSeries(l){let p=this,y=p.series;y.forEach(function(T){T.linkedSeries.length=0}),y.forEach(function(T){let{linkedTo:A}=T.options;if(Cf(A)){let P;(P=A===":previous"?p.series[T.index-1]:p.get(A))&&P.linkedParent!==T&&(P.linkedSeries.push(T),T.linkedParent=P,P.enabledDataSorting&&T.setDataSortingOptions(),T.visible=Ha(T.options.visible,P.options.visible,T.visible))}}),Uo(this,"afterLinkSeries",{isUpdating:l})}renderSeries(){this.series.forEach(function(l){l.translate(),l.render()})}render(){var re;let l=this.axes,p=this.colorAxis,y=this.renderer,T=this.options.chart.axisLayoutRuns||2,A=te=>{te.forEach(pe=>{pe.visible&&pe.render()})},P=0,I=!0,B,X=0;for(let te of(this.setTitle(),Uo(this,"beforeMargins"),(re=this.getStacks)==null||re.call(this),this.getMargins(!0),this.setChartSize(),l)){let{options:pe}=te,{labels:_e}=pe;if(this.hasCartesianSeries&&te.horiz&&te.visible&&_e.enabled&&te.series.length&&te.coll!=="colorAxis"&&!this.polar){P=pe.tickLength,te.createGroups();let Ee=new Pu(te,0,"",!0),De=Ee.createLabel("x",_e);if(Ee.destroy(),De&&Ha(_e.reserveSpace,!ef(pe.crossing))&&(P=De.getBBox().height+_e.distance+Math.max(pe.offset||0,0)),P){De==null||De.destroy();break}}}for(this.plotHeight=Math.max(this.plotHeight-P,0);(I||B||T>1)&&X<T;){let te=this.plotWidth,pe=this.plotHeight;for(let _e of l)X===0?_e.setScale():(_e.horiz&&I||!_e.horiz&&B)&&_e.setTickInterval(!0);X===0?this.getAxisMargins():this.getMargins(),I=te/this.plotWidth>(X?1:1.1),B=pe/this.plotHeight>(X?1:1.05),X++}this.drawChartBox(),this.hasCartesianSeries?A(l):p!=null&&p.length&&A(p),this.seriesGroup||(this.seriesGroup=y.g("series-group").attr({zIndex:3}).shadow(this.options.chart.seriesGroupShadow).add()),this.dataLabelsGroup||(this.dataLabelsGroup=y.g("datalabels-group").attr({zIndex:6}).add()),this.renderSeries(),this.addCredits(),this.setResponsive&&this.setResponsive(),this.hasRendered=!0}addCredits(l){let p=this,y=zh(!0,this.options.credits,l);y.enabled&&!this.credits&&(this.credits=this.renderer.text(y.text+(this.mapCredits||""),0,0).addClass("highcharts-credits").on("click",function(){y.href&&(Vu.location.href=y.href)}).attr({align:y.position.align,zIndex:8}),p.styledMode||this.credits.css(y.style),this.credits.add().align(y.position),this.credits.update=function(T){p.credits=p.credits.destroy(),p.addCredits(T)})}destroy(){var I,B;let l,p=this,y=p.axes,T=p.series,A=p.container,P=A==null?void 0:A.parentNode;for(Uo(p,"destroy"),p.renderer.forExport?Ep(uu,p):uu[p.index]=void 0,pi.chartCount--,p.renderTo.removeAttribute("data-highcharts-chart"),dl(p),l=y.length;l--;)y[l]=y[l].destroy();for((B=(I=this.scroller)==null?void 0:I.destroy)==null||B.call(I),l=T.length;l--;)T[l]=T[l].destroy();["title","subtitle","chartBackground","plotBackground","plotBGImage","plotBorder","seriesGroup","clipRect","credits","pointer","rangeSelector","legend","resetZoomButton","tooltip","renderer"].forEach(X=>{var re,te;p[X]=(te=(re=p[X])==null?void 0:re.destroy)==null?void 0:te.call(re)}),A&&(A.innerHTML=Gn.emptyHTML,dl(A),P&&pd(A)),sa(p,function(X,re){delete p[re]})}firstRender(){var T;let l=this,p=l.options;l.getContainer(),l.resetMargins(),l.setChartSize(),l.propFromSeries(),l.createAxes();let y=Fn(p.series)?p.series:[];p.series=[],y.forEach(function(A){l.initSeries(A)}),l.linkSeries(),l.setSortedData(),Uo(l,"beforeRender"),l.render(),(T=l.pointer)==null||T.getChartPosition(),l.renderer.imgCount||l.hasLoaded||l.onload(),l.temporaryDisplay(!0)}onload(){this.callbacks.concat([this.callback]).forEach(function(l){l&&this.index!==void 0&&l.apply(this,[this])},this),Uo(this,"load"),Uo(this,"render"),Xo(this.index)&&this.setReflow(),this.warnIfA11yModuleNotLoaded(),this.hasLoaded=!0}warnIfA11yModuleNotLoaded(){let{options:l,title:p}=this;l&&!this.accessibility&&(this.renderer.boxWrapper.attr({role:"img","aria-label":((p==null?void 0:p.element.textContent)||"").replace(/</g,"&lt;")}),l.accessibility&&l.accessibility.enabled===!1||np('Highcharts warning: Consider including the "accessibility.js" module to make your chart more usable for people with disabilities. Set the "accessibility.enabled" option to false to remove this warning. See https://www.highcharts.com/docs/accessibility/accessibility-module.',!1,this))}addSeries(l,p,y){let T,A=this;return l&&(p=Ha(p,!0),Uo(A,"addSeries",{options:l},function(){T=A.initSeries(l),A.isDirtyLegend=!0,A.linkSeries(),T.enabledDataSorting&&T.setData(l.data,!1),Uo(A,"afterAddSeries",{series:T}),p&&A.redraw(y)})),T}addAxis(l,p,y,T){return this.createAxis(p?"xAxis":"yAxis",{axis:l,redraw:y,animation:T})}addColorAxis(l,p,y){return this.createAxis("colorAxis",{axis:l,redraw:p,animation:y})}createAxis(l,p){let y=new Lu(this,p.axis,l);return Ha(p.redraw,!0)&&this.redraw(p.animation),y}showLoading(l){let p=this,y=p.options,T=y.loading,A=function(){P&&Mc(P,{left:p.plotLeft+"px",top:p.plotTop+"px",width:p.plotWidth+"px",height:p.plotHeight+"px"})},P=p.loadingDiv,I=p.loadingSpan;P||(p.loadingDiv=P=Yc("div",{className:"highcharts-loading highcharts-loading-hidden"},null,p.container)),I||(p.loadingSpan=I=Yc("span",{className:"highcharts-loading-inner"},null,P),Af(p,"redraw",A)),P.className="highcharts-loading",Gn.setElementHTML(I,Ha(l,y.lang.loading,"")),!p.styledMode&&(Mc(P,ap(T.style,{zIndex:10})),Mc(I,T.labelStyle),p.loadingShown||(Mc(P,{opacity:0,display:""}),ml(P,{opacity:T.style.opacity||.5},{duration:T.showDuration||0}))),p.loadingShown=!0,A()}hideLoading(){let l=this.options,p=this.loadingDiv;p&&(p.className="highcharts-loading highcharts-loading-hidden",this.styledMode||ml(p,{opacity:0},{duration:l.loading.hideDuration||100,complete:function(){Mc(p,{display:"none"})}})),this.loadingShown=!1}update(l,p,y,T){let A,P,I,B=this,X={credits:"addCredits",title:"setTitle",subtitle:"setSubtitle",caption:"setCaption"},re=l.isResponsiveOptions,te=[];Uo(B,"update",{options:l}),re||B.setResponsive(!1,!0),l=Fm(l,B.options),B.userOptions=zh(B.userOptions,l);let pe=l.chart;pe&&(zh(!0,B.options.chart,pe),this.setZoomOptions(),"className"in pe&&B.setClassName(pe.className),("inverted"in pe||"polar"in pe||"type"in pe)&&(B.propFromSeries(),A=!0),"alignTicks"in pe&&(A=!0),"events"in pe&&rp(this,pe),sa(pe,function(De,Re){B.propsRequireUpdateSeries.indexOf("chart."+Re)!==-1&&(P=!0),B.propsRequireDirtyBox.indexOf(Re)!==-1&&(B.isDirtyBox=!0),B.propsRequireReflow.indexOf(Re)!==-1&&(B.isDirtyBox=!0,re||(I=!0))}),!B.styledMode&&pe.style&&B.renderer.setStyle(B.options.chart.style||{})),!B.styledMode&&l.colors&&(this.options.colors=l.colors),sa(l,function(De,Re){B[Re]&&typeof B[Re].update=="function"?B[Re].update(De,!1):typeof B[X[Re]]=="function"?B[X[Re]](De):Re!=="colors"&&B.collectionsWithUpdate.indexOf(Re)===-1&&zh(!0,B.options[Re],l[Re]),Re!=="chart"&&B.propsRequireUpdateSeries.indexOf(Re)!==-1&&(P=!0)}),this.collectionsWithUpdate.forEach(function(De){l[De]&&(ju(l[De]).forEach(function(Re,Be){let Ze,rt=Xo(Re.id);rt&&(Ze=B.get(Re.id)),!Ze&&B[De]&&(Ze=B[De][Ha(Re.index,Be)])&&(rt&&Xo(Ze.options.id)||Ze.options.isInternal)&&(Ze=void 0),Ze&&Ze.coll===De&&(Ze.update(Re,!1),y&&(Ze.touched=!0)),!Ze&&y&&B.collectionsWithInit[De]&&(B.collectionsWithInit[De][0].apply(B,[Re].concat(B.collectionsWithInit[De][1]||[]).concat([!1])).touched=!0)}),y&&B[De].forEach(function(Re){Re.touched||Re.options.isInternal?delete Re.touched:te.push(Re)}))}),te.forEach(function(De){De.chart&&De.remove&&De.remove(!1)}),A&&B.axes.forEach(function(De){De.update({},!1)}),P&&B.getSeriesOrderByLinks().forEach(function(De){De.chart&&De.update({},!1)},this);let _e=pe==null?void 0:pe.width,Ee=pe&&(Cf(pe.height)?cm(pe.height,_e||B.chartWidth):pe.height);I||ef(_e)&&_e!==B.chartWidth||ef(Ee)&&Ee!==B.chartHeight?B.setSize(_e,Ee,T):Ha(p,!0)&&B.redraw(T),Uo(B,"afterUpdate",{options:l,redraw:p,animation:T})}setSubtitle(l,p){this.applyDescription("subtitle",l),this.layOutTitles(p)}setCaption(l,p){this.applyDescription("caption",l),this.layOutTitles(p)}showResetZoom(){let l=this,p=Qp.lang,y=l.zooming.resetButton,T=y.theme,A=y.relativeTo==="chart"||y.relativeTo==="spacingBox"?null:"plotBox";function P(){l.zoomOut()}Uo(this,"beforeShowResetZoom",null,function(){l.resetZoomButton=l.renderer.button(p.resetZoom,null,null,P,T).attr({align:y.position.align,title:p.resetZoomTitle}).addClass("highcharts-reset-zoom").add().align(y.position,!1,A)}),Uo(this,"afterShowResetZoom")}zoomOut(){Uo(this,"selection",{resetSelection:!0},()=>this.transform({reset:!0,trigger:"zoom"}))}pan(l,p){let y=this,T=typeof p=="object"?p:{enabled:p,type:"x"},A=T.type,P=A&&y[{x:"xAxis",xy:"axes",y:"yAxis"}[A]].filter(B=>B.options.panningEnabled&&!B.options.isInternal),I=y.options.chart;I!=null&&I.panning&&(I.panning=T),Uo(this,"pan",{originalEvent:l},()=>{y.transform({axes:P,event:l,to:{x:l.chartX-(y.mouseDownX||0),y:l.chartY-(y.mouseDownY||0)},trigger:"pan"}),Mc(y.container,{cursor:"move"})})}transform(l){var Ee;let{axes:p=this.axes,event:y,from:T={},reset:A,selection:P,to:I={},trigger:B}=l,{inverted:X,time:re}=this;(Ee=this.hoverPoints)==null||Ee.forEach(De=>De.setState()),Uo(this,"transform",l);let te=l.hasZoomed||!1,pe,_e;for(let De of p){let{horiz:Re,len:Be,minPointOffset:Ze=0,options:rt,reversed:Yt}=De,Ut=Re?"width":"height",Xt=Re?"x":"y",Ci=Ha(I[Ut],De.len),di=Ha(T[Ut],De.len),vi=10>Math.abs(Ci)?1:Ci/di,es=(T[Xt]||0)+di/2-De.pos,ws=es-((I[Xt]??De.pos)+Ci/2-De.pos)/vi,As=Yt&&!X||!Yt&&X?-1:1;if(!A&&(es<0||es>De.len))continue;let $s=De.chart.polar||De.isOrdinal?0:Ze*As||0,kr=De.toValue(ws,!0),pr=De.toValue(ws+Be/vi,!0),Vr=kr+$s,cr=pr-$s,Zr=De.allExtremes;if(P&&P[De.coll].push({axis:De,min:Math.min(kr,pr),max:Math.max(kr,pr)}),Vr>cr&&([Vr,cr]=[cr,Vr]),vi===1&&!A&&De.coll==="yAxis"&&!Zr){for(let H of De.series){let n=H.getExtremes(H.getProcessedData(!0).modified.getColumn("y")||[],!0);Zr??(Zr={dataMin:Number.MAX_VALUE,dataMax:-Number.MAX_VALUE}),ef(n.dataMin)&&ef(n.dataMax)&&(Zr.dataMin=Math.min(n.dataMin,Zr.dataMin),Zr.dataMax=Math.max(n.dataMax,Zr.dataMax))}De.allExtremes=Zr}let{dataMin:Cn,dataMax:Qo,min:en,max:uc}=ap(De.getExtremes(),Zr||{}),gn=re.parse(rt.min),va=re.parse(rt.max),Fo=Cn??gn,Ao=Qo??va,oh=cr-Vr,Ya=De.categories?0:Math.min(oh,Ao-Fo),El=Fo-Ya*(Xo(gn)?0:rt.minPadding),Nh=Ao+Ya*(Xo(va)?0:rt.maxPadding),Tm=De.allowZoomOutside||vi===1||B!=="zoom"&&vi>1,Fp=Math.min(gn??El,El,Tm?en:El),vd=Math.max(va??Nh,Nh,Tm?uc:Nh);(!De.isOrdinal||vi!==1||A)&&(Vr<Fp&&(Vr=Fp,vi>=1&&(cr=Vr+oh)),cr>vd&&(cr=vd,vi>=1&&(Vr=cr-oh)),(A||De.series.length&&(Vr!==en||cr!==uc)&&Vr>=Fp&&cr<=vd)&&(P?P[De.coll].push({axis:De,min:Vr,max:cr}):(De.isPanning=B!=="zoom",De.isPanning&&(_e=!0),De.setExtremes(A?void 0:Vr,A?void 0:cr,!1,!1,{move:ws,trigger:B,scale:vi}),!A&&(Vr>Fp||cr<vd)&&B!=="mousewheel"&&(pe=!0)),te=!0),this.hasCartesianSeries||A||B==="mousewheel"||(pe=!0),y&&(this[Re?"mouseDownX":"mouseDownY"]=y[Re?"chartX":"chartY"]))}return te&&(P?Uo(this,"selection",P,()=>{delete l.selection,l.trigger="zoom",this.transform(l)}):(!pe||_e||this.resetZoomButton?!pe&&this.resetZoomButton&&(this.resetZoomButton=this.resetZoomButton.destroy()):this.showResetZoom(),this.redraw(B==="zoom"&&(this.options.chart.animation??this.pointCount<100)))),te}}ap(fd.prototype,{callbacks:[],collectionsWithInit:{xAxis:[fd.prototype.addAxis,[!0]],yAxis:[fd.prototype.addAxis,[!1]],series:[fd.prototype.addSeries]},collectionsWithUpdate:["xAxis","yAxis","series"],propsRequireDirtyBox:["backgroundColor","borderColor","borderWidth","borderRadius","plotBackgroundColor","plotBackgroundImage","plotBorderColor","plotBorderWidth","plotShadow","shadow"],propsRequireReflow:["margin","marginTop","marginRight","marginBottom","marginLeft","spacing","spacingTop","spacingRight","spacingBottom","spacingLeft"],propsRequireUpdateSeries:["chart.inverted","chart.polar","chart.ignoreHiddenSeries","chart.type","colors","plotOptions","time","tooltip"]});let pu=fd,{stop:Nm}=to,{composed:ra}=pi,{addEvent:ih,createElement:fu,css:um,defined:Gu,erase:pg,merge:lp,pushUnique:tf}=Ps;function mu(){let q=this.scrollablePlotArea;(this.scrollablePixelsX||this.scrollablePixelsY)&&!q&&(this.scrollablePlotArea=q=new Cp(this)),q==null||q.applyFixed()}function Wu(){this.chart.scrollablePlotArea&&(this.chart.scrollablePlotArea.isDirty=!0)}class Cp{static compose(l,p,y){tf(ra,this.compose)&&(ih(l,"afterInit",Wu),ih(p,"afterSetChartSize",T=>this.afterSetSize(T.target,T)),ih(p,"render",mu),ih(y,"show",Wu))}static afterSetSize(l,p){let y,T,A,{minWidth:P,minHeight:I}=l.options.chart.scrollablePlotArea||{},{clipBox:B,plotBox:X,inverted:re,renderer:te}=l;if(!te.forExport&&(P?(l.scrollablePixelsX=y=Math.max(0,P-l.chartWidth),y&&(l.scrollablePlotBox=lp(l.plotBox),X.width=l.plotWidth+=y,B[re?"height":"width"]+=y,A=!0)):I&&(l.scrollablePixelsY=T=Math.max(0,I-l.chartHeight),Gu(T)&&(l.scrollablePlotBox=lp(l.plotBox),X.height=l.plotHeight+=T,B[re?"width":"height"]+=T,A=!1)),Gu(A)&&!p.skipAxes))for(let pe of l.axes)(pe.horiz===A||l.hasParallelCoordinates&&pe.coll==="yAxis")&&(pe.setAxisSize(),pe.setAxisTranslation())}constructor(l){var _e;let p,y=l.options.chart,T=Xd.getRendererType(),A=y.scrollablePlotArea||{},P=this.moveFixedElements.bind(this),I={WebkitOverflowScrolling:"touch",overflowX:"hidden",overflowY:"hidden"};l.scrollablePixelsX&&(I.overflowX="auto"),l.scrollablePixelsY&&(I.overflowY="auto"),this.chart=l;let B=this.parentDiv=fu("div",{className:"highcharts-scrolling-parent"},{position:"relative"},l.renderTo),X=this.scrollingContainer=fu("div",{className:"highcharts-scrolling"},I,B),re=this.innerContainer=fu("div",{className:"highcharts-inner-container"},void 0,X),te=this.fixedDiv=fu("div",{className:"highcharts-fixed"},{position:"absolute",overflow:"hidden",pointerEvents:"none",zIndex:(((_e=y.style)==null?void 0:_e.zIndex)||0)+2,top:0},void 0,!0),pe=this.fixedRenderer=new T(te,l.chartWidth,l.chartHeight,y.style);this.mask=pe.path().attr({fill:y.backgroundColor||"#fff","fill-opacity":A.opacity??.85,zIndex:-1}).addClass("highcharts-scrollable-mask").add(),X.parentNode.insertBefore(te,X),um(l.renderTo,{overflow:"visible"}),ih(l,"afterShowResetZoom",P),ih(l,"afterApplyDrilldown",P),ih(l,"afterLayOutTitles",P),ih(X,"scroll",()=>{let{pointer:Ee,hoverPoint:De}=l;Ee&&(delete Ee.chartPosition,De&&(p=De),Ee.runPointActions(void 0,p,!0))}),re.appendChild(l.container)}applyFixed(){var es;let{chart:l,fixedRenderer:p,isDirty:y,scrollingContainer:T}=this,{axisOffset:A,chartWidth:P,chartHeight:I,container:B,plotHeight:X,plotLeft:re,plotTop:te,plotWidth:pe,scrollablePixelsX:_e=0,scrollablePixelsY:Ee=0}=l,{scrollPositionX:De=0,scrollPositionY:Re=0}=l.options.chart.scrollablePlotArea||{},Be=P+_e,Ze=I+Ee;p.setSize(P,I),(y??!0)&&(this.isDirty=!1,this.moveFixedElements()),Nm(l.container),um(B,{width:`${Be}px`,height:`${Ze}px`}),l.renderer.boxWrapper.attr({width:Be,height:Ze,viewBox:[0,0,Be,Ze].join(" ")}),(es=l.chartBackground)==null||es.attr({width:Be,height:Ze}),um(T,{width:`${P}px`,height:`${I}px`}),Gu(y)||(T.scrollLeft=_e*De,T.scrollTop=Ee*Re);let rt=te-A[0]-1,Yt=re-A[3]-1,Ut=te+X+A[2]+1,Xt=re+pe+A[1]+1,Ci=re+pe-_e,di=te+X-Ee,vi=[["M",0,0]];_e?vi=[["M",0,rt],["L",re-1,rt],["L",re-1,Ut],["L",0,Ut],["Z"],["M",Ci,rt],["L",P,rt],["L",P,Ut],["L",Ci,Ut],["Z"]]:Ee&&(vi=[["M",Yt,0],["L",Yt,te-1],["L",Xt,te-1],["L",Xt,0],["Z"],["M",Yt,di],["L",Yt,I],["L",Xt,I],["L",Xt,di],["Z"]]),l.redrawTrigger!=="adjustHeight"&&this.mask.attr({d:vi})}moveFixedElements(){let l,{container:p,inverted:y,scrollablePixelsX:T,scrollablePixelsY:A}=this.chart,P=this.fixedRenderer,I=Cp.fixedSelectors;if(T&&!y?l=".highcharts-yaxis":T&&y||A&&!y?l=".highcharts-xaxis":A&&y&&(l=".highcharts-yaxis"),l&&!(this.chart.hasParallelCoordinates&&l===".highcharts-yaxis"))for(let B of[`${l}:not(.highcharts-radial-axis)`,`${l}-labels:not(.highcharts-radial-axis-labels)`])tf(I,B);else for(let B of[".highcharts-xaxis",".highcharts-yaxis"])for(let X of[`${B}:not(.highcharts-radial-axis)`,`${B}-labels:not(.highcharts-radial-axis-labels)`])pg(I,X);for(let B of I)[].forEach.call(p.querySelectorAll(B),X=>{(X.namespaceURI===P.SVG_NS?P.box:P.box.parentNode).appendChild(X),X.style.pointerEvents="auto"})}}Cp.fixedSelectors=[".highcharts-breadcrumbs-group",".highcharts-contextbutton",".highcharts-caption",".highcharts-credits",".highcharts-drillup-button",".highcharts-legend",".highcharts-legend-checkbox",".highcharts-navigator-series",".highcharts-navigator-xaxis",".highcharts-navigator-yaxis",".highcharts-navigator",".highcharts-range-selector-group",".highcharts-reset-zoom",".highcharts-scrollbar",".highcharts-subtitle",".highcharts-title"];let{format:Vm}=fa,{series:If}=oo,{destroyObjectProperties:md,fireEvent:Ac,getAlignFactor:$c,isNumber:sf,pick:c}=Ps,t=class{constructor(q,l,p,y,T){let A=q.chart.inverted,P=q.reversed;this.axis=q;let I=this.isNegative=!!p!=!!P;this.options=l=l||{},this.x=y,this.total=null,this.cumulative=null,this.points={},this.hasValidPoints=!1,this.stack=T,this.leftCliff=0,this.rightCliff=0,this.alignOptions={align:l.align||(A?I?"left":"right":"center"),verticalAlign:l.verticalAlign||(A?"middle":I?"bottom":"top"),y:l.y,x:l.x},this.textAlign=l.textAlign||(A?I?"right":"left":"center")}destroy(){md(this,this.axis)}render(q){let l=this.axis.chart,p=this.options,y=p.format,T=y?Vm(y,this,l):p.formatter.call(this);if(this.label)this.label.attr({text:T,visibility:"hidden"});else{this.label=l.renderer.label(T,null,void 0,p.shape,void 0,void 0,p.useHTML,!1,"stack-labels");let A={r:p.borderRadius||0,text:T,padding:c(p.padding,5),visibility:"hidden"};l.styledMode||(A.fill=p.backgroundColor,A.stroke=p.borderColor,A["stroke-width"]=p.borderWidth,this.label.css(p.style||{})),this.label.attr(A),this.label.added||this.label.add(q)}this.label.labelrank=l.plotSizeY,Ac(this,"afterRender")}setOffset(q,l,p,y,T,A){let{alignOptions:P,axis:I,label:B,options:X,textAlign:re}=this,te=I.chart,pe=this.getStackBox({xOffset:q,width:l,boxBottom:p,boxTop:y,defaultX:T,xAxis:A}),{verticalAlign:_e}=P;if(B&&pe){let Ee=B.getBBox(void 0,0),De=B.padding,Re=c(X.overflow,"justify")==="justify",Be;P.x=X.x||0,P.y=X.y||0;let{x:Ze,y:rt}=this.adjustStackPosition({labelBox:Ee,verticalAlign:_e,textAlign:re});pe.x-=Ze,pe.y-=rt,B.align(P,!1,pe),(Be=te.isInsidePlot(B.alignAttr.x+P.x+Ze,B.alignAttr.y+P.y+rt))||(Re=!1),Re&&If.prototype.justifyDataLabel.call(I,B,P,B.alignAttr,Ee,pe),B.attr({x:B.alignAttr.x,y:B.alignAttr.y,rotation:X.rotation,rotationOriginX:Ee.width*$c(X.textAlign||"center"),rotationOriginY:Ee.height/2}),c(!Re&&X.crop,!0)&&(Be=sf(B.x)&&sf(B.y)&&te.isInsidePlot(B.x-De+(B.width||0),B.y)&&te.isInsidePlot(B.x+De,B.y)),B[Be?"show":"hide"]()}Ac(this,"afterSetOffset",{xOffset:q,width:l})}adjustStackPosition({labelBox:q,verticalAlign:l,textAlign:p}){return{x:q.width/2+q.width/2*(2*$c(p)-1),y:q.height/2*2*(1-$c(l))}}getStackBox(q){let l=this.axis,p=l.chart,{boxTop:y,defaultX:T,xOffset:A,width:P,boxBottom:I}=q,B=l.stacking.usePercentage?100:c(y,this.total,0),X=l.toPixels(B),re=q.xAxis||p.xAxis[0],te=c(T,re.translate(this.x))+A,pe=Math.abs(X-l.toPixels(I||sf(l.min)&&l.logarithmic&&l.logarithmic.lin2log(l.min)||0)),_e=p.inverted,Ee=this.isNegative;return _e?{x:(Ee?X:X-pe)-p.plotLeft,y:re.height-te-P+re.top-p.plotTop,width:pe,height:P}:{x:te+re.transB-p.plotLeft,y:(Ee?X-pe:X)-p.plotTop,width:P,height:pe}}},{getDeferredAnimation:r}=to,{series:{prototype:d}}=oo,{addEvent:_,correctFloat:b,defined:E,destroyObjectProperties:D,fireEvent:U,isNumber:Z,objectEach:ie,pick:de}=Ps;function ne(){let q=this.inverted;this.axes.forEach(l=>{var p;(p=l.stacking)!=null&&p.stacks&&l.hasVisibleSeries&&(l.stacking.oldStacks=l.stacking.stacks)}),this.series.forEach(l=>{var y;let p=((y=l.xAxis)==null?void 0:y.options)||{};l.options.stacking&&l.reserveSpace()&&(l.stackKey=[l.type,de(l.options.stack,""),q?p.top:p.left,q?p.height:p.width].join(","))})}function me(){var l;let q=this.stacking;if(q){let p=q.stacks;ie(p,(y,T)=>{D(y),delete p[T]}),(l=q.stackTotalGroup)==null||l.destroy()}}function Ce(){this.stacking||(this.stacking=new ut(this))}function Me(q,l,p,y){return!E(q)||q.x!==l||y&&q.stackKey!==y?q={x:l,index:0,key:y,stackKey:y}:q.index++,q.key=[p,l,q.index].join(","),q}function Pe(){let q,l=this,p=l.yAxis,y=l.stackKey||"",T=p.stacking.stacks,A=l.getColumn("x",!0),P=l.options.stacking,I=l[P+"Stacker"];I&&[y,"-"+y].forEach(B=>{var _e;let X=A.length,re,te,pe;for(;X--;)re=A[X],q=l.getStackIndicator(q,re,l.index,B),te=(_e=T[B])==null?void 0:_e[re],(pe=te==null?void 0:te.points[q.key||""])&&I.call(l,pe,te,X)})}function Ne(q,l,p){let y=l.total?100/l.total:0;q[0]=b(q[0]*y),q[1]=b(q[1]*y),this.stackedYData[p]=q[1]}function He(q){(this.is("column")||this.is("columnrange"))&&(this.options.centerInCategory&&this.chart.series.length>1?d.setStackedPoints.call(this,q,"group"):q.stacking.resetStacks())}function lt(q,l){var di,vi;let p,y,T,A,P,I,B,X=l||this.options.stacking;if(!X||!this.reserveSpace()||({group:"xAxis"}[X]||"yAxis")!==q.coll)return;let re=this.getColumn("x",!0),te=this.getColumn(this.pointValKey||"y",!0),pe=[],_e=te.length,Ee=this.options,De=Ee.threshold||0,Re=Ee.startFromThreshold?De:0,Be=Ee.stack,Ze=l?`${this.type},${X}`:this.stackKey||"",rt="-"+Ze,Yt=this.negStacks,Ut=q.stacking,Xt=Ut.stacks,Ci=Ut.oldStacks;for(Ut.stacksTouched+=1,B=0;B<_e;B++){let es=re[B]||0,ws=te[B],As=Z(ws)&&ws||0;I=(p=this.getStackIndicator(p,es,this.index)).key||"",Xt[P=(y=Yt&&As<(Re?0:De))?rt:Ze]||(Xt[P]={}),Xt[P][es]||((di=Ci[P])!=null&&di[es]?(Xt[P][es]=Ci[P][es],Xt[P][es].total=null):Xt[P][es]=new t(q,q.options.stackLabels,!!y,es,Be)),T=Xt[P][es],ws!==null?(T.points[I]=T.points[this.index]=[de(T.cumulative,Re)],E(T.cumulative)||(T.base=I),T.touched=Ut.stacksTouched,p.index>0&&this.singleStacks===!1&&(T.points[I][0]=T.points[this.index+","+es+",0"][0])):(delete T.points[I],delete T.points[this.index]);let $s=T.total||0;X==="percent"?(A=y?Ze:rt,$s=Yt&&((vi=Xt[A])!=null&&vi[es])?(A=Xt[A][es]).total=Math.max(A.total||0,$s)+Math.abs(As):b($s+Math.abs(As))):X==="group"?Z(ws)&&$s++:$s=b($s+As),X==="group"?T.cumulative=($s||1)-1:T.cumulative=b(de(T.cumulative,Re)+As),T.total=$s,ws!==null&&(T.points[I].push(T.cumulative),pe[B]=T.cumulative,T.hasValidPoints=!0)}X==="percent"&&(Ut.usePercentage=!0),X!=="group"&&(this.stackedYData=pe),Ut.oldStacks={}}class ut{constructor(l){this.oldStacks={},this.stacks={},this.stacksTouched=0,this.axis=l}buildStacks(){let l,p,y=this.axis,T=y.series,A=y.coll==="xAxis",P=y.options.reversedStacks,I=T.length;for(this.resetStacks(),this.usePercentage=!1,p=I;p--;)l=T[P?p:I-p-1],A&&l.setGroupedPoints(y),l.setStackedPoints(y);if(!A)for(p=0;p<I;p++)T[p].modifyStacks();U(y,"afterBuildStacks")}cleanStacks(){this.oldStacks&&(this.stacks=this.oldStacks,ie(this.stacks,l=>{ie(l,p=>{p.cumulative=p.total})}))}resetStacks(){ie(this.stacks,l=>{ie(l,(p,y)=>{Z(p.touched)&&p.touched<this.stacksTouched?(p.destroy(),delete l[y]):(p.total=null,p.cumulative=null)})})}renderStackTotals(){var I;let l=this.axis,p=l.chart,y=p.renderer,T=this.stacks,A=r(p,((I=l.options.stackLabels)==null?void 0:I.animation)||!1),P=this.stackTotalGroup=this.stackTotalGroup||y.g("stack-labels").attr({zIndex:6,opacity:0}).add();P.translate(p.plotLeft,p.plotTop),ie(T,B=>{ie(B,X=>{X.render(P)})}),P.animate({opacity:1},A)}}(_r||(_r={})).compose=function(q,l,p){let y=l.prototype,T=p.prototype;y.getStacks||(_(q,"init",Ce),_(q,"destroy",me),y.getStacks=ne,T.getStackIndicator=Me,T.modifyStacks=Pe,T.percentStacker=Ne,T.setGroupedPoints=He,T.setStackedPoints=lt)};let kt=_r,{defined:wt,merge:xt,isObject:pt}=Ps;class At extends Vo{drawGraph(){let l=this.options,p=(this.gappedPath||this.getGraphPath).call(this),y=this.chart.styledMode;[this,...this.zones].forEach((T,A)=>{let P,I=T.graph,B=I?"animate":"attr",X=T.dashStyle||l.dashStyle;I?(I.endX=this.preventGraphAnimation?null:p.xMap,I.animate({d:p})):p.length&&(T.graph=I=this.chart.renderer.path(p).addClass("highcharts-graph"+(A?` highcharts-zone-graph-${A-1} `:" ")+(A&&T.className||"")).attr({zIndex:1}).add(this.group)),I&&!y&&(P={stroke:!A&&l.lineColor||T.color||this.color||"#cccccc","stroke-width":l.lineWidth||0,fill:this.fillGraph&&this.color||"none"},X?P.dashstyle=X:l.linecap!=="square"&&(P["stroke-linecap"]=P["stroke-linejoin"]="round"),I[B](P).shadow(l.shadow&&xt({filterUnits:"userSpaceOnUse"},pt(l.shadow)?l.shadow:{}))),I&&(I.startX=p.xMap,I.isArea=p.isArea)})}getGraphPath(l,p,y){let T=this,A=T.options,P=[],I=[],B,X=A.step,re=(l=l||T.points).reversed;return re&&l.reverse(),(X={right:1,center:2}[X]||X&&3)&&re&&(X=4-X),(l=this.getValidPoints(l,!1,A.nullInteraction||!(A.connectNulls&&!p&&!y))).forEach(function(te,pe){let _e,Ee=te.plotX,De=te.plotY,Re=l[pe-1],Be=te.isNull||typeof De!="number";(te.leftCliff||Re!=null&&Re.rightCliff)&&!y&&(B=!0),Be&&!wt(p)&&pe>0?B=!A.connectNulls:Be&&!p?B=!0:(pe===0||B?_e=[["M",te.plotX,te.plotY]]:T.getPointSpline?_e=[T.getPointSpline(l,te,pe)]:X?(_e=X===1?[["L",Re.plotX,De]]:X===2?[["L",(Re.plotX+Ee)/2,Re.plotY],["L",(Re.plotX+Ee)/2,De]]:[["L",Ee,Re.plotY]]).push(["L",Ee,De]):_e=[["L",Ee,De]],I.push(te.x),X&&(I.push(te.x),X===2&&I.push(te.x)),P.push.apply(P,_e),B=!1)}),P.xMap=I,T.graphPath=P,P}}At.defaultOptions=xt(Vo.defaultOptions,{legendSymbol:"lineMarker"}),oo.registerSeriesType("line",At);let{seriesTypes:{line:Ct}}=oo,{extend:ti,merge:si,objectEach:wi,pick:_i}=Ps;class Bi extends Ct{drawGraph(){this.areaPath=[],super.drawGraph.apply(this);let{areaPath:l,options:p}=this;[this,...this.zones].forEach((y,T)=>{let A={},P=y.fillColor||p.fillColor,I=y.area,B=I?"animate":"attr";I?(I.endX=this.preventGraphAnimation?null:l.xMap,I.animate({d:l})):(A.zIndex=0,(I=y.area=this.chart.renderer.path(l).addClass("highcharts-area"+(T?` highcharts-zone-area-${T-1} `:" ")+(T&&y.className||"")).add(this.group)).isArea=!0),this.chart.styledMode||(A.fill=P||y.color||this.color,A["fill-opacity"]=P?1:p.fillOpacity??.75,I.css({pointerEvents:this.stickyTracking?"none":"auto"})),I[B](A),I.startX=l.xMap,I.shiftUnit=p.step?2:1})}getGraphPath(l){let p,y,T,A=Ct.prototype.getGraphPath,P=this.options,I=P.stacking,B=this.yAxis,X=[],re=[],te=this.index,pe=B.stacking.stacks[this.stackKey],_e=P.threshold,Ee=Math.round(B.getThreshold(P.threshold)),De=_i(P.connectNulls,I==="percent"),Re=function(Xt,Ci,di){let vi=l[Xt],es=I&&pe[vi.x].points[te],ws=vi[di+"Null"]||0,As=vi[di+"Cliff"]||0,$s,kr,pr=!0;As||ws?($s=(ws?es[0]:es[1])+As,kr=es[0]+As,pr=!!ws):!I&&l[Ci]&&l[Ci].isNull&&($s=kr=_e),$s!==void 0&&(re.push({plotX:p,plotY:$s===null?Ee:B.getThreshold($s),isNull:pr,isCliff:!0}),X.push({plotX:p,plotY:kr===null?Ee:B.getThreshold(kr),doCurve:!1}))};l=l||this.points,I&&(l=this.getStackPoints(l));for(let Xt=0,Ci=l.length;Xt<Ci;++Xt)I||(l[Xt].leftCliff=l[Xt].rightCliff=l[Xt].leftNull=l[Xt].rightNull=void 0),y=l[Xt].isNull,p=_i(l[Xt].rectPlotX,l[Xt].plotX),T=I?_i(l[Xt].yBottom,Ee):Ee,(!y||De)&&(De||Re(Xt,Xt-1,"left"),y&&!I&&De||(re.push(l[Xt]),X.push({x:Xt,plotX:p,plotY:T})),De||Re(Xt,Xt+1,"right"));let Be=A.call(this,re,!0,!0);X.reversed=!0;let Ze=A.call(this,X,!0,!0),rt=Ze[0];rt&&rt[0]==="M"&&(Ze[0]=["L",rt[1],rt[2]]);let Yt=Be.concat(Ze);Yt.length&&Yt.push(["Z"]);let Ut=A.call(this,re,!1,De);return this.chart.series.length>1&&I&&re.some(Xt=>Xt.isCliff)&&(Yt.hasStackedCliffs=Ut.hasStackedCliffs=!0),Yt.xMap=Be.xMap,this.areaPath=Yt,Ut}getStackPoints(l){let p=this,y=[],T=[],A=this.xAxis,P=this.yAxis,I=P.stacking.stacks[this.stackKey],B={},X=P.series,re=X.length,te=P.options.reversedStacks?1:-1,pe=X.indexOf(p);if(l=l||this.points,this.options.stacking){for(let Ee=0;Ee<l.length;Ee++)l[Ee].leftNull=l[Ee].rightNull=void 0,B[l[Ee].x]=l[Ee];wi(I,function(Ee,De){Ee.total!==null&&T.push(De)}),T.sort(function(Ee,De){return Ee-De});let _e=X.map(Ee=>Ee.visible);T.forEach(function(Ee,De){let Re=0,Be,Ze;if(B[Ee]&&!B[Ee].isNull)y.push(B[Ee]),[-1,1].forEach(function(rt){let Yt=rt===1?"rightNull":"leftNull",Ut=I[T[De+rt]],Xt=0;if(Ut){let Ci=pe;for(;Ci>=0&&Ci<re;){let di=X[Ci].index;!(Be=Ut.points[di])&&(di===p.index?B[Ee][Yt]=!0:_e[Ci]&&(Ze=I[Ee].points[di])&&(Xt-=Ze[1]-Ze[0])),Ci+=te}}B[Ee][rt===1?"rightCliff":"leftCliff"]=Xt});else{let rt=pe;for(;rt>=0&&rt<re;){let Yt=X[rt].index;if(Be=I[Ee].points[Yt]){Re=Be[1];break}rt+=te}Re=_i(Re,0),Re=P.translate(Re,0,1,0,1),y.push({isNull:!0,plotX:A.translate(Ee,0,0,0,1),x:Ee,plotY:Re,yBottom:Re})}})}return y}}Bi.defaultOptions=si(Ct.defaultOptions,{threshold:0,legendSymbol:"areaMarker"}),ti(Bi.prototype,{singleStacks:!1}),oo.registerSeriesType("area",Bi);let{line:Kt}=oo.seriesTypes,{merge:ui,pick:Ft}=Ps;class Ai extends Kt{getPointSpline(l,p,y){let T,A,P,I,B=p.plotX||0,X=p.plotY||0,re=l[y-1],te=l[y+1];function pe(Ee){return Ee&&!Ee.isNull&&Ee.doCurve!==!1&&!p.isCliff}if(pe(re)&&pe(te)){let Ee=re.plotX||0,De=re.plotY||0,Re=te.plotX||0,Be=te.plotY||0,Ze=0;T=(1.5*B+Ee)/2.5,A=(1.5*X+De)/2.5,P=(1.5*B+Re)/2.5,I=(1.5*X+Be)/2.5,P!==T&&(Ze=(I-A)*(P-B)/(P-T)+X-I),A+=Ze,I+=Ze,A>De&&A>X?(A=Math.max(De,X),I=2*X-A):A<De&&A<X&&(A=Math.min(De,X),I=2*X-A),I>Be&&I>X?(I=Math.max(Be,X),A=2*X-I):I<Be&&I<X&&(I=Math.min(Be,X),A=2*X-I),p.rightContX=P,p.rightContY=I,p.controlPoints={low:[T,A],high:[P,I]}}let _e=["C",Ft(re.rightContX,re.plotX,0),Ft(re.rightContY,re.plotY,0),Ft(T,B,0),Ft(A,X,0),B,X];return re.rightContX=re.rightContY=void 0,_e}}Ai.defaultOptions=ui(Kt.defaultOptions),oo.registerSeriesType("spline",Ai);let ai=Ai,{area:Di,area:{prototype:Yi}}=oo.seriesTypes,{extend:Mi,merge:qi}=Ps;class _s extends ai{}_s.defaultOptions=qi(ai.defaultOptions,Di.defaultOptions),Mi(_s.prototype,{getGraphPath:Yi.getGraphPath,getStackPoints:Yi.getStackPoints,drawGraph:Yi.drawGraph}),oo.registerSeriesType("areaspline",_s);let{animObject:Ts}=to,{parse:us}=at,{noop:Os}=pi,{clamp:Rs,crisp:Js,defined:ur,extend:Pr,fireEvent:Bo,isArray:Tn,isNumber:xo,merge:Yo,pick:Nn,objectEach:Er}=Ps;class br extends Vo{animate(l){let p,y,T=this,A=this.yAxis,P=A.pos,I=A.reversed,B=T.options,{clipOffset:X,inverted:re}=this.chart,te={},pe=re?"translateX":"translateY";l&&X?(te.scaleY=.001,y=Rs(A.toPixels(B.threshold||0),P,P+A.len),re?te.translateX=(y+=I?-Math.floor(X[0]):Math.ceil(X[2]))-A.len:te.translateY=y+=I?Math.ceil(X[0]):-Math.floor(X[2]),T.clipBox&&T.setClip(),T.group.attr(te)):(p=Number(T.group.attr(pe)),T.group.animate({scaleY:1},Pr(Ts(T.options.animation),{step:function(_e,Ee){T.group&&(te[pe]=p+Ee.pos*(P-p),T.group.attr(te))}})))}init(l,p){super.init.apply(this,arguments);let y=this;(l=y.chart).hasRendered&&l.series.forEach(function(T){T.type===y.type&&(T.isDirty=!0)})}getColumnMetrics(){var De,Re;let l=this,p=l.options,y=l.xAxis,T=l.yAxis,A=y.options.reversedStacks,P=y.reversed&&!A||!y.reversed&&A,I={},B,X=0;p.grouping===!1?X=1:l.chart.series.forEach(function(Be){let Ze,rt=Be.yAxis,Yt=Be.options;Be.type===l.type&&Be.reserveSpace()&&T.len===rt.len&&T.pos===rt.pos&&(Yt.stacking&&Yt.stacking!=="group"?(I[B=Be.stackKey]===void 0&&(I[B]=X++),Ze=I[B]):Yt.grouping!==!1&&(Ze=X++),Be.columnIndex=Ze)});let re=Math.min(Math.abs(y.transA)*(!((De=y.brokenAxis)!=null&&De.hasBreaks)&&((Re=y.ordinal)==null?void 0:Re.slope)||p.pointRange||y.closestPointRange||y.tickInterval||1),y.len),te=re*p.groupPadding,pe=(re-2*te)/(X||1),_e=Math.min(p.maxPointWidth||y.len,Nn(p.pointWidth,pe*(1-2*p.pointPadding))),Ee=(l.columnIndex||0)+ +!!P;return l.columnMetrics={width:_e,offset:(pe-_e)/2+(te+Ee*pe-re/2)*(P?-1:1),paddedWidth:pe,columnCount:X},l.columnMetrics}crispCol(l,p,y,T){let A=this.borderWidth,P=this.chart.inverted;return T=Js(p+T,A,P)-(p=Js(p,A,P)),this.options.crisp&&(y=Js(l+y,A)-(l=Js(l,A))),{x:l,y:p,width:y,height:T}}adjustForMissingColumns(l,p,y,T){var A;if(!y.isNull&&T.columnCount>1){let P=this.xAxis.series.filter(re=>re.visible).map(re=>re.index),I=0,B=0;Er((A=this.xAxis.stacking)==null?void 0:A.stacks,re=>{var Ee;let te=typeof y.x=="number"?(Ee=re[y.x.toString()])==null?void 0:Ee.points:void 0,pe=te==null?void 0:te[this.index],_e={};if(te&&Tn(pe)){let De=this.index,Re=Object.keys(te).filter(Be=>!Be.match(",")&&te[Be]&&te[Be].length>1).map(parseFloat).filter(Be=>P.indexOf(Be)!==-1).filter(Be=>{let Ze=this.chart.series[Be].options,rt=Ze.stacking&&Ze.stack;if(ur(rt)){if(xo(_e[rt]))return De===Be&&(De=_e[rt]),!1;_e[rt]=Be}return!0}).sort((Be,Ze)=>Ze-Be);I=Re.indexOf(De),B=Re.length}}),I=this.xAxis.reversed?B-1-I:I;let X=(B-1)*T.paddedWidth+p;l=(y.plotX||0)+X/2-p-I*T.paddedWidth}return l}translate(){let l=this,p=l.chart,y=l.options,T=l.dense=l.closestPointRange*l.xAxis.transA<2,A=l.borderWidth=Nn(y.borderWidth,+!T),P=l.xAxis,I=l.yAxis,B=y.threshold,X=Nn(y.minPointLength,5),re=l.getColumnMetrics(),te=re.width,pe=l.pointXOffset=re.offset,_e=l.dataMin,Ee=l.dataMax,De=l.translatedThreshold=I.getThreshold(B),Re=l.barW=Math.max(te,1+2*A);y.pointPadding&&y.crisp&&(Re=Math.ceil(Re)),Vo.prototype.translate.apply(l),l.points.forEach(function(Be){let Ze=Nn(Be.yBottom,De),rt=999+Math.abs(Ze),Yt=Be.plotX||0,Ut=Rs(Be.plotY,-rt,I.len+rt),Xt,Ci=Math.min(Ut,Ze),di=Math.max(Ut,Ze)-Ci,vi=te,es=Yt+pe,ws=Re;X&&Math.abs(di)<X&&(di=X,Xt=!I.reversed&&!Be.negative||I.reversed&&Be.negative,xo(B)&&xo(Ee)&&Be.y===B&&Ee<=B&&(I.min||0)<B&&(_e!==Ee||(I.max||0)<=B)&&(Xt=!Xt,Be.negative=!Be.negative),Ci=Math.abs(Ci-De)>X?Ze-X:De-(Xt?X:0)),ur(Be.options.pointWidth)&&(es-=Math.round(((vi=ws=Math.ceil(Be.options.pointWidth))-te)/2)),y.centerInCategory&&(es=l.adjustForMissingColumns(es,vi,Be,re)),Be.barX=es,Be.pointWidth=vi,Be.tooltipPos=p.inverted?[Rs(I.len+I.pos-p.plotLeft-Ut,I.pos-p.plotLeft,I.len+I.pos-p.plotLeft),P.len+P.pos-p.plotTop-es-ws/2,di]:[P.left-p.plotLeft+es+ws/2,Rs(Ut+I.pos-p.plotTop,I.pos-p.plotTop,I.len+I.pos-p.plotTop),di],Be.shapeType=l.pointClass.prototype.shapeType||"roundedRect",Be.shapeArgs=l.crispCol(es,Ci,ws,Be.isNull?0:di)}),Bo(this,"afterColumnTranslate")}drawGraph(){this.group[this.dense?"addClass":"removeClass"]("highcharts-dense-data")}pointAttribs(l,p){let y=this.options,T=this.pointAttrToOptions||{},A=T.stroke||"borderColor",P=T["stroke-width"]||"borderWidth",I,B,X,re=l&&l.color||this.color,te=l&&l[A]||y[A]||re,pe=l&&l.options.dashStyle||y.dashStyle,_e=l&&l[P]||y[P]||this[P]||0,Ee=l!=null&&l.isNull&&y.nullInteraction?0:(l==null?void 0:l.opacity)??y.opacity??1;l&&this.zones.length&&(B=l.getZone(),re=l.options.color||B&&(B.color||l.nonZonedColor)||this.color,B&&(te=B.borderColor||te,pe=B.dashStyle||pe,_e=B.borderWidth||_e)),p&&l&&(X=(I=Yo(y.states[p],l.options.states&&l.options.states[p]||{})).brightness,re=I.color||X!==void 0&&us(re).brighten(I.brightness).get()||re,te=I[A]||te,_e=I[P]||_e,pe=I.dashStyle||pe,Ee=Nn(I.opacity,Ee));let De={fill:re,stroke:te,"stroke-width":_e,opacity:Ee};return pe&&(De.dashstyle=pe),De}drawPoints(l=this.points){let p,y=this,T=this.chart,A=y.options,P=A.nullInteraction,I=T.renderer,B=A.animationLimit||250;l.forEach(function(X){let re=X.plotY,te=X.graphic,pe=!!te,_e=te&&T.pointCount<B?"animate":"attr";xo(re)&&(X.y!==null||P)?(p=X.shapeArgs,te&&X.hasNewShapeType()&&(te=te.destroy()),y.enabledDataSorting&&(X.startXPos=y.xAxis.reversed?-(p&&p.width||0):y.xAxis.width),!te&&(X.graphic=te=I[X.shapeType](p).add(X.group||y.group),te&&y.enabledDataSorting&&T.hasRendered&&T.pointCount<B&&(te.attr({x:X.startXPos}),pe=!0,_e="animate")),te&&pe&&te[_e](Yo(p)),T.styledMode||te[_e](y.pointAttribs(X,X.selected&&"select")).shadow(X.allowShadow!==!1&&A.shadow),te&&(te.addClass(X.getClassName(),!0),te.attr({visibility:X.visible?"inherit":"hidden"}))):te&&(X.graphic=te.destroy())})}drawTracker(l=this.points){let p,y=this,T=y.chart,A=T.pointer,P=function(I){A==null||A.normalize(I);let B=A==null?void 0:A.getPointFromEvent(I);A&&B&&y.options.enableMouseTracking&&(T.isInsidePlot(I.chartX-T.plotLeft,I.chartY-T.plotTop,{visiblePlotOnly:!0})||A!=null&&A.inClass(I.target,"highcharts-data-label"))&&(A.isDirectTouch=!0,B.onMouseOver(I))};l.forEach(function(I){p=Tn(I.dataLabels)?I.dataLabels:I.dataLabel?[I.dataLabel]:[],I.graphic&&(I.graphic.element.point=I),p.forEach(function(B){(B.div||B.element).point=I})}),y._hasTracking||(y.trackerGroups.forEach(function(I){y[I]&&(y[I].addClass("highcharts-tracker").on("mouseover",P).on("mouseout",function(B){A==null||A.onTrackerMouseOut(B)}).on("touchstart",P),!T.styledMode&&y.options.cursor&&y[I].css({cursor:y.options.cursor}))}),y._hasTracking=!0),Bo(this,"afterDrawTracker")}remove(){let l=this,p=l.chart;p.hasRendered&&p.series.forEach(function(y){y.type===l.type&&(y.isDirty=!0)}),Vo.prototype.remove.apply(l,arguments)}}br.defaultOptions=Yo(Vo.defaultOptions,{borderRadius:3,centerInCategory:!1,groupPadding:.2,marker:null,pointPadding:.1,minPointLength:0,cropThreshold:50,pointRange:null,states:{hover:{halo:!1,brightness:.1},select:{color:"#cccccc",borderColor:"#000000"}},dataLabels:{align:void 0,verticalAlign:void 0,y:void 0},startFromThreshold:!0,stickyTracking:!1,tooltip:{distance:6},threshold:0,borderColor:"#ffffff"}),Pr(br.prototype,{directTouch:!0,getSymbol:Os,negStacks:!0,trackerGroups:["group","dataLabelsGroup"]}),oo.registerSeriesType("column",br);let zr=br,{getDeferredAnimation:_n}=to,{format:Xa}=fa,{defined:Mo,extend:jo,fireEvent:Yn,getAlignFactor:Xr,isArray:$n,isString:hn,merge:cn,objectEach:dn,pick:_o,pInt:qn,splat:uh}=Ps;(function(q){function l(){return B(this).some(re=>re==null?void 0:re.enabled)}function p(re,te,pe,_e,Ee){var es;let{chart:De,enabledDataSorting:Re}=this,Be=this.isCartesian&&De.inverted,Ze=re.plotX,rt=re.plotY,Yt=pe.rotation||0,Ut=Mo(Ze)&&Mo(rt)&&De.isInsidePlot(Ze,Math.round(rt),{inverted:Be,paneCoordinates:!0,series:this}),Xt=Yt===0&&_o(pe.overflow,Re?"none":"justify")==="justify",Ci=this.visible&&re.visible!==!1&&Mo(Ze)&&(re.series.forceDL||Re&&!Xt||Ut||_o(pe.inside,!!this.options.stacking)&&_e&&De.isInsidePlot(Ze,Be?_e.x+1:_e.y+_e.height-1,{inverted:Be,paneCoordinates:!0,series:this})),di=re.pos();if(Ci&&di){var vi;let ws=te.getBBox(),As=te.getBBox(void 0,0);if(_e=jo({x:di[0],y:Math.round(di[1]),width:0,height:0},_e||{}),pe.alignTo==="plotEdges"&&this.isCartesian&&(_e[Be?"x":"y"]=0,_e[Be?"width":"height"]=((es=this.yAxis)==null?void 0:es.len)||0),jo(pe,{width:ws.width,height:ws.height}),vi=_e,Re&&this.xAxis&&!Xt&&this.setDataLabelStartPos(re,te,Ee,Ut,vi),te.align(cn(pe,{width:As.width,height:As.height}),!1,_e,!1),te.alignAttr.x+=Xr(pe.align)*(As.width-ws.width),te.alignAttr.y+=Xr(pe.verticalAlign)*(As.height-ws.height),te[te.placed?"animate":"attr"]({"text-align":te.alignAttr["text-align"]||"center",x:te.alignAttr.x+(ws.width-As.width)/2,y:te.alignAttr.y+(ws.height-As.height)/2,rotationOriginX:(te.width||0)/2,rotationOriginY:(te.height||0)/2}),Xt&&_e.height>=0)this.justifyDataLabel(te,pe,te.alignAttr,ws,_e,Ee);else if(_o(pe.crop,!0)){let{x:$s,y:kr}=te.alignAttr;Ci=De.isInsidePlot($s,kr,{paneCoordinates:!0,series:this})&&De.isInsidePlot($s+ws.width-1,kr+ws.height-1,{paneCoordinates:!0,series:this})}pe.shape&&!Yt&&te[Ee?"attr":"animate"]({anchorX:di[0],anchorY:di[1]})}Ee&&Re&&(te.placed=!1),Ci||Re&&!Xt?(te.show(),te.placed=!0):(te.hide(),te.placed=!1)}function y(){return this.plotGroup("dataLabelsGroup","data-labels",this.hasRendered?"inherit":"hidden",this.options.dataLabels.zIndex||6,this.chart.dataLabelsGroup)}function T(re){let te=this.hasRendered||0,pe=this.initDataLabelsGroup().attr({opacity:+te});return!te&&pe&&(this.visible&&pe.show(),this.options.animation?pe.animate({opacity:1},re):pe.attr({opacity:1})),pe}function A(re){var Ci;let te;re=re||this.points;let pe=this,_e=pe.chart,Ee=pe.options,De=_e.renderer,{backgroundColor:Re,plotBackgroundColor:Be}=_e.options.chart,Ze=De.getContrast(hn(Be)&&Be||hn(Re)&&Re||"#000000"),rt=B(pe),{animation:Yt,defer:Ut}=rt[0],Xt=Ut?_n(_e,Yt,pe):{defer:0,duration:0};Yn(this,"drawDataLabels"),(Ci=pe.hasDataLabels)!=null&&Ci.call(pe)&&(te=this.initDataLabels(Xt),re.forEach(di=>{var As,$s,kr;let vi=di.dataLabels||[],es=di.color||pe.color;uh(I(rt,di.dlOptions||((As=di.options)==null?void 0:As.dataLabels))).forEach((pr,Vr)=>{var El;let cr=pr.enabled&&(di.visible||di.dataLabelOnHidden)&&(!di.isNull||di.dataLabelOnNull)&&function(Nh,Tm){let Fp=Tm.filter;if(Fp){let vd=Fp.operator,H=Nh[Fp.property],n=Fp.value;return vd===">"&&H>n||vd==="<"&&H<n||vd===">="&&H>=n||vd==="<="&&H<=n||vd==="=="&&H==n||vd==="==="&&H===n||vd==="!="&&H!=n||vd==="!=="&&H!==n||!1}return!0}(di,pr),{backgroundColor:Zr,borderColor:Cn,distance:Qo,style:en={}}=pr,uc,gn,va,Fo={},Ao=vi[Vr],oh=!Ao,Ya;cr&&(gn=Mo(uc=_o(pr[di.formatPrefix+"Format"],pr.format))?Xa(uc,di,_e):(pr[di.formatPrefix+"Formatter"]||pr.formatter).call(di,pr),va=pr.rotation,!_e.styledMode&&(en.color=_o(pr.color,en.color,hn(pe.color)?pe.color:void 0,"#000000"),en.color==="contrast"?(Zr!=="none"&&(Ya=Zr),di.contrastColor=De.getContrast(Ya!=="auto"&&hn(Ya)&&Ya||(hn(es)?es:"")),en.color=Ya||!Mo(Qo)&&pr.inside||0>qn(Qo||0)||Ee.stacking?di.contrastColor:Ze):delete di.contrastColor,Ee.cursor&&(en.cursor=Ee.cursor)),Fo={r:pr.borderRadius||0,rotation:va,padding:pr.padding,zIndex:1},_e.styledMode||(Fo.fill=Zr==="auto"?di.color:Zr,Fo.stroke=Cn==="auto"?di.color:Cn,Fo["stroke-width"]=pr.borderWidth),dn(Fo,(Nh,Tm)=>{Nh===void 0&&delete Fo[Tm]})),!Ao||cr&&Mo(gn)&&!!(Ao.div||(El=Ao.text)!=null&&El.foreignObject)==!!pr.useHTML&&(Ao.rotation&&pr.rotation||Ao.rotation===pr.rotation)||(Ao=void 0,oh=!0),cr&&Mo(gn)&&gn!==""&&(Ao?Fo.text=gn:(Ao=De.label(gn,0,0,pr.shape,void 0,void 0,pr.useHTML,void 0,"data-label")).addClass(" highcharts-data-label-color-"+di.colorIndex+" "+(pr.className||"")+(pr.useHTML?" highcharts-tracker":"")),Ao&&(Ao.options=pr,Ao.attr(Fo),_e.styledMode?en.width&&Ao.css({width:en.width,textOverflow:en.textOverflow,whiteSpace:en.whiteSpace}):Ao.css(en).shadow(pr.shadow),Yn(Ao,"beforeAddingDataLabel",{labelOptions:pr,point:di}),Ao.added||Ao.add(te),pe.alignDataLabel(di,Ao,pr,void 0,oh),Ao.isActive=!0,vi[Vr]&&vi[Vr]!==Ao&&vi[Vr].destroy(),vi[Vr]=Ao))});let ws=vi.length;for(;ws--;)($s=vi[ws])!=null&&$s.isActive?vi[ws].isActive=!1:((kr=vi[ws])==null||kr.destroy(),vi.splice(ws,1));di.dataLabel=vi[0],di.dataLabels=vi})),Yn(this,"afterDrawDataLabels")}function P(re,te,pe,_e,Ee,De){let Re=this.chart,Be=te.align,Ze=te.verticalAlign,rt=re.box?0:re.padding||0,Yt=Re.inverted?this.yAxis:this.xAxis,Ut=Yt?Yt.left-Re.plotLeft:0,Xt=Re.inverted?this.xAxis:this.yAxis,Ci=Xt?Xt.top-Re.plotTop:0,{x:di=0,y:vi=0}=te,es,ws;return(es=(pe.x||0)+rt+Ut)<0&&(Be==="right"&&di>=0?(te.align="left",te.inside=!0):di-=es,ws=!0),(es=(pe.x||0)+_e.width-rt+Ut)>Re.plotWidth&&(Be==="left"&&di<=0?(te.align="right",te.inside=!0):di+=Re.plotWidth-es,ws=!0),(es=pe.y+rt+Ci)<0&&(Ze==="bottom"&&vi>=0?(te.verticalAlign="top",te.inside=!0):vi-=es,ws=!0),(es=(pe.y||0)+_e.height-rt+Ci)>Re.plotHeight&&(Ze==="top"&&vi<=0?(te.verticalAlign="bottom",te.inside=!0):vi+=Re.plotHeight-es,ws=!0),ws&&(te.x=di,te.y=vi,re.placed=!De,re.align(te,void 0,Ee)),ws}function I(re,te){let pe=[],_e;if($n(re)&&!$n(te))pe=re.map(function(Ee){return cn(Ee,te)});else if($n(te)&&!$n(re))pe=te.map(function(Ee){return cn(re,Ee)});else if($n(re)||$n(te)){if($n(re)&&$n(te))for(_e=Math.max(re.length,te.length);_e--;)pe[_e]=cn(re[_e],te[_e])}else pe=cn(re,te);return pe}function B(re){var pe,_e;let te=re.chart.options.plotOptions;return uh(I(I((pe=te==null?void 0:te.series)==null?void 0:pe.dataLabels,(_e=te==null?void 0:te[re.type])==null?void 0:_e.dataLabels),re.options.dataLabels))}function X(re,te,pe,_e,Ee){let De=this.chart,Re=De.inverted,Be=this.xAxis,Ze=Be.reversed,rt=((Re?te.height:te.width)||0)/2,Yt=re.pointWidth,Ut=Yt?Yt/2:0;te.startXPos=Re?Ee.x:Ze?-rt-Ut:Be.width-rt+Ut,te.startYPos=Re?Ze?this.yAxis.height-rt+Ut:-rt-Ut:Ee.y,_e?te.visibility==="hidden"&&(te.show(),te.attr({opacity:0}).animate({opacity:1})):te.attr({opacity:1}).animate({opacity:0},void 0,te.hide),De.hasRendered&&(pe&&te.attr({x:te.startXPos,y:te.startYPos}),te.placed=!0)}q.compose=function(re){let te=re.prototype;te.initDataLabels||(te.initDataLabels=T,te.initDataLabelsGroup=y,te.alignDataLabel=p,te.drawDataLabels=A,te.justifyDataLabel=P,te.mergeArrays=I,te.setDataLabelStartPos=X,te.hasDataLabels=l)}})(ar||(ar={}));let sn=ar,{composed:Go}=pi,{series:hc}=oo,{merge:Rh,pushUnique:Bd}=Ps;(function(q){function l(p,y,T,A,P){var De,Re;let{chart:I,options:B}=this,X=I.inverted,re=((De=this.xAxis)==null?void 0:De.len)||I.plotSizeX||0,te=((Re=this.yAxis)==null?void 0:Re.len)||I.plotSizeY||0,pe=p.dlBox||p.shapeArgs,_e=p.below??(p.plotY||0)>(this.translatedThreshold??te),Ee=T.inside??!!B.stacking;if(pe){if(A=Rh(pe),T.overflow!=="allow"||T.crop!==!1||B.clip!==!1){A.y<0&&(A.height+=A.y,A.y=0);let Be=A.y+A.height-te;Be>0&&Be<A.height-1&&(A.height-=Be)}X&&(A={x:te-A.y-A.height,y:re-A.x-A.width,width:A.height,height:A.width}),Ee||(X?(A.x+=_e?0:A.width,A.width=0):(A.y+=_e?A.height:0,A.height=0))}T.align??(T.align=!X||Ee?"center":_e?"right":"left"),T.verticalAlign??(T.verticalAlign=X||Ee?"middle":_e?"top":"bottom"),hc.prototype.alignDataLabel.call(this,p,y,T,A,P),T.inside&&p.contrastColor&&y.css({color:p.contrastColor})}q.compose=function(p){sn.compose(hc),Bd(Go,"ColumnDataLabel")&&(p.prototype.alignDataLabel=l)}})(Nr||(Nr={}));let gu=Nr,{extend:qc,merge:kc}=Ps;class hp extends zr{}hp.defaultOptions=kc(zr.defaultOptions,{}),qc(hp.prototype,{inverted:!0}),oo.registerSeriesType("bar",hp);let{column:Fd,line:yu}=oo.seriesTypes,{addEvent:Lf,extend:fg,merge:Of}=Ps;class Df extends yu{applyJitter(){let l=this,p=this.options.jitter,y=this.points.length;p&&this.points.forEach(function(T,A){["x","y"].forEach(function(P,I){if(p[P]&&!T.isNull){let B=`plot${P.toUpperCase()}`,X=l[`${P}Axis`],re=p[P]*X.transA;if(X&&!X.logarithmic){let te=Math.max(0,(T[B]||0)-re),pe=Math.min(X.len,(T[B]||0)+re);T[B]=te+(pe-te)*function(_e){let Ee=1e4*Math.sin(_e);return Ee-Math.floor(Ee)}(A+I*y),P==="x"&&(T.clientX=T.plotX)}}})})}drawGraph(){this.options.lineWidth?super.drawGraph():this.graph&&(this.graph=this.graph.destroy())}}Df.defaultOptions=Of(yu.defaultOptions,{lineWidth:0,findNearestPointBy:"xy",jitter:{x:0,y:0},marker:{enabled:!0},tooltip:{headerFormat:'<span style="color:{point.color}">●</span> <span style="font-size: 0.8em"> {series.name}</span><br/>',pointFormat:"x: <b>{point.x}</b><br/>y: <b>{point.y}</b><br/>"}}),fg(Df.prototype,{drawTracker:Fd.prototype.drawTracker,sorted:!1,requireSorting:!1,noSharedTooltip:!0,trackerGroups:["group","markerGroup","dataLabelsGroup"]}),Lf(Df,"afterTranslate",function(){this.applyJitter()}),oo.registerSeriesType("scatter",Df);let{deg2rad:pm}=pi,{fireEvent:mg,isNumber:Pp,pick:gd,relativeLength:fm}=Ps;(function(q){q.getCenter=function(){let l=this.options,p=this.chart,y=2*(l.slicedOffset||0),T=p.plotWidth-2*y,A=p.plotHeight-2*y,P=l.center,I=Math.min(T,A),B=l.thickness,X,re=l.size,te=l.innerSize||0,pe,_e;typeof re=="string"&&(re=parseFloat(re)),typeof te=="string"&&(te=parseFloat(te));let Ee=[gd(P==null?void 0:P[0],"50%"),gd(P==null?void 0:P[1],"50%"),gd(re&&re<0?void 0:l.size,"100%"),gd(te&&te<0?void 0:l.innerSize||0,"0%")];for(!p.angular||this instanceof Vo||(Ee[3]=0),pe=0;pe<4;++pe)_e=Ee[pe],X=pe<2||pe===2&&/%$/.test(_e),Ee[pe]=fm(_e,[T,A,I,Ee[2]][pe])+(X?y:0);return Ee[3]>Ee[2]&&(Ee[3]=Ee[2]),Pp(B)&&2*B<Ee[2]&&B>0&&(Ee[3]=Ee[2]-2*B),mg(this,"afterGetCenter",{positions:Ee}),Ee},q.getStartAndEndRadians=function(l,p){let y=Pp(l)?l:0,T=Pp(p)&&p>y&&p-y<360?p:y+360;return{start:pm*(y+-90),end:pm*(T+-90)}}})(Or||(Or={}));let xu=Or,{setAnimation:Hu}=to,{addEvent:Ig,defined:Um,extend:ay,isNumber:ly,pick:hy,relativeLength:yx}=Ps;class Lg extends je{getConnectorPath(l){let p=l.dataLabelPosition,y=l.options||{},T=y.connectorShape,A=this.connectorShapes[T]||T;return p&&A.call(this,{...p.computed,alignment:p.alignment},p.connectorPosition,y)||[]}getTranslate(){return this.sliced&&this.slicedTranslation||{translateX:0,translateY:0}}haloPath(l){let p=this.shapeArgs;return this.sliced||!this.visible?[]:this.series.chart.renderer.symbols.arc(p.x,p.y,p.r+l,p.r+l,{innerR:p.r-1,start:p.start,end:p.end,borderRadius:p.borderRadius})}constructor(l,p,y){super(l,p,y),this.half=0,this.name??(this.name=l.chart.options.lang.pieSliceName);let T=A=>{this.slice(A.type==="select")};Ig(this,"select",T),Ig(this,"unselect",T)}isValid(){return ly(this.y)&&this.y>=0}setVisible(l,p=!0){l!==this.visible&&this.update({visible:l??!this.visible},p,void 0,!1)}slice(l,p,y){let T=this.series;Hu(y,T.chart),p=hy(p,!0),this.sliced=this.options.sliced=l=Um(l)?l:!this.sliced,T.options.data[T.data.indexOf(this)]=this.options,this.graphic&&this.graphic.animate(this.getTranslate())}}ay(Lg.prototype,{connectorShapes:{fixedOffset:function(q,l,p){let y=l.breakAt,T=l.touchingSliceAt,A=p.softConnector?["C",q.x+(q.alignment==="left"?-5:5),q.y,2*y.x-T.x,2*y.y-T.y,y.x,y.y]:["L",y.x,y.y];return[["M",q.x,q.y],A,["L",T.x,T.y]]},straight:function(q,l){let p=l.touchingSliceAt;return[["M",q.x,q.y],["L",p.x,p.y]]},crookedLine:function(q,l,p){let{angle:y=this.angle||0,breakAt:T,touchingSliceAt:A}=l,{series:P}=this,[I,B,X]=P.center,re=X/2,{plotLeft:te,plotWidth:pe}=P.chart,_e=q.alignment==="left",{x:Ee,y:De}=q,Re=T.x;if(p.crookDistance){let Ze=yx(p.crookDistance,1);Re=_e?I+re+(pe+te-I-re)*(1-Ze):te+(I-re)*Ze}else Re=I+(B-De)*Math.tan(y-Math.PI/2);let Be=[["M",Ee,De]];return(_e?Re<=Ee&&Re>=T.x:Re>=Ee&&Re<=T.x)&&Be.push(["L",Re,De]),Be.push(["L",T.x,T.y],["L",A.x,A.y]),Be}}});let{getStartAndEndRadians:xx}=xu,{noop:mm}=pi,{clamp:Ny,extend:cc,fireEvent:gm,merge:cy,pick:_x}=Ps;class jm extends Vo{animate(l){let p=this,y=p.points,T=p.startAngleRad;l||y.forEach(function(A){let P=A.graphic,I=A.shapeArgs;P&&I&&(P.attr({r:_x(A.startR,p.center&&p.center[3]/2),start:T,end:T}),P.animate({r:I.r,start:I.start,end:I.end},p.options.animation))})}drawEmpty(){let l,p,y=this.startAngleRad,T=this.endAngleRad,A=this.options;this.total===0&&this.center?(l=this.center[0],p=this.center[1],this.graph||(this.graph=this.chart.renderer.arc(l,p,this.center[1]/2,0,y,T).addClass("highcharts-empty-series").add(this.group)),this.graph.attr({d:gc.arc(l,p,this.center[2]/2,0,{start:y,end:T,innerR:this.center[3]/2})}),this.chart.styledMode||this.graph.attr({"stroke-width":A.borderWidth,fill:A.fillColor||"none",stroke:A.color||"#cccccc"})):this.graph&&(this.graph=this.graph.destroy())}drawPoints(){let l=this.chart.renderer;this.points.forEach(function(p){p.graphic&&p.hasNewShapeType()&&(p.graphic=p.graphic.destroy()),p.graphic||(p.graphic=l[p.shapeType](p.shapeArgs).add(p.series.group),p.delayedRendering=!0)})}generatePoints(){super.generatePoints(),this.updateTotals()}getX(l,p,y,T){let A=this.center,P=this.radii?this.radii[y.index]||0:A[2]/2,I=T.dataLabelPosition,B=(I==null?void 0:I.distance)||0,X=Math.asin(Ny((l-A[1])/(P+B),-1,1));return A[0]+Math.cos(X)*(P+B)*(p?-1:1)+(B>0?(p?-1:1)*(T.padding||0):0)}hasData(){return!!this.dataTable.rowCount}redrawPoints(){let l,p,y,T,A=this,P=A.chart;this.drawEmpty(),A.group&&!P.styledMode&&A.group.shadow(A.options.shadow),A.points.forEach(function(I){let B={};p=I.graphic,!I.isNull&&p?(T=I.shapeArgs,l=I.getTranslate(),P.styledMode||(y=A.pointAttribs(I,I.selected&&"select")),I.delayedRendering?(p.setRadialReference(A.center).attr(T).attr(l),P.styledMode||p.attr(y).attr({"stroke-linejoin":"round"}),I.delayedRendering=!1):(p.setRadialReference(A.center),P.styledMode||cy(!0,B,y),cy(!0,B,T,l),p.animate(B)),p.attr({visibility:I.visible?"inherit":"hidden"}),p.addClass(I.getClassName(),!0)):p&&(I.graphic=p.destroy())})}sortByAngle(l,p){l.sort(function(y,T){return y.angle!==void 0&&(T.angle-y.angle)*p})}translate(l){gm(this,"translate"),this.generatePoints();let p=this.options,y=p.slicedOffset,T=xx(p.startAngle,p.endAngle),A=this.startAngleRad=T.start,P=(this.endAngleRad=T.end)-A,I=this.points,B=p.ignoreHiddenPoint,X=I.length,re,te,pe,_e,Ee,De,Re,Be=0;for(l||(this.center=l=this.getCenter()),De=0;De<X;De++){Re=I[De],re=A+Be*P,Re.isValid()&&(!B||Re.visible)&&(Be+=Re.percentage/100),te=A+Be*P;let Ze={x:l[0],y:l[1],r:l[2]/2,innerR:l[3]/2,start:Math.round(1e3*re)/1e3,end:Math.round(1e3*te)/1e3};Re.shapeType="arc",Re.shapeArgs=Ze,(pe=(te+re)/2)>1.5*Math.PI?pe-=2*Math.PI:pe<-Math.PI/2&&(pe+=2*Math.PI),Re.slicedTranslation={translateX:Math.round(Math.cos(pe)*y),translateY:Math.round(Math.sin(pe)*y)},_e=Math.cos(pe)*l[2]/2,Ee=Math.sin(pe)*l[2]/2,Re.tooltipPos=[l[0]+.7*_e,l[1]+.7*Ee],Re.half=+(pe<-Math.PI/2||pe>Math.PI/2),Re.angle=pe}gm(this,"afterTranslate")}updateTotals(){let l=this.points,p=l.length,y=this.options.ignoreHiddenPoint,T,A,P=0;for(T=0;T<p;T++)(A=l[T]).isValid()&&(!y||A.visible)&&(P+=A.y);for(T=0,this.total=P;T<p;T++)(A=l[T]).percentage=P>0&&(A.visible||!y)?A.y/P*100:0,A.total=P}}jm.defaultOptions=cy(Vo.defaultOptions,{borderRadius:3,center:[null,null],clip:!1,colorByPoint:!0,dataLabels:{connectorPadding:5,connectorShape:"crookedLine",crookDistance:void 0,distance:30,enabled:!0,formatter:function(){return this.isNull?void 0:this.name},softConnector:!0,x:0},fillColor:void 0,ignoreHiddenPoint:!0,inactiveOtherPoints:!0,legendType:"point",marker:null,size:null,showInLegend:!1,slicedOffset:10,stickyTracking:!1,tooltip:{followPointer:!0},borderColor:"#ffffff",borderWidth:1,lineWidth:void 0,states:{hover:{brightness:.1}}}),cc(jm.prototype,{axisTypes:[],directTouch:!0,drawGraph:void 0,drawTracker:zr.prototype.drawTracker,getCenter:xu.getCenter,getSymbol:mm,invertible:!1,isCartesian:!1,noSharedTooltip:!0,pointAttribs:zr.prototype.pointAttribs,pointClass:Lg,requireSorting:!1,searchPoint:mm,trackerGroups:["group","dataLabelsGroup"]}),oo.registerSeriesType("pie",jm);let{composed:Vy,noop:Uy}=pi,{distribute:gg}=kh,{series:vx}=oo,{arrayMax:bx,clamp:wx,defined:yg,pick:Ip,pushUnique:rf,relativeLength:dy}=Ps;(function(q){let l={radialDistributionY:function(P,I){var B;return(((B=I.dataLabelPosition)==null?void 0:B.top)||0)+P.distributeBox.pos},radialDistributionX:function(P,I,B,X,re){let te=re.dataLabelPosition;return P.getX(B<((te==null?void 0:te.top)||0)+2||B>((te==null?void 0:te.bottom)||0)-2?X:B,I.half,I,re)},justify:function(P,I,B,X){var re;return X[0]+(P.half?-1:1)*(B+(((re=I.dataLabelPosition)==null?void 0:re.distance)||0))},alignToPlotEdges:function(P,I,B,X){let re=P.getBBox().width;return I?re+X:B-re-X},alignToConnectors:function(P,I,B,X){let re=0,te;return P.forEach(function(pe){(te=pe.dataLabel.getBBox().width)>re&&(re=te)}),I?re+X:B-re-X}};function p(P,I){let B=Math.PI/2,{start:X=0,end:re=0}=P.shapeArgs||{},te=P.angle||0;I>0&&X<B&&re>B&&te>B/2&&te<1.5*B&&(te=te<=B?Math.max(B/2,(X+B)/2):Math.min(1.5*B,(B+re)/2));let{center:pe,options:_e}=this,Ee=pe[2]/2,De=Math.cos(te),Re=Math.sin(te),Be=pe[0]+De*Ee,Ze=pe[1]+Re*Ee,rt=Math.min((_e.slicedOffset||0)+(_e.borderWidth||0),I/5);return{natural:{x:Be+De*I,y:Ze+Re*I},computed:{},alignment:I<0?"center":P.half?"right":"left",connectorPosition:{angle:te,breakAt:{x:Be+De*rt,y:Ze+Re*rt},touchingSliceAt:{x:Be,y:Ze}},distance:I}}function y(){var Ci;let P=this,I=P.points,B=P.chart,X=B.plotWidth,re=B.plotHeight,te=B.plotLeft,pe=Math.round(B.chartWidth/3),_e=P.center,Ee=_e[2]/2,De=_e[1],Re=[[],[]],Be=[0,0,0,0],Ze=P.dataLabelPositioners,rt,Yt,Ut,Xt=0;P.visible&&((Ci=P.hasDataLabels)!=null&&Ci.call(P))&&(I.forEach(di=>{(di.dataLabels||[]).forEach(vi=>{vi.shortened&&(vi.attr({width:"auto"}).css({width:"auto",textOverflow:"clip"}),vi.shortened=!1)})}),vx.prototype.drawDataLabels.apply(P),I.forEach(di=>{(di.dataLabels||[]).forEach((vi,es)=>{var kr;let ws=_e[2]/2,As=vi.options,$s=dy((As==null?void 0:As.distance)||0,ws);es===0&&Re[di.half].push(di),!yg((kr=As==null?void 0:As.style)==null?void 0:kr.width)&&vi.getBBox().width>pe&&(vi.css({width:Math.round(.7*pe)+"px"}),vi.shortened=!0),vi.dataLabelPosition=this.getDataLabelPosition(di,$s),Xt=Math.max(Xt,$s)})}),Re.forEach((di,vi)=>{let es=di.length,ws=[],As,$s,kr=0,pr;es&&(P.sortByAngle(di,vi-.5),Xt>0&&(As=Math.max(0,De-Ee-Xt),$s=Math.min(De+Ee+Xt,B.plotHeight),di.forEach(Vr=>{(Vr.dataLabels||[]).forEach(cr=>{var Cn;let Zr=cr.dataLabelPosition;Zr&&Zr.distance>0&&(Zr.top=Math.max(0,De-Ee-Zr.distance),Zr.bottom=Math.min(De+Ee+Zr.distance,B.plotHeight),kr=cr.getBBox().height||21,cr.lineHeight=B.renderer.fontMetrics(cr.text||cr).h+2*cr.padding,Vr.distributeBox={target:(((Cn=cr.dataLabelPosition)==null?void 0:Cn.natural.y)||0)-Zr.top+cr.lineHeight/2,size:kr,rank:Vr.y},ws.push(Vr.distributeBox))})}),gg(ws,pr=$s+kr-As,pr/5)),di.forEach(Vr=>{(Vr.dataLabels||[]).forEach(cr=>{let Zr=cr.options||{},Cn=Vr.distributeBox,Qo=cr.dataLabelPosition,en=(Qo==null?void 0:Qo.natural.y)||0,uc=Zr.connectorPadding||0,gn=cr.lineHeight||21,va=(gn-cr.getBBox().height)/2,Fo=0,Ao=en,oh="inherit";if(Qo){if(ws&&yg(Cn)&&Qo.distance>0&&(Cn.pos===void 0?oh="hidden":(Ut=Cn.size,Ao=Ze.radialDistributionY(Vr,cr))),Zr.justify)Fo=Ze.justify(Vr,cr,Ee,_e);else switch(Zr.alignTo){case"connectors":Fo=Ze.alignToConnectors(di,vi,X,te);break;case"plotEdges":Fo=Ze.alignToPlotEdges(cr,vi,X,te);break;default:Fo=Ze.radialDistributionX(P,Vr,Ao-va,en,cr)}if(Qo.attribs={visibility:oh,align:Qo.alignment},Qo.posAttribs={x:Fo+(Zr.x||0)+({left:uc,right:-uc}[Qo.alignment]||0),y:Ao+(Zr.y||0)-gn/2},Qo.computed.x=Fo,Qo.computed.y=Ao-va,Ip(Zr.crop,!0)){let Ya;Fo-(Yt=cr.getBBox().width)<uc&&vi===1?(Ya=Math.round(Yt-Fo+uc),Be[3]=Math.max(Ya,Be[3])):Fo+Yt>X-uc&&vi===0&&(Ya=Math.round(Fo+Yt-X+uc),Be[1]=Math.max(Ya,Be[1])),Ao-Ut/2<0?Be[0]=Math.max(Math.round(-Ao+Ut/2),Be[0]):Ao+Ut/2>re&&(Be[2]=Math.max(Math.round(Ao+Ut/2-re),Be[2])),Qo.sideOverflow=Ya}}})}))}),(bx(Be)===0||this.verifyDataLabelOverflow(Be))&&(this.placeDataLabels(),this.points.forEach(di=>{(di.dataLabels||[]).forEach(vi=>{var $s;let{connectorColor:es,connectorWidth:ws=1}=vi.options||{},As=vi.dataLabelPosition;if(ws){let kr;rt=vi.connector,As&&As.distance>0?(kr=!rt,rt||(vi.connector=rt=B.renderer.path().addClass("highcharts-data-label-connector  highcharts-color-"+di.colorIndex+(di.className?" "+di.className:"")).add(P.dataLabelsGroup)),B.styledMode||rt.attr({"stroke-width":ws,stroke:es||di.color||"#666666"}),rt[kr?"attr":"animate"]({d:di.getConnectorPath(vi)}),rt.attr({visibility:($s=As.attribs)==null?void 0:$s.visibility})):rt&&(vi.connector=rt.destroy())}})})))}function T(){this.points.forEach(P=>{(P.dataLabels||[]).forEach(I=>{var X,re;let B=I.dataLabelPosition;B?(B.sideOverflow&&(I.css({width:Math.max(I.getBBox().width-B.sideOverflow,0)+"px",textOverflow:((re=(X=I.options)==null?void 0:X.style)==null?void 0:re.textOverflow)||"ellipsis"}),I.shortened=!0),I.attr(B.attribs),I[I.moved?"animate":"attr"](B.posAttribs),I.moved=!0):I&&I.attr({y:-9999})}),delete P.distributeBox},this)}function A(P){let I=this.center,B=this.options,X=B.center,re=B.minSize||80,te=re,pe=B.size!==null;return!pe&&(X[0]!==null?te=Math.max(I[2]-Math.max(P[1],P[3]),re):(te=Math.max(I[2]-P[1]-P[3],re),I[0]+=(P[3]-P[1])/2),X[1]!==null?te=wx(te,re,I[2]-Math.max(P[0],P[2])):(te=wx(te,re,I[2]-P[0]-P[2]),I[1]+=(P[0]-P[2])/2),te<I[2]?(I[2]=te,I[3]=Math.min(B.thickness?Math.max(0,te-2*B.thickness):Math.max(0,dy(B.innerSize||0,te)),te),this.translate(I),this.drawDataLabels&&this.drawDataLabels()):pe=!0),pe}q.compose=function(P){if(sn.compose(vx),rf(Vy,"PieDataLabel")){let I=P.prototype;I.dataLabelPositioners=l,I.alignDataLabel=Uy,I.drawDataLabels=y,I.getDataLabelPosition=p,I.placeDataLabels=T,I.verifyDataLabelOverflow=A}}})(ir||(ir={}));let jy=ir;(function(q){q.getCenterOfPoints=function(l){let p=l.reduce((y,T)=>(y.x+=T.x,y.y+=T.y,y),{x:0,y:0});return{x:p.x/l.length,y:p.y/l.length}},q.getDistanceBetweenPoints=function(l,p){return Math.sqrt(Math.pow(p.x-l.x,2)+Math.pow(p.y-l.y,2))},q.getAngleBetweenPoints=function(l,p){return Math.atan2(p.x-l.x,p.y-l.y)},q.pointInPolygon=function({x:l,y:p},y){let T=y.length,A,P,I=!1;for(A=0,P=T-1;A<T;P=A++){let[B,X]=y[A],[re,te]=y[P];X>p!=te>p&&l<(re-B)*(p-X)/(te-X)+B&&(I=!I)}return I}})(fr||(fr={}));let Og=fr,{pointInPolygon:Dg}=Og,{addEvent:zg,getAlignFactor:Rg,fireEvent:uy,objectEach:Bg,pick:Fg}=Ps;function py(q){let l=q.length,p=(re,te)=>!(te.x>=re.x+re.width||te.x+te.width<=re.x||te.y>=re.y+re.height||te.y+te.height<=re.y),y=(re,te)=>{for(let pe of re)if(Dg({x:pe[0],y:pe[1]},te))return!0;return!1},T,A,P,I,B,X=!1;for(let re=0;re<l;re++)(T=q[re])&&(T.oldOpacity=T.opacity,T.newOpacity=1,T.absoluteBox=function(te){var pe,_e;if(te&&(!te.alignAttr||te.placed)){let Ee=te.box?0:te.padding||0,De=te.alignAttr||{x:te.attr("x"),y:te.attr("y")},{height:Re,polygon:Be,width:Ze}=te.getBBox(),rt=Rg(te.alignValue)*Ze;return te.width=Ze,te.height=Re,{x:De.x+(((pe=te.parentGroup)==null?void 0:pe.translateX)||0)+Ee-rt,y:De.y+(((_e=te.parentGroup)==null?void 0:_e.translateY)||0)+Ee,width:Ze-2*Ee,height:Re-2*Ee,polygon:Be}}}(T));q.sort((re,te)=>(te.labelrank||0)-(re.labelrank||0));for(let re=0;re<l;++re){I=(A=q[re])&&A.absoluteBox;let te=I==null?void 0:I.polygon;for(let pe=re+1;pe<l;++pe){B=(P=q[pe])&&P.absoluteBox;let _e=!1;if(I&&B&&A!==P&&A.newOpacity!==0&&P.newOpacity!==0&&A.visibility!=="hidden"&&P.visibility!=="hidden"){let Ee=B.polygon;if(te&&Ee&&te!==Ee?y(te,Ee)&&(_e=!0):p(I,B)&&(_e=!0),_e){let De=A.labelrank<P.labelrank?A:P,Re=De.text;De.newOpacity=0,Re!=null&&Re.element.querySelector("textPath")&&Re.hide()}}}}for(let re of q)Ng(re,this)&&(X=!0);X&&uy(this,"afterHideAllOverlappingLabels")}function Ng(q,l){let p,y=!1;return q&&(p=q.newOpacity,q.oldOpacity!==p&&(q.hasClass("highcharts-data-label")?(q[p?"removeClass":"addClass"]("highcharts-data-label-hidden"),y=!0,q[q.isOld?"animate":"attr"]({opacity:p},void 0,function(){l.styledMode||q.css({pointerEvents:p?"auto":"none"})}),uy(l,"afterHideOverlappingLabel")):q.attr({opacity:p})),q.isOld=!0),y}function Tx(){var p;let q=this,l=[];for(let y of q.labelCollectors||[])l=l.concat(y());for(let y of q.yAxis||[])y.stacking&&y.options.stackLabels&&!y.options.stackLabels.allowOverlap&&Bg(y.stacking.stacks,T=>{Bg(T,A=>{A.label&&l.push(A.label)})});for(let y of q.series||[])if(y.visible&&((p=y.hasDataLabels)!=null&&p.call(y))){let T=A=>{for(let P of A)P.visible&&(P.dataLabels||[]).forEach(I=>{var X;let B=I.options||{};I.labelrank=Fg(B.labelrank,P.labelrank,(X=P.shapeArgs)==null?void 0:X.height),B.allowOverlap??Number(B.distance)>0?(I.oldOpacity=I.opacity,I.newOpacity=1,Ng(I,q)):l.push(I)})};T(y.nodes||[]),T(y.points)}this.hideOverlappingLabels(l)}let Lp={compose:function(q){let l=q.prototype;l.hideOverlappingLabels||(l.hideOverlappingLabels=py,zg(q,"render",Tx))}},{defaultOptions:Gy}=Ra,{noop:Vg}=pi,{addEvent:Wy,extend:fy,isObject:Hy,merge:n_,relativeLength:Ug}=Ps,Sx={radius:0,scope:"stack",where:void 0},my=Vg,Xy=Vg;function jg(q,l,p,y,T={}){let A=my(q,l,p,y,T),{innerR:P=0,r:I=p,start:B=0,end:X=0}=T;if(T.open||!T.borderRadius)return A;let re=X-B,te=Math.sin(re/2),pe=Math.max(Math.min(Ug(T.borderRadius||0,I-P),(I-P)/2,I*te/(1+te)),0),_e=Math.min(pe,re/Math.PI*2*P),Ee=A.length-1;for(;Ee--;)(function(De,Re,Be){let Ze,rt,Yt,Ut=De[Re],Xt=De[Re+1];if(Xt[0]==="Z"&&(Xt=De[0]),(Ut[0]==="M"||Ut[0]==="L")&&Xt[0]==="A"?(Ze=Ut,rt=Xt,Yt=!0):Ut[0]==="A"&&(Xt[0]==="M"||Xt[0]==="L")&&(Ze=Xt,rt=Ut),Ze&&rt&&rt.params){let Ci=rt[1],di=rt[5],vi=rt.params,{start:es,end:ws,cx:As,cy:$s}=vi,kr=di?Ci-Be:Ci+Be,pr=kr?Math.asin(Be/kr):0,Vr=di?pr:-pr,cr=Math.cos(pr)*kr;Yt?(vi.start=es+Vr,Ze[1]=As+cr*Math.cos(es),Ze[2]=$s+cr*Math.sin(es),De.splice(Re+1,0,["A",Be,Be,0,0,1,As+Ci*Math.cos(vi.start),$s+Ci*Math.sin(vi.start)])):(vi.end=ws-Vr,rt[6]=As+Ci*Math.cos(vi.end),rt[7]=$s+Ci*Math.sin(vi.end),De.splice(Re+1,0,["A",Be,Be,0,0,1,As+cr*Math.cos(ws),$s+cr*Math.sin(ws)])),rt[4]=Math.abs(vi.end-vi.start)<Math.PI?0:1}})(A,Ee,Ee>1?_e:pe);return A}function Mx(){var q,l;if(this.options.borderRadius&&!(this.chart.is3d&&this.chart.is3d())){let{options:p,yAxis:y}=this,T=p.stacking==="percent",A=(l=(q=Gy.plotOptions)==null?void 0:q[this.type])==null?void 0:l.borderRadius,P=gy(p.borderRadius,Hy(A)?A:{}),I=y.options.reversed;for(let B of this.points){let{shapeArgs:X}=B;if(B.shapeType==="roundedRect"&&X){let{width:re=0,height:te=0,y:pe=0}=X,_e=pe,Ee=te;if(P.scope==="stack"&&B.stackTotal){let Ze=y.translate(T?100:B.stackTotal,!1,!0,!1,!0),rt=y.translate(p.threshold||0,!1,!0,!1,!0),Yt=this.crispCol(0,Math.min(Ze,rt),0,Math.abs(Ze-rt));_e=Yt.y,Ee=Yt.height}let De=(B.negative?-1:1)*(I?-1:1)==-1,Re=P.where;!Re&&this.is("waterfall")&&Math.abs((B.yBottom||0)-(this.translatedThreshold||0))>this.borderWidth&&(Re="all"),Re||(Re="end");let Be=Math.min(Ug(P.radius,re),re/2,Re==="all"?te/2:1/0)||0;Re==="end"&&(De&&(_e-=Be),Ee+=Be),fy(X,{brBoxHeight:Ee,brBoxY:_e,r:Be})}}}}function gy(q,l){return Hy(q)||(q={radius:q||0}),n_(Sx,l,q)}function Ax(){let q=gy(this.options.borderRadius);for(let l of this.points){let p=l.shapeArgs;p&&(p.borderRadius=Ug(q.radius,(p.r||0)-(p.innerR||0)))}}function Gg(q,l,p,y,T={}){let A=Xy(q,l,p,y,T),{r:P=0,brBoxHeight:I=y,brBoxY:B=l}=T,X=l-B,re=B+I-(l+y),te=X-P>-.1?0:P,pe=re-P>-.1?0:P,_e=Math.max(te&&X,0),Ee=Math.max(pe&&re,0),De=[q+te,l],Re=[q+p-te,l],Be=[q+p,l+te],Ze=[q+p,l+y-pe],rt=[q+p-pe,l+y],Yt=[q+pe,l+y],Ut=[q,l+y-pe],Xt=[q,l+te],Ci=(di,vi)=>Math.sqrt(Math.pow(di,2)-Math.pow(vi,2));if(_e){let di=Ci(te,te-_e);De[0]-=di,Re[0]+=di,Be[1]=Xt[1]=l+te-_e}if(y<te-_e){let di=Ci(te,te-_e-y);Be[0]=Ze[0]=q+p-te+di,rt[0]=Math.min(Be[0],rt[0]),Yt[0]=Math.max(Ze[0],Yt[0]),Ut[0]=Xt[0]=q+te-di,Be[1]=Xt[1]=l+y}if(Ee){let di=Ci(pe,pe-Ee);rt[0]+=di,Yt[0]-=di,Ze[1]=Ut[1]=l+y-pe+Ee}if(y<pe-Ee){let di=Ci(pe,pe-Ee-y);Be[0]=Ze[0]=q+p-pe+di,Re[0]=Math.min(Be[0],Re[0]),De[0]=Math.max(Ze[0],De[0]),Ut[0]=Xt[0]=q+pe-di,Ze[1]=Ut[1]=l}return A.length=0,A.push(["M",...De],["L",...Re],["A",te,te,0,0,1,...Be],["L",...Ze],["A",pe,pe,0,0,1,...rt],["L",...Yt],["A",pe,pe,0,0,1,...Ut],["L",...Xt],["A",te,te,0,0,1,...De],["Z"]),A}let{diffObjects:he,extend:u,find:v,merge:M,pick:z,uniqueKey:F}=Ps;(function(q){function l(y,T){let A=y.condition;(A.callback||function(){return this.chartWidth<=z(A.maxWidth,Number.MAX_VALUE)&&this.chartHeight<=z(A.maxHeight,Number.MAX_VALUE)&&this.chartWidth>=z(A.minWidth,0)&&this.chartHeight>=z(A.minHeight,0)}).call(this)&&T.push(y._id)}function p(y,T){let A=this.options.responsive,P=this.currentResponsive,I=[],B;!T&&A&&A.rules&&A.rules.forEach(te=>{te._id===void 0&&(te._id=F()),this.matchResponsiveRule(te,I)},this);let X=M(...I.map(te=>v((A==null?void 0:A.rules)||[],pe=>pe._id===te)).map(te=>te==null?void 0:te.chartOptions));X.isResponsiveOptions=!0,I=I.toString()||void 0;let re=P==null?void 0:P.ruleIds;I!==re&&(P&&(this.currentResponsive=void 0,this.updatingResponsive=!0,this.update(P.undoOptions,y,!0),this.updatingResponsive=!1),I?((B=he(X,this.options,!0,this.collectionsWithUpdate)).isResponsiveOptions=!0,this.currentResponsive={ruleIds:I,mergedOptions:X,undoOptions:B},this.updatingResponsive||this.update(X,y,!0)):this.currentResponsive=void 0)}q.compose=function(y){let T=y.prototype;return T.matchResponsiveRule||u(T,{matchResponsiveRule:l,setResponsive:p}),y}})(wo||(wo={}));let V=wo;pi.AST=Gn,pi.Axis=Lu,pi.Chart=pu,pi.Color=at,pi.DataLabel=sn,pi.DataTableCore=Jo,pi.Fx=gi,pi.HTMLElement=tu,pi.Legend=du,pi.LegendSymbol=ta,pi.OverlappingDataLabels=pi.OverlappingDataLabels||Lp,pi.PlotLineOrBand=ep,pi.Point=je,pi.Pointer=Es,pi.RendererRegistry=Xd,pi.Series=Vo,pi.SeriesRegistry=oo,pi.StackItem=t,pi.SVGElement=js,pi.SVGRenderer=Bc,pi.Templating=fa,pi.Tick=Pu,pi.Time=Za,pi.Tooltip=lc,pi.animate=to.animate,pi.animObject=to.animObject,pi.chart=pu.chart,pi.color=at.parse,pi.dateFormat=fa.dateFormat,pi.defaultOptions=Ra.defaultOptions,pi.distribute=kh.distribute,pi.format=fa.format,pi.getDeferredAnimation=to.getDeferredAnimation,pi.getOptions=Ra.getOptions,pi.numberFormat=fa.numberFormat,pi.seriesType=oo.seriesType,pi.setAnimation=to.setAnimation,pi.setOptions=Ra.setOptions,pi.stop=to.stop,pi.time=Ra.defaultTime,pi.timers=gi.timers,{compose:function(q,l,p){let y=q.types.pie;if(!l.symbolCustomAttribs.includes("borderRadius")){let T=p.prototype.symbols;Wy(q,"afterColumnTranslate",Mx,{order:9}),Wy(y,"afterTranslate",Ax),l.symbolCustomAttribs.push("borderRadius","brBoxHeight","brBoxY"),my=T.arc,Xy=T.roundedRect,T.arc=jg,T.roundedRect=Gg}},optionsToObject:gy}.compose(pi.Series,pi.SVGElement,pi.SVGRenderer),gu.compose(pi.Series.types.column),sn.compose(pi.Series),Cm.compose(pi.Axis),tu.compose(pi.SVGRenderer),du.compose(pi.Chart),gf.compose(pi.Axis),Lp.compose(pi.Chart),jy.compose(pi.Series.types.pie),ep.compose(pi.Chart,pi.Axis),Es.compose(pi.Chart),V.compose(pi.Chart),Cp.compose(pi.Axis,pi.Chart,pi.Series),kt.compose(pi.Axis,pi.Chart,pi.Series),lc.compose(pi.Pointer),Ps.extend(pi,Ps);let{parse:G}=at,{addEvent:Q,extend:le,merge:ye,pick:ce,splat:we}=Ps;(function(q){let l;function p(){let{userOptions:pe}=this;this.colorAxis=[],pe.colorAxis&&(pe.colorAxis=we(pe.colorAxis),pe.colorAxis.map(_e=>new l(this,_e)))}function y(pe){let _e=this.chart.colorAxis||[],Ee=Ze=>{let rt=pe.allItems.indexOf(Ze);rt!==-1&&(this.destroyItem(pe.allItems[rt]),pe.allItems.splice(rt,1))},De=[],Re,Be;for(_e.forEach(function(Ze){Re=Ze.options,Re!=null&&Re.showInLegend&&(Re.dataClasses&&Re.visible?De=De.concat(Ze.getDataClassLegendSymbols()):Re.visible&&De.push(Ze),Ze.series.forEach(function(rt){(!rt.options.showInLegend||Re.dataClasses)&&(rt.options.legendType==="point"?rt.points.forEach(function(Yt){Ee(Yt)}):Ee(rt))}))}),Be=De.length;Be--;)pe.allItems.unshift(De[Be])}function T(pe){pe.visible&&pe.item.legendColor&&pe.item.legendItem.symbol.attr({fill:pe.item.legendColor})}function A(pe){var _e;(_e=this.chart.colorAxis)==null||_e.forEach(Ee=>{Ee.update({},pe.redraw)})}function P(){var pe;((pe=this.chart.colorAxis)!=null&&pe.length||this.colorAttribs)&&this.translateColors()}function I(){let pe=this.axisTypes;pe?pe.indexOf("colorAxis")===-1&&pe.push("colorAxis"):this.axisTypes=["colorAxis"]}function B(pe){let _e=this,Ee=pe?"show":"hide";_e.visible=_e.options.visible=!!pe,["graphic","dataLabel"].forEach(function(De){_e[De]&&_e[De][Ee]()}),this.series.buildKDTree()}function X(){let pe=this,_e=this.getPointsCollection(),Ee=this.options.nullColor,De=this.colorAxis,Re=this.colorKey;_e.forEach(Be=>{let Ze=Be.getNestedProperty(Re),rt=Be.options.color||(Be.isNull||Be.value===null?Ee:De&&Ze!==void 0?De.toColor(Ze,Be):Be.color||pe.color);rt&&Be.color!==rt&&(Be.color=rt,pe.options.legendType==="point"&&Be.legendItem&&Be.legendItem.label&&pe.chart.legend.colorizeItem(Be,Be.visible))})}function re(){this.elem.attr("fill",G(this.start).tweenTo(G(this.end),this.pos),void 0,!0)}function te(){this.elem.attr("stroke",G(this.start).tweenTo(G(this.end),this.pos),void 0,!0)}q.compose=function(pe,_e,Ee,De,Re){let Be=_e.prototype,Ze=Ee.prototype,rt=Re.prototype;Be.collectionsWithUpdate.includes("colorAxis")||(l=pe,Be.collectionsWithUpdate.push("colorAxis"),Be.collectionsWithInit.colorAxis=[Be.addColorAxis],Q(_e,"afterCreateAxes",p),function(Yt){let Ut=Yt.prototype.createAxis;Yt.prototype.createAxis=function(Xt,Ci){if(Xt!=="colorAxis")return Ut.apply(this,arguments);let di=new l(this,ye(Ci.axis,{index:this[Xt].length,isX:!1}));return this.isDirtyLegend=!0,this.axes.forEach(vi=>{vi.series=[]}),this.series.forEach(vi=>{vi.bindAxes(),vi.isDirtyData=!0}),ce(Ci.redraw,!0)&&this.redraw(Ci.animation),di}}(_e),Ze.fillSetter=re,Ze.strokeSetter=te,Q(De,"afterGetAllItems",y),Q(De,"afterColorizeItem",T),Q(De,"afterUpdate",A),le(rt,{optionalAxis:"colorAxis",translateColors:X}),le(rt.pointClass.prototype,{setVisible:B}),Q(Re,"afterTranslate",P,{order:1}),Q(Re,"bindAxes",I))},q.pointSetVisible=B})(rn||(rn={}));let Le=rn,{parse:Ue}=at,{merge:et}=Ps;(function(q){q.initDataClasses=function(l){let p=this.chart,y=this.legendItem=this.legendItem||{},T=this.options,A=l.dataClasses||[],P,I,B=p.options.chart.colorCount,X=0,re;this.dataClasses=I=[],y.labels=[];for(let te=0,pe=A.length;te<pe;++te)P=et(P=A[te]),I.push(P),(p.styledMode||!P.color)&&(T.dataClassColor==="category"?(p.styledMode||(B=(re=p.options.colors||[]).length,P.color=re[X]),P.colorIndex=X,++X===B&&(X=0)):P.color=Ue(T.minColor).tweenTo(Ue(T.maxColor),pe<2?.5:te/(pe-1)))},q.initStops=function(){let l=this.options,p=this.stops=l.stops||[[0,l.minColor||""],[1,l.maxColor||""]];for(let y=0,T=p.length;y<T;++y)p[y].color=Ue(p[y][1])},q.normalizedValue=function(l){let p=this.max||0,y=this.min||0;return this.logarithmic&&(l=this.logarithmic.log2lin(l)),1-(p-l)/(p-y||1)},q.toColor=function(l,p){let y,T,A,P,I,B,X=this.dataClasses,re=this.stops;if(X){for(B=X.length;B--;)if(T=(I=X[B]).from,A=I.to,(T===void 0||l>=T)&&(A===void 0||l<=A)){P=I.color,p&&(p.dataClass=B,p.colorIndex=I.colorIndex);break}}else{for(y=this.normalizedValue(l),B=re.length;B--&&!(y>re[B][0]););T=re[B]||re[B+1],y=1-((A=re[B+1]||T)[0]-y)/(A[0]-T[0]||1),P=T.color.tweenTo(A.color,y)}return P}})(Pi||(Pi={}));let tt=Pi,{defaultOptions:$e}=Ra,{series:ht}=oo,{defined:yt,extend:ci,fireEvent:ii,isArray:ri,isNumber:Ri,merge:ki,pick:Li,relativeLength:ls}=Ps;$e.colorAxis=ki($e.xAxis,{lineWidth:0,minPadding:0,maxPadding:0,gridLineColor:"#ffffff",gridLineWidth:1,tickPixelInterval:72,startOnTick:!0,endOnTick:!0,offset:0,marker:{animation:{duration:50},width:.01,color:"#999999"},labels:{distance:8,overflow:"justify",rotation:0},minColor:"#e6e9ff",maxColor:"#0022ff",tickLength:5,showInLegend:!0});class vs extends Lu{static compose(l,p,y,T){Le.compose(vs,l,p,y,T)}constructor(l,p){super(l,p),this.coll="colorAxis",this.visible=!0,this.init(l,p)}init(l,p){let y=l.options.legend||{},T=p.layout?p.layout!=="vertical":y.layout!=="vertical";this.side=p.side||T?2:1,this.reversed=p.reversed||!T,this.opposite=!T,super.init(l,p,"colorAxis"),this.userOptions=p,ri(l.userOptions.colorAxis)&&(l.userOptions.colorAxis[this.index]=p),p.dataClasses&&this.initDataClasses(p),this.initStops(),this.horiz=T,this.zoomEnabled=!1}hasData(){return!!(this.tickPositions||[]).length}setTickPositions(){if(!this.dataClasses)return super.setTickPositions()}setOptions(l){let p=ki($e.colorAxis,l,{showEmpty:!1,title:null,visible:this.chart.options.legend.enabled&&l.visible!==!1});super.setOptions(p),this.options.crosshair=this.options.marker}setAxisSize(){var A;let l=this.chart,p=(A=this.legendItem)==null?void 0:A.symbol,{width:y,height:T}=this.getSize();p&&(this.left=+p.attr("x"),this.top=+p.attr("y"),this.width=y=+p.attr("width"),this.height=T=+p.attr("height"),this.right=l.chartWidth-this.left-y,this.bottom=l.chartHeight-this.top-T,this.pos=this.horiz?this.left:this.top),this.len=(this.horiz?y:T)||vs.defaultLegendLength}getOffset(){var y;let l=(y=this.legendItem)==null?void 0:y.group,p=this.chart.axisOffset[this.side];if(l){this.axisParent=l,super.getOffset();let T=this.chart.legend;T.allItems.forEach(function(A){A instanceof vs&&A.drawLegendSymbol(T,A)}),T.render(),this.chart.getMargins(!0),this.chart.series.some(A=>A.isDrilling)||(this.isDirty=!0),this.added||(this.added=!0,this.labelLeft=0,this.labelRight=this.width),this.chart.axisOffset[this.side]=p}}setLegendColor(){let l=this.horiz,p=this.reversed,y=+!!p,T=+!p,A=l?[y,0,T,0]:[0,T,0,y];this.legendColor={linearGradient:{x1:A[0],y1:A[1],x2:A[2],y2:A[3]},stops:this.stops}}drawLegendSymbol(l,p){let y=p.legendItem||{},T=l.padding,A=l.options,P=this.options.labels,I=Li(A.itemDistance,10),B=this.horiz,{width:X,height:re}=this.getSize(),te=Li(A.labelPadding,B?16:30);this.setLegendColor(),y.symbol||(y.symbol=this.chart.renderer.symbol("roundedRect").attr({r:A.symbolRadius??3,zIndex:1}).add(y.group)),y.symbol.attr({x:0,y:(l.baseline||0)-11,width:X,height:re}),y.labelWidth=X+T+(B?I:Li(P.x,P.distance)+(this.maxLabelLength||0)),y.labelHeight=re+T+(B?te:0)}setState(l){this.series.forEach(function(p){p.setState(l)})}setVisible(){}getSeriesExtremes(){let l=this.series,p,y,T,A,P=l.length;for(this.dataMin=1/0,this.dataMax=-1/0;P--;){for(let I of(y=(A=l[P]).colorKey=Li(A.options.colorKey,A.colorKey,A.pointValKey,A.zoneAxis,"y"),T=A[y+"Min"]&&A[y+"Max"],[y,"value","y"]))if((p=A.getColumn(I)).length)break;if(T)A.minColorValue=A[y+"Min"],A.maxColorValue=A[y+"Max"];else{let I=ht.prototype.getExtremes.call(A,p);A.minColorValue=I.dataMin,A.maxColorValue=I.dataMax}yt(A.minColorValue)&&yt(A.maxColorValue)&&(this.dataMin=Math.min(this.dataMin,A.minColorValue),this.dataMax=Math.max(this.dataMax,A.maxColorValue)),T||ht.prototype.applyExtremes.call(A)}}drawCrosshair(l,p){let y,T=this.legendItem||{},A=p==null?void 0:p.plotX,P=p==null?void 0:p.plotY,I=this.pos,B=this.len;p&&((y=this.toPixels(p.getNestedProperty(p.series.colorKey)))<I?y=I-2:y>I+B&&(y=I+B+2),p.plotX=y,p.plotY=this.len-y,super.drawCrosshair(l,p),p.plotX=A,p.plotY=P,this.cross&&!this.cross.addedToColorAxis&&T.group&&(this.cross.addClass("highcharts-coloraxis-marker").add(T.group),this.cross.addedToColorAxis=!0,this.chart.styledMode||typeof this.crosshair!="object"||this.cross.attr({fill:this.crosshair.color})))}getPlotLinePath(l){let p=this.left,y=l.translatedValue,T=this.top;return Ri(y)?this.horiz?[["M",y-4,T-6],["L",y+4,T-6],["L",y,T],["Z"]]:[["M",p,y],["L",p-6,y+6],["L",p-6,y-6],["Z"]]:super.getPlotLinePath(l)}update(l,p){var T;let y=this.chart.legend;this.series.forEach(A=>{A.isDirtyData=!0}),(l.dataClasses&&y.allItems||this.dataClasses)&&this.destroyItems(),super.update(l,p),(T=this.legendItem)!=null&&T.label&&(this.setLegendColor(),y.colorizeItem(this,!0))}destroyItems(){let l=this.chart,p=this.legendItem||{};if(p.label)l.legend.destroyItem(this);else if(p.labels)for(let y of p.labels)l.legend.destroyItem(y);l.isDirtyLegend=!0}destroy(){this.chart.isDirtyLegend=!0,this.destroyItems(),super.destroy(...[].slice.call(arguments))}remove(l){this.destroyItems(),super.remove(l)}getDataClassLegendSymbols(){let l,p=this,y=p.chart,T=p.legendItem&&p.legendItem.labels||[],A=y.options.legend,P=Li(A.valueDecimals,-1),I=Li(A.valueSuffix,""),B=X=>p.series.reduce((re,te)=>(re.push(...te.points.filter(pe=>pe.dataClass===X)),re),[]);return T.length||p.dataClasses.forEach((X,re)=>{let te=X.from,pe=X.to,{numberFormatter:_e}=y,Ee=!0;l="",te===void 0?l="< ":pe===void 0&&(l="> "),te!==void 0&&(l+=_e(te,P)+I),te!==void 0&&pe!==void 0&&(l+=" - "),pe!==void 0&&(l+=_e(pe,P)+I),T.push(ci({chart:y,name:l,options:{},drawLegendSymbol:ta.rectangle,visible:!0,isDataClass:!0,setState:De=>{for(let Re of B(re))Re.setState(De)},setVisible:function(){this.visible=Ee=p.visible=!Ee;let De=[];for(let Re of B(re))Re.setVisible(Ee),Re.hiddenInDataClass=!Ee,De.indexOf(Re.series)===-1&&De.push(Re.series);y.legend.colorizeItem(this,Ee),De.forEach(Re=>{ii(Re,"afterDataClassLegendClick")})}},X))}),T}getSize(){let{chart:l,horiz:p}=this,{height:y,width:T}=this.options,{legend:A}=l.options;return{width:Li(yt(T)?ls(T,l.chartWidth):void 0,A==null?void 0:A.symbolWidth,p?vs.defaultLegendLength:12),height:Li(yt(y)?ls(y,l.chartHeight):void 0,A==null?void 0:A.symbolHeight,p?12:vs.defaultLegendLength)}}}vs.defaultLegendLength=200,vs.keepProps=["legendItem"],ci(vs.prototype,tt),Array.prototype.push.apply(Lu.keepProps,vs.keepProps),pi.ColorAxis=pi.ColorAxis||vs,pi.ColorAxis.compose(pi.Chart,pi.Fx,pi.Legend,pi.Series);let Ys={lang:{zoomIn:"Zoom in",zoomOut:"Zoom out"},mapNavigation:{buttonOptions:{alignTo:"plotBox",align:"left",verticalAlign:"top",x:0,width:18,height:18,padding:5,style:{color:"#666666",fontSize:"1em",fontWeight:"bold"},theme:{fill:"#ffffff",stroke:"#e6e6e6","stroke-width":1,"text-align":"center"}},buttons:{zoomIn:{onclick:function(){this.mapZoom(.5)},text:"+",y:0},zoomOut:{onclick:function(){this.mapZoom(2)},text:"-",y:28}},mouseWheelSensitivity:1.1}},{defined:ks,extend:Lr,pick:Cr,wrap:Ur}=Ps;(function(q){let l,p=0;function y(I){let B=this.chart;I=this.normalize(I),B.options.mapNavigation.enableDoubleClickZoomTo?B.pointer.inClass(I.target,"highcharts-tracker")&&B.hoverPoint&&B.hoverPoint.zoomTo():B.isInsidePlot(I.chartX-B.plotLeft,I.chartY-B.plotTop)&&B.mapZoom(.5,void 0,void 0,I.chartX,I.chartY)}function T(I){let B=this.chart,X=ks((I=this.normalize(I)).wheelDelta)&&-I.wheelDelta/120||I.deltaY||I.detail;Math.abs(X)>=1&&(p+=Math.abs(X),l&&clearTimeout(l),l=setTimeout(()=>{p=0},50)),p<10&&B.isInsidePlot(I.chartX-B.plotLeft,I.chartY-B.plotTop)&&B.mapView&&B.mapView.zoomBy(-((B.options.mapNavigation.mouseWheelSensitivity-1)*X),void 0,[I.chartX,I.chartY],!(1>Math.abs(X))&&void 0)}function A(I,B,X){let re=this.chart;if(B=I.call(this,B,X),re&&re.mapView){let te=re.mapView.pixelsToLonLat({x:B.chartX-re.plotLeft,y:B.chartY-re.plotTop});te&&Lr(B,te)}return B}function P(I){let B=this.chart.options.mapNavigation;B&&Cr(B.enableTouchZoom,B.enabled)&&(this.chart.zooming.pinchType="xy"),I.apply(this,[].slice.call(arguments,1))}q.compose=function(I){let B=I.prototype;B.onContainerDblClick||(Lr(B,{onContainerDblClick:y,onContainerMouseWheel:T}),Ur(B,"normalize",A),Ur(B,"zoomOption",P))}})(fo||(fo={}));let nr=fo;function Yr(q,l,p,y,T){if(T){let A=(T==null?void 0:T.r)||0;T.brBoxY=l-A,T.brBoxHeight=y+A}return Qt.roundedRect(q,l,p,y,T)}function En(q,l,p,y,T){if(T){let A=(T==null?void 0:T.r)||0;T.brBoxHeight=y+A}return Qt.roundedRect(q,l,p,y,T)}let Sn={compose:function(q){(Qt=q.prototype.symbols).bottombutton=Yr,Qt.topbutton=En}},{setOptions:Mn}=Ra,{composed:Bh}=pi,{addEvent:$o,extend:Ca,merge:Do,objectEach:go,pick:Al,pushUnique:oa}=Ps;function na(q){var l,p;q&&((l=q.preventDefault)==null||l.call(q),(p=q.stopPropagation)==null||p.call(q),q.cancelBubble=!0)}class ph{static compose(l,p,y){nr.compose(p),Sn.compose(y),oa(Bh,"Map.Navigation")&&($o(l,"beforeRender",function(){this.mapNavigation=new ph(this),this.mapNavigation.update()}),Mn(Ys))}constructor(l){this.chart=l,this.navButtons=[]}update(l){var I;let p=this,y=p.chart,T=p.navButtons,A=function(B){this.handler.call(y,B),na(B)},P=y.options.mapNavigation;for(l&&(P=y.options.mapNavigation=Do(y.options.mapNavigation,l));T.length;)(I=T.pop())==null||I.destroy();if(!y.renderer.forExport&&Al(P.enableButtons,P.enabled)){p.navButtonsGroup||(p.navButtonsGroup=y.renderer.g().attr({zIndex:7}).add()),go(P.buttons,(X,re)=>{var Be;let te={padding:(X=Do(P.buttonOptions,X)).padding};!y.styledMode&&X.theme&&(Ca(te,X.theme),te.style=Do(X.theme.style,X.style));let{text:pe,width:_e=0,height:Ee=0,padding:De=0}=X,Re=y.renderer.button(pe!=="+"&&pe!=="-"&&pe||"",0,0,A,te,void 0,void 0,void 0,re==="zoomIn"?"topbutton":"bottombutton").addClass("highcharts-map-navigation highcharts-"+{zoomIn:"zoom-in",zoomOut:"zoom-out"}[re]).attr({width:_e,height:Ee,title:y.options.lang[re],zIndex:5}).add(p.navButtonsGroup);if(pe==="+"||pe==="-"){let Ze=_e+1,rt=[["M",De+3,De+Ee/2],["L",De+Ze-3,De+Ee/2]];pe==="+"&&rt.push(["M",De+Ze/2,De+3],["L",De+Ze/2,De+Ee-3]),y.renderer.path(rt).addClass("highcharts-button-symbol").attr(y.styledMode?{}:{stroke:(Be=X.style)==null?void 0:Be.color,"stroke-width":3,"stroke-linecap":"round"}).add(Re)}if(Re.handler=X.onclick,$o(Re.element,"dblclick",na),T.push(Re),Ca(X,{width:Re.width,height:2*(Re.height||0)}),y.hasLoaded)Re.align(X,!1,X.alignTo);else{let Ze=$o(y,"load",()=>{Re.element&&Re.align(X,!1,X.alignTo),Ze()})}});let B=(X,re)=>!(re.x>=X.x+X.width||re.x+re.width<=X.x||re.y>=X.y+X.height||re.y+re.height<=X.y);y.hasLoaded||$o(y,"render",function(){var re,te;let X=(te=(re=y.exporting)==null?void 0:re.group)==null?void 0:te.getBBox();if(X){let pe=p.navButtonsGroup.getBBox();if(B(X,pe)){let _e=-pe.y-pe.height+X.y-5,Ee=X.y+X.height-pe.y+5,De=P.buttonOptions&&P.buttonOptions.verticalAlign;p.navButtonsGroup.attr({translateY:De==="bottom"?_e:Ee})}}})}this.updateEvents(P)}updateEvents(l){let p=this.chart;Al(l.enableDoubleClickZoom,l.enabled)||l.enableDoubleClickZoomTo?this.unbindDblClick=this.unbindDblClick||$o(p.container,"dblclick",function(y){p.pointer.onContainerDblClick(y)}):this.unbindDblClick&&(this.unbindDblClick=this.unbindDblClick()),Al(l.enableMouseWheelZoom,l.enabled)?this.unbindMouseWheel=this.unbindMouseWheel||$o(p.container,"wheel",function(y){var T,A;if(!p.pointer.inClass(y.target,"highcharts-no-mousewheel")){let P=(T=p.mapView)==null?void 0:T.zoom;p.pointer.onContainerMouseWheel(y),P!==((A=p.mapView)==null?void 0:A.zoom)&&na(y)}return!1}):this.unbindMouseWheel&&(this.unbindMouseWheel=this.unbindMouseWheel())}}let{column:{prototype:sh}}=oo.seriesTypes,{addEvent:_u,defined:Ec}=Ps;(function(q){function l(p){let y=this.series,T=y.chart.renderer;this.moveToTopOnHover&&this.graphic&&(y.stateMarkerGraphic||(y.stateMarkerGraphic=new js(T,"use").css({pointerEvents:"none"}).add(this.graphic.parentGroup)),(p==null?void 0:p.state)==="hover"?(this.graphic.attr({id:this.id}),y.stateMarkerGraphic.attr({href:`${T.url}#${this.id}`,visibility:"visible"})):y.stateMarkerGraphic.attr({href:""}))}q.pointMembers={dataLabelOnNull:!0,moveToTopOnHover:!0,isValid:function(){return this.value!==null&&this.value!==1/0&&this.value!==-1/0&&(this.value===void 0||!isNaN(this.value))}},q.seriesMembers={colorKey:"value",axisTypes:["xAxis","yAxis","colorAxis"],parallelArrays:["x","y","value"],pointArrayMap:["value"],trackerGroups:["group","markerGroup","dataLabelsGroup"],colorAttribs:function(p){let y={};return Ec(p.color)&&(!p.state||p.state==="normal")&&(y[this.colorProp||"fill"]=p.color),y},pointAttribs:sh.pointAttribs},q.compose=function(p){return _u(p.prototype.pointClass,"afterSetState",l),p}})(pl||(pl={}));let aa=pl,{getOptions:il}=Ra,{isNumber:zf,merge:ym,pick:Op}=Ps;class xm extends pu{init(l,p){let y=il().credits,T=ym({chart:{panning:{enabled:!0,type:"xy"},type:"map"},credits:{mapText:Op(y.mapText,' © <a href="{geojson.copyrightUrl}">{geojson.copyrightShort}</a>'),mapTextFull:Op(y.mapTextFull,"{geojson.copyright}")},mapView:{},tooltip:{followTouchMove:!1}},l);super.init(T,p)}mapZoom(l,p,y,T,A){this.mapView&&(zf(l)&&(l=Math.log(l)/Math.log(.5)),this.mapView.zoomBy(l,zf(p)&&zf(y)?this.mapView.projection.inverse([p,y]):void 0,zf(T)&&zf(A)?[T,A]:void 0))}update(l){var p;l.chart&&"map"in l.chart&&((p=this.mapView)==null||p.recommendMapView(this,[l.chart.map,...(this.options.series||[]).map(y=>y.mapData)],!0)),super.update.apply(this,arguments)}}(function(q){q.maps={},q.mapChart=function(l,p,y){return new q(l,p,y)},q.splitPath=function(l){let p;return p=typeof l=="string"?(l=l.replace(/([A-Z])/gi," $1 ").replace(/^\s*/,"").replace(/\s*$/,"")).split(/[ ,;]+/).map(y=>/[A-Z]/i.test(y)?y:parseFloat(y)):l,Bc.prototype.pathToSegments(p)}})(xm||(xm={}));let yd=xm,Rf={boundsFromPath:function(q){let l=-Number.MAX_VALUE,p=Number.MAX_VALUE,y=-Number.MAX_VALUE,T=Number.MAX_VALUE,A;if(q.forEach(P=>{let I=P[P.length-2],B=P[P.length-1];typeof I=="number"&&typeof B=="number"&&(p=Math.min(p,I),l=Math.max(l,I),T=Math.min(T,B),y=Math.max(y,B),A=!0)}),A)return{x1:p,y1:T,x2:l,y2:y}}},{boundsFromPath:Yy}=Rf,$y=oo.seriesTypes.scatter.prototype.pointClass,{extend:xg,isNumber:Gm,pick:kx}=Ps;class Xu extends $y{static getProjectedPath(l,p){return l.projectedPath||(p&&l.geometry?(p.hasCoordinates=!0,l.projectedPath=p.path(l.geometry)):l.projectedPath=l.path),l.projectedPath||[]}applyOptions(l,p){let y=this.series,T=super.applyOptions(l,p),A=y.joinBy;if(y.mapData&&y.mapMap){let P=A[1],I=super.getNestedProperty(P),B=I!==void 0&&y.mapMap[I];B?xg(T,{...B,name:T.name??B.name}):y.pointArrayMap.indexOf("value")!==-1&&(T.value=T.value||null)}return T}getProjectedBounds(l){let p=Yy(Xu.getProjectedPath(this,l)),y=this.properties,T=this.series.chart.mapView;if(p){let A=y==null?void 0:y["hc-middle-lon"],P=y==null?void 0:y["hc-middle-lat"];if(T&&Gm(A)&&Gm(P)){let I=l.forward([A,P]);p.midX=I[0],p.midY=I[1]}else{let I=y==null?void 0:y["hc-middle-x"],B=y==null?void 0:y["hc-middle-y"];p.midX=p.x1+(p.x2-p.x1)*kx(this.middleX,Gm(I)?I:.5);let X=kx(this.middleY,Gm(B)?B:.5);this.geometry||(X=1-X),p.midY=p.y2-(p.y2-p.y1)*X}return p}}onMouseOver(l){Ps.clearTimeout(this.colorInterval),!this.isNull&&this.visible||this.series.options.nullInteraction?super.onMouseOver.call(this,l):this.series.onMouseOut()}setVisible(l){this.visible=this.options.visible=!!l,this.dataLabel&&this.dataLabel[l?"show":"hide"](),this.graphic&&this.graphic.attr(this.series.pointAttribs(this))}zoomTo(l){let p=this.series.chart,y=p.mapView,T=this.bounds;if(y&&T){let A=Gm(this.insetIndex)&&y.insets[this.insetIndex];if(A){let P=A.projectedUnitsToPixels({x:T.x1,y:T.y1}),I=A.projectedUnitsToPixels({x:T.x2,y:T.y2}),B=y.pixelsToProjectedUnits({x:P.x,y:P.y}),X=y.pixelsToProjectedUnits({x:I.x,y:I.y});T={x1:B.x,y1:B.y,x2:X.x,y2:X.y}}y.fitToBounds(T,void 0,!1),this.series.isDirty=!0,p.redraw(l)}}}xg(Xu.prototype,{dataLabelOnNull:aa.pointMembers.dataLabelOnNull,moveToTopOnHover:aa.pointMembers.moveToTopOnHover,isValid:aa.pointMembers.isValid});let{isNumber:qy}=Ps,R_={center:[0,0],fitToGeometry:void 0,maxZoom:void 0,padding:0,projection:{name:void 0,parallels:void 0,rotation:void 0},zoom:void 0,insetOptions:{borderColor:"#cccccc",borderWidth:1,padding:"10%",relativeTo:"mapBoundingBox",units:"percent"}},{win:B_}=pi,{format:F_}=fa,{error:_g,extend:Ex,merge:N_,wrap:E0}=Ps;(function(q){function l(I){return this.mapView&&this.mapView.lonLatToProjectedUnits(I)}function p(I){return this.mapView&&this.mapView.projectedUnitsToLonLat(I)}function y(I,B){let X=this.options.chart.proj4||B_.proj4;if(!X)return void _g(21,!1,this);let{jsonmarginX:re=0,jsonmarginY:te=0,jsonres:pe=1,scale:_e=1,xoffset:Ee=0,xpan:De=0,yoffset:Re=0,ypan:Be=0}=B,Ze=X(B.crs,[I.lon,I.lat]),rt=B.cosAngle||B.rotation&&Math.cos(B.rotation),Yt=B.sinAngle||B.rotation&&Math.sin(B.rotation),Ut=B.rotation?[Ze[0]*rt+Ze[1]*Yt,-Ze[0]*Yt+Ze[1]*rt]:Ze;return{x:((Ut[0]-Ee)*_e+De)*pe+re,y:-(((Re-Ut[1])*_e+Be)*pe-te)}}function T(I,B){let X=this.options.chart.proj4||B_.proj4;if(!X)return void _g(21,!1,this);if(I.y===null)return;let{jsonmarginX:re=0,jsonmarginY:te=0,jsonres:pe=1,scale:_e=1,xoffset:Ee=0,xpan:De=0,yoffset:Re=0,ypan:Be=0}=B,Ze={x:((I.x-re)/pe-De)/_e+Ee,y:((I.y-te)/pe+Be)/_e+Re},rt=B.cosAngle||B.rotation&&Math.cos(B.rotation),Yt=B.sinAngle||B.rotation&&Math.sin(B.rotation),Ut=X(B.crs,"WGS84",B.rotation?{x:Ze.x*rt+-(Ze.y*Yt),y:Ze.x*Yt+Ze.y*rt}:Ze);return{lat:Ut.y,lon:Ut.x}}function A(I,B){B||(B=Object.keys(I.objects)[0]);let X=I.objects[B];if(X["hc-decoded-geojson"]&&X["hc-decoded-geojson"].title===I.title)return X["hc-decoded-geojson"];let re=I.arcs;if(I.transform){let De,Re,Be,Ze=I.arcs,{scale:rt,translate:Yt}=I.transform;re=[];for(let Ut=0,Xt=Ze.length;Ut<Xt;++Ut){let Ci=Ze[Ut];re.push(De=[]),Re=0,Be=0;for(let di=0,vi=Ci.length;di<vi;++di)De.push([(Re+=Ci[di][0])*rt[0]+Yt[0],(Be+=Ci[di][1])*rt[1]+Yt[1]])}}let te=De=>typeof De[0]=="number"?De.reduce((Re,Be,Ze)=>{let rt=Be<0?re[~Be]:re[Be];return Be<0?(rt=rt.slice(0,Ze===0?rt.length:rt.length-1)).reverse():Ze&&(rt=rt.slice(1)),Re.concat(rt)},[]):De.map(te),pe=X.geometries,_e=[];for(let De=0,Re=pe.length;De<Re;++De)_e.push({type:"Feature",properties:pe[De].properties,geometry:{type:pe[De].type,coordinates:pe[De].coordinates||te(pe[De].arcs)}});let Ee={type:"FeatureCollection",copyright:I.copyright,copyrightShort:I.copyrightShort,copyrightUrl:I.copyrightUrl,features:_e,"hc-recommended-mapview":X["hc-recommended-mapview"],bbox:I.bbox,title:I.title};return X["hc-decoded-geojson"]=Ee,Ee}function P(I,B){B=N_(!0,this.options.credits,B),I.call(this,B),this.credits&&this.mapCreditsFull&&this.credits.attr({title:this.mapCreditsFull})}q.compose=function(I){let B=I.prototype;B.transformFromLatLon||(B.fromLatLonToPoint=l,B.fromPointToLatLon=p,B.transformFromLatLon=y,B.transformToLatLon=T,E0(B,"addCredits",P))},q.geojson=function(I,B="map",X){var _e,Ee;let re=[],te=I.type==="Topology"?A(I):I,pe=te.features;for(let De=0,Re=pe.length;De<Re;++De){let Be,Ze=pe[De],rt=Ze.geometry||{},Yt=rt.type,Ut=rt.coordinates,Xt=Ze.properties;if((B==="map"||B==="mapbubble")&&(Yt==="Polygon"||Yt==="MultiPolygon")||B==="mapline"&&(Yt==="LineString"||Yt==="MultiLineString")?Ut.length&&(Be={geometry:{coordinates:Ut,type:Yt}}):B==="mappoint"&&Yt==="Point"&&Ut.length&&(Be={geometry:{coordinates:Ut,type:Yt}}),Be){let Ci=Xt&&(Xt.name||Xt.NAME),di=Xt&&Xt.lon,vi=Xt&&Xt.lat;re.push(Ex(Be,{lat:typeof vi=="number"?vi:void 0,lon:typeof di=="number"?di:void 0,name:typeof Ci=="string"?Ci:void 0,properties:Xt}))}}return X&&te.copyrightShort&&(X.chart.mapCredits=F_((_e=X.chart.options.credits)==null?void 0:_e.mapText,{geojson:te}),X.chart.mapCreditsFull=F_((Ee=X.chart.options.credits)==null?void 0:Ee.mapTextFull,{geojson:te})),re},q.topo2geo=A})(Cs||(Cs={}));let Wg=Cs;function Hg(q,l,p=!0){let y=l[l.length-1],T,A,P,I=q;for(let B=0;B<l.length;B++){let X=I;T=l[B],I=[],A=p?X[X.length-1]:X[0];for(let re=0;re<X.length;re++)Xg(y,T,P=X[re])?(Xg(y,T,A)||I.push(Yg(y,T,A,P)),I.push(P)):Xg(y,T,A)&&I.push(Yg(y,T,A,P)),A=P;y=T}return I}function Xg(q,l,p){return(l[0]-q[0])*(p[1]-q[1])>(l[1]-q[1])*(p[0]-q[0])}function Yg(q,l,p,y){let T=[q[0]-l[0],q[1]-l[1]],A=[p[0]-y[0],p[1]-y[1]],P=q[0]*l[1]-q[1]*l[0],I=p[0]*y[1]-p[1]*y[0],B=1/(T[0]*A[1]-T[1]*A[0]),X=[(P*A[0]-I*T[0])*B,(P*A[1]-I*T[1])*B];return X.isIntersection=!0,X}let $g=Math.sign||(q=>q===0?0:q>0?1:-1),qg=Math.PI/180,Dp=Math.PI/2,yy=q=>Math.tan((Dp+q)/2),V_=class{constructor(q){let l=(q.parallels||[]).map(P=>P*qg),p=l[0]||0,y=l[1]??p,T=Math.cos(p);typeof q.projectedBounds=="object"&&(this.projectedBounds=q.projectedBounds);let A=p===y?Math.sin(p):Math.log(T/Math.cos(y))/Math.log(yy(y)/yy(p));1e-10>Math.abs(A)&&(A=1e-10*($g(A)||1)),this.n=A,this.c=T*Math.pow(yy(p),A)/A}forward(q){let{c:l,n:p,projectedBounds:y}=this,T=q[0]*qg,A=q[1]*qg;l>0?A<-Dp+1e-6&&(A=-Dp+1e-6):A>Dp-1e-6&&(A=Dp-1e-6);let P=l/Math.pow(yy(A),p),I=P*Math.sin(p*T)*63.78137,B=(l-P*Math.cos(p*T))*63.78137,X=[I,B];return y&&(I<y.x1||I>y.x2||B<y.y1||B>y.y2)&&(X.outside=!0),X}inverse(q){let{c:l,n:p}=this,y=q[0]/63.78137,T=l-q[1]/63.78137,A=$g(p)*Math.sqrt(y*y+T*T),P=Math.atan2(y,Math.abs(T))*$g(T);return T*p<0&&(P-=Math.PI*$g(y)*$g(T)),[P/p/qg,(2*Math.atan(Math.pow(l/A,1/p))-Dp)/qg]}},xy=Math.sqrt(3)/2,xd=class{constructor(){this.bounds={x1:-200.37508342789243,x2:200.37508342789243,y1:-97.52595454902263,y2:97.52595454902263}}forward(q){let l=Math.PI/180,p=Math.asin(xy*Math.sin(q[1]*l)),y=p*p,T=y*y*y;return[q[0]*l*Math.cos(p)*74.03120656864502/(xy*(1.340264+-.24331799999999998*y+T*(.0062510000000000005+.034164*y))),74.03120656864502*p*(1.340264+-.081106*y+T*(893e-6+.003796*y))]}inverse(q){let l=q[0]/74.03120656864502,p=q[1]/74.03120656864502,y=180/Math.PI,T=p,A,P,I,B;for(let te=0;te<12&&(P=(A=T*T)*A*A,I=T*(1.340264+-.081106*A+P*(893e-6+.003796*A))-p,T-=B=I/(1.340264+-.24331799999999998*A+P*(.0062510000000000005+.034164*A)),!(1e-9>Math.abs(B)));++te);P=(A=T*T)*A*A;let X=y*xy*l*(1.340264+-.24331799999999998*A+P*(.0062510000000000005+.034164*A))/Math.cos(T),re=y*Math.asin(Math.sin(T)/xy);return Math.abs(X)>180?[NaN,NaN]:[X,re]}},Cx=Math.PI/4,Wm=Math.PI/180,Zg=class{constructor(){this.bounds={x1:-200.37508342789243,x2:200.37508342789243,y1:-146.91480769173063,y2:146.91480769173063}}forward(q){return[q[0]*Wm*63.78137,79.7267125*Math.log(Math.tan(Cx+.4*q[1]*Wm))]}inverse(q){return[q[0]/63.78137/Wm,2.5*(Math.atan(Math.exp(.8*(q[1]/63.78137)))-Cx)/Wm]}},_y=Math.PI/180,vy=class{constructor(){this.antimeridianCutting=!1,this.bounds={x1:-63.78460826781007,x2:63.78460826781007,y1:-63.78460826781007,y2:63.78460826781007}}forward(q){let l=q[0],p=q[1]*_y,y=[Math.cos(p)*Math.sin(l*_y)*63.78460826781007,63.78460826781007*Math.sin(p)];return(l<-90||l>90)&&(y.outside=!0),y}inverse(q){let l=q[0]/63.78460826781007,p=q[1]/63.78460826781007,y=Math.sqrt(l*l+p*p),T=Math.asin(y),A=Math.sin(T);return[Math.atan2(l*A,y*Math.cos(T))/_y,Math.asin(y&&p*A/y)/_y]}},Px=Math.PI/180,C0=class{constructor(){this.bounds={x1:-200.37508342789243,x2:200.37508342789243,y1:-200.3750834278071,y2:200.3750834278071},this.maxLatitude=85.0511287798}forward(q){let l=Math.sin(q[1]*Px),p=[63.78137*q[0]*Px,63.78137*Math.log((1+l)/(1-l))/2];return Math.abs(q[1])>this.maxLatitude&&(p.outside=!0),p}inverse(q){return[q[0]/(63.78137*Px),(2*Math.atan(Math.exp(q[1]/63.78137))-Math.PI/2)/Px]}},{clipLineString:a_,clipPolygon:l_}={clipLineString:function(q,l){let p=[],y=Hg(q,l,!1);for(let T=1;T<y.length;T++)y[T].isIntersection&&y[T-1].isIntersection&&(p.push(y.splice(0,T)),T=0),T===y.length-1&&p.push(y);return p},clipPolygon:Hg},{clamp:Nd,erase:_m}=Ps,la=2*Math.PI/360,of=q=>(q<-180&&(q+=360),q>180&&(q-=360),q),Kg=q=>(1-Math.cos(q))/2,Zy=(q,l)=>{let p=Math.cos,y=q[1]*la,T=q[0]*la,A=l[1]*la,P=l[0]*la;return Kg(A-y)+p(y)*p(A)*Kg(P-T)};class dc{static add(l,p){dc.registry[l]=p}static distance(l,p){let{atan2:y,sqrt:T}=Math,A=Zy(l,p);return 6371e3*(2*y(T(A),T(1-A)))}static geodesic(l,p,y,T=5e5){let{atan2:A,cos:P,sin:I,sqrt:B}=Math,X=dc.distance,re=l[1]*la,te=l[0]*la,pe=p[1]*la,_e=p[0]*la,Ee=P(re)*P(te),De=P(pe)*P(_e),Re=P(re)*I(te),Be=P(pe)*I(_e),Ze=I(re),rt=I(pe),Yt=X(l,p),Ut=Yt/6371e3,Xt=I(Ut),Ci=Math.round(Yt/T),di=[];if(y&&di.push(l),Ci>1){let vi=1/Ci;for(let es=vi;es<.999;es+=vi){let ws=I((1-es)*Ut)/Xt,As=I(es*Ut)/Xt,$s=ws*Ee+As*De,kr=ws*Re+As*Be,pr=A(ws*Ze+As*rt,B($s*$s+kr*kr)),Vr=A(kr,$s);di.push([Vr/la,pr/la])}}return y&&di.push(p),di}static insertGeodesics(l){let p=l.length-1;for(;p--;)if(Math.max(Math.abs(l[p][0]-l[p+1][0]),Math.abs(l[p][1]-l[p+1][1]))>10){let y=dc.geodesic(l[p],l[p+1]);y.length&&l.splice(p+1,0,...y)}}static toString(l){let{name:p,rotation:y}=l||{};return[p,y&&y.join(",")].join(";")}constructor(l={}){this.hasCoordinates=!1,this.hasGeoProjection=!1,this.maxLatitude=90,this.options=l;let{name:p,projectedBounds:y,rotation:T}=l;this.rotator=T?this.getRotator(T):void 0;let A=p?dc.registry[p]:void 0;A&&(this.def=new A(l));let{def:P,rotator:I}=this;P&&(this.maxLatitude=P.maxLatitude||90,this.hasGeoProjection=!0),I&&P?(this.forward=B=>P.forward(I.forward(B)),this.inverse=B=>I.inverse(P.inverse(B))):P?(this.forward=B=>P.forward(B),this.inverse=B=>P.inverse(B)):I&&(this.forward=I.forward,this.inverse=I.inverse),this.bounds=y==="world"?P&&P.bounds:y}lineIntersectsBounds(l){let{x1:p,x2:y,y1:T,y2:A}=this.bounds||{},P=(X,re,te)=>{let[pe,_e]=X,Ee=+!re;if(typeof te=="number"&&pe[re]>=te!=_e[re]>=te){let De=(te-pe[re])/(_e[re]-pe[re]),Re=pe[Ee]+De*(_e[Ee]-pe[Ee]);return re?[Re,te]:[te,Re]}},I,B=l[0];return((I=P(l,0,p))||(I=P(l,0,y)))&&(B=I,l[1]=I),((I=P(l,1,T))||(I=P(l,1,A)))&&(B=I),B}getRotator(l){let p=l[0]*la,y=(l[1]||0)*la,T=(l[2]||0)*la,A=Math.cos(y),P=Math.sin(y),I=Math.cos(T),B=Math.sin(T);if(p!==0||y!==0||T!==0)return{forward:X=>{let re=X[0]*la+p,te=X[1]*la,pe=Math.cos(te),_e=Math.cos(re)*pe,Ee=Math.sin(re)*pe,De=Math.sin(te),Re=De*A+_e*P;return[Math.atan2(Ee*I-Re*B,_e*A-De*P)/la,Math.asin(Re*I+Ee*B)/la]},inverse:X=>{let re=X[0]*la,te=X[1]*la,pe=Math.cos(te),_e=Math.cos(re)*pe,Ee=Math.sin(re)*pe,De=Math.sin(te),Re=De*I-Ee*B;return[(Math.atan2(Ee*I+De*B,_e*A+Re*P)-p)/la,Math.asin(Re*A-_e*P)/la]}}}forward(l){return l}inverse(l){return l}cutOnAntimeridian(l,p){let y,T=[],A=[l];for(let P=0,I=l.length;P<I;++P){let B=l[P],X=l[P-1];if(!P){if(!p)continue;X=l[l.length-1]}let re=X[0],te=B[0];if((re<-90||re>90)&&(te<-90||te>90)&&re>0!=te>0){let pe=Nd((180-(re+360)%360)/((te+360)%360-(re+360)%360),0,1),_e=X[1]+pe*(B[1]-X[1]);T.push({i:P,lat:_e,direction:re<0?1:-1,previousLonLat:X,lonLat:B})}}if(T.length)if(p){T.length%2==1&&(y=T.slice().sort((I,B)=>Math.abs(B.lat)-Math.abs(I.lat))[0],_m(T,y));let P=T.length-2;for(;P>=0;){let I=T[P].i,B=of(180+1e-6*T[P].direction),X=of(180-1e-6*T[P].direction),re=l.splice(I,T[P+1].i-I,...dc.geodesic([B,T[P].lat],[B,T[P+1].lat],!0));re.push(...dc.geodesic([X,T[P+1].lat],[X,T[P].lat],!0)),A.push(re),P-=2}if(y)for(let I=0;I<A.length;I++){let{direction:B,lat:X}=y,re=A[I],te=re.indexOf(y.lonLat);if(te>-1){let pe=(X<0?-1:1)*this.maxLatitude,_e=of(180+1e-6*B),Ee=of(180-1e-6*B),De=dc.geodesic([_e,X],[_e,pe],!0);for(let Re=_e+120*B;Re>-180&&Re<180;Re+=120*B)De.push([Re,pe]);De.push(...dc.geodesic([Ee,pe],[Ee,y.lat],!0)),re.splice(te,0,...De);break}}}else{let P=T.length;for(;P--;){let I=T[P].i,B=l.splice(I,l.length,[of(180+1e-6*T[P].direction),T[P].lat]);B.unshift([of(180-1e-6*T[P].direction),T[P].lat]),A.push(B)}}return A}path(l){let p,{bounds:y,def:T,rotator:A}=this,P=[],I=l.type==="Polygon"||l.type==="MultiPolygon",B=this.hasGeoProjection,X=!T||T.antimeridianCutting!==!1,re=X?A:void 0,te=X&&T||this;y&&(p=[[y.x1,y.y1],[y.x2,y.y1],[y.x2,y.y2],[y.x1,y.y2]]);let pe=_e=>{let Ee=_e.map(Re=>{if(X){re&&(Re=re.forward(Re));let Be=Re[0];1e-6>Math.abs(Be-180)&&(Be=Be<180?179.999999:180.000001),Re=[Be,Re[1]]}return Re}),De=[Ee];B&&(dc.insertGeodesics(Ee),X&&(De=this.cutOnAntimeridian(Ee,I))),De.forEach(Re=>{let Be,Ze;if(Re.length<2)return;let rt=!1,Yt=!1,Ut=vi=>{rt?P.push(["L",vi[0],vi[1]]):(P.push(["M",vi[0],vi[1]]),rt=!0)},Xt=!1,Ci=!1,di=Re.map(vi=>{let es=te.forward(vi);return es.outside?Xt=!0:Ci=!0,es[1]===1/0?es[1]=1e10:es[1]===-1/0&&(es[1]=-1e10),es});if(X){if(I&&di.push(di[0]),Xt){if(!Ci)return;if(p){if(I)di=l_(di,p);else if(y)return void a_(di,p).forEach(vi=>{rt=!1,vi.forEach(Ut)})}}di.forEach(Ut)}else for(let vi=0;vi<di.length;vi++){let es=Re[vi],ws=di[vi];ws.outside?Yt=!0:(I&&!Be&&(Be=es,Re.push(es),di.push(ws)),Yt&&Ze&&(I&&B?dc.geodesic(Ze,es).forEach(As=>Ut(te.forward(As))):rt=!1),Ut(ws),Ze=es,Yt=!1)}})};return l.type==="LineString"?pe(l.coordinates):l.type==="MultiLineString"?l.coordinates.forEach(_e=>pe(_e)):l.type==="Polygon"?(l.coordinates.forEach(_e=>pe(_e)),P.length&&P.push(["Z"])):l.type==="MultiPolygon"&&(l.coordinates.forEach(_e=>{_e.forEach(Ee=>pe(Ee))}),P.length&&P.push(["Z"])),P}}dc.registry={EqualEarth:xd,LambertConformalConic:V_,Miller:Zg,Orthographic:vy,WebMercator:C0};let{composed:vg}=pi,{pointInPolygon:Hm}=Og,{topo2geo:U_}=Wg,{boundsFromPath:Bf}=Rf,{addEvent:bg,clamp:by,crisp:Ky,fireEvent:j_,isArray:G_,isNumber:cp,isObject:Ix,isString:h_,merge:vm,pick:wg,pushUnique:W_,relativeLength:Xm}=Ps,Ff={};function c_(q,l){let{width:p,height:y}=l;return Math.log(400.979322/Math.max((q.x2-q.x1)/(p/256),(q.y2-q.y1)/(y/256)))/Math.log(2)}function Ym(q){var l,p;q.seriesOptions.mapData&&((p=this.mapView)==null||p.recommendMapView(this,[this.options.chart.map,q.seriesOptions.mapData],(l=this.options.drilldown)==null?void 0:l.mapZooming))}class Nf{static compose(l){W_(vg,"MapView")&&(Ff=l.maps,bg(l,"afterInit",function(){this.mapView=new Nf(this,this.options.mapView)},{order:0}),bg(l,"addSeriesAsDrilldown",Ym),bg(l,"afterDrillUp",Ym))}static compositeBounds(l){if(l.length)return l.slice(1).reduce((p,y)=>(p.x1=Math.min(p.x1,y.x1),p.y1=Math.min(p.y1,y.y1),p.x2=Math.max(p.x2,y.x2),p.y2=Math.max(p.y2,y.y2),p),vm(l[0]))}static mergeInsets(l,p){let y=A=>{let P={};return A.forEach((I,B)=>{P[I&&I.id||`i${B}`]=I}),P},T=vm(y(l),y(p));return Object.keys(T).map(A=>T[A])}constructor(l,p){var P;this.allowTransformAnimation=!0,this.eventsToUnbind=[],this.insets=[],this.padding=[0,0,0,0],this.recommendedMapView={},this instanceof Jy||this.recommendMapView(l,[l.options.chart.map,...(l.options.series||[]).map(I=>I.mapData)]),this.userOptions=p||{};let y=vm(R_,this.recommendedMapView,p),T=(P=this.recommendedMapView)==null?void 0:P.insets,A=p&&p.insets;T&&A&&(y.insets=Nf.mergeInsets(T,A)),this.chart=l,this.center=y.center,this.options=y,this.projection=new dc(y.projection),this.playingField=l.plotBox,this.zoom=y.zoom||0,this.minZoom=y.minZoom,this.createInsets(),this.eventsToUnbind.push(bg(l,"afterSetChartSize",()=>{this.playingField=this.getField(),(this.minZoom===void 0||this.minZoom===this.zoom)&&(this.fitToBounds(void 0,void 0,!1),!this.chart.hasRendered&&cp(this.userOptions.zoom)&&(this.zoom=this.userOptions.zoom),this.userOptions.center&&vm(!0,this.center,this.userOptions.center))})),this.setUpEvents()}createInsets(){let l=this.options,p=l.insets;p&&p.forEach(y=>{let T=new Jy(this,vm(l.insetOptions,y));this.insets.push(T)})}fitToBounds(l,p,y=!0,T){let A=l||this.getProjectedBounds();if(A){let P=wg(p,l?0:this.options.padding),I=this.getField(!1),B=G_(P)?P:[P,P,P,P];this.padding=[Xm(B[0],I.height),Xm(B[1],I.width),Xm(B[2],I.height),Xm(B[3],I.width)],this.playingField=this.getField();let X=c_(A,this.playingField);l||(this.minZoom=X);let re=this.projection.inverse([(A.x2+A.x1)/2,(A.y2+A.y1)/2]);this.setView(re,X,y,T)}}getField(l=!0){let p=l?this.padding:[0,0,0,0];return{x:p[3],y:p[0],width:this.chart.plotWidth-p[1]-p[3],height:this.chart.plotHeight-p[0]-p[2]}}getGeoMap(l){if(h_(l))return Ff[l]&&Ff[l].type==="Topology"?U_(Ff[l]):Ff[l];if(Ix(l,!0)){if(l.type==="FeatureCollection")return l;if(l.type==="Topology")return U_(l)}}getMapBBox(){let l=this.getProjectedBounds(),p=this.getScale();if(l){let y=this.padding,T=this.projectedUnitsToPixels({x:l.x1,y:l.y2});return{width:(l.x2-l.x1)*p+y[1]+y[3],height:(l.y2-l.y1)*p+y[0]+y[2],x:T.x-y[3],y:T.y-y[0]}}}getProjectedBounds(){let l=this.projection,p=this.chart.series.reduce((T,A)=>{let P=A.getProjectedBounds&&A.getProjectedBounds();return P&&A.options.affectsMapView!==!1&&T.push(P),T},[]),y=this.options.fitToGeometry;if(y){if(!this.fitToGeometryCache)if(y.type==="MultiPoint"){let T=y.coordinates.map(I=>l.forward(I)),A=T.map(I=>I[0]),P=T.map(I=>I[1]);this.fitToGeometryCache={x1:Math.min.apply(0,A),x2:Math.max.apply(0,A),y1:Math.min.apply(0,P),y2:Math.max.apply(0,P)}}else this.fitToGeometryCache=Bf(l.path(y));return this.fitToGeometryCache}return this.projection.bounds||Nf.compositeBounds(p)}getScale(){return 256/400.979322*Math.pow(2,this.zoom)}getSVGTransform(){let{x:l,y:p,width:y,height:T}=this.playingField,A=this.projection.forward(this.center),P=this.projection.hasCoordinates?-1:1,I=this.getScale(),B=I*P,X=l+y/2-A[0]*I,re=p+T/2-A[1]*B;return{scaleX:I,scaleY:B,translateX:X,translateY:re}}lonLatToPixels(l){let p=this.lonLatToProjectedUnits(l);if(p)return this.projectedUnitsToPixels(p)}lonLatToProjectedUnits(l){let p=this.chart,y=p.mapTransforms;if(y){for(let A in y)if(Object.hasOwnProperty.call(y,A)&&y[A].hitZone){let P=p.transformFromLatLon(l,y[A]);if(P&&Hm(P,y[A].hitZone.coordinates[0]))return P}return p.transformFromLatLon(l,y.default)}for(let A of this.insets)if(A.options.geoBounds&&Hm({x:l.lon,y:l.lat},A.options.geoBounds.coordinates[0])){let P=A.projection.forward([l.lon,l.lat]),I=A.projectedUnitsToPixels({x:P[0],y:P[1]});return this.pixelsToProjectedUnits(I)}let T=this.projection.forward([l.lon,l.lat]);if(!T.outside)return{x:T[0],y:T[1]}}projectedUnitsToLonLat(l){let p=this.chart,y=p.mapTransforms;if(y){for(let P in y)if(Object.hasOwnProperty.call(y,P)&&y[P].hitZone&&Hm(l,y[P].hitZone.coordinates[0]))return p.transformToLatLon(l,y[P]);return p.transformToLatLon(l,y.default)}let T=this.projectedUnitsToPixels(l);for(let P of this.insets)if(P.hitZone&&Hm(T,P.hitZone.coordinates[0])){let I=P.pixelsToProjectedUnits(T),B=P.projection.inverse([I.x,I.y]);return{lon:B[0],lat:B[1]}}let A=this.projection.inverse([l.x,l.y]);return{lon:A[0],lat:A[1]}}recommendMapView(l,p,y=!1){var I;this.recommendedMapView={};let T=p.map(B=>this.getGeoMap(B)),A=[];T.forEach(B=>{if(B&&(Object.keys(this.recommendedMapView).length||(this.recommendedMapView=B["hc-recommended-mapview"]||{}),B.bbox)){let[X,re,te,pe]=B.bbox;A.push({x1:X,y1:re,x2:te,y2:pe})}});let P=A.length&&Nf.compositeBounds(A);j_(this,"onRecommendMapView",{geoBounds:P,chart:l},function(){if(P&&this.recommendedMapView){if(!this.recommendedMapView.projection){let{x1:B,y1:X,x2:re,y2:te}=P;this.recommendedMapView.projection=re-B>180&&te-X>90?{name:"EqualEarth",parallels:[0,0],rotation:[0]}:{name:"LambertConformalConic",parallels:[X,te],rotation:[-(B+re)/2]}}this.recommendedMapView.insets||(this.recommendedMapView.insets=void 0)}}),this.geoMap=T[0],y&&l.hasRendered&&!((I=l.userOptions.mapView)!=null&&I.projection)&&this.recommendedMapView&&this.update(this.recommendedMapView)}redraw(l){this.chart.series.forEach(p=>{p.useMapGeometry&&(p.isDirty=!0)}),this.chart.redraw(l)}setView(l,p,y=!0,T){l&&(this.center=l),typeof p=="number"&&(typeof this.minZoom=="number"&&(p=Math.max(p,this.minZoom)),typeof this.options.maxZoom=="number"&&(p=Math.min(p,this.options.maxZoom)),cp(p)&&(this.zoom=p));let A=this.getProjectedBounds();if(A){let P=this.projection.forward(this.center),{x:I,y:B,width:X,height:re}=this.playingField,te=this.getScale(),pe=this.projectedUnitsToPixels({x:A.x1,y:A.y1}),_e=this.projectedUnitsToPixels({x:A.x2,y:A.y2}),Ee=[(A.x1+A.x2)/2,(A.y1+A.y2)/2];if(!this.chart.series.some(De=>De.isDrilling)){let De=pe.x,Re=_e.y,Be=_e.x,Ze=pe.y;Be-De<X?P[0]=Ee[0]:De<I&&Be<I+X?P[0]+=Math.max(De-I,Be-X-I)/te:Be>I+X&&De>I&&(P[0]+=Math.min(Be-X-I,De-I)/te),Ze-Re<re?P[1]=Ee[1]:Re<B&&Ze<B+re?P[1]-=Math.max(Re-B,Ze-re-B)/te:Ze>B+re&&Re>B&&(P[1]-=Math.min(Ze-re-B,Re-B)/te),this.center=this.projection.inverse(P)}this.insets.forEach(De=>{De.options.field&&(De.hitZone=De.getHitZone(),De.playingField=De.getField())}),this.render()}j_(this,"afterSetView"),y&&this.redraw(T)}projectedUnitsToPixels(l){let p=this.getScale(),y=this.projection.forward(this.center),T=this.playingField,A=T.x+T.width/2,P=T.y+T.height/2;return{x:A-p*(y[0]-l.x),y:P+p*(y[1]-l.y)}}pixelsToLonLat(l){return this.projectedUnitsToLonLat(this.pixelsToProjectedUnits(l))}pixelsToProjectedUnits(l){let{x:p,y}=l,T=this.getScale(),A=this.projection.forward(this.center),P=this.playingField,I=P.x+P.width/2,B=P.y+P.height/2;return{x:A[0]+(p-I)/T,y:A[1]-(y-B)/T}}setUpEvents(){let l,p,y,{chart:T}=this,A=P=>{let{lastTouches:I,pinchDown:B}=T.pointer,X=this.projection,re=P.touches,{mouseDownX:te,mouseDownY:pe}=T,_e=0;if((B==null?void 0:B.length)===1?(te=B[0].chartX,pe=B[0].chartY):(B==null?void 0:B.length)===2&&(te=(B[0].chartX+B[1].chartX)/2,pe=(B[0].chartY+B[1].chartY)/2),(re==null?void 0:re.length)===2&&I&&(_e=Math.log(Math.sqrt(Math.pow(I[0].chartX-I[1].chartX,2)+Math.pow(I[0].chartY-I[1].chartY,2))/Math.sqrt(Math.pow(re[0].chartX-re[1].chartX,2)+Math.pow(re[0].chartY-re[1].chartY,2)))/Math.log(.5)),cp(te)&&cp(pe)){let Ee=`${te},${pe}`,{chartX:De,chartY:Re}=P.originalEvent;(re==null?void 0:re.length)===2&&(De=(re[0].chartX+re[1].chartX)/2,Re=(re[0].chartY+re[1].chartY)/2),Ee!==p&&(p=Ee,l=this.projection.forward(this.center),y=(this.projection.options.rotation||[0,0]).slice());let Be=X.def&&X.def.bounds,Ze=Be&&c_(Be,this.playingField)||-1/0;if(X.options.name==="Orthographic"&&2>((re==null?void 0:re.length)||0)&&(this.minZoom||1/0)<1.3*Ze){let rt=440/(this.getScale()*Math.min(T.plotWidth,T.plotHeight));if(y){let Yt=(te-De)*rt-y[0],Ut=by(-y[1]-(pe-Re)*rt,-80,80),Xt=this.zoom;this.update({projection:{rotation:[-Yt,-Ut]}},!1),this.fitToBounds(void 0,void 0,!1),this.zoom=Xt,T.redraw(!1)}}else if(cp(De)&&cp(Re)){let rt=this.getScale(),Yt=this.projection.hasCoordinates?1:-1,Ut=this.projection.inverse([l[0]+(te-De)/rt,l[1]-(pe-Re)/rt*Yt]);isNaN(Ut[0]+Ut[1])||this.zoomBy(_e,Ut,void 0,!1)}P.preventDefault()}};bg(T,"pan",A),bg(T,"touchpan",A),bg(T,"selection",P=>{if(P.resetSelection)this.zoomBy();else{let I=P.x-T.plotLeft,B=P.y-T.plotTop,{y:X,x:re}=this.pixelsToProjectedUnits({x:I,y:B}),{y:te,x:pe}=this.pixelsToProjectedUnits({x:I+P.width,y:B+P.height});this.fitToBounds({x1:re,y1:X,x2:pe,y2:te},void 0,!0,!P.originalEvent.touches&&void 0),/^touch/.test(P.originalEvent.type)||T.showResetZoom(),P.preventDefault()}})}render(){this.group||(this.group=this.chart.renderer.g("map-view").attr({zIndex:4}).add())}update(l,p=!0,y){let T=l.projection,A=T&&dc.toString(T)!==dc.toString(this.options.projection),P=!1;vm(!0,this.userOptions,l),vm(!0,this.options,l),"insets"in l&&(this.insets.forEach(I=>I.destroy()),this.insets.length=0,P=!0),(A||"fitToGeometry"in l)&&delete this.fitToGeometryCache,(A||P)&&(this.chart.series.forEach(I=>{let B=I.transformGroups;if(I.clearBounds&&I.clearBounds(),I.isDirty=!0,I.isDirtyData=!0,P&&B)for(;B.length>1;){let X=B.pop();X&&X.destroy()}}),A&&(this.projection=new dc(this.options.projection)),P&&this.createInsets(),!l.center&&Object.hasOwnProperty.call(l,"zoom")&&!cp(l.zoom)&&this.fitToBounds(void 0,void 0,!1)),l.center||cp(l.zoom)?this.setView(this.options.center,l.zoom,!1):"fitToGeometry"in l&&this.fitToBounds(void 0,void 0,!1),p&&this.chart.redraw(y)}zoomBy(l,p,y,T){let A=this.chart,P=this.projection.forward(this.center);if(typeof l=="number"){let I,B,X,re=this.zoom+l;if(y){let[te,pe]=y,_e=this.getScale(),Ee=te-A.plotLeft-A.plotWidth/2,De=pe-A.plotTop-A.plotHeight/2;B=P[0]+Ee/_e,X=P[1]+De/_e}if(typeof B=="number"&&typeof X=="number"){let te=1-Math.pow(2,this.zoom)/Math.pow(2,re),pe=P[0]-B,_e=P[1]-X;P[0]-=pe*te,P[1]+=_e*te,I=this.projection.inverse(P)}this.setView(p||I,re,void 0,T)}else this.fitToBounds(void 0,void 0,void 0,T)}}class Jy extends Nf{constructor(l,p){if(super(l.chart,p),this.id=p.id,this.mapView=l,this.options=vm({center:[0,0]},l.options.insetOptions,p),this.allBounds=[],this.options.geoBounds){let y=l.projection.path(this.options.geoBounds);this.geoBoundsProjectedBox=Bf(y),this.geoBoundsProjectedPolygon=y.map(T=>[T[1]||0,T[2]||0])}}getField(l=!0){let p=this.hitZone;if(p){let y=l?this.padding:[0,0,0,0],T=p.coordinates[0],A=T.map(te=>te[0]),P=T.map(te=>te[1]),I=Math.min.apply(0,A)+y[3],B=Math.max.apply(0,A)-y[1],X=Math.min.apply(0,P)+y[0],re=Math.max.apply(0,P)-y[2];if(cp(I)&&cp(X))return{x:I,y:X,width:B-I,height:re-X}}return super.getField.call(this,l)}getHitZone(){let{chart:l,mapView:p,options:y}=this,{coordinates:T}=y.field||{};if(T){let A=T[0];if(y.units==="percent"){let P=y.relativeTo==="mapBoundingBox"&&p.getMapBBox()||vm(l.plotBox,{x:0,y:0});A=A.map(I=>[Xm(`${I[0]}%`,P.width,P.x),Xm(`${I[1]}%`,P.height,P.y)])}return{type:"Polygon",coordinates:[A]}}}getProjectedBounds(){return Nf.compositeBounds(this.allBounds)}isInside(l){let{geoBoundsProjectedBox:p,geoBoundsProjectedPolygon:y}=this;return!!(p&&l.x>=p.x1&&l.x<=p.x2&&l.y>=p.y1&&l.y<=p.y2&&y&&Hm(l,y))}render(){let{chart:l,mapView:p,options:y}=this,T=y.borderPath||y.field;if(T&&p.group){let A=!0;this.border||(this.border=l.renderer.path().addClass("highcharts-mapview-inset-border").add(p.group),A=!1),l.styledMode||this.border.attr({stroke:y.borderColor,"stroke-width":y.borderWidth});let P=this.border.strokeWidth(),I=y.relativeTo==="mapBoundingBox"&&p.getMapBBox()||p.playingField,B=(T.coordinates||[]).reduce((X,re)=>re.reduce((te,pe,_e)=>{let[Ee,De]=pe;return y.units==="percent"&&(Ee=l.plotLeft+Xm(`${Ee}%`,I.width,I.x),De=l.plotTop+Xm(`${De}%`,I.height,I.y)),Ee=Ky(Ee,P),De=Ky(De,P),te.push(_e===0?["M",Ee,De]:["L",Ee,De]),te},X),[]);this.border[A?"animate":"attr"]({d:B})}}destroy(){this.border&&(this.border=this.border.destroy()),this.eventsToUnbind.forEach(l=>l())}setUpEvents(){}}let{animObject:d_,stop:Lx}=to,{noop:Ox}=pi,{splitPath:H_}=yd,{column:Jg,scatter:u_}=oo.seriesTypes,{extend:X_,find:P0,fireEvent:Y_,getNestedProperty:Qy,isArray:Tg,defined:zp,isNumber:Fh,isObject:dp,merge:Vd,objectEach:p_,pick:wy,splat:I0}=Ps;class bm extends u_{constructor(){super(...arguments),this.processedData=[]}animate(l){let{chart:p,group:y}=this,T=d_(this.options.animation);l?y.attr({translateX:p.plotLeft+p.plotWidth/2,translateY:p.plotTop+p.plotHeight/2,scaleX:.001,scaleY:.001}):y.animate({translateX:p.plotLeft,translateY:p.plotTop,scaleX:1,scaleY:1},T)}clearBounds(){this.points.forEach(l=>{delete l.bounds,delete l.insetIndex,delete l.projectedPath}),delete this.bounds}doFullTranslate(){return!!(this.isDirtyData||this.chart.isResizing||!this.hasRendered)}drawMapDataLabels(){super.drawDataLabels(),this.dataLabelsGroup&&this.dataLabelsGroup.clip(this.chart.clipRect)}drawPoints(){let l=this,{chart:p,group:y,transformGroups:T=[]}=this,{mapView:A,renderer:P}=p;if(A){this.transformGroups=T,T[0]||(T[0]=P.g().add(y));for(let I=0,B=A.insets.length;I<B;++I)T[I+1]||T.push(P.g().add(y));this.doFullTranslate()&&(this.points.forEach(I=>{let{graphic:B}=I;I.group=T[typeof I.insetIndex=="number"?I.insetIndex+1:0],B&&B.parentGroup!==I.group&&B.add(I.group)}),Jg.prototype.drawPoints.apply(this),this.points.forEach(I=>{var X;let B=I.graphic;if(B){let re=B.animate,te="";I.name&&(te+="highcharts-name-"+I.name.replace(/ /g,"-").toLowerCase()),(X=I.properties)!=null&&X["hc-key"]&&(te+=" highcharts-key-"+I.properties["hc-key"].toString().toLowerCase()),te&&B.addClass(te),p.styledMode&&B.css(this.pointAttribs(I,I.selected&&"select"||void 0)),B.attr({visibility:!I.visible&&(I.visible||I.isNull)?"hidden":"inherit"}),B.animate=function(pe,_e,Ee){var Be;let De=Fh(pe["stroke-width"])&&!Fh(B["stroke-width"]),Re=Fh(B["stroke-width"])&&!Fh(pe["stroke-width"]);if(De||Re){let Ze=wy(l.getStrokeWidth(l.options),1)/(((Be=p.mapView)==null?void 0:Be.getScale())||1);De&&(B["stroke-width"]=Ze),Re&&(pe["stroke-width"]=Ze)}return re.call(B,pe,_e,Re?function(){B.element.removeAttribute("stroke-width"),delete B["stroke-width"],Ee&&Ee.apply(this,arguments)}:Ee)}}})),T.forEach((I,B)=>{let X=(B===0?A:A.insets[B-1]).getSVGTransform(),re=wy(this.getStrokeWidth(this.options),1),te=X.scaleX,pe=X.scaleY>0?1:-1,_e=Ee=>{(l.points||[]).forEach(De=>{let Re,Be=De.graphic;Be!=null&&Be["stroke-width"]&&(Re=this.getStrokeWidth(De.options))&&Be.attr({"stroke-width":Re/Ee})})};if(P.globalAnimation&&p.hasRendered&&A.allowTransformAnimation){let Ee=Number(I.attr("translateX")),De=Number(I.attr("translateY")),Re=Number(I.attr("scaleX")),Be=(Yt,Ut)=>{let Xt=Re+(te-Re)*Ut.pos;I.attr({translateX:Ee+(X.translateX-Ee)*Ut.pos,translateY:De+(X.translateY-De)*Ut.pos,scaleX:Xt,scaleY:Xt*pe,"stroke-width":re/Xt}),_e(Xt)},Ze=Vd(d_(P.globalAnimation)),rt=Ze.step;Ze.step=function(){rt&&rt.apply(this,arguments),Be.apply(this,arguments)},I.attr({animator:0}).animate({animator:1},Ze,(function(){typeof P.globalAnimation!="boolean"&&P.globalAnimation.complete&&P.globalAnimation.complete({applyDrilldown:!0}),Y_(this,"mapZoomComplete")}).bind(this))}else Lx(I),I.attr(Vd(X,{"stroke-width":re/te})),_e(te)}),this.isDrilling||this.drawMapDataLabels()}}getProjectedBounds(){if(!this.bounds&&this.chart.mapView){let{insets:l,projection:p}=this.chart.mapView,y=[];(this.points||[]).forEach(T=>{if(T.path||T.geometry){if(typeof T.path=="string"?T.path=H_(T.path):Tg(T.path)&&T.path[0]==="M"&&(T.path=this.chart.renderer.pathToSegments(T.path)),!T.bounds){let A=T.getProjectedBounds(p);if(A){T.labelrank=wy(T.labelrank,(A.x2-A.x1)*(A.y2-A.y1));let{midX:P,midY:I}=A;if(l&&Fh(P)&&Fh(I)){let B=P0(l,X=>X.isInside({x:P,y:I}));B&&(delete T.projectedPath,(A=T.getProjectedBounds(B.projection))&&B.allBounds.push(A),T.insetIndex=l.indexOf(B))}T.bounds=A}}T.bounds&&T.insetIndex===void 0&&y.push(T.bounds)}}),this.bounds=Nf.compositeBounds(y)}return this.bounds}getStrokeWidth(l){let p=this.pointAttrToOptions;return l[(p==null?void 0:p["stroke-width"])||"borderWidth"]}hasData(){return!!this.dataTable.rowCount}pointAttribs(l,p){let{mapView:y,styledMode:T}=l.series.chart,A=T?this.colorAttribs(l):Jg.prototype.pointAttribs.call(this,l,p),P=this.getStrokeWidth(l.options);if(p){let B=Vd(this.options.states&&this.options.states[p],l.options.states&&l.options.states[p]||{}),X=this.getStrokeWidth(B);zp(X)&&(P=X),A.stroke=B.borderColor??l.color}P&&y&&(P/=y.getScale());let I=this.getStrokeWidth(this.options);return A.dashstyle&&y&&Fh(I)&&(P=I/y.getScale()),l.visible||(A.fill=this.options.nullColor),zp(P)?A["stroke-width"]=P:delete A["stroke-width"],A["stroke-linecap"]=A["stroke-linejoin"]=this.options.linecap,A}updateData(){return!this.processedData&&super.updateData.apply(this,arguments)}setData(l,p=!0,y,T){delete this.bounds,super.setData(l,!1,void 0,T),this.processData(),this.generatePoints(),p&&this.chart.redraw(y)}dataColumnKeys(){return this.pointArrayMap}processData(){let l,p,y,T=this.options,A=T.data,P=this.chart,I=P.options.chart,B=this.joinBy,X=T.keys||this.pointArrayMap,re=[],te={},pe=this.chart.mapView,_e=pe&&(dp(T.mapData,!0)?pe.getGeoMap(T.mapData):pe.geoMap),Ee=P.mapTransforms=I.mapTransforms||(_e==null?void 0:_e["hc-transform"])||P.mapTransforms;Ee&&p_(Ee,Re=>{Re.rotation&&(Re.cosAngle=Math.cos(Re.rotation),Re.sinAngle=Math.sin(Re.rotation))}),Tg(T.mapData)?y=T.mapData:_e&&_e.type==="FeatureCollection"&&(this.mapTitle=_e.title,y=pi.geojson(_e,this.type,this)),this.processedData=[];let De=this.processedData;if(A){let Re;for(let Be=0,Ze=A.length;Be<Ze;++Be){if(Fh(Re=A[Be]))De[Be]={value:Re};else if(Tg(Re)){let rt=0;De[Be]={},!T.keys&&Re.length>X.length&&typeof Re[0]=="string"&&(De[Be]["hc-key"]=Re[0],++rt);for(let Yt=0;Yt<X.length;++Yt,++rt)X[Yt]&&Re[rt]!==void 0&&(X[Yt].indexOf(".")>0?Xu.prototype.setNestedProperty(De[Be],Re[rt],X[Yt]):De[Be][X[Yt]]=Re[rt])}else De[Be]=A[Be];B&&B[0]==="_i"&&(De[Be]._i=Be)}}if(y){this.mapData=y,this.mapMap={};for(let Re=0;Re<y.length;Re++)p=(l=y[Re]).properties,l._i=Re,B[0]&&p&&p[B[0]]&&(l[B[0]]=p[B[0]]),te[l[B[0]]]=l;if(this.mapMap=te,B[1]){let Re=B[1];De.forEach(Be=>{let Ze=Qy(Re,Be);te[Ze]&&re.push(te[Ze])})}if(T.allAreas){if(B[1]){let Be=B[1];De.forEach(Ze=>{re.push(Qy(Be,Ze))})}let Re="|"+re.map(function(Be){return Be&&Be[B[0]]}).join("|")+"|";y.forEach(Be=>{B[0]&&Re.indexOf("|"+Be[B[0]]+"|")!==-1||De.push(Vd(Be,{value:null}))})}}this.dataTable.rowCount=De.length}setOptions(l){let p=super.setOptions(l),y=p.joinBy;return p.joinBy===null&&(y="_i"),y&&(this.joinBy=I0(y),this.joinBy[1]||(this.joinBy[1]=this.joinBy[0])),p}translate(){let l=this.doFullTranslate(),p=this.chart.mapView,y=p==null?void 0:p.projection;if(this.chart.hasRendered&&(this.isDirtyData||!this.hasRendered)&&(this.processData(),this.generatePoints(),delete this.bounds,!p||p.userOptions.center||Fh(p.userOptions.zoom)||p.zoom!==p.minZoom?this.getProjectedBounds():p.fitToBounds(void 0,void 0,!1)),p){let T=p.getSVGTransform();this.points.forEach(A=>{let P=Fh(A.insetIndex)&&p.insets[A.insetIndex].getSVGTransform()||T;P&&A.bounds&&Fh(A.bounds.midX)&&Fh(A.bounds.midY)&&(A.plotX=A.bounds.midX*P.scaleX+P.translateX,A.plotY=A.bounds.midY*P.scaleY+P.translateY),l&&(A.shapeType="path",A.shapeArgs={d:Xu.getProjectedPath(A,y)}),!A.hiddenInDataClass&&(A.projectedPath&&!A.projectedPath.length?A.setVisible(!1):A.visible||A.setVisible(!0))})}Y_(this,"afterTranslate")}update(l){var p;l.mapData&&((p=this.chart.mapView)==null||p.recommendMapView(this.chart,[this.chart.options.chart.map,...(this.chart.options.series||[]).map((y,T)=>T===this._i?l.mapData:y.mapData)],!0)),super.update.apply(this,arguments)}}bm.defaultOptions=Vd(u_.defaultOptions,{affectsMapView:!0,animation:!1,dataLabels:{crop:!1,formatter:function(){let{numberFormatter:q}=this.series.chart,{value:l}=this.point;return qy(l)?q(l,-1):this.point.name||""},inside:!0,overflow:!1,padding:0,verticalAlign:"middle"},linecap:"round",marker:null,nullColor:"#f7f7f7",stickyTracking:!1,tooltip:{followPointer:!0,pointFormat:"{point.name}: {point.value}<br/>"},turboThreshold:0,allAreas:!0,borderColor:"#e6e6e6",borderWidth:1,joinBy:"hc-key",states:{hover:{halo:void 0,borderColor:"#666666",borderWidth:2},normal:{animation:!0},select:{color:"#cccccc"}},legendSymbol:"rectangle"}),X_(bm.prototype,{type:"map",axisTypes:aa.seriesMembers.axisTypes,colorAttribs:aa.seriesMembers.colorAttribs,colorKey:aa.seriesMembers.colorKey,directTouch:!0,drawDataLabels:Ox,drawGraph:Ox,forceDL:!0,getCenter:xu.getCenter,getExtremesFromAll:!0,getSymbol:Ox,isCartesian:!1,parallelArrays:aa.seriesMembers.parallelArrays,pointArrayMap:aa.seriesMembers.pointArrayMap,pointClass:Xu,preserveAspectRatio:!0,searchPoint:Ox,trackerGroups:aa.seriesMembers.trackerGroups,useMapGeometry:!0}),aa.compose(bm),oo.registerSeriesType("map",bm);let $m=bm,{extend:rh,merge:Sg}=Ps;class nf extends $m{pointAttribs(l,p){let y=super.pointAttribs(l,p);return y.fill=this.options.fillColor,y}}nf.defaultOptions=Sg($m.defaultOptions,{lineWidth:1,fillColor:"none",legendSymbol:"lineMarker"}),rh(nf.prototype,{type:"mapline",colorProp:"stroke",pointAttrToOptions:{stroke:"color","stroke-width":"lineWidth"}}),oo.registerSeriesType("mapline",nf);let{scatter:Ty}=oo.seriesTypes,{isNumber:_d}=Ps;class $_ extends Ty.prototype.pointClass{isValid(){return!!(this.options.geometry||_d(this.x)&&_d(this.y)||_d(this.options.lon)&&_d(this.options.lat))}}let{noop:Dx}=pi,{map:Sy,scatter:f_}=oo.seriesTypes,{extend:ex,fireEvent:L0,isNumber:Ud,merge:m_}=Ps;class My extends f_{constructor(){super(...arguments),this.clearBounds=Sy.prototype.clearBounds}drawDataLabels(){super.drawDataLabels(),this.dataLabelsGroup&&this.dataLabelsGroup.clip(this.chart.clipRect)}projectPoint(l){let p=this.chart.mapView;if(p){let{geometry:y,lon:T,lat:A}=l,P=y&&y.type==="Point"&&y.coordinates;if(Ud(T)&&Ud(A)&&(P=[T,A]),P)return p.lonLatToProjectedUnits({lon:P[0],lat:P[1]})}}translate(){let l=this.chart.mapView;if(this.generatePoints(),this.getProjectedBounds&&this.isDirtyData&&(delete this.bounds,this.getProjectedBounds()),l){let p=l.getSVGTransform(),{hasCoordinates:y}=l.projection;this.points.forEach(T=>{let A,{x:P,y:I}=T,B=Ud(T.insetIndex)&&l.insets[T.insetIndex].getSVGTransform()||p,X=this.projectPoint(T.options)||T.properties&&this.projectPoint(T.properties);if(X?(P=X.x,I=X.y):T.bounds&&(P=T.bounds.midX,I=T.bounds.midY,B&&Ud(P)&&Ud(I)&&(T.plotX=P*B.scaleX+B.translateX,T.plotY=I*B.scaleY+B.translateY,A=!0)),Ud(P)&&Ud(I)){if(!A){let re=l.projectedUnitsToPixels({x:P,y:I});T.plotX=re.x,T.plotY=y?re.y:this.chart.plotHeight-re.y}}else T.y=T.plotX=T.plotY=void 0;T.isInside=this.isPointInside(T),T.zone=this.zones.length?T.getZone():void 0})}L0(this,"afterTranslate")}}My.defaultOptions=m_(f_.defaultOptions,{dataLabels:{crop:!1,defer:!1,enabled:!0,formatter:function(){return this.point.name},overflow:!1,style:{color:"#000000"}},legendSymbol:"lineMarker"}),Bc.prototype.symbols.mapmarker=(q,l,p,y,T)=>{let A,P,I=T&&T.context==="legend";I?(A=q+p/2,P=l+y):T&&typeof T.anchorX=="number"&&typeof T.anchorY=="number"?(A=T.anchorX,P=T.anchorY):(A=q+p/2,P=l+y/2,l-=y);let B=I?y/3:y/2;return[["M",A,P],["C",A,P,A-B,l+1.5*B,A-B,l+B],["A",B,B,1,1,1,A+B,l+B],["C",A+B,l+1.5*B,A,P,A,P],["Z"]]},ex(My.prototype,{type:"mappoint",axisTypes:["colorAxis"],forceDL:!0,isCartesian:!1,pointClass:$_,searchPoint:Dx,useMapGeometry:!0}),oo.registerSeriesType("mappoint",My);let g_={borderColor:void 0,borderWidth:2,className:void 0,color:void 0,connectorClassName:void 0,connectorColor:void 0,connectorDistance:60,connectorWidth:1,enabled:!1,labels:{className:void 0,allowOverlap:!1,format:"",formatter:void 0,align:"right",style:{fontSize:"0.9em",color:"#000000"},x:0,y:0},maxSize:60,minSize:10,legendIndex:0,ranges:{value:void 0,borderColor:void 0,color:void 0,connectorColor:void 0},sizeBy:"area",sizeByAbsoluteValue:!1,zIndex:1,zThreshold:0},{noop:zx}=pi,{arrayMax:O0,arrayMin:qm,isNumber:y_,merge:Vf,pick:Rp,stableSort:x_}=Ps,__=class{constructor(q,l){this.setState=zx,this.init(q,l)}init(q,l){this.options=q,this.visible=!0,this.chart=l.chart,this.legend=l}addToLegend(q){q.splice(this.options.legendIndex,0,this)}drawLegendSymbol(q){let l,p=Rp(q.options.itemDistance,20),y=this.legendItem||{},T=this.options,A=T.ranges,P=T.connectorDistance;if(!A||!A.length||!y_(A[0].value)){q.options.bubbleLegend.autoRanges=!0;return}x_(A,function(re,te){return te.value-re.value}),this.ranges=A,this.setOptions(),this.render();let I=this.getMaxLabelSize(),B=this.ranges[0].radius,X=2*B;l=(l=P-B+I.width)>0?l:0,this.maxLabel=I,this.movementX=T.labels.align==="left"?l:0,y.labelWidth=X+l+p,y.labelHeight=X+I.height/2}setOptions(){let q=this.ranges,l=this.options,p=this.chart.series[l.seriesIndex],y=this.legend.baseline,T={zIndex:l.zIndex,"stroke-width":l.borderWidth},A={zIndex:l.zIndex,"stroke-width":l.connectorWidth},P={align:this.legend.options.rtl||l.labels.align==="left"?"right":"left",zIndex:l.zIndex},I=p.options.marker.fillOpacity,B=this.chart.styledMode;q.forEach(function(X,re){B||(T.stroke=Rp(X.borderColor,l.borderColor,p.color),T.fill=X.color||l.color,T.fill||(T.fill=p.color,T["fill-opacity"]=I??1),A.stroke=Rp(X.connectorColor,l.connectorColor,p.color)),q[re].radius=this.getRangeRadius(X.value),q[re]=Vf(q[re],{center:q[0].radius-q[re].radius+y}),B||Vf(!0,q[re],{bubbleAttribs:Vf(T),connectorAttribs:Vf(A),labelAttribs:P})},this)}getRangeRadius(q){let l=this.options,p=this.options.seriesIndex,y=this.chart.series[p],T=l.ranges[0].value,A=l.ranges[l.ranges.length-1].value,P=l.minSize,I=l.maxSize;return y.getRadius.call(this,A,T,P,I,q)}render(){let q=this.legendItem||{},l=this.chart.renderer,p=this.options.zThreshold;for(let y of(this.symbols||(this.symbols={connectors:[],bubbleItems:[],labels:[]}),q.symbol=l.g("bubble-legend"),q.label=l.g("bubble-legend-item").css(this.legend.itemStyle||{}),q.symbol.translateX=0,q.symbol.translateY=0,q.symbol.add(q.label),q.label.add(q.group),this.ranges))y.value>=p&&this.renderRange(y);this.hideOverlappingLabels()}renderRange(q){let l=this.ranges[0],p=this.legend,y=this.options,T=y.labels,A=this.chart,P=A.series[y.seriesIndex],I=A.renderer,B=this.symbols,X=B.labels,re=q.center,te=Math.abs(q.radius),pe=y.connectorDistance||0,_e=T.align,Ee=p.options.rtl,De=y.borderWidth,Re=y.connectorWidth,Be=l.radius||0,Ze=re-te-De/2+Re/2,rt=(Ze%1?1:.5)-(Re%2?0:.5),Yt=I.styledMode,Ut=Ee||_e==="left"?-pe:pe;_e==="center"&&(Ut=0,y.connectorDistance=0,q.labelAttribs.align="center"),B.bubbleItems.push(I.circle(Be,re+rt,te).attr(Yt?{}:q.bubbleAttribs).addClass((Yt?"highcharts-color-"+P.colorIndex+" ":"")+"highcharts-bubble-legend-symbol "+(y.className||"")).add(this.legendItem.symbol)),B.connectors.push(I.path(I.crispLine([["M",Be,Ze],["L",Be+Ut,Ze]],y.connectorWidth)).attr(Yt?{}:q.connectorAttribs).addClass((Yt?"highcharts-color-"+this.options.seriesIndex+" ":"")+"highcharts-bubble-legend-connectors "+(y.connectorClassName||"")).add(this.legendItem.symbol));let Xt=I.text(this.formatLabel(q)).attr(Yt?{}:q.labelAttribs).css(Yt?{}:T.style).addClass("highcharts-bubble-legend-labels "+(y.labels.className||"")).add(this.legendItem.symbol),Ci={x:Be+Ut+y.labels.x,y:Ze+y.labels.y+.4*Xt.getBBox().height};Xt.attr(Ci),X.push(Xt),Xt.placed=!0,Xt.alignAttr=Ci}getMaxLabelSize(){let q,l;return this.symbols.labels.forEach(function(p){l=p.getBBox(!0),q=q?l.width>q.width?l:q:l}),q||{}}formatLabel(q){let l=this.options,p=l.labels.formatter,y=l.labels.format,{numberFormatter:T}=this.chart;return y?fa.format(y,q,this.chart):p?p.call(q):T(q.value,1)}hideOverlappingLabels(){let q=this.chart,l=this.options.labels.allowOverlap,p=this.symbols;!l&&p&&(q.hideOverlappingLabels(p.labels),p.labels.forEach(function(y,T){y.newOpacity?y.newOpacity!==y.oldOpacity&&p.connectors[T].show():p.connectors[T].hide()}))}getRanges(){let q=this.legend.bubbleLegend,l=q.chart.series,p=q.options.ranges,y,T,A=Number.MAX_VALUE,P=-Number.MAX_VALUE;return l.forEach(function(I){I.isBubble&&!I.ignoreSeries&&(T=I.getColumn("z").filter(y_)).length&&(A=Rp(I.options.zMin,Math.min(A,Math.max(qm(T),I.options.displayNegative===!1?I.options.zThreshold:-Number.MAX_VALUE))),P=Rp(I.options.zMax,Math.max(P,O0(T))))}),y=A===P?[{value:P}]:[{value:A},{value:(A+P)/2},{value:P,autoRanges:!0}],p.length&&p[0].radius&&y.reverse(),y.forEach(function(I,B){p&&p[B]&&(y[B]=Vf(p[B],I))}),y}predictBubbleSizes(){let q=this.chart,l=q.legend.options,p=l.floating,y=l.layout==="horizontal",T=y?q.legend.lastLineHeight:0,A=q.plotSizeX,P=q.plotSizeY,I=q.series[this.options.seriesIndex],B=I.getPxExtremes(),X=Math.ceil(B.minPxSize),re=Math.ceil(B.maxPxSize),te=Math.min(P,A),pe,_e=I.options.maxSize;return p||!/%$/.test(_e)?pe=re:(pe=(te+T)*(_e=parseFloat(_e))/100/(_e/100+1),(y&&P-pe>=A||!y&&A-pe>=P)&&(pe=re)),[X,Math.ceil(pe)]}updateRanges(q,l){let p=this.legend.options.bubbleLegend;p.minSize=q,p.maxSize=l,p.ranges=this.getRanges()}correctSizes(){let q=this.legend,l=this.chart.series[this.options.seriesIndex].getPxExtremes();Math.abs(Math.ceil(l.maxPxSize)-this.options.maxSize)>1&&(this.updateRanges(this.options.minSize,l.maxPxSize),q.render())}},{setOptions:v_}=Ra,{composed:Rx}=pi,{addEvent:Bx,objectEach:q_,pushUnique:Z_,wrap:K_}=Ps;function J_(q,l,p){let y,T,A,P=this.legend,I=b_(this)>=0;P&&P.options.enabled&&P.bubbleLegend&&P.options.bubbleLegend.autoRanges&&I?(y=P.bubbleLegend.options,T=P.bubbleLegend.predictBubbleSizes(),P.bubbleLegend.updateRanges(T[0],T[1]),y.placed||(P.group.placed=!1,P.allItems.forEach(B=>{(A=B.legendItem||{}).group&&(A.group.translateY=void 0)})),P.render(),y.placed||(this.getMargins(),this.axes.forEach(B=>{B.setScale(),B.updateNames(),q_(B.ticks,function(X){X.isNew=!0,X.isNewLabel=!0})}),this.getMargins()),y.placed=!0,q.call(this,l,p),P.bubbleLegend.correctSizes(),T_(P,Q_(P))):(q.call(this,l,p),P&&P.options.enabled&&P.bubbleLegend&&(P.render(),T_(P,Q_(P))))}function b_(q){let l=q.series,p=0;for(;p<l.length;){if(l[p]&&l[p].isBubble&&l[p].visible&&l[p].dataTable.rowCount)return p;p++}return-1}function Q_(q){let l=q.allItems,p=[],y=l.length,T,A,P,I=0,B=0;for(I=0;I<y;I++)if(A=l[I].legendItem||{},P=(l[I+1]||{}).legendItem||{},A.labelHeight&&(l[I].itemHeight=A.labelHeight),l[I]===l[y-1]||A.y!==P.y){for(p.push({height:0}),T=p[p.length-1];B<=I;B++)l[B].itemHeight>T.height&&(T.height=l[B].itemHeight);T.step=I}return p}function w_(q){let l=this.bubbleLegend,p=this.options,y=p.bubbleLegend,T=b_(this.chart);l&&l.ranges&&l.ranges.length&&(y.ranges.length&&(y.autoRanges=!!y.ranges[0].autoRanges),this.destroyItem(l)),T>=0&&p.enabled&&y.enabled&&(y.seriesIndex=T,this.bubbleLegend=new __(y,this),this.bubbleLegend.addToLegend(q.allItems))}function D0(q){let l;if(q.defaultPrevented)return!1;let p=q.legendItem,y=this.chart,T=p.visible;this&&this.bubbleLegend&&(p.visible=!T,p.ignoreSeries=T,l=b_(y)>=0,this.bubbleLegend.visible!==l&&(this.update({bubbleLegend:{enabled:l}}),this.bubbleLegend.visible=l),p.visible=T)}function T_(q,l){let p=q.allItems,y=q.options.rtl,T,A,P,I,B=0;p.forEach((X,re)=>{(I=X.legendItem||{}).group&&(T=I.group.translateX||0,A=I.y||0,((P=X.movementX)||y&&X.ranges)&&(P=y?T-X.options.maxSize/2:T+P,I.group.attr({translateX:P})),re>l[B].step&&B++,I.group.attr({translateY:Math.round(A+l[B].height/2)}),I.y=A+l[B].height/2)})}let z0={compose:function(q,l){Z_(Rx,"Series.BubbleLegend")&&(v_({legend:{bubbleLegend:g_}}),K_(q.prototype,"drawChartBox",J_),Bx(l,"afterGetAllItems",w_),Bx(l,"itemClick",D0))}},{seriesTypes:{scatter:{prototype:{pointClass:e0}}}}=oo,{extend:t0}=Ps;class tx extends e0{haloPath(l){let p=(l&&this.marker&&this.marker.radius||0)+l;if(this.series.chart.inverted){let y=this.pos()||[0,0],{xAxis:T,yAxis:A,chart:P}=this.series,I=2*p;return P.renderer.symbols.circle(((T==null?void 0:T.len)||0)-y[1]-p,((A==null?void 0:A.len)||0)-y[0]-p,I,I)}return je.prototype.haloPath.call(this,p)}}t0(tx.prototype,{ttBelow:!1});let ix=tx,{composed:i0,noop:Fx}=pi,{series:s0,seriesTypes:{column:{prototype:r0},scatter:Zm}}=oo,{addEvent:sx,arrayMax:Nx,arrayMin:Vx,clamp:S_,extend:rx,isNumber:Qg,merge:ox,pick:Mg,pushUnique:R0}=Ps;function B0(){let q=this.len,{coll:l,isXAxis:p,min:y}=this,T=(this.max||0)-(y||0),A=0,P=q,I=q/T,B;(l==="xAxis"||l==="yAxis")&&(this.series.forEach(X=>{if(X.bubblePadding&&X.reserveSpace()){this.allowZoomOutside=!0,B=!0;let re=X.getColumn(p?"x":"y");if(p&&((X.onPoint||X).getRadii(0,0,X),X.onPoint&&(X.radii=X.onPoint.radii)),T>0){let te=re.length;for(;te--;)if(Qg(re[te])&&this.dataMin<=re[te]&&re[te]<=this.max){let pe=X.radii&&X.radii[te]||0;A=Math.min((re[te]-y)*I-pe,A),P=Math.max((re[te]-y)*I+pe,P)}}}}),B&&T>0&&!this.logarithmic&&(P-=q,I*=(q+Math.max(0,A)-Math.min(P,q))/q,[["min","userMin",A],["max","userMax",P]].forEach(X=>{Mg(this.options[X[0]],this[X[1]])===void 0&&(this[X[0]]+=X[2]/I)})))}function F0(){var P;let{ticks:q,tickPositions:l,dataMin:p=0,dataMax:y=0,categories:T}=this,A=this.options.type;if((T!=null&&T.length||A==="category")&&this.series.find(I=>I.bubblePadding)){let I=l.length;for(;I--;){let B=q[l[I]],X=B.pos||0;(X>y||X<p)&&((P=B.label)==null||P.hide())}}}class Ay extends Zm{static compose(l,p,y){z0.compose(p,y),R0(i0,"Series.Bubble")&&(sx(l,"foundExtremes",B0),sx(l,"afterRender",F0))}animate(l){!l&&this.points.length<this.options.animationLimit&&this.points.forEach(function(p){let{graphic:y,plotX:T=0,plotY:A=0}=p;y&&y.width&&(this.hasRendered||y.attr({x:T,y:A,width:1,height:1}),y.animate(this.markerAttribs(p),this.options.animation))},this)}getRadii(){let l=this.getColumn("z"),p=this.getColumn("y"),y=[],T,A,P,I=this.chart.bubbleZExtremes,{minPxSize:B,maxPxSize:X}=this.getPxExtremes();if(!I){let re,te=Number.MAX_VALUE,pe=-Number.MAX_VALUE;this.chart.series.forEach(_e=>{if(_e.bubblePadding&&_e.reserveSpace()){let Ee=(_e.onPoint||_e).getZExtremes();Ee&&(te=Math.min(Mg(te,Ee.zMin),Ee.zMin),pe=Math.max(Mg(pe,Ee.zMax),Ee.zMax),re=!0)}}),re?(I={zMin:te,zMax:pe},this.chart.bubbleZExtremes=I):I={zMin:0,zMax:0}}for(A=0,T=l.length;A<T;A++)P=l[A],y.push(this.getRadius(I.zMin,I.zMax,B,X,P,p&&p[A]));this.radii=y}getRadius(l,p,y,T,A,P){let I=this.options,B=I.sizeBy!=="width",X=I.zThreshold,re=p-l,te=.5;if(P===null||A===null)return null;if(Qg(A)){if(I.sizeByAbsoluteValue&&(A=Math.abs(A-X),p=re=Math.max(p-X,Math.abs(l-X)),l=0),A<l)return y/2-1;re>0&&(te=(A-l)/re)}return B&&te>=0&&(te=Math.sqrt(te)),Math.ceil(y+te*(T-y))/2}hasData(){return!!this.dataTable.rowCount}markerAttribs(l,p){let y=super.markerAttribs(l,p),{height:T=0,width:A=0}=y;return this.chart.inverted?rx(y,{x:(l.plotX||0)-A/2,y:(l.plotY||0)-T/2}):y}pointAttribs(l,p){let y=this.options.marker,T=y==null?void 0:y.fillOpacity,A=s0.prototype.pointAttribs.call(this,l,p);return A["fill-opacity"]=T??1,A}translate(){super.translate.call(this),this.getRadii(),this.translateBubble()}translateBubble(){let{data:l,options:p,radii:y}=this,{minPxSize:T}=this.getPxExtremes(),A=l.length;for(;A--;){let P=l[A],I=y?y[A]:0;this.zoneAxis==="z"&&(P.negative=(P.z||0)<(p.zThreshold||0)),Qg(I)&&I>=T/2?(P.marker=rx(P.marker,{radius:I,width:2*I,height:2*I}),P.dlBox={x:P.plotX-I,y:P.plotY-I,width:2*I,height:2*I}):(P.shapeArgs=P.plotY=P.dlBox=void 0,P.isInside=!1)}}getPxExtremes(){let l=Math.min(this.chart.plotWidth,this.chart.plotHeight),p=A=>{let P;return typeof A=="string"&&(P=/%$/.test(A),A=parseInt(A,10)),P?l*A/100:A},y=p(Mg(this.options.minSize,8)),T=Math.max(p(Mg(this.options.maxSize,"20%")),y);return{minPxSize:y,maxPxSize:T}}getZExtremes(){let l=this.options,p=this.getColumn("z").filter(Qg);if(p.length){let y=Mg(l.zMin,S_(Vx(p),l.displayNegative===!1?l.zThreshold||0:-Number.MAX_VALUE,Number.MAX_VALUE)),T=Mg(l.zMax,Nx(p));if(Qg(y)&&Qg(T))return{zMin:y,zMax:T}}}searchKDTree(l,p,y,T=Fx,A=Fx){return T=(P,I,B)=>{var _e,Ee;let X=P[B]||0,re=I[B]||0,te,pe=!1;return X===re?te=P.index>I.index?P:I:X<0&&re<0?(te=X-(((_e=P.marker)==null?void 0:_e.radius)||0)>=re-(((Ee=I.marker)==null?void 0:Ee.radius)||0)?P:I,pe=!0):te=X<re?P:I,[te,pe]},A=(P,I,B)=>!B&&P>I||P<I,super.searchKDTree(l,p,y,T,A)}}Ay.defaultOptions=ox(Zm.defaultOptions,{dataLabels:{formatter:function(){let{numberFormatter:q}=this.series.chart,{z:l}=this.point;return Qg(l)?q(l,-1):""},inside:!0,verticalAlign:"middle"},animationLimit:250,marker:{lineColor:null,lineWidth:1,fillOpacity:.5,radius:null,states:{hover:{radiusPlus:0}},symbol:"circle"},minSize:8,maxSize:"20%",softThreshold:!1,states:{hover:{halo:{size:5}}},tooltip:{pointFormat:"({point.x}, {point.y}), Size: {point.z}"},turboThreshold:0,zThreshold:0,zoneAxis:"z"}),rx(Ay.prototype,{alignDataLabel:r0.alignDataLabel,applyZones:Fx,bubblePadding:!0,isBubble:!0,keysAffectYAxis:["y"],pointArrayMap:["y","z"],pointClass:ix,parallelArrays:["x","y","z"],trackerGroups:["group","dataLabelsGroup"],specialGroup:"group",zoneAxis:"z"}),sx(Ay,"updatedData",q=>{delete q.target.chart.bubbleZExtremes}),sx(Ay,"remove",q=>{delete q.target.chart.bubbleZExtremes}),oo.registerSeriesType("bubble",Ay);let Ux=Ay,{seriesTypes:{map:{prototype:{pointClass:{prototype:o0}}}}}=oo,{extend:N0}=Ps;class n0 extends ix{isValid(){return typeof this.z=="number"}}N0(n0.prototype,{applyOptions:o0.applyOptions,getProjectedBounds:o0.getProjectedBounds});let{seriesTypes:{map:{prototype:ey},mappoint:{prototype:a0}}}=oo,{extend:wh,merge:l0}=Ps;class Ag extends Ux{constructor(){super(...arguments),this.clearBounds=ey.clearBounds}searchPoint(l,p){return this.searchKDTree({plotX:l.chartX-this.chart.plotLeft,plotY:l.chartY-this.chart.plotTop},p,l)}translate(){a0.translate.call(this),this.getRadii(),this.translateBubble()}}Ag.defaultOptions=l0(Ux.defaultOptions,{lineWidth:0,animationLimit:500,joinBy:"hc-key",tooltip:{pointFormat:"{point.name}: {point.z}"}}),wh(Ag.prototype,{type:"mapbubble",axisTypes:["colorAxis"],getProjectedBounds:ey.getProjectedBounds,isCartesian:!1,pointArrayMap:["z"],pointClass:n0,processData:ey.processData,projectPoint:a0.projectPoint,kdAxisArray:["plotX","plotY"],setData:ey.setData,setOptions:ey.setOptions,updateData:ey.updateData,useMapGeometry:!0,xyFromShape:!0}),oo.registerSeriesType("mapbubble",Ag);let{scatter:{prototype:{pointClass:V0}}}=oo.seriesTypes,{clamp:jx,defined:h0,extend:Gx,pick:c0}=Ps;class Wx extends V0{applyOptions(l,p){return(this.isNull||this.value===null)&&delete this.color,super.applyOptions(l,p),this.formatPrefix=this.isNull||this.value===null?"null":"point",this}getCellAttributes(){let l=this.series,p=l.options,y=(p.colsize||1)/2,T=(p.rowsize||1)/2,A=l.xAxis,P=l.yAxis,I=this.options.marker||l.options.marker,B=l.pointPlacementToXValue(),X=c0(this.pointPadding,p.pointPadding,0),re={x1:jx(Math.round(A.len-A.translate(this.x-y,!1,!0,!1,!0,-B)),-A.len,2*A.len),x2:jx(Math.round(A.len-A.translate(this.x+y,!1,!0,!1,!0,-B)),-A.len,2*A.len),y1:jx(Math.round(P.translate(this.y-T,!1,!0,!1,!0)),-P.len,2*P.len),y2:jx(Math.round(P.translate(this.y+T,!1,!0,!1,!0)),-P.len,2*P.len)};for(let te of[["width","x"],["height","y"]]){let pe=te[0],_e=te[1],Ee=_e+"1",De=_e+"2",Re=Math.abs(re[Ee]-re[De]),Be=I&&I.lineWidth||0,Ze=Math.abs(re[Ee]+re[De])/2,rt=I&&I[pe];if(h0(rt)&&rt<Re){let Yt=rt/2+Be/2;re[Ee]=Ze-Yt,re[De]=Ze+Yt}X&&((_e==="x"&&A.reversed||_e==="y"&&!P.reversed)&&(Ee=De,De=_e+"1"),re[Ee]+=X,re[De]-=X)}return re}haloPath(l){if(!l)return[];let{x:p=0,y=0,width:T=0,height:A=0}=this.shapeArgs||{};return[["M",p-l,y-l],["L",p-l,y+A+l],["L",p+T+l,y+A+l],["L",p+T+l,y-l],["Z"]]}isValid(){return this.value!==1/0&&this.value!==-1/0}}Gx(Wx.prototype,{dataLabelOnNull:!0,moveToTopOnHover:!0,ttBelow:!1});let{isNumber:ky}=Ps,{doc:ty}=pi,{defined:Hx,pick:Ey}=Ps,{series:Cy,seriesTypes:{column:Bp,scatter:iy}}=oo,{prototype:{symbols:Xx}}=Bc,{addEvent:kl,extend:nx,fireEvent:Py,isNumber:Iy,merge:Ly,pick:wm}=Ps,{colorFromPoint:M_,getContext:A_}={colorFromPoint:function(q,l){let p=l.series.colorAxis;if(p){let y=p.toColor(q||0,l).split(")")[0].split("(")[1].split(",").map(T=>Ey(parseFloat(T),parseInt(T,10)));return y[3]=255*Ey(y[3],1),Hx(q)&&l.visible||(y[3]=0),y}return[0,0,0,0]},getContext:function(q){let{canvas:l,context:p}=q;return l&&p?(p.clearRect(0,0,l.width,l.height),p):(q.canvas=ty.createElement("canvas"),q.context=q.canvas.getContext("2d",{willReadFrequently:!0})||void 0,q.context)}};class Oy extends iy{constructor(){super(...arguments),this.valueMax=NaN,this.valueMin=NaN,this.isDirtyCanvas=!0}drawPoints(){let l=this,p=l.options,y=p.interpolation,T=p.marker||{};if(y){let{image:A,chart:P,xAxis:I,yAxis:B}=l,{reversed:X=!1,len:re}=I,{reversed:te=!1,len:pe}=B,_e={width:re,height:pe};if(!A||l.isDirtyData||l.isDirtyCanvas){let Ee=A_(l),{canvas:De,options:{colsize:Re=1,rowsize:Be=1},points:Ze,points:{length:rt}}=l,Yt=P.colorAxis&&P.colorAxis[0];if(De&&Ee&&Yt){let{min:Ut,max:Xt}=I.getExtremes(),{min:Ci,max:di}=B.getExtremes(),vi=Xt-Ut,es=di-Ci,ws=Math.round(vi/Re/8*8),As=Math.round(es/Be/8*8),[$s,kr]=[[ws,ws/vi,X,"ceil"],[As,As/es,!te,"floor"]].map(([Qo,en,uc,gn])=>uc?va=>Math[gn](Qo-en*va):va=>Math[gn](en*va)),pr=De.width=ws+1,Vr=pr*(De.height=As+1),cr=(rt-1)/Vr,Zr=new Uint8ClampedArray(4*Vr),Cn=(Qo,en)=>4*Math.ceil(pr*kr(en-Ci)+$s(Qo-Ut));l.buildKDTree();for(let Qo=0;Qo<Vr;Qo++){let en=Ze[Math.ceil(cr*Qo)],{x:uc,y:gn}=en;Zr.set(M_(en.value,en),Cn(uc,gn))}Ee.putImageData(new ImageData(Zr,pr),0,0),A?A.attr({..._e,href:De.toDataURL("image/png",1)}):(l.directTouch=!1,l.image=P.renderer.image(De.toDataURL("image/png",1)).attr(_e).add(l.group))}l.isDirtyCanvas=!1}else(A.width!==re||A.height!==pe)&&A.attr(_e)}else(T.enabled||l._hasPointMarkers)&&(Cy.prototype.drawPoints.call(l),l.points.forEach(A=>{A.graphic&&(A.graphic[l.chart.styledMode?"css":"animate"](l.colorAttribs(A)),A.value===null&&A.graphic.addClass("highcharts-null-point"))}))}getExtremes(){let{dataMin:l,dataMax:p}=Cy.prototype.getExtremes.call(this,this.getColumn("value"));return Iy(l)&&(this.valueMin=l),Iy(p)&&(this.valueMax=p),Cy.prototype.getExtremes.call(this)}getValidPoints(l,p){return Cy.prototype.getValidPoints.call(this,l,p,!0)}hasData(){return!!this.dataTable.rowCount}init(){super.init.apply(this,arguments);let l=this.options;l.pointRange=wm(l.pointRange,l.colsize||1),this.yAxis.axisPointRange=l.rowsize||1,Xx.ellipse=Xx.circle,l.marker&&Iy(l.borderRadius)&&(l.marker.r=l.borderRadius)}markerAttribs(l,p){var T,A;let y=l.shapeArgs||{};if(l.hasImage)return{x:l.plotX,y:l.plotY};if(p&&p!=="normal"){let P=l.options.marker||{},I=this.options.marker||{},B=((T=I.states)==null?void 0:T[p])||{},X=((A=P.states)==null?void 0:A[p])||{},re=(X.width||B.width||y.width||0)+(X.widthPlus||B.widthPlus||0),te=(X.height||B.height||y.height||0)+(X.heightPlus||B.heightPlus||0);return{x:(y.x||0)+((y.width||0)-re)/2,y:(y.y||0)+((y.height||0)-te)/2,width:re,height:te}}return y}pointAttribs(l,p){var re,te,pe,_e,Ee,De;let y=Cy.prototype.pointAttribs.call(this,l,p),T=this.options||{},A=this.chart.options.plotOptions||{},P=A.series||{},I=A.heatmap||{},B=(l==null?void 0:l.options.borderColor)||T.borderColor||I.borderColor||P.borderColor,X=(l==null?void 0:l.options.borderWidth)||T.borderWidth||I.borderWidth||P.borderWidth||y["stroke-width"];if(y.stroke=((re=l==null?void 0:l.marker)==null?void 0:re.lineColor)||((te=T.marker)==null?void 0:te.lineColor)||B||this.color,y["stroke-width"]=X,p&&p!=="normal"){let Re=Ly((pe=T.states)==null?void 0:pe[p],(Ee=(_e=T.marker)==null?void 0:_e.states)==null?void 0:Ee[p],((De=l==null?void 0:l.options.states)==null?void 0:De[p])||{});y.fill=Re.color||at.parse(y.fill).brighten(Re.brightness||0).get(),y.stroke=Re.lineColor||y.stroke}return y}translate(){var P;let{borderRadius:l,marker:p}=this.options,y=(p==null?void 0:p.symbol)||"rect",T=Xx[y]?y:"rect",A=["circle","square"].indexOf(T)!==-1;for(let I of(this.generatePoints(),this.points)){let B=I.getCellAttributes(),X=Math.min(B.x1,B.x2),re=Math.min(B.y1,B.y2),te=Math.max(Math.abs(B.x2-B.x1),0),pe=Math.max(Math.abs(B.y2-B.y1),0);if(I.hasImage=(((P=I.marker)==null?void 0:P.symbol)||y).indexOf("url")===0,A){let _e=Math.abs(te-pe);X=Math.min(B.x1,B.x2)+(te<pe?0:_e/2),re=Math.min(B.y1,B.y2)+(te<pe?_e/2:0),te=pe=Math.min(te,pe)}I.hasImage&&(I.marker={width:te,height:pe}),I.plotX=I.clientX=(B.x1+B.x2)/2,I.plotY=(B.y1+B.y2)/2,I.shapeType="path",I.shapeArgs=Ly(!0,{x:X,y:re,width:te,height:pe},{d:Xx[T](X,re,te,pe,{r:Iy(l)?l:0})})}Py(this,"afterTranslate")}}Oy.defaultOptions=Ly(iy.defaultOptions,{animation:!1,borderRadius:0,borderWidth:0,interpolation:!1,nullColor:"#f7f7f7",dataLabels:{formatter:function(){let{numberFormatter:q}=this.series.chart,{value:l}=this.point;return ky(l)?q(l,-1):""},inside:!0,verticalAlign:"middle",crop:!1,overflow:"allow",padding:0},marker:{symbol:"rect",radius:0,lineColor:void 0,states:{hover:{lineWidthPlus:0},select:{}}},clip:!0,pointRange:null,tooltip:{pointFormat:"{point.x}, {point.y}: {point.value}<br/>"},states:{hover:{halo:!1,brightness:.2}},legendSymbol:"rectangle"}),kl(Oy,"afterDataClassLegendClick",function(){this.isDirtyCanvas=!0,this.drawPoints()}),nx(Oy.prototype,{axisTypes:aa.seriesMembers.axisTypes,colorKey:aa.seriesMembers.colorKey,directTouch:!0,getExtremesFromAll:!0,keysAffectYAxis:["y"],parallelArrays:aa.seriesMembers.parallelArrays,pointArrayMap:["y","value"],pointClass:Wx,specialGroup:"group",trackerGroups:aa.seriesMembers.trackerGroups,alignDataLabel:Bp.prototype.alignDataLabel,colorAttribs:aa.seriesMembers.colorAttribs,getSymbol:Cy.prototype.getSymbol}),aa.compose(Oy),oo.registerSeriesType("heatmap",Oy),pi.ColorMapComposition=aa,pi.MapChart=pi.MapChart||yd,pi.MapNavigation=pi.MapNavigation||ph,pi.MapView=pi.MapView||Nf,pi.Projection=pi.Projection||dc,pi.mapChart=pi.Map=pi.MapChart.mapChart,pi.maps=pi.MapChart.maps,pi.geojson=Wg.geojson,pi.topo2geo=Wg.topo2geo,Wg.compose(pi.Chart),Ag.compose(pi.Axis,pi.Chart,pi.Legend),ph.compose(yd,pi.Pointer,pi.SVGRenderer),Nf.compose(yd),pi.product="Highmaps";let sy=pi;return No.default})())}(Cv)),Cv.exports}ZA();var Pv={exports:{}},KA=Pv.exports,Dw;function JA(){return Dw||(Dw=1,function(ze,Je){(function(ot,Ht){ze.exports=Ht(ot._Highcharts,ot._Highcharts.Chart,ot._Highcharts.Axis,ot._Highcharts.Color,ot._Highcharts.SeriesRegistry,ot._Highcharts.RendererRegistry,ot._Highcharts.SVGRenderer,ot._Highcharts.SVGElement,ot._Highcharts.Templating,ot._Highcharts.Point,ot._Highcharts.StackItem)})(typeof window>"u"?KA:window,(ot,Ht,Qt,ni,Vi,a,Ni,Ui,is,Xs,Qi)=>(()=>{let xs,zs,hs;var _r,ar,Nr,Or,ir,fr,wo={28:Ge=>{Ge.exports=Ui},184:Ge=>{Ge.exports=Qi},260:Ge=>{Ge.exports=Xs},512:Ge=>{Ge.exports=Vi},532:Ge=>{Ge.exports=Qt},540:Ge=>{Ge.exports=Ni},608:Ge=>{Ge.exports=a},620:Ge=>{Ge.exports=ni},944:Ge=>{Ge.exports=ot},960:Ge=>{Ge.exports=Ht},984:Ge=>{Ge.exports=is}},rn={};function Pi(Ge){var J=rn[Ge];if(J!==void 0)return J.exports;var ge=rn[Ge]={exports:{}};return wo[Ge](ge,ge.exports,Pi),ge.exports}Pi.n=Ge=>{var J=Ge&&Ge.__esModule?()=>Ge.default:()=>Ge;return Pi.d(J,{a:J}),J},Pi.d=(Ge,J)=>{for(var ge in J)Pi.o(J,ge)&&!Pi.o(Ge,ge)&&Object.defineProperty(Ge,ge,{enumerable:!0,get:J[ge]})},Pi.o=(Ge,J)=>Object.prototype.hasOwnProperty.call(Ge,J);var fo={};Pi.d(fo,{default:()=>wp});var pl=Pi(944),Cs=Pi.n(pl);function Da(Ge,J,ge,xe){return[["M",Ge,J+xe/2],["L",Ge+ge,J],["L",Ge,J+xe/2],["L",Ge+ge,J+xe]]}function No(Ge,J,ge,xe){return Da(Ge,J,ge/2,xe)}function pi(Ge,J,ge,xe){return[["M",Ge+ge,J],["L",Ge,J+xe/2],["L",Ge+ge,J+xe],["Z"]]}function on(Ge,J,ge,xe){return pi(Ge,J,ge/2,xe)}let Io={compose:function(Ge){let J=Ge.prototype.symbols;J.arrow=Da,J["arrow-filled"]=pi,J["arrow-filled-half"]=on,J["arrow-half"]=No,J["triangle-left"]=pi,J["triangle-left-half"]=on}},{defined:Qn,error:fi,merge:xl,objectEach:gr}=Cs(),Kn=Cs().deg2rad,za=Math.max,Na=Math.min,Pl=class{constructor(Ge,J,ge){this.init(Ge,J,ge)}init(Ge,J,ge){this.fromPoint=Ge,this.toPoint=J,this.options=ge,this.chart=Ge.series.chart,this.pathfinder=this.chart.pathfinder}renderPath(Ge,J){let ge=this.chart,xe=ge.styledMode,Ie=this.pathfinder,je={},Ye=this.graphics&&this.graphics.path;Ie.group||(Ie.group=ge.renderer.g().addClass("highcharts-pathfinder-group").attr({zIndex:-1}).add(ge.seriesGroup)),Ie.group.translate(ge.plotLeft,ge.plotTop),!(Ye&&Ye.renderer)&&(Ye=ge.renderer.path().add(Ie.group),xe||Ye.attr({opacity:0})),Ye.attr(J),je.d=Ge,xe||(je.opacity=1),Ye.animate(je),this.graphics=this.graphics||{},this.graphics.path=Ye}addMarker(Ge,J,ge){let xe,Ie,je,Ye,mt,bt,Bt,gt=this.fromPoint.series.chart,Lt=gt.pathfinder,qe=gt.renderer,vt=Ge==="start"?this.fromPoint:this.toPoint,_t=vt.getPathfinderAnchorPoint(J);J.enabled&&((Bt=Ge==="start"?ge[1]:ge[ge.length-2])&&Bt[0]==="M"||Bt[0]==="L")&&(bt={x:Bt[1],y:Bt[2]},Ie=vt.getRadiansToVector(bt,_t),xe=vt.getMarkerVector(Ie,J.radius,_t),J.width&&J.height?(Ye=J.width,mt=J.height):Ye=mt=2*J.radius,this.graphics=this.graphics||{},je={x:xe.x-Ye/2,y:xe.y-mt/2,width:Ye,height:mt,rotation:-Ie/Kn,rotationOriginX:xe.x,rotationOriginY:xe.y},this.graphics[Ge]?this.graphics[Ge].animate(je):(this.graphics[Ge]=qe.symbol(J.symbol).addClass("highcharts-point-connecting-path-"+Ge+"-marker highcharts-color-"+this.fromPoint.colorIndex).attr(je).add(Lt.group),qe.styledMode||this.graphics[Ge].attr({fill:J.color||this.fromPoint.color,stroke:J.lineColor,"stroke-width":J.lineWidth,opacity:0}).animate({opacity:1},vt.series.options.animation)))}getPath(Ge){let J=this.pathfinder,ge=this.chart,xe=J.algorithms[Ge.type],Ie=J.chartObstacles;return typeof xe!="function"?(fi('"'+Ge.type+'" is not a Pathfinder algorithm.'),{path:[],obstacles:[]}):(xe.requiresObstacles&&!Ie&&(Ie=J.chartObstacles=J.getChartObstacles(Ge),ge.options.connectors.algorithmMargin=Ge.algorithmMargin,J.chartObstacleMetrics=J.getObstacleMetrics(Ie)),xe(this.fromPoint.getPathfinderAnchorPoint(Ge.startMarker),this.toPoint.getPathfinderAnchorPoint(Ge.endMarker),xl({chartObstacles:Ie,lineObstacles:J.lineObstacles||[],obstacleMetrics:J.chartObstacleMetrics,hardBounds:{xMin:0,xMax:ge.plotWidth,yMin:0,yMax:ge.plotHeight},obstacleOptions:{margin:Ge.algorithmMargin},startDirectionX:J.getAlgorithmStartDirection(Ge.startMarker)},Ge)))}render(){let Ge=this.fromPoint,J=Ge.series,ge=J.chart,xe=ge.pathfinder,Ie={},je=xl(ge.options.connectors,J.options.connectors,Ge.options.connectors,this.options);!ge.styledMode&&(Ie.stroke=je.lineColor||Ge.color,Ie["stroke-width"]=je.lineWidth,je.dashStyle&&(Ie.dashstyle=je.dashStyle)),Ie.class="highcharts-point-connecting-path highcharts-color-"+Ge.colorIndex,Qn((je=xl(Ie,je)).marker.radius)||(je.marker.radius=Na(za(Math.ceil((je.algorithmMargin||8)/2)-1,1),5));let Ye=this.getPath(je),mt=Ye.path;Ye.obstacles&&(xe.lineObstacles=xe.lineObstacles||[],xe.lineObstacles=xe.lineObstacles.concat(Ye.obstacles)),this.renderPath(mt,Ie),this.addMarker("start",xl(je.marker,je.startMarker),mt),this.addMarker("end",xl(je.marker,je.endMarker),mt)}destroy(){this.graphics&&(gr(this.graphics,function(Ge){Ge.destroy()}),delete this.graphics)}},{composed:Lo}=Cs(),{addEvent:Zo,merge:pa,pushUnique:Ul,wrap:mo}=Cs(),ql={color:"#ccd3ff",width:2,label:{format:"%[abdYHM]",formatter:function(Ge,J){return this.axis.chart.time.dateFormat(J||"",Ge,!0)},rotation:0,style:{fontSize:"0.7em"}}};function Sh(){let Ge=this.options,J=Ge.currentDateIndicator;if(J){let ge=typeof J=="object"?pa(ql,J):pa(ql);ge.value=Date.now(),ge.className="highcharts-current-date-indicator",Ge.plotLines||(Ge.plotLines=[]),Ge.plotLines.push(ge)}}function Wh(){this.label&&this.label.attr({text:this.getLabelText(this.options.label)})}function Qs(Ge,J){let ge=this.options;return ge&&ge.className&&ge.className.indexOf("highcharts-current-date-indicator")!==-1&&ge.label&&typeof ge.label.formatter=="function"?(ge.value=Date.now(),ge.label.formatter.call(this,ge.value,ge.label.format)):Ge.call(this,J)}var Ic=Pi(960),_l=Pi.n(Ic);let{defaultOptions:qa}=Cs(),{isArray:Lc,merge:wd,splat:Ps}=Cs();class nl extends _l(){init(J,ge){let xe,Ie=J.xAxis,je=J.yAxis;J.xAxis=J.yAxis=void 0;let Ye=wd(!0,{chart:{type:"gantt"},title:{text:""},legend:{enabled:!1},navigator:{series:{type:"gantt"},yAxis:{type:"category"}}},J,{isGantt:!0});J.xAxis=Ie,J.yAxis=je,Ye.xAxis=(Lc(J.xAxis)?J.xAxis:[J.xAxis||{},{}]).map((mt,bt)=>{var Bt,gt,Lt;return bt===1&&(xe=0),wd({grid:{borderColor:((gt=(Bt=qa.xAxis)==null?void 0:Bt.grid)==null?void 0:gt.borderColor)||"#cccccc",enabled:!0},opposite:((Lt=qa.xAxis)==null?void 0:Lt.opposite)??mt.opposite??!0,linkedTo:xe},mt,{type:"datetime"})}),Ye.yAxis=Ps(J.yAxis||{}).map(mt=>{var bt,Bt;return wd({grid:{borderColor:((Bt=(bt=qa.yAxis)==null?void 0:bt.grid)==null?void 0:Bt.borderColor)||"#cccccc",enabled:!0},staticScale:50,reversed:!0,type:mt.categories?mt.type:"treegrid"},mt)}),super.init(Ye,ge)}}(function(Ge){Ge.ganttChart=function(J,ge,xe){return new Ge(J,ge,xe)}})(nl||(nl={}));let jl=nl;var Kc=Pi(532),Gs=Pi.n(Kc);let{isTouchDevice:zn}=Cs(),{addEvent:Gl,merge:fc,pick:al}=Cs(),Gd=[];function Oc(){this.navigator&&this.navigator.setBaseSeries(null,!1)}function mh(){var je;let Ge,J,ge,xe=this.legend,Ie=this.navigator;if(Ie){Ge=xe&&xe.options,J=Ie.xAxis,ge=Ie.yAxis;let{scrollbarHeight:Ye,scrollButtonSize:mt}=Ie;this.inverted?(Ie.left=Ie.opposite?this.chartWidth-Ye-Ie.height:this.spacing[3]+Ye,Ie.top=this.plotTop+mt):(Ie.left=al(J.left,this.plotLeft+mt),Ie.top=Ie.navigatorOptions.top||this.chartHeight-Ie.height-Ye-(((je=this.scrollbar)==null?void 0:je.options.margin)||0)-this.spacing[2]-(this.rangeSelector&&this.extraBottomMargin?this.rangeSelector.getHeight():0)-(Ge&&Ge.verticalAlign==="bottom"&&Ge.layout!=="proximate"&&Ge.enabled&&!Ge.floating?xe.legendHeight+al(Ge.margin,10):0)-(this.titleOffset?this.titleOffset[2]:0)),J&&ge&&(this.inverted?J.options.left=ge.options.left=Ie.left:J.options.top=ge.options.top=Ie.top,J.setAxisSize(),ge.setAxisSize())}}function ll(Ge){!this.navigator&&!this.scroller&&(this.options.navigator.enabled||this.options.scrollbar.enabled)&&(this.scroller=this.navigator=new xs(this),al(Ge.redraw,!0)&&this.redraw(Ge.animation))}function Mh(){let Ge=this.options;(Ge.navigator.enabled||Ge.scrollbar.enabled)&&(this.scroller=this.navigator=new xs(this))}function Sa(){let Ge=this.options,J=Ge.navigator,ge=Ge.rangeSelector;if((J&&J.enabled||ge&&ge.enabled)&&(!zn&&this.zooming.type==="x"||zn&&this.zooming.pinchType==="x"))return!1}function Wl(Ge){let J=Ge.navigator;if(J&&Ge.xAxis[0]){let ge=Ge.xAxis[0].getExtremes();J.render(ge.min,ge.max)}}function Tu(Ge){let J=Ge.options.navigator||{},ge=Ge.options.scrollbar||{};!this.navigator&&!this.scroller&&(J.enabled||ge.enabled)&&(fc(!0,this.options.navigator,J),fc(!0,this.options.scrollbar,ge),delete Ge.options.navigator,delete Ge.options.scrollbar)}let Jc={compose:function(Ge,J){if(Cs().pushUnique(Gd,Ge)){let ge=Ge.prototype;xs=J,ge.callbacks.push(Wl),Gl(Ge,"afterAddSeries",Oc),Gl(Ge,"afterSetChartSize",mh),Gl(Ge,"afterUpdate",ll),Gl(Ge,"beforeRender",Mh),Gl(Ge,"beforeShowResetZoom",Sa),Gl(Ge,"update",Tu)}}},{isTouchDevice:Td}=Cs(),{addEvent:To,correctFloat:Rn,defined:Za,isNumber:Hl,pick:mc}=Cs();function Va(){this.navigatorAxis||(this.navigatorAxis=new Wi(this))}function Zl(Ge){let J,ge=this.chart,xe=ge.options,Ie=xe.navigator,je=this.navigatorAxis,Ye=ge.zooming.pinchType,mt=xe.rangeSelector,bt=ge.zooming.type;if(this.isXAxis&&(Ie!=null&&Ie.enabled||mt!=null&&mt.enabled)){if(bt==="y"&&Ge.trigger==="zoom")J=!1;else if((Ge.trigger==="zoom"&&bt==="xy"||Td&&Ye==="xy")&&this.options.range){let Bt=je.previousZoom;Za(Ge.min)?je.previousZoom=[this.min,this.max]:Bt&&(Ge.min=Bt[0],Ge.max=Bt[1],je.previousZoom=void 0)}}J!==void 0&&Ge.preventDefault()}class Wi{static compose(J){J.keepProps.includes("navigatorAxis")||(J.keepProps.push("navigatorAxis"),To(J,"init",Va),To(J,"setExtremes",Zl))}constructor(J){this.axis=J}destroy(){this.axis=void 0}toFixedRange(J,ge,xe,Ie){let je=this.axis,Ye=(je.pointRange||0)/2,mt=mc(xe,je.translate(J,!0,!je.horiz)),bt=mc(Ie,je.translate(ge,!0,!je.horiz));return Za(xe)||(mt=Rn(mt+Ye)),Za(Ie)||(bt=Rn(bt-Ye)),Hl(mt)&&Hl(bt)||(mt=bt=void 0),{min:mt,max:bt}}}var Ra=Pi(620),pp=Pi.n(Ra),vl=Pi(512),lr=Pi.n(vl);let{parse:ei}=pp(),{seriesTypes:Oe}=lr(),We={height:40,margin:22,maskInside:!0,handles:{width:7,borderRadius:0,height:15,symbols:["navigator-handle","navigator-handle"],enabled:!0,lineWidth:1,backgroundColor:"#f2f2f2",borderColor:"#999999"},maskFill:ei("#667aff").setOpacity(.3).get(),outlineColor:"#999999",outlineWidth:1,series:{type:Oe.areaspline===void 0?"line":"areaspline",fillOpacity:.05,lineWidth:1,compare:null,sonification:{enabled:!1},dataGrouping:{approximation:"average",enabled:!0,groupPixelWidth:2,firstAnchor:"firstPoint",anchor:"middle",lastAnchor:"lastPoint",units:[["millisecond",[1,2,5,10,20,25,50,100,200,500]],["second",[1,2,5,10,15,30]],["minute",[1,2,5,10,15,30]],["hour",[1,2,3,4,6,8,12]],["day",[1,2,3,4]],["week",[1,2,3]],["month",[1,3,6]],["year",null]]},dataLabels:{enabled:!1,zIndex:2},id:"highcharts-navigator-series",className:"highcharts-navigator-series",lineColor:null,marker:{enabled:!1},threshold:null},xAxis:{className:"highcharts-navigator-xaxis",tickLength:0,lineWidth:0,gridLineColor:"#e6e6e6",id:"navigator-x-axis",gridLineWidth:1,tickPixelInterval:200,labels:{align:"left",style:{color:"#000000",fontSize:"0.7em",opacity:.6,textOutline:"2px contrast"},x:3,y:-4},crosshair:!1},yAxis:{className:"highcharts-navigator-yaxis",gridLineWidth:0,startOnTick:!1,endOnTick:!1,minPadding:.1,id:"navigator-y-axis",maxPadding:.1,labels:{enabled:!1},crosshair:!1,title:{text:void 0},tickLength:0,tickWidth:0}},{defined:ct,isNumber:Et,pick:at}=Cs(),zt={rect:function(Ge,J,ge,xe,Ie){return Ie!=null&&Ie.r?function(je,Ye,mt,bt,Bt){let gt=(Bt==null?void 0:Bt.r)||0;return[["M",je+gt,Ye],["L",je+mt-gt,Ye],["A",gt,gt,0,0,1,je+mt,Ye+gt],["L",je+mt,Ye+bt-gt],["A",gt,gt,0,0,1,je+mt-gt,Ye+bt],["L",je+gt,Ye+bt],["A",gt,gt,0,0,1,je,Ye+bt-gt],["L",je,Ye+gt],["A",gt,gt,0,0,1,je+gt,Ye],["Z"]]}(Ge,J,ge,xe,Ie):[["M",Ge,J],["L",Ge+ge,J],["L",Ge+ge,J+xe],["L",Ge,J+xe],["Z"]]}},{relativeLength:oi}=Cs(),jt={"navigator-handle":function(Ge,J,ge,xe,Ie={}){let je=Ie.width?Ie.width/2:ge,Ye=oi(Ie.borderRadius||0,Math.min(2*je,xe));return[["M",-1.5,(xe=Ie.height||xe)/2-3.5],["L",-1.5,xe/2+4.5],["M",.5,xe/2-3.5],["L",.5,xe/2+4.5],...zt.rect(-je-1,.5,2*je+1,xe,{r:Ye})]}};var qt=Pi(608),gi=Pi.n(qt);let{defined:li}=Cs(),{defaultOptions:Zi}=Cs(),{composed:Ss}=Cs(),{getRendererType:ds}=gi(),{setFixedRange:Ws}={setFixedRange:function(Ge){let J=this.xAxis[0];li(J.dataMax)&&li(J.dataMin)&&Ge?this.fixedRange=Math.min(Ge,J.dataMax-J.dataMin):this.fixedRange=Ge}},{addEvent:mr,extend:vr,pushUnique:Rr}=Cs();function Ar(){this.chart.navigator&&!this.options.isInternal&&this.chart.navigator.setBaseSeries(null,!1)}let Ko={compose:function(Ge,J,ge){Wi.compose(J),Rr(Ss,"Navigator")&&(Ge.prototype.setFixedRange=Ws,vr(ds().prototype.symbols,jt),vr(Zi,{navigator:We}),mr(ge,"afterUpdate",Ar))}},{composed:to}=Cs(),{addEvent:nn,defined:ao,pick:lo,pushUnique:Oo}=Cs();(function(Ge){let J;function ge(Ye){var Bt,gt;let mt=lo((Bt=Ye.options)==null?void 0:Bt.min,Ye.min),bt=lo((gt=Ye.options)==null?void 0:gt.max,Ye.max);return{axisMin:mt,axisMax:bt,scrollMin:ao(Ye.dataMin)?Math.min(mt,Ye.min,Ye.dataMin,lo(Ye.threshold,1/0)):mt,scrollMax:ao(Ye.dataMax)?Math.max(bt,Ye.max,Ye.dataMax,lo(Ye.threshold,-1/0)):bt}}function xe(){let Ye=this.scrollbar,mt=Ye&&!Ye.options.opposite,bt=this.horiz?2:mt?3:1;Ye&&(this.chart.scrollbarsOffsets=[0,0],this.chart.axisOffset[bt]+=Ye.size+(Ye.options.margin||0))}function Ie(){var mt,bt;let Ye=this;(bt=(mt=Ye.options)==null?void 0:mt.scrollbar)!=null&&bt.enabled&&(Ye.options.scrollbar.vertical=!Ye.horiz,Ye.options.startOnTick=Ye.options.endOnTick=!1,Ye.scrollbar=new J(Ye.chart.renderer,Ye.options.scrollbar,Ye.chart),nn(Ye.scrollbar,"changed",function(Bt){let gt,Lt,{axisMin:qe,axisMax:vt,scrollMin:_t,scrollMax:Wt}=ge(Ye),Gt=Wt-_t;if(ao(qe)&&ao(vt))if(Ye.horiz&&!Ye.reversed||!Ye.horiz&&Ye.reversed?(gt=_t+Gt*this.to,Lt=_t+Gt*this.from):(gt=_t+Gt*(1-this.from),Lt=_t+Gt*(1-this.to)),this.shouldUpdateExtremes(Bt.DOMType)){let Vt=Bt.DOMType!=="mousemove"&&Bt.DOMType!=="touchmove"&&void 0;Ye.setExtremes(Lt,gt,!0,Vt,Bt)}else this.setRange(this.from,this.to)}))}function je(){let Ye,mt,bt,{scrollMin:Bt,scrollMax:gt}=ge(this),Lt=this.scrollbar,qe=this.axisTitleMargin+(this.titleOffset||0),vt=this.chart.scrollbarsOffsets,_t=this.options.margin||0;if(Lt&&vt){if(this.horiz)this.opposite||(vt[1]+=qe),Lt.position(this.left,this.top+this.height+2+vt[1]-(this.opposite?_t:0),this.width,this.height),this.opposite||(vt[1]+=_t),Ye=1;else{let Wt;this.opposite&&(vt[0]+=qe),Wt=Lt.options.opposite?this.left+this.width+2+vt[0]-(this.opposite?0:_t):this.opposite?0:_t,Lt.position(Wt,this.top,this.width,this.height),this.opposite&&(vt[0]+=_t),Ye=0}if(vt[Ye]+=Lt.size+(Lt.options.margin||0),isNaN(Bt)||isNaN(gt)||!ao(this.min)||!ao(this.max)||this.dataMin===this.dataMax)Lt.setRange(0,1);else if(this.min===this.max){let Wt=this.pointRange/(this.dataMax+1);mt=Wt*this.min,bt=Wt*(this.max+1),Lt.setRange(mt,bt)}else mt=(this.min-Bt)/(gt-Bt),bt=(this.max-Bt)/(gt-Bt),this.horiz&&!this.reversed||!this.horiz&&this.reversed?Lt.setRange(mt,bt):Lt.setRange(1-bt,1-mt)}}Ge.compose=function(Ye,mt){Oo(to,"Axis.Scrollbar")&&(J=mt,nn(Ye,"afterGetOffset",xe),nn(Ye,"afterInit",Ie),nn(Ye,"afterRender",je))}})(_r||(_r={}));let fn=_r,un={height:10,barBorderRadius:5,buttonBorderRadius:0,buttonsEnabled:!1,liveRedraw:void 0,margin:void 0,minWidth:6,opposite:!0,step:.2,zIndex:3,barBackgroundColor:"#cccccc",barBorderWidth:0,barBorderColor:"#cccccc",buttonArrowColor:"#333333",buttonBackgroundColor:"#e6e6e6",buttonBorderColor:"#cccccc",buttonBorderWidth:1,rifleColor:"none",trackBackgroundColor:"rgba(255, 255, 255, 0.001)",trackBorderColor:"#cccccc",trackBorderRadius:5,trackBorderWidth:1},{defaultOptions:Ka}=Cs(),{composed:an}=Cs(),{addEvent:Il,correctFloat:Hh,crisp:Ua,defined:Xh,destroyObjectProperties:fp,extend:Gn,fireEvent:Yh,merge:Sd,pick:Wd,pushUnique:Wn,removeEvent:$u}=Cs();class Ah{static compose(J){fn.compose(J,Ah),Wn(an,"Scrollbar")&&Gn(Ka,{scrollbar:un})}static swapXY(J,ge){return ge&&J.forEach(xe=>{let Ie,je=xe.length;for(let Ye=0;Ye<je;Ye+=2)typeof(Ie=xe[Ye+1])=="number"&&(xe[Ye+1]=xe[Ye+2],xe[Ye+2]=Ie)}),J}constructor(J,ge,xe){this._events=[],this.chartX=0,this.chartY=0,this.from=0,this.scrollbarButtons=[],this.scrollbarLeft=0,this.scrollbarStrokeWidth=1,this.scrollbarTop=0,this.size=0,this.to=0,this.trackBorderWidth=1,this.x=0,this.y=0,this.init(J,ge,xe)}addEvents(){let J=this.options.inverted?[1,0]:[0,1],ge=this.scrollbarButtons,xe=this.scrollbarGroup.element,Ie=this.track.element,je=this.mouseDownHandler.bind(this),Ye=this.mouseMoveHandler.bind(this),mt=this.mouseUpHandler.bind(this),bt=[[ge[J[0]].element,"click",this.buttonToMinClick.bind(this)],[ge[J[1]].element,"click",this.buttonToMaxClick.bind(this)],[Ie,"click",this.trackClick.bind(this)],[xe,"mousedown",je],[xe.ownerDocument,"mousemove",Ye],[xe.ownerDocument,"mouseup",mt],[xe,"touchstart",je],[xe.ownerDocument,"touchmove",Ye],[xe.ownerDocument,"touchend",mt]];bt.forEach(function(Bt){Il.apply(null,Bt)}),this._events=bt}buttonToMaxClick(J){let ge=(this.to-this.from)*Wd(this.options.step,.2);this.updatePosition(this.from+ge,this.to+ge),Yh(this,"changed",{from:this.from,to:this.to,trigger:"scrollbar",DOMEvent:J})}buttonToMinClick(J){let ge=Hh(this.to-this.from)*Wd(this.options.step,.2);this.updatePosition(Hh(this.from-ge),Hh(this.to-ge)),Yh(this,"changed",{from:this.from,to:this.to,trigger:"scrollbar",DOMEvent:J})}cursorToScrollbarPosition(J){let ge=this.options,xe=ge.minWidth>this.calculatedWidth?ge.minWidth:0;return{chartX:(J.chartX-this.x-this.xOffset)/(this.barWidth-xe),chartY:(J.chartY-this.y-this.yOffset)/(this.barWidth-xe)}}destroy(){let J=this,ge=J.chart.scroller;J.removeEvents(),["track","scrollbarRifles","scrollbar","scrollbarGroup","group"].forEach(function(xe){J[xe]&&J[xe].destroy&&(J[xe]=J[xe].destroy())}),ge&&J===ge.scrollbar&&(ge.scrollbar=null,fp(ge.scrollbarButtons))}drawScrollbarButton(J){let ge=this.renderer,xe=this.scrollbarButtons,Ie=this.options,je=this.size,Ye=ge.g().add(this.group);if(xe.push(Ye),Ie.buttonsEnabled){let mt=ge.rect().addClass("highcharts-scrollbar-button").add(Ye);this.chart.styledMode||mt.attr({stroke:Ie.buttonBorderColor,"stroke-width":Ie.buttonBorderWidth,fill:Ie.buttonBackgroundColor}),mt.attr(mt.crisp({x:-.5,y:-.5,width:je,height:je,r:Ie.buttonBorderRadius},mt.strokeWidth()));let bt=ge.path(Ah.swapXY([["M",je/2+(J?-1:1),je/2-3],["L",je/2+(J?-1:1),je/2+3],["L",je/2+(J?2:-2),je/2]],Ie.vertical)).addClass("highcharts-scrollbar-arrow").add(xe[J]);this.chart.styledMode||bt.attr({fill:Ie.buttonArrowColor})}}init(J,ge,xe){this.scrollbarButtons=[],this.renderer=J,this.userOptions=ge,this.options=Sd(un,Ka.scrollbar,ge),this.options.margin=Wd(this.options.margin,10),this.chart=xe,this.size=Wd(this.options.size,this.options.height),ge.enabled&&(this.render(),this.addEvents())}mouseDownHandler(J){var Ie;let ge=((Ie=this.chart.pointer)==null?void 0:Ie.normalize(J))||J,xe=this.cursorToScrollbarPosition(ge);this.chartX=xe.chartX,this.chartY=xe.chartY,this.initPositions=[this.from,this.to],this.grabbedCenter=!0}mouseMoveHandler(J){var Ye;let ge,xe=((Ye=this.chart.pointer)==null?void 0:Ye.normalize(J))||J,Ie=this.options.vertical?"chartY":"chartX",je=this.initPositions||[];this.grabbedCenter&&(!J.touches||J.touches[0][Ie]!==0)&&(ge=this.cursorToScrollbarPosition(xe)[Ie]-this[Ie],this.hasDragged=!0,this.updatePosition(je[0]+ge,je[1]+ge),this.hasDragged&&Yh(this,"changed",{from:this.from,to:this.to,trigger:"scrollbar",DOMType:J.type,DOMEvent:J}))}mouseUpHandler(J){this.hasDragged&&Yh(this,"changed",{from:this.from,to:this.to,trigger:"scrollbar",DOMType:J.type,DOMEvent:J}),this.grabbedCenter=this.hasDragged=this.chartX=this.chartY=null}position(J,ge,xe,Ie){let{buttonsEnabled:je,margin:Ye=0,vertical:mt}=this.options,bt=this.rendered?"animate":"attr",Bt=Ie,gt=0;this.group.show(),this.x=J,this.y=ge+this.trackBorderWidth,this.width=xe,this.height=Ie,this.xOffset=Bt,this.yOffset=gt,mt?(this.width=this.yOffset=xe=gt=this.size,this.xOffset=Bt=0,this.yOffset=gt=je?this.size:0,this.barWidth=Ie-(je?2*xe:0),this.x=J+=Ye):(this.height=Ie=this.size,this.xOffset=Bt=je?this.size:0,this.barWidth=xe-(je?2*Ie:0),this.y=this.y+Ye),this.group[bt]({translateX:J,translateY:this.y}),this.track[bt]({width:xe,height:Ie}),this.scrollbarButtons[1][bt]({translateX:mt?0:xe-Bt,translateY:mt?Ie-gt:0})}removeEvents(){this._events.forEach(function(J){$u.apply(null,J)}),this._events.length=0}render(){let J=this.renderer,ge=this.options,xe=this.size,Ie=this.chart.styledMode,je=J.g("scrollbar").attr({zIndex:ge.zIndex}).hide().add();this.group=je,this.track=J.rect().addClass("highcharts-scrollbar-track").attr({r:ge.trackBorderRadius||0,height:xe,width:xe}).add(je),Ie||this.track.attr({fill:ge.trackBackgroundColor,stroke:ge.trackBorderColor,"stroke-width":ge.trackBorderWidth});let Ye=this.trackBorderWidth=this.track.strokeWidth();this.track.attr({x:-Ua(0,Ye),y:-Ua(0,Ye)}),this.scrollbarGroup=J.g().add(je),this.scrollbar=J.rect().addClass("highcharts-scrollbar-thumb").attr({height:xe-Ye,width:xe-Ye,r:ge.barBorderRadius||0}).add(this.scrollbarGroup),this.scrollbarRifles=J.path(Ah.swapXY([["M",-3,xe/4],["L",-3,2*xe/3],["M",0,xe/4],["L",0,2*xe/3],["M",3,xe/4],["L",3,2*xe/3]],ge.vertical)).addClass("highcharts-scrollbar-rifles").add(this.scrollbarGroup),Ie||(this.scrollbar.attr({fill:ge.barBackgroundColor,stroke:ge.barBorderColor,"stroke-width":ge.barBorderWidth}),this.scrollbarRifles.attr({stroke:ge.rifleColor,"stroke-width":1})),this.scrollbarStrokeWidth=this.scrollbar.strokeWidth(),this.scrollbarGroup.translate(-Ua(0,this.scrollbarStrokeWidth),-Ua(0,this.scrollbarStrokeWidth)),this.drawScrollbarButton(0),this.drawScrollbarButton(1)}setRange(J,ge){let xe,Ie,je=this.options,Ye=je.vertical,mt=je.minWidth,bt=this.barWidth,Bt=!this.rendered||this.hasDragged||this.chart.navigator&&this.chart.navigator.hasDragged?"attr":"animate";if(!Xh(bt))return;let gt=bt*Math.min(ge,1);xe=Math.ceil(bt*(J=Math.max(J,0))),this.calculatedWidth=Ie=Hh(gt-xe),Ie<mt&&(xe=(bt-mt+Ie)*J,Ie=mt);let Lt=Math.floor(xe+this.xOffset+this.yOffset),qe=Ie/2-.5;this.from=J,this.to=ge,Ye?(this.scrollbarGroup[Bt]({translateY:Lt}),this.scrollbar[Bt]({height:Ie}),this.scrollbarRifles[Bt]({translateY:qe}),this.scrollbarTop=Lt,this.scrollbarLeft=0):(this.scrollbarGroup[Bt]({translateX:Lt}),this.scrollbar[Bt]({width:Ie}),this.scrollbarRifles[Bt]({translateX:qe}),this.scrollbarLeft=Lt,this.scrollbarTop=0),Ie<=12?this.scrollbarRifles.hide():this.scrollbarRifles.show(),je.showFull===!1&&(J<=0&&ge>=1?this.group.hide():this.group.show()),this.rendered=!0}shouldUpdateExtremes(J){return Wd(this.options.liveRedraw,Cs().svg&&!Cs().isTouchDevice&&!this.chart.boosted)||J==="mouseup"||J==="touchend"||!Xh(J)}trackClick(J){var Ye;let ge=((Ye=this.chart.pointer)==null?void 0:Ye.normalize(J))||J,xe=this.to-this.from,Ie=this.y+this.scrollbarTop,je=this.x+this.scrollbarLeft;this.options.vertical&&ge.chartY>Ie||!this.options.vertical&&ge.chartX>je?this.updatePosition(this.from+xe,this.to+xe):this.updatePosition(this.from-xe,this.to-xe),Yh(this,"changed",{from:this.from,to:this.to,trigger:"scrollbar",DOMEvent:J})}update(J){this.destroy(),this.init(this.chart.renderer,Sd(!0,this.options,J),this.chart)}updatePosition(J,ge){ge>1&&(J=Hh(1-Hh(ge-J)),ge=1),J<0&&(ge=Hh(ge-J),J=0),this.from=J,this.to=ge}}Ah.defaultOptions=un;var $h=Pi(540),gh=Pi.n($h);let{defaultOptions:Kl}=Cs(),{isTouchDevice:Qc}=Cs(),{prototype:{symbols:Ma}}=gh(),{addEvent:yn,clamp:Hd,correctFloat:bl,defined:qh,destroyObjectProperties:Zh,erase:fa,extend:Xd,find:qu,fireEvent:Ll,isArray:ja,isNumber:Bn,merge:kh,pick:Xl,removeEvent:mp,splat:Dc}=Cs();function Gr(Ge,...J){let ge=[].filter.call(J,Bn);if(ge.length)return Math[Ge].apply(0,ge)}class Eh{static compose(J,ge,xe){Jc.compose(J,Eh),Ko.compose(J,ge,xe)}constructor(J){this.isDirty=!1,this.scrollbarHeight=0,this.init(J)}drawHandle(J,ge,xe,Ie){let je=this.navigatorOptions.handles.height;this.handles[ge][Ie](xe?{translateX:Math.round(this.left+this.height/2),translateY:Math.round(this.top+parseInt(J,10)+.5-je)}:{translateX:Math.round(this.left+parseInt(J,10)),translateY:Math.round(this.top+this.height/2-je/2-1)})}drawOutline(J,ge,xe,Ie){let je=this.navigatorOptions.maskInside,Ye=this.outline.strokeWidth(),mt=Ye/2,bt=Ye%2/2,Bt=this.scrollButtonSize,gt=this.size,Lt=this.top,qe=this.height,vt=Lt-mt,_t=Lt+qe,Wt=this.left,Gt,Vt;xe?(Gt=Lt+ge+bt,ge=Lt+J+bt,Vt=[["M",Wt+qe,Lt-Bt-bt],["L",Wt+qe,Gt],["L",Wt,Gt],["M",Wt,ge],["L",Wt+qe,ge],["L",Wt+qe,Lt+gt+Bt]],je&&Vt.push(["M",Wt+qe,Gt-mt],["L",Wt+qe,ge+mt])):(Wt-=Bt,J+=Wt+Bt-bt,ge+=Wt+Bt-bt,Vt=[["M",Wt,vt],["L",J,vt],["L",J,_t],["M",ge,_t],["L",ge,vt],["L",Wt+gt+2*Bt,vt]],je&&Vt.push(["M",J-mt,vt],["L",ge+mt,vt])),this.outline[Ie]({d:Vt})}drawMasks(J,ge,xe,Ie){let je,Ye,mt,bt,Bt=this.left,gt=this.top,Lt=this.height;xe?(mt=[Bt,Bt,Bt],bt=[gt,gt+J,gt+ge],Ye=[Lt,Lt,Lt],je=[J,ge-J,this.size-ge]):(mt=[Bt,Bt+J,Bt+ge],bt=[gt,gt,gt],Ye=[J,ge-J,this.size-ge],je=[Lt,Lt,Lt]),this.shades.forEach((qe,vt)=>{qe[Ie]({x:mt[vt],y:bt[vt],width:Ye[vt],height:je[vt]})})}renderElements(){var Bt;let J=this,ge=J.navigatorOptions,xe=ge.maskInside,Ie=J.chart,je=Ie.inverted,Ye=Ie.renderer,mt={cursor:je?"ns-resize":"ew-resize"},bt=J.navigatorGroup??(J.navigatorGroup=Ye.g("navigator").attr({zIndex:8,visibility:"hidden"}).add());if([!xe,xe,!xe].forEach((gt,Lt)=>{let qe=J.shades[Lt]??(J.shades[Lt]=Ye.rect().addClass("highcharts-navigator-mask"+(Lt===1?"-inside":"-outside")).add(bt));Ie.styledMode||(qe.attr({fill:gt?ge.maskFill:"rgba(0,0,0,0)"}),Lt===1&&qe.css(mt))}),J.outline||(J.outline=Ye.path().addClass("highcharts-navigator-outline").add(bt)),Ie.styledMode||J.outline.attr({"stroke-width":ge.outlineWidth,stroke:ge.outlineColor}),(Bt=ge.handles)==null?void 0:Bt.enabled){let gt=ge.handles,{height:Lt,width:qe}=gt;[0,1].forEach(vt=>{var Wt;let _t=gt.symbols[vt];if(J.handles[vt]&&J.handles[vt].symbolUrl===_t){if(!J.handles[vt].isImg&&J.handles[vt].symbolName!==_t){let Gt=Ma[_t].call(Ma,-qe/2-1,0,qe,Lt);J.handles[vt].attr({d:Gt}),J.handles[vt].symbolName=_t}}else(Wt=J.handles[vt])==null||Wt.destroy(),J.handles[vt]=Ye.symbol(_t,-qe/2-1,0,qe,Lt,gt),J.handles[vt].attr({zIndex:7-vt}).addClass("highcharts-navigator-handle highcharts-navigator-handle-"+["left","right"][vt]).add(bt),J.addMouseEvents();Ie.inverted&&J.handles[vt].attr({rotation:90,rotationOriginX:Math.floor(-qe/2),rotationOriginY:(Lt+qe)/2}),Ie.styledMode||J.handles[vt].attr({fill:gt.backgroundColor,stroke:gt.borderColor,"stroke-width":gt.lineWidth,width:gt.width,height:gt.height,x:-qe/2-1,y:0}).css(mt)})}}update(J,ge=!1){var je;let xe=this.chart,Ie=xe.options.chart.inverted!==((je=xe.scrollbar)==null?void 0:je.options.vertical);if(kh(!0,xe.options.navigator,J),this.navigatorOptions=xe.options.navigator||{},this.setOpposite(),qh(J.enabled)||Ie)return this.destroy(),this.navigatorEnabled=J.enabled||this.navigatorEnabled,this.init(xe);if(this.navigatorEnabled&&(this.isDirty=!0,J.adaptToUpdatedData===!1&&this.baseSeries.forEach(Ye=>{mp(Ye,"updatedData",this.updatedDataHandler)},this),J.adaptToUpdatedData&&this.baseSeries.forEach(Ye=>{Ye.eventsToUnbind.push(yn(Ye,"updatedData",this.updatedDataHandler))},this),(J.series||J.baseSeries)&&this.setBaseSeries(void 0,!1),J.height||J.xAxis||J.yAxis)){this.height=J.height??this.height;let Ye=this.getXAxisOffsets();this.xAxis.update({...J.xAxis,offsets:Ye,[xe.inverted?"width":"height"]:this.height,[xe.inverted?"height":"width"]:void 0},!1),this.yAxis.update({...J.yAxis,[xe.inverted?"width":"height"]:this.height},!1)}ge&&xe.redraw()}render(J,ge,xe,Ie){let je=this.chart,Ye=this.xAxis,mt=Ye.pointRange||0,bt=Ye.navigatorAxis.fake?je.xAxis[0]:Ye,Bt=this.navigatorEnabled,gt=this.rendered,Lt=je.inverted,qe=je.xAxis[0].minRange,vt=je.xAxis[0].options.maxRange,_t=this.scrollButtonSize,Wt,Gt,Vt,ji=this.scrollbarHeight,Ms,zi;if(this.hasDragged&&!qh(xe))return;if(this.isDirty&&this.renderElements(),J=bl(J-mt/2),ge=bl(ge+mt/2),!Bn(J)||!Bn(ge))if(gt)xe=0,Ie=Xl(Ye.width,bt.width);else return;this.left=Xl(Ye.left,je.plotLeft+_t+(Lt?je.plotWidth:0));let os=this.size=Ms=Xl(Ye.len,(Lt?je.plotHeight:je.plotWidth)-2*_t);Wt=Lt?ji:Ms+2*_t,xe=Xl(xe,Ye.toPixels(J,!0)),Ie=Xl(Ie,Ye.toPixels(ge,!0)),Bn(xe)&&Math.abs(xe)!==1/0||(xe=0,Ie=Wt);let Fs=Ye.toValue(xe,!0),Xi=Ye.toValue(Ie,!0),Es=Math.abs(bl(Xi-Fs));Es<qe?this.grabbedLeft?xe=Ye.toPixels(Xi-qe-mt,!0):this.grabbedRight&&(Ie=Ye.toPixels(Fs+qe+mt,!0)):qh(vt)&&bl(Es-mt)>vt&&(this.grabbedLeft?xe=Ye.toPixels(Xi-vt-mt,!0):this.grabbedRight&&(Ie=Ye.toPixels(Fs+vt+mt,!0))),this.zoomedMax=Hd(Math.max(xe,Ie),0,os),this.zoomedMin=Hd(this.fixedWidth?this.zoomedMax-this.fixedWidth:Math.min(xe,Ie),0,os),this.range=this.zoomedMax-this.zoomedMin,os=Math.round(this.zoomedMax);let Ns=Math.round(this.zoomedMin);Bt&&(this.navigatorGroup.attr({visibility:"inherit"}),zi=gt&&!this.hasDragged?"animate":"attr",this.drawMasks(Ns,os,Lt,zi),this.drawOutline(Ns,os,Lt,zi),this.navigatorOptions.handles.enabled&&(this.drawHandle(Ns,0,Lt,zi),this.drawHandle(os,1,Lt,zi))),this.scrollbar&&(Lt?(Vt=this.top-_t,Gt=this.left-ji+(Bt||!bt.opposite?0:(bt.titleOffset||0)+bt.axisTitleMargin),ji=Ms+2*_t):(Vt=this.top+(Bt?this.height:-ji),Gt=this.left-_t),this.scrollbar.position(Gt,Vt,Wt,ji),this.scrollbar.setRange(this.zoomedMin/(Ms||1),this.zoomedMax/(Ms||1))),this.rendered=!0,this.isDirty=!1,Ll(this,"afterRender")}addMouseEvents(){let J=this,ge=J.chart,xe=ge.container,Ie=[],je,Ye;J.mouseMoveHandler=je=function(mt){J.onMouseMove(mt)},J.mouseUpHandler=Ye=function(mt){J.onMouseUp(mt)},(Ie=J.getPartsEvents("mousedown")).push(yn(ge.renderTo,"mousemove",je),yn(xe.ownerDocument,"mouseup",Ye),yn(ge.renderTo,"touchmove",je),yn(xe.ownerDocument,"touchend",Ye)),Ie.concat(J.getPartsEvents("touchstart")),J.eventsToUnbind=Ie,J.series&&J.series[0]&&Ie.push(yn(J.series[0].xAxis,"foundExtremes",function(){ge.navigator.modifyNavigatorAxisExtremes()}))}getPartsEvents(J){let ge=this,xe=[];return["shades","handles"].forEach(function(Ie){ge[Ie].forEach(function(je,Ye){xe.push(yn(je.element,J,function(mt){ge[Ie+"Mousedown"](mt,Ye)}))})}),xe}shadesMousedown(J,ge){var _t;J=((_t=this.chart.pointer)==null?void 0:_t.normalize(J))||J;let xe=this.chart,Ie=this.xAxis,je=this.zoomedMin,Ye=this.size,mt=this.range,bt=this.left,Bt=J.chartX,gt,Lt,qe,vt;xe.inverted&&(Bt=J.chartY,bt=this.top),ge===1?(this.grabbedCenter=Bt,this.fixedWidth=mt,this.dragOffset=Bt-je):(vt=Bt-bt-mt/2,ge===0?vt=Math.max(0,vt):ge===2&&vt+mt>=Ye&&(vt=Ye-mt,this.reversedExtremes?(vt-=mt,Lt=this.getUnionExtremes().dataMin):gt=this.getUnionExtremes().dataMax),vt!==je&&(this.fixedWidth=mt,qh((qe=Ie.navigatorAxis.toFixedRange(vt,vt+mt,Lt,gt)).min)&&Ll(this,"setRange",{min:Math.min(qe.min,qe.max),max:Math.max(qe.min,qe.max),redraw:!0,eventArguments:{trigger:"navigator"}})))}handlesMousedown(J,ge){var Ye;J=((Ye=this.chart.pointer)==null?void 0:Ye.normalize(J))||J;let xe=this.chart,Ie=xe.xAxis[0],je=this.reversedExtremes;ge===0?(this.grabbedLeft=!0,this.otherHandlePos=this.zoomedMax,this.fixedExtreme=je?Ie.min:Ie.max):(this.grabbedRight=!0,this.otherHandlePos=this.zoomedMin,this.fixedExtreme=je?Ie.max:Ie.min),xe.setFixedRange(void 0)}onMouseMove(J){var gt;let ge=this,xe=ge.chart,Ie=ge.navigatorSize,je=ge.range,Ye=ge.dragOffset,mt=xe.inverted,bt=ge.left,Bt;(!J.touches||J.touches[0].pageX!==0)&&(Bt=(J=((gt=xe.pointer)==null?void 0:gt.normalize(J))||J).chartX,mt&&(bt=ge.top,Bt=J.chartY),ge.grabbedLeft?(ge.hasDragged=!0,ge.render(0,0,Bt-bt,ge.otherHandlePos)):ge.grabbedRight?(ge.hasDragged=!0,ge.render(0,0,ge.otherHandlePos,Bt-bt)):ge.grabbedCenter&&(ge.hasDragged=!0,Bt<Ye?Bt=Ye:Bt>Ie+Ye-je&&(Bt=Ie+Ye-je),ge.render(0,0,Bt-Ye,Bt-Ye+je)),ge.hasDragged&&ge.scrollbar&&Xl(ge.scrollbar.options.liveRedraw,!Qc&&!this.chart.boosted)&&(J.DOMType=J.type,setTimeout(function(){ge.onMouseUp(J)},0)))}onMouseUp(J){let ge,xe,Ie,je,Ye,mt,bt=this.chart,Bt=this.xAxis,gt=this.scrollbar,Lt=J.DOMEvent||J,qe=bt.inverted,vt=this.rendered&&!this.hasDragged?"animate":"attr";(this.hasDragged&&(!gt||!gt.hasDragged)||J.trigger==="scrollbar")&&(Ie=this.getUnionExtremes(),this.zoomedMin===this.otherHandlePos?je=this.fixedExtreme:this.zoomedMax===this.otherHandlePos&&(Ye=this.fixedExtreme),this.zoomedMax===this.size&&(Ye=this.reversedExtremes?Ie.dataMin:Ie.dataMax),this.zoomedMin===0&&(je=this.reversedExtremes?Ie.dataMax:Ie.dataMin),qh((mt=Bt.navigatorAxis.toFixedRange(this.zoomedMin,this.zoomedMax,je,Ye)).min)&&Ll(this,"setRange",{min:Math.min(mt.min,mt.max),max:Math.max(mt.min,mt.max),redraw:!0,animation:!this.hasDragged&&null,eventArguments:{trigger:"navigator",triggerOp:"navigator-drag",DOMEvent:Lt}})),J.DOMType!=="mousemove"&&J.DOMType!=="touchmove"&&(this.grabbedLeft=this.grabbedRight=this.grabbedCenter=this.fixedWidth=this.fixedExtreme=this.otherHandlePos=this.hasDragged=this.dragOffset=null),this.navigatorEnabled&&Bn(this.zoomedMin)&&Bn(this.zoomedMax)&&(xe=Math.round(this.zoomedMin),ge=Math.round(this.zoomedMax),this.shades&&this.drawMasks(xe,ge,qe,vt),this.outline&&this.drawOutline(xe,ge,qe,vt),this.navigatorOptions.handles.enabled&&Object.keys(this.handles).length===this.handles.length&&(this.drawHandle(xe,0,qe,vt),this.drawHandle(ge,1,qe,vt)))}removeEvents(){this.eventsToUnbind&&(this.eventsToUnbind.forEach(function(J){J()}),this.eventsToUnbind=void 0),this.removeBaseSeriesEvents()}removeBaseSeriesEvents(){let J=this.baseSeries||[];this.navigatorEnabled&&J[0]&&(this.navigatorOptions.adaptToUpdatedData!==!1&&J.forEach(function(ge){mp(ge,"updatedData",this.updatedDataHandler)},this),J[0].xAxis&&mp(J[0].xAxis,"foundExtremes",this.modifyBaseAxisExtremes))}getXAxisOffsets(){return this.chart.inverted?[this.scrollButtonSize,0,-this.scrollButtonSize,0]:[0,-this.scrollButtonSize,0,this.scrollButtonSize]}init(J){var Wt,Gt;let ge=J.options,xe=ge.navigator||{},Ie=xe.enabled,je=ge.scrollbar||{},Ye=je.enabled,mt=Ie&&xe.height||0,bt=Ye&&je.height||0,Bt=je.buttonsEnabled&&bt||0;this.handles=[],this.shades=[],this.chart=J,this.setBaseSeries(),this.height=mt,this.scrollbarHeight=bt,this.scrollButtonSize=Bt,this.scrollbarEnabled=Ye,this.navigatorEnabled=Ie,this.navigatorOptions=xe,this.scrollbarOptions=je,this.setOpposite();let gt=this,Lt=gt.baseSeries,qe=J.xAxis.length,vt=J.yAxis.length,_t=Lt&&Lt[0]&&Lt[0].xAxis||J.xAxis[0]||{options:{}};if(J.isDirtyBox=!0,gt.navigatorEnabled){let Vt=this.getXAxisOffsets();gt.xAxis=new(Gs())(J,kh({breaks:_t.options.breaks,ordinal:_t.options.ordinal,overscroll:_t.options.overscroll},xe.xAxis,{type:"datetime",yAxis:(Wt=xe.yAxis)==null?void 0:Wt.id,index:qe,isInternal:!0,offset:0,keepOrdinalPadding:!0,startOnTick:!1,endOnTick:!1,minPadding:_t.options.ordinal?0:_t.options.minPadding,maxPadding:_t.options.ordinal?0:_t.options.maxPadding,zoomEnabled:!1},J.inverted?{offsets:Vt,width:mt}:{offsets:Vt,height:mt}),"xAxis"),gt.yAxis=new(Gs())(J,kh(xe.yAxis,{alignTicks:!1,offset:0,index:vt,isInternal:!0,reversed:Xl(xe.yAxis&&xe.yAxis.reversed,J.yAxis[0]&&J.yAxis[0].reversed,!1),zoomEnabled:!1},J.inverted?{width:mt}:{height:mt}),"yAxis"),Lt||xe.series.data?gt.updateNavigatorSeries(!1):J.series.length===0&&(gt.unbindRedraw=yn(J,"beforeRedraw",function(){J.series.length>0&&!gt.series&&(gt.setBaseSeries(),gt.unbindRedraw())})),gt.reversedExtremes=J.inverted&&!gt.xAxis.reversed||!J.inverted&&gt.xAxis.reversed,gt.renderElements(),gt.addMouseEvents()}else gt.xAxis={chart:J,navigatorAxis:{fake:!0},translate:function(Vt,ji){let Ms=J.xAxis[0],zi=Ms.getExtremes(),os=Ms.len-2*Bt,Fs=Gr("min",Ms.options.min,zi.dataMin),Xi=Gr("max",Ms.options.max,zi.dataMax)-Fs;return ji?Vt*Xi/os+Fs:os*(Vt-Fs)/Xi},toPixels:function(Vt){return this.translate(Vt)},toValue:function(Vt){return this.translate(Vt,!0)}},gt.xAxis.navigatorAxis.axis=gt.xAxis,gt.xAxis.navigatorAxis.toFixedRange=Wi.prototype.toFixedRange.bind(gt.xAxis.navigatorAxis);if((Gt=J.options.scrollbar)!=null&&Gt.enabled){let Vt=kh(J.options.scrollbar,{vertical:J.inverted});Bn(Vt.margin)||(Vt.margin=J.inverted?-3:3),J.scrollbar=gt.scrollbar=new Ah(J.renderer,Vt,J),yn(gt.scrollbar,"changed",function(ji){let Ms=gt.size,zi=Ms*this.to,os=Ms*this.from;gt.hasDragged=gt.scrollbar.hasDragged,gt.render(0,0,os,zi),this.shouldUpdateExtremes(ji.DOMType)&&setTimeout(function(){gt.onMouseUp(ji)})})}gt.addBaseSeriesEvents(),gt.addChartEvents()}setOpposite(){let J=this.navigatorOptions,ge=this.navigatorEnabled,xe=this.chart;this.opposite=Xl(J.opposite,!!(!ge&&xe.inverted))}getUnionExtremes(J){let ge,xe=this.chart.xAxis[0],Ie=this.chart.time,je=this.xAxis,Ye=je.options,mt=xe.options;return J&&xe.dataMin===null||(ge={dataMin:Xl(Ie.parse(Ye==null?void 0:Ye.min),Gr("min",Ie.parse(mt.min),xe.dataMin,je.dataMin,je.min)),dataMax:Xl(Ie.parse(Ye==null?void 0:Ye.max),Gr("max",Ie.parse(mt.max),xe.dataMax,je.dataMax,je.max))}),ge}setBaseSeries(J,ge){let xe=this.chart,Ie=this.baseSeries=[];J=J||xe.options&&xe.options.navigator.baseSeries||(xe.series.length?qu(xe.series,je=>!je.options.isInternal).index:0),(xe.series||[]).forEach((je,Ye)=>{!je.options.isInternal&&(je.options.showInNavigator||(Ye===J||je.options.id===J)&&je.options.showInNavigator!==!1)&&Ie.push(je)}),this.xAxis&&!this.xAxis.navigatorAxis.fake&&this.updateNavigatorSeries(!0,ge)}updateNavigatorSeries(J,ge){var qe,vt;let xe=this,Ie=xe.chart,je=xe.baseSeries,Ye={enableMouseTracking:!1,index:null,linkedTo:null,group:"nav",padXAxis:!1,xAxis:(qe=this.navigatorOptions.xAxis)==null?void 0:qe.id,yAxis:(vt=this.navigatorOptions.yAxis)==null?void 0:vt.id,showInLegend:!1,stacking:void 0,isInternal:!0,states:{inactive:{opacity:1}}},mt=xe.series=(xe.series||[]).filter(_t=>{let Wt=_t.baseSeries;return!(0>je.indexOf(Wt))||(Wt&&(mp(Wt,"updatedData",xe.updatedDataHandler),delete Wt.navigatorSeries),_t.chart&&_t.destroy(),!1)}),bt,Bt,gt=xe.navigatorOptions.series,Lt;je&&je.length&&je.forEach(_t=>{var ji;let Wt=_t.navigatorSeries,Gt=Xd({color:_t.color,visible:_t.visible},ja(gt)?Kl.navigator.series:gt);if(Wt&&xe.navigatorOptions.adaptToUpdatedData===!1)return;Ye.name="Navigator "+je.length,Lt=(bt=_t.options||{}).navigatorOptions||{},Gt.dataLabels=Dc(Gt.dataLabels),(Bt=kh(bt,Ye,Gt,Lt)).pointRange=Xl(Gt.pointRange,Lt.pointRange,Kl.plotOptions[Bt.type||"line"].pointRange);let Vt=Lt.data||Gt.data;xe.hasNavigatorData=xe.hasNavigatorData||!!Vt,Bt.data=Vt||((ji=bt.data)==null?void 0:ji.slice(0)),Wt&&Wt.options?Wt.update(Bt,ge):(_t.navigatorSeries=Ie.initSeries(Bt),Ie.setSortedData(),_t.navigatorSeries.baseSeries=_t,mt.push(_t.navigatorSeries))}),(gt.data&&!(je&&je.length)||ja(gt))&&(xe.hasNavigatorData=!1,(gt=Dc(gt)).forEach((_t,Wt)=>{Ye.name="Navigator "+(mt.length+1),(Bt=kh(Kl.navigator.series,{color:Ie.series[Wt]&&!Ie.series[Wt].options.isInternal&&Ie.series[Wt].color||Ie.options.colors[Wt]||Ie.options.colors[0]},Ye,_t)).data=_t.data,Bt.data&&(xe.hasNavigatorData=!0,mt.push(Ie.initSeries(Bt)))})),J&&this.addBaseSeriesEvents()}addBaseSeriesEvents(){let J=this,ge=J.baseSeries||[];ge[0]&&ge[0].xAxis&&ge[0].eventsToUnbind.push(yn(ge[0].xAxis,"foundExtremes",this.modifyBaseAxisExtremes)),ge.forEach(xe=>{xe.eventsToUnbind.push(yn(xe,"show",function(){this.navigatorSeries&&this.navigatorSeries.setVisible(!0,!1)})),xe.eventsToUnbind.push(yn(xe,"hide",function(){this.navigatorSeries&&this.navigatorSeries.setVisible(!1,!1)})),this.navigatorOptions.adaptToUpdatedData!==!1&&xe.xAxis&&xe.eventsToUnbind.push(yn(xe,"updatedData",this.updatedDataHandler)),xe.eventsToUnbind.push(yn(xe,"remove",function(){ge&&fa(ge,xe),this.navigatorSeries&&J.series&&(fa(J.series,this.navigatorSeries),qh(this.navigatorSeries.options)&&this.navigatorSeries.remove(!1),delete this.navigatorSeries)}))})}getBaseSeriesMin(J){return this.baseSeries.reduce(function(ge,xe){return Math.min(ge,xe.getColumn("x")[0]??ge)},J)}modifyNavigatorAxisExtremes(){let J=this.xAxis;if(J.getExtremes!==void 0){let ge=this.getUnionExtremes(!0);ge&&(ge.dataMin!==J.min||ge.dataMax!==J.max)&&(J.min=ge.dataMin,J.max=ge.dataMax)}}modifyBaseAxisExtremes(){var Wt;let J,ge,xe=this.chart.navigator,Ie=this.getExtremes(),je=Ie.min,Ye=Ie.max,mt=Ie.dataMin,bt=Ie.dataMax,Bt=Ye-je,gt=xe.stickToMin,Lt=xe.stickToMax,qe=Xl((Wt=this.ordinal)==null?void 0:Wt.convertOverscroll(this.options.overscroll),0),vt=xe.series&&xe.series[0],_t=!!this.setExtremes;!(this.eventArgs&&this.eventArgs.trigger==="rangeSelectorButton")&&(gt&&(J=(ge=mt)+Bt),Lt&&(J=bt+qe,gt||(ge=Math.max(mt,J-Bt,xe.getBaseSeriesMin(vt&&vt.xData?vt.xData[0]:-Number.MAX_VALUE)))),_t&&(gt||Lt)&&Bn(ge)&&(this.min=this.userMin=ge,this.max=this.userMax=J)),xe.stickToMin=xe.stickToMax=null}updatedDataHandler(){let J=this.chart.navigator,ge=this.navigatorSeries,xe=J.reversedExtremes?Math.round(J.zoomedMin)===0:Math.round(J.zoomedMax)>=Math.round(J.size);J.stickToMax=Xl(this.chart.options.navigator&&this.chart.options.navigator.stickToMax,xe),J.stickToMin=J.shouldStickToMin(this,J),ge&&!J.hasNavigatorData&&(ge.options.pointStart=this.getColumn("x")[0],ge.setData(this.options.data,!1,null,!1))}shouldStickToMin(J,ge){let xe=ge.getBaseSeriesMin(J.getColumn("x")[0]),Ie=J.xAxis,je=Ie.max,Ye=Ie.min,mt=Ie.options.range;return!!(Bn(je)&&Bn(Ye))&&(mt&&je-xe>0?je-xe<mt:Ye<=xe)}addChartEvents(){this.eventsToUnbind||(this.eventsToUnbind=[]),this.eventsToUnbind.push(yn(this.chart,"redraw",function(){let J=this.navigator,ge=J&&(J.baseSeries&&J.baseSeries[0]&&J.baseSeries[0].xAxis||this.xAxis[0]);ge&&J.render(ge.min,ge.max)}),yn(this.chart,"getMargins",function(){var xe;let J=this.navigator,ge=J.opposite?"plotTop":"marginBottom";this.inverted&&(ge=J.opposite?"marginRight":"plotLeft"),this[ge]=(this[ge]||0)+(J.navigatorEnabled||!this.inverted?J.height+(((xe=this.scrollbar)==null?void 0:xe.options.margin)||0)+J.scrollbarHeight:0)+(J.navigatorOptions.margin||0)}),yn(Eh,"setRange",function(J){this.chart.xAxis[0].setExtremes(J.min,J.max,J.redraw,J.animation,J.eventArguments)}))}destroy(){this.removeEvents(),this.xAxis&&(fa(this.chart.xAxis,this.xAxis),fa(this.chart.axes,this.xAxis)),this.yAxis&&(fa(this.chart.yAxis,this.yAxis),fa(this.chart.axes,this.yAxis)),(this.series||[]).forEach(J=>{J.destroy&&J.destroy()}),["series","xAxis","yAxis","shades","outline","scrollbarTrack","scrollbarRifles","scrollbarGroup","scrollbar","navigatorGroup","rendered"].forEach(J=>{this[J]&&this[J].destroy&&this[J].destroy(),this[J]=null}),[this.handles].forEach(J=>{Zh(J)}),this.baseSeries.forEach(J=>{J.navigatorSeries=void 0}),this.navigatorEnabled=!1}}let Su={lang:{rangeSelectorZoom:"Zoom",rangeSelectorFrom:"",rangeSelectorTo:"→",rangeSelector:{allText:"All",allTitle:"View all",monthText:"{count}m",monthTitle:"View {count} {#eq count 1}month{else}months{/eq}",yearText:"{count}y",yearTitle:"View {count} {#eq count 1}year{else}years{/eq}",ytdText:"YTD",ytdTitle:"View year to date"}},rangeSelector:{allButtonsEnabled:!1,buttons:[{type:"month",count:1},{type:"month",count:3},{type:"month",count:6},{type:"ytd"},{type:"year",count:1},{type:"all"}],buttonSpacing:5,dropdown:"responsive",enabled:void 0,verticalAlign:"top",buttonTheme:{width:28,height:18,padding:2,zIndex:7},floating:!1,x:0,y:0,height:void 0,inputBoxBorderColor:"none",inputBoxHeight:17,inputBoxWidth:void 0,inputDateFormat:"%[ebY]",inputDateParser:void 0,inputEditDateFormat:"%Y-%m-%d",inputEnabled:!0,inputPosition:{align:"right",x:0,y:0},inputSpacing:5,selected:void 0,buttonPosition:{align:"left",x:0,y:0},inputStyle:{color:"#334eff",cursor:"pointer",fontSize:"0.8em"},labelStyle:{color:"#666666",fontSize:"0.8em"}}},{defaultOptions:Ch}=Cs(),{composed:cf}=Cs(),{addEvent:ma,defined:Mu,extend:wl,isNumber:ed,merge:Yd,pick:It,pushUnique:Fi}=Cs(),fs=[];function Ir(){let Ge,J,ge=this.range,xe=ge.type,Ie=this.max,je=this.chart.time,Ye=function(bt,Bt){let gt=je.toParts(bt),Lt=gt.slice();xe==="year"?Lt[0]+=Bt:Lt[1]+=Bt;let qe=je.makeTime.apply(je,Lt),vt=je.toParts(qe);return xe==="month"&&gt[1]===vt[1]&&Math.abs(Bt)===1&&(Lt[0]=gt[0],Lt[1]=gt[1],Lt[2]=0),(qe=je.makeTime.apply(je,Lt))-bt};ed(ge)?(Ge=Ie-ge,J=ge):ge&&(Ge=Ie+Ye(Ie,-(ge.count||1)),this.chart&&this.chart.setFixedRange(Ie-Ge));let mt=It(this.dataMin,Number.MIN_VALUE);return ed(Ge)||(Ge=mt),Ge<=mt&&(Ge=mt,J===void 0&&(J=Ye(Ge,ge.count)),this.newMax=Math.min(Ge+J,It(this.dataMax,Number.MAX_VALUE))),ed(Ie)?!ed(ge)&&ge&&ge._offsetMin&&(Ge+=ge._offsetMin):Ge=void 0,Ge}function Ga(){var Ge;(Ge=this.rangeSelector)==null||Ge.redrawElements()}function xn(){this.options.rangeSelector&&this.options.rangeSelector.enabled&&(this.rangeSelector=new zs(this))}function Ol(){let Ge=this.rangeSelector;if(Ge){ed(Ge.deferredYTDClick)&&(Ge.clickButton(Ge.deferredYTDClick),delete Ge.deferredYTDClick);let J=Ge.options.verticalAlign;Ge.options.floating||(J==="bottom"?this.extraBottomMargin=!0:J==="top"&&(this.extraTopMargin=!0))}}function Ln(){let Ge,J=this.rangeSelector;if(!J)return;let ge=this.xAxis[0].getExtremes(),xe=this.legend,Ie=J&&J.options.verticalAlign;ed(ge.min)&&J.render(ge.min,ge.max),xe.display&&Ie==="top"&&Ie===xe.options.verticalAlign&&(Ge=Yd(this.spacingBox),xe.options.layout==="vertical"?Ge.y=this.plotTop:Ge.y+=J.getHeight(),xe.group.placed=!1,xe.align(Ge))}function td(){for(let Ge=0,J=fs.length;Ge<J;++Ge){let ge=fs[Ge];if(ge[0]===this){ge[1].forEach(xe=>xe()),fs.splice(Ge,1);return}}}function id(){var J;let Ge=this.rangeSelector;if((J=Ge==null?void 0:Ge.options)!=null&&J.enabled){let ge=Ge.getHeight(),xe=Ge.options.verticalAlign;Ge.options.floating||(xe==="bottom"?this.marginBottom+=ge:xe!=="middle"&&(this.plotTop+=ge))}}function Au(Ge){let J=Ge.options.rangeSelector,ge=this.extraBottomMargin,xe=this.extraTopMargin,Ie=this.rangeSelector;if(J&&J.enabled&&!Mu(Ie)&&this.options.rangeSelector&&(this.options.rangeSelector.enabled=!0,this.rangeSelector=Ie=new zs(this)),this.extraBottomMargin=!1,this.extraTopMargin=!1,Ie){let je=J&&J.verticalAlign||Ie.options&&Ie.options.verticalAlign;Ie.options.floating||(je==="bottom"?this.extraBottomMargin=!0:je!=="middle"&&(this.extraTopMargin=!0)),(this.extraBottomMargin!==ge||this.extraTopMargin!==xe)&&(this.isDirtyBox=!0)}}let zc={compose:function(Ge,J,ge){if(zs=ge,Fi(cf,"RangeSelector")){let xe=J.prototype;Ge.prototype.minFromRange=Ir,ma(J,"afterGetContainer",xn),ma(J,"beforeRender",Ol),ma(J,"destroy",td),ma(J,"getMargins",id),ma(J,"redraw",Ln),ma(J,"update",Au),ma(J,"beforeRedraw",Ga),xe.callbacks.push(Ln),wl(Ch,{rangeSelector:Su.rangeSelector}),wl(Ch.lang,Su.lang)}}};var fl=Pi(28),Hn=Pi.n(fl),hl=Pi(984),$d=Pi.n(hl);(function(Ge){Ge.setLength=function(J,ge,xe){return Array.isArray(J)?(J.length=ge,J):J[xe?"subarray":"slice"](0,ge)},Ge.splice=function(J,ge,xe,Ie,je=[]){if(Array.isArray(J))return Array.isArray(je)||(je=Array.from(je)),{removed:J.splice(ge,xe,...je),array:J};let Ye=Object.getPrototypeOf(J).constructor,mt=J[Ie?"subarray":"slice"](ge,ge+xe),bt=new Ye(J.length-xe+je.length);return bt.set(J.subarray(0,ge),0),bt.set(je,ge),bt.set(J.subarray(ge+xe),ge+je.length),{removed:mt,array:bt}}})(ar||(ar={}));let{setLength:So,splice:Dl}=ar,{fireEvent:Md,objectEach:Ja,uniqueKey:js}=Cs(),Np=class{constructor(Ge={}){this.autoId=!Ge.id,this.columns={},this.id=Ge.id||js(),this.modified=this,this.rowCount=0,this.versionTag=js();let J=0;Ja(Ge.columns||{},(ge,xe)=>{this.columns[xe]=ge.slice(),J=Math.max(J,ge.length)}),this.applyRowCount(J)}applyRowCount(Ge){this.rowCount=Ge,Ja(this.columns,(J,ge)=>{J.length!==Ge&&(this.columns[ge]=So(J,Ge))})}deleteRows(Ge,J=1){if(J>0&&Ge<this.rowCount){let ge=0;Ja(this.columns,(xe,Ie)=>{this.columns[Ie]=Dl(xe,Ge,J).array,ge=xe.length}),this.rowCount=ge}Md(this,"afterDeleteRows",{rowIndex:Ge,rowCount:J}),this.versionTag=js()}getColumn(Ge,J){return this.columns[Ge]}getColumns(Ge,J){return(Ge||Object.keys(this.columns)).reduce((ge,xe)=>(ge[xe]=this.columns[xe],ge),{})}getRow(Ge,J){return(J||Object.keys(this.columns)).map(ge=>{var xe;return(xe=this.columns[ge])==null?void 0:xe[Ge]})}setColumn(Ge,J=[],ge=0,xe){this.setColumns({[Ge]:J},ge,xe)}setColumns(Ge,J,ge){let xe=this.rowCount;Ja(Ge,(Ie,je)=>{this.columns[je]=Ie.slice(),xe=Ie.length}),this.applyRowCount(xe),ge!=null&&ge.silent||(Md(this,"afterSetColumns"),this.versionTag=js())}setRow(Ge,J=this.rowCount,ge,xe){let{columns:Ie}=this,je=ge?this.rowCount+1:J+1;Ja(Ge,(Ye,mt)=>{let bt=Ie[mt]||(xe==null?void 0:xe.addColumns)!==!1&&Array(je);bt&&(ge?bt=Dl(bt,J,0,!0,[Ye]).array:bt[J]=Ye,Ie[mt]=bt)}),je>this.rowCount&&this.applyRowCount(je),xe!=null&&xe.silent||(Md(this,"afterSetRows"),this.versionTag=js())}},{addEvent:lh,correctFloat:ga,css:La,defined:yh,error:qd,isNumber:Ls,pick:Qr,timeUnits:zo,isString:Jl}=Cs();(function(Ge){function J(qe,vt,_t,Wt,Gt=[],Vt=0,ji){let Ms={},zi=this.options.tickPixelInterval,os=this.chart.time,Fs=[],Xi,Es,Ns,rr,bs,Ks=0,or=[],Jo=-Number.MAX_VALUE;if(!this.options.ordinal&&!this.options.breaks||!Gt||Gt.length<3||vt===void 0)return os.getTimeTicks.apply(os,arguments);let co=Gt.length;for(Xi=0;Xi<co;Xi++){if(bs=Xi&&Gt[Xi-1]>_t,Gt[Xi]<vt&&(Ks=Xi),Xi===co-1||Gt[Xi+1]-Gt[Xi]>5*Vt||bs){if(Gt[Xi]>Jo){for(Es=os.getTimeTicks(qe,Gt[Ks],Gt[Xi],Wt);Es.length&&Es[0]<=Jo;)Es.shift();Es.length&&(Jo=Es[Es.length-1]),Fs.push(or.length),or=or.concat(Es)}Ks=Xi+1}if(bs)break}if(Es){if(rr=Es.info,ji&&rr.unitRange<=zo.hour){for(Ks=1,Xi=or.length-1;Ks<Xi;Ks++)os.dateFormat("%d",or[Ks])!==os.dateFormat("%d",or[Ks-1])&&(Ms[or[Ks]]="day",Ns=!0);Ns&&(Ms[or[0]]="day"),rr.higherRanks=Ms}rr.segmentStarts=Fs,or.info=rr}else qd(12,!1,this.chart);if(ji&&yh(zi)){let eo=or.length,ya=[],ta=[],Ea,mn,qr,Sl,oo,Hc=eo;for(;Hc--;)mn=this.translate(or[Hc]),qr&&(ta[Hc]=qr-mn),ya[Hc]=qr=mn;for(ta.sort((am,pn)=>am-pn),(Sl=ta[Math.floor(ta.length/2)])<.6*zi&&(Sl=null),Hc=or[eo-1]>_t?eo-1:eo,qr=void 0;Hc--;)oo=Math.abs(qr-(mn=ya[Hc])),qr&&oo<.8*zi&&(Sl===null||oo<.8*Sl)?(Ms[or[Hc]]&&!Ms[or[Hc+1]]?(Ea=Hc+1,qr=mn):Ea=Hc,or.splice(Ea,1)):qr=mn}return or}function ge(qe){let vt=this.ordinal.positions;if(!vt)return qe;let _t=vt.length-1,Wt;return qe<0?qe=vt[0]:qe>_t?qe=vt[_t]:(_t=Math.floor(qe),Wt=qe-_t),Wt!==void 0&&vt[_t]!==void 0?vt[_t]+(Wt?Wt*(vt[_t+1]-vt[_t]):0):qe}function xe(qe){let vt=this.ordinal,_t=this.old?this.old.min:this.min,Wt=this.old?this.old.transA:this.transA,Gt=vt.getExtendedPositions();if(Gt!=null&&Gt.length){let Vt=ga((qe-_t)*Wt+this.minPixelPadding),ji=ga(vt.getIndexOfPoint(Vt,Gt)),Ms=ga(ji%1);if(ji>=0&&ji<=Gt.length-1){let zi=Gt[Math.floor(ji)],os=Gt[Math.ceil(ji)];return Gt[Math.floor(ji)]+Ms*(os-zi)}}return qe}function Ie(qe,vt){let _t=Ge.Additions.findIndexOf(qe,vt,!0);if(qe[_t]===vt)return _t;let Wt=(vt-qe[_t])/(qe[_t+1]-qe[_t]);return _t+Wt}function je(){this.ordinal||(this.ordinal=new Ge.Additions(this))}function Ye(){let{eventArgs:qe,options:vt}=this;if(this.isXAxis&&yh(vt.overscroll)&&vt.overscroll!==0&&Ls(this.max)&&Ls(this.min)&&(this.options.ordinal&&!this.ordinal.originalOrdinalRange&&this.ordinal.getExtendedPositions(!1),this.max===this.dataMax&&((qe==null?void 0:qe.trigger)!=="pan"||this.isInternal)&&(qe==null?void 0:qe.trigger)!=="navigator")){let _t=this.ordinal.convertOverscroll(vt.overscroll);this.max+=_t,!this.isInternal&&yh(this.userMin)&&(qe==null?void 0:qe.trigger)!=="mousewheel"&&(this.min+=_t)}}function mt(){this.horiz&&!this.isDirty&&(this.isDirty=this.isOrdinal&&this.chart.navigator&&!this.chart.navigator.adaptToUpdatedData)}function bt(){this.ordinal&&(this.ordinal.beforeSetTickPositions(),this.tickInterval=this.ordinal.postProcessTickInterval(this.tickInterval))}function Bt(qe){var ji;let vt=this.xAxis[0],_t=vt.ordinal.convertOverscroll(vt.options.overscroll),Wt=qe.originalEvent.chartX,Gt=this.options.chart.panning,Vt=!1;if((Gt==null?void 0:Gt.type)!=="y"&&vt.options.ordinal&&vt.series.length&&(!qe.touches||qe.touches.length<=1)){let Ms,zi,os=this.mouseDownX,Fs=vt.getExtremes(),Xi=Fs.dataMin,Es=Fs.dataMax,Ns=Fs.min,rr=Fs.max,bs=this.hoverPoints,Ks=vt.closestPointRange||((ji=vt.ordinal)==null?void 0:ji.overscrollPointsRange),or=Math.round((os-Wt)/(vt.translationSlope*(vt.ordinal.slope||Ks))),Jo=vt.ordinal.getExtendedPositions(),co={ordinal:{positions:Jo,extendedOrdinalPositions:Jo}},eo=vt.index2val,ya=vt.val2lin;if(Ns<=Xi&&or<=0||rr>=Es+_t&&or>=0)return void qe.preventDefault();co.ordinal.positions?Math.abs(or)>1&&(bs&&bs.forEach(function(ta){ta.setState()}),zi=co.ordinal.positions,_t&&(zi=co.ordinal.positions=zi.concat(vt.ordinal.getOverscrollPositions())),Es>zi[zi.length-1]&&zi.push(Es),this.setFixedRange(rr-Ns),(Ms=vt.navigatorAxis.toFixedRange(void 0,void 0,eo.apply(co,[ya.apply(co,[Ns,!0])+or]),eo.apply(co,[ya.apply(co,[rr,!0])+or]))).min>=Math.min(zi[0],Ns)&&Ms.max<=Math.max(zi[zi.length-1],rr)+_t&&vt.setExtremes(Ms.min,Ms.max,!0,!1,{trigger:"pan"}),this.mouseDownX=Wt,La(this.container,{cursor:"move"})):Vt=!0}else Vt=!0;Vt||Gt&&/y/.test(Gt.type)?_t&&Ls(vt.dataMax)&&(vt.max=vt.dataMax+_t):qe.preventDefault()}function gt(){let qe=this.xAxis;qe!=null&&qe.options.ordinal&&(delete qe.ordinal.index,delete qe.ordinal.originalOrdinalRange)}function Lt(qe,vt){var zi;let _t,Wt=this.ordinal,Gt=Wt.positions,Vt=Wt.slope,ji;if(!Gt)return qe;let Ms=Gt.length;if(Gt[0]<=qe&&Gt[Ms-1]>=qe)_t=Ie(Gt,qe);else{if(ji=(zi=Wt.getExtendedPositions)==null?void 0:zi.call(Wt),!(ji!=null&&ji.length))return qe;let os=ji.length;Vt||(Vt=(ji[os-1]-ji[0])/os);let Fs=Ie(ji,Gt[0]);if(qe>=ji[0]&&qe<=ji[os-1])_t=Ie(ji,qe)-Fs;else{if(!vt)return qe;_t=qe<ji[0]?-Fs-(ji[0]-qe)/Vt:(qe-ji[os-1])/Vt+os-Fs}}return vt?_t:Vt*(_t||0)+Wt.offset}Ge.compose=function(qe,vt,_t){let Wt=qe.prototype;return Wt.ordinal2lin||(Wt.getTimeTicks=J,Wt.index2val=ge,Wt.lin2val=xe,Wt.val2lin=Lt,Wt.ordinal2lin=Wt.val2lin,lh(qe,"afterInit",je),lh(qe,"foundExtremes",Ye),lh(qe,"afterSetScale",mt),lh(qe,"initialAxisTranslation",bt),lh(_t,"pan",Bt),lh(_t,"touchpan",Bt),lh(vt,"updatedData",gt)),qe},Ge.Additions=class{constructor(qe){this.index={},this.axis=qe}beforeSetTickPositions(){var eo;let qe=this.axis,vt=qe.ordinal,_t=qe.getExtremes(),Wt=_t.min,Gt=_t.max,Vt=(eo=qe.brokenAxis)==null?void 0:eo.hasBreaks,ji=qe.options.ordinal,Ms=qe.options.overscroll&&qe.ordinal.convertOverscroll(qe.options.overscroll)||0,zi,os,Fs,Xi,Es,Ns,rr,bs=[],Ks=Number.MAX_VALUE,or=!1,Jo=!1,co=!1;if(ji||Vt){let ya=0;if(qe.series.forEach(function(ta,Ea){let mn=ta.getColumn("x",!0);if(os=[],Ea>0&&ta.options.id!=="highcharts-navigator-series"&&mn.length>1&&(Jo=ya!==mn[1]-mn[0]),ya=mn[1]-mn[0],ta.boosted&&(co=ta.boosted),ta.reserveSpace()&&(ta.takeOrdinalPosition!==!1||Vt)&&(zi=(bs=bs.concat(mn)).length,bs.sort(function(qr,Sl){return qr-Sl}),Ks=Math.min(Ks,Qr(ta.closestPointRange,Ks)),zi)){for(Ea=0;Ea<zi-1;)bs[Ea]!==bs[Ea+1]&&os.push(bs[Ea+1]),Ea++;os[0]!==bs[0]&&os.unshift(bs[0]),bs=os}}),qe.ordinal.originalOrdinalRange||(qe.ordinal.originalOrdinalRange=(bs.length-1)*Ks),Jo&&co&&(bs.pop(),bs.shift()),(zi=bs.length)>2){for(Fs=bs[1]-bs[0],rr=zi-1;rr--&&!or;)bs[rr+1]-bs[rr]!==Fs&&(or=!0);!qe.options.keepOrdinalPadding&&(bs[0]-Wt>Fs||Gt-Ms-bs[zi-1]>Fs)&&(or=!0)}else qe.options.overscroll&&(zi===2?Ks=bs[1]-bs[0]:zi===1?(Ks=Ms,bs=[bs[0],bs[0]+Ks]):Ks=vt.overscrollPointsRange);or||qe.forceOrdinal?(qe.options.overscroll&&(vt.overscrollPointsRange=Ks,bs=bs.concat(vt.getOverscrollPositions())),vt.positions=bs,Xi=qe.ordinal2lin(Math.max(Wt,bs[0]),!0),Es=Math.max(qe.ordinal2lin(Math.min(Gt,bs[bs.length-1]),!0),1),vt.slope=Ns=(Gt-Wt)/(Es-Xi),vt.offset=Wt-Xi*Ns):(vt.overscrollPointsRange=Qr(qe.closestPointRange,vt.overscrollPointsRange),vt.positions=qe.ordinal.slope=vt.offset=void 0)}qe.isOrdinal=ji&&or,vt.groupIntervalFactor=null}static findIndexOf(qe,vt,_t){let Wt=0,Gt=qe.length-1,Vt;for(;Wt<Gt;)qe[Vt=Math.ceil((Wt+Gt)/2)]<=vt?Wt=Vt:Gt=Vt-1;return qe[Wt]===vt||_t?Wt:-1}getExtendedPositions(qe=!0){let vt=this,_t=vt.axis,Wt=_t.constructor.prototype,Gt=_t.chart,Vt=_t.series.reduce((Xi,Es)=>{let Ns=Es.currentDataGrouping;return Xi+(Ns?Ns.count+Ns.unitName:"raw")},""),ji=qe?_t.ordinal.convertOverscroll(_t.options.overscroll):0,Ms=_t.getExtremes(),zi,os,Fs=vt.index;return Fs||(Fs=vt.index={}),!Fs[Vt]&&((zi={series:[],chart:Gt,forceOrdinal:!1,getExtremes:function(){return{min:Ms.dataMin,max:Ms.dataMax+ji}},applyGrouping:Wt.applyGrouping,getGroupPixelWidth:Wt.getGroupPixelWidth,getTimeTicks:Wt.getTimeTicks,options:{ordinal:!0},ordinal:{getGroupIntervalFactor:this.getGroupIntervalFactor},ordinal2lin:Wt.ordinal2lin,getIndexOfPoint:Wt.getIndexOfPoint,val2lin:Wt.val2lin}).ordinal.axis=zi,_t.series.forEach(Xi=>{var Ns,rr,bs;if(Xi.takeOrdinalPosition===!1)return;os={xAxis:zi,chart:Gt,groupPixelWidth:Xi.groupPixelWidth,destroyGroupedData:Cs().noop,getColumn:Xi.getColumn,applyGrouping:Xi.applyGrouping,getProcessedData:Xi.getProcessedData,reserveSpace:Xi.reserveSpace,visible:Xi.visible};let Es=Xi.getColumn("x").concat(qe?vt.getOverscrollPositions():[]);os.dataTable=new Np({columns:{x:Es}}),os.options={...Xi.options,dataGrouping:Xi.currentDataGrouping?{firstAnchor:(Ns=Xi.options.dataGrouping)==null?void 0:Ns.firstAnchor,anchor:(rr=Xi.options.dataGrouping)==null?void 0:rr.anchor,lastAnchor:(bs=Xi.options.dataGrouping)==null?void 0:bs.firstAnchor,enabled:!0,forced:!0,approximation:"open",units:[[Xi.currentDataGrouping.unitName,[Xi.currentDataGrouping.count]]]}:{enabled:!1}},zi.series.push(os),Xi.processData.apply(os)}),zi.applyGrouping({hasExtremesChanged:!0}),(os==null?void 0:os.closestPointRange)!==(os==null?void 0:os.basePointRange)&&os.currentDataGrouping&&(zi.forceOrdinal=!0),_t.ordinal.beforeSetTickPositions.apply({axis:zi}),!_t.ordinal.originalOrdinalRange&&zi.ordinal.originalOrdinalRange&&(_t.ordinal.originalOrdinalRange=zi.ordinal.originalOrdinalRange),zi.ordinal.positions&&(Fs[Vt]=zi.ordinal.positions)),Fs[Vt]}getGroupIntervalFactor(qe,vt,_t){let Wt=_t.getColumn("x",!0),Gt=Wt.length,Vt=[],ji,Ms,zi=this.groupIntervalFactor;if(!zi){for(Ms=0;Ms<Gt-1;Ms++)Vt[Ms]=Wt[Ms+1]-Wt[Ms];Vt.sort(function(os,Fs){return os-Fs}),ji=Vt[Math.floor(Gt/2)],qe=Math.max(qe,Wt[0]),vt=Math.min(vt,Wt[Gt-1]),this.groupIntervalFactor=zi=Gt*ji/(vt-qe)}return zi}getIndexOfPoint(qe,vt){let _t=this.axis,Wt=_t.min,Gt=_t.minPixelPadding;return Ie(vt,Wt)+ga((qe-Gt)/(_t.translationSlope*(this.slope||_t.closestPointRange||this.overscrollPointsRange)))}getOverscrollPositions(){let qe=this.axis,vt=this.convertOverscroll(qe.options.overscroll),_t=this.overscrollPointsRange,Wt=[],Gt=qe.dataMax;if(yh(_t))for(;Gt<qe.dataMax+vt;)Wt.push(Gt+=_t);return Wt}postProcessTickInterval(qe){let vt=this.axis,_t=this.slope,Wt=vt.closestPointRange;return _t&&Wt?vt.options.breaks?Wt||qe:qe/(_t/Wt):qe}convertOverscroll(qe=0){let vt=this,_t=vt.axis,Wt=function(Gt){return Qr(vt.originalOrdinalRange,yh(_t.dataMax)&&yh(_t.dataMin)?_t.dataMax-_t.dataMin:0)*Gt};if(Jl(qe)){let Gt,Vt=parseInt(qe,10);if(yh(_t.min)&&yh(_t.max)&&yh(_t.dataMin)&&yh(_t.dataMax)&&((Gt=_t.max-_t.min==_t.dataMax-_t.dataMin)||(this.originalOrdinalRange=_t.max-_t.min)),/%$/.test(qe))return Wt(Vt/100);if(/px/.test(qe)){let ji=Math.min(Vt,.9*_t.len)/_t.len;return Wt(ji/(Gt?1-ji:1))}return 0}return qe}}})(Nr||(Nr={}));let Kh=Nr,{defaultOptions:ro}=Cs(),{format:ku}=$d(),{addEvent:Ph,createElement:gc,css:Ba,defined:Xn,destroyObjectProperties:Hf,diffObjects:sd,discardElement:Zd,extend:Vp,fireEvent:Kd,isNumber:Tl,isString:Ad,merge:Wa,objectEach:Jd,pick:cl,splat:gp}=Cs();function Fr(Ge){let J=Ie=>RegExp(`%[[a-zA-Z]*${Ie}`).test(Ge);if(Ad(Ge)?Ge.indexOf("%L")!==-1:Ge.fractionalSecondDigits)return"text";let ge=Ad(Ge)?["a","A","d","e","w","b","B","m","o","y","Y"].some(J):Ge.dateStyle||Ge.day||Ge.month||Ge.year,xe=Ad(Ge)?["H","k","I","l","M","S"].some(J):Ge.timeStyle||Ge.hour||Ge.minute||Ge.second;return ge&&xe?"datetime-local":ge?"date":xe?"time":"text"}class cs{static compose(J,ge){zc.compose(J,ge,cs)}constructor(J){this.isDirty=!1,this.buttonOptions=[],this.initialButtonGroupWidth=0,this.maxButtonWidth=()=>{let ge=0;return this.buttons.forEach(xe=>{let Ie=xe.getBBox();Ie.width>ge&&(ge=Ie.width)}),ge},this.init(J)}clickButton(J,ge){let xe=this.chart,Ie=this.buttonOptions[J],je=xe.xAxis[0],Ye=xe.scroller&&xe.scroller.getUnionExtremes()||je||{},mt=Ie.type,bt=Ie.dataGrouping,Bt=Ye.dataMin,gt=Ye.dataMax,Lt,qe=Tl(je==null?void 0:je.max)?Math.round(Math.min(je.max,gt??je.max)):void 0,vt,_t=Ie._range,Wt,Gt,Vt,ji=!0;if(Bt!==null&&gt!==null){if(this.setSelected(J),bt&&(this.forcedDataGrouping=!0,Gs().prototype.setDataGrouping.call(je||{chart:this.chart},bt,!1),this.frozenStates=Ie.preserveDataGrouping),mt==="month"||mt==="year")je?(Gt={range:Ie,max:qe,chart:xe,dataMin:Bt,dataMax:gt},Lt=je.minFromRange.call(Gt),Tl(Gt.newMax)&&(qe=Gt.newMax),ji=!1):_t=Ie;else if(_t)Tl(qe)&&(qe=Math.min((Lt=Math.max(qe-_t,Bt))+_t,gt),ji=!1);else if(mt==="ytd")if(je)!je.hasData()||Tl(gt)&&Tl(Bt)||(Bt=Number.MAX_VALUE,gt=-Number.MAX_VALUE,xe.series.forEach(Ms=>{let zi=Ms.getColumn("x");zi.length&&(Bt=Math.min(zi[0],Bt),gt=Math.max(zi[zi.length-1],gt))}),ge=!1),Tl(gt)&&Tl(Bt)&&(Lt=Wt=(Vt=this.getYTDExtremes(gt,Bt)).min,qe=Vt.max);else{this.deferredYTDClick=J;return}else mt==="all"&&je&&(xe.navigator&&xe.navigator.baseSeries[0]&&(xe.navigator.baseSeries[0].xAxis.options.range=void 0),Lt=Bt,qe=gt);if(ji&&Ie._offsetMin&&Xn(Lt)&&(Lt+=Ie._offsetMin),Ie._offsetMax&&Xn(qe)&&(qe+=Ie._offsetMax),this.dropdown&&(this.dropdown.selectedIndex=J+1),je)Tl(Lt)&&Tl(qe)&&(je.setExtremes(Lt,qe,cl(ge,!0),void 0,{trigger:"rangeSelectorButton",rangeSelectorButton:Ie}),xe.setFixedRange(Ie._range));else{vt=gp(xe.options.xAxis||{})[0];let Ms=Ph(xe,"afterCreateAxes",function(){let zi=xe.xAxis[0];zi.range=zi.options.range=_t,zi.min=zi.options.min=Wt});Ph(xe,"load",function(){let zi=xe.xAxis[0];xe.setFixedRange(Ie._range),zi.options.range=vt.range,zi.options.min=vt.min,Ms()})}Kd(this,"afterBtnClick")}}setSelected(J){this.selected=this.options.selected=J}init(J){let ge=this,xe=J.options.rangeSelector,Ie=J.options.lang,je=xe.buttons,Ye=xe.selected,mt=function(){let bt=ge.minInput,Bt=ge.maxInput;bt&&bt.blur&&Kd(bt,"blur"),Bt&&Bt.blur&&Kd(Bt,"blur")};ge.chart=J,ge.options=xe,ge.buttons=[],ge.buttonOptions=je.map(bt=>(bt.type&&Ie.rangeSelector&&(bt.text??(bt.text=Ie.rangeSelector[`${bt.type}Text`]),bt.title??(bt.title=Ie.rangeSelector[`${bt.type}Title`])),bt.text=ku(bt.text,{count:bt.count||1}),bt.title=ku(bt.title,{count:bt.count||1}),bt)),this.eventsToUnbind=[],this.eventsToUnbind.push(Ph(J.container,"mousedown",mt)),this.eventsToUnbind.push(Ph(J,"resize",mt)),je.forEach(ge.computeButtonRange),Ye!==void 0&&je[Ye]&&this.clickButton(Ye,!1),this.eventsToUnbind.push(Ph(J,"load",function(){J.xAxis&&J.xAxis[0]&&Ph(J.xAxis[0],"setExtremes",function(bt){Tl(this.max)&&Tl(this.min)&&this.max-this.min!==J.fixedRange&&bt.trigger!=="rangeSelectorButton"&&bt.trigger!=="updatedData"&&ge.forcedDataGrouping&&!ge.frozenStates&&this.setDataGrouping(!1,!1)})})),this.createElements()}updateButtonStates(){let J=this,ge=this.chart,xe=this.dropdown,Ie=this.dropdownLabel,je=ge.xAxis[0],Ye=Math.round(je.max-je.min),mt=!je.hasVisibleSeries,bt=24*36e5,Bt=ge.scroller&&ge.scroller.getUnionExtremes()||je,gt=Bt.dataMin,Lt=Bt.dataMax,qe=J.getYTDExtremes(Lt,gt),vt=qe.min,_t=qe.max,Wt=J.selected,Gt=J.options.allButtonsEnabled,Vt=Array(J.buttonOptions.length).fill(0),ji=Tl(Wt),Ms=J.buttons,zi=!1,os=null;J.buttonOptions.forEach((Fs,Xi)=>{var Ea;let Es=Fs._range,Ns=Fs.type,rr=Fs.count||1,bs=Fs._offsetMax-Fs._offsetMin,Ks=Xi===Wt,or=Es>Lt-gt,Jo=Es<je.minRange,co=!1,eo=Es===Ye;if(Ks&&or&&(zi=!0),je.isOrdinal&&((Ea=je.ordinal)==null?void 0:Ea.positions)&&Es&&Ye<Es){let mn=je.ordinal.positions,qr=Kh.Additions.findIndexOf(mn,je.min,!0),Sl=Math.min(Kh.Additions.findIndexOf(mn,je.max,!0)+1,mn.length-1);mn[Sl]-mn[qr]>Es&&(eo=!0)}else(Ns==="month"||Ns==="year")&&Ye+36e5>={month:28,year:365}[Ns]*bt*rr-bs&&Ye-36e5<={month:31,year:366}[Ns]*bt*rr+bs?eo=!0:Ns==="ytd"?(eo=_t-vt+bs===Ye,co=!Ks):Ns==="all"&&(eo=je.max-je.min>=Lt-gt);let ya=!Gt&&!(zi&&Ns==="all")&&(or||Jo||mt),ta=zi&&Ns==="all"||!co&&eo||Ks&&J.frozenStates;ya?Vt[Xi]=3:ta&&(!ji||Xi===Wt)&&(os=Xi)}),os!==null?(Vt[os]=2,J.setSelected(os),this.dropdown&&(this.dropdown.selectedIndex=os+1)):(J.setSelected(),this.dropdown&&(this.dropdown.selectedIndex=-1),Ie&&(Ie.setState(0),Ie.attr({text:(ro.lang.rangeSelectorZoom||"")+" ▾"})));for(let Fs=0;Fs<Vt.length;Fs++){let Xi=Vt[Fs],Es=Ms[Fs];if(Es.state!==Xi&&(Es.setState(Xi),xe)){xe.options[Fs+1].disabled=Xi===3,Xi===2&&(Ie&&(Ie.setState(2),Ie.attr({text:J.buttonOptions[Fs].text+" ▾"})),xe.selectedIndex=Fs+1);let Ns=Ie.getBBox();Ba(xe,{width:`${Ns.width}px`,height:`${Ns.height}px`})}}}computeButtonRange(J){let ge=J.type,xe=J.count||1,Ie={millisecond:1,second:1e3,minute:6e4,hour:36e5,day:864e5,week:6048e5};Ie[ge]?J._range=Ie[ge]*xe:(ge==="month"||ge==="year")&&(J._range=24*{month:30,year:365}[ge]*36e5*xe),J._offsetMin=cl(J.offsetMin,0),J._offsetMax=cl(J.offsetMax,0),J._range+=J._offsetMax-J._offsetMin}getInputValue(J){let ge=J==="min"?this.minInput:this.maxInput,xe=this.chart.options.rangeSelector,Ie=this.chart.time;return ge?(ge.type==="text"&&xe.inputDateParser||this.defaultInputDateParser)(ge.value,Ie.timezone==="UTC",Ie):0}setInputValue(J,ge){let xe=this.options,Ie=this.chart.time,je=J==="min"?this.minInput:this.maxInput,Ye=J==="min"?this.minDateBox:this.maxDateBox;if(je){je.setAttribute("type",Fr(xe.inputDateFormat||"%e %b %Y"));let mt=je.getAttribute("data-hc-time"),bt=Xn(mt)?Number(mt):void 0;if(Xn(ge)){let Bt=bt;Xn(Bt)&&je.setAttribute("data-hc-time-previous",Bt),je.setAttribute("data-hc-time",ge),bt=ge}je.value=Ie.dateFormat(this.inputTypeFormats[je.type]||xe.inputEditDateFormat,bt),Ye&&Ye.attr({text:Ie.dateFormat(xe.inputDateFormat,bt)})}}setInputExtremes(J,ge,xe){let Ie=J==="min"?this.minInput:this.maxInput;if(Ie){let je=this.inputTypeFormats[Ie.type],Ye=this.chart.time;if(je){let mt=Ye.dateFormat(je,ge);Ie.min!==mt&&(Ie.min=mt);let bt=Ye.dateFormat(je,xe);Ie.max!==bt&&(Ie.max=bt)}}}showInput(J){let ge=J==="min"?this.minDateBox:this.maxDateBox,xe=J==="min"?this.minInput:this.maxInput;if(xe&&ge&&this.inputGroup){let Ie=xe.type==="text",{translateX:je=0,translateY:Ye=0}=this.inputGroup,{x:mt=0,width:bt=0,height:Bt=0}=ge,{inputBoxWidth:gt}=this.options;Ba(xe,{width:Ie?bt+(gt?-2:20)+"px":"auto",height:Bt-2+"px",border:"2px solid silver"}),Ie&&gt?Ba(xe,{left:je+mt+"px",top:Ye+"px"}):Ba(xe,{left:Math.min(Math.round(mt+je-(xe.offsetWidth-bt)/2),this.chart.chartWidth-xe.offsetWidth)+"px",top:Ye-(xe.offsetHeight-Bt)/2+"px"})}}hideInput(J){let ge=J==="min"?this.minInput:this.maxInput;ge&&Ba(ge,{top:"-9999em",border:0,width:"1px",height:"1px"})}defaultInputDateParser(J,ge,xe){return(xe==null?void 0:xe.parse(J))||0}drawInput(J){let{chart:ge,div:xe,inputGroup:Ie}=this,je=this,Ye=ge.renderer.style||{},mt=ge.renderer,bt=ge.options.rangeSelector,Bt=ro.lang,gt=J==="min";function Lt(Vt){var rr;let{maxInput:ji,minInput:Ms}=je,zi=ge.xAxis[0],os=((rr=ge.scroller)==null?void 0:rr.getUnionExtremes())||zi,Fs=os.dataMin,Xi=os.dataMax,Es=ge.xAxis[0].getExtremes()[Vt],Ns=je.getInputValue(Vt);Tl(Ns)&&Ns!==Es&&(gt&&ji&&Tl(Fs)?Ns>Number(ji.getAttribute("data-hc-time"))?Ns=void 0:Ns<Fs&&(Ns=Fs):Ms&&Tl(Xi)&&(Ns<Number(Ms.getAttribute("data-hc-time"))?Ns=void 0:Ns>Xi&&(Ns=Xi)),Ns!==void 0&&zi.setExtremes(gt?Ns:zi.min,gt?zi.max:Ns,void 0,void 0,{trigger:"rangeSelectorInput"}))}let qe=Bt[gt?"rangeSelectorFrom":"rangeSelectorTo"]||"",vt=mt.label(qe,0).addClass("highcharts-range-label").attr({padding:2*!!qe,height:qe?bt.inputBoxHeight:0}).add(Ie),_t=mt.label("",0).addClass("highcharts-range-input").attr({padding:2,width:bt.inputBoxWidth,height:bt.inputBoxHeight,"text-align":"center"}).on("click",function(){je.showInput(J),je[J+"Input"].focus()});ge.styledMode||_t.attr({stroke:bt.inputBoxBorderColor,"stroke-width":1}),_t.add(Ie);let Wt=gc("input",{name:J,className:"highcharts-range-selector"},void 0,xe);Wt.setAttribute("type",Fr(bt.inputDateFormat||"%e %b %Y")),ge.styledMode||(vt.css(Wa(Ye,bt.labelStyle)),_t.css(Wa({color:"#333333"},Ye,bt.inputStyle)),Ba(Wt,Vp({position:"absolute",border:0,boxShadow:"0 0 15px rgba(0,0,0,0.3)",width:"1px",height:"1px",padding:0,textAlign:"center",fontSize:Ye.fontSize,fontFamily:Ye.fontFamily,top:"-9999em"},bt.inputStyle))),Wt.onfocus=()=>{je.showInput(J)},Wt.onblur=()=>{Wt===Cs().doc.activeElement&&Lt(J),je.hideInput(J),je.setInputValue(J),Wt.blur()};let Gt=!1;return Wt.onchange=()=>{Gt||(Lt(J),je.hideInput(J),Wt.blur())},Wt.onkeypress=Vt=>{Vt.keyCode===13&&Lt(J)},Wt.onkeydown=Vt=>{Gt=!0,(Vt.key==="ArrowUp"||Vt.key==="ArrowDown"||Vt.key==="Tab")&&Lt(J)},Wt.onkeyup=()=>{Gt=!1},{dateBox:_t,input:Wt,label:vt}}getPosition(){let J=this.chart,ge=J.options.rangeSelector,xe=ge.verticalAlign==="top"?J.plotTop-J.axisOffset[0]:0;return{buttonTop:xe+ge.buttonPosition.y,inputTop:xe+ge.inputPosition.y-10}}getYTDExtremes(J,ge){let xe=this.chart.time,Ie=xe.toParts(J)[0];return{max:J,min:Math.max(ge,xe.makeTime(Ie,0))}}createElements(){var bt;let J=this.chart,ge=J.renderer,xe=J.container,Ie=J.options,je=Ie.rangeSelector,Ye=je.inputEnabled,mt=cl((bt=Ie.chart.style)==null?void 0:bt.zIndex,0)+1;je.enabled!==!1&&(this.group=ge.g("range-selector-group").attr({zIndex:7}).add(),this.div=gc("div",void 0,{position:"relative",height:0,zIndex:mt}),this.buttonOptions.length&&this.renderButtons(),xe.parentNode&&xe.parentNode.insertBefore(this.div,xe),Ye&&this.createInputs())}createInputs(){this.inputGroup=this.chart.renderer.g("input-group").add(this.group);let J=this.drawInput("min");this.minDateBox=J.dateBox,this.minLabel=J.label,this.minInput=J.input;let ge=this.drawInput("max");this.maxDateBox=ge.dateBox,this.maxLabel=ge.label,this.maxInput=ge.input}render(J,ge){var je,Ye;if(this.options.enabled===!1)return;let xe=this.chart,Ie=xe.options.rangeSelector;if(Ie.inputEnabled){this.inputGroup||this.createInputs(),this.setInputValue("min",J),this.setInputValue("max",ge),this.chart.styledMode||((je=this.maxLabel)==null||je.css(Ie.labelStyle),(Ye=this.minLabel)==null||Ye.css(Ie.labelStyle));let mt=xe.scroller&&xe.scroller.getUnionExtremes()||xe.xAxis[0]||{};if(Xn(mt.dataMin)&&Xn(mt.dataMax)){let bt=xe.xAxis[0].minRange||0;this.setInputExtremes("min",mt.dataMin,Math.min(mt.dataMax,this.getInputValue("max"))-bt),this.setInputExtremes("max",Math.max(mt.dataMin,this.getInputValue("min"))+bt,mt.dataMax)}if(this.inputGroup){let bt=0;[this.minLabel,this.minDateBox,this.maxLabel,this.maxDateBox].forEach(Bt=>{if(Bt){let{width:gt}=Bt.getBBox();gt&&(Bt.attr({x:bt}),bt+=gt+Ie.inputSpacing)}})}}else this.inputGroup&&(this.inputGroup.destroy(),delete this.inputGroup);!this.chart.styledMode&&this.zoomText&&this.zoomText.css(Ie.labelStyle),this.alignElements(),this.updateButtonStates()}renderButtons(){var qe;var J;let{chart:ge,options:xe}=this,Ie=ro.lang,je=ge.renderer,Ye=Wa(xe.buttonTheme),mt=Ye&&Ye.states;delete Ye.width,delete Ye.states,this.buttonGroup=je.g("range-selector-buttons").add(this.group);let bt=this.dropdown=gc("select",void 0,{position:"absolute",padding:0,border:0,cursor:"pointer",opacity:1e-4},this.div),Bt=(qe=ge.userOptions.rangeSelector)==null?void 0:qe.buttonTheme;this.dropdownLabel=je.button("",0,0,()=>{},Wa(Ye,{"stroke-width":cl(Ye["stroke-width"],0),width:"auto",paddingLeft:cl(xe.buttonTheme.paddingLeft,Bt==null?void 0:Bt.padding,8),paddingRight:cl(xe.buttonTheme.paddingRight,Bt==null?void 0:Bt.padding,8)}),mt&&mt.hover,mt&&mt.select,mt&&mt.disabled).hide().add(this.group),Ph(bt,"touchstart",()=>{bt.style.fontSize="16px"});let gt=Cs().isMS?"mouseover":"mouseenter",Lt=Cs().isMS?"mouseout":"mouseleave";Ph(bt,gt,()=>{Kd(this.dropdownLabel.element,gt)}),Ph(bt,Lt,()=>{Kd(this.dropdownLabel.element,Lt)}),Ph(bt,"change",()=>{Kd(this.buttons[bt.selectedIndex-1].element,"click")}),this.zoomText=je.label(Ie.rangeSelectorZoom||"",0).attr({padding:xe.buttonTheme.padding,height:xe.buttonTheme.height,paddingLeft:0,paddingRight:0}).add(this.buttonGroup),this.chart.styledMode||(this.zoomText.css(xe.labelStyle),(J=xe.buttonTheme)["stroke-width"]??(J["stroke-width"]=0)),gc("option",{textContent:this.zoomText.textStr,disabled:!0},void 0,bt),this.createButtons()}createButtons(){let{options:J}=this,ge=Wa(J.buttonTheme),xe=ge&&ge.states,Ie=ge.width||28;delete ge.width,delete ge.states,this.buttonOptions.forEach((je,Ye)=>{this.createButton(je,Ye,Ie,xe)})}createButton(J,ge,xe,Ie){let{dropdown:je,buttons:Ye,chart:mt,options:bt}=this,Bt=mt.renderer,gt=Wa(bt.buttonTheme);je==null||je.add(gc("option",{textContent:J.title||J.text}),ge+2),Ye[ge]=Bt.button(J.text??"",0,0,Lt=>{let qe,vt=J.events&&J.events.click;vt&&(qe=vt.call(J,Lt)),qe!==!1&&this.clickButton(ge),this.isActive=!0},gt,Ie&&Ie.hover,Ie&&Ie.select,Ie&&Ie.disabled).attr({"text-align":"center",width:xe}).add(this.buttonGroup),J.title&&Ye[ge].attr("title",J.title)}alignElements(){var Wt;let{buttonGroup:J,buttons:ge,chart:xe,group:Ie,inputGroup:je,options:Ye,zoomText:mt}=this,bt=xe.options,Bt=bt.exporting&&bt.exporting.enabled!==!1&&bt.navigation&&bt.navigation.buttonOptions,{buttonPosition:gt,inputPosition:Lt,verticalAlign:qe}=Ye,vt=(Gt,Vt,ji)=>Bt&&this.titleCollision(xe)&&qe==="top"&&ji&&Vt.y-Gt.getBBox().height-12<(Bt.y||0)+(Bt.height||0)+xe.spacing[0]?-40:0,_t=xe.plotLeft;if(Ie&&gt&&Lt){let Gt=gt.x-xe.spacing[3];if(J){if(this.positionButtons(),!this.initialButtonGroupWidth){let Ns=0;mt&&(Ns+=mt.getBBox().width+5),ge.forEach((rr,bs)=>{Ns+=rr.width||0,bs!==ge.length-1&&(Ns+=Ye.buttonSpacing)}),this.initialButtonGroupWidth=Ns}_t-=xe.spacing[3];let Es=vt(J,gt,gt.align==="right"||Lt.align==="right");this.alignButtonGroup(Es),(Wt=this.buttonGroup)!=null&&Wt.translateY&&this.dropdownLabel.attr({y:this.buttonGroup.translateY}),Ie.placed=J.placed=xe.hasLoaded}let Vt=0;Ye.inputEnabled&&je&&(Vt=vt(je,Lt,gt.align==="right"||Lt.align==="right"),Lt.align==="left"?Gt=_t:Lt.align==="right"&&(Gt=-Math.max(xe.axisOffset[1],-Vt)),je.align({y:Lt.y,width:je.getBBox().width,align:Lt.align,x:Lt.x+Gt-2},!0,xe.spacingBox),je.placed=xe.hasLoaded),this.handleCollision(Vt),Ie.align({verticalAlign:qe},!0,xe.spacingBox);let ji=Ie.alignAttr.translateY,Ms=Ie.getBBox().height+20,zi=0;if(qe==="bottom"){let Es=xe.legend&&xe.legend.options;zi=ji-(Ms=Ms+(Es&&Es.verticalAlign==="bottom"&&Es.enabled&&!Es.floating?xe.legend.legendHeight+cl(Es.margin,10):0)-20)-(Ye.floating?0:Ye.y)-(xe.titleOffset?xe.titleOffset[2]:0)-10}qe==="top"?(Ye.floating&&(zi=0),xe.titleOffset&&xe.titleOffset[0]&&(zi=xe.titleOffset[0]),zi+=xe.margin[0]-xe.spacing[0]||0):qe==="middle"&&(Lt.y===gt.y?zi=ji:(Lt.y||gt.y)&&(Lt.y<0||gt.y<0?zi-=Math.min(Lt.y,gt.y):zi=ji-Ms)),Ie.translate(Ye.x,Ye.y+Math.floor(zi));let{minInput:os,maxInput:Fs,dropdown:Xi}=this;Ye.inputEnabled&&os&&Fs&&(os.style.marginTop=Ie.translateY+"px",Fs.style.marginTop=Ie.translateY+"px"),Xi&&(Xi.style.marginTop=Ie.translateY+"px")}}redrawElements(){var Ie,je,Ye,mt,bt;let J=this.chart,{inputBoxHeight:ge,inputBoxBorderColor:xe}=this.options;if((Ie=this.maxDateBox)==null||Ie.attr({height:ge}),(je=this.minDateBox)==null||je.attr({height:ge}),J.styledMode||((Ye=this.maxDateBox)==null||Ye.attr({stroke:xe}),(mt=this.minDateBox)==null||mt.attr({stroke:xe})),this.isDirty){this.isDirty=!1,this.isCollapsed=void 0;let Bt=this.options.buttons??[],gt=Math.min(Bt.length,this.buttonOptions.length),{dropdown:Lt,options:qe}=this,vt=Wa(qe.buttonTheme),_t=vt&&vt.states,Wt=vt.width||28;if(Bt.length<this.buttonOptions.length)for(let Gt=this.buttonOptions.length-1;Gt>=Bt.length;Gt--){let Vt=this.buttons.pop();Vt==null||Vt.destroy(),(bt=this.dropdown)==null||bt.options.remove(Gt+1)}for(let Gt=gt-1;Gt>=0;Gt--)if(Object.keys(sd(Bt[Gt],this.buttonOptions[Gt])).length!==0){let Vt=Bt[Gt];this.buttons[Gt].destroy(),Lt==null||Lt.options.remove(Gt+1),this.createButton(Vt,Gt,Wt,_t),this.computeButtonRange(Vt)}if(Bt.length>this.buttonOptions.length)for(let Gt=this.buttonOptions.length;Gt<Bt.length;Gt++)this.createButton(Bt[Gt],Gt,Wt,_t),this.computeButtonRange(Bt[Gt]);this.buttonOptions=this.options.buttons??[],Xn(this.options.selected)&&this.buttons.length&&this.clickButton(this.options.selected,!1)}}alignButtonGroup(J,ge){let{chart:xe,options:Ie,buttonGroup:je,dropdown:Ye,dropdownLabel:mt}=this,{buttonPosition:bt}=Ie,Bt=xe.plotLeft-xe.spacing[3],gt=bt.x-xe.spacing[3],Lt=xe.plotLeft;bt.align==="right"?(gt+=J-Bt,this.hasVisibleDropdown&&(Lt=xe.chartWidth+J-this.maxButtonWidth()-20)):bt.align==="center"&&(gt-=Bt/2,this.hasVisibleDropdown&&(Lt=xe.chartWidth/2-this.maxButtonWidth())),Ye&&Ba(Ye,{left:Lt+"px",top:(je==null?void 0:je.translateY)+"px"}),mt==null||mt.attr({x:Lt}),je&&je.align({y:bt.y,width:cl(ge,this.initialButtonGroupWidth),align:bt.align,x:gt},!0,xe.spacingBox)}positionButtons(){let{buttons:J,chart:ge,options:xe,zoomText:Ie}=this,je=ge.hasLoaded?"animate":"attr",{buttonPosition:Ye}=xe,mt=ge.plotLeft,bt=mt;Ie&&Ie.visibility!=="hidden"&&(Ie[je]({x:cl(mt+Ye.x,mt)}),bt+=Ye.x+Ie.getBBox().width+5);for(let Bt=0,gt=this.buttonOptions.length;Bt<gt;++Bt)J[Bt].visibility!=="hidden"?(J[Bt][je]({x:bt}),bt+=(J[Bt].width||0)+xe.buttonSpacing):J[Bt][je]({x:mt})}handleCollision(J){let{chart:ge,buttonGroup:xe,inputGroup:Ie,initialButtonGroupWidth:je}=this,{buttonPosition:Ye,dropdown:mt,inputPosition:bt}=this.options,Bt=()=>{Ie&&xe&&Ie.attr({translateX:Ie.alignAttr.translateX+(ge.axisOffset[1]>=-J?0:-J),translateY:Ie.alignAttr.translateY+xe.getBBox().height+10})};Ie&&xe?bt.align===Ye.align?(Bt(),je>ge.plotWidth+J-20?this.collapseButtons():this.expandButtons()):je-J+Ie.getBBox().width>ge.plotWidth?mt==="responsive"?this.collapseButtons():Bt():this.expandButtons():xe&&mt==="responsive"&&(je>ge.plotWidth?this.collapseButtons():this.expandButtons()),xe&&(mt==="always"&&this.collapseButtons(),mt==="never"&&this.expandButtons()),this.alignButtonGroup(J)}collapseButtons(){let{buttons:J,zoomText:ge}=this;this.isCollapsed!==!0&&(this.isCollapsed=!0,ge.hide(),J.forEach(xe=>void xe.hide()),this.showDropdown())}expandButtons(){let{buttons:J,zoomText:ge}=this;this.isCollapsed!==!1&&(this.isCollapsed=!1,this.hideDropdown(),ge.show(),J.forEach(xe=>void xe.show()),this.positionButtons())}showDropdown(){let{buttonGroup:J,dropdownLabel:ge,dropdown:xe}=this;J&&xe&&(ge.show(),Ba(xe,{visibility:"inherit"}),this.hasVisibleDropdown=!0)}hideDropdown(){let{dropdown:J}=this;J&&(this.dropdownLabel.hide(),Ba(J,{visibility:"hidden",width:"1px",height:"1px"}),this.hasVisibleDropdown=!1)}getHeight(){let J=this.options,ge=this.group,xe=J.inputPosition,Ie=J.buttonPosition,je=J.y,Ye=Ie.y,mt=xe.y,bt=0;if(J.height)return J.height;this.alignElements(),bt=ge?ge.getBBox(!0).height+13+je:0;let Bt=Math.min(mt,Ye);return(mt<0&&Ye<0||mt>0&&Ye>0)&&(bt+=Math.abs(Bt)),bt}titleCollision(J){return!(J.options.title.text||J.options.subtitle.text)}update(J,ge=!0){let xe=this.chart;if(Wa(!0,this.options,J),this.options.selected&&this.options.selected>=this.options.buttons.length&&(this.options.selected=void 0,xe.options.rangeSelector.selected=void 0),Xn(J.enabled))return this.destroy(),this.init(xe);this.isDirty=!!J.buttons,ge&&this.render()}destroy(){let J=this,ge=J.minInput,xe=J.maxInput;J.eventsToUnbind&&(J.eventsToUnbind.forEach(Ie=>Ie()),J.eventsToUnbind=void 0),Hf(J.buttons),ge&&(ge.onfocus=ge.onblur=ge.onchange=null),xe&&(xe.onfocus=xe.onblur=xe.onchange=null),Jd(J,function(Ie,je){Ie&&je!=="chart"&&(Ie instanceof Hn()?Ie.destroy():Ie instanceof window.HTMLElement&&Zd(Ie),delete J[je]),Ie!==cs.prototype[je]&&(J[je]=null)},this),this.buttons=[]}}Vp(cs.prototype,{inputTypeFormats:{"datetime-local":"%Y-%m-%dT%H:%M:%S",date:"%Y-%m-%d",time:"%H:%M:%S"}});let Jh={applyRadius:function(Ge,J){let ge=[];for(let xe=0;xe<Ge.length;xe++){let Ie=Ge[xe][1],je=Ge[xe][2];if(typeof Ie=="number"&&typeof je=="number")if(xe===0)ge.push(["M",Ie,je]);else if(xe===Ge.length-1)ge.push(["L",Ie,je]);else if(J){let Ye=Ge[xe-1],mt=Ge[xe+1];if(Ye&&mt){let bt=Ye[1],Bt=Ye[2],gt=mt[1],Lt=mt[2];if(typeof bt=="number"&&typeof gt=="number"&&typeof Bt=="number"&&typeof Lt=="number"&&bt!==gt&&Bt!==Lt){let qe=bt<gt?1:-1,vt=Bt<Lt?1:-1;ge.push(["L",Ie-qe*Math.min(Math.abs(Ie-bt),J),je-vt*Math.min(Math.abs(je-Bt),J)],["C",Ie,je,Ie,je,Ie+qe*Math.min(Math.abs(Ie-gt),J),je+vt*Math.min(Math.abs(je-Lt),J)])}}}else ge.push(["L",Ie,je])}return ge}},{pick:hr}=Cs(),{min:An,max:Qh,abs:Zs}=Math;function ec(Ge,J,ge){let xe=J-1e-7,Ie=0,je=Ge.length-1,Ye,mt;for(;Ie<=je;)if((mt=xe-Ge[Ye=je+Ie>>1].xMin)>0)Ie=Ye+1;else{if(!(mt<0))return Ye;je=Ye-1}return Ie>0?Ie-1:0}function Ql(Ge,J){let ge=ec(Ge,J.x+1)+1;for(;ge--;){var xe;if(Ge[ge].xMax>=J.x&&(xe=Ge[ge],J.x<=xe.xMax&&J.x>=xe.xMin&&J.y<=xe.yMax&&J.y>=xe.yMin))return ge}return-1}function rd(Ge){let J=[];if(Ge.length){J.push(["M",Ge[0].start.x,Ge[0].start.y]);for(let ge=0;ge<Ge.length;++ge)J.push(["L",Ge[ge].end.x,Ge[ge].end.y])}return J}function Rc(Ge,J){Ge.yMin=Qh(Ge.yMin,J.yMin),Ge.yMax=An(Ge.yMax,J.yMax),Ge.xMin=Qh(Ge.xMin,J.xMin),Ge.xMax=An(Ge.xMax,J.xMax)}let tc=function(Ge,J,ge){let xe=[],Ie=ge.chartObstacles,je=Ql(Ie,Ge),Ye=Ql(Ie,J),mt,bt=hr(ge.startDirectionX,Zs(J.x-Ge.x)>Zs(J.y-Ge.y))?"x":"y",Bt,gt,Lt,qe;function vt(Vt,ji,Ms,zi,os){let Fs={x:Vt.x,y:Vt.y};return Fs[ji]=Ms[zi||ji]+(os||0),Fs}function _t(Vt,ji,Ms){let zi=Zs(ji[Ms]-Vt[Ms+"Min"])>Zs(ji[Ms]-Vt[Ms+"Max"]);return vt(ji,Ms,Vt,Ms+(zi?"Max":"Min"),zi?1:-1)}Ye>-1?(mt={start:gt=_t(Ie[Ye],J,bt),end:J},qe=gt):qe=J,je>-1&&(gt=_t(Bt=Ie[je],Ge,bt),xe.push({start:Ge,end:gt}),gt[bt]>=Ge[bt]==gt[bt]>=qe[bt]&&(Lt=Ge[bt=bt==="y"?"x":"y"]<J[bt],xe.push({start:gt,end:vt(gt,bt,Bt,bt+(Lt?"Max":"Min"),Lt?1:-1)}),bt=bt==="y"?"x":"y"));let Wt=xe.length?xe[xe.length-1].end:Ge;gt=vt(Wt,bt,qe),xe.push({start:Wt,end:gt});let Gt=vt(gt,bt=bt==="y"?"x":"y",qe);return xe.push({start:gt,end:Gt}),xe.push(mt),{path:Jh.applyRadius(rd(xe),ge.radius),obstacles:xe}};function Qa(Ge,J,ge){let xe=hr(ge.startDirectionX,Zs(J.x-Ge.x)>Zs(J.y-Ge.y)),Ie=xe?"x":"y",je=[],Ye=ge.obstacleMetrics,mt=An(Ge.x,J.x)-Ye.maxWidth-10,bt=Qh(Ge.x,J.x)+Ye.maxWidth+10,Bt=An(Ge.y,J.y)-Ye.maxHeight-10,gt=Qh(Ge.y,J.y)+Ye.maxHeight+10,Lt,qe,vt,_t=!1,Wt=ge.chartObstacles,Gt=ec(Wt,bt),Vt=ec(Wt,mt);function ji(zi,os,Fs){let Xi,Es,Ns,rr,bs=zi.x<os.x?1:-1;zi.x<os.x?(Xi=zi,Es=os):(Xi=os,Es=zi),zi.y<os.y?(rr=zi,Ns=os):(rr=os,Ns=zi);let Ks=bs<0?An(ec(Wt,Es.x),Wt.length-1):0;for(;Wt[Ks]&&(bs>0&&Wt[Ks].xMin<=Es.x||bs<0&&Wt[Ks].xMax>=Xi.x);){if(Wt[Ks].xMin<=Es.x&&Wt[Ks].xMax>=Xi.x&&Wt[Ks].yMin<=Ns.y&&Wt[Ks].yMax>=rr.y)return Fs?{y:zi.y,x:zi.x<os.x?Wt[Ks].xMin-1:Wt[Ks].xMax+1,obstacle:Wt[Ks]}:{x:zi.x,y:zi.y<os.y?Wt[Ks].yMin-1:Wt[Ks].yMax+1,obstacle:Wt[Ks]};Ks+=bs}return os}function Ms(zi,os,Fs,Xi,Es){let Ns=Es.soft,rr=Es.hard,bs=Xi?"x":"y",Ks={x:os.x,y:os.y},or={x:os.x,y:os.y},Jo=zi[bs+"Max"]>=Ns[bs+"Max"],co=zi[bs+"Min"]<=Ns[bs+"Min"],eo=zi[bs+"Max"]>=rr[bs+"Max"],ya=zi[bs+"Min"]<=rr[bs+"Min"],ta=Zs(zi[bs+"Min"]-os[bs]),Ea=Zs(zi[bs+"Max"]-os[bs]),mn=10>Zs(ta-Ea)?os[bs]<Fs[bs]:Ea<ta;or[bs]=zi[bs+"Min"],Ks[bs]=zi[bs+"Max"];let qr=ji(os,or,Xi)[bs]!==or[bs],Sl=ji(os,Ks,Xi)[bs]!==Ks[bs];return mn=qr?!Sl||mn:!Sl&&mn,mn=co?!Jo||mn:!Jo&&mn,mn=ya?!eo||mn:!eo&&mn}for((Gt=Ql(Wt=Wt.slice(Vt,Gt+1),J))>-1&&(vt=function(zi,os,Fs){let Xi=An(zi.xMax-os.x,os.x-zi.xMin)<An(zi.yMax-os.y,os.y-zi.yMin),Es=Ms(zi,os,Fs,Xi,{soft:ge.hardBounds,hard:ge.hardBounds});return Xi?{y:os.y,x:zi[Es?"xMax":"xMin"]+(Es?1:-1)}:{x:os.x,y:zi[Es?"yMax":"yMin"]+(Es?1:-1)}}(Wt[Gt],J,Ge),je.push({end:J,start:vt}),J=vt);(Gt=Ql(Wt,J))>-1;)qe=J[Ie]-Ge[Ie]<0,(vt={x:J.x,y:J.y})[Ie]=Wt[Gt][qe?Ie+"Max":Ie+"Min"]+(qe?1:-1),je.push({end:J,start:vt}),J=vt;return{path:rd(Lt=(Lt=function zi(os,Fs,Xi){let Es,Ns,rr,bs,Ks,or,Jo;if(os.x===Fs.x&&os.y===Fs.y)return[];let co=Xi?"x":"y",eo=ge.obstacleOptions.margin,ya={soft:{xMin:mt,xMax:bt,yMin:Bt,yMax:gt},hard:ge.hardBounds};return(Ks=Ql(Wt,os))>-1?(bs=Ms(Ks=Wt[Ks],os,Fs,Xi,ya),Rc(Ks,ge.hardBounds),Jo=Xi?{y:os.y,x:Ks[bs?"xMax":"xMin"]+(bs?1:-1)}:{x:os.x,y:Ks[bs?"yMax":"yMin"]+(bs?1:-1)},(or=Ql(Wt,Jo))>-1&&(Rc(or=Wt[or],ge.hardBounds),Jo[co]=bs?Qh(Ks[co+"Max"]-eo+1,(or[co+"Min"]+Ks[co+"Max"])/2):An(Ks[co+"Min"]+eo-1,(or[co+"Max"]+Ks[co+"Min"])/2),os.x===Jo.x&&os.y===Jo.y?(_t&&(Jo[co]=bs?Qh(Ks[co+"Max"],or[co+"Max"])+1:An(Ks[co+"Min"],or[co+"Min"])-1),_t=!_t):_t=!1),Ns=[{start:os,end:Jo}]):(Es=ji(os,{x:Xi?Fs.x:os.x,y:Xi?os.y:Fs.y},Xi),Ns=[{start:os,end:{x:Es.x,y:Es.y}}],Es[Xi?"x":"y"]!==Fs[Xi?"x":"y"]&&(bs=Ms(Es.obstacle,Es,Fs,!Xi,ya),Rc(Es.obstacle,ge.hardBounds),rr={x:Xi?Es.x:Es.obstacle[bs?"xMax":"xMin"]+(bs?1:-1),y:Xi?Es.obstacle[bs?"yMax":"yMin"]+(bs?1:-1):Es.y},Xi=!Xi,Ns=Ns.concat(zi({x:Es.x,y:Es.y},rr,Xi)))),Ns=Ns.concat(zi(Ns[Ns.length-1].end,Fs,!Xi))}(Ge,J,xe)).concat(je.reverse())),obstacles:Lt}}tc.requiresObstacles=!0,Qa.requiresObstacles=!0;let ic={connectors:{type:"straight",radius:0,lineWidth:1,marker:{enabled:!1,align:"center",verticalAlign:"middle",inside:!1,lineWidth:1},startMarker:{symbol:"diamond"},endMarker:{symbol:"arrow-filled"}}},{setOptions:Aa}=Cs(),{defined:df,error:eh,merge:zl}=Cs();function hh(Ge){let J=Ge.shapeArgs;if(J)return{xMin:J.x||0,xMax:(J.x||0)+(J.width||0),yMin:J.y||0,yMax:(J.y||0)+(J.height||0)};let ge=Ge.graphic&&Ge.graphic.getBBox();return ge?{xMin:Ge.plotX-ge.width/2,xMax:Ge.plotX+ge.width/2,yMin:Ge.plotY-ge.height/2,yMax:Ge.plotY+ge.height/2}:null}(function(Ge){function J(Ie){let je,Ye,mt=hh(this);switch(Ie.align){case"right":je="xMax";break;case"left":je="xMin"}switch(Ie.verticalAlign){case"top":Ye="yMin";break;case"bottom":Ye="yMax"}return{x:je?mt[je]:(mt.xMin+mt.xMax)/2,y:Ye?mt[Ye]:(mt.yMin+mt.yMax)/2}}function ge(Ie,je){let Ye;return!df(je)&&(Ye=hh(this))&&(je={x:(Ye.xMin+Ye.xMax)/2,y:(Ye.yMin+Ye.yMax)/2}),Math.atan2(je.y-Ie.y,Ie.x-je.x)}function xe(Ie,je,Ye){let mt=2*Math.PI,bt=hh(this),Bt=bt.xMax-bt.xMin,gt=bt.yMax-bt.yMin,Lt=Math.atan2(gt,Bt),qe=Bt/2,vt=gt/2,_t=bt.xMin+qe,Wt=bt.yMin+vt,Gt={x:_t,y:Wt},Vt=Ie,ji=1,Ms=!1,zi=1,os=1;for(;Vt<-Math.PI;)Vt+=mt;for(;Vt>Math.PI;)Vt-=mt;return ji=Math.tan(Vt),Vt>-Lt&&Vt<=Lt?(os=-1,Ms=!0):Vt>Lt&&Vt<=Math.PI-Lt?os=-1:Vt>Math.PI-Lt||Vt<=-(Math.PI-Lt)?(zi=-1,Ms=!0):zi=-1,Ms?(Gt.x+=zi*qe,Gt.y+=os*qe*ji):(Gt.x+=gt/(2*ji)*zi,Gt.y+=os*vt),Ye.x!==_t&&(Gt.x=Ye.x),Ye.y!==Wt&&(Gt.y=Ye.y),{x:Gt.x+je*Math.cos(Vt),y:Gt.y-je*Math.sin(Vt)}}Ge.compose=function(Ie,je,Ye){let mt=Ye.prototype;mt.getPathfinderAnchorPoint||(Ie.prototype.callbacks.push(function(bt){bt.options.connectors.enabled!==!1&&((bt.options.pathfinder||bt.series.reduce(function(Bt,gt){return gt.options&&zl(!0,gt.options.connectors=gt.options.connectors||{},gt.options.pathfinder),Bt||gt.options&&gt.options.pathfinder},!1))&&(zl(!0,bt.options.connectors=bt.options.connectors||{},bt.options.pathfinder),eh('WARNING: Pathfinder options have been renamed. Use "chart.connectors" or "series.connectors" instead.')),this.pathfinder=new je(this),this.pathfinder.update(!0))}),mt.getMarkerVector=xe,mt.getPathfinderAnchorPoint=J,mt.getRadiansToVector=ge,Aa(ic))}})(Or||(Or={}));let uf=Or;var Qd=Pi(260),eu=Pi.n(Qd);let{addEvent:yc,defined:kd,pick:xc,splat:Xf}=Cs(),Bc=Math.max,Am=Math.min;class Fc{static compose(J,ge){uf.compose(J,Fc,ge)}constructor(J){this.init(J)}init(J){this.chart=J,this.connections=[],yc(J,"redraw",function(){this.pathfinder.update()})}update(J){let ge=this.chart,xe=this,Ie=xe.connections;xe.connections=[],ge.series.forEach(function(je){je.visible&&!je.options.isInternal&&je.points.forEach(function(Ye){var gt;let mt,bt=Ye.options;bt&&bt.dependency&&(bt.connect=bt.dependency);let Bt=(gt=Ye.options)!=null&&gt.connect?Xf(Ye.options.connect):[];Ye.visible&&Ye.isInside!==!1&&Bt.forEach(Lt=>{let qe=typeof Lt=="string"?Lt:Lt.to;qe&&(mt=ge.get(qe)),mt instanceof eu()&&mt.series.visible&&mt.visible&&mt.isInside!==!1&&xe.connections.push(new Pl(Ye,mt,typeof Lt=="string"?{}:Lt))})})});for(let je=0,Ye,mt,bt=Ie.length,Bt=xe.connections.length;je<bt;++je){mt=!1;let gt=Ie[je];for(Ye=0;Ye<Bt;++Ye){let Lt=xe.connections[Ye];if((gt.options&&gt.options.type)===(Lt.options&&Lt.options.type)&&gt.fromPoint===Lt.fromPoint&&gt.toPoint===Lt.toPoint){Lt.graphics=gt.graphics,mt=!0;break}}mt||gt.destroy()}delete this.chartObstacles,delete this.lineObstacles,xe.renderConnections(J)}renderConnections(J){J?this.chart.series.forEach(function(ge){let xe=function(){let Ie=ge.chart.pathfinder;(Ie&&Ie.connections||[]).forEach(function(je){je.fromPoint&&je.fromPoint.series===ge&&je.render()}),ge.pathfinderRemoveRenderEvent&&(ge.pathfinderRemoveRenderEvent(),delete ge.pathfinderRemoveRenderEvent)};ge.options.animation===!1?xe():ge.pathfinderRemoveRenderEvent=yc(ge,"afterAnimate",xe)}):this.connections.forEach(function(ge){ge.render()})}getChartObstacles(J){let ge=this.chart.series,xe=xc(J.algorithmMargin,0),Ie=[],je;for(let Ye=0,mt=ge.length;Ye<mt;++Ye)if(ge[Ye].visible&&!ge[Ye].options.isInternal)for(let bt=0,Bt=ge[Ye].points.length,gt,Lt;bt<Bt;++bt)(Lt=ge[Ye].points[bt]).visible&&(gt=function(qe){let vt=qe.shapeArgs;if(vt)return{xMin:vt.x||0,xMax:(vt.x||0)+(vt.width||0),yMin:vt.y||0,yMax:(vt.y||0)+(vt.height||0)};let _t=qe.graphic&&qe.graphic.getBBox();return _t?{xMin:qe.plotX-_t.width/2,xMax:qe.plotX+_t.width/2,yMin:qe.plotY-_t.height/2,yMax:qe.plotY+_t.height/2}:null}(Lt))&&Ie.push({xMin:gt.xMin-xe,xMax:gt.xMax+xe,yMin:gt.yMin-xe,yMax:gt.yMax+xe});return Ie=Ie.sort(function(Ye,mt){return Ye.xMin-mt.xMin}),kd(J.algorithmMargin)||(je=J.algorithmMargin=function(Ye){let mt,bt=Ye.length,Bt=[];for(let gt=0;gt<bt;++gt)for(let Lt=gt+1;Lt<bt;++Lt)(mt=function qe(vt,_t,Wt){let Gt=xc(Wt,10),Vt=vt.yMax+Gt>_t.yMin-Gt&&vt.yMin-Gt<_t.yMax+Gt,ji=vt.xMax+Gt>_t.xMin-Gt&&vt.xMin-Gt<_t.xMax+Gt,Ms=Vt?vt.xMin>_t.xMax?vt.xMin-_t.xMax:_t.xMin-vt.xMax:1/0,zi=ji?vt.yMin>_t.yMax?vt.yMin-_t.yMax:_t.yMin-vt.yMax:1/0;return ji&&Vt?Gt?qe(vt,_t,Math.floor(Gt/2)):1/0:Am(Ms,zi)}(Ye[gt],Ye[Lt]))<80&&Bt.push(mt);return Bt.push(80),Bc(Math.floor(Bt.sort(function(gt,Lt){return gt-Lt})[Math.floor(Bt.length/10)]/2-1),1)}(Ie),Ie.forEach(function(Ye){Ye.xMin-=je,Ye.xMax+=je,Ye.yMin-=je,Ye.yMax+=je})),Ie}getObstacleMetrics(J){let ge=0,xe=0,Ie,je,Ye=J.length;for(;Ye--;)Ie=J[Ye].xMax-J[Ye].xMin,je=J[Ye].yMax-J[Ye].yMin,ge<Ie&&(ge=Ie),xe<je&&(xe=je);return{maxHeight:xe,maxWidth:ge}}getAlgorithmStartDirection(J){let ge=J.align!=="left"&&J.align!=="right",xe=J.verticalAlign!=="top"&&J.verticalAlign!=="bottom";return ge?!!xe&&void 0:!!xe||void 0}}Fc.prototype.algorithms={fastAvoid:Qa,straight:function(Ge,J){return{path:[["M",Ge.x,Ge.y],["L",J.x,J.y]],obstacles:[{start:Ge,end:J}]}},simpleConnect:tc};let Eu=Cs();Eu.Pathfinder=Eu.Pathfinder||Fc,Io.compose(Eu.SVGRenderer),Eu.Pathfinder.compose(Eu.Chart,Eu.Point);let{addEvent:Nc,defined:rg,isNumber:Yf,pick:yp}=Cs();function sc(){let Ge=this.chart.options.chart;!this.horiz&&Yf(this.options.staticScale)&&(!Ge.height||Ge.scrollablePlotArea&&Ge.scrollablePlotArea.minHeight)&&(this.staticScale=this.options.staticScale)}function Ed(){if(this.redrawTrigger!=="adjustHeight"){for(let Ge of this.axes||[]){let J=Ge.chart,ge=!!J.initiatedScale&&J.options.animation,xe=Ge.options.staticScale;if(Ge.staticScale&&rg(Ge.min)){let Ie=yp(Ge.brokenAxis&&Ge.brokenAxis.unitLength,Ge.max+Ge.tickInterval-Ge.min)*xe,je=(Ie=Math.max(Ie,xe))-J.plotHeight;!J.scrollablePixelsY&&Math.abs(je)>=1&&(J.plotHeight=Ie,J.redrawTrigger="adjustHeight",J.setSize(void 0,J.chartHeight+je,ge)),Ge.series.forEach(function(Ye){let mt=Ye.sharedClipKey&&J.sharedClips[Ye.sharedClipKey];mt&&mt.attr(J.inverted?{width:J.plotHeight}:{height:J.plotHeight})})}}this.initiatedScale=!0}this.redrawTrigger=null}let Up={compose:function(Ge,J){let ge=J.prototype;ge.adjustHeight||(Nc(Ge,"afterSetOptions",sc),ge.adjustHeight=Ed,Nc(J,"render",ge.adjustHeight))}},$f=Cs();Up.compose($f.Axis,$f.Chart);let{correctFloat:qf,isNumber:Yl,isObject:tu}=Cs(),{column:{prototype:{pointClass:od}}}=lr().seriesTypes,{extend:jp}=Cs();class Cu extends od{static getColorByCategory(J,ge){let xe=J.options.colors||J.chart.options.colors,Ie=xe?xe.length:J.chart.options.chart.colorCount,je=ge.y%Ie,Ye=xe==null?void 0:xe[je];return{colorIndex:je,color:Ye}}resolveColor(){let J=this.series;if(J.options.colorByPoint&&!this.options.color){let ge=Cu.getColorByCategory(J,this);J.chart.styledMode||(this.color=ge.color),this.options.colorIndex||(this.colorIndex=ge.colorIndex)}else this.color=this.options.color||J.color}constructor(J,ge){super(J,ge),this.y||(this.y=0)}applyOptions(J,ge){var xe;return super.applyOptions(J,ge),this.x2=this.series.chart.time.parse(this.x2),this.isNull=!((xe=this.isValid)!=null&&xe.call(this)),this}setState(){super.setState.apply(this,arguments),this.series.drawPoint(this,this.series.getAnimationVerb())}isValid(){return typeof this.x=="number"&&typeof this.x2=="number"}}jp(Cu.prototype,{ttBelow:!1,tooltipDateKeys:["x","x2"]});let{composed:_c,noop:nd}=Cs(),{parse:pf}=pp(),{column:ch}=lr().seriesTypes,{addEvent:iu,clamp:ns,crisp:Cd,defined:Pd,extend:Zu,find:Ih,isNumber:Rl,isObject:vc,merge:bc,pick:xh,pushUnique:jr,relativeLength:rc}=Cs();function Pu(){let Ge,J;if(this.isXAxis){for(let ge of(Ge=xh(this.dataMax,-Number.MAX_VALUE),this.series)){let xe=ge.dataTable.getColumn("x2",!0)||ge.dataTable.getColumn("end",!0);if(xe)for(let Ie of xe)Rl(Ie)&&Ie>Ge&&(Ge=Ie,J=!0)}J&&(this.dataMax=Ge)}}class ff extends ch{static compose(J){jr(_c,"Series.XRange")&&iu(J,"afterGetSeriesExtremes",Pu)}init(){super.init.apply(this,arguments),this.options.stacking=void 0}getColumnMetrics(){let J=()=>{for(let xe of this.chart.series){let Ie=xe.xAxis;xe.xAxis=xe.yAxis,xe.yAxis=Ie}};J();let ge=super.getColumnMetrics();return J(),ge}cropData(J,ge,xe){let Ie=J.getColumn("x")||[],je=J.getColumn("x2");J.setColumn("x",je,void 0,{silent:!0});let Ye=super.cropData(J,ge,xe);return J.setColumn("x",Ie.slice(Ye.start,Ye.end),void 0,{silent:!0}),Ye}findPointIndex(J){let ge,{cropStart:xe,points:Ie}=this,{id:je}=J;if(je){let Ye=Ih(Ie,mt=>mt.id===je);ge=Ye?Ye.index:void 0}if(ge===void 0){let Ye=Ih(Ie,mt=>mt.x===J.x&&mt.x2===J.x2&&!mt.touched);ge=Ye?Ye.index:void 0}return this.cropped&&Rl(ge)&&Rl(xe)&&ge>=xe&&(ge-=xe),ge}alignDataLabel(J){var xe,Ie;let ge=J.plotX;J.plotX=xh((xe=J.dlBox)==null?void 0:xe.centerX,J.plotX),J.dataLabel&&((Ie=J.shapeArgs)!=null&&Ie.width)&&J.dataLabel.css({width:`${J.shapeArgs.width}px`}),super.alignDataLabel.apply(this,arguments),J.plotX=ge}translatePoint(J){var ta,Ea;let ge=this.xAxis,xe=this.yAxis,Ie=this.columnMetrics,je=this.options,Ye=je.minPointLength||0,mt=(((ta=J.shapeArgs)==null?void 0:ta.width)||0)/2,bt=this.pointXOffset=Ie.offset,Bt=xh(J.x2,J.x+(J.len||0)),gt=je.borderRadius,Lt=this.chart.plotTop,qe=this.chart.plotLeft,vt=J.plotX,_t=ge.translate(Bt,0,0,0,1),Wt=Math.abs(_t-vt),Gt=this.chart.inverted,Vt=xh(je.borderWidth,1),ji,Ms,zi=Ie.offset,os=Math.round(Ie.width),Fs,Xi,Es,Ns;Ye&&((ji=Ye-Wt)<0&&(ji=0),vt-=ji/2,_t+=ji/2),vt=Math.max(vt,-10),_t=ns(_t,-10,ge.len+10),Pd(J.options.pointWidth)&&(zi-=(Math.ceil(J.options.pointWidth)-os)/2,os=Math.ceil(J.options.pointWidth)),je.pointPlacement&&Rl(J.plotY)&&xe.categories&&(J.plotY=xe.translate(J.y,0,1,0,1,je.pointPlacement));let rr=Cd(Math.min(vt,_t),Vt),bs=Cd(Math.max(vt,_t),Vt)-rr,Ks=Math.min(rc(typeof gt=="object"?gt.radius:gt||0,os),Math.min(bs,os)/2),or={x:rr,y:Cd((J.plotY||0)+zi,Vt),width:bs,height:os,r:Ks};J.shapeArgs=or,Gt?J.tooltipPos[1]+=bt+mt:J.tooltipPos[0]-=mt+bt-or.width/2,Xi=(Fs=or.x)+or.width,Fs<0||Xi>ge.len?(Fs=ns(Fs,0,ge.len),Es=(Xi=ns(Xi,0,ge.len))-Fs,J.dlBox=bc(or,{x:Fs,width:Xi-Fs,centerX:Es?Es/2:null})):J.dlBox=null;let Jo=J.tooltipPos,co=+!!Gt,eo=+!Gt,ya=this.columnMetrics?this.columnMetrics.offset:-Ie.width/2;Gt?Jo[co]+=or.width/2:Jo[co]=ns(Jo[co]+(ge.reversed?-1:0)*or.width,ge.left-qe,ge.left+ge.len-qe-1),Jo[eo]=ns(Jo[eo]+(Gt?-1:1)*ya,xe.top-Lt,xe.top+xe.len-Lt-1),(Ms=J.partialFill)&&(vc(Ms)&&(Ms=Ms.amount),Rl(Ms)||(Ms=0),J.partShapeArgs=bc(or),Ns=Math.max(Math.round(Wt*Ms+J.plotX-vt),0),J.clipRectArgs={x:ge.reversed?or.x+Wt-Ns:or.x,y:or.y,width:Ns,height:or.height}),J.key=J.category||J.name,J.yCategory=(Ea=xe.categories)==null?void 0:Ea[J.y??-1]}translate(){for(let J of(super.translate.apply(this,arguments),this.points))this.translatePoint(J)}drawPoint(J,ge){let xe=this.options,Ie=this.chart.renderer,je=J.shapeType,Ye=J.shapeArgs,mt=J.partShapeArgs,bt=J.clipRectArgs,Bt=J.state,gt=xe.states[Bt||"normal"]||{},Lt=Bt===void 0?"attr":ge,qe=this.pointAttribs(J,Bt),vt=xh(this.chart.options.chart.animation,gt.animation),_t=J.graphic,Wt=J.partialFill;if(J.isNull||J.visible===!1)_t&&(J.graphic=_t.destroy());else if(_t?_t.rect[ge](Ye):(J.graphic=_t=Ie.g("point").addClass(J.getClassName()).add(J.group||this.group),_t.rect=Ie[je](bc(Ye)).addClass(J.getClassName()).addClass("highcharts-partfill-original").add(_t)),mt&&(_t.partRect?(_t.partRect[ge](bc(mt)),_t.partialClipRect[ge](bc(bt))):(_t.partialClipRect=Ie.clipRect(bt.x,bt.y,bt.width,bt.height),_t.partRect=Ie[je](mt).addClass("highcharts-partfill-overlay").add(_t).clip(_t.partialClipRect))),!this.chart.styledMode&&(_t.rect[ge](qe,vt).shadow(xe.shadow),mt)){vc(Wt)||(Wt={}),vc(xe.partialFill)&&(Wt=bc(xe.partialFill,Wt));let Gt=Wt.fill||pf(qe.fill).brighten(-.3).get()||pf(J.color||this.color).brighten(-.3).get();qe.fill=Gt,_t.partRect[Lt](qe,vt).shadow(xe.shadow)}}drawPoints(){let J=this.getAnimationVerb();for(let ge of this.points)this.drawPoint(ge,J)}getAnimationVerb(){return this.chart.pointCount<(this.options.animationLimit||250)?"animate":"attr"}isPointInside(J){let ge=J.shapeArgs,xe=J.plotX,Ie=J.plotY;return ge?xe!==void 0&&Ie!==void 0&&Ie>=0&&Ie<=this.yAxis.len&&(ge.x||0)+(ge.width||0)>=0&&xe<=this.xAxis.len:super.isPointInside.apply(this,arguments)}}ff.defaultOptions=bc(ch.defaultOptions,{colorByPoint:!0,dataLabels:{formatter:function(){let Ge=this.partialFill;if(tu(Ge)&&(Ge=Ge.amount),Yl(Ge)&&Ge>0)return qf(100*Ge)+"%"},inside:!0,verticalAlign:"middle",style:{whiteSpace:"nowrap"}},tooltip:{headerFormat:'<span style="font-size: 0.8em">{ucfirst point.x} - {point.x2}</span><br/>',pointFormat:'<span style="color:{point.color}">●</span> {series.name}: <b>{point.yCategory}</b><br/>'},borderRadius:3,pointRange:0}),Zu(ff.prototype,{pointClass:Cu,pointArrayMap:["x2","y"],getExtremesFromAll:!0,keysAffectYAxis:["y"],parallelArrays:["x","x2","y"],requireSorting:!1,type:"xrange",animate:lr().series.prototype.animate,autoIncrement:nd,buildKDTree:nd}),lr().registerSeriesType("xrange",ff);/**
* @license Highcharts JS v12.3.0 (2025-06-21)
* @module highcharts/modules/xrange
* @requires highcharts
*
* X-range series
*
* (c) 2010-2025 Torstein Honsi, Lars A. V. Cabrera
*
* License: www.highcharts.com/license
*/let mf=Cs();ff.compose(mf.Axis);let{xrange:{prototype:{pointClass:ad}}}=lr().seriesTypes;class ho extends ad{static setGanttPointAliases(J,ge){J.x=J.start=ge.time.parse(J.start??J.x),J.x2=J.end=ge.time.parse(J.end??J.x2),J.partialFill=J.completed=J.completed??J.partialFill}applyOptions(J,ge){var Ie;let xe=super.applyOptions(J,ge);return ho.setGanttPointAliases(xe,xe.series.chart),this.isNull=!((Ie=this.isValid)!=null&&Ie.call(this)),xe}isValid(){return(typeof this.start=="number"||typeof this.x=="number")&&(typeof this.end=="number"||typeof this.x2=="number"||this.milestone)}}let{isNumber:ka}=Cs();var Zf=Pi(184),km=Pi.n(Zf);let{addEvent:su,find:Gp,fireEvent:vn,isArray:ea,isNumber:Vc,pick:Uc}=Cs();(function(Ge){function J(){this.brokenAxis!==void 0&&this.brokenAxis.setBreaks(this.options.breaks,!1)}function ge(){var gt;(gt=this.brokenAxis)!=null&&gt.hasBreaks&&(this.options.ordinal=!1)}function xe(){let gt=this.brokenAxis;if(gt!=null&&gt.hasBreaks){let Lt=this.tickPositions,qe=this.tickPositions.info,vt=[];for(let _t=0;_t<Lt.length;_t++)gt.isInAnyBreak(Lt[_t])||vt.push(Lt[_t]);this.tickPositions=vt,this.tickPositions.info=qe}}function Ie(){this.brokenAxis||(this.brokenAxis=new Bt(this))}function je(){var Wt,Gt;let{isDirty:gt,options:{connectNulls:Lt},points:qe,xAxis:vt,yAxis:_t}=this;if(gt){let Vt=qe.length;for(;Vt--;){let ji=qe[Vt],Ms=(ji.y!==null||Lt!==!1)&&(((Wt=vt==null?void 0:vt.brokenAxis)==null?void 0:Wt.isInAnyBreak(ji.x,!0))||((Gt=_t==null?void 0:_t.brokenAxis)==null?void 0:Gt.isInAnyBreak(ji.y,!0)));ji.visible=!Ms&&ji.options.visible!==!1}}}function Ye(){this.drawBreaks(this.xAxis,["x"]),this.drawBreaks(this.yAxis,Uc(this.pointArrayMap,["y"]))}function mt(gt,Lt){var Vt;let qe,vt,_t,Wt=this,Gt=Wt.points;if((Vt=gt==null?void 0:gt.brokenAxis)!=null&&Vt.hasBreaks){let ji=gt.brokenAxis;Lt.forEach(function(Ms){var os,Fs;qe=(ji==null?void 0:ji.breakArray)||[],vt=gt.isXAxis?gt.min:Uc(Wt.options.threshold,gt.min);let zi=(Fs=(os=gt==null?void 0:gt.options)==null?void 0:os.breaks)==null?void 0:Fs.filter(function(Xi){let Es=!0;for(let Ns=0;Ns<qe.length;Ns++){let rr=qe[Ns];if(rr.from===Xi.from&&rr.to===Xi.to){Es=!1;break}}return Es});Gt.forEach(function(Xi){_t=Uc(Xi["stack"+Ms.toUpperCase()],Xi[Ms]),qe.forEach(function(Es){if(Vc(vt)&&Vc(_t)){let Ns="";vt<Es.from&&_t>Es.to||vt>Es.from&&_t<Es.from?Ns="pointBreak":(vt<Es.from&&_t>Es.from&&_t<Es.to||vt>Es.from&&_t>Es.to&&_t<Es.from)&&(Ns="pointInBreak"),Ns&&vn(gt,Ns,{point:Xi,brk:Es})}}),zi==null||zi.forEach(function(Es){vn(gt,"pointOutsideOfBreak",{point:Xi,brk:Es})})})})}}function bt(){let gt=this.currentDataGrouping,Lt=gt==null?void 0:gt.gapSize,qe=this.points.slice(),vt=this.yAxis,_t=this.options.gapSize,Wt=qe.length-1;if(_t&&Wt>0){let Gt,Vt;for(this.options.gapUnit!=="value"&&(_t*=this.basePointRange),Lt&&Lt>_t&&Lt>=this.basePointRange&&(_t=Lt);Wt--;)if(Vt&&Vt.visible!==!1||(Vt=qe[Wt+1]),Gt=qe[Wt],Vt.visible!==!1&&Gt.visible!==!1){if(Vt.x-Gt.x>_t){let ji=(Gt.x+Vt.x)/2;qe.splice(Wt+1,0,{isNull:!0,x:ji}),vt.stacking&&this.options.stacking&&((vt.stacking.stacks[this.stackKey][ji]=new(km())(vt,vt.options.stackLabels,!1,ji,this.stack)).total=0)}Vt=Gt}}return this.getGraphPath(qe)}Ge.compose=function(gt,Lt){if(!gt.keepProps.includes("brokenAxis")){gt.keepProps.push("brokenAxis"),su(gt,"init",Ie),su(gt,"afterInit",J),su(gt,"afterSetTickPositions",xe),su(gt,"afterSetOptions",ge);let qe=Lt.prototype;qe.drawBreaks=mt,qe.gappedPath=bt,su(Lt,"afterGeneratePoints",je),su(Lt,"afterRender",Ye)}return gt};class Bt{static isInBreak(Lt,qe){let vt=Lt.repeat||1/0,_t=Lt.from,Wt=Lt.to-Lt.from,Gt=qe>=_t?(qe-_t)%vt:vt-(_t-qe)%vt;return Lt.inclusive?Gt<=Wt:Gt<Wt&&Gt!==0}static lin2Val(Lt){let qe=this.brokenAxis,vt=qe==null?void 0:qe.breakArray;if(!vt||!Vc(Lt))return Lt;let _t=Lt,Wt,Gt;for(Gt=0;Gt<vt.length&&!((Wt=vt[Gt]).from>=_t);Gt++)(Wt.to<_t||Bt.isInBreak(Wt,_t))&&(_t+=Wt.len);return _t}static val2Lin(Lt){let qe=this.brokenAxis,vt=qe==null?void 0:qe.breakArray;if(!vt||!Vc(Lt))return Lt;let _t=Lt,Wt,Gt;for(Gt=0;Gt<vt.length;Gt++)if((Wt=vt[Gt]).to<=Lt)_t-=Wt.len;else{if(Wt.from>=Lt)break;if(Bt.isInBreak(Wt,Lt)){_t-=Lt-Wt.from;break}}return _t}constructor(Lt){this.hasBreaks=!1,this.axis=Lt}findBreakAt(Lt,qe){return Gp(qe,function(vt){return vt.from<Lt&&Lt<vt.to})}isInAnyBreak(Lt,qe){let vt=this.axis,_t=vt.options.breaks||[],Wt=_t.length,Gt,Vt,ji;if(Wt&&Vc(Lt)){for(;Wt--;)Bt.isInBreak(_t[Wt],Lt)&&(Gt=!0,Vt||(Vt=Uc(_t[Wt].showPoints,!vt.isXAxis)));ji=Gt&&qe?Gt&&!Vt:Gt}return ji}setBreaks(Lt,qe){let vt=this,_t=vt.axis,Wt=_t.chart.time,Gt=ea(Lt)&&!!Lt.length&&!!Object.keys(Lt[0]).length;_t.isDirty=vt.hasBreaks!==Gt,vt.hasBreaks=Gt,Lt==null||Lt.forEach(Vt=>{Vt.from=Wt.parse(Vt.from)||0,Vt.to=Wt.parse(Vt.to)||0}),Lt!==_t.options.breaks&&(_t.options.breaks=_t.userOptions.breaks=Lt),_t.forceRedraw=!0,_t.series.forEach(function(Vt){Vt.isDirty=!0}),Gt||_t.val2lin!==Bt.val2Lin||(delete _t.val2lin,delete _t.lin2val),Gt&&(_t.userOptions.ordinal=!1,_t.lin2val=Bt.lin2Val,_t.val2lin=Bt.val2Lin,_t.setExtremes=function(Vt,ji,Ms,zi,os){if(vt.hasBreaks){let Fs,Xi=this.options.breaks||[];for(;Fs=vt.findBreakAt(Vt,Xi);)Vt=Fs.to;for(;Fs=vt.findBreakAt(ji,Xi);)ji=Fs.from;ji<Vt&&(ji=Vt)}_t.constructor.prototype.setExtremes.call(this,Vt,ji,Ms,zi,os)},_t.setAxisTranslation=function(){if(_t.constructor.prototype.setAxisTranslation.call(this),vt.unitLength=void 0,vt.hasBreaks){let Vt=_t.options.breaks||[],ji=[],Ms=[],zi=Uc(_t.pointRangePadding,0),os=0,Fs,Xi,Es=_t.userMin||_t.min,Ns=_t.userMax||_t.max,rr,bs;Vt.forEach(function(Ks){Xi=Ks.repeat||1/0,Vc(Es)&&Vc(Ns)&&(Bt.isInBreak(Ks,Es)&&(Es+=Ks.to%Xi-Es%Xi),Bt.isInBreak(Ks,Ns)&&(Ns-=Ns%Xi-Ks.from%Xi))}),Vt.forEach(function(Ks){if(rr=Ks.from,Xi=Ks.repeat||1/0,Vc(Es)&&Vc(Ns)){for(;rr-Xi>Es;)rr-=Xi;for(;rr<Es;)rr+=Xi;for(bs=rr;bs<Ns;bs+=Xi)ji.push({value:bs,move:"in"}),ji.push({value:bs+Ks.to-Ks.from,move:"out",size:Ks.breakSize})}}),ji.sort(function(Ks,or){return Ks.value===or.value?(Ks.move!=="in")-(or.move!=="in"):Ks.value-or.value}),Fs=0,rr=Es,ji.forEach(function(Ks){(Fs+=Ks.move==="in"?1:-1)===1&&Ks.move==="in"&&(rr=Ks.value),Fs===0&&Vc(rr)&&(Ms.push({from:rr,to:Ks.value,len:Ks.value-rr-(Ks.size||0)}),os+=Ks.value-rr-(Ks.size||0))}),vt.breakArray=Ms,Vc(Es)&&Vc(Ns)&&Vc(_t.min)&&(vt.unitLength=Ns-Es-os+zi,vn(_t,"afterBreaks"),_t.staticScale?_t.transA=_t.staticScale:vt.unitLength&&(_t.transA*=(Ns-_t.min+zi)/vt.unitLength),zi&&(_t.minPixelPadding=_t.transA*(_t.minPointOffset||0)),_t.min=Es,_t.max=Ns)}}),Uc(qe,!0)&&_t.chart.redraw()}}Ge.Additions=Bt})(ir||(ir={}));let Dr=ir,{dateFormats:Un}=Cs(),{addEvent:ln,defined:oc,erase:Iu,find:yo,isArray:sr,isNumber:nc,merge:Id,pick:ru,timeUnits:Hr,wrap:vo}=Cs();function ou(Ge){return Cs().isObject(Ge,!0)}function Wp(Ge,J){let ge={width:0,height:0};if(J.forEach(function(xe){let Ie=Ge[xe],je=0,Ye=0,mt;ou(Ie)&&(je=(mt=ou(Ie.label)?Ie.label:{}).getBBox?mt.getBBox().height:0,mt.textStr&&!nc(mt.textPxLength)&&(mt.textPxLength=mt.getBBox().width),Ye=nc(mt.textPxLength)?Math.round(mt.textPxLength):0,mt.textStr&&(Ye=Math.round(mt.getBBox().width)),ge.height=Math.max(je,ge.height),ge.width=Math.max(Ye,ge.width))}),this.type==="treegrid"&&this.treeGrid&&this.treeGrid.mapOfPosToGridNode){let xe=this.treeGrid.mapOfPosToGridNode[-1].height||0;ge.width+=this.options.labels.indentation*(xe-1)}return ge}function xp(Ge){let{grid:J}=this,ge=this.side===3;if(ge||Ge.apply(this),!(J!=null&&J.isColumn)){let xe=(J==null?void 0:J.columns)||[];ge&&(xe=xe.slice().reverse()),xe.forEach(Ie=>{Ie.getOffset()})}ge&&Ge.apply(this)}function Ro(Ge){if((this.options.grid||{}).enabled===!0){let{axisTitle:J,height:ge,horiz:xe,left:Ie,offset:je,opposite:Ye,options:mt,top:bt,width:Bt}=this,gt=this.tickSize(),Lt=J==null?void 0:J.getBBox().width,qe=mt.title.x,vt=mt.title.y,_t=ru(mt.title.margin,xe?5:10),Wt=J?this.chart.renderer.fontMetrics(J).f:0,Gt=(xe?bt+ge:Ie)+(xe?1:-1)*(Ye?-1:1)*(gt?gt[0]/2:0)+(this.side===fr.bottom?Wt:0);Ge.titlePosition.x=xe?Ie-(Lt||0)/2-_t+qe:Gt+(Ye?Bt:0)+je+qe,Ge.titlePosition.y=xe?Gt-(Ye?ge:0)+(Ye?Wt:-Wt)/2+je+vt:bt-_t+vt}}function _p(){let{chart:Ge,options:{grid:J={}},userOptions:ge}=this;if(J.enabled&&function(xe){let Ie=xe.options;Ie.labels.align=ru(Ie.labels.align,"center"),xe.categories||(Ie.showLastLabel=!1),xe.labelRotation=0,Ie.labels.rotation=0,Ie.minTickInterval=1}(this),J.columns){let xe=this.grid.columns=[],Ie=this.grid.columnIndex=0;for(;++Ie<J.columns.length;){let je=Id(ge,J.columns[Ie],{isInternal:!0,linkedTo:0,scrollbar:{enabled:!1}},{grid:{columns:void 0}}),Ye=new(Gs())(this.chart,je,"yAxis");Ye.grid.isColumn=!0,Ye.grid.columnIndex=Ie,Iu(Ge.axes,Ye),Iu(Ge[this.coll]||[],Ye),xe.push(Ye)}}}function Ku(){var xe,Ie;let{axisTitle:Ge,grid:J,options:ge}=this;if((ge.grid||{}).enabled===!0){let je=this.min||0,Ye=this.max||0,mt=this.ticks[this.tickPositions[0]];if(Ge&&!this.chart.styledMode&&(mt!=null&&mt.slotWidth)&&!this.options.title.style.width&&Ge.css({width:`${mt.slotWidth}px`}),this.maxLabelDimensions=this.getMaxLabelDimensions(this.ticks,this.tickPositions),this.rightWall&&this.rightWall.destroy(),((xe=this.grid)==null?void 0:xe.isOuterAxis())&&this.axisLine){let bt=ge.lineWidth;if(bt){let Bt=this.getLinePath(bt),gt=Bt[0],Lt=Bt[1],qe=(this.tickSize("tick")||[1])[0]*(this.side===fr.top||this.side===fr.left?-1:1);if(gt[0]==="M"&&Lt[0]==="L"&&(this.horiz?(gt[2]+=qe,Lt[2]+=qe):(gt[1]+=qe,Lt[1]+=qe)),!this.horiz&&this.chart.marginRight){let vt=["L",this.left,gt[2]||0],_t=[gt,vt],Wt=["L",this.chart.chartWidth-this.chart.marginRight,this.toPixels(Ye+this.tickmarkOffset)],Gt=[["M",Lt[1]||0,this.toPixels(Ye+this.tickmarkOffset)],Wt];this.grid.upperBorder||je%1==0||(this.grid.upperBorder=this.grid.renderBorder(_t)),this.grid.upperBorder&&(this.grid.upperBorder.attr({stroke:ge.lineColor,"stroke-width":ge.lineWidth}),this.grid.upperBorder.animate({d:_t})),this.grid.lowerBorder||Ye%1==0||(this.grid.lowerBorder=this.grid.renderBorder(Gt)),this.grid.lowerBorder&&(this.grid.lowerBorder.attr({stroke:ge.lineColor,"stroke-width":ge.lineWidth}),this.grid.lowerBorder.animate({d:Gt}))}this.grid.axisLineExtra?(this.grid.axisLineExtra.attr({stroke:ge.lineColor,"stroke-width":ge.lineWidth}),this.grid.axisLineExtra.animate({d:Bt})):this.grid.axisLineExtra=this.grid.renderBorder(Bt),this.axisLine[this.showAxis?"show":"hide"]()}}if(((J==null?void 0:J.columns)||[]).forEach(bt=>bt.render()),!this.horiz&&this.chart.hasRendered&&(this.scrollbar||((Ie=this.linkedParent)==null?void 0:Ie.scrollbar))&&this.tickPositions.length){let bt,Bt,gt=this.tickmarkOffset,Lt=this.tickPositions[this.tickPositions.length-1],qe=this.tickPositions[0];for(;(bt=this.hiddenLabels.pop())&&bt.element;)bt.show();for(;(Bt=this.hiddenMarks.pop())&&Bt.element;)Bt.show();(bt=this.ticks[qe].label)&&(je-qe>gt?this.hiddenLabels.push(bt.hide()):bt.show()),(bt=this.ticks[Lt].label)&&(Lt-Ye>gt?this.hiddenLabels.push(bt.hide()):bt.show());let vt=this.ticks[Lt].mark;vt&&Lt-Ye<gt&&Lt-Ye>0&&this.ticks[Lt].isLast&&this.hiddenMarks.push(vt.hide())}}}function Lu(){var Ie;let Ge=(Ie=this.tickPositions)==null?void 0:Ie.info,J=this.options,ge=J.grid||{},xe=this.userOptions.labels||{};ge.enabled&&(this.horiz?(this.series.forEach(je=>{je.options.pointRange=0}),Ge&&J.dateTimeLabelFormats&&J.labels&&!oc(xe.align)&&(J.dateTimeLabelFormats[Ge.unitName].range===!1||Ge.count>1)&&(J.labels.align="left",oc(xe.x)||(J.labels.x=3))):this.type!=="treegrid"&&this.grid&&this.grid.columns&&(this.minPointOffset=this.tickInterval))}function og(Ge){let J,ge=this.options,xe=Ge.userOptions,Ie=ge&&ou(ge.grid)?ge.grid:{};Ie.enabled===!0&&(J=Id(!0,{className:"highcharts-grid-axis "+(xe.className||""),dateTimeLabelFormats:{hour:{list:["%[HM]","%[H]"]},day:{list:["%[AeB]","%[aeb]","%[E]"]},week:{list:["Week %W","W%W"]},month:{list:["%[B]","%[b]","%o"]}},grid:{borderWidth:1},labels:{padding:2,style:{fontSize:"0.9em"}},margin:0,title:{text:null,reserveSpace:!1,rotation:0,style:{textOverflow:"ellipsis"}},units:[["millisecond",[1,10,100]],["second",[1,10]],["minute",[1,5,15]],["hour",[1,6]],["day",[1]],["week",[1]],["month",[1]],["year",null]]},xe),this.coll==="xAxis"&&(oc(xe.linkedTo)&&!oc(xe.tickPixelInterval)&&(J.tickPixelInterval=350),!(!oc(xe.tickPixelInterval)&&oc(xe.linkedTo))||oc(xe.tickPositioner)||oc(xe.tickInterval)||oc(xe.units)||(J.tickPositioner=function(je,Ye){var bt,Bt;let mt=(Bt=(bt=this.linkedParent)==null?void 0:bt.tickPositions)==null?void 0:Bt.info;if(mt){let gt=J.units||[],Lt,qe=1,vt="year";for(let Gt=0;Gt<gt.length;Gt++){let Vt=gt[Gt];if(Vt&&Vt[0]===mt.unitName){Lt=Gt;break}}let _t=nc(Lt)&&gt[Lt+1];if(_t){vt=_t[0]||"year";let Gt=_t[1];qe=(Gt==null?void 0:Gt[0])||1}else mt.unitName==="year"&&(qe=10*mt.count);let Wt=Hr[vt];return this.tickInterval=Wt*qe,this.chart.time.getTimeTicks({unitRange:Wt,count:qe,unitName:vt},je,Ye,this.options.startOfWeek)}})),Id(!0,this.options,J),this.horiz&&(ge.minPadding=ru(xe.minPadding,0),ge.maxPadding=ru(xe.maxPadding,0)),nc(ge.grid.borderWidth)&&(ge.tickWidth=ge.lineWidth=Ie.borderWidth))}function Em(Ge){let J=Ge.userOptions,ge=(J==null?void 0:J.grid)||{},xe=ge.columns;ge.enabled&&xe&&Id(!0,this.options,xe[0])}function nu(){(this.grid.columns||[]).forEach(Ge=>Ge.setScale())}function Ld(Ge){let{horiz:J,maxLabelDimensions:ge,options:{grid:xe={}}}=this;if(xe.enabled&&ge){let Ie=2*this.options.labels.distance,je=J?xe.cellHeight||Ie+ge.height:Ie+ge.width;sr(Ge.tickSize)?Ge.tickSize[0]=je:Ge.tickSize=[je,0]}}function Cm(){this.axes.forEach(Ge=>{var J;(((J=Ge.grid)==null?void 0:J.columns)||[]).forEach(ge=>{ge.setAxisSize(),ge.setAxisTranslation()})})}function Pm(Ge){let{grid:J}=this;(J.columns||[]).forEach(ge=>ge.destroy(Ge.keepEvents)),J.columns=void 0}function Kf(Ge){let J=Ge.userOptions||{},ge=J.grid||{};ge.enabled&&oc(ge.borderColor)&&(J.tickColor=J.lineColor=ge.borderColor),this.grid||(this.grid=new Ou(this)),this.hiddenLabels=[],this.hiddenMarks=[]}function Im(Ge){let J=this.label,ge=this.axis,xe=ge.reversed,Ie=ge.chart,je=ge.options.grid||{},Ye=ge.options.labels,mt=Ye.align,bt=fr[ge.side],Bt=Ge.tickmarkOffset,gt=ge.tickPositions,Lt=this.pos-Bt,qe=nc(gt[Ge.index+1])?gt[Ge.index+1]-Bt:(ge.max||0)+Bt,vt=ge.tickSize("tick"),_t=vt?vt[0]:0,Wt=vt?vt[1]/2:0;if(je.enabled===!0){let Gt,Vt,ji,Ms;if(bt==="top"?Vt=(Gt=ge.top+ge.offset)-_t:bt==="bottom"?Gt=(Vt=Ie.chartHeight-ge.bottom+ge.offset)+_t:(Gt=ge.top+ge.len-(ge.translate(xe?qe:Lt)||0),Vt=ge.top+ge.len-(ge.translate(xe?Lt:qe)||0)),bt==="right"?Ms=(ji=Ie.chartWidth-ge.right+ge.offset)+_t:bt==="left"?ji=(Ms=ge.left+ge.offset)-_t:(ji=Math.round(ge.left+(ge.translate(xe?qe:Lt)||0))-Wt,Ms=Math.min(Math.round(ge.left+(ge.translate(xe?Lt:qe)||0))-Wt,ge.left+ge.len)),this.slotWidth=Ms-ji,Ge.pos.x=mt==="left"?ji:mt==="right"?Ms:ji+(Ms-ji)/2,Ge.pos.y=Vt+(Gt-Vt)/2,J){let zi=Ie.renderer.fontMetrics(J),os=J.getBBox().height;if(Ye.useHTML)Ge.pos.y+=zi.b+-(os/2);else{let Fs=Math.round(os/zi.h);Ge.pos.y+=(zi.b-(zi.h-zi.f))/2+-((Fs-1)*zi.h/2)}}Ge.pos.x+=ge.horiz&&Ye.x||0}}function gf(Ge){var xe;let{axis:J,value:ge}=Ge;if((xe=J.options.grid)!=null&&xe.enabled){let Ie,je=J.tickPositions,Ye=(J.linkedParent||J).series[0],mt=ge===je[0],bt=ge===je[je.length-1],Bt=Ye&&yo(Ye.options.data,function(gt){return gt[J.isXAxis?"x":"y"]===ge});Bt&&Ye.is("gantt")&&(Ie=Id(Bt),Cs().seriesTypes.gantt.prototype.pointClass.setGanttPointAliases(Ie,J.chart)),Ge.isFirst=mt,Ge.isLast=bt,Ge.point=Ie}}function jc(){var Vt,ji;let Ge=this.options,J=Ge.grid||{},ge=this.categories,xe=this.tickPositions,Ie=xe[0],je=xe[1],Ye=xe[xe.length-1],mt=xe[xe.length-2],bt=(Vt=this.linkedParent)==null?void 0:Vt.min,Bt=(ji=this.linkedParent)==null?void 0:ji.max,gt=bt||this.min,Lt=Bt||this.max,qe=this.tickInterval,vt=nc(gt)&&gt>=Ie+qe&&gt<je,_t=nc(gt)&&Ie<gt&&Ie+qe>gt,Wt=nc(Lt)&&Ye>Lt&&Ye-qe<Lt,Gt=nc(Lt)&&Lt<=Ye-qe&&Lt>mt;J.enabled===!0&&!ge&&(this.isXAxis||this.isLinked)&&((_t||vt)&&!Ge.startOnTick&&(xe[0]=gt),(Wt||Gt)&&!Ge.endOnTick&&(xe[xe.length-1]=Lt))}function Jf(Ge){var J;let{options:{grid:ge={}}}=this;return ge.enabled===!0&&this.categories?this.tickInterval:Ge.apply(this,(J=arguments,Array.prototype.slice.call(J,1)))}(function(Ge){Ge[Ge.top=0]="top",Ge[Ge.right=1]="right",Ge[Ge.bottom=2]="bottom",Ge[Ge.left=3]="left"})(fr||(fr={}));class Ou{constructor(J){this.axis=J}isOuterAxis(){var bt;let J=this.axis,ge=J.chart,xe=J.grid.columnIndex,Ie=((bt=J.linkedParent)==null?void 0:bt.grid.columns)||J.grid.columns||[],je=xe?J.linkedParent:J,Ye=-1,mt=0;return J.side===3&&!ge.inverted&&Ie.length?!J.linkedParent:((ge[J.coll]||[]).forEach((Bt,gt)=>{Bt.side!==J.side||Bt.options.isInternal||(mt=gt,Bt===je&&(Ye=gt))}),mt===Ye&&(!nc(xe)||Ie.length===xe))}renderBorder(J){let ge=this.axis,xe=ge.chart.renderer,Ie=ge.options,je=xe.path(J).addClass("highcharts-axis-line").add(ge.axisGroup);return xe.styledMode||je.attr({stroke:Ie.lineColor,"stroke-width":Ie.lineWidth,zIndex:7}),je}}Un.E=function(Ge){return this.dateFormat("%a",Ge,!0).charAt(0)},Un.W=function(Ge){let J=this.toParts(Ge),ge=(J[7]+6)%7,xe=J.slice(0);xe[2]=J[2]-ge+3;let Ie=this.toParts(this.makeTime(xe[0],0,1));return Ie[7]!==4&&(J[1]=0,J[2]=1+(11-Ie[7])%7),(1+Math.floor((this.makeTime(xe[0],xe[1],xe[2])-this.makeTime(Ie[0],Ie[1],Ie[2]))/6048e5)).toString()};let Lm={compose:function(Ge,J,ge){return Ge.keepProps.includes("grid")||(Ge.keepProps.push("grid"),Ge.prototype.getMaxLabelDimensions=Wp,vo(Ge.prototype,"unsquish",Jf),vo(Ge.prototype,"getOffset",xp),ln(Ge,"init",Kf),ln(Ge,"afterGetTitlePosition",Ro),ln(Ge,"afterInit",_p),ln(Ge,"afterRender",Ku),ln(Ge,"afterSetAxisTranslation",Lu),ln(Ge,"afterSetOptions",og),ln(Ge,"afterSetOptions",Em),ln(Ge,"afterSetScale",nu),ln(Ge,"afterTickSize",Ld),ln(Ge,"trimTicks",jc),ln(Ge,"destroy",Pm),ln(J,"afterSetChartSize",Cm),ln(ge,"afterGetLabelPosition",Im),ln(ge,"labelFormat",gf)),Ge}},{extend:Qf,isNumber:em,pick:Du}=Cs();function Bl(Ge,J,ge,xe,Ie,je){let Ye=je&&je.after,mt=je&&je.before,bt={data:xe,depth:ge-1,id:Ge,level:ge,parent:J||""},Bt=0,gt=0,Lt,qe;typeof mt=="function"&&mt(bt,je);let vt=(Ie[Ge]||[]).map(_t=>{let Wt=Bl(_t.id,Ge,ge+1,_t,Ie,je),Gt=_t.start||NaN,Vt=_t.milestone===!0?Gt:_t.end||NaN;return Lt=!em(Lt)||Gt<Lt?Gt:Lt,qe=!em(qe)||Vt>qe?Vt:qe,Bt=Bt+1+Wt.descendants,gt=Math.max(Wt.height+1,gt),Wt});return xe&&(xe.start=Du(xe.start,Lt),xe.end=Du(xe.end,qe)),Qf(bt,{children:vt,descendants:Bt,height:gt}),typeof Ye=="function"&&Ye(bt,je),bt}let tm={getNode:Bl,getTree:function(Ge,J){return Bl("",null,1,null,function(ge){let xe=[],Ie=ge.reduce((je,Ye)=>{let{parent:mt="",id:bt}=Ye;return je[mt]===void 0&&(je[mt]=[]),je[mt].push(Ye),bt&&xe.push(bt),je},{});return Object.keys(Ie).forEach(je=>{if(je!==""&&xe.indexOf(je)===-1){let Ye=Ie[je].map(function(mt){let{...bt}=mt;return bt});Ie[""].push(...Ye),delete Ie[je]}}),Ie}(Ge),J)}},{addEvent:dh,removeEvent:Gc,isObject:Ju,isNumber:Hp,pick:Qu,wrap:ep}=Cs();function im(){this.treeGrid||(this.treeGrid=new sm(this))}function Od(Ge,J,ge,xe,Ie,je,Ye,mt,bt){var Vt;let Bt,gt,Lt,qe=Qu((Vt=this.options)==null?void 0:Vt.labels,je),vt=this.pos,_t=this.axis,Wt=_t.type==="treegrid",Gt=Ge.apply(this,[J,ge,xe,Ie,qe,Ye,mt,bt]);if(Wt){let{width:ji=0,padding:Ms=5*!_t.linkedParent}=qe&&Ju(qe.symbol,!0)?qe.symbol:{},zi=qe&&Hp(qe.indentation)?qe.indentation:0;Bt=_t.treeGrid.mapOfPosToGridNode,gt=Bt==null?void 0:Bt[vt],Lt=(gt==null?void 0:gt.depth)||1,Gt.x+=ji+2*Ms+(Lt-1)*zi}return Gt}function au(Ge){let J,{pos:ge,axis:xe,label:Ie,treeGrid:je,options:Ye}=this,mt=je==null?void 0:je.labelIcon,bt=Ie==null?void 0:Ie.element,{treeGrid:Bt,options:gt,chart:Lt,tickPositions:qe}=xe,vt=Bt.mapOfPosToGridNode,_t=Qu(Ye==null?void 0:Ye.labels,gt==null?void 0:gt.labels),Wt=_t&&Ju(_t.symbol,!0)?_t.symbol:{},Gt=vt==null?void 0:vt[ge],{descendants:Vt,depth:ji}=Gt||{},Ms=Gt&&Vt&&Vt>0,zi=xe.type==="treegrid"&&bt,os=qe.indexOf(ge)>-1,Fs="highcharts-treegrid-node-",Xi=Fs+"level-",Es=Lt.styledMode;zi&&Gt&&Ie.removeClass(RegExp(Xi+".*")).addClass(Xi+ji),Ge.apply(this,Array.prototype.slice.call(arguments,1)),zi&&Ms?(J=Bt.isCollapsed(Gt),function(Ns,rr){let bs=Ns.treeGrid,Ks=!bs.labelIcon,or=rr.renderer,Jo=rr.xy,co=rr.options,eo=co.width||0,ya=co.height||0,ta=co.padding??Ns.axis.linkedParent?0:5,Ea={x:Jo.x-eo/2-ta,y:Jo.y-ya/2},mn=rr.collapsed?90:180,qr=rr.show&&Hp(Ea.y),Sl=bs.labelIcon;Sl||(bs.labelIcon=Sl=or.path(or.symbols[co.type](co.x||0,co.y||0,eo,ya)).addClass("highcharts-label-icon").add(rr.group)),Sl[qr?"show":"hide"](),or.styledMode||Sl.attr({cursor:"pointer",fill:Qu(rr.color,"#666666"),"stroke-width":1,stroke:co.lineColor,strokeWidth:co.lineWidth||0}),Sl[Ks?"attr":"animate"]({translateX:Ea.x,translateY:Ea.y,rotation:mn})}(this,{color:!Es&&Ie.styles.color||"",collapsed:J,group:Ie.parentGroup,options:Wt,renderer:Ie.renderer,show:os,xy:Ie.xy}),Ie.addClass(Fs+(J?"collapsed":"expanded")).removeClass(Fs+(J?"expanded":"collapsed")),Es||Ie.css({cursor:"pointer"}),[Ie,mt].forEach(Ns=>{Ns&&!Ns.attachedTreeGridEvents&&(dh(Ns.element,"mouseover",function(){Ie.addClass("highcharts-treegrid-node-active"),Ie.renderer.styledMode||Ie.css({textDecoration:"underline"})}),dh(Ns.element,"mouseout",function(){let rr=Ju(_t.style)?_t.style:{};Ie.removeClass("highcharts-treegrid-node-active"),Ie.renderer.styledMode||Ie.css({textDecoration:rr.textDecoration||"none"})}),dh(Ns.element,"click",function(){je.toggleCollapse()}),Ns.attachedTreeGridEvents=!0)})):mt&&(Gc(bt),Ie==null||Ie.css({cursor:"default"}),mt.destroy())}class sm{static compose(J){let ge=J.prototype;ge.toggleCollapse||(dh(J,"init",im),ep(ge,"getLabelPosition",Od),ep(ge,"renderLabel",au),ge.collapse=function(xe){this.treeGrid.collapse(xe)},ge.expand=function(xe){this.treeGrid.expand(xe)},ge.toggleCollapse=function(xe){this.treeGrid.toggleCollapse(xe)})}constructor(J){this.tick=J}collapse(J){let ge=this.tick,xe=ge.axis,Ie=xe.brokenAxis;if(Ie&&xe.treeGrid.mapOfPosToGridNode){let je=ge.pos,Ye=xe.treeGrid.mapOfPosToGridNode[je],mt=xe.treeGrid.collapse(Ye);Ie.setBreaks(mt,Qu(J,!0))}}destroy(){this.labelIcon&&this.labelIcon.destroy()}expand(J){let{pos:ge,axis:xe}=this.tick,{treeGrid:Ie,brokenAxis:je}=xe,Ye=Ie.mapOfPosToGridNode;if(je&&Ye){let mt=Ye[ge],bt=Ie.expand(mt);je.setBreaks(bt,Qu(J,!0))}}toggleCollapse(J){let ge=this.tick,xe=ge.axis,Ie=xe.brokenAxis;if(Ie&&xe.treeGrid.mapOfPosToGridNode){let je=ge.pos,Ye=xe.treeGrid.mapOfPosToGridNode[je],mt=xe.treeGrid.toggleCollapse(Ye);Ie.setBreaks(mt,Qu(J,!0))}}}let{extend:Xp,isArray:rm,isNumber:yf,isObject:ld,merge:zu,pick:ng,relativeLength:ag}=Cs(),{getLevelOptions:Yp}={getLevelOptions:function(Ge){let J,ge,xe,Ie,je,Ye,mt={};if(ld(Ge))for(Ie=yf(Ge.from)?Ge.from:1,Ye=Ge.levels,ge={},J=ld(Ge.defaults)?Ge.defaults:{},rm(Ye)&&(ge=Ye.reduce((bt,Bt)=>{let gt,Lt,qe;return ld(Bt)&&yf(Bt.level)&&(Lt=ng((qe=zu({},Bt)).levelIsConstant,J.levelIsConstant),delete qe.levelIsConstant,delete qe.level,ld(bt[gt=Bt.level+(Lt?0:Ie-1)])?zu(!0,bt[gt],qe):bt[gt]=qe),bt},{})),je=yf(Ge.to)?Ge.to:1,xe=0;xe<=je;xe++)mt[xe]=zu({},J,ld(ge[xe])?ge[xe]:{});return mt}},{addEvent:Lh,isArray:lg,splat:$p,find:xf,fireEvent:_f,isObject:Oh,isString:om,merge:Ru,pick:vf,removeEvent:lu,wrap:ac}=Cs();function qp(Ge,J){let ge=Ge.collapseEnd||0,xe=Ge.collapseStart||0;return ge>=J&&(xe-=.5),{from:xe,to:ge,showPoints:!1}}function lc(Ge,J,ge){let xe=[],Ie=[],je={},Ye=J||!1,mt={},bt=-1,Bt=tm.getTree(Ge,{after:function(gt){let Lt=mt[gt.pos],qe=0,vt=0;Lt.children.forEach(function(_t){vt+=(_t.descendants||0)+1,qe=Math.max((_t.height||0)+1,qe)}),Lt.descendants=vt,Lt.height=qe,Lt.collapsed&&Ie.push(Lt)},before:function(gt){let Lt,qe,vt=Oh(gt.data,!0)?gt.data:{},_t=om(vt.name)?vt.name:"",Wt=je[gt.parent],Gt=Oh(Wt,!0)?mt[Wt.pos]:null;Ye&&Oh(Gt,!0)&&(Lt=xf(Gt.children,function(Vt){return Vt.name===_t}))?(qe=Lt.pos,Lt.nodes.push(gt)):qe=bt++,!mt[qe]&&(mt[qe]=Lt={depth:Gt?Gt.depth+1:0,name:_t,id:vt.id,nodes:[gt],children:[],pos:qe},qe!==-1&&xe.push(_t),Oh(Gt,!0)&&Gt.children.push(Lt)),om(gt.id)&&(je[gt.id]=gt),Lt&&vt.collapsed===!0&&(Lt.collapsed=!0),gt.pos=qe}});return{categories:xe,mapOfIdToNode:je,mapOfPosToGridNode:mt=function(gt,Lt){let qe=function(vt,_t,Wt){let Gt=vt.nodes,Vt=_t+(_t===-1?0:Lt-1),ji=(Vt-_t)/2,Ms=_t+ji;return Gt.forEach(function(zi){let os=zi.data;Oh(os,!0)&&(os.y=_t+(os.seriesIndex||0),delete os.seriesIndex),zi.pos=Ms}),Wt[Ms]=vt,vt.pos=Ms,vt.tickmarkOffset=ji+.5,vt.collapseStart=Vt+.5,vt.children.forEach(function(zi){qe(zi,Vt+1,Wt),Vt=(zi.collapseEnd||0)-.5}),vt.collapseEnd=Vt+.5,Wt};return qe(gt[-1],-1,{})}(mt,ge),collapsedNodes:Ie,tree:Bt}}function vp(Ge){let J=Ge.target;J.axes.filter(ge=>ge.type==="treegrid").forEach(function(ge){var Lt;let xe=ge.options||{},Ie=xe.labels,je=ge.uniqueNames,Ye=J.time.parse(xe.max),mt=!ge.treeGrid.mapOfPosToGridNode||ge.series.some(function(qe){return!qe.hasRendered||qe.isDirtyData||qe.isDirty}),bt=0,Bt,gt;if(mt){let qe=[];if(Bt=ge.series.reduce(function(vt,_t){let Wt=_t.options.data||[],Gt=Wt[0],Vt=Array.isArray(Gt)&&!Gt.find(ji=>typeof ji=="object");return qe.push(Vt),_t.visible&&(Wt.forEach(function(ji){var Ms;(Vt||(Ms=_t.options.keys)!=null&&Ms.length)&&(ji=_t.pointClass.prototype.optionsToObject.call({series:_t},ji),_t.pointClass.setGanttPointAliases(ji,J)),Oh(ji,!0)&&(ji.seriesIndex=bt,vt.push(ji))}),je===!0&&bt++),vt},[]),Ye&&Bt.length<Ye)for(let vt=Bt.length;vt<=Ye;vt++)Bt.push({name:vt+"​"});ge.categories=(gt=lc(Bt,je||!1,je===!0?bt:1)).categories,ge.treeGrid.mapOfPosToGridNode=gt.mapOfPosToGridNode,ge.hasNames=!0,ge.treeGrid.tree=gt.tree,ge.series.forEach(function(vt,_t){let Wt=(vt.options.data||[]).map(function(Gt){return(qe[_t]||lg(Gt)&&vt.options.keys&&vt.options.keys.length)&&Bt.forEach(function(Vt){let ji=$p(Gt);ji.indexOf(Vt.x||0)>=0&&ji.indexOf(Vt.x2||0)>=0&&(Gt=Vt)}),Oh(Gt,!0)?Ru(Gt):Gt});vt.visible&&vt.setData(Wt,!1)}),ge.treeGrid.mapOptionsToLevel=Yp({defaults:Ie,from:1,levels:Ie==null?void 0:Ie.levels,to:(Lt=ge.treeGrid.tree)==null?void 0:Lt.height}),Ge.type==="beforeRender"&&(ge.treeGrid.collapsedNodes=gt.collapsedNodes)}})}function bp(Ge,J){let ge=this.treeGrid.mapOptionsToLevel||{},xe=this.type==="treegrid",Ie=this.ticks,je=Ie[J],Ye,mt,bt;xe&&this.treeGrid.mapOfPosToGridNode?((Ye=ge[(bt=this.treeGrid.mapOfPosToGridNode[J]).depth])&&(mt={labels:Ye}),!je&&hs?Ie[J]=je=new hs(this,J,void 0,void 0,{category:bt.name,tickmarkOffset:bt.tickmarkOffset,options:mt}):(je.parameters.category=bt.name,je.options=mt,je.addLabel())):Ge.apply(this,Array.prototype.slice.call(arguments,1))}function nm(Ge,J,ge,xe){let Ie=this,je=ge.type==="treegrid";Ie.treeGrid||(Ie.treeGrid=new Bu(Ie)),je&&(Lh(J,"beforeRender",vp),Lh(J,"beforeRedraw",vp),Lh(J,"addSeries",function(Ye){if(Ye.options.data){let mt=lc(Ye.options.data,ge.uniqueNames||!1,1);Ie.treeGrid.collapsedNodes=(Ie.treeGrid.collapsedNodes||[]).concat(mt.collapsedNodes)}}),Lh(Ie,"foundExtremes",function(){Ie.treeGrid.collapsedNodes&&Ie.treeGrid.collapsedNodes.forEach(function(Ye){let mt=Ie.treeGrid.collapse(Ye);Ie.brokenAxis&&(Ie.brokenAxis.setBreaks(mt,!1),Ie.treeGrid.collapsedNodes&&(Ie.treeGrid.collapsedNodes=Ie.treeGrid.collapsedNodes.filter(bt=>Ye.collapseStart!==bt.collapseStart||Ye.collapseEnd!==bt.collapseEnd)))})}),Lh(Ie,"afterBreaks",function(){Ie.coll==="yAxis"&&!Ie.staticScale&&Ie.chart.options.chart.height&&(Ie.isDirty=!0)}),ge=Ru({grid:{enabled:!0},labels:{align:"left",levels:[{level:void 0},{level:1,style:{fontWeight:"bold"}}],symbol:{type:"triangle",x:-5,y:-5,height:10,width:10}},uniqueNames:!1},ge,{reversed:!0})),Ge.apply(Ie,[J,ge,xe]),je&&(Ie.hasNames=!0,Ie.options.showLastLabel=!0)}function Om(Ge){var Ie;let J=this.options,ge=this.chart.time,xe=typeof J.linkedTo=="number"?(Ie=this.chart[this.coll])==null?void 0:Ie[J.linkedTo]:void 0;if(this.type==="treegrid"){if(this.min=this.userMin??ge.parse(J.min)??this.dataMin,this.max=this.userMax??ge.parse(J.max)??this.dataMax,_f(this,"foundExtremes"),this.setAxisTranslation(),this.tickInterval=1,this.tickmarkOffset=.5,this.tickPositions=this.treeGrid.mapOfPosToGridNode?this.treeGrid.getTickPositions():[],xe){let je=xe.getExtremes();this.min=vf(je.min,je.dataMin),this.max=vf(je.max,je.dataMax),this.tickPositions=xe.tickPositions}this.linkedParent=xe}else Ge.apply(this,Array.prototype.slice.call(arguments,1))}function hd(Ge){let J=this;this.type==="treegrid"&&J.visible&&J.tickPositions.forEach(function(ge){var Ie;let xe=J.ticks[ge];(Ie=xe.label)!=null&&Ie.attachedTreeGridEvents&&(lu(xe.label.element),xe.label.attachedTreeGridEvents=!1)}),Ge.apply(J,Array.prototype.slice.call(arguments,1))}class Bu{static compose(J,ge,xe,Ie){if(!J.keepProps.includes("treeGrid")){let je=J.prototype;J.keepProps.push("treeGrid"),ac(je,"generateTick",bp),ac(je,"init",nm),ac(je,"setTickInterval",Om),ac(je,"redraw",hd),je.utils={getNode:tm.getNode},hs||(hs=Ie)}return Lm.compose(J,ge,Ie),Dr.compose(J,xe),sm.compose(Ie),J}constructor(J){this.axis=J}setCollapsedStatus(J){let ge=this.axis,xe=ge.chart;ge.series.forEach(function(Ie){let je=Ie.options.data;if(J.id&&je){let Ye=xe.get(J.id),mt=je[Ie.data.indexOf(Ye)];Ye&&mt&&(Ye.collapsed=J.collapsed,mt.collapsed=J.collapsed)}})}collapse(J){let ge=this.axis,xe=ge.options.breaks||[],Ie=qp(J,ge.max);return xe.push(Ie),J.collapsed=!0,ge.treeGrid.setCollapsedStatus(J),xe}expand(J){let ge=this.axis,xe=ge.options.breaks||[],Ie=qp(J,ge.max);return J.collapsed=!1,ge.treeGrid.setCollapsedStatus(J),xe.reduce(function(je,Ye){return(Ye.to!==Ie.to||Ye.from!==Ie.from)&&je.push(Ye),je},[])}getTickPositions(){let J=this.axis,ge=Math.floor(J.min/J.tickInterval)*J.tickInterval,xe=Math.ceil(J.max/J.tickInterval)*J.tickInterval;return Object.keys(J.treeGrid.mapOfPosToGridNode||{}).reduce(function(Ie,je){var mt;let Ye=+je;return Ye>=ge&&Ye<=xe&&!((mt=J.brokenAxis)!=null&&mt.isInAnyBreak(Ye))&&Ie.push(Ye),Ie},[])}isCollapsed(J){let ge=this.axis,xe=ge.options.breaks||[],Ie=qp(J,ge.max);return xe.some(function(je){return je.from===Ie.from&&je.to===Ie.to})}toggleCollapse(J){return this.isCollapsed(J)?this.expand(J):this.collapse(J)}}let{series:Zp,seriesTypes:{xrange:Wc}}=lr(),{extend:cd,isNumber:bf,merge:Dm}=Cs();class _h extends Wc{static compose(J,ge,xe,Ie){Wc.compose(J),ge&&(Up.compose(J,ge),xe&&(Fc.compose(ge,xe.prototype.pointClass),Ie&&Bu.compose(J,ge,xe,Ie)))}drawPoint(J,ge){let xe=this.options,Ie=this.chart.renderer,je=J.shapeArgs,Ye=J.plotY,mt=J.selected&&"select",bt=xe.stacking&&!xe.borderRadius,Bt=J.graphic,gt;J.options.milestone?bf(Ye)&&J.y!==null&&J.visible!==!1?(gt=Ie.symbols.diamond(je.x||0,je.y||0,je.width||0,je.height||0),Bt?Bt[ge]({d:gt}):J.graphic=Bt=Ie.path(gt).addClass(J.getClassName(),!0).add(J.group||this.group),this.chart.styledMode||J.graphic.attr(this.pointAttribs(J,mt)).shadow(xe.shadow,null,bt)):Bt&&(J.graphic=Bt.destroy()):super.drawPoint(J,ge)}translatePoint(J){let ge,xe;super.translatePoint(J),J.options.milestone&&(xe=(ge=J.shapeArgs).height||0,J.shapeArgs={x:(ge.x||0)-xe/2,y:ge.y,width:xe,height:xe})}}_h.defaultOptions=Dm(Wc.defaultOptions,{grouping:!1,dataLabels:{enabled:!0},tooltip:{headerFormat:'<span style="font-size: 0.8em">{series.name}</span><br/>',pointFormat:null,pointFormatter:function(){let Ge=this.series,J=Ge.xAxis,ge=Ge.tooltipOptions.dateTimeLabelFormats,xe=J.options.startOfWeek,Ie=Ge.tooltipOptions,je=this.options.milestone,Ye=Ie.xDateFormat,mt="<b>"+(this.name||this.yCategory)+"</b>";if(Ie.pointFormat)return this.tooltipFormatter(Ie.pointFormat);!Ye&&ka(this.start)&&(Ye=Ge.chart.time.getDateFormat(J.closestPointRange,this.start,xe,ge||{}));let bt=Ge.chart.time.dateFormat(Ye,this.start),Bt=Ge.chart.time.dateFormat(Ye,this.end);return mt+="<br/>",je?mt+=bt+"<br/>":mt+="Start: "+bt+"<br/>"+("End: "+Bt)+"<br/>",mt}},connectors:{type:"simpleConnect",animation:{reversed:!0},radius:0,startMarker:{enabled:!0,symbol:"arrow-filled",radius:4,fill:"#fa0",align:"left"},endMarker:{enabled:!1,align:"right"}}}),cd(_h.prototype,{pointArrayMap:["start","end","y"],pointClass:ho,setData:Zp.prototype.setData}),lr().registerSeriesType("gantt",_h);/**
* @license Highcharts Gantt JS v12.3.0 (2025-06-21)
* @module highcharts/modules/gantt
* @requires highcharts
*
* Gantt series
*
* (c) 2016-2025 Lars A. V. Cabrera
*
* License: www.highcharts.com/license
*/let bn=Cs();bn.Connection=bn.Connection||Pl,bn.GanttChart=bn.GanttChart||jl,bn.Navigator=bn.Navigator||Eh,bn.RangeSelector=bn.RangeSelector||cs,bn.Scrollbar=bn.Scrollbar||Ah,bn.ganttChart=bn.GanttChart.ganttChart,Io.compose(bn.SVGRenderer),{compose:function(Ge,J){Ul(Lo,"CurrentDateIndication")&&(Zo(Ge,"afterSetOptions",Sh),Zo(J,"render",Wh),mo(J.prototype,"getLabelText",Qs))}}.compose(bn.Axis,bn.PlotLineOrBand),_h.compose(bn.Axis,bn.Chart,bn.Series,bn.Tick),bn.Navigator.compose(bn.Chart,bn.Axis,bn.Series),bn.RangeSelector.compose(bn.Axis,bn.Chart),bn.Scrollbar.compose(bn.Axis);let wp=Cs();return fo.default})())}(Pv)),Pv.exports}JA();var QA=ua('<div class="small-multiples svelte-1h74dxe"><div><!></div></div>'),e2=ua(`The following data is directly taken from the Black Wealth Data Center. 
                When comparing the SVI of both counties, it is clear that Essex County has an incredibly high 
                value of 0.94. However, Hunterdon County's value is a mere 0.04... the <strong>lowest</strong> value in the state. <br/><br/> This massive disparity cannot be chalked up to a coincidence.`,1),t2=ua('<div class="small-multiples svelte-1h74dxe"><div></div> <!></div>'),i2=ua(`When we look at the Black population in each county, it is significant 
                that the percentage in Essex County, 36.9%, is <strong>much higher</strong> than that of 
                Hunterdon County, or 2.6%. There is a clear connection between social vulnerability and the amount of 
                Black residents in a county.`,1),s2=ua('<div class="small-multiples svelte-1h74dxe"><div></div> <!></div>'),r2=ua(`This data examines the difference between Black median income in both counties, which can help to clearly 
                indicate financial capacity. Essex County's Black median income falls at a mere <strong>$56,411,</strong> whereas Hunterdon County's 
                is <strong>more than double that</strong> at $121,838. <br/><br/> Persistent wealth inequality and systemic discrimination in relation to housing, healthcare, and education
                have left Black households and individuals <strong>disproportionately vulnerable to poverty.</strong> In today's world, low financial standing 
                directly translates to a lack of security and safety in the face of disasters and disruptive global events. <br/><br/> With the median household income in New Jersey
                reaching a whopping $101,050, Black residents of Essex County are at a significant disadvantage in 
                hazardous situations.`,1),o2=ua('<div class="small-multiples svelte-1h74dxe"><div></div> <!></div>'),n2=ua(`This relationship is also apparent when looking at the percentage of Black-owner occupied homes in both counties. 
                There is a 24.1% Black home ownership rate in Essex County, as opposed to a 1.3% ownership rate in Hunterdon County. 
                This corresponds to the data given about the Black populations in both counties, as Essex County showed a significantly 
                higher percentage. <br/><br/> These staggering differences are made clearer when realizing that Hunterdon County is a <strong>predominantly white town,</strong> with a non-Hispanic white population percentage of 81.1%. <br/><br/> More importantly, however, one thing in relation to this tale of two counties has become 
                increasingly apparent.`,1),a2=ua("<div><!> <!> <!> <!></div>");function l2(ze,Je){fx(Je,!1);let ot=jh({svi:!1,blackPops:!1,blackIncome:!1,blackHousing:!1}),Ht=jh(),Qt=jh(),ni=jh(),Vi=jh();const a={threshold:.4};function Ni(Nr,Or){new IntersectionObserver(([fr])=>{fr.isIntersecting&&Lv(ot,Sr(ot)[Or]=!0)},a).observe(Nr)}gx(()=>{Ni(Sr(Ht),"svi"),Ni(Sr(Qt),"blackPops"),Ni(Sr(ni),"blackIncome"),Ni(Sr(Vi),"blackHousing")});const Ui={chart:{type:"column"},title:{text:"Social Vulnerability Index",style:{fontSize:"20px",fontFamily:"Frank Ruhl Libre, serif"}},yAxis:{max:1,title:{text:"SVI Value",style:{fontSize:"15px",fontFamily:"EB Garamond, serif"}},labels:{style:{fontFamily:"EB Garamond, serif",fontSize:"14px"}}},xAxis:{categories:["Essex County","Hunterdon County"],labels:{style:{fontFamily:"EB Garamond, serif",fontSize:"14px"}}},series:[{name:"SVI Index",style:{fontFamily:"EB Garamond, serif",fontSize:"14px"},color:"#000000",data:[{y:.94,color:"#000000",name:"Essex"},{y:.04,color:"#888888",name:"Hunterdon"}],animation:{duration:800}}]},is={chart:{type:"column"},title:{text:"% Black Population",style:{fontSize:"20px",fontFamily:"Frank Ruhl Libre, serif"}},yAxis:{max:100,title:{text:"% Black Population",style:{fontSize:"15px",fontFamily:"EB Garamond, serif"}},labels:{style:{fontFamily:"EB Garamond, serif",fontSize:"14px"}}},xAxis:{categories:["Essex","Hunterdon"],labels:{style:{fontFamily:"EB Garamond, serif",fontSize:"14px"}}},series:[{name:"% Black Population",style:{fontFamily:"EB Garamond, serif",fontSize:"14px"},color:"#000000",data:[{y:36.9,color:"#000000"},{y:2.6,color:"#888888"}],animation:{duration:800}}]},Xs={chart:{type:"column"},title:{text:"Black Median Income",style:{fontSize:"20px",fontFamily:"Frank Ruhl Libre, serif"}},yAxis:{max:15e4,title:{text:"Black Median Income",style:{fontSize:"15px",fontFamily:"EB Garamond, serif"}},labels:{style:{fontFamily:"EB Garamond, serif",fontSize:"14px"}}},xAxis:{categories:["Essex","Hunterdon"],labels:{style:{fontFamily:"EB Garamond, serif",fontSize:"14px"}}},series:[{name:"Black Median Income",style:{fontFamily:"EB Garamond, serif",fontSize:"14px"},color:"#000000",data:[{y:56411,color:"#000000"},{y:121838,color:"#888888"}],animation:{duration:800}}]},Qi={chart:{type:"column"},title:{text:"% Black Owner-Occupied Housing",style:{fontSize:"20px",fontFamily:"Frank Ruhl Libre, serif"}},yAxis:{max:100,title:{text:"% Black Owner-Occupied Housing",style:{fontSize:"15px",fontFamily:"EB Garamond, serif"}},labels:{style:{fontFamily:"EB Garamond, serif",fontSize:"14px"}}},xAxis:{categories:["Essex","Hunterdon"],labels:{style:{fontFamily:"EB Garamond, serif",fontSize:"14px"}}},series:[{name:"% Black Owner-Occupied Housing",style:{fontFamily:"EB Garamond, serif",fontSize:"14px"},color:"#000000",data:[{y:24.1,color:"#000000"},{y:1.3,color:"#888888"}],animation:{duration:800}}]};o_();var xs=a2(),zs=ah(xs);Z0(zs,{layout:"left",sticky:ir=>{var fr=QA(),wo=ah(fr),rn=ah(wo);{var Pi=fo=>{Sv(fo,{get highcharts(){return K0},get options(){return Ui}})};By(rn,fo=>{Sr(ot).svi&&fo(Pi)})}Gf(wo,fo=>Jn(Ht,fo),()=>Sr(Ht)),da(ir,fr)},scrolly:ir=>{P_(ir,{children:(fr,wo)=>{var rn=e2();da(fr,rn)}})}});var hs=yl(zs,2);Z0(hs,{layout:"left",sticky:ir=>{var fr=t2(),wo=ah(fr);Gf(wo,fo=>Jn(Qt,fo),()=>Sr(Qt));var rn=yl(wo,2);{var Pi=fo=>{Sv(fo,{get highcharts(){return K0},get options(){return is}})};By(rn,fo=>{Sr(ot).blackPops&&fo(Pi)})}da(ir,fr)},scrolly:ir=>{P_(ir,{children:(fr,wo)=>{var rn=i2();da(fr,rn)}})}});var _r=yl(hs,2);Z0(_r,{layout:"left",sticky:ir=>{var fr=s2(),wo=ah(fr);Gf(wo,fo=>Jn(ni,fo),()=>Sr(ni));var rn=yl(wo,2);{var Pi=fo=>{Sv(fo,{get highcharts(){return K0},get options(){return Xs}})};By(rn,fo=>{Sr(ot).blackIncome&&fo(Pi)})}da(ir,fr)},scrolly:ir=>{P_(ir,{children:(fr,wo)=>{var rn=r2();da(fr,rn)}})}});var ar=yl(_r,2);Z0(ar,{layout:"left",sticky:ir=>{var fr=o2(),wo=ah(fr);Gf(wo,fo=>Jn(Vi,fo),()=>Sr(Vi));var rn=yl(wo,2);{var Pi=fo=>{Sv(fo,{get highcharts(){return K0},get options(){return Qi}})};By(rn,fo=>{Sr(ot).blackHousing&&fo(Pi)})}da(ir,fr)},scrolly:ir=>{P_(ir,{children:(fr,wo)=>{var rn=n2();da(fr,rn)}})}}),da(ze,xs),mx()}var h2=ua('<div><div class="card svelte-2lw4ab"><div class="person svelte-2lw4ab"> </div> <div class="description svelte-2lw4ab"> </div></div></div>'),c2=ua(`<div class="title svelte-2lw4ab"><h1 class="svelte-2lw4ab">Implications for the Future</h1> <p style="max-width: 640px; margin: 1rem auto; padding: 0 1.5rem; font-family: 'EB Garamond', serif; font-size: 1.15rem; line-height: 1.4; text-align: justify;">This data is not just numbers on a screen. It represents lived experiences 
      and real-world implications. The two divided paths on this timeline follow the lives of Amelia, a Hunterdon County resident, 
      and Jesse, an Essex County resident. 
      Their experiences reflect what the future could look like if inequality based in 
      social vulnerability continues to be brushed aside, neglected, and forgotten.</p></div> <div class="timeline-container svelte-2lw4ab"><div class="timeline-line svelte-2lw4ab"></div> <!></div>`,1);function d2(ze,Je){fx(Je,!1);let ot=jh([]);const Ht=[{person:"Amelia",event:"Born in Hunterdon Medical Center",age:0},{person:"Jesse",event:"Born in Newark University Hospital",age:0},{person:"Amelia",event:"Started pre-school at private Montessori School with ample early learning resources and 1-1 care",age:4},{person:"Jesse",event:"Started kindergarten at underfunded program in Newark public schools",age:5},{person:"Amelia",event:"Moved to a single-family home in neighborhood with safe drinking water, healthy food options, and well-funded schools",age:9},{person:"Jesse",event:"Moved from apartment to apartment as family was unable to afford rising rent, often near previous or current waste facilities ",age:10},{person:"Amelia",event:"Massive hurricane induced by global climate change and rising sea levels hits, and town emergency responders rescue people unable to evacuate on time",age:13},{person:"Jesse",event:"Massive hurricane induced by global climate change and rising sea levels hits, and chemical spill from unregulated factory washes harmful toxins into community water and air",age:13},{person:"Amelia",event:"Weeks of preparation before standardized state testing week in school",age:15},{person:"Jesse",event:"Results of standardized testing are released and show significantly under average performance",age:15},{person:"Amelia",event:"College admissions process begins",age:17},{person:"Jesse",event:"Considers and hopes to attend college, but cannot afford tuition in single-parent household with many dependents",age:17},{person:"Amelia",event:"Graduates from college with two degrees and well-paying job",age:24},{person:"Jesse",event:"Continues to work service sector jobs to pay fluctuating yet rising rent and energy bills due to global warming",age:25},{person:"Amelia",event:"Moves to affluent neighborhood with family",age:30},{person:"Jesse",event:"Cannot vaccinate during outbreak of contagious influenza strain with no health insurance and no means of transportation to vaccination sites",age:37},{person:"Amelia",event:"Vaccinates family with employer-sponsored, high coverage health insurance following outbreak",age:37}];gx(()=>{const a=new IntersectionObserver(Ni=>{Ni.forEach(Ui=>{Ui.isIntersecting?Ui.target.classList.add("visible"):Ui.target.classList.remove("visible")})},{threshold:.3});return Sr(ot).forEach(Ni=>a.observe(Ni)),()=>{a.disconnect()}}),o_();var Qt=c2(),ni=yl($v(Qt),2),Vi=yl(ah(ni),2);Zb(Vi,1,()=>Ht,qb,(a,Ni,Ui)=>{var is=h2();Kb(is,`--i: ${Ui}`);var Xs=ah(is),Qi=ah(Xs),xs=ah(Qi),zs=yl(Qi,2),hs=ah(zs);Gf(is,(_r,ar)=>Lv(ot,Sr(ot)[ar]=_r),_r=>{var ar;return(ar=Sr(ot))==null?void 0:ar[_r]},()=>[Ui]),k0(_r=>{tv(is,1,`timeline-item ${_r??""}`,"svelte-2lw4ab"),Lb(xs,`${Sr(Ni).person??""} (Age ${Sr(Ni).age??""})`),Lb(hs,Sr(Ni).event)},[()=>Sr(Ni).person.toLowerCase()],Xv),da(a,is)}),da(ze,Qt),mx()}var u2=ua(`<p class="final-line svelte-pallh8">But... it doesn't have to be this way.</p>`),p2=ua('<div class="scene svelte-pallh8"><img src="amelia.png" alt="Hunterdon character"/> <img src="jesse.png" alt="Essex character"/> <!></div>');function f2(ze,Je){let ot=eg(Je,"phase",8,"idle");var Ht=p2(),Qt=ah(Ht);let ni;var Vi=yl(Qt,2);let a;var Ni=yl(Vi,2);{var Ui=is=>{var Xs=u2();da(is,Xs)};By(Ni,is=>{ot()==="back"&&is(Ui)})}k0((is,Xs)=>{ni=tv(Qt,1,"character hunterdon svelte-pallh8",null,ni,is),a=tv(Vi,1,"character essex svelte-pallh8",null,a,Xs)},[()=>({"walk-out":ot()==="out","walk-back":ot()==="back"}),()=>({"walk-out":ot()==="out","walk-back":ot()==="back"})],Xv),da(ze,Ht)}var m2=ua(`<div class="ending-text-column svelte-vqpjp4"><p>Just half of the average life of these two hypothetical residents are so vastly different. 
            It is dificult to erase or even change centuries of history and inequality. 
            We cannot exactly flick a switch or snap our fingers to make Essex County a safer, 
            more secure place to live. We cannot erase the years of systemic inequality that have given 
            Hunterdon County residents more protection and stability during disruptive times. <br/><br/> However, the future is already upon us, and the time to act is now. Although 
        9 million people, myself included, may not be able to change the fact that New Jersey is our home, 
        we certainly <strong>can</strong> build a better home for us, and the people that 
        come after us. <br/><br/> Luckily, Essex County residents are already relentlessly working to rebuild 
        the narratives of so many Black individuals and families by turning social 
        vulnerability into community power.</p></div>`);function g2(ze){var Je=m2();da(ze,Je)}var y2=ua(`<div style="position: absolute; 
        bottom: 10%; 
        left: 50%; 
        transform: translateX(-50%);
        background: rgba(255, 255, 255, 0.9); 
        padding: 1rem; 
        border-radius: 1rem; 
        max-width: 400px; 
        text-align: center;"><p style="margin-top: 0.75rem; font-family: 'Libre Baskerville', serif; font-style: italic; text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.3);">This is New Jersey. It is the most densely populated state in the
            U.S., with a population of 9.5 million people occupying just 8,000
            square miles. And, through some twist of fate, it is the place I
            call home.</p></div>`),x2=ua(`<div style="position: absolute; 
          bottom: 10%; 
          left: 50%; 
          transform: translateX(-50%);
          background: rgba(255, 255, 255, 0.9); 
          padding: 1rem; 
          border-radius: 1rem; 
          max-width: 400px; 
          text-align: center;"><p style="margin-top: 0.75rem; font-family: 'Libre Baskerville', serif; font-style: italic; text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.3);">This is Hunterdon County. It is one of the wealthiest counties in
            the state, known for its affluent neighborhoods, top-rated
            education, and incredible quality of life.</p></div> <div style="position: absolute;
          max-width: 350px; 
          background: rgba(255, 255, 255, 0.85);
          padding: 1rem; 
          border-radius: 12px; 
          &lt;!-- box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); -->
          z-index: 10; 
          transition: opacity 0.5s ease, transform 0.5s ease;
          top: 20%; 
          left: 5%;"><img src="https://upload.wikimedia.org/wikipedia/commons/d/d5/Clinton_NJ_Easter_2014.jpg" alt="Hunterdon County" style="width: 100%; height: auto; border-radius: 8px;"/></div>`,1),_2=ua(`<div style="position: absolute; 
          bottom: 10%; 
          left: 50%; 
          transform: translateX(-50%);
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
          background: rgba(255, 255, 255, 0.9); 
          padding: 1rem; 
          border-radius: 1rem; 
          max-width: 400px; 
          text-align: center;"><p style="margin-top: 0.75rem; font-family: 'Libre Baskerville', serif; font-style: italic; text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.3);">And this is Essex County. It is one of the poorest counties in the
            state, with many neighborhoods falling in the high-poverty category.
            Homelessness is prevalent, and infrastructure and
            education fall considerably below the state standard.</p></div> <div style="position: absolute;
          max-width: 350px; 
          background: black;
          padding: 1rem; 
          border-radius: 12px; 
          background: rgba(255, 255, 255, 0.85);
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
          z-index: 10; 
          transition: opacity 0.5s ease, transform 0.5s ease;
          top: 10%; 
          right: 10%;"><img src="https://static01.nyt.com/images/2019/11/15/nyregion/00newark8/00newark8-articleLarge.jpg?quality=75&amp;auto=webp&amp;disable=upscale" alt="Essex County" style="width: 100%; height: auto; border-radius: 8px;"/></div>`,1),v2=ua(`<div style="position: fixed; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100vh; 
    z-index: 0;"><!></div> <div style="position: fixed; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100vh; 
    z-index: 2; 
    pointer-events: none;"><!></div>`,1),b2=ua('<main><!> <div style="position: relative; z-index: 1;"><section style="height: 100vh"></section> <section style="height: 100vh;"></section> <section style="height: 100vh;"></section> <section style="height: 100vh;"><!> <!> <!> <!> <!> <!> <div style="height: 1px;"></div> <!> <div style="height: 1px;"></div> <!></section></div></main>');function w2(ze,Je){fx(Je,!1);let ot=jh("idle"),Ht=jh(),Qt=jh(),ni=jh({center:[-74.4057,40.0573],zoom:6}),Vi=jh(),a=jh(),Ni=jh(),Ui=jh(),is=jh("state");gx(()=>{const No=new IntersectionObserver(Io=>{for(const Qn of Io)Qn.isIntersecting&&(Qn.target===Sr(Vi)?(Jn(ni,{center:[-74.4057,40.0583],zoom:6}),Jn(is,"state")):Qn.target===Sr(a)?(Jn(ni,{center:[-74.9209,40.567],zoom:10}),Jn(is,"countyA")):Qn.target===Sr(Ni)?(Jn(ni,{center:[-74.2649,40.7947],zoom:10}),Jn(is,"countyB")):Qn.target===Sr(Ui)&&Jn(is,"done"))},{threshold:.5}),pi=new IntersectionObserver(([Io])=>{Io.isIntersecting&&Jn(ot,"out")},{threshold:.5}),on=new IntersectionObserver(([Io])=>{Io.isIntersecting&&Jn(ot,"back")},{threshold:.5});Sr(Ht)&&pi.observe(Sr(Ht)),Sr(Qt)&&on.observe(Sr(Qt)),No.observe(Sr(Vi)),No.observe(Sr(a)),No.observe(Sr(Ni)),No.observe(Sr(Ui))}),o_();var Xs=b2(),Qi=ah(Xs);{var xs=No=>{var pi=v2(),on=$v(pi),Io=ah(on);uA(Io,{get zoomTarget(){return Sr(ni)}});var Qn=yl(on,2),fi=ah(Qn);{var xl=Kn=>{var za=y2();da(Kn,za)},gr=(Kn,za)=>{{var Na=Lo=>{var Zo=x2();da(Lo,Zo)},Pl=(Lo,Zo)=>{{var pa=Ul=>{var mo=_2();da(Ul,mo)};By(Lo,Ul=>{Sr(is)==="countyB"&&Ul(pa)},Zo)}};By(Kn,Lo=>{Sr(is)==="countyA"?Lo(Na):Lo(Pl,!1)},za)}};By(fi,Kn=>{Sr(is)==="state"?Kn(xl):Kn(gr,!1)})}da(No,pi)};By(Qi,No=>{Sr(is)!=="done"&&No(xs)})}var zs=yl(Qi,2),hs=ah(zs);Gf(hs,No=>Jn(Vi,No),()=>Sr(Vi));var _r=yl(hs,2);Gf(_r,No=>Jn(a,No),()=>Sr(a));var ar=yl(_r,2);Gf(ar,No=>Jn(Ni,No),()=>Sr(Ni));var Nr=yl(ar,2),Or=ah(Nr);bA(Or);var ir=yl(Or,2);SA(ir);var fr=yl(ir,2);DA(fr);var wo=yl(fr,2);l2(wo,{});var rn=yl(wo,2);NA(rn,{});var Pi=yl(rn,2);d2(Pi,{});var fo=yl(Pi,2);Gf(fo,No=>Jn(Ht,No),()=>Sr(Ht));var pl=yl(fo,2);f2(pl,{get phase(){return Sr(ot)}});var Cs=yl(pl,2);Gf(Cs,No=>Jn(Qt,No),()=>Sr(Qt));var Da=yl(Cs,2);g2(Da),Gf(Nr,No=>Jn(Ui,No),()=>Sr(Ui)),da(ze,Xs),mx()}RM(w2,{target:document.getElementById("app")});
